function OpenSeadragon(t){return new OpenSeadragon.Viewer(t)}function loadingModal_start(){window.spinnerTimer&&(clearTimeout(window.spinnerTimer),window.spinnerTimer=0),$("#loadingStateModal").fadeIn("fast")}function loadingModal_stop(){window.spinnerTimer=setTimeout(function(){$("#loadingStateModal").fadeOut("fast")},200)}!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e=!!t&&"length"in t&&t.length,i=ot.type(t);return"function"!==i&&!ot.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function n(t,e,i){if(ot.isFunction(e))return ot.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return ot.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(gt.test(e))return ot.filter(e,t,i);e=ot.filter(e,t)}return ot.grep(t,function(t){return Q.call(e,t)>-1!==i})}function r(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function o(t){var e={};return ot.each(t.match(_t)||[],function(t,i){e[i]=!0}),e}function s(){K.removeEventListener("DOMContentLoaded",s),t.removeEventListener("load",s),ot.ready()}function a(){this.expando=ot.expando+a.uid++}function l(t,e,i){var n;if(i===undefined&&1===t.nodeType)if(n="data-"+e.replace(Et,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:kt.test(i)?ot.parseJSON(i):i)}catch(t){}Tt.set(t,e,i)}else i=undefined;return i}function h(t,e,i,n){var r,o=1,s=20,a=n?function(){return n.cur()}:function(){return ot.css(t,e,"")},l=a(),h=i&&i[3]||(ot.cssNumber[e]?"":"px"),c=(ot.cssNumber[e]||"px"!==h&&+l)&&Dt.exec(ot.css(t,e));if(c&&c[3]!==h){h=h||c[3],i=i||[],c=+l||1;do{o=o||".5",c/=o,ot.style(t,e,c+h)}while(o!==(o=a()/l)&&1!==o&&--s)}return i&&(c=+c||+l||0,r=i[1]?c+(i[1]+1)*i[2]:+i[2],n&&(n.unit=h,n.start=c,n.end=r)),r}function c(t,e){var i="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):[];return e===undefined||e&&ot.nodeName(t,e)?ot.merge([t],i):i}function u(t,e){for(var i=0,n=t.length;i<n;i++)St.set(t[i],"globalEval",!e||St.get(e[i],"globalEval"))}function d(t,e,i,n,r){for(var o,s,a,l,h,d,f=e.createDocumentFragment(),p=[],g=0,m=t.length;g<m;g++)if((o=t[g])||0===o)if("object"===ot.type(o))ot.merge(p,o.nodeType?[o]:o);else if(Ot.test(o)){for(s=s||f.appendChild(e.createElement("div")),a=(Lt.exec(o)||["",""])[1].toLowerCase(),l=Rt[a]||Rt._default,s.innerHTML=l[1]+ot.htmlPrefilter(o)+l[2],d=l[0];d--;)s=s.lastChild;ot.merge(p,s.childNodes),s=f.firstChild,s.textContent=""}else p.push(e.createTextNode(o));for(f.textContent="",g=0;o=p[g++];)if(n&&ot.inArray(o,n)>-1)r&&r.push(o);else if(h=ot.contains(o.ownerDocument,o),s=c(f.appendChild(o),"script"),h&&u(s),i)for(d=0;o=s[d++];)At.test(o.type||"")&&i.push(o);return f}function f(){return!0}function p(){return!1}function g(){try{return K.activeElement}catch(t){}}function m(t,e,i,n,r,o){var s,a;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=undefined);for(a in e)m(t,a,i,n,e[a],o);return t}if(null==n&&null==r?(r=i,n=i=undefined):null==r&&("string"==typeof i?(r=n,n=undefined):(r=n,n=i,i=undefined)),!1===r)r=p;else if(!r)return t;return 1===o&&(s=r,r=function(t){return ot().off(t),s.apply(this,arguments)},r.guid=s.guid||(s.guid=ot.guid++)),t.each(function(){ot.event.add(this,e,r,n,i)})}function v(t,e){return ot.nodeName(t,"table")&&ot.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function y(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function b(t){var e=Wt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function _(t,e){var i,n,r,o,s,a,l,h;if(1===e.nodeType){if(St.hasData(t)&&(o=St.access(t),s=St.set(e,o),h=o.events)){delete s.handle,s.events={};for(r in h)for(i=0,n=h[r].length;i<n;i++)ot.event.add(e,r,h[r][i])}Tt.hasData(t)&&(a=Tt.access(t),l=ot.extend({},a),Tt.set(e,l))}}function w(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Mt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function x(t,e,i,n){e=X.apply([],e);var r,o,s,a,l,h,u=0,f=t.length,p=f-1,g=e[0],m=ot.isFunction(g);if(m||f>1&&"string"==typeof g&&!nt.checkClone&&jt.test(g))return t.each(function(r){var o=t.eq(r);m&&(e[0]=g.call(this,r,o.html())),x(o,e,i,n)});if(f&&(r=d(e,t[0].ownerDocument,!1,t,n),o=r.firstChild,1===r.childNodes.length&&(r=o),o||n)){for(s=ot.map(c(r,"script"),y),a=s.length;u<f;u++)l=r,u!==p&&(l=ot.clone(l,!0,!0),a&&ot.merge(s,c(l,"script"))),i.call(t[u],l,u);if(a)for(h=s[s.length-1].ownerDocument,ot.map(s,b),u=0;u<a;u++)l=s[u],At.test(l.type||"")&&!St.access(l,"globalEval")&&ot.contains(h,l)&&(l.src?ot._evalUrl&&ot._evalUrl(l.src):ot.globalEval(l.textContent.replace(qt,"")))}return t}function C(t,e,i){for(var n,r=e?ot.filter(e,t):t,o=0;null!=(n=r[o]);o++)i||1!==n.nodeType||ot.cleanData(c(n)),n.parentNode&&(i&&ot.contains(n.ownerDocument,n)&&u(c(n,"script")),n.parentNode.removeChild(n));return t}function S(t,e){var i=ot(e.createElement(t)).appendTo(e.body),n=ot.css(i[0],"display");return i.detach(),n}function T(t){var e=K,i=Vt[t];return i||(i=S(t,e),"none"!==i&&i||(Ut=(Ut||ot("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=Ut[0].contentDocument,e.write(),e.close(),i=S(t,e),Ut.detach()),Vt[t]=i),i}function k(t,e,i){var n,r,o,s,a=t.style;return i=i||Kt(t),s=i?i.getPropertyValue(e)||i[e]:undefined,""!==s&&s!==undefined||ot.contains(t.ownerDocument,t)||(s=ot.style(t,e)),i&&!nt.pixelMarginRight()&&Zt.test(s)&&Gt.test(e)&&(n=a.width,r=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=n,a.minWidth=r,a.maxWidth=o),s!==undefined?s+"":s}function E(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function P(t){if(t in ie)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=ee.length;i--;)if((t=ee[i]+e)in ie)return t}function D(t,e,i){var n=Dt.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function I(t,e,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===e?1:0,s=0;o<4;o+=2)"margin"===i&&(s+=ot.css(t,i+It[o],!0,r)),n?("content"===i&&(s-=ot.css(t,"padding"+It[o],!0,r)),"margin"!==i&&(s-=ot.css(t,"border"+It[o]+"Width",!0,r))):(s+=ot.css(t,"padding"+It[o],!0,r),"padding"!==i&&(s+=ot.css(t,"border"+It[o]+"Width",!0,r)));return s}function N(t,e,i){var n=!0,r="width"===e?t.offsetWidth:t.offsetHeight,o=Kt(t),s="border-box"===ot.css(t,"boxSizing",!1,o);if(r<=0||null==r){if(r=k(t,e,o),(r<0||null==r)&&(r=t.style[e]),Zt.test(r))return r;n=s&&(nt.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+I(t,e,i||(s?"border":"content"),n,o)+"px"}function M(t,e){for(var i,n,r,o=[],s=0,a=t.length;s<a;s++)n=t[s],n.style&&(o[s]=St.get(n,"olddisplay"),i=n.style.display,e?(o[s]||"none"!==i||(n.style.display=""),""===n.style.display&&Nt(n)&&(o[s]=St.access(n,"olddisplay",T(n.nodeName)))):(r=Nt(n),"none"===i&&r||St.set(n,"olddisplay",r?i:ot.css(n,"display"))));for(s=0;s<a;s++)n=t[s],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?o[s]||"":"none"));return t}function L(t,e,i,n,r){return new L.prototype.init(t,e,i,n,r)}function A(){return t.setTimeout(function(){ne=undefined}),ne=ot.now()}function R(t,e){var i,n=0,r={height:t};for(e=e?1:0;n<4;n+=2-e)i=It[n],r["margin"+i]=r["padding"+i]=t;return e&&(r.opacity=r.width=t),r}function O(t,e,i){for(var n,r=(F.tweeners[e]||[]).concat(F.tweeners["*"]),o=0,s=r.length;o<s;o++)if(n=r[o].call(i,e,t))return n}function z(t,e,i){var n,r,o,s,a,l,h,c=this,u={},d=t.style,f=t.nodeType&&Nt(t),p=St.get(t,"fxshow");i.queue||(a=ot._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,c.always(function(){c.always(function(){a.unqueued--,ot.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],h=ot.css(t,"display"),"inline"===("none"===h?St.get(t,"olddisplay")||T(t.nodeName):h)&&"none"===ot.css(t,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",c.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(n in e)if(r=e[n],oe.exec(r)){if(delete e[n],o=o||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!p||p[n]===undefined)continue;f=!0}u[n]=p&&p[n]||ot.style(t,n)}else h=undefined;if(ot.isEmptyObject(u))"inline"===("none"===h?T(t.nodeName):h)&&(d.display=h);else{p?"hidden"in p&&(f=p.hidden):p=St.access(t,"fxshow",{}),o&&(p.hidden=!f),f?ot(t).show():c.done(function(){ot(t).hide()}),c.done(function(){var e;St.remove(t,"fxshow");for(e in u)ot.style(t,e,u[e])});for(n in u)s=O(f?p[n]:0,n,c),n in p||(p[n]=s.start,f&&(s.end=s.start,s.start="width"===n||"height"===n?1:0))}}function H(t,e){var i,n,r,o,s;for(i in t)if(n=ot.camelCase(i),r=e[n],o=t[i],ot.isArray(o)&&(r=o[1],o=t[i]=o[0]),i!==n&&(t[n]=o,delete t[i]),(s=ot.cssHooks[n])&&"expand"in s){o=s.expand(o),delete t[n];for(i in o)i in t||(t[i]=o[i],e[i]=r)}else e[n]=r}function F(t,e,i){var n,r,o=0,s=F.prefilters.length,a=ot.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var e=ne||A(),i=Math.max(0,h.startTime+h.duration-e),n=i/h.duration||0,o=1-n,s=0,l=h.tweens.length;s<l;s++)h.tweens[s].run(o);return a.notifyWith(t,[h,o,i]),o<1&&l?i:(a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:ot.extend({},e),opts:ot.extend(!0,{specialEasing:{},easing:ot.easing._default},i),originalProperties:e,originalOptions:i,startTime:ne||A(),duration:i.duration,tweens:[],createTween:function(e,i){var n=ot.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(n),n},stop:function(e){var i=0,n=e?h.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)h.tweens[i].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),c=h.props;for(H(c,h.opts.specialEasing);o<s;o++)if(n=F.prefilters[o].call(h,t,c,h.opts))return ot.isFunction(n.stop)&&(ot._queueHooks(h.elem,h.opts.queue).stop=ot.proxy(n.stop,n)),n;return ot.map(c,O,h),ot.isFunction(h.opts.start)&&h.opts.start.call(t,h),ot.fx.timer(ot.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function B(t){return t.getAttribute&&t.getAttribute("class")||""}function $(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,o=e.toLowerCase().match(_t)||[];if(ot.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function j(t,e,i,n){function r(a){var l;return o[a]=!0,ot.each(t[a]||[],function(t,a){var h=a(e,i,n);return"string"!=typeof h||s||o[h]?s?!(l=h):void 0:(e.dataTypes.unshift(h),r(h),!1)}),l}var o={},s=t===Te;return r(e.dataTypes[0])||!o["*"]&&r("*")}function W(t,e){var i,n,r=ot.ajaxSettings.flatOptions||{};for(i in e)e[i]!==undefined&&((r[i]?t:n||(n={}))[i]=e[i]);return n&&ot.extend(!0,t,n),t}function q(t,e,i){for(var n,r,o,s,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),n===undefined&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(r in a)if(a[r]&&a[r].test(n)){l.unshift(r);break}if(l[0]in i)o=l[0];else{for(r in i){if(!l[0]||t.converters[r+" "+l[0]]){o=r;break}s||(s=r)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}function U(t,e,i,n){var r,o,s,a,l,h={},c=t.dataTypes.slice();if(c[1])for(s in t.converters)h[s.toLowerCase()]=t.converters[s];for(o=c.shift();o;)if(t.responseFields[o]&&(i[t.responseFields[o]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(s=h[l+" "+o]||h["* "+o]))for(r in h)if(a=r.split(" "),a[1]===o&&(s=h[l+" "+a[0]]||h["* "+a[0]])){!0===s?s=h[r]:!0!==h[r]&&(o=a[0],c.unshift(a[1]));break}if(!0!==s)if(s&&t["throws"])e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+l+" to "+o}}}return{state:"success",data:e}}function V(t,e,i,n){var r;if(ot.isArray(e))ot.each(e,function(e,r){i||De.test(t)?n(t,r):V(t+"["+("object"==typeof r&&null!=r?e:"")+"]",r,i,n)});else if(i||"object"!==ot.type(e))n(t,e);else for(r in e)V(t+"["+r+"]",e[r],i,n)}function G(t){return ot.isWindow(t)?t:9===t.nodeType&&t.defaultView}var Z=[],K=t.document,Y=Z.slice,X=Z.concat,J=Z.push,Q=Z.indexOf,tt={},et=tt.toString,it=tt.hasOwnProperty,nt={},rt="2.2.4",ot=function(t,e){return new ot.fn.init(t,e)},st=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,at=/^-ms-/,lt=/-([\da-z])/gi,ht=function(t,e){return e.toUpperCase()};ot.fn=ot.prototype={jquery:rt,constructor:ot,selector:"",length:0,toArray:function(){return Y.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:Y.call(this)},pushStack:function(t){var e=ot.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return ot.each(this,t)},map:function(t){return this.pushStack(ot.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(Y.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:J,sort:Z.sort,splice:Z.splice},ot.extend=ot.fn.extend=function(){var t,e,i,n,r,o,s=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[a]||{},a++),"object"==typeof s||ot.isFunction(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)i=s[e],n=t[e],s!==n&&(h&&n&&(ot.isPlainObject(n)||(r=ot.isArray(n)))?(r?(r=!1,o=i&&ot.isArray(i)?i:[]):o=i&&ot.isPlainObject(i)?i:{},s[e]=ot.extend(h,o,n)):n!==undefined&&(s[e]=n));return s},ot.extend({expando:"jQuery"+(rt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===ot.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=t&&t.toString();return!ot.isArray(t)&&e-parseFloat(e)+1>=0},isPlainObject:function(t){var e;if("object"!==ot.type(t)||t.nodeType||ot.isWindow(t))return!1;if(t.constructor&&!it.call(t,"constructor")&&!it.call(t.constructor.prototype||{},"isPrototypeOf"))return!1;for(e in t);return e===undefined||it.call(t,e)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?tt[et.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;(t=ot.trim(t))&&(1===t.indexOf("use strict")?(e=K.createElement("script"),e.text=t,K.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(at,"ms-").replace(lt,ht)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var n,r=0;if(i(t))for(n=t.length;r<n&&!1!==e.call(t[r],r,t[r]);r++);else for(r in t)if(!1===e.call(t[r],r,t[r]))break;return t},trim:function(t){return null==t?"":(t+"").replace(st,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?ot.merge(n,"string"==typeof t?[t]:t):J.call(n,t)),n},inArray:function(t,e,i){return null==e?-1:Q.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;n<i;n++)t[r++]=e[n];return t.length=r,t},grep:function(t,e,i){for(var n=[],r=0,o=t.length,s=!i;r<o;r++)!e(t[r],r)!==s&&n.push(t[r]);return n},map:function(t,e,n){var r,o,s=0,a=[];if(i(t))for(r=t.length;s<r;s++)null!=(o=e(t[s],s,n))&&a.push(o);else for(s in t)null!=(o=e(t[s],s,n))&&a.push(o);return X.apply([],a)},guid:1,proxy:function(t,e){var i,n,r;return"string"==typeof e&&(i=t[e],e=t,t=i),ot.isFunction(t)?(n=Y.call(arguments,2),r=function(){return t.apply(e||this,n.concat(Y.call(arguments)))},r.guid=t.guid=t.guid||ot.guid++,r):undefined},now:Date.now,support:nt}),"function"==typeof Symbol&&(ot.fn[Symbol.iterator]=Z[Symbol.iterator]),ot.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){tt["[object "+e+"]"]=e.toLowerCase()});var ct=function(t){function e(t,e,i,n){var r,o,s,a,l,h,u,f,p=e&&e.ownerDocument,g=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==g&&9!==g&&11!==g)return i;if(!n&&((e?e.ownerDocument||e:B)!==M&&N(e),e=e||M,A)){if(11!==g&&(h=vt.exec(t)))if(r=h[1]){if(9===g){if(!(s=e.getElementById(r)))return i;if(s.id===r)return i.push(s),i}else if(p&&(s=p.getElementById(r))&&H(e,s)&&s.id===r)return i.push(s),i}else{if(h[2])return J.apply(i,e.getElementsByTagName(t)),i;if((r=h[3])&&w.getElementsByClassName&&e.getElementsByClassName)return J.apply(i,e.getElementsByClassName(r)),i}if(w.qsa&&!U[t+" "]&&(!R||!R.test(t))){if(1!==g)p=e,f=t;else if("object"!==e.nodeName.toLowerCase()){for((a=e.getAttribute("id"))?a=a.replace(bt,"\\$&"):e.setAttribute("id",a=F),u=T(t),o=u.length,l=dt.test(a)?"#"+a:"[id='"+a+"']";o--;)u[o]=l+" "+d(u[o]);f=u.join(","),p=yt.test(t)&&c(e.parentNode)||e}if(f)try{return J.apply(i,p.querySelectorAll(f)),i}catch(t){}finally{a===F&&e.removeAttribute("id")}}}return E(t.replace(at,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>x.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[F]=!0,t}function r(t){var e=M.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function o(t,e){for(var i=t.split("|"),n=i.length;n--;)x.attrHandle[i[n]]=e}function s(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||G)-(~t.sourceIndex||G);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function h(t){return n(function(e){return e=+e,n(function(i,n){for(var r,o=t([],i.length,e),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function u(){}function d(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function f(t,e,i){var n=e.dir,r=i&&"parentNode"===n,o=j++;return e.first?function(e,i,o){for(;e=e[n];)if(1===e.nodeType||r)return t(e,i,o)}:function(e,i,s){var a,l,h,c=[$,o];if(s){for(;e=e[n];)if((1===e.nodeType||r)&&t(e,i,s))return!0}else for(;e=e[n];)if(1===e.nodeType||r){if(h=e[F]||(e[F]={}),l=h[e.uniqueID]||(h[e.uniqueID]={}),(a=l[n])&&a[0]===$&&a[1]===o)return c[2]=a[2];if(l[n]=c,c[2]=t(e,i,s))return!0}}}function p(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function g(t,i,n){for(var r=0,o=i.length;r<o;r++)e(t,i[r],n);return n}function m(t,e,i,n,r){for(var o,s=[],a=0,l=t.length,h=null!=e;a<l;a++)(o=t[a])&&(i&&!i(o,n,r)||(s.push(o),h&&e.push(a)));return s}function v(t,e,i,r,o,s){return r&&!r[F]&&(r=v(r)),o&&!o[F]&&(o=v(o,s)),n(function(n,s,a,l){var h,c,u,d=[],f=[],p=s.length,v=n||g(e||"*",a.nodeType?[a]:a,[]),y=!t||!n&&e?v:m(v,d,t,a,l),b=i?o||(n?t:p||r)?[]:s:y;if(i&&i(y,b,a,l),r)for(h=m(b,f),r(h,[],a,l),c=h.length;c--;)(u=h[c])&&(b[f[c]]=!(y[f[c]]=u));if(n){if(o||t){if(o){for(h=[],c=b.length;c--;)(u=b[c])&&h.push(y[c]=u);o(null,b=[],h,l)}for(c=b.length;c--;)(u=b[c])&&(h=o?tt(n,u):d[c])>-1&&(n[h]=!(s[h]=u))}}else b=m(b===s?b.splice(p,b.length):b),o?o(null,s,b,l):J.apply(s,b)})}function y(t){for(var e,i,n,r=t.length,o=x.relative[t[0].type],s=o||x.relative[" "],a=o?1:0,l=f(function(t){return t===e},s,!0),h=f(function(t){return tt(e,t)>-1},s,!0),c=[function(t,i,n){var r=!o&&(n||i!==P)||((e=i).nodeType?l(t,i,n):h(t,i,n));return e=null,r}];a<r;a++)if(i=x.relative[t[a].type])c=[f(p(c),i)];else{if(i=x.filter[t[a].type].apply(null,t[a].matches),i[F]){for(n=++a;n<r&&!x.relative[t[n].type];n++);return v(a>1&&p(c),a>1&&d(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(at,"$1"),i,a<n&&y(t.slice(a,n)),n<r&&y(t=t.slice(n)),n<r&&d(t))}c.push(i)}return p(c)}function b(t,i){var r=i.length>0,o=t.length>0,s=function(n,s,a,l,h){var c,u,d,f=0,p="0",g=n&&[],v=[],y=P,b=n||o&&x.find.TAG("*",h),_=$+=null==y?1:Math.random()||.1,w=b.length;for(h&&(P=s===M||s||h);p!==w&&null!=(c=b[p]);p++){if(o&&c){for(u=0,s||c.ownerDocument===M||(N(c),a=!A);d=t[u++];)if(d(c,s||M,a)){l.push(c);break}h&&($=_)}r&&((c=!d&&c)&&f--,n&&g.push(c))}if(f+=p,r&&p!==f){for(u=0;d=i[u++];)d(g,v,s,a);if(n){if(f>0)for(;p--;)g[p]||v[p]||(v[p]=Y.call(l));v=m(v)}J.apply(l,v),h&&!n&&v.length>0&&f+i.length>1&&e.uniqueSort(l)}return h&&($=_,P=y),g};return r?n(s):s}var _,w,x,C,S,T,k,E,P,D,I,N,M,L,A,R,O,z,H,F="sizzle"+1*new Date,B=t.document,$=0,j=0,W=i(),q=i(),U=i(),V=function(t,e){return t===e&&(I=!0),0},G=1<<31,Z={}.hasOwnProperty,K=[],Y=K.pop,X=K.push,J=K.push,Q=K.slice,tt=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",rt="\\["+it+"*("+nt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+nt+"))|)"+it+"*\\]",ot=":("+nt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+rt+")*)|.*)\\)|)",st=new RegExp(it+"+","g"),at=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),lt=new RegExp("^"+it+"*,"+it+"*"),ht=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ct=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),ut=new RegExp(ot),dt=new RegExp("^"+nt+"$"),ft={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt+"|[*])"),ATTR:new RegExp("^"+rt),PSEUDO:new RegExp("^"+ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},pt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,mt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,bt=/'|\\/g,_t=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),wt=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},xt=function(){N()};try{J.apply(K=Q.call(B.childNodes),B.childNodes),K[B.childNodes.length].nodeType}catch(t){J={apply:K.length?function(t,e){X.apply(t,Q.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}w=e.support={},S=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},N=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:B;return n!==M&&9===n.nodeType&&n.documentElement?(M=n,L=M.documentElement,A=!S(M),(i=M.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",xt,!1):i.attachEvent&&i.attachEvent("onunload",xt)),w.attributes=r(function(t){return t.className="i",!t.getAttribute("className")}),w.getElementsByTagName=r(function(t){return t.appendChild(M.createComment("")),!t.getElementsByTagName("*").length}),w.getElementsByClassName=mt.test(M.getElementsByClassName),w.getById=r(function(t){return L.appendChild(t).id=F,!M.getElementsByName||!M.getElementsByName(F).length}),w.getById?(x.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&A){var i=e.getElementById(t);return i?[i]:[]}},x.filter.ID=function(t){var e=t.replace(_t,wt);return function(t){return t.getAttribute("id")===e}}):(delete x.find.ID,x.filter.ID=function(t){var e=t.replace(_t,wt);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),x.find.TAG=w.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):w.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,o=e.getElementsByTagName(t);if("*"===t){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},x.find.CLASS=w.getElementsByClassName&&function(t,e){if("undefined"!=typeof e.getElementsByClassName&&A)return e.getElementsByClassName(t)},O=[],R=[],(w.qsa=mt.test(M.querySelectorAll))&&(r(function(t){L.appendChild(t).innerHTML="<a id='"+F+"'></a><select id='"+F+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&R.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||R.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+F+"-]").length||R.push("~="),t.querySelectorAll(":checked").length||R.push(":checked"),t.querySelectorAll("a#"+F+"+*").length||R.push(".#.+[+~]")}),r(function(t){var e=M.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&R.push("name"+it+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||R.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),R.push(",.*:")})),(w.matchesSelector=mt.test(z=L.matches||L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&r(function(t){w.disconnectedMatch=z.call(t,"div"),z.call(t,"[s!='']:x"),O.push("!=",ot)}),R=R.length&&new RegExp(R.join("|")),O=O.length&&new RegExp(O.join("|")),e=mt.test(L.compareDocumentPosition),H=e||mt.test(L.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},V=e?function(t,e){if(t===e)return I=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!w.sortDetached&&e.compareDocumentPosition(t)===i?t===M||t.ownerDocument===B&&H(B,t)?-1:e===M||e.ownerDocument===B&&H(B,e)?1:D?tt(D,t)-tt(D,e):0:4&i?-1:1)}:function(t,e){if(t===e)return I=!0,0;var i,n=0,r=t.parentNode,o=e.parentNode,a=[t],l=[e];if(!r||!o)return t===M?-1:e===M?1:r?-1:o?1:D?tt(D,t)-tt(D,e):0;if(r===o)return s(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;a[n]===l[n];)n++;return n?s(a[n],l[n]):a[n]===B?-1:l[n]===B?1:0},M):M},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==M&&N(t),i=i.replace(ct,"='$1']"),w.matchesSelector&&A&&!U[i+" "]&&(!O||!O.test(i))&&(!R||!R.test(i)))try{var n=z.call(t,i);if(n||w.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return e(i,M,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==M&&N(t),H(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==M&&N(t);var i=x.attrHandle[e.toLowerCase()],n=i&&Z.call(x.attrHandle,e.toLowerCase())?i(t,e,!A):undefined;return n!==undefined?n:w.attributes||!A?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,r=0;if(I=!w.detectDuplicates,D=!w.sortStable&&t.slice(0),t.sort(V),I){for(;e=t[r++];)e===t[r]&&(n=i.push(r));for(;n--;)t.splice(i[n],1)}return D=null,t},C=e.getText=function(t){var e,i="",n=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=C(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[n++];)i+=C(e);return i},x=e.selectors={cacheLength:50,createPseudo:n,match:ft,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(_t,wt),t[3]=(t[3]||t[4]||t[5]||"").replace(_t,wt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return ft.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&ut.test(i)&&(e=T(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(_t,wt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=W[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&W(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(r){var o=e.attr(r,t);return null==o?"!="===i:!i||(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o.replace(st," ")+" ").indexOf(n)>-1:"|="===i&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,i,n,r){var o="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,l){var h,c,u,d,f,p,g=o!==s?"nextSibling":"previousSibling",m=e.parentNode,v=a&&e.nodeName.toLowerCase(),y=!l&&!a,b=!1;if(m){if(o){for(;g;){for(d=e;d=d[g];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;p=g="only"===t&&!p&&"nextSibling"}return!0}if(p=[s?m.firstChild:m.lastChild],s&&y){for(d=m,u=d[F]||(d[F]={}),c=u[d.uniqueID]||(u[d.uniqueID]={}),h=c[t]||[],f=h[0]===$&&h[1],b=f&&h[2],d=f&&m.childNodes[f];d=++f&&d&&d[g]||(b=f=0)||p.pop();)if(1===d.nodeType&&++b&&d===e){c[t]=[$,f,b];break}}else if(y&&(d=e,u=d[F]||(d[F]={}),c=u[d.uniqueID]||(u[d.uniqueID]={}),h=c[t]||[],f=h[0]===$&&h[1],b=f),!1===b)for(;(d=++f&&d&&d[g]||(b=f=0)||p.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++b||(y&&(u=d[F]||(d[F]={}),c=u[d.uniqueID]||(u[d.uniqueID]={}),c[t]=[$,b]),d!==e)););return(b-=r)===n||b%n==0&&b/n>=0}}},PSEUDO:function(t,i){var r,o=x.pseudos[t]||x.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return o[F]?o(i):o.length>1?(r=[t,t,"",i],x.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,r=o(t,i),s=r.length;s--;)n=tt(t,r[s]),t[n]=!(e[n]=r[s])}):function(t){return o(t,0,r)}):o}},pseudos:{not:n(function(t){var e=[],i=[],r=k(t.replace(at,"$1"));return r[F]?n(function(t,e,i,n){for(var o,s=r(t,null,n,[]),a=t.length;a--;)(o=s[a])&&(t[a]=!(e[a]=o))}):function(t,n,o){return e[0]=t,r(e,null,o,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return t=t.replace(_t,wt),function(e){return(e.textContent||e.innerText||C(e)).indexOf(t)>-1}}),lang:n(function(t){return dt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(_t,wt).toLowerCase(),function(e){var i;do{if(i=A?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===L},focus:function(t){return t===M.activeElement&&(!M.hasFocus||M.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!x.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return pt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:h(function(){return[0]}),last:h(function(t,e){return[e-1]}),eq:h(function(t,e,i){return[i<0?i+e:i]}),even:h(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:h(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:h(function(t,e,i){for(var n=i<0?i+e:i;--n>=0;)t.push(n);return t}),gt:h(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}},x.pseudos.nth=x.pseudos.eq;for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[_]=a(_);for(_ in{submit:!0,reset:!0})x.pseudos[_]=l(_);return u.prototype=x.filters=x.pseudos,x.setFilters=new u,
T=e.tokenize=function(t,i){var n,r,o,s,a,l,h,c=q[t+" "];if(c)return i?0:c.slice(0);for(a=t,l=[],h=x.preFilter;a;){n&&!(r=lt.exec(a))||(r&&(a=a.slice(r[0].length)||a),l.push(o=[])),n=!1,(r=ht.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(at," ")}),a=a.slice(n.length));for(s in x.filter)!(r=ft[s].exec(a))||h[s]&&!(r=h[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return i?a.length:a?e.error(t):q(t,l).slice(0)},k=e.compile=function(t,e){var i,n=[],r=[],o=U[t+" "];if(!o){for(e||(e=T(t)),i=e.length;i--;)o=y(e[i]),o[F]?n.push(o):r.push(o);o=U(t,b(r,n)),o.selector=t}return o},E=e.select=function(t,e,i,n){var r,o,s,a,l,h="function"==typeof t&&t,u=!n&&T(t=h.selector||t);if(i=i||[],1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&w.getById&&9===e.nodeType&&A&&x.relative[o[1].type]){if(!(e=(x.find.ID(s.matches[0].replace(_t,wt),e)||[])[0]))return i;h&&(e=e.parentNode),t=t.slice(o.shift().value.length)}for(r=ft.needsContext.test(t)?0:o.length;r--&&(s=o[r],!x.relative[a=s.type]);)if((l=x.find[a])&&(n=l(s.matches[0].replace(_t,wt),yt.test(o[0].type)&&c(e.parentNode)||e))){if(o.splice(r,1),!(t=n.length&&d(o)))return J.apply(i,n),i;break}}return(h||k(t,u))(n,e,!A,i,!e||yt.test(t)&&c(e.parentNode)||e),i},w.sortStable=F.split("").sort(V).join("")===F,w.detectDuplicates=!!I,N(),w.sortDetached=r(function(t){return 1&t.compareDocumentPosition(M.createElement("div"))}),r(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||o("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),w.attributes&&r(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||o("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),r(function(t){return null==t.getAttribute("disabled")})||o(et,function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);ot.find=ct,ot.expr=ct.selectors,ot.expr[":"]=ot.expr.pseudos,ot.uniqueSort=ot.unique=ct.uniqueSort,ot.text=ct.getText,ot.isXMLDoc=ct.isXML,ot.contains=ct.contains;var ut=function(t,e,i){for(var n=[],r=i!==undefined;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&ot(t).is(i))break;n.push(t)}return n},dt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},ft=ot.expr.match.needsContext,pt=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,gt=/^.[^:#\[\.,]*$/;ot.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?ot.find.matchesSelector(n,t)?[n]:[]:ot.find.matches(t,ot.grep(e,function(t){return 1===t.nodeType}))},ot.fn.extend({find:function(t){var e,i=this.length,n=[],r=this;if("string"!=typeof t)return this.pushStack(ot(t).filter(function(){for(e=0;e<i;e++)if(ot.contains(r[e],this))return!0}));for(e=0;e<i;e++)ot.find(t,r[e],n);return n=this.pushStack(i>1?ot.unique(n):n),n.selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(n(this,t||[],!1))},not:function(t){return this.pushStack(n(this,t||[],!0))},is:function(t){return!!n(this,"string"==typeof t&&ft.test(t)?ot(t):t||[],!1).length}});var mt,vt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(ot.fn.init=function(t,e,i){var n,r;if(!t)return this;if(i=i||mt,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:vt.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof ot?e[0]:e,ot.merge(this,ot.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:K,!0)),pt.test(n[1])&&ot.isPlainObject(e))for(n in e)ot.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return r=K.getElementById(n[2]),r&&r.parentNode&&(this.length=1,this[0]=r),this.context=K,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):ot.isFunction(t)?i.ready!==undefined?i.ready(t):t(ot):(t.selector!==undefined&&(this.selector=t.selector,this.context=t.context),ot.makeArray(t,this))}).prototype=ot.fn,mt=ot(K);var yt=/^(?:parents|prev(?:Until|All))/,bt={children:!0,contents:!0,next:!0,prev:!0};ot.fn.extend({has:function(t){var e=ot(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(ot.contains(this,e[t]))return!0})},closest:function(t,e){for(var i,n=0,r=this.length,o=[],s=ft.test(t)||"string"!=typeof t?ot(t,e||this.context):0;n<r;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&ot.find.matchesSelector(i,t))){o.push(i);break}return this.pushStack(o.length>1?ot.uniqueSort(o):o)},index:function(t){return t?"string"==typeof t?Q.call(ot(t),this[0]):Q.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(ot.uniqueSort(ot.merge(this.get(),ot(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),ot.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return ut(t,"parentNode")},parentsUntil:function(t,e,i){return ut(t,"parentNode",i)},next:function(t){return r(t,"nextSibling")},prev:function(t){return r(t,"previousSibling")},nextAll:function(t){return ut(t,"nextSibling")},prevAll:function(t){return ut(t,"previousSibling")},nextUntil:function(t,e,i){return ut(t,"nextSibling",i)},prevUntil:function(t,e,i){return ut(t,"previousSibling",i)},siblings:function(t){return dt((t.parentNode||{}).firstChild,t)},children:function(t){return dt(t.firstChild)},contents:function(t){return t.contentDocument||ot.merge([],t.childNodes)}},function(t,e){ot.fn[t]=function(i,n){var r=ot.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=ot.filter(n,r)),this.length>1&&(bt[t]||ot.uniqueSort(r),yt.test(t)&&r.reverse()),this.pushStack(r)}});var _t=/\S+/g;ot.Callbacks=function(t){t="string"==typeof t?o(t):ot.extend({},t);var e,i,n,r,s=[],a=[],l=-1,h=function(){for(r=t.once,n=e=!0;a.length;l=-1)for(i=a.shift();++l<s.length;)!1===s[l].apply(i[0],i[1])&&t.stopOnFalse&&(l=s.length,i=!1);t.memory||(i=!1),e=!1,r&&(s=i?[]:"")},c={add:function(){return s&&(i&&!e&&(l=s.length-1,a.push(i)),function e(i){ot.each(i,function(i,n){ot.isFunction(n)?t.unique&&c.has(n)||s.push(n):n&&n.length&&"string"!==ot.type(n)&&e(n)})}(arguments),i&&!e&&h()),this},remove:function(){return ot.each(arguments,function(t,e){for(var i;(i=ot.inArray(e,s,i))>-1;)s.splice(i,1),i<=l&&l--}),this},has:function(t){return t?ot.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=a=[],s=i="",this},disabled:function(){return!s},lock:function(){return r=a=[],i||(s=i=""),this},locked:function(){return!!r},fireWith:function(t,i){return r||(i=i||[],i=[t,i.slice?i.slice():i],a.push(i),e||h()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},ot.extend({Deferred:function(t){var e=[["resolve","done",ot.Callbacks("once memory"),"resolved"],["reject","fail",ot.Callbacks("once memory"),"rejected"],["notify","progress",ot.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return ot.Deferred(function(i){ot.each(e,function(e,o){var s=ot.isFunction(t[e])&&t[e];r[o[1]](function(){var t=s&&s.apply(this,arguments);t&&ot.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[o[0]+"With"](this===n?i.promise():this,s?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?ot.extend(t,n):n}},r={};return n.pipe=n.then,ot.each(e,function(t,o){var s=o[2],a=o[3];n[o[1]]=s.add,a&&s.add(function(){i=a},e[1^t][2].disable,e[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=s.fireWith}),n.promise(r),t&&t.call(r,r),r},when:function(t){var e,i,n,r=0,o=Y.call(arguments),s=o.length,a=1!==s||t&&ot.isFunction(t.promise)?s:0,l=1===a?t:ot.Deferred(),h=function(t,i,n){return function(r){i[t]=this,n[t]=arguments.length>1?Y.call(arguments):r,n===e?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(s>1)for(e=new Array(s),i=new Array(s),n=new Array(s);r<s;r++)o[r]&&ot.isFunction(o[r].promise)?o[r].promise().progress(h(r,i,e)).done(h(r,n,o)).fail(l.reject):--a;return a||l.resolveWith(n,o),l.promise()}});var wt;ot.fn.ready=function(t){return ot.ready.promise().done(t),this},ot.extend({isReady:!1,readyWait:1,holdReady:function(t){t?ot.readyWait++:ot.ready(!0)},ready:function(t){(!0===t?--ot.readyWait:ot.isReady)||(ot.isReady=!0,!0!==t&&--ot.readyWait>0||(wt.resolveWith(K,[ot]),ot.fn.triggerHandler&&(ot(K).triggerHandler("ready"),ot(K).off("ready"))))}}),ot.ready.promise=function(e){return wt||(wt=ot.Deferred(),"complete"===K.readyState||"loading"!==K.readyState&&!K.documentElement.doScroll?t.setTimeout(ot.ready):(K.addEventListener("DOMContentLoaded",s),t.addEventListener("load",s))),wt.promise(e)},ot.ready.promise();var xt=function(t,e,i,n,r,o,s){var a=0,l=t.length,h=null==i;if("object"===ot.type(i)){r=!0;for(a in i)xt(t,e,a,i[a],!0,o,s)}else if(n!==undefined&&(r=!0,ot.isFunction(n)||(s=!0),h&&(s?(e.call(t,n),e=null):(h=e,e=function(t,e,i){return h.call(ot(t),i)})),e))for(;a<l;a++)e(t[a],i,s?n:n.call(t[a],a,e(t[a],i)));return r?t:h?e.call(t):l?e(t[0],i):o},Ct=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};a.uid=1,a.prototype={register:function(t,e){var i=e||{};return t.nodeType?t[this.expando]=i:Object.defineProperty(t,this.expando,{value:i,writable:!0,configurable:!0}),t[this.expando]},cache:function(t){if(!Ct(t))return{};var e=t[this.expando];return e||(e={},Ct(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,r=this.cache(t);if("string"==typeof e)r[e]=i;else for(n in e)r[n]=e[n];return r},get:function(t,e){return e===undefined?this.cache(t):t[this.expando]&&t[this.expando][e]},access:function(t,e,i){var n;return e===undefined||e&&"string"==typeof e&&i===undefined?(n=this.get(t,e),n!==undefined?n:this.get(t,ot.camelCase(e))):(this.set(t,e,i),i!==undefined?i:e)},remove:function(t,e){var i,n,r,o=t[this.expando];if(o!==undefined){if(e===undefined)this.register(t);else{ot.isArray(e)?n=e.concat(e.map(ot.camelCase)):(r=ot.camelCase(e),e in o?n=[e,r]:(n=r,n=n in o?[n]:n.match(_t)||[])),i=n.length;for(;i--;)delete o[n[i]]}(e===undefined||ot.isEmptyObject(o))&&(t.nodeType?t[this.expando]=undefined:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return e!==undefined&&!ot.isEmptyObject(e)}};var St=new a,Tt=new a,kt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Et=/[A-Z]/g;ot.extend({hasData:function(t){return Tt.hasData(t)||St.hasData(t)},data:function(t,e,i){return Tt.access(t,e,i)},removeData:function(t,e){Tt.remove(t,e)},_data:function(t,e,i){return St.access(t,e,i)},_removeData:function(t,e){St.remove(t,e)}}),ot.fn.extend({data:function(t,e){var i,n,r,o=this[0],s=o&&o.attributes;if(t===undefined){if(this.length&&(r=Tt.get(o),1===o.nodeType&&!St.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(n=s[i].name,0===n.indexOf("data-")&&(n=ot.camelCase(n.slice(5)),l(o,n,r[n])));St.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each(function(){Tt.set(this,t)}):xt(this,function(e){var i,n;if(o&&e===undefined){if((i=Tt.get(o,t)||Tt.get(o,t.replace(Et,"-$&").toLowerCase()))!==undefined)return i;if(n=ot.camelCase(t),(i=Tt.get(o,n))!==undefined)return i;if((i=l(o,n,undefined))!==undefined)return i}else n=ot.camelCase(t),this.each(function(){var i=Tt.get(this,n);Tt.set(this,n,e),t.indexOf("-")>-1&&i!==undefined&&Tt.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Tt.remove(this,t)})}}),ot.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=St.get(t,e),i&&(!n||ot.isArray(i)?n=St.access(t,e,ot.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=ot.queue(t,e),n=i.length,r=i.shift(),o=ot._queueHooks(t,e),s=function(){ot.dequeue(t,e)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete o.stop,r.call(t,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return St.get(t,i)||St.access(t,i,{empty:ot.Callbacks("once memory").add(function(){St.remove(t,[e+"queue",i])})})}}),ot.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?ot.queue(this[0],t):e===undefined?this:this.each(function(){var i=ot.queue(this,t,e);ot._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&ot.dequeue(this,t)})},dequeue:function(t){return this.each(function(){ot.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=ot.Deferred(),o=this,s=this.length,a=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=undefined),t=t||"fx";s--;)(i=St.get(o[s],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(e)}});var Pt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Dt=new RegExp("^(?:([+-])=|)("+Pt+")([a-z%]*)$","i"),It=["Top","Right","Bottom","Left"],Nt=function(t,e){return t=e||t,"none"===ot.css(t,"display")||!ot.contains(t.ownerDocument,t)},Mt=/^(?:checkbox|radio)$/i,Lt=/<([\w:-]+)/,At=/^$|\/(?:java|ecma)script/i,Rt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Rt.optgroup=Rt.option,Rt.tbody=Rt.tfoot=Rt.colgroup=Rt.caption=Rt.thead,Rt.th=Rt.td;var Ot=/<|&#?\w+;/;!function(){var t=K.createDocumentFragment(),e=t.appendChild(K.createElement("div")),i=K.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),nt.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",nt.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var zt=/^key/,Ht=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ft=/^([^.]*)(?:\.(.+)|)/;ot.event={global:{},add:function(t,e,i,n,r){var o,s,a,l,h,c,u,d,f,p,g,m=St.get(t);if(m)for(i.handler&&(o=i,i=o.handler,r=o.selector),i.guid||(i.guid=ot.guid++),(l=m.events)||(l=m.events={}),(s=m.handle)||(s=m.handle=function(e){return void 0!==ot&&ot.event.triggered!==e.type?ot.event.dispatch.apply(t,arguments):undefined}),e=(e||"").match(_t)||[""],h=e.length;h--;)a=Ft.exec(e[h])||[],f=g=a[1],p=(a[2]||"").split(".").sort(),f&&(u=ot.event.special[f]||{},f=(r?u.delegateType:u.bindType)||f,u=ot.event.special[f]||{},c=ot.extend({type:f,origType:g,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&ot.expr.match.needsContext.test(r),namespace:p.join(".")},o),(d=l[f])||(d=l[f]=[],d.delegateCount=0,u.setup&&!1!==u.setup.call(t,n,p,s)||t.addEventListener&&t.addEventListener(f,s)),u.add&&(u.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,c):d.push(c),ot.event.global[f]=!0)},remove:function(t,e,i,n,r){var o,s,a,l,h,c,u,d,f,p,g,m=St.hasData(t)&&St.get(t);if(m&&(l=m.events)){for(e=(e||"").match(_t)||[""],h=e.length;h--;)if(a=Ft.exec(e[h])||[],f=g=a[1],p=(a[2]||"").split(".").sort(),f){for(u=ot.event.special[f]||{},f=(n?u.delegateType:u.bindType)||f,d=l[f]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=d.length;o--;)c=d[o],!r&&g!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(d.splice(o,1),c.selector&&d.delegateCount--,u.remove&&u.remove.call(t,c));s&&!d.length&&(u.teardown&&!1!==u.teardown.call(t,p,m.handle)||ot.removeEvent(t,f,m.handle),delete l[f])}else for(f in l)ot.event.remove(t,f+e[h],i,n,!0);ot.isEmptyObject(l)&&St.remove(t,"handle events")}},dispatch:function(t){t=ot.event.fix(t);var e,i,n,r,o,s=[],a=Y.call(arguments),l=(St.get(this,"events")||{})[t.type]||[],h=ot.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,t)){for(s=ot.event.handlers.call(this,t,l),e=0;(r=s[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,i=0;(o=r.handlers[i++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(o.namespace)||(t.handleObj=o,t.data=o.data,(n=((ot.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,a))!==undefined&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,r,o,s=[],a=e.delegateCount,l=t.target;if(a&&l.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(!0!==l.disabled||"click"!==t.type)){for(n=[],i=0;i<a;i++)o=e[i],r=o.selector+" ",n[r]===undefined&&(n[r]=o.needsContext?ot(r,this).index(l)>-1:ot.find(r,this,null,[l]).length),n[r]&&n.push(o);n.length&&s.push({elem:l,handlers:n})}return a<e.length&&s.push({elem:this,handlers:e.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,r,o=e.button;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||K,n=i.documentElement,r=i.body,t.pageX=e.clientX+(n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0),t.pageY=e.clientY+(n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0)),t.which||o===undefined||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[ot.expando])return t;var e,i,n,r=t.type,o=t,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Ht.test(r)?this.mouseHooks:zt.test(r)?this.keyHooks:{}),n=s.props?this.props.concat(s.props):this.props,t=new ot.Event(o),e=n.length;e--;)i=n[e],t[i]=o[i];return t.target||(t.target=K),3===t.target.nodeType&&(t.target=t.target.parentNode),s.filter?s.filter(t,o):t},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==g()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===g()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&ot.nodeName(this,"input"))return this.click(),!1},_default:function(t){return ot.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){t.result!==undefined&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},ot.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},ot.Event=function(t,e){if(!(this instanceof ot.Event))return new ot.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.defaultPrevented===undefined&&!1===t.returnValue?f:p):this.type=t,e&&ot.extend(this,e),this.timeStamp=t&&t.timeStamp||ot.now(),this[ot.expando]=!0},ot.Event.prototype={constructor:ot.Event,isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=f,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=f,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=f,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},ot.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){ot.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,r=t.relatedTarget,o=t.handleObj;return r&&(r===n||ot.contains(n,r))||(t.type=o.origType,i=o.handler.apply(this,arguments),t.type=e),i}}}),ot.fn.extend({on:function(t,e,i,n){return m(this,t,e,i,n)},one:function(t,e,i,n){return m(this,t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,ot(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=undefined),!1===i&&(i=p),this.each(function(){ot.event.remove(this,t,i,e)})}});var Bt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,$t=/<script|<style|<link/i,jt=/checked\s*(?:[^=]|=\s*.checked.)/i,Wt=/^true\/(.*)/,qt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;ot.extend({htmlPrefilter:function(t){return t.replace(Bt,"<$1></$2>")},clone:function(t,e,i){var n,r,o,s,a=t.cloneNode(!0),l=ot.contains(t.ownerDocument,t);if(!(nt.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||ot.isXMLDoc(t)))for(s=c(a),o=c(t),n=0,r=o.length;n<r;n++)w(o[n],s[n]);if(e)if(i)for(o=o||c(t),s=s||c(a),n=0,r=o.length;n<r;n++)_(o[n],s[n]);else _(t,a);return s=c(a,"script"),s.length>0&&u(s,!l&&c(t,"script")),a},cleanData:function(t){for(var e,i,n,r=ot.event.special,o=0;(i=t[o])!==undefined;o++)if(Ct(i)){if(e=i[St.expando]){if(e.events)for(n in e.events)r[n]?ot.event.remove(i,n):ot.removeEvent(i,n,e.handle);i[St.expando]=undefined}i[Tt.expando]&&(i[Tt.expando]=undefined)}}}),ot.fn.extend({domManip:x,detach:function(t){return C(this,t,!0)},remove:function(t){return C(this,t)},text:function(t){return xt(this,function(t){return t===undefined?ot.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return x(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){v(this,t).appendChild(t)}})},prepend:function(){return x(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return x(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return x(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(ot.cleanData(c(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return ot.clone(this,t,e)})},html:function(t){return xt(this,function(t){var e=this[0]||{},i=0,n=this.length;if(t===undefined&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!$t.test(t)&&!Rt[(Lt.exec(t)||["",""])[1].toLowerCase()]){t=ot.htmlPrefilter(t);try{for(;i<n;i++)e=this[i]||{},1===e.nodeType&&(ot.cleanData(c(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return x(this,arguments,function(e){var i=this.parentNode;ot.inArray(this,t)<0&&(ot.cleanData(c(this)),i&&i.replaceChild(e,this))},t)}}),ot.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){ot.fn[t]=function(t){for(var i,n=[],r=ot(t),o=r.length-1,s=0;s<=o;s++)i=s===o?this:this.clone(!0),ot(r[s])[e](i),J.apply(n,i.get());return this.pushStack(n)}});var Ut,Vt={HTML:"block",BODY:"block"},Gt=/^margin/,Zt=new RegExp("^("+Pt+")(?!px)[a-z%]+$","i"),Kt=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Yt=function(t,e,i,n){var r,o,s={};for(o in e)s[o]=t.style[o],t.style[o]=e[o];r=i.apply(t,n||[]);for(o in e)t.style[o]=s[o];return r},Xt=K.documentElement;!function(){function e(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Xt.appendChild(s);var e=t.getComputedStyle(a);i="1%"!==e.top,o="2px"===e.marginLeft,n="4px"===e.width,a.style.marginRight="50%",r="4px"===e.marginRight,Xt.removeChild(s)}var i,n,r,o,s=K.createElement("div"),a=K.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",nt.clearCloneStyle="content-box"===a.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(a),ot.extend(nt,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return null==n&&e(),n},pixelMarginRight:function(){return null==n&&e(),r},reliableMarginLeft:function(){return null==n&&e(),o},reliableMarginRight:function(){var e,i=a.appendChild(K.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",Xt.appendChild(s),e=!parseFloat(t.getComputedStyle(i).marginRight),Xt.removeChild(s),a.removeChild(i),e}}))}();var Jt=/^(none|table(?!-c[ea]).+)/,Qt={position:"absolute",visibility:"hidden",display:"block"},te={letterSpacing:"0",fontWeight:"400"},ee=["Webkit","O","Moz","ms"],ie=K.createElement("div").style;ot.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=k(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,o,s,a=ot.camelCase(e),l=t.style;if(e=ot.cssProps[a]||(ot.cssProps[a]=P(a)||a),s=ot.cssHooks[e]||ot.cssHooks[a],i===undefined)return s&&"get"in s&&(r=s.get(t,!1,n))!==undefined?r:l[e];o=typeof i,"string"===o&&(r=Dt.exec(i))&&r[1]&&(i=h(t,e,r),o="number"),null!=i&&i===i&&("number"===o&&(i+=r&&r[3]||(ot.cssNumber[a]?"":"px")),nt.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),s&&"set"in s&&(i=s.set(t,i,n))===undefined||(l[e]=i))}},css:function(t,e,i,n){var r,o,s,a=ot.camelCase(e);return e=ot.cssProps[a]||(ot.cssProps[a]=P(a)||a),s=ot.cssHooks[e]||ot.cssHooks[a],s&&"get"in s&&(r=s.get(t,!0,i)),r===undefined&&(r=k(t,e,n)),"normal"===r&&e in te&&(r=te[e]),""===i||i?(o=parseFloat(r),!0===i||isFinite(o)?o||0:r):r}}),ot.each(["height","width"],function(t,e){ot.cssHooks[e]={get:function(t,i,n){if(i)return Jt.test(ot.css(t,"display"))&&0===t.offsetWidth?Yt(t,Qt,function(){return N(t,e,n)}):N(t,e,n)},set:function(t,i,n){var r,o=n&&Kt(t),s=n&&I(t,e,n,"border-box"===ot.css(t,"boxSizing",!1,o),o);return s&&(r=Dt.exec(i))&&"px"!==(r[3]||"px")&&(t.style[e]=i,i=ot.css(t,e)),D(t,i,s)}}}),ot.cssHooks.marginLeft=E(nt.reliableMarginLeft,function(t,e){if(e)return(parseFloat(k(t,"marginLeft"))||t.getBoundingClientRect().left-Yt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),ot.cssHooks.marginRight=E(nt.reliableMarginRight,function(t,e){if(e)return Yt(t,{display:"inline-block"},k,[t,"marginRight"])}),ot.each({margin:"",padding:"",border:"Width"},function(t,e){ot.cssHooks[t+e]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];n<4;n++)r[t+It[n]+e]=o[n]||o[n-2]||o[0];return r}},Gt.test(t)||(ot.cssHooks[t+e].set=D)}),ot.fn.extend({css:function(t,e){return xt(this,function(t,e,i){var n,r,o={},s=0;if(ot.isArray(e)){for(n=Kt(t),r=e.length;s<r;s++)o[e[s]]=ot.css(t,e[s],!1,n);return o}return i!==undefined?ot.style(t,e,i):ot.css(t,e)},t,e,arguments.length>1)},show:function(){return M(this,!0)},hide:function(){return M(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Nt(this)?ot(this).show():ot(this).hide()})}}),ot.Tween=L,L.prototype={constructor:L,init:function(t,e,i,n,r,o){this.elem=t,this.prop=i,this.easing=r||ot.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=o||(ot.cssNumber[i]?"":"px")},cur:function(){var t=L.propHooks[this.prop];return t&&t.get?t.get(this):L.propHooks._default.get(this)},run:function(t){var e,i=L.propHooks[this.prop];return this.options.duration?this.pos=e=ot.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):L.propHooks._default.set(this),this}},L.prototype.init.prototype=L.prototype,L.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=ot.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){ot.fx.step[t.prop]?ot.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[ot.cssProps[t.prop]]&&!ot.cssHooks[t.prop]?t.elem[t.prop]=t.now:ot.style(t.elem,t.prop,t.now+t.unit)}}},L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},ot.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},ot.fx=L.prototype.init,ot.fx.step={};var ne,re,oe=/^(?:toggle|show|hide)$/,se=/queueHooks$/;ot.Animation=ot.extend(F,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return h(i.elem,t,Dt.exec(e),i),i}]},tweener:function(t,e){ot.isFunction(t)?(e=t,t=["*"]):t=t.match(_t);for(var i,n=0,r=t.length;n<r;n++)i=t[n],F.tweeners[i]=F.tweeners[i]||[],F.tweeners[i].unshift(e)},prefilters:[z],prefilter:function(t,e){e?F.prefilters.unshift(t):F.prefilters.push(t)}}),ot.speed=function(t,e,i){var n=t&&"object"==typeof t?ot.extend({},t):{complete:i||!i&&e||ot.isFunction(t)&&t,duration:t,easing:i&&e||e&&!ot.isFunction(e)&&e};return n.duration=ot.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in ot.fx.speeds?ot.fx.speeds[n.duration]:ot.fx.speeds._default,null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){ot.isFunction(n.old)&&n.old.call(this),n.queue&&ot.dequeue(this,n.queue)},n},ot.fn.extend({fadeTo:function(t,e,i,n){return this.filter(Nt).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=ot.isEmptyObject(t),o=ot.speed(e,i,n),s=function(){var e=F(this,ot.extend({},t),o);(r||St.get(this,"finish"))&&e.stop(!0)};return s.finish=s,r||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=undefined),e&&!1!==t&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",o=ot.timers,s=St.get(this);if(r)s[r]&&s[r].stop&&n(s[r]);else for(r in s)s[r]&&s[r].stop&&se.test(r)&&n(s[r]);for(r=o.length;r--;)o[r].elem!==this||null!=t&&o[r].queue!==t||(o[r].anim.stop(i),e=!1,o.splice(r,1));!e&&i||ot.dequeue(this,t)})},finish:function(t){return!1!==t&&(t=t||"fx"),this.each(function(){var e,i=St.get(this),n=i[t+"queue"],r=i[t+"queueHooks"],o=ot.timers,s=n?n.length:0;for(i.finish=!0,ot.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;e<s;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),ot.each(["toggle","show","hide"],function(t,e){var i=ot.fn[e];ot.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(R(e,!0),t,n,r)}}),ot.each({slideDown:R("show"),slideUp:R("hide"),slideToggle:R("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){ot.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),ot.timers=[],ot.fx.tick=function(){var t,e=0,i=ot.timers;for(ne=ot.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||ot.fx.stop(),ne=undefined},ot.fx.timer=function(t){ot.timers.push(t),t()?ot.fx.start():ot.timers.pop()},ot.fx.interval=13,ot.fx.start=function(){re||(re=t.setInterval(ot.fx.tick,ot.fx.interval))},ot.fx.stop=function(){t.clearInterval(re),re=null},ot.fx.speeds={slow:600,fast:200,_default:400},ot.fn.delay=function(e,i){return e=ot.fx?ot.fx.speeds[e]||e:e,i=i||"fx",this.queue(i,function(i,n){var r=t.setTimeout(i,e);n.stop=function(){t.clearTimeout(r)}})},function(){var t=K.createElement("input"),e=K.createElement("select"),i=e.appendChild(K.createElement("option"));t.type="checkbox",nt.checkOn=""!==t.value,nt.optSelected=i.selected,e.disabled=!0,nt.optDisabled=!i.disabled,t=K.createElement("input"),t.value="t",t.type="radio",nt.radioValue="t"===t.value}();var ae,le=ot.expr.attrHandle;ot.fn.extend({attr:function(t,e){return xt(this,ot.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){ot.removeAttr(this,t)})}}),ot.extend({attr:function(t,e,i){var n,r,o=t.nodeType
;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof t.getAttribute?ot.prop(t,e,i):(1===o&&ot.isXMLDoc(t)||(e=e.toLowerCase(),r=ot.attrHooks[e]||(ot.expr.match.bool.test(e)?ae:undefined)),i!==undefined?null===i?void ot.removeAttr(t,e):r&&"set"in r&&(n=r.set(t,i,e))!==undefined?n:(t.setAttribute(e,i+""),i):r&&"get"in r&&null!==(n=r.get(t,e))?n:(n=ot.find.attr(t,e),null==n?undefined:n))},attrHooks:{type:{set:function(t,e){if(!nt.radioValue&&"radio"===e&&ot.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n,r=0,o=e&&e.match(_t);if(o&&1===t.nodeType)for(;i=o[r++];)n=ot.propFix[i]||i,ot.expr.match.bool.test(i)&&(t[n]=!1),t.removeAttribute(i)}}),ae={set:function(t,e,i){return!1===e?ot.removeAttr(t,i):t.setAttribute(i,i),i}},ot.each(ot.expr.match.bool.source.match(/\w+/g),function(t,e){var i=le[e]||ot.find.attr;le[e]=function(t,e,n){var r,o;return n||(o=le[e],le[e]=r,r=null!=i(t,e,n)?e.toLowerCase():null,le[e]=o),r}});var he=/^(?:input|select|textarea|button)$/i,ce=/^(?:a|area)$/i;ot.fn.extend({prop:function(t,e){return xt(this,ot.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[ot.propFix[t]||t]})}}),ot.extend({prop:function(t,e,i){var n,r,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ot.isXMLDoc(t)||(e=ot.propFix[e]||e,r=ot.propHooks[e]),i!==undefined?r&&"set"in r&&(n=r.set(t,i,e))!==undefined?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=ot.find.attr(t,"tabindex");return e?parseInt(e,10):he.test(t.nodeName)||ce.test(t.nodeName)&&t.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),nt.optSelected||(ot.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),ot.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ot.propFix[this.toLowerCase()]=this});var ue=/[\t\r\n\f]/g;ot.fn.extend({addClass:function(t){var e,i,n,r,o,s,a,l=0;if(ot.isFunction(t))return this.each(function(e){ot(this).addClass(t.call(this,e,B(this)))});if("string"==typeof t&&t)for(e=t.match(_t)||[];i=this[l++];)if(r=B(i),n=1===i.nodeType&&(" "+r+" ").replace(ue," ")){for(s=0;o=e[s++];)n.indexOf(" "+o+" ")<0&&(n+=o+" ");a=ot.trim(n),r!==a&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,n,r,o,s,a,l=0;if(ot.isFunction(t))return this.each(function(e){ot(this).removeClass(t.call(this,e,B(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(_t)||[];i=this[l++];)if(r=B(i),n=1===i.nodeType&&(" "+r+" ").replace(ue," ")){for(s=0;o=e[s++];)for(;n.indexOf(" "+o+" ")>-1;)n=n.replace(" "+o+" "," ");a=ot.trim(n),r!==a&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):ot.isFunction(t)?this.each(function(i){ot(this).toggleClass(t.call(this,i,B(this),e),e)}):this.each(function(){var e,n,r,o;if("string"===i)for(n=0,r=ot(this),o=t.match(_t)||[];e=o[n++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else t!==undefined&&"boolean"!==i||(e=B(this),e&&St.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":St.get(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+B(i)+" ").replace(ue," ").indexOf(e)>-1)return!0;return!1}});var de=/\r/g,fe=/[\x20\t\r\n\f]+/g;ot.fn.extend({val:function(t){var e,i,n,r=this[0];{if(arguments.length)return n=ot.isFunction(t),this.each(function(i){var r;1===this.nodeType&&(r=n?t.call(this,i,ot(this).val()):t,null==r?r="":"number"==typeof r?r+="":ot.isArray(r)&&(r=ot.map(r,function(t){return null==t?"":t+""})),(e=ot.valHooks[this.type]||ot.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&e.set(this,r,"value")!==undefined||(this.value=r))});if(r)return(e=ot.valHooks[r.type]||ot.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&(i=e.get(r,"value"))!==undefined?i:(i=r.value,"string"==typeof i?i.replace(de,""):null==i?"":i)}}}),ot.extend({valHooks:{option:{get:function(t){var e=ot.find.attr(t,"value");return null!=e?e:ot.trim(ot.text(t)).replace(fe," ")}},select:{get:function(t){for(var e,i,n=t.options,r=t.selectedIndex,o="select-one"===t.type||r<0,s=o?null:[],a=o?r+1:n.length,l=r<0?a:o?r:0;l<a;l++)if(i=n[l],(i.selected||l===r)&&(nt.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!ot.nodeName(i.parentNode,"optgroup"))){if(e=ot(i).val(),o)return e;s.push(e)}return s},set:function(t,e){for(var i,n,r=t.options,o=ot.makeArray(e),s=r.length;s--;)n=r[s],(n.selected=ot.inArray(ot.valHooks.option.get(n),o)>-1)&&(i=!0);return i||(t.selectedIndex=-1),o}}}}),ot.each(["radio","checkbox"],function(){ot.valHooks[this]={set:function(t,e){if(ot.isArray(e))return t.checked=ot.inArray(ot(t).val(),e)>-1}},nt.checkOn||(ot.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var pe=/^(?:focusinfocus|focusoutblur)$/;ot.extend(ot.event,{trigger:function(e,i,n,r){var o,s,a,l,h,c,u,d=[n||K],f=it.call(e,"type")?e.type:e,p=it.call(e,"namespace")?e.namespace.split("."):[];if(s=a=n=n||K,3!==n.nodeType&&8!==n.nodeType&&!pe.test(f+ot.event.triggered)&&(f.indexOf(".")>-1&&(p=f.split("."),f=p.shift(),p.sort()),h=f.indexOf(":")<0&&"on"+f,e=e[ot.expando]?e:new ot.Event(f,"object"==typeof e&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),i=null==i?[e]:ot.makeArray(i,[e]),u=ot.event.special[f]||{},r||!u.trigger||!1!==u.trigger.apply(n,i))){if(!r&&!u.noBubble&&!ot.isWindow(n)){for(l=u.delegateType||f,pe.test(l+f)||(s=s.parentNode);s;s=s.parentNode)d.push(s),a=s;a===(n.ownerDocument||K)&&d.push(a.defaultView||a.parentWindow||t)}for(o=0;(s=d[o++])&&!e.isPropagationStopped();)e.type=o>1?l:u.bindType||f,c=(St.get(s,"events")||{})[e.type]&&St.get(s,"handle"),c&&c.apply(s,i),(c=h&&s[h])&&c.apply&&Ct(s)&&(e.result=c.apply(s,i),!1===e.result&&e.preventDefault());return e.type=f,r||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(d.pop(),i)||!Ct(n)||h&&ot.isFunction(n[f])&&!ot.isWindow(n)&&(a=n[h],a&&(n[h]=null),ot.event.triggered=f,n[f](),ot.event.triggered=undefined,a&&(n[h]=a)),e.result}},simulate:function(t,e,i){var n=ot.extend(new ot.Event,i,{type:t,isSimulated:!0});ot.event.trigger(n,null,e)}}),ot.fn.extend({trigger:function(t,e){return this.each(function(){ot.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return ot.event.trigger(t,e,i,!0)}}),ot.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){ot.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),ot.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),nt.focusin="onfocusin"in t,nt.focusin||ot.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){ot.event.simulate(e,t.target,ot.event.fix(t))};ot.event.special[e]={setup:function(){var n=this.ownerDocument||this,r=St.access(n,e);r||n.addEventListener(t,i,!0),St.access(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=St.access(n,e)-1;r?St.access(n,e,r):(n.removeEventListener(t,i,!0),St.remove(n,e))}}});var ge=t.location,me=ot.now(),ve=/\?/;ot.parseJSON=function(t){return JSON.parse(t+"")},ot.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=undefined}return i&&!i.getElementsByTagName("parsererror").length||ot.error("Invalid XML: "+e),i};var ye=/#.*$/,be=/([?&])_=[^&]*/,_e=/^(.*?):[ \t]*([^\r\n]*)$/gm,we=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,xe=/^(?:GET|HEAD)$/,Ce=/^\/\//,Se={},Te={},ke="*/".concat("*"),Ee=K.createElement("a");Ee.href=ge.href,ot.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ge.href,type:"GET",isLocal:we.test(ge.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ke,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ot.parseJSON,"text xml":ot.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?W(W(t,ot.ajaxSettings),e):W(ot.ajaxSettings,t)},ajaxPrefilter:$(Se),ajaxTransport:$(Te),ajax:function(e,i){function n(e,i,n,a){var h,u,y,b,w,C=i;2!==_&&(_=2,l&&t.clearTimeout(l),r=undefined,s=a||"",x.readyState=e>0?4:0,h=e>=200&&e<300||304===e,n&&(b=q(d,x,n)),b=U(d,b,x,h),h?(d.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(ot.lastModified[o]=w),(w=x.getResponseHeader("etag"))&&(ot.etag[o]=w)),204===e||"HEAD"===d.type?C="nocontent":304===e?C="notmodified":(C=b.state,u=b.data,y=b.error,h=!y)):(y=C,!e&&C||(C="error",e<0&&(e=0))),x.status=e,x.statusText=(i||C)+"",h?g.resolveWith(f,[u,C,x]):g.rejectWith(f,[x,C,y]),x.statusCode(v),v=undefined,c&&p.trigger(h?"ajaxSuccess":"ajaxError",[x,d,h?u:y]),m.fireWith(f,[x,C]),c&&(p.trigger("ajaxComplete",[x,d]),--ot.active||ot.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=undefined),i=i||{};var r,o,s,a,l,h,c,u,d=ot.ajaxSetup({},i),f=d.context||d,p=d.context&&(f.nodeType||f.jquery)?ot(f):ot.event,g=ot.Deferred(),m=ot.Callbacks("once memory"),v=d.statusCode||{},y={},b={},_=0,w="canceled",x={readyState:0,getResponseHeader:function(t){var e;if(2===_){if(!a)for(a={};e=_e.exec(s);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===_?s:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return _||(t=b[i]=b[i]||t,y[t]=e),this},overrideMimeType:function(t){return _||(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(_<2)for(e in t)v[e]=[v[e],t[e]];else x.always(t[x.status]);return this},abort:function(t){var e=t||w;return r&&r.abort(e),n(0,e),this}};if(g.promise(x).complete=m.add,x.success=x.done,x.error=x.fail,d.url=((e||d.url||ge.href)+"").replace(ye,"").replace(Ce,ge.protocol+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=ot.trim(d.dataType||"*").toLowerCase().match(_t)||[""],null==d.crossDomain){h=K.createElement("a");try{h.href=d.url,h.href=h.href,d.crossDomain=Ee.protocol+"//"+Ee.host!=h.protocol+"//"+h.host}catch(t){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=ot.param(d.data,d.traditional)),j(Se,d,i,x),2===_)return x;c=ot.event&&d.global,c&&0==ot.active++&&ot.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!xe.test(d.type),o=d.url,d.hasContent||(d.data&&(o=d.url+=(ve.test(o)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=be.test(o)?o.replace(be,"$1_="+me++):o+(ve.test(o)?"&":"?")+"_="+me++)),d.ifModified&&(ot.lastModified[o]&&x.setRequestHeader("If-Modified-Since",ot.lastModified[o]),ot.etag[o]&&x.setRequestHeader("If-None-Match",ot.etag[o])),(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&x.setRequestHeader("Content-Type",d.contentType),x.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+ke+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)x.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(!1===d.beforeSend.call(f,x,d)||2===_))return x.abort();w="abort";for(u in{success:1,error:1,complete:1})x[u](d[u]);if(r=j(Te,d,i,x)){if(x.readyState=1,c&&p.trigger("ajaxSend",[x,d]),2===_)return x;d.async&&d.timeout>0&&(l=t.setTimeout(function(){x.abort("timeout")},d.timeout));try{_=1,r.send(y,n)}catch(t){if(!(_<2))throw t;n(-1,t)}}else n(-1,"No Transport");return x},getJSON:function(t,e,i){return ot.get(t,e,i,"json")},getScript:function(t,e){return ot.get(t,undefined,e,"script")}}),ot.each(["get","post"],function(t,e){ot[e]=function(t,i,n,r){return ot.isFunction(i)&&(r=r||n,n=i,i=undefined),ot.ajax(ot.extend({url:t,type:e,dataType:r,data:i,success:n},ot.isPlainObject(t)&&t))}}),ot._evalUrl=function(t){return ot.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},ot.fn.extend({wrapAll:function(t){var e;return ot.isFunction(t)?this.each(function(e){ot(this).wrapAll(t.call(this,e))}):(this[0]&&(e=ot(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return ot.isFunction(t)?this.each(function(e){ot(this).wrapInner(t.call(this,e))}):this.each(function(){var e=ot(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=ot.isFunction(t);return this.each(function(i){ot(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){ot.nodeName(this,"body")||ot(this).replaceWith(this.childNodes)}).end()}}),ot.expr.filters.hidden=function(t){return!ot.expr.filters.visible(t)},ot.expr.filters.visible=function(t){return t.offsetWidth>0||t.offsetHeight>0||t.getClientRects().length>0};var Pe=/%20/g,De=/\[\]$/,Ie=/\r?\n/g,Ne=/^(?:submit|button|image|reset|file)$/i,Me=/^(?:input|select|textarea|keygen)/i;ot.param=function(t,e){var i,n=[],r=function(t,e){e=ot.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(e===undefined&&(e=ot.ajaxSettings&&ot.ajaxSettings.traditional),ot.isArray(t)||t.jquery&&!ot.isPlainObject(t))ot.each(t,function(){r(this.name,this.value)});else for(i in t)V(i,t[i],e,r);return n.join("&").replace(Pe,"+")},ot.fn.extend({serialize:function(){return ot.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=ot.prop(this,"elements");return t?ot.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!ot(this).is(":disabled")&&Me.test(this.nodeName)&&!Ne.test(t)&&(this.checked||!Mt.test(t))}).map(function(t,e){var i=ot(this).val();return null==i?null:ot.isArray(i)?ot.map(i,function(t){return{name:e.name,value:t.replace(Ie,"\r\n")}}):{name:e.name,value:i.replace(Ie,"\r\n")}}).get()}}),ot.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var Le={0:200,1223:204},Ae=ot.ajaxSettings.xhr();nt.cors=!!Ae&&"withCredentials"in Ae,nt.ajax=Ae=!!Ae,ot.ajaxTransport(function(e){var i,n;if(nt.cors||Ae&&!e.crossDomain)return{send:function(r,o){var s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(s in e.xhrFields)a[s]=e.xhrFields[s];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");for(s in r)a.setRequestHeader(s,r[s]);i=function(t){return function(){i&&(i=n=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(Le[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),n=a.onerror=i("error"),a.onabort!==undefined?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout(function(){i&&n()})},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}}),ot.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return ot.globalEval(t),t}}}),ot.ajaxPrefilter("script",function(t){t.cache===undefined&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),ot.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(n,r){e=ot("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&r("error"===t.type?404:200,t.type)}),K.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Re=[],Oe=/(=)\?(?=&|$)|\?\?/;ot.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Re.pop()||ot.expando+"_"+me++;return this[t]=!0,t}}),ot.ajaxPrefilter("json jsonp",function(e,i,n){var r,o,s,a=!1!==e.jsonp&&(Oe.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Oe.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=ot.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Oe,"$1"+r):!1!==e.jsonp&&(e.url+=(ve.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||ot.error(r+" was not called"),s[0]},e.dataTypes[0]="json",o=t[r],t[r]=function(){s=arguments},n.always(function(){o===undefined?ot(t).removeProp(r):t[r]=o,e[r]&&(e.jsonpCallback=i.jsonpCallback,Re.push(r)),s&&ot.isFunction(o)&&o(s[0]),s=o=undefined}),"script"}),ot.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||K;var n=pt.exec(t),r=!i&&[];return n?[e.createElement(n[1])]:(n=d([t],e,r),r&&r.length&&ot(r).remove(),ot.merge([],n.childNodes))};var ze=ot.fn.load;ot.fn.load=function(t,e,i){if("string"!=typeof t&&ze)return ze.apply(this,arguments);var n,r,o,s=this,a=t.indexOf(" ");return a>-1&&(n=ot.trim(t.slice(a)),t=t.slice(0,a)),ot.isFunction(e)?(i=e,e=undefined):e&&"object"==typeof e&&(r="POST"),s.length>0&&ot.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done(function(t){o=arguments,s.html(n?ot("<div>").append(ot.parseHTML(t)).find(n):t)}).always(i&&function(t,e){s.each(function(){i.apply(this,o||[t.responseText,e,t])})}),this},ot.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){ot.fn[e]=function(t){return this.on(e,t)}}),ot.expr.filters.animated=function(t){return ot.grep(ot.timers,function(e){return t===e.elem}).length},ot.offset={setOffset:function(t,e,i){var n,r,o,s,a,l,h,c=ot.css(t,"position"),u=ot(t),d={};"static"===c&&(t.style.position="relative"),a=u.offset(),o=ot.css(t,"top"),l=ot.css(t,"left"),h=("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1,h?(n=u.position(),s=n.top,r=n.left):(s=parseFloat(o)||0,r=parseFloat(l)||0),ot.isFunction(e)&&(e=e.call(t,i,ot.extend({},a))),null!=e.top&&(d.top=e.top-a.top+s),null!=e.left&&(d.left=e.left-a.left+r),"using"in e?e.using.call(t,d):u.css(d)}},ot.fn.extend({offset:function(t){if(arguments.length)return t===undefined?this:this.each(function(e){ot.offset.setOffset(this,t,e)});var e,i,n=this[0],r={top:0,left:0},o=n&&n.ownerDocument;if(o)return e=o.documentElement,ot.contains(e,n)?(r=n.getBoundingClientRect(),i=G(o),{top:r.top+i.pageYOffset-e.clientTop,left:r.left+i.pageXOffset-e.clientLeft}):r},position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===ot.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),ot.nodeName(t[0],"html")||(n=t.offset()),n.top+=ot.css(t[0],"borderTopWidth",!0),n.left+=ot.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-ot.css(i,"marginTop",!0),left:e.left-n.left-ot.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===ot.css(t,"position");)t=t.offsetParent;return t||Xt})}}),ot.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;ot.fn[t]=function(n){return xt(this,function(t,n,r){var o=G(t);if(r===undefined)return o?o[e]:t[n];o?o.scrollTo(i?o.pageXOffset:r,i?r:o.pageYOffset):t[n]=r},t,n,arguments.length)}}),ot.each(["top","left"],function(t,e){ot.cssHooks[e]=E(nt.pixelPosition,function(t,i){if(i)return i=k(t,e),Zt.test(i)?ot(t).position()[e]+"px":i})}),ot.each({Height:"height",Width:"width"},function(t,e){ot.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){ot.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),s=i||(!0===n||!0===r?"margin":"border");return xt(this,function(e,i,n){var r;return ot.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):n===undefined?ot.css(e,i,s):ot.style(e,i,n,s)},e,o?n:undefined,o,null)}})}),ot.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},size:function(){return this.length}}),ot.fn.andSelf=ot.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ot});var He=t.jQuery,Fe=t.$;return ot.noConflict=function(e){return t.$===ot&&(t.$=Fe),e&&t.jQuery===ot&&(t.jQuery=He),ot},e||(t.jQuery=t.$=ot),ot}),function(t,e){"use strict";t.rails!==e&&t.error("jquery-ujs has already been loaded!");var i,n=t(document);t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not([form]):not(form button), button[data-confirm]:not([form]):not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]), textarea[name][required]:not([disabled])",fileInputSelector:"input[name][type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return t("meta[name=csrf-token]").attr("content")},csrfParam:function(){return t("meta[name=csrf-param]").attr("content")},CSRFProtection:function(t){var e=i.csrfToken();e&&t.setRequestHeader("X-CSRF-Token",e)},refreshCSRFTokens:function(){t('form input[name="'+i.csrfParam()+'"]').val(i.csrfToken())},fire:function(e,i,n){var r=t.Event(i);return e.trigger(r,n),!1!==r.result},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t[0].href},isRemote:function(t){return t.data("remote")!==e&&!1!==t.data("remote")},handleRemote:function(n){var r,o,s,a,l,h;if(i.fire(n,"ajax:before")){if(a=n.data("with-credentials")||null,l=n.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,n.is("form")){r=n.data("ujs:submit-button-formmethod")||n.attr("method"),o=n.data("ujs:submit-button-formaction")||n.attr("action"),s=t(n[0]).serializeArray();var c=n.data("ujs:submit-button");c&&(s.push(c),n.data("ujs:submit-button",null)),n.data("ujs:submit-button-formmethod",null),n.data("ujs:submit-button-formaction",null)}else n.is(i.inputChangeSelector)?(r=n.data("method"),o=n.data("url"),s=n.serialize(),n.data("params")&&(s=s+"&"+n.data("params"))):n.is(i.buttonClickSelector)?(r=n.data("method")||"get",o=n.data("url"),s=n.serialize(),n.data("params")&&(s=s+"&"+n.data("params"))):(r=n.data("method"),o=i.href(n),s=n.data("params")||null);return h={type:r||"GET",data:s,dataType:l,beforeSend:function(t,r){if(r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),!i.fire(n,"ajax:beforeSend",[t,r]))return!1;n.trigger("ajax:send",t)},success:function(t,e,i){n.trigger("ajax:success",[t,e,i])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,i){n.trigger("ajax:error",[t,e,i])},crossDomain:i.isCrossDomain(o)},a&&(h.xhrFields={withCredentials:a}),o&&(h.url=o),i.ajax(h)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var i=document.createElement("a");try{return i.href=t,i.href=i.href,!((!i.protocol||":"===i.protocol)&&!i.host||e.protocol+"//"+e.host==i.protocol+"//"+i.host)}catch(t){return!0}},handleMethod:function(n){var r=i.href(n),o=n.data("method"),s=n.attr("target"),a=i.csrfToken(),l=i.csrfParam(),h=t('<form method="post" action="'+r+'"></form>'),c='<input name="_method" value="'+o+'" type="hidden" />';l===e||a===e||i.isCrossDomain(r)||(c+='<input name="'+l+'" value="'+a+'" type="hidden" />'),s&&h.attr("target",s),h.hide().append(c).appendTo("body"),h.submit()},formElements:function(e,i){return e.is("form")?t(e[0].elements).filter(i):e.find(i)},disableFormElements:function(e){i.formElements(e,i.disableSelector).each(function(){i.disableFormElement(t(this))})},disableFormElement:function(t){var i,n;i=t.is("button")?"html":"val",n=t.data("disable-with"),n!==e&&(t.data("ujs:enable-with",t[i]()),t[i](n)),t.prop("disabled",!0),t.data("ujs:disabled",!0)},enableFormElements:function(e){i.formElements(e,i.enableSelector).each(function(){i.enableFormElement(t(this))})},enableFormElement:function(t){var i=t.is("button")?"html":"val";t.data("ujs:enable-with")!==e&&(t[i](t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.prop("disabled",!1),t.removeData("ujs:disabled")},allowAction:function(t){var e,n=t.data("confirm"),r=!1;if(!n)return!0;if(i.fire(t,"confirm")){try{r=i.confirm(n)}catch(t){(console.error||console.log).call(console,t.stack||t)}e=i.fire(t,"confirm:complete",[r])}return r&&e},blankInputs:function(e,i,n){var r,o,s,a,l=t(),h=i||"input,textarea",c=e.find(h),u={};return c.each(function(){r=t(this),r.is("input[type=radio]")?(a=r.attr("name"),u[a]||(0===e.find('input[type=radio]:checked[name="'+a+'"]').length&&(s=e.find('input[type=radio][name="'+a+'"]'),l=l.add(s)),u[a]=a)):(o=r.is("input[type=checkbox],input[type=radio]")?r.is(":checked"):!!r.val())===n&&(l=l.add(r))}),!!l.length&&l},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var n=t.data("disable-with");n!==e&&(t.data("ujs:enable-with",t.html()),t.html(n)),t.bind("click.railsDisable",function(t){return i.stopEverything(t)}),t.data("ujs:disabled",!0)},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable"),t.removeData("ujs:disabled")}},i.fire(n,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,n){t.crossDomain||i.CSRFProtection(n)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:disabled")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:disabled")&&t.rails.enableElement(e)})}),n.on("ajax:complete",i.linkDisableSelector,function(){i.enableElement(t(this))}),n.on("ajax:complete",i.buttonDisableSelector,function(){i.enableFormElement(t(this))}),n.on("click.rails",i.linkClickSelector,function(e){var n=t(this),r=n.data("method"),o=n.data("params"),s=e.metaKey||e.ctrlKey;if(!i.allowAction(n))return i.stopEverything(e);if(!s&&n.is(i.linkDisableSelector)&&i.disableElement(n),i.isRemote(n)){if(s&&(!r||"GET"===r)&&!o)return!0;var a=i.handleRemote(n);return!1===a?i.enableElement(n):a.fail(function(){i.enableElement(n)}),!1}return r?(i.handleMethod(n),!1):void 0}),n.on("click.rails",i.buttonClickSelector,function(e){var n=t(this);if(!i.allowAction(n)||!i.isRemote(n))return i.stopEverything(e);n.is(i.buttonDisableSelector)&&i.disableFormElement(n);var r=i.handleRemote(n);return!1===r?i.enableFormElement(n):r.fail(function(){i.enableFormElement(n)}),!1}),n.on("change.rails",i.inputChangeSelector,function(e){var n=t(this);return i.allowAction(n)&&i.isRemote(n)?(i.handleRemote(n),!1):i.stopEverything(e)}),n.on("submit.rails",i.formSubmitSelector,function(n){var r,o,s=t(this),a=i.isRemote(s);if(!i.allowAction(s))return i.stopEverything(n);if(s.attr("novalidate")===e)if(s.data("ujs:formnovalidate-button")===e){if((r=i.blankInputs(s,i.requiredInputSelector,!1))&&i.fire(s,"ajax:aborted:required",[r]))return i.stopEverything(n)}else s.data("ujs:formnovalidate-button",e);if(a){if(o=i.nonBlankInputs(s,i.fileInputSelector)){setTimeout(function(){i.disableFormElements(s)},13);var l=i.fire(s,"ajax:aborted:file",[o]);return l||setTimeout(function(){i.enableFormElements(s)},13),l}return i.handleRemote(s),!1}setTimeout(function(){i.disableFormElements(s)},13)}),n.on("click.rails",i.formInputClickSelector,function(e){var n=t(this);if(!i.allowAction(n))return i.stopEverything(e);var r=n.attr("name"),o=r?{name:r,value:n.val()}:null,s=n.closest("form");0===s.length&&(s=t("#"+n.attr("form"))),s.data("ujs:submit-button",o),s.data("ujs:formnovalidate-button",n.attr("formnovalidate")),s.data("ujs:submit-button-formaction",n.attr("formaction")),s.data("ujs:submit-button-formmethod",n.attr("formmethod"))}),n.on("ajax:send.rails",i.formSubmitSelector,function(e){this===e.target&&i.disableFormElements(t(this))}),n.on("ajax:complete.rails",i.formSubmitSelector,function(e){this===e.target&&i.enableFormElements(t(this))}),t(function(){i.refreshCSRFTokens()}))}(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(e,n){var r,o,s,a=e.nodeName.toLowerCase();return"area"===a?(r=e.parentNode,o=r.name,!(!e.href||!o||"map"!==r.nodeName.toLowerCase())&&(!!(s=t("img[usemap='#"+o+"']")[0])&&i(s))):(/^(input|select|textarea|button|object)$/.test(a)?!e.disabled:"a"===a?e.href||n:n)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}function n(t){for(var e,i;t.length&&t[0]!==document;){if(("absolute"===(e=t.css("position"))||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function r(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=o(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function o(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(i,"mouseout",function(){t(this).removeClass("ui-state-hover"),
-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",s)}function s(){t.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var n in i)null==i[n]&&(e[n]=i[n]);return e}function l(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.extend(t.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({scrollParent:function(e){var i=this.css("position"),n="absolute"===i,r=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return(!n||"static"!==e.css("position"))&&r.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,n){return!!t.data(e,n[3])},focusable:function(i){return e(i,!isNaN(t.attr(i,"tabindex")))},tabbable:function(i){var n=t.attr(i,"tabindex"),r=isNaN(n);return(r||n>=0)&&e(i,!r)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(e,i){function n(e,i,n,o){return t.each(r,function(){i-=parseFloat(t.css(e,"padding"+this))||0,n&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var r="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),s={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return e===undefined?s["inner"+i].call(this):this.each(function(){t(this).css(o,n(this,e)+"px")})},t.fn["outer"+i]=function(e,r){return"number"!=typeof e?s["outer"+i].call(this,e):this.each(function(){t(this).css(o,n(this,e,!0,r)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.fn.extend({focus:function(e){return function(i,n){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),n&&n.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(e!==undefined)return this.css("zIndex",e);if(this.length)for(var i,n,r=t(this[0]);r.length&&r[0]!==document;){if(("absolute"===(i=r.css("position"))||"relative"===i||"fixed"===i)&&(n=parseInt(r.css("zIndex"),10),!isNaN(n)&&0!==n))return n;r=r.parent()}return 0}}),t.ui.plugin={add:function(e,i,n){var r,o=t.ui[e].prototype;for(r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(t,e,i,n){var r,o=t.plugins[e];if(o&&(n||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(r=0;r<o.length;r++)t.options[o[r][0]]&&o[r][1].apply(t.element,i)}};var h=0,c=Array.prototype.slice;t.cleanData=function(e){return function(i){var n,r,o;for(o=0;null!=(r=i[o]);o++)try{n=t._data(r,"events"),n&&n.remove&&t(r).triggerHandler("remove")}catch(t){}e(i)}}(t.cleanData),t.widget=function(e,i,n){var r,o,s,a,l={},h=e.split(".")[0];return e=e.split(".")[1],r=h+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][r.toLowerCase()]=function(e){return!!t.data(e,r)},t[h]=t[h]||{},o=t[h][e],s=t[h][e]=function(t,e){if(!this._createWidget)return new s(t,e);arguments.length&&this._createWidget(t,e)},t.extend(s,o,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(n,function(e,n){if(!t.isFunction(n))return void(l[e]=n);l[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},r=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=r,e=n.apply(this,arguments),this._super=i,this._superApply=o,e}}()}),s.prototype=t.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix||e:e},l,{constructor:s,namespace:h,widgetName:e,widgetFullName:r}),o?(t.each(o._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete o._childConstructors):i._childConstructors.push(s),t.widget.bridge(e,s),s},t.widget.extend=function(e){for(var i,n,r=c.call(arguments,1),o=0,s=r.length;o<s;o++)for(i in r[o])n=r[o][i],r[o].hasOwnProperty(i)&&n!==undefined&&(t.isPlainObject(n)?e[i]=t.isPlainObject(e[i])?t.widget.extend({},e[i],n):t.widget.extend({},n):e[i]=n);return e},t.widget.bridge=function(e,i){var n=i.prototype.widgetFullName||e;t.fn[e]=function(r){var o="string"==typeof r,s=c.call(arguments,1),a=this;return o?this.each(function(){var i,o=t.data(this,n);return"instance"===r?(a=o,!1):o?t.isFunction(o[r])&&"_"!==r.charAt(0)?(i=o[r].apply(o,s),i!==o&&i!==undefined?(a=i&&i.jquery?a.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+r+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+r+"'")}):(s.length&&(r=t.widget.extend.apply(null,[r].concat(s))),this.each(function(){var e=t.data(this,n);e?(e.option(r||{}),e._init&&e._init()):t.data(this,n,new i(r,this))})),a}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var n,r,o,s=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(s={},n=e.split("."),e=n.shift(),n.length){for(r=s[e]=t.widget.extend({},this.options[e]),o=0;o<n.length-1;o++)r[n[o]]=r[n[o]]||{},r=r[n[o]];if(e=n.pop(),1===arguments.length)return r[e]===undefined?null:r[e];r[e]=i}else{if(1===arguments.length)return this.options[e]===undefined?null:this.options[e];s[e]=i}return this._setOptions(s),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,n){var r,o=this;"boolean"!=typeof e&&(n=i,i=e,e=!1),n?(i=r=t(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),t.each(n,function(n,s){function a(){if(e||!0!==o.options.disabled&&!t(this).hasClass("ui-state-disabled"))return("string"==typeof s?o[s]:s).apply(o,arguments)}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?r.delegate(c,h,a):i.bind(h,a)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(i).undelegate(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var r,o,s=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(t.isFunction(s)&&!1===s.apply(this.element[0],[i].concat(n))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?!0===r||"number"==typeof r?i:r.effect||i:e;r=r||{},"number"==typeof r&&(r={duration:r}),s=!t.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&t.effects&&t.effects.effect[a]?n[e](r):a!==e&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){t(this)[e](),o&&o.call(n[0]),i()})}});var u=(t.widget,!1);t(document).mouseup(function(){u=!1});t.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){if(!0===t.data(i.target,e.widgetName+".preventClickEvent"))return t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!u){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,n=1===e.which,r=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(n&&!r&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),u=!0,!0))}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);if(!e.which)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),u=!1,!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});!function(){function e(t,e,i){return[parseFloat(t[0])*(f.test(t[0])?e/100:1),parseFloat(t[1])*(f.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var r,o,s=Math.max,a=Math.abs,l=Math.round,h=/left|center|right/,c=/top|center|bottom/,u=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,f=/%$/,p=t.fn.position;t.position={scrollbarWidth:function(){if(r!==undefined)return r;var e,i,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=n.children()[0];return t("body").append(n),e=o.offsetWidth,n.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=n[0].clientWidth),n.remove(),r=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),n=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),r="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth;return{width:"scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight?t.position.scrollbarWidth():0,height:r?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),n=t.isWindow(i[0]),r=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:r,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n||r?i.width():i.outerWidth(),height:n||r?i.height():i.outerHeight()}}},t.fn.position=function(r){if(!r||!r.of)return p.apply(this,arguments);r=t.extend({},r);var f,g,m,v,y,b,_=t(r.of),w=t.position.getWithinInfo(r.within),x=t.position.getScrollInfo(w),C=(r.collision||"flip").split(" "),S={};return b=n(_),_[0].preventDefault&&(r.at="left top"),g=b.width,m=b.height,v=b.offset,y=t.extend({},v),t.each(["my","at"],function(){var t,e,i=(r[this]||"").split(" ");1===i.length&&(i=h.test(i[0])?i.concat(["center"]):c.test(i[0])?["center"].concat(i):["center","center"]),i[0]=h.test(i[0])?i[0]:"center",i[1]=c.test(i[1])?i[1]:"center",t=u.exec(i[0]),e=u.exec(i[1]),S[this]=[t?t[0]:0,e?e[0]:0],r[this]=[d.exec(i[0])[0],d.exec(i[1])[0]]}),1===C.length&&(C[1]=C[0]),"right"===r.at[0]?y.left+=g:"center"===r.at[0]&&(y.left+=g/2),"bottom"===r.at[1]?y.top+=m:"center"===r.at[1]&&(y.top+=m/2),f=e(S.at,g,m),y.left+=f[0],y.top+=f[1],this.each(function(){var n,h,c=t(this),u=c.outerWidth(),d=c.outerHeight(),p=i(this,"marginLeft"),b=i(this,"marginTop"),T=u+p+i(this,"marginRight")+x.width,k=d+b+i(this,"marginBottom")+x.height,E=t.extend({},y),P=e(S.my,c.outerWidth(),c.outerHeight());"right"===r.my[0]?E.left-=u:"center"===r.my[0]&&(E.left-=u/2),"bottom"===r.my[1]?E.top-=d:"center"===r.my[1]&&(E.top-=d/2),E.left+=P[0],E.top+=P[1],o||(E.left=l(E.left),E.top=l(E.top)),n={marginLeft:p,marginTop:b},t.each(["left","top"],function(e,i){t.ui.position[C[e]]&&t.ui.position[C[e]][i](E,{targetWidth:g,targetHeight:m,elemWidth:u,elemHeight:d,collisionPosition:n,collisionWidth:T,collisionHeight:k,offset:[f[0]+P[0],f[1]+P[1]],my:r.my,at:r.at,within:w,elem:c})}),r.using&&(h=function(t){var e=v.left-E.left,i=e+g-u,n=v.top-E.top,o=n+m-d,l={target:{element:_,left:v.left,top:v.top,width:g,height:m},element:{element:c,left:E.left,top:E.top,width:u,height:d},horizontal:i<0?"left":e>0?"right":"center",vertical:o<0?"top":n>0?"bottom":"middle"};g<u&&a(e+i)<g&&(l.horizontal="center"),m<d&&a(n+o)<m&&(l.vertical="middle"),s(a(e),a(i))>s(a(n),a(o))?l.important="horizontal":l.important="vertical",r.using.call(this,t,l)}),c.offset(t.extend(E,{using:h}))})},t.ui.position={fit:{left:function(t,e){var i,n=e.within,r=n.isWindow?n.scrollLeft:n.offset.left,o=n.width,a=t.left-e.collisionPosition.marginLeft,l=r-a,h=a+e.collisionWidth-o-r;e.collisionWidth>o?l>0&&h<=0?(i=t.left+l+e.collisionWidth-o-r,t.left+=l-i):t.left=h>0&&l<=0?r:l>h?r+o-e.collisionWidth:r:l>0?t.left+=l:h>0?t.left-=h:t.left=s(t.left-a,t.left)},top:function(t,e){var i,n=e.within,r=n.isWindow?n.scrollTop:n.offset.top,o=e.within.height,a=t.top-e.collisionPosition.marginTop,l=r-a,h=a+e.collisionHeight-o-r;e.collisionHeight>o?l>0&&h<=0?(i=t.top+l+e.collisionHeight-o-r,t.top+=l-i):t.top=h>0&&l<=0?r:l>h?r+o-e.collisionHeight:r:l>0?t.top+=l:h>0?t.top-=h:t.top=s(t.top-a,t.top)}},flip:{left:function(t,e){var i,n,r=e.within,o=r.offset.left+r.scrollLeft,s=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-s-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,f="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,p=-2*e.offset[0];c<0?((i=t.left+d+f+p+e.collisionWidth-s-o)<0||i<a(c))&&(t.left+=d+f+p):u>0&&((n=t.left-e.collisionPosition.marginLeft+d+f+p-l)>0||a(n)<u)&&(t.left+=d+f+p)},top:function(t,e){var i,n,r=e.within,o=r.offset.top+r.scrollTop,s=r.height,l=r.isWindow?r.scrollTop:r.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-s-l,d="top"===e.my[1],f=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,p="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];c<0?((n=t.top+f+p+g+e.collisionHeight-s-o)<0||n<a(c))&&(t.top+=f+p+g):u>0&&((i=t.top-e.collisionPosition.marginTop+f+p+g-l)>0||a(i)<u)&&(t.top+=f+p+g)}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,n,r,s,a=document.getElementsByTagName("body")[0],l=document.createElement("div");e=document.createElement(a?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&t.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in n)e.style[s]=n[s];e.appendChild(l),i=a||document.documentElement,i.insertBefore(e,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",r=t(l).offset().left,o=r>10&&r<11,e.innerHTML="",i.removeChild(e)}()}();t.ui.position,t.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||!1!==e.active&&null!=e.active||(e.active=0),this._processPanels(),e.active<0&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){if("active"===t)return void this._activate(e);"event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||!1!==this.options.active||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),"disabled"===t&&(this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!e))},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,n=this.headers.length,r=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(r+1)%n];break;case i.LEFT:case i.UP:o=this.headers[(r-1+n)%n];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[n-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),o.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),!1===e.active&&!0===e.collapsible||!this.headers.length?(e.active=!1,this.active=t()):!1===e.active?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,n=i.heightStyle,r=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),n=e.next(),r=n.uniqueId().attr("id");e.attr("aria-controls",r),n.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===n?(e=r.height(),this.element.siblings(":visible").each(function(){var i=t(this),n=i.css("position");"absolute"!==n&&"fixed"!==n&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===n&&(e=0,this.headers.next().each(function(){e=Math.max(e,t(this).css("height","").height())}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i=this.options,n=this.active,r=t(e.currentTarget),o=r[0]===n[0],s=o&&i.collapsible,a=s?t():r.next(),l=n.next(),h={oldHeader:n,oldPanel:l,newHeader:s?t():r,newPanel:a};e.preventDefault(),o&&!i.collapsible||!1===this._trigger("beforeActivate",e,h)||(i.active=!s&&this.headers.index(r),this.active=o?t():r,this._toggle(h),n.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),r.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,n=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=n,this.options.animate?this._animate(i,n,e):(n.hide(),i.show(),this._toggleComplete(e)),n.attr({"aria-hidden":"true"}),n.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&n.length?n.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var n,r,o,s=this,a=0,l=t.css("box-sizing"),h=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=h&&c.down||c,d=function(){s._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(r=u),r=r||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(n=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:r,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(this.showProps,{duration:o,easing:r,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===l&&(a+=i.now):"content"!==s.options.heightStyle&&(i.now=Math.round(n-e.outerHeight()-a),a=0)}})):e.animate(this.hideProps,o,r,d):t.animate(this.showProps,o,r,d)},_toggleComplete:function(t){var e=t.oldPanel;e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){var i,n,r,o,s=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:s=!1,n=this.previousFilter||"",r=String.fromCharCode(e.keyCode),o=!1,clearTimeout(this.filterTimer),r===n?o=!0:r=n+r,i=this._filterMenuItems(r),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(r=String.fromCharCode(e.keyCode),i=this._filterMenuItems(r)),i.length?(this.focus(e,i),this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}s&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(t):this.select(t))},refresh:function(){var e,i,n=this,r=this.options.icons.submenu,o=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),o.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.parent(),n=t("<span>").addClass("ui-menu-icon ui-icon "+r).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(n),e.attr("aria-labelledby",i.attr("id"))}),e=o.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);n._isDivider(e)&&e.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){
"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this._super(t,e)},focus:function(t,e){var i,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),n=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,n,r,o,s,a;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,r=e.offset().top-this.activeMenu.offset().top-i-n,o=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=e.outerHeight(),r<0?this.activeMenu.scrollTop(o+r):r+a>s&&this.activeMenu.scrollTop(o+r-s+a))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var n=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(e),this.activeMenu=n},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var n;this.active&&(n="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.find(this.options.items)[e]()),this.focus(i,n)},nextPage:function(e){var i,n,r;if(!this.active)return void this.next(e);this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-n-r<0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))},previousPage:function(e){var i,n,r;if(!this.active)return void this.next(e);this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-n+r>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),n=new RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return n.test(t.trim(t(this).text()))})}});t.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,n,r=this.element[0].nodeName.toLowerCase(),o="textarea"===r,s="input"===r;this.isMultiLine=!!o||!s&&this.element.prop("isContentEditable"),this.valueMethod=this.element[o||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(r){if(this.element.prop("readOnly"))return e=!0,n=!0,void(i=!0);e=!1,n=!1,i=!1;var o=t.ui.keyCode;switch(r.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",r);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",r);break;case o.UP:e=!0,this._keyEvent("previous",r);break;case o.DOWN:e=!0,this._keyEvent("next",r);break;case o.ENTER:this.menu.active&&(e=!0,r.preventDefault(),this.menu.select(r));break;case o.TAB:this.menu.active&&this.menu.select(r);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(r),r.preventDefault());break;default:i=!0,this._searchTimeout(r)}},keypress:function(n){if(e)return e=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||n.preventDefault());if(!i){var r=t.ui.keyCode;switch(n.keyCode){case r.PAGE_UP:this._move("previousPage",n);break;case r.PAGE_DOWN:this._move("nextPage",n);break;case r.UP:this._keyEvent("previous",n);break;case r.DOWN:this._keyEvent("next",n)}}},input:function(t){if(n)return n=!1,void t.preventDefault();this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){if(this.cancelBlur)return void delete this.cancelBlur;clearTimeout(this.searching),this.close(t),this._change(t)}}),this._initSource(),this.menu=t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];t(e.target).closest(".ui-menu-item").length||this._delay(function(){var e=this;this.document.one("mousedown",function(n){n.target===e.element[0]||n.target===i||t.contains(i,n.target)||e.close()})})},menufocus:function(e,i){var n,r;if(this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)});r=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:r})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(r.value),(n=i.item.attr("aria-label")||r.value)&&t.trim(n).length&&(this.liveRegion.children().hide(),t("<div>").text(n).appendTo(this.liveRegion))},menuselect:function(t,e){var i=e.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=i})),!1!==this._trigger("select",t,{item:i})&&this._value(i.value),this.term=this._value(),this.close(t),this.selectedItem=i}}),this.liveRegion=t("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,n=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,n){n(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,r){n.xhr&&n.xhr.abort(),n.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){r(t)},error:function(){r([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),n=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;e&&(!e||i||n)||(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):!1!==this._trigger("search",e)?this._search(t):void 0},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),--this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var n=this;t.each(i,function(t,i){n._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").text(i.label).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(t,e),e.preventDefault())}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var n=new RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return n.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}});var d,f=(t.ui.autocomplete,"ui-button ui-widget ui-state-default ui-corner-all"),p="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",g=function(){var e=t(this);setTimeout(function(){e.find(":ui-button").button("refresh")},1)},m=function(e){var i=e.name,n=e.form,r=t([]);return i&&(i=i.replace(/'/g,"\\'"),r=n?t(n).find("[name='"+i+"'][type=radio]"):t("[name='"+i+"'][type=radio]",e.ownerDocument).filter(function(){return!this.form})),r};t.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,g),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var e=this,i=this.options,n="checkbox"===this.type||"radio"===this.type,r=n?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(f).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===d&&t(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||t(this).removeClass(r)}).bind("click"+this.eventNamespace,function(t){i.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),n&&this.element.bind("change"+this.eventNamespace,function(){e.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;t(this).addClass("ui-state-active"),e.buttonElement.attr("aria-pressed","true");var n=e.element[0];m(n).not(n).map(function(){return t(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(i.disabled)return!1;t(this).addClass("ui-state-active"),d=this,e.document.one("mouseup",function(){d=null})}).bind("mouseup"+this.eventNamespace,function(){if(i.disabled)return!1;t(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(e){if(i.disabled)return!1;e.keyCode!==t.ui.keyCode.SPACE&&e.keyCode!==t.ui.keyCode.ENTER||t(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){t(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var t,e,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(t=this.element.parents().last(),e="label[for='"+this.element.attr("id")+"']",this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(f+" ui-state-active "+p).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(t,e){if(this._super(t,e),"disabled"===t)return this.widget().toggleClass("ui-state-disabled",!!e),this.element.prop("disabled",!!e),void(e&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")));this._resetButton()},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?m(this.element[0]).each(function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var e=this.buttonElement.removeClass(p),i=t("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),n=this.options.icons,r=n.primary&&n.secondary,o=[];n.primary||n.secondary?(this.options.text&&o.push("ui-button-text-icon"+(r?"s":n.primary?"-primary":"-secondary")),n.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+n.primary+"'></span>"),n.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+n.secondary+"'></span>"),this.options.text||(o.push(r?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",t.trim(i)))):o.push("ui-button-text-only"),e.addClass(o.join(" "))}}),t.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,e){"disabled"===t&&this.buttons.button("option",t,e),this._super(t,e)},refresh:function(){var e="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),n=i.filter(":ui-button");i.not(":ui-button").button(),n.button("refresh"),this.buttons=i.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}});t.ui.button;t.extend(t.ui,{datepicker:{version:"1.11.4"}});var v;t.extend(r.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var n,r,o;n=e.nodeName.toLowerCase(),r="div"===n||"span"===n,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),r),o.settings=t.extend({},i||{}),"input"===n?this._connectDatepicker(e,o):r&&this._inlineDatepicker(e,o)},_newInst:function(e,i){return{id:e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?o(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var n=t(e);i.append=t([]),i.trigger=t([]),n.hasClass(this.markerClassName)||(this._attachments(n,i),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var n,r,o,s=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=t("<span class='"+this._appendClass+"'>"+s+"</span>"),e[a?"before":"after"](i.append)),e.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),n=this._get(i,"showOn"),"focus"!==n&&"both"!==n||e.focus(this._showDatepicker),"button"!==n&&"both"!==n||(r=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:r,title:r}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:r,title:r}):r)),e[a?"before":"after"](i.trigger),i.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,n,r,o=new Date(2009,11,20),s=this._get(t,"dateFormat");s.match(/[DM]/)&&(e=function(t){for(i=0,n=0,r=0;r<t.length;r++)t[r].length>i&&(i=t[r].length,n=r);return n},o.setMonth(e(this._get(t,s.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var n=t(e);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,n,r,o){var s,l,h,c,u,d=this._dialogInst;return d||(this.uuid+=1,s="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+s+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,r||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(l=document.documentElement.clientWidth,h=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+c,h/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,n=t(e),r=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(r.append.remove(),r.trigger.remove(),n.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||n.removeClass(this.markerClassName).empty(),v===r&&(v=null))},_enableDatepicker:function(e){var i,n,r=t(e),o=t.data(e,"datepicker");r.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||(n=r.children("."+this._inlineClass),n.children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,n,r=t(e),o=t.data(e,"datepicker");r.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||(n=r.children("."+this._inlineClass),n.children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;e<this._disabledInputs.length;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,n){var r,o,s,l,h=this._getInst(e);if(2===arguments.length&&"string"==typeof i)return"defaults"===i?t.extend({},t.datepicker._defaults):h?"all"===i?t.extend({},h.settings):this._get(h,i):null;r=i||{},"string"==typeof i&&(r={},r[i]=n),h&&(this._curInst===h&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),s=this._getMinMaxDate(h,"min"),l=this._getMinMaxDate(h,"max"),a(h.settings,r),null!==s&&r.dateFormat!==undefined&&r.minDate===undefined&&(h.settings.minDate=this._formatDate(h,s)),null!==l&&r.dateFormat!==undefined&&r.maxDate===undefined&&(h.settings.maxDate=this._formatDate(h,l)),"disabled"in r&&(r.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),h),this._autoSize(h),this._setDate(h,o),this._updateAlternate(h),this._updateDatepicker(h))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,n,r,o=t.datepicker._getInst(e.target),s=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),s=!1;break;case 13:return r=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),r[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,r[0]),i=t.datepicker._get(o,"onSelect"),i?(n=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[n,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),s=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),s=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?1:-1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),s=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?-1:1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),s=e.ctrlKey||e.metaKey;break;default:s=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):s=!1;s&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,n,r=t.datepicker._getInst(e.target);if(t.datepicker._get(r,"constrainInput"))return i=t.datepicker._possibleChars(t.datepicker._get(r,"dateFormat")),n=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||n<" "||!i||i.indexOf(n)>-1},_doKeyUp:function(e){var i,n=t.datepicker._getInst(e.target);if(n.input.val()!==n.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(n,"dateFormat"),n.input?n.input.val():null,t.datepicker._getFormatConfig(n)),i&&(t.datepicker._setDateFromField(n),t.datepicker._updateAlternate(n),t.datepicker._updateDatepicker(n))}catch(t){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var i,r,o,s,l,h,c;i=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==i&&(t.datepicker._curInst.dpDiv.stop(!0,!0),i&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),r=t.datepicker._get(i,"beforeShow"),o=r?r.apply(e,[e,i]):{},!1!==o&&(a(i.settings,o),i.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(i),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),s=!1,t(e).parents().each(function(){return!(s|="fixed"===t(this).css("position"))}),l={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(i),l=t.datepicker._checkOffset(i,l,s),i.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":s?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),i.inline||(h=t.datepicker._get(i,"showAnim"),c=t.datepicker._get(i,"duration"),i.dpDiv.css("z-index",n(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[h]?i.dpDiv.show(h,t.datepicker._get(i,"showOptions"),c):i.dpDiv[h||"show"](h?c:null),t.datepicker._shouldFocusInput(i)&&i.input.focus(),t.datepicker._curInst=i))}},_updateDatepicker:function(e){this.maxRows=4,v=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,n=this._getNumberOfMonths(e),r=n[1],o=e.dpDiv.find("."+this._dayOverClass+" a");o.length>0&&s.apply(o.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",17*r+"em"),e.dpDiv[(1!==n[0]||1!==n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,n){var r=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,a=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(n?0:t(document).scrollLeft()),h=document.documentElement.clientHeight+(n?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?r-s:0,i.left-=n&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=n&&i.top===e.input.offset().top+a?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+r>l&&l>r?Math.abs(i.left+r-l):0),i.top-=Math.min(i.top,i.top+o>h&&h>o?Math.abs(o+a):0),i},_findPos:function(e){for(var i,n=this._getInst(e),r=this._get(n,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[r?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,n,r,o,s=this._curInst;!s||e&&s!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(s,"showAnim"),n=this._get(s,"duration"),r=function(){t.datepicker._tidyDialog(s)},t.effects&&(t.effects.effect[i]||t.effects[i])?s.dpDiv.hide(i,t.datepicker._get(s,"showOptions"),n,r):s.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1,o=this._get(s,"onClose"),o&&o.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",
left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),n=t.datepicker._getInst(i[0]);(i[0].id===t.datepicker._mainDivId||0!==i.parents("#"+t.datepicker._mainDivId).length||i.hasClass(t.datepicker.markerClassName)||i.closest("."+t.datepicker._triggerClass).length||!t.datepicker._datepickerShowing||t.datepicker._inDialog&&t.blockUI)&&(!i.hasClass(t.datepicker.markerClassName)||t.datepicker._curInst===n)||t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,n){var r=t(e),o=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(o,i+("M"===n?this._get(o,"showCurrentAtPos"):0),n),this._updateDatepicker(o))},_gotoToday:function(e){var i,n=t(e),r=this._getInst(n[0]);this._get(r,"gotoCurrent")&&r.currentDay?(r.selectedDay=r.currentDay,r.drawMonth=r.selectedMonth=r.currentMonth,r.drawYear=r.selectedYear=r.currentYear):(i=new Date,r.selectedDay=i.getDate(),r.drawMonth=r.selectedMonth=i.getMonth(),r.drawYear=r.selectedYear=i.getFullYear()),this._notifyChange(r),this._adjustDate(n)},_selectMonthYear:function(e,i,n){var r=t(e),o=this._getInst(r[0]);o["selected"+("M"===n?"Month":"Year")]=o["draw"+("M"===n?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(r)},_selectDay:function(e,i,n,r){var o,s=t(e);t(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||(o=this._getInst(s[0]),o.selectedDay=o.currentDay=t("a",r).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=n,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var n,r=t(e),o=this._getInst(r[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),n=this._get(o,"onSelect"),n?n.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var i,n,r,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),n=this._getDate(e),r=this.formatDate(i,n,this._getFormatConfig(e)),t(o).each(function(){t(this).val(r)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&e<6,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,n){if(null==e||null==i)throw"Invalid arguments";if(""===(i="object"==typeof i?i.toString():i+""))return null;var r,o,s,a,l=0,h=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),u=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,d=(n?n.dayNames:null)||this._defaults.dayNames,f=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,p=(n?n.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,v=-1,y=-1,b=!1,_=function(t){var i=r+1<e.length&&e.charAt(r+1)===t;return i&&r++,i},w=function(t){var e=_(t),n="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,r="y"===t?n:1,o=new RegExp("^\\d{"+r+","+n+"}"),s=i.substring(l).match(o);if(!s)throw"Missing number at position "+l;return l+=s[0].length,parseInt(s[0],10)},x=function(e,n,r){var o=-1,s=t.map(_(e)?r:n,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(s,function(t,e){var n=e[1];if(i.substr(l,n.length).toLowerCase()===n.toLowerCase())return o=e[0],l+=n.length,!1}),-1!==o)return o+1;throw"Unknown name at position "+l},C=function(){if(i.charAt(l)!==e.charAt(r))throw"Unexpected literal at position "+l;l++};for(r=0;r<e.length;r++)if(b)"'"!==e.charAt(r)||_("'")?C():b=!1;else switch(e.charAt(r)){case"d":v=w("d");break;case"D":x("D",u,d);break;case"o":y=w("o");break;case"m":m=w("m");break;case"M":m=x("M",f,p);break;case"y":g=w("y");break;case"@":a=new Date(w("@")),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"!":a=new Date((w("!")-this._ticksTo1970)/1e4),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"'":_("'")?C():b=!0;break;default:C()}if(l<i.length&&(s=i.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===g?g=(new Date).getFullYear():g<100&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(g<=c?0:-100)),y>-1)for(m=1,v=y;;){if(o=this._getDaysInMonth(g,m-1),v<=o)break;m++,v-=o}if(a=this._daylightSavingAdjust(new Date(g,m-1,v)),a.getFullYear()!==g||a.getMonth()+1!==m||a.getDate()!==v)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(t,e,i){if(!e)return"";var n,r=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=n+1<t.length&&t.charAt(n+1)===e;return i&&n++,i},h=function(t,e,i){var n=""+e;if(l(t))for(;n.length<i;)n="0"+n;return n},c=function(t,e,i,n){return l(t)?n[e]:i[e]},u="",d=!1;if(e)for(n=0;n<t.length;n++)if(d)"'"!==t.charAt(n)||l("'")?u+=t.charAt(n):d=!1;else switch(t.charAt(n)){case"d":u+=h("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),r,o);break;case"o":u+=h("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=h("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),s,a);break;case"y":u+=l("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?u+="'":d=!0;break;default:u+=t.charAt(n)}return u},_possibleChars:function(t){var e,i="",n=!1,r=function(i){var n=e+1<t.length&&t.charAt(e+1)===i;return n&&e++,n};for(e=0;e<t.length;e++)if(n)"'"!==t.charAt(e)||r("'")?i+=t.charAt(e):n=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":r("'")?i+="'":n=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return t.settings[e]!==undefined?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),n=t.lastVal=t.input?t.input.val():null,r=this._getDefaultDate(t),o=r,s=this._getFormatConfig(t);try{o=this.parseDate(i,n,s)||r}catch(t){n=e?"":n}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=n?o.getDate():0,t.currentMonth=n?o.getMonth():0,t.currentYear=n?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,n){var r=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(t){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,r=n.getFullYear(),o=n.getMonth(),s=n.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(i);l;){switch(l[2]||"d"){case"d":case"D":s+=parseInt(l[1],10);break;case"w":case"W":s+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),s=Math.min(s,t.datepicker._getDaysInMonth(r,o));break;case"y":case"Y":r+=parseInt(l[1],10),s=Math.min(s,t.datepicker._getDaysInMonth(r,o))}l=a.exec(i)}return new Date(r,o,s)},s=null==i||""===i?n:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?n:r(i):new Date(i.getTime());return s=s&&"Invalid Date"===s.toString()?n:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var n=!e,r=t.selectedMonth,o=t.selectedYear,s=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=s.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=s.getMonth(),t.drawYear=t.selectedYear=t.currentYear=s.getFullYear(),r===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(n?"":this._formatDate(t))},_getDate:function(t){return!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay))},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),n="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(n,-i,"M")},next:function(){t.datepicker._adjustDate(n,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(n)},selectDay:function(){return t.datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(n,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,n,r,o,s,a,l,h,c,u,d,f,p,g,m,v,y,b,_,w,x,C,S,T,k,E,P,D,I,N,M,L,A,R,O,z,H,F,B=new Date,$=this._daylightSavingAdjust(new Date(B.getFullYear(),B.getMonth(),B.getDate())),j=this._get(t,"isRTL"),W=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),U=this._get(t,"navigationAsDateFormat"),V=this._getNumberOfMonths(t),G=this._get(t,"showCurrentAtPos"),Z=this._get(t,"stepMonths"),K=1!==V[0]||1!==V[1],Y=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Q=t.drawMonth-G,tt=t.drawYear;if(Q<0&&(Q+=12,tt--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-V[0]*V[1]+1,J.getDate())),e=X&&e<X?X:e;this._daylightSavingAdjust(new Date(tt,Q,1))>e;)--Q<0&&(Q=11,tt--);for(t.drawMonth=Q,t.drawYear=tt,i=this._get(t,"prevText"),i=U?this.formatDate(i,this._daylightSavingAdjust(new Date(tt,Q-Z,1)),this._getFormatConfig(t)):i,n=this._canAdjustMonth(t,-1,tt,Q)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"e":"w")+"'>"+i+"</span></a>",r=this._get(t,"nextText"),r=U?this.formatDate(r,this._daylightSavingAdjust(new Date(tt,Q+Z,1)),this._getFormatConfig(t)):r,o=this._canAdjustMonth(t,1,tt,Q)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"w":"e")+"'>"+r+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"w":"e")+"'>"+r+"</span></a>",s=this._get(t,"currentText"),a=this._get(t,"gotoCurrent")&&t.currentDay?Y:$,s=U?this.formatDate(s,a,this._getFormatConfig(t)):s,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",h=W?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(j?l:"")+(this._isInRange(t,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(j?"":l)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),f=this._get(t,"dayNamesMin"),p=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),y=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),_="",x=0;x<V[0];x++){for(C="",this.maxRows=4,S=0;S<V[1];S++){if(T=this._daylightSavingAdjust(new Date(tt,Q,t.selectedDay)),k=" ui-corner-all",E="",K){if(E+="<div class='ui-datepicker-group",V[1]>1)switch(S){case 0:E+=" ui-datepicker-group-first",k=" ui-corner-"+(j?"right":"left");break;case V[1]-1:E+=" ui-datepicker-group-last",k=" ui-corner-"+(j?"left":"right");break;default:E+=" ui-datepicker-group-middle",k=""}E+="'>"}for(E+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+k+"'>"+(/all|left/.test(k)&&0===x?j?o:n:"")+(/all|right/.test(k)&&0===x?j?n:o:"")+this._generateMonthYearHeader(t,Q,tt,X,J,x>0||S>0,p,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;w<7;w++)D=(w+c)%7,P+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[D]+"'>"+f[D]+"</span></th>";for(E+=P+"</tr></thead><tbody>",I=this._getDaysInMonth(tt,Q),tt===t.selectedYear&&Q===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,I)),N=(this._getFirstDayOfMonth(tt,Q)-c+7)%7,M=Math.ceil((N+I)/7),L=K&&this.maxRows>M?this.maxRows:M,this.maxRows=L,A=this._daylightSavingAdjust(new Date(tt,Q,1-N)),R=0;R<L;R++){for(E+="<tr>",O=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;w<7;w++)z=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],H=A.getMonth()!==Q,F=H&&!y||!z[0]||X&&A<X||J&&A>J,O+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(H?" ui-datepicker-other-month":"")+(A.getTime()===T.getTime()&&Q===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===T.getTime()?" "+this._dayOverClass:"")+(F?" "+this._unselectableClass+" ui-state-disabled":"")+(H&&!v?"":" "+z[1]+(A.getTime()===Y.getTime()?" "+this._currentClass:"")+(A.getTime()===$.getTime()?" ui-datepicker-today":""))+"'"+(H&&!v||!z[2]?"":" title='"+z[2].replace(/'/g,"&#39;")+"'")+(F?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(H&&!v?"&#xa0;":F?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===$.getTime()?" ui-state-highlight":"")+(A.getTime()===Y.getTime()?" ui-state-active":"")+(H?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);E+=O+"</tr>"}Q++,Q>11&&(Q=0,tt++),E+="</tbody></table>"+(K?"</div>"+(V[0]>0&&S===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),C+=E}_+=C}return _+=h,t._keyEvent=!1,_},_generateMonthYearHeader:function(t,e,i,n,r,o,s,a){var l,h,c,u,d,f,p,g,m=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),y=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(o||!m)_+="<span class='ui-datepicker-month'>"+s[e]+"</span>";else{for(l=n&&n.getFullYear()===i,h=r&&r.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;c<12;c++)(!l||c>=n.getMonth())&&(!h||c<=r.getMonth())&&(_+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+a[c]+"</option>");_+="</select>"}if(y||(b+=_+(!o&&m&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),f=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},p=f(u[0]),g=Math.max(p,f(u[1]||"")),p=n?Math.max(p,n.getFullYear()):p,g=r?Math.min(g,r.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";p<=g;p++)t.yearshtml+="<option value='"+p+"'"+(p===i?" selected='selected'":"")+">"+p+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),y&&(b+=(!o&&m&&v?"":"&#xa0;")+_),b+="</div>"},_adjustInstDate:function(t,e,i){var n=t.drawYear+("Y"===i?e:0),r=t.drawMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(n,r))+("D"===i?e:0),s=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(n,r,o)));t.selectedDay=s.getDate(),t.drawMonth=t.selectedMonth=s.getMonth(),t.drawYear=t.selectedYear=s.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),n=this._getMinMaxDate(t,"max"),r=i&&e<i?i:e;return n&&r>n?n:r},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,n){var r=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,n+(e<0?e:r[0]*r[1]),1));return e<0&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,n,r=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),s=null,a=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),n=(new Date).getFullYear(),s=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=n),i[1].match(/[+\-].*/)&&(a+=n)),(!r||e.getTime()>=r.getTime())&&(!o||e.getTime()<=o.getTime())&&(!s||e.getFullYear()>=s)&&(!a||e.getFullYear()<=a)},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,n){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var r=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(n,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),r,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new r,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.11.4";t.datepicker;t.widget("ui.draggable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging"))return void(this.destroyOnClear=!0);this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return this._blurActiveElement(e),!(this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(e),!!this.handle&&(this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),!0))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=this.document[0];if(this.handleElement.is(e.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&t(i.activeElement).blur()}catch(t){}},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._normalizeRightBottom(),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(!1===this._trigger("drag",e,n))return this._mouseUp({}),!1;this.position=n.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,n=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(n=t.ui.ddmanager.drop(this,e)),this.dropped&&(n=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||!0===this.options.revert||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",e)&&i._clear()}):!1!==this._trigger("stop",e)&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.focus(),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper),r=n?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n&&r[0]===this.element[0]&&this._setPositionRelative(),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,r=this.options,o=this.document[0];return this.relativeContainer=null,r.containment?"window"===r.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===r.containment?void(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):r.containment.constructor===Array?void(this.containment=r.containment):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),i=t(r.containment),void((n=i[0])&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,n=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:n?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:n?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,n,r,o,s=this.options,a=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(n=this.relativeContainer.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,h=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o),"y"===s.axis&&(l=this.originalPageX),"x"===s.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(e,i,n){return n=n||this._uiHash(),t.ui.plugin.call(this,e,[i,n,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),n.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,n){var r=t.extend({},i,{item:n.element});n.sortables=[],t(n.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(n.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,r))})},stop:function(e,i,n){var r=t.extend({},i,{item:n.element});n.cancelHelperRemoval=!1,t.each(n.sortables,function(){var t=this;t.isOver?(t.isOver=0,n.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,r))})},drag:function(e,i,n){t.each(n.sortables,function(){var r=!1,o=this;o.positionAbs=n.positionAbs,o.helperProportions=n.helperProportions,o.offset.click=n.offset.click,o._intersectsWith(o.containerCache)&&(r=!0,t.each(n.sortables,function(){return this.positionAbs=n.positionAbs,this.helperProportions=n.helperProportions,this.offset.click=n.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(r=!1),r})),r?(o.isOver||(o.isOver=1,n._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=n.offset.click.top,o.offset.click.left=n.offset.click.left,
o.offset.parent.left-=n.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=n.offset.parent.top-o.offset.parent.top,n._trigger("toSortable",e),n.dropped=o.element,t.each(n.sortables,function(){this.refreshPositions()}),n.currentItem=n.element,o.fromOutside=n),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(n._parent),n._refreshOffsets(e),i.position=n._generatePosition(e,!0),n._trigger("fromSortable",e),n.dropped=!1,t.each(n.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,n){var r=t("body"),o=n.options;r.css("cursor")&&(o._cursor=r.css("cursor")),r.css("cursor",o.cursor)},stop:function(e,i,n){var r=n.options;r._cursor&&t("body").css("cursor",r._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,n){var r=t(i.helper),o=n.options;r.css("opacity")&&(o._opacity=r.css("opacity")),r.css("opacity",o.opacity)},stop:function(e,i,n){var r=n.options;r._opacity&&t(i.helper).css("opacity",r._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,n){var r=n.options,o=!1,s=n.scrollParentNotHidden[0],a=n.document[0];s!==a&&"HTML"!==s.tagName?(r.axis&&"x"===r.axis||(n.overflowOffset.top+s.offsetHeight-e.pageY<r.scrollSensitivity?s.scrollTop=o=s.scrollTop+r.scrollSpeed:e.pageY-n.overflowOffset.top<r.scrollSensitivity&&(s.scrollTop=o=s.scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(n.overflowOffset.left+s.offsetWidth-e.pageX<r.scrollSensitivity?s.scrollLeft=o=s.scrollLeft+r.scrollSpeed:e.pageX-n.overflowOffset.left<r.scrollSensitivity&&(s.scrollLeft=o=s.scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(e.pageY-t(a).scrollTop()<r.scrollSensitivity?o=t(a).scrollTop(t(a).scrollTop()-r.scrollSpeed):t(window).height()-(e.pageY-t(a).scrollTop())<r.scrollSensitivity&&(o=t(a).scrollTop(t(a).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(e.pageX-t(a).scrollLeft()<r.scrollSensitivity?o=t(a).scrollLeft(t(a).scrollLeft()-r.scrollSpeed):t(window).width()-(e.pageX-t(a).scrollLeft())<r.scrollSensitivity&&(o=t(a).scrollLeft(t(a).scrollLeft()+r.scrollSpeed)))),!1!==o&&t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,n){var r=n.options;n.snapElements=[],t(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each(function(){var e=t(this),i=e.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,n){var r,o,s,a,l,h,c,u,d,f,p=n.options,g=p.snapTolerance,m=i.offset.left,v=m+n.helperProportions.width,y=i.offset.top,b=y+n.helperProportions.height;for(d=n.snapElements.length-1;d>=0;d--)l=n.snapElements[d].left-n.margins.left,h=l+n.snapElements[d].width,c=n.snapElements[d].top-n.margins.top,u=c+n.snapElements[d].height,v<l-g||m>h+g||b<c-g||y>u+g||!t.contains(n.snapElements[d].item.ownerDocument,n.snapElements[d].item)?(n.snapElements[d].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=!1):("inner"!==p.snapMode&&(r=Math.abs(c-b)<=g,o=Math.abs(u-y)<=g,s=Math.abs(l-v)<=g,a=Math.abs(h-m)<=g,r&&(i.position.top=n._convertPositionTo("relative",{top:c-n.helperProportions.height,left:0}).top),o&&(i.position.top=n._convertPositionTo("relative",{top:u,left:0}).top),s&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l-n.helperProportions.width}).left),a&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left)),f=r||o||s||a,"outer"!==p.snapMode&&(r=Math.abs(c-y)<=g,o=Math.abs(u-b)<=g,s=Math.abs(l-m)<=g,a=Math.abs(h-v)<=g,r&&(i.position.top=n._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=n._convertPositionTo("relative",{top:u-n.helperProportions.height,left:0}).top),s&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l}).left),a&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left)),!n.snapElements[d].snapping&&(r||o||s||a||f)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=r||o||s||a||f)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,n){var r,o=n.options,s=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});s.length&&(r=parseInt(t(s[0]).css("zIndex"),10)||0,t(s).each(function(e){t(this).css("zIndex",r+e)}),this.css("zIndex",r+s.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,n){var r=t(i.helper),o=n.options;r.css("zIndex")&&(o._zIndex=r.css("zIndex")),r.css("zIndex",o.zIndex)},stop:function(e,i,n){var r=n.options;r._zIndex&&t(i.helper).css("zIndex",r._zIndex)}});t.ui.draggable;t.widget("ui.resizable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseInt(t,10)||0},_isNumber:function(t){return!isNaN(parseInt(t,10))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return e[n]>0||(e[n]=1,r=e[n]>0,e[n]=0,r)},_create:function(){var e,i,n,r,o,s=this,a=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;i<e.length;i++)n=t.trim(e[i]),o="ui-resizable-"+n,r=t("<div class='ui-resizable-handle "+o+"'></div>"),r.css({zIndex:a.zIndex}),"se"===n&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(r);this._renderAxis=function(e){var i,n,r,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:s._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(n=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(r,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=r&&r[1]?r[1]:"se")}),a.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(t(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){a.disabled||s.resizing||(t(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,n,r=!1;for(i in this.handles)((n=t(this.handles[i])[0])===e.target||t.contains(n,e.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(e){var i,n,r,o=this.options,s=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),n=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,n+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalPosition={left:i,top:n},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===r?this.axis+"-resize":r),s.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,n,r=this.originalMousePosition,o=this.axis,s=e.pageX-r.left||0,a=e.pageY-r.top||0,l=this._change[o];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[e,s,a]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),n=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(n)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var i,n,r,o,s,a,l,h=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),r=n&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=n?0:c.sizeDiff.width,s={width:c.helper.width()-o,height:c.helper.height()-r},a=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,h.animate||this.element.css(t.extend(s,{top:l,left:a})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,n,r,o,s=this.options;o={minWidth:this._isNumber(s.minWidth)?s.minWidth:0,maxWidth:this._isNumber(s.maxWidth)?s.maxWidth:Infinity,minHeight:this._isNumber(s.minHeight)?s.minHeight:0,maxHeight:this._isNumber(s.maxHeight)?s.maxHeight:Infinity},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,n=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,r=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),n>o.minHeight&&(o.minHeight=n),i<o.maxWidth&&(o.maxWidth=i),r<o.maxHeight&&(o.maxHeight=r)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,n=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===n&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===n&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,n=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,r=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,s=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,a=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),s&&(t.height=e.minHeight),n&&(t.width=e.maxWidth),r&&(t.height=e.maxHeight),o&&h&&(t.left=a-e.minWidth),n&&h&&(t.left=a-e.maxWidth),s&&c&&(t.top=l-e.minHeight),r&&c&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],n=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],r=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];e<4;e++)i[e]=parseInt(n[e],10)||0,i[e]+=parseInt(r[e],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;e<this._proportionallyResizeElements.length;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize;return{left:this.originalPosition.left+e,width:i.width-e}},n:function(t,e,i){var n=this.originalSize;return{top:this.originalPosition.top+i,height:n.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},sw:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,n]))},ne:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},nw:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,n]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),n=i.options,r=i._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),s=o&&i._hasScroll(r[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},h=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,c&&h?{top:c,left:h}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&t(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,n,r,o,s,a,l=t(this).resizable("instance"),h=l.options,c=l.element,u=h.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(l.containerElement=t(d),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,n){i[t]=l._num(e.css("padding"+n))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},n=l.containerOffset,r=l.containerSize.height,o=l.containerSize.width,s=l._hasScroll(d,"left")?d.scrollWidth:o,a=l._hasScroll(d)?d.scrollHeight:r,l.parentData={element:d,left:n.left,top:n.top,width:s,height:a}))},resize:function(e){var i,n,r,o,s=t(this).resizable("instance"),a=s.options,l=s.containerOffset,h=s.position,c=s._aspectRatio||e.shiftKey,u={top:0,left:0},d=s.containerElement,f=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),h.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-u.left),c&&(s.size.height=s.size.width/s.aspectRatio,f=!1),s.position.left=a.helper?l.left:0),h.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),c&&(s.size.width=s.size.height*s.aspectRatio,f=!1),s.position.top=s._helper?l.top:0),r=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),r&&o?(s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top):(s.offset.left=s.element.offset().left,s.offset.top=s.element.offset().top),i=Math.abs(s.sizeDiff.width+(s._helper?s.offset.left-u.left:s.offset.left-l.left)),n=Math.abs(s.sizeDiff.height+(s._helper?s.offset.top-u.top:s.offset.top-l.top)),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,c&&(s.size.height=s.size.width/s.aspectRatio,f=!1)),n+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-n,c&&(s.size.width=s.size.height*s.aspectRatio,f=!1)),f||(s.position.left=s.prevPosition.left,s.position.top=s.prevPosition.top,s.size.width=s.prevSize.width,s.size.height=s.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,n=e.containerOffset,r=e.containerPosition,o=e.containerElement,s=t(e.helper),a=s.offset(),l=s.outerWidth()-e.sizeDiff.width,h=s.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:a.left-r.left-n.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:a.left-r.left-n.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})},resize:function(e,i){var n=t(this).resizable("instance"),r=n.options,o=n.originalSize,s=n.originalPosition,a={height:n.size.height-o.height||0,width:n.size.width-o.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0};t(r.alsoResize).each(function(){var e=t(this),n=t(this).data("ui-resizable-alsoresize"),r={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(n[e]||0)+(a[e]||0);i&&i>=0&&(r[e]=i||null)}),e.css(r)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.options,n=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),n=i.options,r=i.size,o=i.originalSize,s=i.originalPosition,a=i.axis,l="number"==typeof n.grid?[n.grid,n.grid]:n.grid,h=l[0]||1,c=l[1]||1,u=Math.round((r.width-o.width)/h)*h,d=Math.round((r.height-o.height)/c)*c,f=o.width+u,p=o.height+d,g=n.maxWidth&&n.maxWidth<f,m=n.maxHeight&&n.maxHeight<p,v=n.minWidth&&n.minWidth>f,y=n.minHeight&&n.minHeight>p;n.grid=l,v&&(f+=h),y&&(p+=c),g&&(f-=h),m&&(p-=c),/^(se|s|e)$/.test(a)?(i.size.width=f,i.size.height=p):/^(ne)$/.test(a)?(i.size.width=f,i.size.height=p,i.position.top=s.top-d):/^(sw)$/.test(a)?(i.size.width=f,i.size.height=p,i.position.left=s.left-u):((p-c<=0||f-h<=0)&&(e=i._getPaddingPlusBorderDimensions(this)),p-c>0?(i.size.height=p,i.position.top=s.top-d):(p=c-e.height,i.size.height=p,i.position.top=s.top+o.height-p),f-h>0?(i.size.width=f,i.position.left=s.left-u):(f=h-e.width,i.size.width=f,i.position.left=s.left+o.width-f))}});t.ui.resizable,t.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;i<0&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i,n=this;if(this._isOpen&&!1!==this._trigger("beforeClose",e)){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&t(i).blur()}catch(t){}this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",e)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var n=!1,r=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,r);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),n=!0),n&&!i&&this._trigger("focus",e),n},open:function(){var e=this;if(this._isOpen)return void(this._moveToTop()&&this._focusTabbable());this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open")},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).focus()},_keepFocus:function(e){function i(){var e=this.document[0].activeElement;this.uiDialog[0]===e||t.contains(this.uiDialog[0],e)||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),n=i.filter(":first"),r=i.filter(":last");e.target!==r[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==n[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){r.focus()}),e.preventDefault()):(this._delay(function(){n.focus()}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title||t.html("&#160;"),t.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;if(this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length)return void this.uiDialog.removeClass("ui-dialog-buttons");t.each(i,function(i,n){var r,o;n=t.isFunction(n)?{click:n,text:i}:n,n=t.extend({type:"button"},n),r=n.click,n.click=function(){r.apply(e.element[0],arguments)},o={icons:n.icons,text:n.showText},delete n.icons,delete n.showText,t("<button></button>",n).button(o).appendTo(e.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){t(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",n,e(r))},drag:function(t,n){i._trigger("drag",t,e(n))},stop:function(r,o){var s=o.offset.left-i.document.scrollLeft(),a=o.offset.top-i.document.scrollTop();n.position={my:"left top",at:"left"+(s>=0?"+":"")+s+" top"+(a>=0?"+":"")+a,of:i.window},t(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",r,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,n=this.options,r=n.resizable,o=this.uiDialog.css("position"),s="string"==typeof r?r:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,r){t(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",n,e(r))},resize:function(t,n){i._trigger("resize",t,e(n))},stop:function(r,o){var s=i.uiDialog.offset(),a=s.left-i.document.scrollLeft(),l=s.top-i.document.scrollTop();n.height=i.uiDialog.height(),n.width=i.uiDialog.width(),n.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(l>=0?"+":"")+l,of:i.window},t(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",r,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,n=!1,r={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(n=!0),t in i.resizableRelatedOptions&&(r[t]=e)}),n&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",r)},_setOption:function(t,e){var i,n,r=this.uiDialog
;"dialogClass"===t&&r.removeClass(this.options.dialogClass).addClass(e),"disabled"!==t&&(this._super(t,e),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:""+e}),"draggable"===t&&(i=r.is(":data(ui-draggable)"),i&&!e&&r.draggable("destroy"),!i&&e&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&(n=r.is(":data(ui-resizable)"),n&&!e&&r.resizable("destroy"),n&&"string"==typeof e&&r.resizable("option","handles",e),n||!1===e||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,n=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),n.minWidth>n.width&&(n.width=n.minWidth),t=this.uiDialog.css({height:"auto",width:n.width}).outerHeight(),e=Math.max(0,n.minHeight-t),i="number"==typeof n.maxHeight?Math.max(0,n.maxHeight-t):"none","auto"===n.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,n.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}});t.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,n=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(n)?n:function(t){return t.is(n)},this.proportions=function(){if(!arguments.length)return e||(e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});e=arguments[0]},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;e<t.length;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var n=t.ui.ddmanager.droppables[this.options.scope];this._splice(n),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var n=i||t.ui.ddmanager.current,r=!1;return!(!n||(n.currentItem||n.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");if(i.options.greedy&&!i.options.disabled&&i.options.scope===n.options.scope&&i.accept.call(i.element[0],n.currentItem||n.element)&&t.ui.intersect(n,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e))return r=!0,!1}),!r&&(!!this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(n)),this.element)))},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(){function t(t,e,i){return t>=e&&t<e+i}return function(e,i,n,r){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,s=(e.positionAbs||e.position.absolute).top+e.margins.top,a=o+e.helperProportions.width,l=s+e.helperProportions.height,h=i.offset.left,c=i.offset.top,u=h+i.proportions().width,d=c+i.proportions().height;switch(n){case"fit":return h<=o&&a<=u&&c<=s&&l<=d;case"intersect":return h<o+e.helperProportions.width/2&&a-e.helperProportions.width/2<u&&c<s+e.helperProportions.height/2&&l-e.helperProportions.height/2<d;case"pointer":return t(r.pageY,c,i.proportions().height)&&t(r.pageX,h,i.proportions().width);case"touch":return(s>=c&&s<=d||l>=c&&l<=d||s<c&&l>d)&&(o>=h&&o<=u||a>=h&&a<=u||o<h&&a>u);default:return!1}}}(),t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var n,r,o=t.ui.ddmanager.droppables[e.options.scope]||[],s=i?i.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(n=0;n<o.length;n++)if(!(o[n].options.disabled||e&&!o[n].accept.call(o[n].element[0],e.currentItem||e.element))){for(r=0;r<a.length;r++)if(a[r]===o[n].element[0]){o[n].proportions().height=0;continue t}o[n].visible="none"!==o[n].element.css("display"),o[n].visible&&("mousedown"===s&&o[n]._activate.call(o[n],i),o[n].offset=o[n].element.offset(),o[n].proportions({width:o[n].element[0].offsetWidth,height:o[n].element[0].offsetHeight}))}},drop:function(e,i){var n=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance,i)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),n},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,r,o,s=t.ui.intersect(e,this,this.options.tolerance,i),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(r=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===r}),o.length&&(n=t(o[0]).droppable("instance"),n.greedyChild="isover"===a)),n&&"isover"===a&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),n&&"isout"===a&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}};var y=(t.ui.droppable,"ui-effects-"),b=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var n=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=n.floor?~~t:parseFloat(t),isNaN(t)?e.def:n.mod?(t+n.mod)%n.mod:0>t?0:n.max<t?n.max:t)}function n(e){var i=h(),n=i._rgba=[];return e=e.toLowerCase(),p(l,function(t,r){var o,s=r.re.exec(e),a=s&&r.parse(s),l=r.space||"rgba";if(a)return o=i[l](a),i[c[l].cache]=o[c[l].cache],n=i._rgba=o._rgba,!1}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),i):o[e]}function r(t,e,i){return i=(i+1)%1,6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}var o,s="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",a=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,n,r){return new t.Color.fn.parse(e,i,n,r)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},f=t("<p>")[0],p=t.each;f.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=f.style.backgroundColor.indexOf("rgba")>-1,p(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),h.fn=t.extend(h.prototype,{parse:function(r,s,a,l){if(r===e)return this._rgba=[null,null,null,null],this;(r.jquery||r.nodeType)&&(r=t(r).css(s),s=e);var u=this,d=t.type(r),f=this._rgba=[];return s!==e&&(r=[r,s,a,l],d="array"),"string"===d?this.parse(n(r)||o._default):"array"===d?(p(c.rgba.props,function(t,e){f[e.idx]=i(r[e.idx],e)}),this):"object"===d?(r instanceof h?p(c,function(t,e){r[e.cache]&&(u[e.cache]=r[e.cache].slice())}):p(c,function(e,n){var o=n.cache;p(n.props,function(t,e){if(!u[o]&&n.to){if("alpha"===t||null==r[t])return;u[o]=n.to(u._rgba)}u[o][e.idx]=i(r[t],e,!0)}),u[o]&&t.inArray(null,u[o].slice(0,3))<0&&(u[o][3]=1,n.from&&(u._rgba=n.from(u[o])))}),this):void 0},is:function(t){var e=h(t),i=!0,n=this;return p(c,function(t,r){var o,s=e[r.cache];return s&&(o=n[r.cache]||r.to&&r.to(n._rgba)||[],p(r.props,function(t,e){if(null!=s[e.idx])return i=s[e.idx]===o[e.idx]})),i}),i},_space:function(){var t=[],e=this;return p(c,function(i,n){e[n.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var n=h(t),r=n._space(),o=c[r],s=0===this.alpha()?h("transparent"):this,a=s[o.cache]||o.to(s._rgba),l=a.slice();return n=n[o.cache],p(o.props,function(t,r){var o=r.idx,s=a[o],h=n[o],c=u[r.type]||{};null!==h&&(null===s?l[o]=h:(c.mod&&(h-s>c.mod/2?s+=c.mod:s-h>c.mod/2&&(s-=c.mod)),l[o]=i((h-s)*e+s,r)))}),this[r](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),r=h(e)._rgba;return h(t.map(i,function(t,e){return(1-n)*r[e]+n*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&e<3&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),n=i.pop();return e&&i.push(~~(255*n)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,n=t[0]/255,r=t[1]/255,o=t[2]/255,s=t[3],a=Math.max(n,r,o),l=Math.min(n,r,o),h=a-l,c=a+l,u=.5*c;return e=l===a?0:n===a?60*(r-o)/h+360:r===a?60*(o-n)/h+120:60*(n-r)/h+240,i=0===h?0:u<=.5?h/c:h/(2-c),[Math.round(e)%360,i,u,null==s?1:s]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],n=t[2],o=t[3],s=n<=.5?n*(1+i):n+i-n*i,a=2*n-s;return[Math.round(255*r(a,s,e+1/3)),Math.round(255*r(a,s,e)),Math.round(255*r(a,s,e-1/3)),o]},p(c,function(n,r){var o=r.props,s=r.cache,l=r.to,c=r.from;h.fn[n]=function(n){if(l&&!this[s]&&(this[s]=l(this._rgba)),n===e)return this[s].slice();var r,a=t.type(n),u="array"===a||"object"===a?n:arguments,d=this[s].slice();return p(o,function(t,e){var n=u["object"===a?t:e.idx];null==n&&(n=d[e.idx]),d[e.idx]=i(n,e)}),c?(r=h(c(d)),r[s]=d,r):h(d)},p(o,function(e,i){h.fn[e]||(h.fn[e]=function(r){var o,s=t.type(r),l="alpha"===e?this._hsla?"hsla":"rgba":n,h=this[l](),c=h[i.idx];return"undefined"===s?c:("function"===s&&(r=r.call(this,c),s=t.type(r)),null==r&&i.empty?this:("string"===s&&(o=a.exec(r))&&(r=c+parseFloat(o[2])*("+"===o[1]?1:-1)),h[i.idx]=r,this[l](h)))})})}),h.hook=function(e){var i=e.split(" ");p(i,function(e,i){t.cssHooks[i]={set:function(e,r){var o,s,a="";if("transparent"!==r&&("string"!==t.type(r)||(o=n(r)))){if(r=h(o||r),!d.rgba&&1!==r._rgba[3]){for(s="backgroundColor"===i?e.parentNode:e;(""===a||"transparent"===a)&&s&&s.style;)try{a=t.css(s,"backgroundColor"),s=s.parentNode}catch(t){}r=r.blend(a&&"transparent"!==a?a:"_default")}r=r.toRgbaString()}try{e.style[i]=r}catch(t){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook(s),t.cssHooks.borderColor={expand:function(t){var e={};return p(["Top","Right","Bottom","Left"],function(i,n){e["border"+n+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(b),function(){function e(e){var i,n,r=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(r&&r.length&&r[0]&&r[r[0]])for(n=r.length;n--;)i=r[n],"string"==typeof r[i]&&(o[t.camelCase(i)]=r[i]);else for(i in r)"string"==typeof r[i]&&(o[i]=r[i]);return o}function i(e,i){var n,o,s={};for(n in i)o=i[n],e[n]!==o&&(r[n]||!t.fx.step[n]&&isNaN(parseFloat(o))||(s[n]=o));return s}var n=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(b.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(r,o,s,a){var l=t.speed(o,s,a);return this.queue(function(){var o,s=t(this),a=s.attr("class")||"",h=l.children?s.find("*").addBack():s;h=h.map(function(){return{el:t(this),start:e(this)}}),o=function(){t.each(n,function(t,e){r[e]&&s[e+"Class"](r[e])})},o(),h=h.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),s.attr("class",a),h=h.map(function(){var e=this,i=t.Deferred(),n=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,n),i.promise()}),t.when.apply(t,h.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(s[0])})})},t.fn.extend({addClass:function(e){return function(i,n,r,o){return n?t.effects.animateClass.call(this,{add:i},n,r,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,n,r,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},n,r,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,n,r,o,s){return"boolean"==typeof n||n===undefined?r?t.effects.animateClass.call(this,n?{add:i}:{remove:i},r,o,s):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},n,r,o)}}(t.fn.toggleClass),switchClass:function(e,i,n,r,o){return t.effects.animateClass.call(this,{add:i,remove:e},n,r,o)}})}(),function(){function e(e,i,n,r){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(r=i,n=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(r=n,n=i,i={}),t.isFunction(n)&&(r=n,n=null),i&&t.extend(e,i),n=n||i.duration,e.duration=t.fx.off?0:"number"==typeof n?n:n in t.fx.speeds?t.fx.speeds[n]:t.fx.speeds._default,e.complete=r||i.complete,e}function i(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||("string"==typeof e&&!t.effects.effect[e]||(!!t.isFunction(e)||"object"==typeof e&&!e.effect))}t.extend(t.effects,{version:"1.11.4",save:function(t,e){for(var i=0;i<e.length;i++)null!==e[i]&&t.data(y+e[i],t[0].style[e[i]])},restore:function(t,e){var i,n;for(n=0;n<e.length;n++)null!==e[n]&&(i=t.data(y+e[n]),i===undefined&&(i=""),t.css(e[n],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,n;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=t[1]/e.width}return{x:n,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},n=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(t){o=document.body}return e.wrap(n),(e[0]===o||t.contains(e[0],o))&&t(o).focus(),n=e.parent(),"static"===e.css("position")?(n.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,n){i[n]=e.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(r),n.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,n,r){return r=r||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(r[i]=o[0]*n+o[1])}),r}}),t.fn.extend({effect:function(){function i(e){function i(){t.isFunction(o)&&o.call(r[0]),t.isFunction(e)&&e()}var r=t(this),o=n.complete,a=n.mode;(r.is(":hidden")?"hide"===a:"show"===a)?(r[a](),i()):s.call(r[0],n,i)}var n=e.apply(this,arguments),r=n.mode,o=n.queue,s=t.effects.effect[n.effect];return t.fx.off||!s?r?this[r](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):!1===o?this.each(i):this.queue(o||"fx",i)},show:function(t){return function(n){if(i(n))return t.apply(this,arguments);var r=e.apply(this,arguments);return r.mode="show",this.effect.call(this,r)}}(t.fn.show),hide:function(t){return function(n){if(i(n))return t.apply(this,arguments);var r=e.apply(this,arguments);return r.mode="hide",this.effect.call(this,r)}}(t.fn.hide),toggle:function(t){return function(n){if(i(n)||"boolean"==typeof n)return t.apply(this,arguments);var r=e.apply(this,arguments);return r.mode="toggle",this.effect.call(this,r)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),n=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(n=[parseFloat(i),e])}),n}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;t<((e=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return t<.5?i(2*t)/2:1-i(-2*t+2)/2}})}();t.effects,t.effects.effect.blind=function(e,i){var n,r,o,s=t(this),a=/up|down|vertical/,l=/up|left|vertical|horizontal/,h=["position","top","bottom","left","right","height","width"],c=t.effects.setMode(s,e.mode||"hide"),u=e.direction||"up",d=a.test(u),f=d?"height":"width",p=d?"top":"left",g=l.test(u),m={},v="show"===c;s.parent().is(".ui-effects-wrapper")?t.effects.save(s.parent(),h):t.effects.save(s,h),s.show(),n=t.effects.createWrapper(s).css({overflow:"hidden"}),r=n[f](),o=parseFloat(n.css(p))||0,m[f]=v?r:0,g||(s.css(d?"bottom":"right",0).css(d?"top":"left","auto").css({position:"absolute"}),m[p]=v?o:r+o),v&&(n.css(f,0),g||n.css(p,o+r)),n.animate(m,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){"hide"===c&&s.hide(),t.effects.restore(s,h),t.effects.removeWrapper(s),i()}})},t.effects.effect.bounce=function(e,i){var n,r,o,s=t(this),a=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(s,e.mode||"effect"),h="hide"===l,c="show"===l,u=e.direction||"up",d=e.distance,f=e.times||5,p=2*f+(c||h?1:0),g=e.duration/p,m=e.easing,v="up"===u||"down"===u?"top":"left",y="up"===u||"left"===u,b=s.queue(),_=b.length;for((c||h)&&a.push("opacity"),t.effects.save(s,a),s.show(),t.effects.createWrapper(s),d||(d=s["top"===v?"outerHeight":"outerWidth"]()/3),c&&(o={opacity:1},o[v]=0,s.css("opacity",0).css(v,y?2*-d:2*d).animate(o,g,m)),h&&(d/=Math.pow(2,f-1)),o={},o[v]=0,n=0;n<f;n++)r={},r[v]=(y?"-=":"+=")+d,s.animate(r,g,m).animate(o,g,m),d=h?2*d:d/2;h&&(r={opacity:0},r[v]=(y?"-=":"+=")+d,s.animate(r,g,m)),s.queue(function(){h&&s.hide(),t.effects.restore(s,a),t.effects.removeWrapper(s),i()}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,p+1))),s.dequeue()},t.effects.effect.clip=function(e,i){var n,r,o,s=t(this),a=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(s,e.mode||"hide"),h="show"===l,c=e.direction||"vertical",u="vertical"===c,d=u?"height":"width",f=u?"top":"left",p={};t.effects.save(s,a),s.show(),n=t.effects.createWrapper(s).css({overflow:"hidden"}),r="IMG"===s[0].tagName?n:s,o=r[d](),h&&(r.css(d,0),r.css(f,o/2)),p[d]=h?o:0,p[f]=h?0:o/2,r.animate(p,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){h||s.hide(),t.effects.restore(s,a),t.effects.removeWrapper(s),i()}})},t.effects.effect.drop=function(e,i){var n,r=t(this),o=["position","top","bottom","left","right","opacity","height","width"],s=t.effects.setMode(r,e.mode||"hide"),a="show"===s,l=e.direction||"left",h="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l?"pos":"neg",u={opacity:a?1:0};t.effects.save(r,o),r.show(),t.effects.createWrapper(r),n=e.distance||r["top"===h?"outerHeight":"outerWidth"](!0)/2,a&&r.css("opacity",0).css(h,"pos"===c?-n:n),u[h]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+n,r.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===s&&r.hide(),t.effects.restore(r,o),t.effects.removeWrapper(r),i()}})},t.effects.effect.explode=function(e,i){function n(){b.push(this),b.length===u*d&&r()}function r(){f.css({visibility:"visible"}),t(b).remove(),g||f.hide(),i()}var o,s,a,l,h,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,f=t(this),p=t.effects.setMode(f,e.mode||"hide"),g="show"===p,m=f.show().css("visibility","hidden").offset(),v=Math.ceil(f.outerWidth()/d),y=Math.ceil(f.outerHeight()/u),b=[];for(o=0;o<u;o++)for(l=m.top+o*y,c=o-(u-1)/2,s=0;s<d;s++)a=m.left+s*v,h=s-(d-1)/2,f.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-s*v,top:-o*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:a+(g?h*v:0),top:l+(g?c*y:0),opacity:g?0:1}).animate({left:a+(g?0:h*v),top:l+(g?0:c*y),opacity:g?1:0},e.duration||500,e.easing,n)},t.effects.effect.fade=function(e,i){var n=t(this),r=t.effects.setMode(n,e.mode||"toggle");n.animate({opacity:r},{queue:!1,duration:e.duration,easing:e.easing,complete:i})},t.effects.effect.fold=function(e,i){var n,r,o=t(this),s=["position","top","bottom","left","right","height","width"],a=t.effects.setMode(o,e.mode||"hide"),l="show"===a,h="hide"===a,c=e.size||15,u=/([0-9]+)%/.exec(c),d=!!e.horizFirst,f=l!==d,p=f?["width","height"]:["height","width"],g=e.duration/2,m={},v={};t.effects.save(o,s),o.show(),n=t.effects.createWrapper(o).css({overflow:"hidden"}),r=f?[n.width(),n.height()]:[n.height(),n.width()],u&&(c=parseInt(u[1],10)/100*r[h?0:1]),l&&n.css(d?{height:0,width:c}:{height:c,width:0}),m[p[0]]=l?r[0]:c,v[p[1]]=l?r[1]:0,n.animate(m,g,e.easing).animate(v,g,e.easing,function(){h&&o.hide(),t.effects.restore(o,s),t.effects.removeWrapper(o),i()})},t.effects.effect.highlight=function(e,i){var n=t(this),r=["backgroundImage","backgroundColor","opacity"],o=t.effects.setMode(n,e.mode||"show"),s={backgroundColor:n.css("backgroundColor")};"hide"===o&&(s.opacity=0),t.effects.save(n,r),n.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(s,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===o&&n.hide(),t.effects.restore(n,r),i()}})},t.effects.effect.size=function(e,i){var n,r,o,s=t(this),a=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],h=["width","height","overflow"],c=["fontSize"],u=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],f=t.effects.setMode(s,e.mode||"effect"),p=e.restore||"effect"!==f,g=e.scale||"both",m=e.origin||["middle","center"],v=s.css("position"),y=p?a:l,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===f&&s.show(),n={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},"toggle"===e.mode&&"show"===f?(s.from=e.to||b,s.to=e.from||n):(s.from=e.from||("show"===f?b:n),s.to=e.to||("hide"===f?b:n)),o={from:{y:s.from.height/n.height,x:s.from.width/n.width},to:{y:s.to.height/n.height,x:s.to.width/n.width}},"box"!==g&&"both"!==g||(o.from.y!==o.to.y&&(y=y.concat(u),s.from=t.effects.setTransition(s,u,o.from.y,s.from),s.to=t.effects.setTransition(s,u,o.to.y,s.to)),o.from.x!==o.to.x&&(y=y.concat(d),s.from=t.effects.setTransition(s,d,o.from.x,s.from),s.to=t.effects.setTransition(s,d,o.to.x,s.to))),"content"!==g&&"both"!==g||o.from.y!==o.to.y&&(y=y.concat(c).concat(h),s.from=t.effects.setTransition(s,c,o.from.y,s.from),s.to=t.effects.setTransition(s,c,o.to.y,s.to)),t.effects.save(s,y),s.show(),t.effects.createWrapper(s),s.css("overflow","hidden").css(s.from),m&&(r=t.effects.getBaseline(m,n),s.from.top=(n.outerHeight-s.outerHeight())*r.y,s.from.left=(n.outerWidth-s.outerWidth())*r.x,s.to.top=(n.outerHeight-s.to.outerHeight)*r.y,s.to.left=(n.outerWidth-s.to.outerWidth)*r.x),s.css(s.from),"content"!==g&&"both"!==g||(u=u.concat(["marginTop","marginBottom"]).concat(c),d=d.concat(["marginLeft","marginRight"]),h=a.concat(u).concat(d),s.find("*[width]").each(function(){var i=t(this),n={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};p&&t.effects.save(i,h),i.from={height:n.height*o.from.y,width:n.width*o.from.x,outerHeight:n.outerHeight*o.from.y,outerWidth:n.outerWidth*o.from.x},i.to={height:n.height*o.to.y,width:n.width*o.to.x,outerHeight:n.height*o.to.y,outerWidth:n.width*o.to.x},o.from.y!==o.to.y&&(i.from=t.effects.setTransition(i,u,o.from.y,i.from),i.to=t.effects.setTransition(i,u,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=t.effects.setTransition(i,d,o.from.x,i.from),i.to=t.effects.setTransition(i,d,o.to.x,i.to)),i.css(i.from),i.animate(i.to,e.duration,e.easing,function(){p&&t.effects.restore(i,h)})})),s.animate(s.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===s.to.opacity&&s.css("opacity",s.from.opacity),"hide"===f&&s.hide(),t.effects.restore(s,y),p||("static"===v?s.css({position:"relative",top:s.to.top,left:s.to.left}):t.each(["top","left"],function(t,e){s.css(e,function(e,i){var n=parseInt(i,10),r=t?s.to.left:s.to.top;return"auto"===i?r+"px":n+r+"px"})})),t.effects.removeWrapper(s),i()}})},t.effects.effect.scale=function(e,i){var n=t(this),r=t.extend(!0,{},e),o=t.effects.setMode(n,e.mode||"effect"),s=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===o?0:100),a=e.direction||"both",l=e.origin,h={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()},c={y:"horizontal"!==a?s/100:1,x:"vertical"!==a?s/100:1};r.effect="size",r.queue=!1,r.complete=i,"effect"!==o&&(r.origin=l||["middle","center"],r.restore=!0),r.from=e.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:h),r.to={height:h.height*c.y,width:h.width*c.x,outerHeight:h.outerHeight*c.y,outerWidth:h.outerWidth*c.x},r.fade&&("show"===o&&(r.from.opacity=0,r.to.opacity=1),"hide"===o&&(r.from.opacity=1,r.to.opacity=0)),n.effect(r)},t.effects.effect.puff=function(e,i){var n=t(this),r=t.effects.setMode(n,e.mode||"hide"),o="hide"===r,s=parseInt(e.percent,10)||150,a=s/100,l={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:r,complete:i,percent:o?s:100,from:o?l:{height:l.height*a,width:l.width*a,outerHeight:l.outerHeight*a,outerWidth:l.outerWidth*a}}),n.effect(e)},t.effects.effect.pulsate=function(e,i){var n,r=t(this),o=t.effects.setMode(r,e.mode||"show"),s="show"===o,a="hide"===o,l=s||"hide"===o,h=2*(e.times||5)+(l?1:0),c=e.duration/h,u=0,d=r.queue(),f=d.length;for(!s&&r.is(":visible")||(r.css("opacity",0).show(),u=1),n=1;n<h;n++)r.animate({opacity:u},c,e.easing),u=1-u;r.animate({opacity:u},c,e.easing),r.queue(function(){a&&r.hide(),i()}),f>1&&d.splice.apply(d,[1,0].concat(d.splice(f,h+1))),r.dequeue()},t.effects.effect.shake=function(e,i){var n,r=t(this),o=["position","top","bottom","left","right","height","width"],s=t.effects.setMode(r,e.mode||"effect"),a=e.direction||"left",l=e.distance||20,h=e.times||3,c=2*h+1,u=Math.round(e.duration/c),d="up"===a||"down"===a?"top":"left",f="up"===a||"left"===a,p={},g={},m={},v=r.queue(),y=v.length;for(t.effects.save(r,o),r.show(),t.effects.createWrapper(r),p[d]=(f?"-=":"+=")+l,g[d]=(f?"+=":"-=")+2*l,m[d]=(f?"-=":"+=")+2*l,r.animate(p,u,e.easing),n=1;n<h;n++)r.animate(g,u,e.easing).animate(m,u,e.easing);r.animate(g,u,e.easing).animate(p,u/2,e.easing).queue(function(){"hide"===s&&r.hide(),t.effects.restore(r,o),t.effects.removeWrapper(r),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,c+1))),r.dequeue()},t.effects.effect.slide=function(e,i){var n,r=t(this),o=["position","top","bottom","left","right","width","height"],s=t.effects.setMode(r,e.mode||"show"),a="show"===s,l=e.direction||"left",h="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,u={};t.effects.save(r,o),r.show(),n=e.distance||r["top"===h?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(r).css({overflow:"hidden"}),a&&r.css(h,c?isNaN(n)?"-"+n:-n:n),u[h]=(a?c?"+=":"-=":c?"-=":"+=")+n,r.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===s&&r.hide(),t.effects.restore(r,o),t.effects.removeWrapper(r),i()}})},t.effects.effect.transfer=function(e,i){var n=t(this),r=t(e.to),o="fixed"===r.css("position"),s=t("body"),a=o?s.scrollTop():0,l=o?s.scrollLeft():0,h=r.offset(),c={top:h.top-a,left:h.left-l,height:r.innerHeight(),width:r.innerWidth()},u=n.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:u.top-a,left:u.left-l,height:n.innerHeight(),width:n.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),i()})},t.widget("ui.progressbar",{version:"1.11.4",options:{
max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(t){if(t===undefined)return this.options.value;this.options.value=this._constrainedValue(t),this._refreshValue()},_constrainedValue:function(t){return t===undefined&&(t=this.options.value),this.indeterminate=!1===t,"number"!=typeof t&&(t=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!e).attr("aria-disabled",e),this._super(t,e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(i.options.filter,i.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var i=this,n=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(n.filter,this.element[0]),this._trigger("start",e),t(n.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=t.data(this,"selectable-item");n.startselected=!0,e.metaKey||e.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",e,{unselecting:n.element}))}),t(e.target).parents().addBack().each(function(){var n,r=t.data(this,"selectable-item");if(r)return n=!e.metaKey&&!e.ctrlKey||!r.$element.hasClass("ui-selected"),r.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),r.unselecting=!n,r.selecting=n,r.selected=n,n?i._trigger("selecting",e,{selecting:r.element}):i._trigger("unselecting",e,{unselecting:r.element}),!1}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,n=this,r=this.options,o=this.opos[0],s=this.opos[1],a=e.pageX,l=e.pageY;return o>a&&(i=a,a=o,o=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:l-s}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1;i&&i.element!==n.element[0]&&("touch"===r.tolerance?h=!(i.left>a||i.right<o||i.top>l||i.bottom<s):"fit"===r.tolerance&&(h=i.left>o&&i.right<a&&i.top>s&&i.bottom<l),h?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,n._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",e,{unselected:n.element})}),t(".ui-selecting",this.element[0]).each(function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",e,{selected:n.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var t=this.element.uniqueId().attr("id");this.ids={element:t,button:t+"-button",menu:t+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var e=this;this.label=t("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{"class":"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),t("<span>",{"class":"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=t("<span>",{"class":"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){e.menuItems||e._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>",{"class":"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var n=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&n.index!==e.focusIndex&&(e._trigger("focus",t,{item:n}),e.isOpen||e._select(n,t)),e.focusIndex=n.index,e.button.attr("aria-activedescendant",e.menuItems.eq(n.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var t,e=this.element.find("option");e.length&&(this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(e,i){var n=this,r="";t.each(i,function(i,o){o.optgroup!==r&&(t("<li>",{"class":"ui-selectmenu-optgroup ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:o.optgroup}).appendTo(e),r=o.optgroup),n._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var n=t("<li>");return i.disabled&&n.addClass("ui-state-disabled"),this._setText(n,i.label),n.appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,n,r=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),r+=":not(.ui-state-disabled)"),n="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](r).eq(-1):i[t+"All"](r).eq(0),n.length&&this.menuInstance.focus(e,n)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex);e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this._setText(this.buttonText,t.label),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){"icons"===t&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(e.button),this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"disabled"===t&&(this.menuInstance.option("disabled",e),this.button.toggleClass("ui-state-disabled",e).attr("aria-disabled",e),this.element.prop("disabled",e),e?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===t&&this._resizeButton()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;t||(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(e){var i=[];e.each(function(e,n){var r=t(n),o=r.parent("optgroup");i.push({element:r,index:e,value:r.val(),label:r.text(),optgroup:o.attr("label")||"",disabled:o.prop("disabled")||r.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),t.widget("ui.slider",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,n=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o=[];for(i=n.values&&n.values.length||1,r.length>i&&(r.slice(i).remove(),r=r.slice(0,i)),e=r.length;e<i;e++)o.push("<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>");this.handles=r.add(t(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(!0===e.range&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,n,r,o,s,a,l,h=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(i),r=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(n-h.values(e));(r>i||r===i&&(e===h._lastChangedValue||h.values(e)===c.min))&&(r=i,o=t(this),s=e)}),!1!==this._start(e,s)&&(this._mouseSliding=!0,this._handleIndex=s,o.addClass("ui-state-active").focus(),a=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-a.left-o.width()/2,top:e.pageY-a.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,s,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,n,r,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/e,n>1&&(n=1),n<0&&(n=0),"vertical"===this.orientation&&(n=1-n),r=this._valueMax()-this._valueMin(),o=this._valueMin()+n*r,this._trimAlignValue(o)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var n,r,o;this.options.values&&this.options.values.length?(n=this.values(e?0:1),2===this.options.values.length&&!0===this.options.range&&(0===e&&i>n||1===e&&i<n)&&(i=n),i!==this.values(e)&&(r=this.values(),r[e]=i,o=this._trigger("slide",t,{handle:this.handles[e],value:i,values:r}),n=this.values(e?0:1),!1!==o&&this.values(e,i))):i!==this.value()&&!1!==(o=this._trigger("slide",t,{handle:this.handles[e],value:i}))&&this.value(i)},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var n,r,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(n=this.options.values,r=arguments[0],o=0;o<n.length;o+=1)n[o]=this._trimAlignValue(r[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var n,r=0;switch("range"===e&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(r=this.options.values.length),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!i),this._super(e,i),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;n<r;n+=1)this._change(null,n);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,n;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i}return[]},_trimAlignValue:function(t){if(t<=this._valueMin())return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,n=t-i;return 2*Math.abs(i)>=e&&(n+=i>0?e:-e),parseFloat(n.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step;t=Math.floor(+(t-e).toFixed(this._precision())/i)*i+e,this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=t.toString(),i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var e,i,n,r,o,s=this.options.range,a=this.options,l=this,h=!this._animateOff&&a.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](c,a.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},a.animate),1===n&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:a.animate})):(0===n&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},a.animate),1===n&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:a.animate}))),e=i}):(n=this.value(),r=this._valueMin(),o=this._valueMax(),i=o!==r?(n-r)/(o-r)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](c,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:a.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(e){var i,n,r,o=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(e.target).addClass("ui-state-active"),!1===this._start(e,o)))return}switch(r=this.options.step,i=n=this.options.values&&this.options.values.length?this.values(o):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(i===this._valueMax())return;n=this._trimAlignValue(i+r);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(i===this._valueMin())return;n=this._trimAlignValue(i-r)}this._slide(e,o,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&t<e+i},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),t.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var n=null,r=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){if(t.data(this,o.widgetName+"-item")===o)return n=t(this),!1}),t.data(e.target,o.widgetName+"-item")===o&&(n=t(e.target)),!!n&&(!(this.options.handle&&!i&&(t(this.options.handle,n).find("*").addBack().each(function(){this===e.target&&(r=!0)}),!r))&&(this.currentItem=n,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,n){var r,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=t("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,n,r,o,s=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(e.pageY-this.document.scrollTop()<s.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-s.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<s.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+s.scrollSpeed)),e.pageX-this.document.scrollLeft()<s.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-s.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<s.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+s.scrollSpeed))),!1!==a&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],r=n.item[0],(o=this._intersectsWithPointer(n))&&n.instance===this.currentContainer&&!(r===this.currentItem[0]||this.placeholder[1===o?"next":"prev"]()[0]===r||t.contains(this.placeholder[0],r)||"semi-dynamic"===this.options.type&&t.contains(this.element[0],r))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,r=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){n._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/)
;i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each(function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,o=t.left,s=o+t.width,a=t.top,l=a+t.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||n+h>a&&n+h<l,d="y"===this.options.axis||e+c>o&&e+c<s,f=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?f:o<e+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&a<n+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=e&&i,r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return!!n&&(this.floating?o&&"right"===o||"down"===r?2:1:r&&("down"===r?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"===r&&i||"left"===r&&!i:n&&("down"===n&&e||"up"===n&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){a.push(this)}var n,r,o,s,a=[],l=[],h=this._connectWith();if(h&&e)for(n=h.length-1;n>=0;n--)for(o=t(h[n],this.document[0]),r=o.length-1;r>=0;r--)(s=t.data(o[r],this.widgetFullName))&&s!==this&&!s.options.disabled&&l.push([t.isFunction(s.options.items)?s.options.items.call(s.element):t(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=l.length-1;n>=0;n--)l[n][0].each(i);return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;i<e.length;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,n,r,o,s,a,l,h,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(r=t(d[i],this.document[0]),n=r.length-1;n>=0;n--)(o=t.data(r[n],this.widgetFullName))&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(s=u[i][1],a=u[i][0],n=0,h=a.length;n<h;n++)l=t(a[n]),l.data(this.widgetName+"-item",s),c.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,r,o;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item,e||(n.width=r.outerWidth(),n.height=r.outerHeight()),o=r.offset(),n.left=o.left,n.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,n=e.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=e.currentItem[0].nodeName.toLowerCase(),r=t("<"+n+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===n?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(r)):"tr"===n?e._createTrPlaceholder(e.currentItem,r):"img"===n&&r.attr("src",e.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(t,r){i&&!n.forcePlaceholderSize||(r.height()||r.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(n.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),n.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var n=this;e.children().each(function(){t("<td>&#160;</td>",n.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,n,r,o,s,a,l,h,c,u,d=null,f=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],f=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[f].containerCache.over||(this.containers[f]._trigger("over",e,this._uiHash(this)),this.containers[f].containerCache.over=1);else{for(r=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),s=c?"left":"top",a=c?"width":"height",u=c?"clientX":"clientY",n=this.items.length-1;n>=0;n--)t.contains(this.containers[f].element[0],this.items[n].item[0])&&this.items[n].item[0]!==this.currentItem[0]&&(l=this.items[n].item.offset()[s],h=!1,e[u]-l>this.items[n][a]/2&&(h=!0),Math.abs(e[u]-l)<r&&(r=Math.abs(e[u]-l),o=this.items[n],this.direction=h?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[f])return void(this.currentContainer.containerCache.over||(this.containers[f]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[f].element,!0),this._trigger("change",e,this._uiHash()),this.containers[f]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[f],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[f]._trigger("over",e,this._uiHash(this)),this.containers[f].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),n[0].style.width&&!i.forceHelperSize||n.width(this.currentItem.width()),n[0].style.height&&!i.forceHelperSize||n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),"document"!==r.containment&&"window"!==r.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===r.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===r.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(e=t(r.containment)[0],i=t(r.containment).offset(),n="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n}},_generatePosition:function(e){var i,n,r=this.options,o=e.pageX,s=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0],o=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(t,e){function i(t,e,i){return function(n){i._trigger(t,n,e._uiHash(e))}}this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)"auto"!==this._storedCSS[n]&&"static"!==this._storedCSS[n]||(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&r.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||r.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(r.push(function(t){this._trigger("remove",t,this._uiHash())}),r.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)e||r.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(n=0;n<r.length;n++)r[n].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e={},i=this.element;return t.each(["min","max","step"],function(t,n){var r=i.attr(n);r!==undefined&&r.length&&(e[n]=r)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){if(this.cancelBlur)return void delete this.cancelBlur;this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){this.element[0]===this.document[0].activeElement||(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n}))}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(e)&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){if(t(e.currentTarget).hasClass("ui-state-active"))return!1!==this._start(e)&&void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var t=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=t.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*t.height())&&t.height()>0&&t.height(t.height()),this.options.disabled&&this.disable()},_keydown:function(e){var i=this.options,n=t.ui.keyCode;switch(e.keyCode){case n.UP:return this._repeat(null,1,e),!0;case n.DOWN:return this._repeat(null,-1,e),!0;case n.PAGE_UP:return this._repeat(null,i.page,e),!0;case n.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(t){return!(!this.spinning&&!1===this._trigger("start",t))&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",e,{value:i})||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=t.toString(),i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,n=this.options;return e=null!==n.min?n.min:0,i=t-e,i=Math.round(i/n.step)*n.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==n.max&&t>n.max?n.max:null!==n.min&&t<n.min?n.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){if("culture"===t||"numberFormat"===t){var i=this._parse(this.element.val());return this.options[t]=e,void this.element.val(this._format(i))}"max"!==t&&"min"!==t&&"step"!==t||"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),this._super(t,e),"disabled"===t&&(this.widget().toggleClass("ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable"))},_setOptions:l(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null!==t&&t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&null!==(i=this._parse(t))&&(e||(i=this._adjustValue(i)),t=this._format(i)),this.element.val(t),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:l(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:l(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:l(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:l(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){if(!arguments.length)return this._parse(this.element.val());l(this._value).call(this,t)},widget:function(){return this.uiSpinner}}),t.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,n;e=e.cloneNode(!1),i=e.href.replace(t,""),n=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(t){}try{n=decodeURIComponent(n)}catch(t){}return e.hash.length>1&&i===n}}(),_create:function(){var e=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(i.active):this.active=t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,n=location.hash.substring(1);return null===e&&(n&&this.tabs.each(function(i,r){if(t(r).attr("aria-controls")===n)return e=i,!1}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==e&&-1!==e||(e=!!this.tabs.length&&0)),!1!==e&&-1===(e=this.tabs.index(this.tabs.eq(e)))&&(e=!i&&0),!i&&!1===e&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(this.document[0].activeElement).closest("li"),n=this.tabs.index(i),r=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:n++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:r=!1,n--;break;case t.ui.keyCode.END:n=this.anchors.length-1;break;case t.ui.keyCode.HOME:n=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(n);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(n!==this.options.active&&n);default:return}e.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,r),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(n).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",n)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function n(){return e>r&&(e=0),e<0&&(e=r),e}for(var r=this.tabs.length-1;-1!==t.inArray(n(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).focus(),t},_setOption:function(t,e){return"active"===t?void this._activate(e):"disabled"===t?void this._setupDisabled(e):(this._super(t,e),"collapsible"===t&&(this.element.toggleClass("ui-tabs-collapsible",e),e||!1!==this.options.active||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),!1!==e.active&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,n=this.anchors,r=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=t(),this.anchors.each(function(i,n){var r,o,s,a=t(n).uniqueId().attr("id"),l=t(n).closest("li"),h=l.attr("aria-controls");e._isLocal(n)?(r=n.hash,s=r.substring(1),o=e.element.find(e._sanitizeSelector(r))):(s=l.attr("aria-controls")||t({}).uniqueId()[0].id,r="#"+s,o=e.element.find(r),o.length||(o=e._createPanel(s),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),h&&l.data("ui-tabs-aria-controls",h),l.attr({"aria-controls":s,"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(n.not(this.anchors)),this._off(r.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var i,n=0;i=this.tabs[n];n++)!0===e||-1!==t.inArray(n,e)?t(i).addClass("ui-state-disabled").attr("aria-disabled","true"):t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,n=this.element.parent();"fill"===e?(i=n.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),n=e.css("position");"absolute"!==n&&"fixed"!==n&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,n=this.active,r=t(e.currentTarget),o=r.closest("li"),s=o[0]===n[0],a=s&&i.collapsible,l=a?t():this._getPanelForTab(o),h=n.length?this._getPanelForTab(n):t(),c={oldTab:n,oldPanel:h,newTab:a?t():o,newPanel:l};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||s&&!i.collapsible||!1===this._trigger("beforeActivate",e,c)||(i.active=!a&&this.tabs.index(o),this.active=s?t():o,this.xhr&&this.xhr.abort(),h.length||l.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function n(){o.running=!1,o._trigger("activate",e,i)}function r(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&o.options.show?o._show(s,o.options.show,n):(s.show(),n())}var o=this,s=i.newPanel,a=i.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a.hide(),r()),a.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),s.length&&a.length?i.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,n=this._findActive(e);n[0]!==this.active[0]&&(n.length||(n=this.active),i=n.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return!1===e?t():this.tabs.eq(e)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+t+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),
this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;!1!==i&&(e===undefined?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setupDisabled(i))},disable:function(e){var i=this.options.disabled;if(!0!==i){if(e===undefined)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setupDisabled(i)}},load:function(e,i){e=this._getIndex(e);var n=this,r=this.tabs.eq(e),o=r.find(".ui-tabs-anchor"),s=this._getPanelForTab(r),a={tab:r,panel:s},l=function(t,e){"abort"===e&&n.panels.stop(!1,!0),r.removeClass("ui-tabs-loading"),s.removeAttr("aria-busy"),t===n.xhr&&delete n.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,a)),this.xhr&&"canceled"!==this.xhr.statusText&&(r.addClass("ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.done(function(t,e,r){setTimeout(function(){s.html(t),n._trigger("load",i,a),l(r,e)},1)}).fail(function(t,e){setTimeout(function(){l(t,e)},1)})))},_ajaxSettings:function(e,i,n){var r=this;return{url:e.attr("href"),beforeSend:function(e,o){return r._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},n))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var n=(e.attr("aria-describedby")||"").split(/\s+/);n.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(n.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),n=(e.attr("aria-describedby")||"").split(/\s+/),r=t.inArray(i,n);-1!==r&&n.splice(r,1),e.removeData("ui-tooltip-id"),n=t.trim(n.join(" ")),n?e.attr("aria-describedby",n):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(e,i){var n=this;if("disabled"===e)return this[i?"_disable":"_enable"](),void(this.options[e]=i);this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){n._updateContent(e.element)})},_disable:function(){var e=this;t.each(this.tooltips,function(i,n){var r=t.Event("blur");r.target=r.currentTarget=n.element[0],e.close(r,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,n=t(e?e.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&n.parents().each(function(){var e,n=t(this);n.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))}),this._registerCloseHandlers(e,n),this._updateContent(n,e))},_updateContent:function(t,e){var i,n=this.options.content,r=this,o=e?e.type:null;if("string"==typeof n)return this._open(e,t,n);(i=n.call(t[0],function(i){r._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}))&&this._open(e,t,i)},_open:function(e,i,n){function r(t){h.of=t,s.is(":hidden")||s.position(h)}var o,s,a,l,h=t.extend({},this.options.position);if(n){if(o=this._find(i))return void o.tooltip.find(".ui-tooltip-content").html(n);i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),s=o.tooltip,this._addDescribedBy(i,s.attr("id")),s.find(".ui-tooltip-content").html(n),this.liveRegion.children().hide(),n.clone?(l=n.clone(),l.removeAttr("id").find("[id]").removeAttr("id")):l=n,t("<div>").html(l).appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:r}),r(e)):s.position(t.extend({of:i},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(a=this.delayedShow=setInterval(function(){s.is(":visible")&&(r(h.of),clearInterval(a))},t.fx.interval)),this._trigger("open",e,{tooltip:s})}},_registerCloseHandlers:function(e,i){var n={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var n=t.Event(e);n.currentTarget=i[0],this.close(n,!0)}}};i[0]!==this.element[0]&&(n.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(n.mouseleave="close"),e&&"focusin"!==e.type||(n.focusout="close"),this._on(!0,i,n)},close:function(e){var i,n=this,r=t(e?e.currentTarget:this.element),o=this._find(r);if(!o)return void r.removeData("ui-tooltip-open");i=o.tooltip,o.closing||(clearInterval(this.delayedShow),r.data("ui-tooltip-title")&&!r.attr("title")&&r.attr("title",r.data("ui-tooltip-title")),this._removeDescribedBy(r),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){n._removeTooltip(t(this))}),r.removeData("ui-tooltip-open"),this._off(r,"mouseleave focusout keyup"),r[0]!==this.element[0]&&this._off(r,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete n.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1))},_tooltip:function(e){var i=t("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),n=i.uniqueId().attr("id");return t("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(i,n){var r=t.Event("blur"),o=n.element;r.target=r.currentTarget=o[0],e.close(r,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})}),function(t,e,i,n){"use strict";function r(e,i){e||(i=i?": "+i:"",t.error("Fancytree assertion failed"+i))}function o(t,i){var n,r,o=e.console?e.console[t]:null;if(o)try{o.apply(e.console,i)}catch(t){for(r="",n=0;n<i.length;n++)r+=i[n];o(r)}}function s(t){return!(!t.tree||t.statusNodeType===n)}function a(e){var i,n,r,o=t.map(t.trim(e).split("."),function(t){return parseInt(t,10)}),s=t.map(Array.prototype.slice.call(arguments,1),function(t){return parseInt(t,10)});for(i=0;i<s.length;i++)if(n=o[i]||0,r=s[i]||0,n!==r)return n>r;return!0}function l(t,e,i,n,r){return function(){var i=e[t],o=n[t],s=e.ext[r],a=function(){return i.apply(e,arguments)},l=function(t){return i.apply(e,t)};return function(){var t=e._local,i=e._super,n=e._superApply;try{return e._local=s,e._super=a,e._superApply=l,o.apply(e,arguments)}finally{e._local=t,e._super=i,e._superApply=n}}}()}function h(e,i,n,r){for(var o in n)"function"==typeof n[o]?"function"==typeof e[o]?e[o]=l(o,e,i,n,r):"_"===o.charAt(0)?e.ext[r][o]=l(o,e,i,n,r):t.error("Could not override tree."+o+". Use prefix '_' to create tree."+r+"._"+o):"options"!==o&&(e.ext[r][o]=n[o])}function c(e,i){return e===n?t.Deferred(function(){this.resolve()}).promise():t.Deferred(function(){this.resolveWith(e,i)}).promise()}function u(e,i){return e===n?t.Deferred(function(){this.reject()}).promise():t.Deferred(function(){this.rejectWith(e,i)}).promise()}function d(t,e){return function(){t.resolveWith(e)}}function f(e){var i=t.extend({},e.data()),n=i.json;return delete i.fancytree,delete i.uiFancytree,n&&(delete i.json,i=t.extend(i,n)),i}function p(t){return(""+t).replace(C,function(t){return T[t]})}function g(t){return t=t.toLowerCase(),function(e){return e.title.toLowerCase().indexOf(t)>=0}}function m(t){var e=new RegExp("^"+t,"i");return function(t){return e.test(t.title)}}function v(e,i){var n,o,s,a;for(this.parent=e,this.tree=e.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},n=0,o=N.length;n<o;n++)s=N[n],this[s]=i[s];i.data&&t.extend(this.data,i.data);for(s in i)M[s]||t.isFunction(i[s])||A[s]||(this.data[s]=i[s]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),r(this.key,"defaultKey() must return a unique key")):this.key="_"+w._nextNodeKey++:this.key=""+this.key,i.active&&(r(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),i.selected&&(this.tree.lastSelectedNode=this),a=i.children,a?a.length?this._setChildren(a):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function y(e){this.widget=e,this.$div=e.element,this.options=e.options,this.options&&(t.isFunction(this.options.lazyload)&&!t.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){return w.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),e.options.lazyload.apply(this,arguments)}),t.isFunction(this.options.loaderror)&&t.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),this.options.fx!==n&&w.warn("The 'fx' options was replaced by 'toggleEffect' since 2014-11-30.")),this.ext={},this.data=f(this.$div),this._id=t.ui.fancytree._nextId++,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var i,r={tree:this};this.rootNode=new v(r,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,i=t("<ul>",{"class":"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=i,this.rootNode.ul=i[0],null==this.options.debugLevel&&(this.options.debugLevel=w.debugLevel),this.$container.attr("tabindex",this.options.tabindex),this.options.aria&&this.$container.attr("role","tree").attr("aria-multiselectable",!0)}if(t.ui&&t.ui.fancytree)return void t.ui.fancytree.warn("Fancytree: ignored duplicate include");var b,_,w=null,x=new RegExp(/\.|\//),C=/[&<>"'\/]/g,S="$recursive_request",T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},k={16:!0,17:!0,18:!0},E={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},P={0:"",1:"left",2:"middle",3:"right"},D="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),I={},N="expanded extraClasses folder hideCheckbox icon key lazy refKey selected statusNodeType title tooltip unselectable".split(" "),M={},L={},A={active:!0,children:!0,data:!0,focus:!0};for(b=0;b<D.length;b++)I[D[b]]=!0;for(b=0;b<N.length;b++)_=N[b],M[_]=!0,_!==_.toLowerCase()&&(L[_.toLowerCase()]=_);r(t.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),v.prototype={_findDirectChild:function(t){var e,i,n=this.children;if(n)if("string"==typeof t){for(e=0,i=n.length;e<i;e++)if(n[e].key===t)return n[e]}else{if("number"==typeof t)return this.children[t];if(t.parent===this)return t}return null},_setChildren:function(t){r(t&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var e=0,i=t.length;e<i;e++)this.children.push(new v(this,t[e]))},addChildren:function(e,i){var n,o,s,a=null,l=[];for(t.isPlainObject(e)&&(e=[e]),this.children||(this.children=[]),n=0,o=e.length;n<o;n++)l.push(new v(this,e[n]));return a=l[0],null==i?this.children=this.children.concat(l):(i=this._findDirectChild(i),s=t.inArray(i,this.children),r(s>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[s,0].concat(l))),(!this.parent||this.parent.ul||this.tr)&&this.render(),3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),a},addClass:function(t){return this.toggleClass(t,!0)},addNode:function(t,e){switch(e!==n&&"over"!==e||(e="child"),e){case"after":return this.getParent().addChildren(t,this.getNextSibling());case"before":return this.getParent().addChildren(t,this);case"firstChild":var i=this.children?this.children[0]:null;return this.addChildren(t,i);case"child":case"over":return this.addChildren(t)}r(!1,"Invalid mode: "+e)},addPagingNode:function(e,i){var n,r;if(i=i||"child",!1===e){for(n=this.children.length-1;n>=0;n--)r=this.children[n],"paging"===r.statusNodeType&&this.removeChild(r);return void(this.partload=!1)}return e=t.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},e),this.partload=!0,this.addNode(e,i)},appendSibling:function(t){return this.addNode(t,"after")},applyPatch:function(e){if(null===e)return this.remove(),c(this);var i,n,r={children:!0,expanded:!0,parent:!0};for(i in e)n=e[i],r[i]||t.isFunction(n)||(M[i]?this[i]=n:this.data[i]=n);return e.hasOwnProperty("children")&&(this.removeChildren(),e.children&&this._setChildren(e.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),e.hasOwnProperty("expanded")?this.setExpanded(e.expanded):c(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(t,e,i){return t.addNode(this.toDict(!0,i),e)},countChildren:function(t){var e,i,n,r=this.children;if(!r)return 0;if(n=r.length,!1!==t)for(e=0,i=n;e<i;e++)n+=r[e].countChildren();return n},debug:function(){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(t){var e=t?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(e,this)},findAll:function(e){e=t.isFunction(e)?e:g(e);var i=[];return this.visit(function(t){e(t)&&i.push(t)}),i},findFirst:function(e){e=t.isFunction(e)?e:g(e);var i=null;return this.visit(function(t){if(e(t))return i=t,!1}),i},_changeSelectStatusAttrs:function(t){var e=!1;switch(t){case!1:e=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:e=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case n:e=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:r(!1,"invalid state: "+t)}return e&&this.renderStatus(),e},fixSelection3AfterClick:function(){var t=this.isSelected();this.visit(function(e){e._changeSelectStatusAttrs(t)}),this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){function t(e){var i,r,o,s,a,l,h,c=e.children;if(c&&c.length){for(l=!0,h=!1,i=0,r=c.length;i<r;i++)o=c[i],s=t(o),!1!==s&&(h=!0),!0!==s&&(l=!1);a=!!l||!!h&&n}else a=!!e.selected;return e._changeSelectStatusAttrs(a),a}r(3===this.tree.options.selectMode,"expected selectMode 3"),t(this),this.visitParents(function(t){var e,i,r,o,s=t.children,a=!0,l=!1;for(e=0,i=s.length;e<i;e++)r=s[e],(r.selected||r.partsel)&&(l=!0),r.unselectable||r.selected||(a=!1);o=!!a||!!l&&n,t._changeSelectStatusAttrs(o)})},fromDict:function(e){for(var i in e)M[i]?this[i]=e[i]:"data"===i?t.extend(this.data,e.data):t.isFunction(e[i])||A[i]||(this.data[i]=e[i]);e.children&&(this.removeChildren(),this.addChildren(e.children)),this.renderTitle()},getChildren:function(){return this.hasChildren()===n?n:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return t.inArray(this,this.parent.children)},getIndexHier:function(e,i){e=e||".";var n,r=[];return t.each(this.getParentList(!1,!0),function(t,e){n=""+(e.getIndex()+1),i&&(n=("0000000"+n).substr(-i)),r.push(n)}),r.join(e)},getKeyPath:function(t){var e=[],i=this.tree.options.keyPathSeparator;return this.visitParents(function(t){t.parent&&e.unshift(t.key)},!t),i+e.join(i)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},getNextSibling:function(){if(this.parent){var t,e,i=this.parent.children;for(t=0,e=i.length-1;t<e;t++)if(i[t]===this)return i[t+1]}return null},getParent:function(){return this.parent},getParentList:function(t,e){for(var i=[],n=e?this:this.parent;n;)(t||n.parent)&&i.unshift(n),n=n.parent;return i},getPrevSibling:function(){if(this.parent){var t,e,i=this.parent.children;for(t=1,e=i.length;t<e;t++)if(i[t]===this)return i[t-1]}return null},getSelectedNodes:function(t){var e=[];return this.visit(function(i){if(i.selected&&(e.push(i),!0===t))return"skip"}),e},hasChildren:function(){return this.lazy?null==this.children?n:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||n):!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(){this.tree.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},isActive:function(){return this.tree.activeNode===this},isChildOf:function(t){return this.parent&&this.parent===t},isDescendantOf:function(t){if(!t||t.tree!==this.tree)return!1;for(var e=this.parent;e;){if(e===t)return!0;e=e.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var t=this.parent;return!t||t.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var t=this.parent;return!t||t.children[t.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==n},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return this.hasChildren()===n},isVisible:function(){var t,e,i=this.getParentList(!1,!1);for(t=0,e=i.length;t<e;t++)if(!i[t].expanded)return!1;return!0},lazyLoad:function(t){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(t)},load:function(t){var e,i,n=this;return r(this.isLazy(),"load() requires a lazy node"),t||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(i=this.tree._triggerNodeEvent("lazyLoad",this))?c(this):(r("boolean"!=typeof i,"lazyLoad event must return source in data.result"),e=this.tree._callHook("nodeLoadChildren",this,i),this.expanded&&e.always(function(){n.render()}),e)):c(this)},makeVisible:function(e){var i,n=this,r=[],o=new t.Deferred,s=this.getParentList(!1,!1),a=s.length,l=!(e&&!0===e.noAnimation),h=!(e&&!1===e.scrollIntoView);for(i=a-1;i>=0;i--)r.push(s[i].setExpanded(!0,e));return t.when.apply(t,r).done(function(){h?n.scrollIntoView(l).done(function(){o.resolve()}):o.resolve()}),o.promise()},moveTo:function(e,i,o){i===n||"over"===i?i="child":"firstChild"===i&&(e.children&&e.children.length?(i="before",e=e.children[0]):i="child");var s,a=this.parent,l="child"===i?e:e.parent;if(this!==e){if(this.parent?l.isDescendantOf(this)&&t.error("Cannot move a node to its own descendant"):t.error("Cannot move system root"),1===this.parent.children.length){if(this.parent===l)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else s=t.inArray(this,this.parent.children),r(s>=0,"invalid source parent"),this.parent.children.splice(s,1);if(this.parent=l,l.hasChildren())switch(i){case"child":l.children.push(this);break;case"before":s=t.inArray(e,l.children),r(s>=0,"invalid target parent"),l.children.splice(s,0,this);break;case"after":s=t.inArray(e,l.children),r(s>=0,"invalid target parent"),l.children.splice(s+1,0,this);break;default:t.error("Invalid mode "+i)}else l.children=[this];o&&e.visit(o,!0),this.tree!==e.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(t){t.tree=e.tree},!0)),a.isDescendantOf(l)||a.render(),l.isDescendantOf(a)||l===a||l.render()}},navigate:function(e,i){function n(n){if(n){try{n.makeVisible()}catch(t){}return t(n.span).is(":visible")?!1===i?n.setFocus():n.setActive():(n.debug("Navigate: skipping hidden node"),void n.navigate(e,i))}}var r,o,s,a=t.ui.keyCode,l=null;switch(e){case a.BACKSPACE:this.parent&&this.parent.parent&&(s=n(this.parent));break;case a.LEFT:this.expanded?(this.setExpanded(!1),s=n(this)):this.parent&&this.parent.parent&&(s=n(this.parent));break;case a.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&(s=n(this.children[0])):(this.setExpanded(),s=n(this));break;case a.UP:for(l=this.getPrevSibling();l&&!t(l.span).is(":visible");)l=l.getPrevSibling();for(;l&&l.expanded&&l.children&&l.children.length;)l=l.children[l.children.length-1];!l&&this.parent&&this.parent.parent&&(l=this.parent),s=n(l);break;case a.DOWN:if(this.expanded&&this.children&&this.children.length)l=this.children[0];else for(o=this.getParentList(!1,!0),r=o.length-1;r>=0;r--){for(l=o[r].getNextSibling();l&&!t(l.span).is(":visible");)l=l.getNextSibling();if(l)break}s=n(l);break;default:!1}return s||c()},remove:function(){return this.parent.removeChild(this)},removeChild:function(t){return this.tree._callHook("nodeRemoveChild",this,t)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(t){return this.toggleClass(t,!1)},render:function(t,e){return this.tree._callHook("nodeRender",this,t,e)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(e){var i,n=this.parent,o=t.inArray(this,n.children),s=this;return r(this.isPagingNode(),"replaceWith() currently requires a paging status node"),i=this.tree._callHook("nodeLoadChildren",this,e),i.done(function(){var t=s.children;for(b=0;b<t.length;b++)t[b].parent=n;n.children.splice.apply(n.children,[o+1,0].concat(t)),s.children=null,s.remove(),n.render()}).fail(function(){s.setExpanded()}),i},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=n,this.renderStatus()},scheduleAction:function(e,i){this.tree.timer&&clearTimeout(this.tree.timer),this.tree.timer=null;var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},i);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},i);break;default:t.error("Invalid mode "+e)}},scrollIntoView:function(o,a){a!==n&&s(a)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),a={topNode:a});var l,h,u,d,f=t.extend({effects:!0===o?{duration:200,queue:!1}:o,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},a),p=new t.Deferred,g=this,m=t(this.span).height(),v=t(f.scrollParent),y=f.scrollOfs.top||0,b=f.scrollOfs.bottom||0,_=v.height(),w=v.scrollTop(),x=v,C=v[0]===e,S=f.topNode||null,T=null;return t(this.span).is(":visible")?(C?(h=t(this.span).offset().top,l=S&&S.span?t(S.span).offset().top:0,x=t("html,body")):(r(v[0]!==i&&v[0]!==i.body,"scrollParent should be a simple element or `window`, not document or body."),d=v.offset().top,h=t(this.span).offset().top-d+w,l=S?t(S.span).offset().top-d+w:0,u=Math.max(0,v.innerHeight()-v[0].clientHeight),_-=u),h<w+y?T=h-y:h+m>w+_-b&&(T=h+m-_+b,S&&(r(S.isRootNode()||t(S.span).is(":visible"),"topNode must be visible"),l<T&&(T=l-y))),null!==T?f.effects?(f.effects.complete=function(){p.resolveWith(g)},x.stop(!0).animate({scrollTop:T},f.effects)):(x[0].scrollTop=T,p.resolveWith(this)):p.resolveWith(this),p.promise()):(this.warn("scrollIntoView(): node is invisible."),c())},setActive:function(t,e){return this.tree._callHook("nodeSetActive",this,t,e)},setExpanded:function(t,e){return this.tree._callHook("nodeSetExpanded",this,t,e)},setFocus:function(t){return this.tree._callHook("nodeSetFocus",this,t)},setSelected:function(t){return this.tree._callHook("nodeSetSelected",this,t)},setStatus:function(t,e,i){return this.tree._callHook("nodeSetStatus",this,t,e,i)},setTitle:function(t){this.title=t,this.renderTitle()},sortChildren:function(t,e){var i,n,r=this.children;if(r){if(t=t||function(t,e){var i=t.title.toLowerCase(),n=e.title.toLowerCase();return i===n?0:i>n?1:-1},r.sort(t),e)for(i=0,n=r.length;i<n;i++)r[i].children&&r[i].sortChildren(t,"$norender$");"$norender$"!==e&&this.render()}},toDict:function(e,i){var n,r,o,s={},a=this;if(t.each(N,function(t,e){(a[e]||!1===a[e])&&(s[e]=a[e])}),t.isEmptyObject(this.data)||(s.data=t.extend({},this.data),t.isEmptyObject(s.data)&&delete s.data),i&&i(s,a),e&&this.hasChildren())for(s.children=[],n=0,r=this.children.length;n<r;n++)o=this.children[n],o.isStatusNode()||s.children.push(o.toDict(!0,i));return s},toggleClass:function(e,i){var r,o,s=/\S+/g,a=e.match(s)||[],l=0,h=!1,c=this[this.tree.statusClassPropName],u=" "+(this.extraClasses||"")+" ";for(c&&t(c).toggleClass(e,i);r=a[l++];)if(o=u.indexOf(" "+r+" ")>=0,i=i===n?!o:!!i)o||(u+=r+" ",h=!0);else for(;u.indexOf(" "+r+" ")>-1;)u=u.replace(" "+r+" "," ");return this.extraClasses=t.trim(u),h},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(t,e){var i,n,r=!0,o=this.children;if(!0===e&&(!1===(r=t(this))||"skip"===r))return r;if(o)for(i=0,n=o.length;i<n&&!1!==(r=o[i].visit(t,!0));i++);return r},visitAndLoad:function(e,i,n){var r,o,s,a=this;return!e||!0!==i||!1!==(o=e(a))&&"skip"!==o?a.children||a.lazy?(r=new t.Deferred,s=[],a.load().done(function(){for(var i=0,n=a.children.length;i<n;i++){if(!1===(o=a.children[i].visitAndLoad(e,!0,!0))){r.reject();break}"skip"!==o&&s.push(o)}t.when.apply(this,s).then(function(){r.resolve()})}),r.promise()):c():n?o:c()},visitParents:function(t,e){if(e&&!1===t(this))return!1;for(var i=this.parent;i;){if(!1===t(i))return!1;i=i.parent}return!0},warn:function(){Array.prototype.unshift.call(arguments,this.toString()),o("warn",arguments)}},y.prototype={_makeHookContext:function(e,i,r){var o,s;return e.node!==n?(i&&e.originalEvent!==i&&t.error("invalid args"),o=e):e.tree?(s=e.tree,o={node:e,tree:s,widget:s.widget,options:s.widget.options,originalEvent:i}):e.widget?o={node:null,tree:e,widget:e.widget,options:e.widget.options,originalEvent:i}:t.error("invalid args"),r&&t.extend(o,r),o},_callHook:function(e,i){var n=this._makeHookContext(i),r=this[e],o=Array.prototype.slice.call(arguments,2);return t.isFunction(r)||t.error("_callHook('"+e+"') is not a function"),o.unshift(n),r.apply(this,o)},_requireExtension:function(e,i,n,o){n=!!n;var s=this._local.name,a=this.options.extensions,l=t.inArray(e,a)<t.inArray(s,a),h=i&&null==this.ext[e],c=!h&&null!=n&&n!==l;return r(s&&s!==e,"invalid or same name"),!h&&!c||(o||(h||i?(o="'"+s+"' extension requires '"+e+"'",c&&(o+=" to be registered "+(n?"before":"after")+" itself")):o="If used together, `"+e+"` must be registered "+(n?"before":"after")+" `"+s+"`"),t.error(o),!1)},activateKey:function(t){var e=this.getNodeByKey(t);return e?e.setActive():this.activeNode&&this.activeNode.setActive(!1),e},addPagingNode:function(t,e){return this.rootNode.addPagingNode(t,e)},applyPatch:function(e){var i,n,o,s,a,l,h=e.length,c=[];for(n=0;n<h;n++)o=e[n],r(2===o.length,"patchList must be an array of length-2-arrays"),s=o[0],a=o[1],l=null===s?this.rootNode:this.getNodeByKey(s),l?(i=new t.Deferred,c.push(i),l.applyPatch(a).always(d(i,l))):this.warn("could not find node with key '"+s+"'");return t.when.apply(t,c).promise()},clear:function(){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("log",arguments))},findAll:function(t){return this.rootNode.findAll(t)},findFirst:function(t){return this.rootNode.findFirst(t)},findNextNode:function(e,i){var n=null,r=i.parent.children,o=null,s=function(t,e,i){var n,r,o=t.children,a=o.length,l=o[e];if(l&&!1===i(l))return!1;if(l&&l.children&&l.expanded&&!1===s(l,0,i))return!1;for(n=e+1;n<a;n++)if(!1===s(t,n,i))return!1;return r=t.parent,r?s(r,r.children.indexOf(t)+1,i):s(t,0,i)};return e="string"==typeof e?m(e):e,i=i||this.getFirstChild(),s(i.parent,r.indexOf(i),function(r){return r!==n&&(n=n||r,t(r.span).is(":visible")?(!e(r)||(o=r)===i)&&void 0:void r.debug("quicksearch: skipping hidden node"))}),o},generateFormElements:function(e,i,n){n=n||{};var r,o="string"==typeof e?e:"ft_"+this._id+"[]",s="string"==typeof i?i:"ft_"+this._id+"_active",a="fancytree_result_"+this._id,l=t("#"+a),h=3===this.options.selectMode&&!1!==n.stopOnParents;l.length?l.empty():l=t("<div>",{id:a}).hide().insertAfter(this.$container),!1!==e&&(r=this.getSelectedNodes(h),t.each(r,function(e,i){l.append(t("<input>",{type:"checkbox",name:o,value:i.key,checked:!0}))})),!1!==i&&this.activeNode&&l.append(t("<input>",{type:"radio",name:s,value:this.activeNode.key,checked:!0}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(t,e){var n,r;return!e&&(n=i.getElementById(this.options.idPrefix+t))?n.ftnode?n.ftnode:null:(e=e||this.rootNode,r=null,e.visit(function(e){if(e.key===t)return r=e,!1},!0),r)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(t){return this.rootNode.getSelectedNodes(t)},hasFocus:function(){return!!this._hasFocus},info:function(){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},loadKeyPath:function(e,i,r){function o(t,e,n){i.call(v,e,"loading"),e.load().done(function(){v.loadKeyPath.call(v,u[t],i,e).always(d(n,v))}).fail(function(){v.warn("loadKeyPath: error loading: "+t+" (parent: "+p+")"),i.call(v,e,"error"),n.reject()})}var s,a,l,h,c,u,f,p,g,m=this.options.keyPathSeparator,v=this;for(i=i||t.noop,t.isArray(e)||(e=[e]),u={},l=0;l<e.length;l++)for(p=r||this.rootNode,h=e[l],h.charAt(0)===m&&(h=h.substr(1)),g=h.split(m);g.length;){if(c=g.shift(),!(f=p._findDirectChild(c))){this.warn("loadKeyPath: key not found: "+c+" (parent: "+p+")"),i.call(this,c,"error");break}if(0===g.length){i.call(this,f,"ok");break}if(f.lazy&&f.hasChildren()===n){i.call(this,f,"loaded"),u[c]?u[c].push(g.join(m)):u[c]=[g.join(m)];break}i.call(this,f,"loaded"),p=f}s=[];for(c in u)f=p._findDirectChild(c),a=new t.Deferred,s.push(a),o(c,f,a);return t.when.apply(t,s).promise()},reactivate:function(t){var e,i=this.activeNode;return i?(this.activeNode=null,e=i.setActive(!0,{noFocus:!0}),t&&i.setFocus(),e):c()},
reload:function(t){return this._callHook("treeClear",this),this._callHook("treeLoad",this,t)},render:function(t,e){return this.rootNode.render(t,e)},setFocus:function(t){return this._callHook("treeSetFocus",this,t)},toDict:function(t,e){var i=this.rootNode.toDict(!0,e);return t?i:i.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(t,e,i,r){var o=this._makeHookContext(e,i,r),s=this.widget._trigger(t,i,o);return!1!==s&&o.result!==n?o.result:s},_triggerTreeEvent:function(t,e,i){var r=this._makeHookContext(this,e,i),o=this.widget._trigger(t,e,r);return!1!==o&&r.result!==n?r.result:o},visit:function(t){return this.rootNode.visit(t,!1)},warn:function(){Array.prototype.unshift.call(arguments,this.toString()),o("warn",arguments)}},t.extend(y.prototype,{nodeClick:function(t){var e,i,n=t.targetType,r=t.node;if("expander"===n){if(r.isLoading())return void r.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",t)}else if("checkbox"===n)this._callHook("nodeToggleSelected",t),t.options.focusOnSelect&&this._callHook("nodeSetFocus",t,!0);else{if(i=!1,e=!0,r.folder)switch(t.options.clickFolderMode){case 2:i=!0,e=!1;break;case 3:e=!0,i=!0}e&&(this.nodeSetFocus(t),this._callHook("nodeSetActive",t,!0)),i&&this._callHook("nodeToggleExpanded",t)}},nodeCollapseSiblings:function(t,e){var i,n,r,o=t.node;if(o.parent)for(i=o.parent.children,n=0,r=i.length;n<r;n++)i[n]!==o&&i[n].expanded&&this._callHook("nodeSetExpanded",i[n],!1,e)},nodeDblclick:function(t){"title"===t.targetType&&4===t.options.clickFolderMode&&this._callHook("nodeToggleExpanded",t),"title"===t.targetType&&t.originalEvent.preventDefault()},nodeKeydown:function(e){var i,n,r,o=e.originalEvent,s=e.node,a=e.tree,l=e.options,h=o.which,c=String.fromCharCode(h),u=!(o.altKey||o.ctrlKey||o.metaKey||o.shiftKey),d=t(o.target),f=!0,p=!(o.ctrlKey||!l.autoActivate);if(s||(r=this.getActiveNode()||this.getFirstChild())&&(r.setFocus(),s=e.node=this.focusNode,s.debug("Keydown force focus on active node")),l.quicksearch&&u&&/\w/.test(c)&&!d.is(":input:enabled"))return n=(new Date).getTime(),n-a.lastQuicksearchTime>500&&(a.lastQuicksearchTerm=""),a.lastQuicksearchTime=n,a.lastQuicksearchTerm+=c,i=a.findNextNode(a.lastQuicksearchTerm,a.getActiveNode()),i&&i.setActive(),void o.preventDefault();switch(w.eventToString(o)){case"+":case"=":a.nodeSetExpanded(e,!0);break;case"-":a.nodeSetExpanded(e,!1);break;case"space":s.isPagingNode()?a._triggerNodeEvent("clickPaging",e,o):l.checkbox?a.nodeToggleSelected(e):a.nodeSetActive(e,!0);break;case"return":a.nodeSetActive(e,!0);break;case"backspace":case"left":case"right":case"up":case"down":s.navigate(o.which,p);break;default:f=!1}f&&o.preventDefault()},nodeLoadChildren:function(e,i){var n,o,s,a=e.tree,l=e.node,h=(new Date).getTime();return t.isFunction(i)&&(i=i.call(a,{type:"source"},e),r(!t.isFunction(i),"source callback must not return another function")),i.url&&(l._requestId&&l.warn("Recursive load request #"+h+" while #"+l._requestId+" is pending."),n=t.extend({},e.options.ajax,i),l._requestId=h,n.debugDelay?(o=n.debugDelay,t.isArray(o)&&(o=o[0]+Math.random()*(o[1]-o[0])),l.warn("nodeLoadChildren waiting debugDelay "+Math.round(o)+" ms ..."),n.debugDelay=!1,s=t.Deferred(function(e){setTimeout(function(){t.ajax(n).done(function(){e.resolveWith(this,arguments)}).fail(function(){e.rejectWith(this,arguments)})},o)})):s=t.ajax(n),i=new t.Deferred,s.done(function(n){var r,o;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof n||t.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),l._requestId&&l._requestId>h)return void i.rejectWith(this,[S]);if(e.options.postProcess){try{o=a._triggerNodeEvent("postProcess",e,e.originalEvent,{response:n,error:null,dataType:this.dataType})}catch(t){o={error:t,message:""+t,details:"postProcess failed"}}if(o.error)return r=t.isPlainObject(o.error)?o.error:{message:o.error},r=a._makeHookContext(l,null,r),void i.rejectWith(this,[r]);n=t.isArray(o)?o:n}else n&&n.hasOwnProperty("d")&&e.options.enableAspx&&(n="string"==typeof n.d?t.parseJSON(n.d):n.d);i.resolveWith(this,[n])}).fail(function(t,e,n){var r=a._makeHookContext(l,null,{error:t,args:Array.prototype.slice.call(arguments),message:n,details:t.status+": "+n});i.rejectWith(this,[r])})),t.isFunction(i.then)&&t.isFunction(i["catch"])&&(s=i,i=new t.Deferred,s.then(function(t){i.resolve(t)},function(t){i.reject(t)})),t.isFunction(i.promise)&&(a.nodeSetStatus(e,"loading"),i.done(function(){a.nodeSetStatus(e,"ok"),l._requestId=null}).fail(function(t){var i;if(t===S)return void l.warn("Ignored response for obsolete load request #"+h+" (expected #"+l._requestId+")");t.node&&t.error&&t.message?i=t:(i=a._makeHookContext(l,null,{error:t,args:Array.prototype.slice.call(arguments),message:t?t.message||t.toString():""}),"[object Object]"===i.message&&(i.message="")),l.warn("Load children failed ("+i.message+")",i),!1!==a._triggerNodeEvent("loadError",i,null)&&a.nodeSetStatus(e,"error",i.message,i.details)})),t.when(i).done(function(e){var i;t.isPlainObject(e)&&(r(l.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),r(t.isArray(e.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),i=e,e=e.children,delete i.children,t.extend(a.data,i)),r(t.isArray(e),"expected array of children"),l._setChildren(e),a._triggerNodeEvent("loadChildren",l)})},nodeLoadKeyPath:function(){},nodeRemoveChild:function(e,i){var n,o=e.node,s=e.options,a=t.extend({},e,{node:i}),l=o.children;if(1===l.length)return r(i===l[0],"invalid single child"),this.nodeRemoveChildren(e);this.activeNode&&(i===this.activeNode||this.activeNode.isDescendantOf(i))&&this.activeNode.setActive(!1),this.focusNode&&(i===this.focusNode||this.focusNode.isDescendantOf(i))&&(this.focusNode=null),this.nodeRemoveMarkup(a),this.nodeRemoveChildren(a),n=t.inArray(i,l),r(n>=0,"invalid child"),i.visit(function(t){t.parent=null},!0),this._callHook("treeRegisterNode",this,!1,i),s.removeNode&&s.removeNode.call(e.tree,{type:"removeNode"},a),l.splice(n,1)},nodeRemoveChildMarkup:function(e){var i=e.node;i.ul&&(i.isRootNode()?t(i.ul).empty():(t(i.ul).remove(),i.ul=null),i.visit(function(t){t.li=t.ul=null}))},nodeRemoveChildren:function(e){var i,n=e.tree,r=e.node,o=r.children,s=e.options;o&&(this.activeNode&&this.activeNode.isDescendantOf(r)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(r)&&(this.focusNode=null),this.nodeRemoveChildMarkup(e),i=t.extend({},e),r.visit(function(t){t.parent=null,n._callHook("treeRegisterNode",n,!1,t),s.removeNode&&(i.node=t,s.removeNode.call(e.tree,{type:"removeNode"},i))}),r.lazy?r.children=[]:r.children=null,r.isRootNode()||(r.expanded=!1),this.nodeRenderStatus(e))},nodeRemoveMarkup:function(e){var i=e.node;i.li&&(t(i.li).remove(),i.li=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,n,o,s,a){var l,h,c,u,d,f,p,g=e.node,m=e.tree,v=e.options,y=v.aria,b=!1,_=g.parent,w=!_,x=g.children,C=null;if(w||_.ul){if(r(w||_.ul,"parent UL must exist"),w||(g.li&&(n||g.li.parentNode!==g.parent.ul)&&(g.li.parentNode===g.parent.ul?C=g.li.nextSibling:this.debug("Unlinking "+g+" (must be child of "+g.parent+")"),this.nodeRemoveMarkup(e)),g.li?this.nodeRenderStatus(e):(b=!0,g.li=i.createElement("li"),g.li.ftnode=g,g.key&&v.generateIds&&(g.li.id=v.idPrefix+g.key),g.span=i.createElement("span"),g.span.className="fancytree-node",y&&t(g.span).attr("aria-labelledby","ftal_"+v.idPrefix+g.key),g.li.appendChild(g.span),this.nodeRenderTitle(e),v.createNode&&v.createNode.call(m,{type:"createNode"},e)),v.renderNode&&v.renderNode.call(m,{type:"renderNode"},e)),x){if(w||g.expanded||!0===o){for(g.ul||(g.ul=i.createElement("ul"),(!0!==s||a)&&g.expanded||(g.ul.style.display="none"),y&&t(g.ul).attr("role","group"),g.li?g.li.appendChild(g.ul):g.tree.$div.append(g.ul)),u=0,d=x.length;u<d;u++)p=t.extend({},e,{node:x[u]}),this.nodeRender(p,n,o,!1,!0);for(l=g.ul.firstChild;l;)c=l.ftnode,c&&c.parent!==g?(g.debug("_fixParent: remove missing "+c,l),f=l.nextSibling,l.parentNode.removeChild(l),l=f):l=l.nextSibling;for(l=g.ul.firstChild,u=0,d=x.length-1;u<d;u++)h=x[u],c=l.ftnode,h!==c?g.ul.insertBefore(h.li,c.li):l=l.nextSibling}}else g.ul&&(this.warn("remove child markup for "+g),this.nodeRemoveChildMarkup(e));w||b&&_.ul.insertBefore(g.li,C)}},nodeRenderTitle:function(e,i){var r,o,s,a,l,h,c=e.node,u=e.tree,d=e.options,f=d.aria,g=c.getLevel(),m=[];i!==n&&(c.title=i),c.span&&(g<d.minExpandLevel?(c.lazy||(c.expanded=!0),g>1&&(f?m.push("<span role='button' class='fancytree-expander fancytree-expander-fixed'></span>"):m.push("<span class='fancytree-expander fancytree-expander-fixed''></span>"))):f?m.push("<span role='button' class='fancytree-expander'></span>"):m.push("<span class='fancytree-expander'></span>"),d.checkbox&&!0!==c.hideCheckbox&&!c.isStatusNode()&&(f?m.push("<span role='checkbox' class='fancytree-checkbox'></span>"):m.push("<span class='fancytree-checkbox'></span>")),c.data.iconClass!==n&&(c.icon?t.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(c.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),c.icon=c.data.iconClass)),t.isFunction(d.icon)?null==(o=d.icon.call(u,{type:"icon"},e))&&(o=c.icon):o=null!=c.icon?c.icon:d.icon,null==o?o=!0:"boolean"!=typeof o&&(o=""+o),!1!==o&&(a=f?" role='img'":"","string"==typeof o?x.test(o)?(o="/"===o.charAt(0)?o:(d.imagePath||"")+o,m.push("<img src='"+o+"' class='fancytree-icon' alt='' />")):m.push("<span "+a+" class='fancytree-custom-icon "+o+"'></span>"):m.push("<span "+a+" class='fancytree-icon'></span>")),s="",d.renderTitle&&(s=d.renderTitle.call(u,{type:"renderTitle"},e)||""),s||(h=c.tooltip?" title='"+p(c.tooltip)+"'":"",r=f?" id='ftal_"+d.idPrefix+c.key+"'":"",a=f?" role='treeitem'":"",l=d.titlesTabbable?" tabindex='0'":"",s="<span "+a+" class='fancytree-title'"+r+h+l+">"+(d.escapeTitles?p(c.title):c.title)+"</span>"),m.push(s),c.span.innerHTML=m.join(""),this.nodeRenderStatus(e),d.enhanceTitle&&(e.$title=t(">span.fancytree-title",c.span),s=d.enhanceTitle.call(u,{type:"enhanceTitle"},e)||""))},nodeRenderStatus:function(e){var i=e.node,n=e.tree,r=e.options,o=i.hasChildren(),s=i.isLastSibling(),a=r.aria,l=t(i.span).find(".fancytree-title"),h=r._classNames,c=[],u=i[n.statusClassPropName];u&&(c.push(h.node),n.activeNode===i&&c.push(h.active),n.focusNode===i?(c.push(h.focused),a&&l.attr("aria-activedescendant",!0)):a&&l.removeAttr("aria-activedescendant"),i.expanded?(c.push(h.expanded),a&&l.attr("aria-expanded",!0)):a&&l.removeAttr("aria-expanded"),i.folder&&c.push(h.folder),!1!==o&&c.push(h.hasChildren),s&&c.push(h.lastsib),i.lazy&&null==i.children&&c.push(h.lazy),i.partload&&c.push(h.partload),i.partsel&&c.push(h.partsel),i.unselectable&&c.push(h.unselectable),i._isLoading&&c.push(h.loading),i._error&&c.push(h.error),i.statusNodeType&&c.push(h.statusNodePrefix+i.statusNodeType),i.selected?(c.push(h.selected),a&&l.attr("aria-selected",!0)):a&&l.attr("aria-selected",!1),i.extraClasses&&c.push(i.extraClasses),!1===o?c.push(h.combinedExpanderPrefix+"n"+(s?"l":"")):c.push(h.combinedExpanderPrefix+(i.expanded?"e":"c")+(i.lazy&&null==i.children?"d":"")+(s?"l":"")),c.push(h.combinedIconPrefix+(i.expanded?"e":"c")+(i.folder?"f":"")),u.className=c.join(" "),i.li&&(i.li.className=s?h.lastsib:""))},nodeSetActive:function(e,i,n){n=n||{};var o,s=e.node,a=e.tree,l=e.options,h=!0===n.noEvents,d=!0===n.noFocus,f=s===a.activeNode;return i=!1!==i,f===i?c(s):i&&!h&&!1===this._triggerNodeEvent("beforeActivate",s,e.originalEvent)?u(s,["rejected"]):(i?(a.activeNode&&(r(a.activeNode!==s,"node was active (inconsistency)"),o=t.extend({},e,{node:a.activeNode}),a.nodeSetActive(o,!1),r(null===a.activeNode,"deactivate was out of sync?")),l.activeVisible&&s.makeVisible({scrollIntoView:!1}),a.activeNode=s,a.nodeRenderStatus(e),d||a.nodeSetFocus(e),h||a._triggerNodeEvent("activate",s,e.originalEvent)):(r(a.activeNode===s,"node was not active (inconsistency)"),a.activeNode=null,this.nodeRenderStatus(e),h||e.tree._triggerNodeEvent("deactivate",s,e.originalEvent)),c(s))},nodeSetExpanded:function(e,i,r){r=r||{};var o,s,a,l,h,d,f=e.node,p=e.tree,g=e.options,m=!0===r.noAnimation,v=!0===r.noEvents;if(i=!1!==i,f.expanded&&i||!f.expanded&&!i)return c(f);if(i&&!f.lazy&&!f.hasChildren())return c(f);if(!i&&f.getLevel()<g.minExpandLevel)return u(f,["locked"]);if(!v&&!1===this._triggerNodeEvent("beforeExpand",f,e.originalEvent))return u(f,["rejected"]);if(m||f.isVisible()||(m=r.noAnimation=!0),s=new t.Deferred,i&&!f.expanded&&g.autoCollapse){h=f.getParentList(!1,!0),d=g.autoCollapse;try{for(g.autoCollapse=!1,a=0,l=h.length;a<l;a++)this._callHook("nodeCollapseSiblings",h[a],r)}finally{g.autoCollapse=d}}return s.done(function(){var t=f.getLastChild();i&&g.autoScroll&&!m&&t?t.scrollIntoView(!0,{topNode:f}).always(function(){v||e.tree._triggerNodeEvent(i?"expand":"collapse",e)}):v||e.tree._triggerNodeEvent(i?"expand":"collapse",e)}),o=function(n){var r,o,s=g.toggleEffect;if(f.expanded=i,p._callHook("nodeRender",e,!1,!1,!0),f.ul)if(r="none"!==f.ul.style.display,o=!!f.expanded,r===o)f.warn("nodeSetExpanded: UL.style.display already set");else{if(s&&!m)return void t(f.ul).toggle(s.effect,s.options,s.duration,function(){n()});f.ul.style.display=f.expanded||!parent?"":"none"}n()},i&&f.lazy&&f.hasChildren()===n?f.load().done(function(){s.notifyWith&&s.notifyWith(f,["loaded"]),o(function(){s.resolveWith(f)})}).fail(function(t){o(function(){s.rejectWith(f,["load failed ("+t+")"])})}):o(function(){s.resolveWith(f)}),s.promise()},nodeSetFocus:function(e,n){var r,o=e.tree,s=e.node;if(n=!1!==n,o.focusNode){if(o.focusNode===s&&n)return;r=t.extend({},e,{node:o.focusNode}),o.focusNode=null,this._triggerNodeEvent("blur",r),this._callHook("nodeRenderStatus",r)}n&&(this.hasFocus()||(s.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",e,!0,{calledByNode:!0})),s.makeVisible({scrollIntoView:!1}),o.focusNode=s,o.options.titlesTabbable?t(s.span).find(".fancytree-title").focus():0===t(i.activeElement).closest(".fancytree-container").length&&t(o.$container).focus(),this._triggerNodeEvent("focus",e),e.options.autoScroll&&s.scrollIntoView(),this._callHook("nodeRenderStatus",e))},nodeSetSelected:function(t,e){var i=t.node,n=t.tree,r=t.options;if(e=!1!==e,i.debug("nodeSetSelected("+e+")",t),!i.unselectable){if(i.selected&&e||!i.selected&&!e)return!!i.selected;if(!1===this._triggerNodeEvent("beforeSelect",i,t.originalEvent))return!!i.selected;e&&1===r.selectMode?n.lastSelectedNode&&n.lastSelectedNode.setSelected(!1):3===r.selectMode&&(i.selected=e,i.fixSelection3AfterClick()),i.selected=e,this.nodeRenderStatus(t),n.lastSelectedNode=e?i:null,n._triggerNodeEvent("select",t)}},nodeSetStatus:function(e,i,n,r){function o(){var t=a.children?a.children[0]:null;if(t&&t.isStatusNode()){try{a.ul&&(a.ul.removeChild(t.li),t.li=null)}catch(t){}1===a.children.length?a.children=[]:a.children.shift()}}function s(e,i){var n=a.children?a.children[0]:null;return n&&n.isStatusNode()?(t.extend(n,e),n.statusNodeType=i,l._callHook("nodeRenderTitle",n)):(a._setChildren([e]),a.children[0].statusNodeType=i,l.render()),a.children[0]}var a=e.node,l=e.tree;switch(i){case"ok":o(),a._isLoading=!1,a._error=null,a.renderStatus();break;case"loading":a.parent||s({title:l.options.strings.loading+(n?" ("+n+")":""),checkbox:!1,tooltip:r},i),a._isLoading=!0,a._error=null,a.renderStatus();break;case"error":s({title:l.options.strings.loadError+(n?" ("+n+")":""),checkbox:!1,tooltip:r},i),a._isLoading=!1,a._error={message:n,details:r},a.renderStatus();break;case"nodata":s({title:l.options.strings.noData,checkbox:!1,tooltip:r},i),a._isLoading=!1,a._error=null,a.renderStatus();break;default:t.error("invalid node status "+i)}},nodeToggleExpanded:function(t){return this.nodeSetExpanded(t,!t.node.expanded)},nodeToggleSelected:function(t){return this.nodeSetSelected(t,!t.node.selected)},treeClear:function(t){var e=t.tree;e.activeNode=null,e.focusNode=null,e.$div.find(">ul.fancytree-container").empty(),e.rootNode.children=null},treeCreate:function(){},treeDestroy:function(){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("ui-helper-hidden")},treeInit:function(t){this.treeLoad(t)},treeLoad:function(e,i){var n,r,o=e.tree,s=e.widget.element,a=t.extend({},e,{node:this.rootNode});if(o.rootNode.children&&this.treeClear(e),i=i||this.options.source)"string"==typeof i&&t.error("Not implemented");else switch(n=s.data("type")||"html"){case"html":r=s.find(">ul:first"),r.addClass("ui-fancytree-source ui-helper-hidden"),i=t.ui.fancytree.parseHtml(r),this.data=t.extend(this.data,f(r));break;case"json":i=t.parseJSON(s.text()),i.children&&(i.title&&(o.title=i.title),i=i.children);break;default:t.error("Invalid data-type: "+n)}return this.nodeLoadChildren(a,i).done(function(){o.render(),3===e.options.selectMode&&o.rootNode.fixSelection3FromEndNodes(),o.activeNode&&o.options.activeVisible&&o.activeNode.makeVisible(),o._triggerTreeEvent("init",null,{status:!0})}).fail(function(){o.render(),o._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(){},treeSetFocus:function(e,i,n){(i=!1!==i)!==this.hasFocus()&&(this._hasFocus=i,!i&&this.focusNode?this.focusNode.setFocus(!1):!i||n&&n.calledByNode||t(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",i),this._triggerTreeEvent(i?"focusTree":"blurTree"))}}),t.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"blind",options:{direction:"vertical",scale:"box"},duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,quicksearch:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!",moreData:"More&#8230;",noData:"No data."},tabindex:"0",titlesTabbable:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new y(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");var e,i,o,s=this.options,a=s.extensions,l=this.tree;for(o=0;o<a.length;o++)i=a[o],e=t.ui.fancytree._extensions[i],e||t.error("Could not apply extension '"+i+"' (it is not registered, did you forget to include it?)"),this.tree.options[i]=t.extend(!0,{},e.options,this.tree.options[i]),r(this.tree.ext[i]===n,"Extension name must not exist as Fancytree.ext attribute: '"+i+"'"),this.tree.ext[i]={},h(this.tree,l,e,i),l=e;s.icons!==n&&(!0!==s.icon?t.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),s.icon=s.icons)),s.iconClass!==n&&(s.icon?t.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),s.icon=s.iconClass)),s.tabbable!==n&&(s.tabindex=s.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+s.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,i){var n=!0,r=!1;switch(e){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":this.tree._callHook("treeCreate",this.tree),r=!0;break;case"escapeTitles":r=!0;break;case"source":n=!1,this.tree._callHook("treeLoad",this.tree,i)}this.tree.debug("set option "+e+"="+i+" <"+typeof i+">"),n&&t.Widget.prototype._setOption.apply(this,arguments),r&&this.tree.render(!0,!1)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),t.Widget.prototype.destroy.call(this)},_unbind:function(){var e=this.tree._ns;this.element.unbind(e),this.tree.$container.unbind(e),t(i).unbind(e)},_bind:function(){var t=this,e=this.options,i=this.tree,n=i._ns;this._unbind(),i.$container.on("focusin"+n+" focusout"+n,function(t){var e=w.getNode(t),n="focusin"===t.type;e?i._callHook("nodeSetFocus",e,n):i._callHook("treeSetFocus",i,n)}).on("selectstart"+n,"span.fancytree-title",function(t){t.preventDefault()}).on("keydown"+n,function(t){if(e.disabled||!1===e.keyboard)return!0;var n,r=i.focusNode,o=i._makeHookContext(r||i,t),s=i.phase;try{return i.phase="userEvent",n=r?i._triggerNodeEvent("keydown",r,t):i._triggerTreeEvent("keydown",t),"preventNav"===n?n=!0:!1!==n&&(n=i._callHook("nodeKeydown",o)),n}finally{i.phase=s}}).on("click"+n+" dblclick"+n,function(i){if(e.disabled)return!0;var n,r=w.getEventTarget(i),o=r.node,s=t.tree,a=s.phase;if(!o)return!0;n=s._makeHookContext(o,i);try{switch(s.phase="userEvent",i.type){case"click":return n.targetType=r.type,o.isPagingNode()?!0===s._triggerNodeEvent("clickPaging",n,i):!1!==s._triggerNodeEvent("click",n,i)&&s._callHook("nodeClick",n);case"dblclick":return n.targetType=r.type,!1!==s._triggerNodeEvent("dblclick",n,i)&&s._callHook("nodeDblclick",n)}}finally{s.phase=a}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(t){return this.tree.getNodeByKey(t)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),w=t.ui.fancytree,t.extend(t.ui.fancytree,{version:"2.18.0",buildType:"production",debugLevel:1,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:y,_FancytreeNodeClass:v,jquerySupports:{positionMyOfs:a(t.ui.version,1,9)},assert:function(t,e){return r(t,e)},debounce:function(t,e,i,n){var r;return 3===arguments.length&&"boolean"!=typeof i&&(n=i,i=!1),function(){var o=arguments;n=n||this,i&&!r&&e.apply(n,o),clearTimeout(r),r=setTimeout(function(){i||e.apply(n,o),r=null},t)}},debug:function(){t.ui.fancytree.debugLevel>=2&&o("log",arguments)},error:function(){o("error",arguments)},escapeHtml:p,fixPositionOptions:function(e){if((e.offset||(""+e.my+e.at).indexOf("%")>=0)&&t.error("expected new position syntax (but '%' is not supported)"),!t.ui.fancytree.jquerySupports.positionMyOfs){var i=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.my),n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.at),r=(i[2]?+i[2]:0)+(n[2]?+n[2]:0),o=(i[4]?+i[4]:0)+(n[4]?+n[4]:0);e=t.extend({},e,{my:i[1]+" "+i[3],at:n[1]+" "+n[3]}),(r||o)&&(e.offset=r+" "+o)}return e},getEventTargetType:function(t){return this.getEventTarget(t).type},getEventTarget:function(e){var i=e&&e.target?e.target.className:"",r={node:this.getNode(e.target),type:n};return/\bfancytree-title\b/.test(i)?r.type="title":/\bfancytree-expander\b/.test(i)?r.type=!1===r.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(i)||/\bfancytree-radio\b/.test(i)?r.type="checkbox":/\bfancytree-icon\b/.test(i)?r.type="icon":/\bfancytree-node\b/.test(i)?r.type="title":e&&e.target&&t(e.target).closest(".fancytree-title").length&&(r.type="title"),r},getNode:function(t){if(t instanceof v)return t;for(t.selector!==n?t=t[0]:t.originalEvent!==n&&(t=t.target);t;){if(t.ftnode)return t.ftnode;t=t.parentNode}return null},getTree:function(e){var i;return e instanceof y?e:(e===n&&(e=0),"number"==typeof e?e=t(".fancytree-container").eq(e):"string"==typeof e?e=t(e).eq(0):e.selector!==n?e=e.eq(0):e.originalEvent!==n&&(e=t(e.target)),e=e.closest(":ui-fancytree"),i=e.data("ui-fancytree")||e.data("fancytree"),i?i.tree:null)},info:function(){t.ui.fancytree.debugLevel>=1&&o("info",arguments)},eventToString:function(t){var e=t.which,i=t.type,n=[];return t.altKey&&n.push("alt"),t.ctrlKey&&n.push("ctrl"),t.metaKey&&n.push("meta"),t.shiftKey&&n.push("shift"),"click"===i||"dblclick"===i?n.push(P[t.button]+i):k[e]||n.push(E[e]||String.fromCharCode(e).toLowerCase()),n.join("+")},keyEventToString:function(t){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(t)},parseHtml:function(e){var i,r,o,s,a,l,h,c,u=e.find(">li"),d=[];return u.each(function(){var u,p,g=t(this),m=g.find(">span:first",this),v=m.length?null:g.find(">a:first"),y={tooltip:null,data:{}};for(m.length?y.title=m.html():v&&v.length?(y.title=v.html(),y.data.href=v.attr("href"),y.data.target=v.attr("target"),y.tooltip=v.attr("title")):(y.title=g.html(),(a=y.title.search(/<ul/i))>=0&&(y.title=y.title.substring(0,a))),y.title=t.trim(y.title),s=0,l=D.length;s<l;s++)y[D[s]]=n;for(i=this.className.split(" "),o=[],s=0,l=i.length;s<l;s++)r=i[s],I[r]?y[r]=!0:o.push(r);if(y.extraClasses=o.join(" "),h=g.attr("title"),h&&(y.tooltip=h),h=g.attr("id"),h&&(y.key=h),(u=f(g))&&!t.isEmptyObject(u)){for(p in L)u.hasOwnProperty(p)&&(u[L[p]]=u[p],delete u[p]);for(s=0,l=N.length;s<l;s++)h=N[s],null!=(c=u[h])&&(delete u[h],y[h]=c);t.extend(y.data,u)}e=g.find(">ul:first"),e.length?y.children=t.ui.fancytree.parseHtml(e):y.children=y.lazy?n:null,d.push(y)}),d},registerExtension:function(e){r(null!=e.name,"extensions must have a `name` property."),r(null!=e.version,"extensions must have a `version` property."),t.ui.fancytree._extensions[e.name]=e},unescapeHtml:function(t){var e=i.createElement("div");return e.innerHTML=t,0===e.childNodes.length?"":e.childNodes[0].nodeValue},warn:function(){o("warn",arguments)}})}(jQuery,window,document),function(t){"use strict";t.ui.fancytree._FancytreeClass.prototype.countSelected=function(t){var e=this;e.options;return e.getSelectedNodes(t).length},t.ui.fancytree._FancytreeNodeClass.prototype.updateCounters=function(){var e=this,i=t("span.fancytree-childcounter",e.span),n=e.tree.options.childcounter,r=e.countChildren(n.deep);e.data.childCounter=r,!r&&n.hideZeros||e.isExpanded()&&n.hideExpanded?i.remove():(i.length||(i=t("<span class='fancytree-childcounter'/>").appendTo(t("span.fancytree-icon",e.span))),i.text(r)),!n.deep||e.isTopLevel()||e.isRoot()||e.parent.updateCounters()},t.ui.fancytree.prototype.widgetMethod1=function(t){this.tree;return t},t.ui.fancytree.registerExtension({name:"childcounter",version:"1.0.0",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(){},treeInit:function(t){t.options,t.options.childcounter;this._superApply(arguments),this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(){this._superApply(arguments)},nodeRenderTitle:function(e){var i=e.node,n=e.options.childcounter,r=null==i.data.childCounter?i.countChildren(n.deep):+i.data.childCounter;this._superApply(arguments),!r&&n.hideZeros||i.isExpanded()&&n.hideExpanded||t("span.fancytree-icon",i.span).append(t("<span class='fancytree-childcounter'/>").text(r))},nodeSetExpanded:function(t){var e=t.tree;t.node;return this._superApply(arguments).always(function(){e.nodeRenderTitle(t)})}})}(jQuery),function(t){"use strict";function e(e,i){e||(i=i?": "+i:"",t.error("Assertion failed"+i))}function i(t,e){var i;for(i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0;return!1}function n(t,e,i){for(var n,r,o=3&t.length,s=t.length-o,a=i,l=3432918353,h=461845907,c=0;c<s;)r=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=(65535&r)*l+(((r>>>16)*l&65535)<<16)&4294967295,r=r<<15|r>>>17,r=(65535&r)*h+(((r>>>16)*h&65535)<<16)&4294967295,a^=r,a=a<<13|a>>>19,n=5*(65535&a)+((5*(a>>>16)&65535)<<16)&4294967295,a=27492+(65535&n)+((58964+(n>>>16)&65535)<<16);switch(r=0,o){case 3:r^=(255&t.charCodeAt(c+2))<<16;case 2:r^=(255&t.charCodeAt(c+1))<<8;case 1:r^=255&t.charCodeAt(c),r=(65535&r)*l+(((r>>>16)*l&65535)<<16)&4294967295,r=r<<15|r>>>17,r=(65535&r)*h+(((r>>>16)*h&65535)<<16)&4294967295,a^=r}return a^=t.length,a^=a>>>16,a=2246822507*(65535&a)+((2246822507*(a>>>16)&65535)<<16)&4294967295,a^=a>>>13,a=3266489909*(65535&a)+((3266489909*(a>>>16)&65535)<<16)&4294967295,a^=a>>>16,e?("0000000"+(a>>>0).toString(16)).substr(-8):a>>>0}function r(e){var i=t.map(e.getParentList(!1,!0),function(t){return t.refKey||t.key});return i=i.join("/"),"id_"+n(i,!0)}t.ui.fancytree._FancytreeNodeClass.prototype.getCloneList=function(e){var i,n=this.tree,r=n.refMap[this.refKey]||null,o=n.keyMap;return r&&(i=this.key,e?r=t.map(r,function(t){return o[t]}):(r=t.map(r,function(t){return t===i?null:o[t]}),r.length<1&&(r=null))),r},t.ui.fancytree._FancytreeNodeClass.prototype.isClone=function(){var t=this.refKey||null,e=t&&this.tree.refMap[t]||null;return!!(e&&e.length>1)},t.ui.fancytree._FancytreeNodeClass.prototype.reRegister=function(e,i){e=null==e?null:""+e,i=null==i?null:""+i;var n=this.tree,r=this.key,o=this.refKey,s=n.keyMap,a=n.refMap,l=a[o]||null,h=!1;return null!=e&&e!==this.key&&(s[e]&&t.error("[ext-clones] reRegister("+e+"): already exists: "+this),delete s[r],s[e]=this,l&&(a[o]=t.map(l,function(t){return t===r?e:t})),this.key=e,h=!0),null!=i&&i!==this.refKey&&(l&&(1===l.length?delete a[o]:a[o]=t.map(l,function(t){return t===r?null:t})),a[i]?a[i].append(e):a[i]=[this.key],this.refKey=i,h=!0),h},t.ui.fancytree._FancytreeNodeClass.prototype.setRefKey=function(t){return this.reRegister(null,t)},t.ui.fancytree._FancytreeClass.prototype.getNodesByRef=function(e,i){var n=this.keyMap,r=this.refMap[e]||null;return r&&(r=i?t.map(r,function(t){var e=n[t];return e.isDescendantOf(i)?e:null}):t.map(r,function(t){return n[t]}),r.length<1&&(r=null)),r},t.ui.fancytree._FancytreeClass.prototype.changeRefKey=function(t,e){var i,n,r=this.keyMap,o=this.refMap[t]||null;if(o){for(i=0;i<o.length;i++)n=r[o[i]],n.refKey=e;delete this.refMap[t],this.refMap[e]=o}},t.ui.fancytree.registerExtension({name:"clones",version:"0.0.3",options:{highlightActiveClones:!0,highlightClones:!1},treeCreate:function(t){this._superApply(arguments),t.tree.refMap={},t.tree.keyMap={}},treeInit:function(t){this.$container.addClass("fancytree-ext-clones"),e(null==t.options.defaultKey),t.options.defaultKey=function(t){return r(t)},this._superApply(arguments)},treeClear:function(t){return t.tree.refMap={},t.tree.keyMap={},this._superApply(arguments)},treeRegisterNode:function(n,r,o){var s,a,l=n.tree,h=l.keyMap,c=l.refMap,u=o.key,d=o&&null!=o.refKey?""+o.refKey:null;return o.isStatusNode()?this._superApply(arguments):(r?(null!=h[o.key]&&t.error("clones.treeRegisterNode: node.key already exists: "+o),h[u]=o,d&&(s=c[d],s?(s.push(u),2===s.length&&n.options.clones.highlightClones&&h[s[0]].renderStatus()):c[d]=[u])):(null==h[u]&&t.error("clones.treeRegisterNode: node.key not registered: "+o.key),delete h[u],d&&(s=c[d])&&(a=s.length,a<=1?(e(1===a),e(s[0]===u),delete c[d]):(i(s,u),2===a&&n.options.clones.highlightClones&&h[s[0]].renderStatus()))),this._superApply(arguments))},nodeRenderStatus:function(e){var i,n,r=e.node;return n=this._superApply(arguments),e.options.clones.highlightClones&&(i=t(r[e.tree.statusClassPropName]),i.length&&r.isClone()&&i.addClass("fancytree-clone")),n},nodeSetActive:function(e,i){var n,r=e.tree.statusClassPropName,o=e.node;return n=this._superApply(arguments),e.options.clones.highlightActiveClones&&o.isClone()&&t.each(o.getCloneList(!0),function(e,n){t(n[r]).toggleClass("fancytree-active-clone",!1!==i)}),n}})}(jQuery,window,document),function(t,e,i,n){"use strict";function r(t){return 0===t?"":t>0?"+"+t:""+t}function o(){a||(t.ui.plugin.add("draggable","connectToFancytree",{start:function(e,i){var n=t(this).data("ui-draggable")||t(this).data("draggable"),r=i.helper.data("ftSourceNode")||null;if(r)return n.offset.click.top=-2,n.offset.click.left=16,r.tree.ext.dnd._onDragEvent("start",r,null,e,i,n)},drag:function(e,i){var n,r,o=t(this).data("ui-draggable")||t(this).data("draggable"),s=i.helper.data("ftSourceNode")||null,a=i.helper.data("ftTargetNode")||null,l=t.ui.fancytree.getNode(e.target),h=s&&s.tree.options.dnd;if(e.target&&!l&&t(e.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length>0)return r=s||a||t.ui.fancytree,void r.debug("Drag event over helper: ignored.");i.helper.data("ftTargetNode",l),h&&h.updateHelper&&(n=s.tree._makeHookContext(s,e,{otherNode:l,ui:i,draggable:o,dropMarker:t("#fancytree-drop-marker")}),h.updateHelper.call(s.tree,s,n)),a&&a!==l&&a.tree.ext.dnd._onDragEvent("leave",a,s,e,i,o),
l&&l.tree.options.dnd.dragDrop&&(l===a?l.tree.ext.dnd._onDragEvent("over",l,s,e,i,o):(l.tree.ext.dnd._onDragEvent("enter",l,s,e,i,o),l.tree.ext.dnd._onDragEvent("over",l,s,e,i,o)))},stop:function(e,i){var n,r=t(this).data("ui-draggable")||t(this).data("draggable"),o=i.helper.data("ftSourceNode")||null,s=i.helper.data("ftTargetNode")||null,a="mouseup"===e.type&&1===e.which;a||(n=o||s||t.ui.fancytree,n.debug("Drag was cancelled")),s&&(a&&s.tree.ext.dnd._onDragEvent("drop",s,o,e,i,r),s.tree.ext.dnd._onDragEvent("leave",s,o,e,i,r)),o&&o.tree.ext.dnd._onDragEvent("stop",o,null,e,i,r)}}),a=!0)}function s(e){var i=e.options.dnd||null,n=e.options.glyph||null;i&&o(),i&&i.dragStart&&e.widget.element.draggable(t.extend({addClasses:!1,appendTo:e.$container,containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(e){var i,r,o,s=t.ui.fancytree.getNode(e.target);return s?(o=s.tree.options.dnd,r=t(s.span),i=t("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>").css({zIndex:3,position:"relative"}).append(r.find("span.fancytree-title").clone()),i.data("ftSourceNode",s),n&&i.find(".fancytree-drag-helper-img").addClass(n.map.dragHelper),o.initHelper&&o.initHelper.call(s.tree,s,{node:s,tree:s.tree,originalEvent:e,ui:{helper:i}}),i):"<div>ERROR?: helper requested but sourceNode not found</div>"},start:function(t,e){return!!e.helper.data("ftSourceNode")}},e.options.dnd.draggable)),i&&i.dragDrop&&e.widget.element.droppable(t.extend({addClasses:!1,tolerance:"intersect",greedy:!1},e.options.dnd.droppable))}var a=!1,l="fancytree-drop-accept",h="fancytree-drop-after",c="fancytree-drop-before",u="fancytree-drop-reject";t.ui.fancytree.registerExtension({name:"dnd",version:"0.3.0",options:{autoExpandMS:1e3,draggable:null,droppable:null,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,smartRevert:!0,dragStart:null,dragStop:null,initHelper:null,updateHelper:null,dragEnter:null,dragOver:null,dragExpand:null,dragDrop:null,dragLeave:null},treeInit:function(e){var i=e.tree;this._superApply(arguments),i.options.dnd.dragStart&&i.$container.on("mousedown",function(i){if(e.options.dnd.focusOnClick){var n=t.ui.fancytree.getNode(i);n&&n.debug("Re-enable focus that was prevented by jQuery UI draggable."),setTimeout(function(){t(i.target).closest(":tabbable").focus()},10)}}),s(i)},_setDndStatus:function(e,i,n,o,s){var a=0,d="center",f=this._local,p=this.options.glyph||null,g=e?t(e.span):null,m=t(i.span);if(f.$dropMarker||(f.$dropMarker=t("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo(t(this.$div).parent()),p&&f.$dropMarker.addClass(p.map.dropMarker)),"after"===o||"before"===o||"over"===o){switch(o){case"before":d="top";break;case"after":d="bottom";break;default:a=8}f.$dropMarker.toggleClass(h,"after"===o).toggleClass("fancytree-drop-over","over"===o).toggleClass(c,"before"===o).show().position(t.ui.fancytree.fixPositionOptions({my:"left"+r(a)+" center",at:"left "+d,of:m}))}else f.$dropMarker.hide();g&&g.toggleClass(l,!0===s).toggleClass(u,!1===s),m.toggleClass("fancytree-drop-target","after"===o||"before"===o||"over"===o).toggleClass(h,"after"===o).toggleClass(c,"before"===o).toggleClass(l,!0===s).toggleClass(u,!1===s),n.toggleClass(l,!0===s).toggleClass(u,!1===s)},_onDragEvent:function(e,r,o,s,a,l){var h,c,u,d,f,p,g,m,v,y=this.options,b=y.dnd,_=this._makeHookContext(r,s,{otherNode:o,ui:a,draggable:l}),w=null,x=this,C=t(r.span);switch(b.smartRevert&&(l.options.revert="invalid"),e){case"start":r.isStatusNode()?w=!1:b.dragStart&&(w=b.dragStart(r,_)),!1===w?(this.debug("tree.dragStart() cancelled"),a.helper.trigger("mouseup").hide()):(b.smartRevert&&(d=r[_.tree.nodeContainerAttrName].getBoundingClientRect(),u=t(l.options.appendTo)[0].getBoundingClientRect(),l.originalPosition.left=Math.max(0,d.left-u.left),l.originalPosition.top=Math.max(0,d.top-u.top)),C.addClass("fancytree-drag-source"),t(i).on("keydown.fancytree-dnd,mousedown.fancytree-dnd",function(e){"keydown"===e.type&&e.which===t.ui.keyCode.ESCAPE?x.ext.dnd._cancelDrag():"mousedown"===e.type&&x.ext.dnd._cancelDrag()}));break;case"enter":v=(!b.preventRecursiveMoves||!r.isDescendantOf(o))&&(b.dragEnter?b.dragEnter(r,_):null),w=!!v&&(t.isArray(v)?{over:t.inArray("over",v)>=0,before:t.inArray("before",v)>=0,after:t.inArray("after",v)>=0}:{over:!0===v||"over"===v,before:!0===v||"before"===v,after:!0===v||"after"===v}),a.helper.data("enterResponse",w);break;case"over":g=a.helper.data("enterResponse"),m=null,!1===g||("string"==typeof g?m=g:(c=C.offset(),f={x:s.pageX-c.left,y:s.pageY-c.top},p={x:f.x/C.width(),y:f.y/C.height()},g.after&&p.y>.75?m="after":!g.over&&g.after&&p.y>.5?m="after":g.before&&p.y<=.25?m="before":!g.over&&g.before&&p.y<=.5?m="before":g.over&&(m="over"),b.preventVoidMoves&&(r===o?(this.debug("    drop over source node prevented"),m=null):"before"===m&&o&&r===o.getNextSibling()?(this.debug("    drop after source node prevented"),m=null):"after"===m&&o&&r===o.getPrevSibling()?(this.debug("    drop before source node prevented"),m=null):"over"===m&&o&&o.parent===r&&o.isLastSibling()&&(this.debug("    drop last child over own parent prevented"),m=null)),a.helper.data("hitMode",m))),"before"===m||"after"===m||!b.autoExpandMS||!1===r.hasChildren()||r.expanded||b.dragExpand&&!1===b.dragExpand(r,_)||r.scheduleAction("expand",b.autoExpandMS),m&&b.dragOver&&(_.hitMode=m,w=b.dragOver(r,_)),h=!1!==w&&null!==m,b.smartRevert&&(l.options.revert=!h),this._local._setDndStatus(o,r,a.helper,m,h);break;case"drop":(m=a.helper.data("hitMode"))&&b.dragDrop&&(_.hitMode=m,b.dragDrop(r,_));break;case"leave":r.scheduleAction("cancel"),a.helper.data("enterResponse",null),a.helper.data("hitMode",null),this._local._setDndStatus(o,r,a.helper,"out",n),b.dragLeave&&b.dragLeave(r,_);break;case"stop":C.removeClass("fancytree-drag-source"),t(i).off(".fancytree-dnd"),b.dragStop&&b.dragStop(r,_);break;default:t.error("Unsupported drag event: "+e)}return w},_cancelDrag:function(){var e=t.ui.ddmanager.current;e&&e.cancel()}})}(jQuery,window,document),function(t,e,i){"use strict";var n=/Mac/.test(navigator.platform),r=t.ui.fancytree.escapeHtml,o=t.ui.fancytree.unescapeHtml;t.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var e,n=this,r=this.tree,s=r.ext.edit,a=r.options.edit,l=t(".fancytree-title",n.span),h={node:n,tree:r,options:r.options,isNew:t(n[r.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:n.title,input:null,dirty:!1};if(!1===a.beforeEdit.call(n,{type:"beforeEdit"},h))return!1;t.ui.fancytree.assert(!s.currentNode,"recursive edit"),s.currentNode=this,s.eventData=h,r.widget._unbind(),t(i).on("mousedown.fancytree-edit",function(e){t(e.target).hasClass("fancytree-edit-input")||n.editEnd(!0,e)}),e=t("<input />",{"class":"fancytree-edit-input",type:"text",value:r.options.escapeTitles?h.orgTitle:o(h.orgTitle)}),s.eventData.input=e,null!=a.adjustWidthOfs&&e.width(l.width()+a.adjustWidthOfs),null!=a.inputCss&&e.css(a.inputCss),l.html(e),e.focus().change(function(){e.addClass("fancytree-edit-dirty")}).keydown(function(e){switch(e.which){case t.ui.keyCode.ESCAPE:n.editEnd(!1,e);break;case t.ui.keyCode.ENTER:return n.editEnd(!0,e),!1}e.stopPropagation()}).blur(function(t){return n.editEnd(!0,t)}),a.edit.call(n,{type:"edit"},h)},t.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(e){var n,o=this,s=this.tree,a=s.ext.edit,l=a.eventData,h=s.options.edit,c=t(".fancytree-title",o.span),u=c.find("input.fancytree-edit-input");return h.trim&&u.val(t.trim(u.val())),n=u.val(),l.dirty=n!==o.title,!1===e?l.save=!1:l.isNew?l.save=""!==n:l.save=l.dirty&&""!==n,!1!==h.beforeClose.call(o,{type:"beforeClose"},l)&&((!l.save||!1!==h.save.call(o,{type:"save"},l))&&(u.removeClass("fancytree-edit-dirty").unbind(),t(i).off(".fancytree-edit"),l.save?(o.setTitle(s.options.escapeTitles?n:r(n)),o.setFocus()):l.isNew?(o.remove(),o=l.node=null,a.relatedNode.setFocus()):(o.renderTitle(),o.setFocus()),a.eventData=null,a.currentNode=null,a.relatedNode=null,s.widget._bind(),t(s.$container).focus(),l.input=null,h.close.call(o,{type:"close"},l),!0))},t.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(e,i){var n,r=this.tree,o=this;if(e=e||"child",null==i?i={title:""}:"string"==typeof i?i={title:i}:t.ui.fancytree.assert(t.isPlainObject(i)),"child"===e&&!this.isExpanded()&&!1!==this.hasChildren())return void this.setExpanded().done(function(){o.editCreateNode(e,i)});n=this.addNode(i,e),n.makeVisible().done(function(){t(n[r.statusClassPropName]).addClass("fancytree-edit-new"),o.tree.ext.edit.relatedNode=o,n.editStart()})},t.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit.currentNode},t.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return this.tree.ext.edit.currentNode===this},t.ui.fancytree.registerExtension({name:"edit",version:"0.2.0",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerCancel:["esc","tab","click"],triggerStart:["f2","shift+click","mac+enter"],trim:!0,beforeClose:t.noop,beforeEdit:t.noop,close:t.noop,edit:t.noop,save:t.noop},currentNode:null,treeInit:function(){this._superApply(arguments),this.$container.addClass("fancytree-ext-edit")},nodeClick:function(e){return t.inArray("shift+click",e.options.edit.triggerStart)>=0&&e.originalEvent.shiftKey?(e.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(e){return t.inArray("dblclick",e.options.edit.triggerStart)>=0?(e.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(e){switch(e.originalEvent.which){case 113:if(t.inArray("f2",e.options.edit.triggerStart)>=0)return e.node.editStart(),!1;break;case t.ui.keyCode.ENTER:if(t.inArray("mac+enter",e.options.edit.triggerStart)>=0&&n)return e.node.editStart(),!1}return this._superApply(arguments)}})}(jQuery,window,document),function(t){"use strict";function e(t){return(t+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}function i(e){return e.indexOf(">")>=0?t("<div/>").html(e).text():e}var n="__not_found__",r=t.ui.fancytree.escapeHtml;t.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(o,s,a){var l,h,c,u,d,f=0,p=this.options,g=p.escapeTitles,m=p.filter,v="hide"===m.mode;return a=a||{},l=!!a.leavesOnly&&!s,"string"==typeof o&&(h=m.fuzzy?o.split("").reduce(function(t,e){return t+"[^"+e+"]*"+e}):e(o),u=new RegExp(".*"+h+".*","i"),d=new RegExp(o,"gi"),o=function(t){var e,n=g?t.title:i(t.title),o=!!u.test(n);return o&&m.highlight&&(e=g?r(t.title):n,t.titleWithHighlight=e.replace(d,function(t){return"<mark>"+t+"</mark>"})),o}),this.enableFilter=!0,this.lastFilterArgs=arguments,this.$div.addClass("fancytree-ext-filter"),v?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.visit(function(t){delete t.match,delete t.titleWithHighlight,t.subMatchCount=0}),c=this.getRootNode()._findDirectChild(n),c&&c.remove(),this.visit(function(t){if(!l||null==t.children){var e=o(t);return"skip"===e?(t.visit(function(t){t.match=!1},!0),"skip"):e&&(f++,t.match=!0,t.visitParents(function(t){t.subMatchCount+=1,a.autoExpand&&!t.expanded&&(t.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),t._filterAutoExpanded=!0)}),s||"branch"===e)?(t.visit(function(t){t.match=!0}),a.autoExpand&&!t.expanded&&(t.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),t._filterAutoExpanded=!0),"skip"):void 0}}),0===f&&m.nodata&&(c=m.nodata,t.isFunction(c)&&(c=c()),!0===c?c={}:"string"==typeof c&&(c={title:c}),c=t.extend({statusNodeType:"nodata",key:n,title:this.options.strings.noData},c),this.getRootNode().addNode(c).match=!0),this.render(),f},t.ui.fancytree._FancytreeClass.prototype.filterNodes=function(t,e){return"boolean"==typeof e&&(e={leavesOnly:e},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19.")),this._applyFilterImpl(t,!1,e)},t.ui.fancytree._FancytreeClass.prototype.applyFilter=function(){return this.warn("Fancytree.applyFilter() is deprecated since 2.1.0 / 2014-05-29. Use .filterNodes() instead."),this.filterNodes.apply(this,arguments)},t.ui.fancytree._FancytreeClass.prototype.filterBranches=function(t,e){return this._applyFilterImpl(t,!0,e)},t.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var e,i=this.getRootNode()._findDirectChild(n),r=this.options.escapeTitles,o=this.options.enhanceTitle;i&&i.remove(),this.visit(function(i){i.match&&(e=t(">span.fancytree-title",i.span),r?e.text(i.title):e.html(i.title),o&&o({type:"enhanceTitle"},{node:i,$title:e})),delete i.match,delete i.subMatchCount,delete i.titleWithHighlight,i.$subMatchBadge&&(i.$subMatchBadge.remove(),delete i.$subMatchBadge),i._filterAutoExpanded&&i.expanded&&i.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete i._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this.render()},t.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},t.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},t.ui.fancytree.registerExtension({name:"filter",version:"0.7.0",options:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,nodata:!0,mode:"dimm",enhanceTitle:null},nodeLoadChildren:function(t){return this._superApply(arguments).done(function(){t.tree.enableFilter&&t.tree.lastFilterArgs&&t.options.filter.autoApply&&t.tree._applyFilterImpl.apply(t.tree,t.tree.lastFilterArgs)})},nodeSetExpanded:function(t,e){return delete t.node._filterAutoExpanded,!e&&t.options.filter.hideExpandedCounter&&t.node.$subMatchBadge&&t.node.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(e){var i,n=e.node,r=e.tree,o=e.options.filter,s=t("span.fancytree-title",n.span),a=t(n[r.statusClassPropName]),l=e.options.enhanceTitle,h=e.options.escapeTitles;return i=this._superApply(arguments),a.length&&r.enableFilter?(a.toggleClass("fancytree-match",!!n.match).toggleClass("fancytree-submatch",!!n.subMatchCount).toggleClass("fancytree-hide",!(n.match||n.subMatchCount)),!o.counter||!n.subMatchCount||n.isExpanded()&&o.hideExpandedCounter?n.$subMatchBadge&&n.$subMatchBadge.hide():(n.$subMatchBadge||(n.$subMatchBadge=t("<span class='fancytree-childcounter'/>"),t("span.fancytree-icon, span.fancytree-custom-icon",n.span).append(n.$subMatchBadge)),n.$subMatchBadge.show().text(n.subMatchCount)),n.titleWithHighlight?s.html(n.titleWithHighlight):h?s.text(n.title):s.html(n.title),l&&l({type:"enhanceTitle"},{node:n,$title:s}),i):i}})}(jQuery,window,document),function(t){"use strict";function e(t,e){return t.map[e]}t.ui.fancytree.registerExtension({name:"glyph",version:"0.4.0",options:{map:{checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",nodata:"icon-meh",noExpander:"",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",doc:"icon-file-alt",docOpen:"icon-file-alt",loading:"icon-refresh icon-spin",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"}},treeInit:function(t){var e=t.tree;this._superApply(arguments),e.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(i){var n,r,o,s=i.node,a=t(s.span),l=i.options.glyph,h=l.map;return r=this._superApply(arguments),s.isRoot()?r:(o=a.children("span.fancytree-expander").get(0),o&&(n=s.expanded?"expanderOpen":s.isUndefined()?"expanderLazy":s.hasChildren()?"expanderClosed":"noExpander",o.className="fancytree-expander "+h[n]),o=s.tr?t("td",s.tr).find("span.fancytree-checkbox").get(0):a.children("span.fancytree-checkbox").get(0),o&&(n=s.selected?"checkboxSelected":s.partsel?"checkboxUnknown":"checkbox",o.className="fancytree-checkbox "+h[n]),o=a.children("span.fancytree-icon").get(0),o&&(n=s.statusNodeType?e(l,s.statusNodeType):s.folder?s.expanded?e(l,"folderOpen"):e(l,"folder"):s.expanded?e(l,"docOpen"):e(l,"doc"),o.className="fancytree-icon "+n),r)},nodeSetStatus:function(i,n){var r,o,s=i.options.glyph,a=i.node;return r=this._superApply(arguments),"error"!==n&&"loading"!==n&&"nodata"!==n||(a.parent?(o=t("span.fancytree-expander",a.span).get(0),o.className="fancytree-expander "+e(s,n)):(o=t(".fancytree-statusnode-"+n,a[this.nodeContainerAttrName]).find("span.fancytree-icon").get(0),o.className="fancytree-icon "+e(s,n))),r}})}(jQuery,window,document),function(t){"use strict";function e(e,i){var n,r=i.get(0),o=0;return e.children().each(function(){if(this===r)return!1;n=t(this).prop("colspan"),o+=n||1}),o}function i(e,i){var n,r=null,o=0;return e.children().each(function(){if(o>=i)return r=t(this),!1;n=t(this).prop("colspan"),o+=n||1}),r}function n(t,n){var o,s,a=t.closest("td"),l=null;switch(n){case r.LEFT:l=a.prev();break;case r.RIGHT:l=a.next();break;case r.UP:case r.DOWN:for(o=a.parent(),s=e(o,a);;){if(o=n===r.UP?o.prev():o.next(),!o.length)break;if(!o.is(":hidden")&&((l=i(o,s))&&l.find(":input").length))break}}return l}var r=t.ui.keyCode,o={text:[r.UP,r.DOWN],checkbox:[r.UP,r.DOWN,r.LEFT,r.RIGHT],radiobutton:[r.UP,r.DOWN,r.LEFT,r.RIGHT],"select-one":[r.LEFT,r.RIGHT],"select-multiple":[r.LEFT,r.RIGHT]};t.ui.fancytree.registerExtension({name:"gridnav",version:"0.0.1",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(e){this._requireExtension("table",!0,!0),this._superApply(arguments),this.$container.addClass("fancytree-ext-gridnav"),this.$container.on("focusin",function(i){var n,r=t.ui.fancytree.getNode(i.target);r&&!r.isActive()&&(n=e.tree._makeHookContext(r,i),e.tree._callHook("nodeSetActive",n,!0))})},nodeSetActive:function(e,i){var n,r=e.options.gridnav,o=e.node,s=e.originalEvent||{},a=t(s.target).is(":input");i=!1!==i,this._superApply(arguments),i&&(e.options.titlesTabbable?(a||(t(o.span).find("span.fancytree-title").focus(),o.setFocus()),e.tree.$container.attr("tabindex","-1")):r.autofocusInput&&!a&&(n=t(o.tr||o.span),n.find(":input:enabled:first").focus()))},nodeKeydown:function(e){var i,r,s,a=e.options.gridnav,l=e.originalEvent,h=t(l.target);return i=h.is(":input:enabled")?h.prop("type"):null,i&&a.handleCursorKeys?!((r=o[i])&&t.inArray(l.which,r)>=0&&(s=n(h,l.which))&&s.length)||(s.find(":input:enabled").focus(),!1):this._superApply(arguments)}})}(jQuery,window,document),function(t,e,i,n){"use strict";function r(e,i,n,o,s){var a,l,h,u,d=!1,f=[],p=[];for(n=n||[],s=s||t.Deferred(),a=0,h=n.length;a<h;a++)l=n[a],u=e.getNodeByKey(l),u?o&&u.isUndefined()?(d=!0,e.debug("_loadLazyNodes: "+u+" is lazy: loading..."),"expand"===o?f.push(u.setExpanded()):f.push(u.load())):(e.debug("_loadLazyNodes: "+u+" already loaded."),u.setExpanded()):(p.push(l),e.debug("_loadLazyNodes: "+u+" was not yet found."));return t.when.apply(t,f).always(function(){if(d&&p.length>0)r(e,i,p,o,s);else{if(p.length)for(e.warn("_loadLazyNodes: could not load those keys: ",p),a=0,h=p.length;a<h;a++)l=n[a],i._appendKey(c,n[a],!1);s.resolve()}}),s}var o,s,a,l=t.ui.fancytree.assert,h="active",c="expanded",u="focus",d="selected";"function"==typeof Cookies?(a=Cookies.set,o=Cookies.get,s=Cookies.remove):(a=o=t.cookie,s=t.removeCookie),t.ui.fancytree._FancytreeClass.prototype.clearCookies=function(t){var e=this.ext.persist,i=e.cookiePrefix;t=t||"active expanded focus selected",t.indexOf(h)>=0&&e._data(i+h,null),t.indexOf(c)>=0&&e._data(i+c,null),t.indexOf(u)>=0&&e._data(i+u,null),t.indexOf(d)>=0&&e._data(i+d,null)},t.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var t=this.ext.persist,e=t.cookiePrefix,i=t.cookieDelimiter,n={};return n[h]=t._data(e+h),n[c]=(t._data(e+c)||"").split(i),n[d]=(t._data(e+d)||"").split(i),n[u]=t._data(e+u),n},t.ui.fancytree.registerExtension({name:"persist",version:"0.3.0",options:{cookieDelimiter:"~",cookiePrefix:n,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,fireActivate:!0,overrideSource:!0,store:"auto",types:"active expanded focus selected"},_data:function(t,e){var i=this._local.localStorage;if(e===n)return i?i.getItem(t):o(t);null===e?i?i.removeItem(t):s(t):i?i.setItem(t,e):a(t,e,this.options.persist.cookie)},_appendKey:function(e,i,n){i=""+i;var r=this._local,o=this.options.persist,s=o.cookieDelimiter,a=r.cookiePrefix+e,l=r._data(a),h=l?l.split(s):[],c=t.inArray(i,h);c>=0&&h.splice(c,1),n&&h.push(i),r._data(a,h.join(s))},treeInit:function(i){var s=i.tree,a=i.options,f=this._local,p=this.options.persist;return l("auto"!==p.store&&"cookie"!==p.store||o,"Missing required plugin for 'persist' extension: js.cookie.js or jquery.cookie.js"),f.cookiePrefix=p.cookiePrefix||"fancytree-"+s._id+"-",f.storeActive=p.types.indexOf(h)>=0,f.storeExpanded=p.types.indexOf(c)>=0,f.storeSelected=p.types.indexOf(d)>=0,f.storeFocus=p.types.indexOf(u)>=0,"cookie"!==p.store&&e.localStorage?f.localStorage="local"===p.store?e.localStorage:e.sessionStorage:f.localStorage=null,s.$div.bind("fancytreeinit",function(){if(!1!==s._triggerTreeEvent("beforeRestore",null,{})){var e,i,o,l,g,m=f._data(f.cookiePrefix+u),v=!1===p.fireActivate;e=f._data(f.cookiePrefix+c),l=e&&e.split(p.cookieDelimiter),i=f.storeExpanded?r(s,f,l,!!p.expandLazy&&"expand",null):(new t.Deferred).resolve(),i.done(function(){if(f.storeSelected){if(e=f._data(f.cookiePrefix+d))for(l=e.split(p.cookieDelimiter),o=0;o<l.length;o++)g=s.getNodeByKey(l[o]),g?(g.selected===n||p.overrideSource&&!1===g.selected)&&(g.selected=!0,g.renderStatus()):f._appendKey(d,l[o],!1);3===s.options.selectMode&&s.visit(function(t){if(t.selected)return t.fixSelection3AfterClick(),"skip"})}f.storeActive&&(!(e=f._data(f.cookiePrefix+h))||!a.persist.overrideSource&&s.activeNode||(g=s.getNodeByKey(e))&&(g.debug("persist: set active",e),g.setActive(!0,{noFocus:!0,noEvents:v}))),f.storeFocus&&m&&(g=s.getNodeByKey(m))&&(s.options.titlesTabbable?t(g.span).find(".fancytree-title").focus():t(s.$container).focus()),s._triggerTreeEvent("restore",null,{})})}}),this._superApply(arguments)},nodeSetActive:function(t,e){var i,n=this._local;return e=!1!==e,i=this._superApply(arguments),n.storeActive&&n._data(n.cookiePrefix+h,this.activeNode?this.activeNode.key:null),i},nodeSetExpanded:function(t,e){var i,n=t.node,r=this._local;return e=!1!==e,i=this._superApply(arguments),r.storeExpanded&&r._appendKey(c,n.key,e),i},nodeSetFocus:function(t,e){var i,n=this._local;return e=!1!==e,i=this._superApply(arguments),n.storeFocus&&n._data(n.cookiePrefix+u,this.focusNode?this.focusNode.key:null),i},nodeSetSelected:function(e,i){var n,r,o=e.tree,s=e.node,a=this._local;return i=!1!==i,n=this._superApply(arguments),a.storeSelected&&(3===o.options.selectMode?(r=t.map(o.getSelectedNodes(!0),function(t){return t.key}),r=r.join(e.options.persist.cookieDelimiter),a._data(a.cookiePrefix+d,r)):a._appendKey(d,s.key,s.selected)),n}})}(jQuery,window,document),function(t,e,i){"use strict";function n(e,i){i=i||"",e||t.error("Assertion failed "+i)}function r(t,e){t.parentNode.insertBefore(e,t.nextSibling)}function o(t,e){t.visit(function(t){var i=t.tr;if(i&&(i.style.display=t.hide||!e?"none":""),!t.expanded)return"skip"})}function s(e){var i,r,o,s=e.parent,a=s?s.children:null;if(a&&a.length>1&&a[0]!==e)for(i=t.inArray(e,a),o=a[i-1],n(o.tr);o.children&&(r=o.children[o.children.length-1],r.tr);)o=r;else o=s;return o}t.ui.fancytree.registerExtension({name:"table",version:"0.3.0",options:{checkboxColumnIdx:null,indentation:16,nodeColumnIdx:0},treeInit:function(e){var r,o,s,a,l=e.tree,h=e.options,c=h.table,u=l.widget.element;if(null!=c.customStatus&&(null!=h.renderStatusColumns?t.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead."):(l.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead."),h.renderStatusColumns=c.customStatus)),h.renderStatusColumns&&!0===h.renderStatusColumns&&(h.renderStatusColumns=h.renderColumns),u.addClass("fancytree-container fancytree-ext-table"),l.tbody=u.find(">tbody")[0],a=t(l.tbody),l.columnCount=t("thead >tr:last >th",u).length,s=a.children("tr:first"),s.length)o=s.children("td").length,l.columnCount&&o!==l.columnCount&&(l.warn("Column count mismatch between thead ("+l.columnCount+") and tbody ("+o+"); using tbody."),l.columnCount=o),s=s.clone();else for(n(l.columnCount>=1,"Need either <thead> or <tbody> with <td> elements to determine column count."),s=t("<tr />"),r=0;r<l.columnCount;r++)s.append("<td />");s.find(">td").eq(c.nodeColumnIdx).html("<span class='fancytree-node' />"),h.aria&&(s.attr("role","row"),s.find("td").attr("role","gridcell")),l.rowFragment=i.createDocumentFragment(),l.rowFragment.appendChild(s.get(0)),a.empty(),l.statusClassPropName="tr",l.ariaPropName="tr",this.nodeContainerAttrName="tr",l.$container=u,this._superApply(arguments),t(l.rootNode.ul).remove(),l.rootNode.ul=null,this.$container.attr("tabindex",h.tabindex),h.aria&&l.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(e){e.node.visit(function(e){e.tr&&(t(e.tr).remove(),e.tr=null)})},nodeRemoveMarkup:function(e){var i=e.node;i.tr&&(t(i.tr).remove(),i.tr=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,i,a,l,h){var c,u,d,f,p,g,m,v,y=e.tree,b=e.node,_=e.options,w=!b.parent;if(h||(e.hasCollapsedParents=b.parent&&!b.parent.expanded),!w)if(b.tr)i?this.nodeRenderTitle(e):this.nodeRenderStatus(e);else{if(e.hasCollapsedParents&&!a)return void b.debug("nodeRender ignored due to unrendered parent");p=y.rowFragment.firstChild.cloneNode(!0),g=s(b),n(g),!0===l&&h?p.style.display="none":a&&e.hasCollapsedParents&&(p.style.display="none"),g.tr?r(g.tr,p):(n(!g.parent,"prev. row must have a tr, or is system root"),y.tbody.appendChild(p)),b.tr=p,b.key&&_.generateIds&&(b.tr.id=_.idPrefix+b.key),b.tr.ftnode=b,_.aria&&t(b.tr).attr("aria-labelledby","ftal_"+b.key),b.span=t("span.fancytree-node",b.tr).get(0),this.nodeRenderTitle(e),_.createNode&&_.createNode.call(y,{type:"createNode"},e)}if(_.renderNode&&_.renderNode.call(y,{type:"renderNode"},e),(c=b.children)&&(w||a||b.expanded))for(d=0,f=c.length;d<f;d++)v=t.extend({},e,{node:c[d]}),v.hasCollapsedParents=v.hasCollapsedParents||!b.expanded,this.nodeRender(v,i,a,l,!0);c&&!h&&(m=b.tr||null,u=y.tbody.firstChild,b.visit(function(t){if(t.tr){if(t.parent.expanded||"none"===t.tr.style.display||(t.tr.style.display="none",o(t,!1)),t.tr.previousSibling!==m){b.debug("_fixOrder: mismatch at node: "+t);var e=m?m.nextSibling:u;y.tbody.insertBefore(t.tr,e)}m=t.tr}}))},nodeRenderTitle:function(e){var i,n,r=e.node,o=e.options,s=r.isStatusNode();return n=this._superApply(arguments),r.isRootNode()?n:(o.checkbox&&!s&&null!=o.table.checkboxColumnIdx&&(i=t("span.fancytree-checkbox",r.span),t(r.tr).find("td").eq(+o.table.checkboxColumnIdx).html(i)),this.nodeRenderStatus(e),s?o.renderStatusColumns&&o.renderStatusColumns.call(e.tree,{type:"renderStatusColumns"},e):o.renderColumns&&o.renderColumns.call(e.tree,{type:"renderColumns"},e),n)},nodeRenderStatus:function(e){var i,n=e.node,r=e.options;this._superApply(arguments),t(n.tr).removeClass("fancytree-node"),i=(n.getLevel()-1)*r.table.indentation,t(n.span).css({paddingLeft:i+"px"})},nodeSetExpanded:function(e,i,n){function r(t){o(e.node,i),t?i&&e.options.autoScroll&&!n.noAnimation&&e.node.hasChildren()?e.node.getLastChild().scrollIntoView(!0,{topNode:e.node}).always(function(){n.noEvents||e.tree._triggerNodeEvent(i?"expand":"collapse",e),s.resolveWith(e.node)}):(n.noEvents||e.tree._triggerNodeEvent(i?"expand":"collapse",e),s.resolveWith(e.node)):(n.noEvents||e.tree._triggerNodeEvent(i?"expand":"collapse",e),s.rejectWith(e.node))}if(i=!1!==i,e.node.expanded&&i||!e.node.expanded&&!i)return this._superApply(arguments);var s=new t.Deferred,a=t.extend({},n,{noEvents:!0,noAnimation:!0});return n=n||{},this._super(e,i,a).done(function(){r(!0)}).fail(function(){r(!1)}),s.promise()},nodeSetStatus:function(e,i){if("ok"===i){var n=e.node,r=n.children?n.children[0]:null;r&&r.isStatusNode()&&t(r.tr).remove()}return this._superApply(arguments)},treeClear:function(){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)},treeDestroy:function(){this.$container.find("tbody").empty(),this.$source&&this.$source.removeClass("ui-helper-hidden")}})}(jQuery,window,document),function(t){"use strict";t.ui.fancytree.registerExtension({name:"themeroller",version:"0.0.1",options:{activeClass:"ui-state-active",foccusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(e){this._superApply(arguments);var i=e.widget.element;"TABLE"===i[0].nodeName?(i.addClass("ui-widget ui-corner-all"),i.find(">thead tr").addClass("ui-widget-header"),i.find(">tbody").addClass("ui-widget-conent")):i.addClass("ui-widget ui-widget-content ui-corner-all"),i.delegate(".fancytree-node","mouseenter mouseleave",function(e){var i=t.ui.fancytree.getNode(e.target),n="mouseenter"===e.type;i.debug("hover: "+n),t(i.tr?i.tr:i.span).toggleClass("ui-state-hover ui-corner-all",n)})},treeDestroy:function(t){this._superApply(arguments),t.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(e){var i=e.node,n=t(i.tr?i.tr:i.span);this._superApply(arguments),n.toggleClass("ui-state-active",i.isActive()),n.toggleClass("ui-state-focus",i.hasFocus()),n.toggleClass("ui-state-highlight",i.isSelected())}})}(jQuery,window,document),function(t){"use strict";function e(e,i){e="fancytree-style-"+e;var n=t("#"+e);if(!i)return n.remove(),null;n.length||(n=t("<style />").attr("id",e).addClass("fancytree-style").prop("type","text/css").appendTo("head"));try{n.html(i)}catch(t){n[0].styleSheet.cssText=i}return n}function i(t,e,i,n,r){var o,s="#"+t+" span.fancytree-level-",a=[];for(o=0;o<e;o++)a.push(s+(o+1)+" span.fancytree-title { padding-left: "+(o*i+n)+r+"; }");return a.push("#"+t+" div.ui-effects-wrapper ul li span.fancytree-title { padding-left: 3px; position: static; width: auto; }"),a.join("\n")}var n=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;t.ui.fancytree.registerExtension({name:"wide",version:"0.0.3",options:{iconWidth:null,iconSpacing:null,levelOfs:null},treeCreate:function(r){this._superApply(arguments),this.$container.addClass("fancytree-ext-wide");var o,s,a,l,h,c=r.options.wide,u=t("<li id='fancytreeTemp'><span class='fancytree-node'><span class='fancytree-icon' /><span class='fancytree-title' /></span><ul />").appendTo(r.tree.$container),d=u.find(".fancytree-icon"),f=u.find("ul"),p=c.iconSpacing||d.css("margin-left"),g=c.iconWidth||d.css("width"),m=c.levelOfs||f.css("padding-left");u.remove(),a=p.match(n)[2],p=parseFloat(p,10),l=g.match(n)[2],g=parseFloat(g,10),h=m.match(n)[2],a===l&&h===l||t.error("iconWidth, iconSpacing, and levelOfs must have the same css measure unit"),this._local.measureUnit=l,this._local.levelOfs=parseFloat(m),this._local.lineOfs=(1+(r.options.checkbox?1:0)+(!1===r.options.icon?0:1))*(g+p)+p,this._local.maxDepth=10,o=this.$container.uniqueId().attr("id"),s=i(o,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.measureUnit),e(o,s)},treeDestroy:function(){return e(this.$container.attr("id"),null),this._superApply(arguments)},nodeRenderStatus:function(n){var r,o,s,a=n.node,l=a.getLevel();return s=this._superApply(arguments),l>this._local.maxDepth&&(r=this.$container.attr("id"),this._local.maxDepth*=2,a.debug("Define global ext-wide css up to level "+this._local.maxDepth),o=i(r,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.measureUnit),e(r,o)),t(a.span).addClass("fancytree-level-"+l),s}})}(jQuery,window,document),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(window.jQuery)}(function($){"use strict";var func=function(){var t=function(t){return function(e){return t===e}},e=function(t,e){return t===e},i=function(t){return function(e,i){return e[t]===i[t]}},n=function(){return!0},r=function(){return!1},o=function(t){return function(){return!t.apply(t,arguments)}},s=function(t,e){return function(i){return t(i)&&e(i)}},a=0;return{eq:t,eq2:e,peq2:i,ok:n,fail:r,self:function(t){return t},not:o,and:s,invoke:function(t,e){return function(){return t[e].apply(t,arguments)}},uniqueId:function(t){var e=++a+"";return t?t+e:e},rect2bnd:function(t){var e=$(document);return{top:t.top+e.scrollTop(),left:t.left+e.scrollLeft(),width:t.right-t.left,height:t.bottom-t.top}},invertObject:function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e},namespaceToCamel:function(t,e){return(e=e||"")+t.split(".").map(function(t){return t.substring(0,1).toUpperCase()+t.substring(1)}).join("")},debounce:function(t,e,i){var n
;return function(){var r=this,o=arguments,s=function(){n=null,i||t.apply(r,o)},a=i&&!n;clearTimeout(n),n=setTimeout(s,e),a&&t.apply(r,o)}}}}(),list=function(){var t=function(t){return t[0]},e=function(t){return t[t.length-1]},i=function(t){return t.slice(0,t.length-1)},n=function(t){return t.slice(1)},r=function(t,e){for(var i=0,n=t.length;i<n;i++){var r=t[i];if(e(r))return r}},o=function(t,e){for(var i=0,n=t.length;i<n;i++)if(!e(t[i]))return!1;return!0},s=function(t,e){return $.inArray(e,t)},a=function(t,e){return-1!==s(t,e)},l=function(t,e){return e=e||func.self,t.reduce(function(t,i){return t+e(i)},0)},h=function(t){for(var e=[],i=-1,n=t.length;++i<n;)e[i]=t[i];return e},c=function(t){return!t||!t.length},u=function(i,r){return i.length?n(i).reduce(function(t,i){var n=e(t);return r(e(n),i)?n[n.length]=i:t[t.length]=[i],t},[[t(i)]]):[]},d=function(t){for(var e=[],i=0,n=t.length;i<n;i++)t[i]&&e.push(t[i]);return e},f=function(t){for(var e=[],i=0,n=t.length;i<n;i++)a(e,t[i])||e.push(t[i]);return e},p=function(t,e){var i=s(t,e);return-1===i?null:t[i+1]};return{head:t,last:e,initial:i,tail:n,prev:function(t,e){var i=s(t,e);return-1===i?null:t[i-1]},next:p,find:r,contains:a,all:o,sum:l,from:h,isEmpty:c,clusterBy:u,compact:d,unique:f}}(),isSupportAmd="function"==typeof define&&define.amd,isFontInstalled=function(t){var e="Comic Sans MS"===t?"Courier New":"Comic Sans MS",i=$("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),n=i.css("fontFamily",e).width(),r=i.css("fontFamily",t+","+e).width();return i.remove(),n!==r},userAgent=navigator.userAgent,isMSIE=/MSIE|Trident/i.test(userAgent),browserVersion;if(isMSIE){var matches=/MSIE (\d+[.]\d+)/.exec(userAgent);matches&&(browserVersion=parseFloat(matches[1])),matches=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(userAgent),matches&&(browserVersion=parseFloat(matches[1]))}var isEdge=/Edge\/\d+/.test(userAgent),hasCodeMirror=!!window.CodeMirror;if(!hasCodeMirror&&isSupportAmd&&"undefined"!=typeof require)if("undefined"!=typeof require.resolve)try{require.resolve("codemirror"),hasCodeMirror=!0}catch(t){}else"undefined"!=typeof eval("require").specified&&(hasCodeMirror=eval("require").specified("codemirror"));var agent={isMac:navigator.appVersion.indexOf("Mac")>-1,isMSIE:isMSIE,isEdge:isEdge,isFF:!isEdge&&/firefox/i.test(userAgent),isPhantom:/PhantomJS/i.test(userAgent),isWebkit:!isEdge&&/webkit/i.test(userAgent),isChrome:!isEdge&&/chrome/i.test(userAgent),isSafari:!isEdge&&/safari/i.test(userAgent),browserVersion:browserVersion,jqueryVersion:parseFloat($.fn.jquery),isSupportAmd:isSupportAmd,hasCodeMirror:hasCodeMirror,isFontInstalled:isFontInstalled,isW3CRangeSupport:!!document.createRange},NBSP_CHAR=String.fromCharCode(160),ZERO_WIDTH_NBSP_CHAR="\ufeff",dom=function(){var t=function(t){return t&&$(t).hasClass("note-editable")},e=function(t){return t&&$(t).hasClass("note-control-sizing")},i=function(t){return t=t.toUpperCase(),function(e){return e&&e.nodeName.toUpperCase()===t}},n=function(t){return t&&3===t.nodeType},r=function(t){return t&&1===t.nodeType},o=function(t){return t&&/^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(t.nodeName.toUpperCase())},s=function(e){return!t(e)&&(e&&/^DIV|^P|^LI|^H[1-7]/.test(e.nodeName.toUpperCase()))},a=function(t){return t&&/^H[1-7]/.test(t.nodeName.toUpperCase())},l=i("PRE"),h=i("LI"),c=function(t){return s(t)&&!h(t)},u=i("TABLE"),d=i("DATA"),f=function(t){return!(y(t)||p(t)||g(t)||s(t)||u(t)||v(t)||d(t))},p=function(t){return t&&/^UL|^OL/.test(t.nodeName.toUpperCase())},g=i("HR"),m=function(t){return t&&/^TD|^TH/.test(t.nodeName.toUpperCase())},v=i("BLOCKQUOTE"),y=function(e){return m(e)||v(e)||t(e)},b=i("A"),_=function(t){return f(t)&&!!D(t,s)},w=function(t){return f(t)&&!D(t,s)},x=i("BODY"),C=function(t,e){return t.nextSibling===e||t.previousSibling===e},S=function(t,e){e=e||func.ok;var i=[];return t.previousSibling&&e(t.previousSibling)&&i.push(t.previousSibling),i.push(t),t.nextSibling&&e(t.nextSibling)&&i.push(t.nextSibling),i},T=agent.isMSIE&&agent.browserVersion<11?"&nbsp;":"<br>",k=function(t){return n(t)?t.nodeValue.length:t?t.childNodes.length:0},E=function(t){var e=k(t);return 0===e||(!n(t)&&1===e&&t.innerHTML===T||!(!list.all(t.childNodes,n)||""!==t.innerHTML))},P=function(t){o(t)||k(t)||(t.innerHTML=T)},D=function(e,i){for(;e;){if(i(e))return e;if(t(e))break;e=e.parentNode}return null},I=function(e,i){for(e=e.parentNode;e&&1===k(e);){if(i(e))return e;if(t(e))break;e=e.parentNode}return null},N=function(e,i){i=i||func.fail;var n=[];return D(e,function(e){return t(e)||n.push(e),i(e)}),n},M=function(t,e){var i=N(t);return list.last(i.filter(e))},L=function(t,e){for(var i=N(t),n=e;n;n=n.parentNode)if($.inArray(n,i)>-1)return n;return null},A=function(t,e){e=e||func.fail;for(var i=[];t&&!e(t);)i.push(t),t=t.previousSibling;return i},R=function(t,e){e=e||func.fail;for(var i=[];t&&!e(t);)i.push(t),t=t.nextSibling;return i},O=function(t,e){var i=[];return e=e||func.ok,function n(r){t!==r&&e(r)&&i.push(r);for(var o=0,s=r.childNodes.length;o<s;o++)n(r.childNodes[o])}(t),i},z=function(t,e){var i=t.parentNode,n=$("<"+e+">")[0];return i.insertBefore(n,t),n.appendChild(t),n},H=function(t,e){var i=e.nextSibling,n=e.parentNode;return i?n.insertBefore(t,i):n.appendChild(t),t},F=function(t,e){return $.each(e,function(e,i){t.appendChild(i)}),t},B=function(t){return 0===t.offset},j=function(t){return t.offset===k(t.node)},W=function(t){return B(t)||j(t)},q=function(t,e){for(;t&&t!==e;){if(0!==Z(t))return!1;t=t.parentNode}return!0},U=function(t,e){if(!e)return!1;for(;t&&t!==e;){if(Z(t)!==k(t.parentNode)-1)return!1;t=t.parentNode}return!0},V=function(t,e){return B(t)&&q(t.node,e)},G=function(t,e){return j(t)&&U(t.node,e)},Z=function(t){for(var e=0;t=t.previousSibling;)e+=1;return e},K=function(t){return!!(t&&t.childNodes&&t.childNodes.length)},Y=function(e,i){var n,r;if(0===e.offset){if(t(e.node))return null;n=e.node.parentNode,r=Z(e.node)}else K(e.node)?(n=e.node.childNodes[e.offset-1],r=k(n)):(n=e.node,r=i?0:e.offset-1);return{node:n,offset:r}},X=function(e,i){var n,r;if(k(e.node)===e.offset){if(t(e.node))return null;n=e.node.parentNode,r=Z(e.node)+1}else K(e.node)?(n=e.node.childNodes[e.offset],r=0):(n=e.node,r=i?k(e.node):e.offset+1);return{node:n,offset:r}},J=function(t,e){return t.node===e.node&&t.offset===e.offset},Q=function(t){if(n(t.node)||!K(t.node)||E(t.node))return!0;var e=t.node.childNodes[t.offset-1],i=t.node.childNodes[t.offset];return!(e&&!o(e)||i&&!o(i))},tt=function(t,e){for(;t;){if(e(t))return t;t=Y(t)}return null},et=function(t,e){for(;t;){if(e(t))return t;t=X(t)}return null},it=function(t){if(!n(t.node))return!1;var e=t.node.nodeValue.charAt(t.offset-1);return e&&" "!==e&&e!==NBSP_CHAR},nt=function(t,e,i,n){for(var r=t;r&&(i(r),!J(r,e));){var o=n&&t.node!==r.node&&e.node!==r.node;r=X(r,o)}},rt=function(t,e){return N(e,func.eq(t)).map(Z).reverse()},ot=function(t,e){for(var i=t,n=0,r=e.length;n<r;n++)i=i.childNodes.length<=e[n]?i.childNodes[i.childNodes.length-1]:i.childNodes[e[n]];return i},st=function(t,e){var i=e&&e.isSkipPaddingBlankHTML,r=e&&e.isNotSplitEdgePoint;if(W(t)&&(n(t.node)||r)){if(B(t))return t.node;if(j(t))return t.node.nextSibling}if(n(t.node))return t.node.splitText(t.offset);var o=t.node.childNodes[t.offset],s=H(t.node.cloneNode(!1),t.node);return F(s,R(o)),i||(P(t.node),P(s)),s},at=function(t,e,i){var n=N(e.node,func.eq(t));return n.length?1===n.length?st(e,i):n.reduce(function(t,n){return t===e.node&&(t=st(e,i)),st({node:n,offset:t?dom.position(t):k(n)},i)}):null},lt=function(t,e){var i,n,r=e?s:y,o=N(t.node,r),a=list.last(o)||t.node;r(a)?(i=o[o.length-2],n=a):(i=a,n=i.parentNode);var l=i&&at(i,t,{isSkipPaddingBlankHTML:e,isNotSplitEdgePoint:e});return l||n!==t.node||(l=t.node.childNodes[t.offset]),{rightNode:l,container:n}},ht=function(t){return document.createElement(t)},ct=function(t){return document.createTextNode(t)},ut=function(t,e){if(t&&t.parentNode){if(t.removeNode)return t.removeNode(e);var i=t.parentNode;if(!e){var n,r,o=[];for(n=0,r=t.childNodes.length;n<r;n++)o.push(t.childNodes[n]);for(n=0,r=o.length;n<r;n++)i.insertBefore(o[n],t)}i.removeChild(t)}},dt=function(e,i){for(;e&&!t(e)&&i(e);){var n=e.parentNode;ut(e),e=n}},ft=function(t,e){if(t.nodeName.toUpperCase()===e.toUpperCase())return t;var i=ht(e);return t.style.cssText&&(i.style.cssText=t.style.cssText),F(i,list.from(t.childNodes)),H(i,t),ut(t),i},pt=i("TEXTAREA"),gt=function(t,e){var i=pt(t[0])?t.val():t.html();return e?i.replace(/[\n\r]/g,""):i},mt=function(t,e){var i=gt(t);if(e){var n=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;i=i.replace(n,function(t,e,i){i=i.toUpperCase();var n=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(i)&&!!e,r=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(i);return t+(n||r?"\n":"")}),i=$.trim(i)}return i},vt=function(t){var e=$(t),i=e.offset(),n=e.outerHeight(!0);return{left:i.left,top:i.top+n}},yt=function(t,e){Object.keys(e).forEach(function(i){t.on(i,e[i])})},bt=function(t,e){Object.keys(e).forEach(function(i){t.off(i,e[i])})};return{NBSP_CHAR:NBSP_CHAR,ZERO_WIDTH_NBSP_CHAR:ZERO_WIDTH_NBSP_CHAR,blank:T,emptyPara:"<p>"+T+"</p>",makePredByNodeName:i,isEditable:t,isControlSizing:e,isText:n,isElement:r,isVoid:o,isPara:s,isPurePara:c,isHeading:a,isInline:f,isBlock:func.not(f),isBodyInline:w,isBody:x,isParaInline:_,isPre:l,isList:p,isTable:u,isData:d,isCell:m,isBlockquote:v,isBodyContainer:y,isAnchor:b,isDiv:i("DIV"),isLi:h,isBR:i("BR"),isSpan:i("SPAN"),isB:i("B"),isU:i("U"),isS:i("S"),isI:i("I"),isImg:i("IMG"),isTextarea:pt,isEmpty:E,isEmptyAnchor:func.and(b,E),isClosestSibling:C,withClosestSiblings:S,nodeLength:k,isLeftEdgePoint:B,isRightEdgePoint:j,isEdgePoint:W,isLeftEdgeOf:q,isRightEdgeOf:U,isLeftEdgePointOf:V,isRightEdgePointOf:G,prevPoint:Y,nextPoint:X,isSamePoint:J,isVisiblePoint:Q,prevPointUntil:tt,nextPointUntil:et,isCharPoint:it,walkPoint:nt,ancestor:D,singleChildAncestor:I,listAncestor:N,lastAncestor:M,listNext:R,listPrev:A,listDescendant:O,commonAncestor:L,wrap:z,insertAfter:H,appendChildNodes:F,position:Z,hasChildren:K,makeOffsetPath:rt,fromOffsetPath:ot,splitTree:at,splitPoint:lt,create:ht,createText:ct,remove:ut,removeWhile:dt,replace:ft,html:mt,value:gt,posFromPlaceholder:vt,attachEvents:yt,detachEvents:bt}}(),Context=function(t,e){var i=this,n=$.summernote.ui;return this.memos={},this.modules={},this.layoutInfo={},this.options=e,this.initialize=function(){return this.layoutInfo=n.createLayout(t,e),this._initialize(),t.hide(),this},this.destroy=function(){this._destroy(),t.removeData("summernote"),n.removeLayout(t,this.layoutInfo)},this.reset=function(){var t=i.isDisabled();this.code(dom.emptyPara),this._destroy(),this._initialize(),t&&i.disable()},this._initialize=function(){var t=$.extend({},this.options.buttons);Object.keys(t).forEach(function(e){i.memo("button."+e,t[e])});var e=$.extend({},this.options.modules,$.summernote.plugins||{});Object.keys(e).forEach(function(t){i.module(t,e[t],!0)}),Object.keys(this.modules).forEach(function(t){i.initializeModule(t)})},this._destroy=function(){Object.keys(this.modules).reverse().forEach(function(t){i.removeModule(t)}),Object.keys(this.memos).forEach(function(t){i.removeMemo(t)})},this.code=function(e){var i=this.invoke("codeview.isActivated");if(e===undefined)return this.invoke("codeview.sync"),i?this.layoutInfo.codable.val():this.layoutInfo.editable.html();i?this.layoutInfo.codable.val(e):this.layoutInfo.editable.html(e),t.val(e),this.triggerEvent("change",e)},this.isDisabled=function(){return"false"===this.layoutInfo.editable.attr("contenteditable")},this.enable=function(){this.layoutInfo.editable.attr("contenteditable",!0),this.invoke("toolbar.activate",!0)},this.disable=function(){this.invoke("codeview.isActivated")&&this.invoke("codeview.deactivate"),this.layoutInfo.editable.attr("contenteditable",!1),this.invoke("toolbar.deactivate",!0)},this.triggerEvent=function(){var e=list.head(arguments),i=list.tail(list.from(arguments)),n=this.options.callbacks[func.namespaceToCamel(e,"on")];n&&n.apply(t[0],i),t.trigger("summernote."+e,i)},this.initializeModule=function(e){var i=this.modules[e];i.shouldInitialize=i.shouldInitialize||func.ok,i.shouldInitialize()&&(i.initialize&&i.initialize(),i.events&&dom.attachEvents(t,i.events))},this.module=function(t,e,i){if(1===arguments.length)return this.modules[t];this.modules[t]=new e(this),i||this.initializeModule(t)},this.removeModule=function(e){var i=this.modules[e];i.shouldInitialize()&&(i.events&&dom.detachEvents(t,i.events),i.destroy&&i.destroy()),delete this.modules[e]},this.memo=function(t,e){if(1===arguments.length)return this.memos[t];this.memos[t]=e},this.removeMemo=function(t){this.memos[t]&&this.memos[t].destroy&&this.memos[t].destroy(),delete this.memos[t]},this.createInvokeHandler=function(t,e){return function(n){n.preventDefault(),i.invoke(t,e||$(n.target).closest("[data-value]").data("value"))}},this.invoke=function(){var t=list.head(arguments),e=list.tail(list.from(arguments)),i=t.split("."),n=i.length>1,r=n&&list.head(i),o=n?list.last(i):list.head(i),s=this.modules[r||"editor"];return!r&&this[o]?this[o].apply(this,e):s&&s[o]&&s.shouldInitialize()?s[o].apply(s,e):void 0},this.initialize()};$.fn.extend({summernote:function(){var t=$.type(list.head(arguments)),e="string"===t,i="object"===t,n=i?list.head(arguments):{};n=$.extend({},$.summernote.options,n),n.langInfo=$.extend(!0,{},$.summernote.lang["en-US"],$.summernote.lang[n.lang]),n.icons=$.extend(!0,{},$.summernote.options.icons,n.icons),this.each(function(t,e){var i=$(e);if(!i.data("summernote")){var r=new Context(i,n);i.data("summernote",r),i.data("summernote").triggerEvent("init",r.layoutInfo)}});var r=this.first();if(r.length){var o=r.data("summernote");if(e)return o.invoke.apply(o,list.from(arguments));n.focus&&o.invoke("editor.focus")}return this}});var Renderer=function(t,e,i,n){this.render=function(r){var o=$(t);if(i&&i.contents&&o.html(i.contents),i&&i.className&&o.addClass(i.className),i&&i.data&&$.each(i.data,function(t,e){o.attr("data-"+t,e)}),i&&i.click&&o.on("click",i.click),e){var s=o.find(".note-children-container");e.forEach(function(t){t.render(s.length?s:o)})}return n&&n(o,i),i&&i.callback&&i.callback(o),r&&r.append(o),o}},renderer={create:function(t,e){return function(){var i=$.isArray(arguments[0])?arguments[0]:[],n="object"==typeof arguments[1]?arguments[1]:arguments[0];return n&&n.children&&(i=n.children),new Renderer(t,i,n,e)}}},editor=renderer.create('<div class="note-editor note-frame panel panel-default"/>'),toolbar=renderer.create('<div class="note-toolbar panel-heading"/>'),editingArea=renderer.create('<div class="note-editing-area"/>'),codable=renderer.create('<textarea class="note-codable"/>'),editable=renderer.create('<div class="note-editable panel-body" contentEditable="true"/>'),statusbar=renderer.create(['<div class="note-statusbar">','  <div class="note-resizebar">','    <div class="note-icon-bar"/>','    <div class="note-icon-bar"/>','    <div class="note-icon-bar"/>',"  </div>","</div>"].join("")),airEditor=renderer.create('<div class="note-editor"/>'),airEditable=renderer.create('<div class="note-editable" contentEditable="true"/>'),buttonGroup=renderer.create('<div class="note-btn-group btn-group">'),button=renderer.create('<button type="button" class="note-btn btn btn-default btn-sm" tabindex="-1">',function(t,e){e&&e.tooltip&&t.attr({title:e.tooltip}).tooltip({container:"body",trigger:"hover",placement:"bottom"})}),dropdown=renderer.create('<div class="dropdown-menu">',function(t,e){var i=$.isArray(e.items)?e.items.map(function(t){return'<li><a href="#" data-value="'+("string"==typeof t?t:t.value||"")+'">'+(e.template?e.template(t):t)+"</a></li>"}).join(""):e.items;t.html(i)}),dropdownCheck=renderer.create('<div class="dropdown-menu note-check">',function(t,e){var i=$.isArray(e.items)?e.items.map(function(t){var i="string"==typeof t?t:t.value||"",n=e.template?e.template(t):t;return'<li><a href="#" data-value="'+i+'">'+icon(e.checkClassName)+" "+n+"</a></li>"}).join(""):e.items;t.html(i)}),palette=renderer.create('<div class="note-color-palette"/>',function(t,e){for(var i=[],n=0,r=e.colors.length;n<r;n++){for(var o=e.eventName,s=e.colors[n],a=[],l=0,h=s.length;l<h;l++){var c=s[l];a.push(['<button type="button" class="note-color-btn"','style="background-color:',c,'" ','data-event="',o,'" ','data-value="',c,'" ','title="',c,'" ','data-toggle="button" tabindex="-1"></button>'].join(""))}i.push('<div class="note-color-row">'+a.join("")+"</div>")}t.html(i.join("")),t.find(".note-color-btn").tooltip({container:"body",trigger:"hover",placement:"bottom"})}),dialog=renderer.create('<div class="modal" aria-hidden="false" tabindex="-1"/>',function(t,e){e.fade&&t.addClass("fade"),t.html(['<div class="modal-dialog">','  <div class="modal-content">',e.title?'    <div class="modal-header">      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>      <h4 class="modal-title">'+e.title+"</h4>    </div>":"",'    <div class="modal-body">'+e.body+"</div>",e.footer?'    <div class="modal-footer">'+e.footer+"</div>":"","  </div>","</div>"].join(""))}),popover=renderer.create(['<div class="note-popover popover in">','  <div class="arrow"/>','  <div class="popover-content note-children-container"/>',"</div>"].join(""),function(t,e){var i="undefined"!=typeof e.direction?e.direction:"bottom";t.addClass(i),e.hideArrow&&t.find(".arrow").hide()}),icon=function(t,e){return"<"+(e=e||"i")+' class="'+t+'"/>'},ui={editor:editor,toolbar:toolbar,editingArea:editingArea,codable:codable,editable:editable,statusbar:statusbar,airEditor:airEditor,airEditable:airEditable,buttonGroup:buttonGroup,button:button,dropdown:dropdown,dropdownCheck:dropdownCheck,palette:palette,dialog:dialog,popover:popover,icon:icon,toggleBtn:function(t,e){t.toggleClass("disabled",!e),t.attr("disabled",!e)},toggleBtnActive:function(t,e){t.toggleClass("active",e)},onDialogShown:function(t,e){t.one("shown.bs.modal",e)},onDialogHidden:function(t,e){t.one("hidden.bs.modal",e)},showDialog:function(t){t.modal("show")},hideDialog:function(t){t.modal("hide")},createLayout:function(t,e){var i=(e.airMode?ui.airEditor([ui.editingArea([ui.airEditable()])]):ui.editor([ui.toolbar(),ui.editingArea([ui.codable(),ui.editable()]),ui.statusbar()])).render();return i.insertAfter(t),{note:t,editor:i,toolbar:i.find(".note-toolbar"),editingArea:i.find(".note-editing-area"),editable:i.find(".note-editable"),codable:i.find(".note-codable"),statusbar:i.find(".note-statusbar")}},removeLayout:function(t,e){t.html(e.editable.html()),e.editor.remove(),t.show()}};$.summernote=$.summernote||{lang:{}},$.extend($.summernote.lang,{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",clear:"Remove Font Style",height:"Line Height",name:"Font Family",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",size:"Font Size"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag image or text here",dropImage:"Drop image or Text",selectFromFiles:"Select from files",maximumFileSize:"Maximum file size",maximumFileSizeError:"Maximum file size exceeded.",url:"Image URL",remove:"Remove Image"},video:{video:"Video",videoLink:"Video Link",insert:"Insert Video",url:"Video URL?",providers:"(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style",extraKeys:"Extra keys"},help:{insertParagraph:"Insert Paragraph",undo:"Undoes the last command",redo:"Redoes the last command",tab:"Tab",untab:"Untab",bold:"Set a bold style",italic:"Set a italic style",underline:"Set a underline style",strikethrough:"Set a strikethrough style",removeFormat:"Clean a style",justifyLeft:"Set left align",justifyCenter:"Set center align",justifyRight:"Set right align",justifyFull:"Set full align",insertUnorderedList:"Toggle unordered list",insertOrderedList:"Toggle ordered list",outdent:"Outdent on current paragraph",indent:"Indent on current paragraph",formatPara:"Change current block's format as a paragraph(P tag)",formatH1:"Change current block's format as H1",formatH2:"Change current block's format as H2",formatH3:"Change current block's format as H3",formatH4:"Change current block's format as H4",formatH5:"Change current block's format as H5",formatH6:"Change current block's format as H6",insertHorizontalRule:"Insert horizontal rule","linkDialog.show":"Show Link Dialog"},history:{undo:"Undo",redo:"Redo"},specialChar:{specialChar:"SPECIAL CHARACTERS",select:"Select Special characters"}}});var key=function(){var t={BACKSPACE:8,TAB:9,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,B:66,E:69,I:73,J:74,K:75,L:76,R:82,S:83,U:85,V:86,Y:89,Z:90,SLASH:191,LEFTBRACKET:219,BACKSLASH:220,RIGHTBRACKET:221};return{isEdit:function(e){return list.contains([t.BACKSPACE,t.TAB,t.ENTER,t.SPACE],e)},isMove:function(e){return list.contains([t.LEFT,t.UP,t.RIGHT,t.DOWN],e)},nameFromCode:func.invertObject(t),code:t}}(),range=function(){var t=function(t,e){var i,n,r=t.parentElement(),o=document.body.createTextRange(),s=list.from(r.childNodes);for(i=0;i<s.length;i++)if(!dom.isText(s[i])){if(o.moveToElementText(s[i]),o.compareEndPoints("StartToStart",t)>=0)break;n=s[i]}if(0!==i&&dom.isText(s[i-1])){var a=document.body.createTextRange(),l=null;a.moveToElementText(n||r),a.collapse(!n),l=n?n.nextSibling:r.firstChild;var h=t.duplicate();h.setEndPoint("StartToStart",a);for(var c=h.text.replace(/[\r\n]/g,"").length;c>l.nodeValue.length&&l.nextSibling;)c-=l.nodeValue.length,l=l.nextSibling;l.nodeValue;e&&l.nextSibling&&dom.isText(l.nextSibling)&&c===l.nodeValue.length&&(c-=l.nodeValue.length,l=l.nextSibling),r=l,i=c}return{cont:r,offset:i}},e=function(t){var e=function(t,i){var n,r;if(dom.isText(t)){var o=dom.listPrev(t,func.not(dom.isText)),s=list.last(o).previousSibling;n=s||t.parentNode,i+=list.sum(list.tail(o),dom.nodeLength),r=!s}else{if(n=t.childNodes[i]||t,dom.isText(n))return e(n,0);i=0,r=!1}return{node:n,collapseToStart:r,offset:i}},i=document.body.createTextRange(),n=e(t.node,t.offset);return i.moveToElementText(n.node),i.collapse(n.collapseToStart),i.moveStart("character",n.offset),i},i=function(t,n,r,o){this.sc=t,this.so=n,this.ec=r,this.eo=o;var s=function(){if(agent.isW3CRangeSupport){var i=document.createRange();return i.setStart(t,n),i.setEnd(r,o),i}var s=e({node:t,offset:n});return s.setEndPoint("EndToEnd",e({node:r,offset:o})),s};this.getPoints=function(){return{sc:t,so:n,ec:r,eo:o}},this.getStartPoint=function(){return{node:t,offset:n}},this.getEndPoint=function(){return{node:r,offset:o}},this.select=function(){var t=s();if(agent.isW3CRangeSupport){var e=document.getSelection();e.rangeCount>0&&e.removeAllRanges(),e.addRange(t)}else t.select();return this},this.scrollIntoView=function(t){var e=$(t).height();return t.scrollTop+e<this.sc.offsetTop&&(t.scrollTop+=Math.abs(t.scrollTop+e-this.sc.offsetTop)),this},this.normalize=function(){var t=function(t,e){if(dom.isVisiblePoint(t)&&!dom.isEdgePoint(t)||dom.isVisiblePoint(t)&&dom.isRightEdgePoint(t)&&!e||dom.isVisiblePoint(t)&&dom.isLeftEdgePoint(t)&&e||dom.isVisiblePoint(t)&&dom.isBlock(t.node)&&dom.isEmpty(t.node))return t;var i=dom.ancestor(t.node,dom.isBlock);if((dom.isLeftEdgePointOf(t,i)||dom.isVoid(dom.prevPoint(t).node))&&!e||(dom.isRightEdgePointOf(t,i)||dom.isVoid(dom.nextPoint(t).node))&&e){if(dom.isVisiblePoint(t))return t;e=!e}return(e?dom.nextPointUntil(dom.nextPoint(t),dom.isVisiblePoint):dom.prevPointUntil(dom.prevPoint(t),dom.isVisiblePoint))||t},e=t(this.getEndPoint(),!1),n=this.isCollapsed()?e:t(this.getStartPoint(),!0);return new i(n.node,n.offset,e.node,e.offset)},this.nodes=function(t,e){t=t||func.ok;var i=e&&e.includeAncestor,n=e&&e.fullyContains,r=this.getStartPoint(),o=this.getEndPoint(),s=[],a=[];return dom.walkPoint(r,o,function(e){if(!dom.isEditable(e.node)){var r;n?(dom.isLeftEdgePoint(e)&&a.push(e.node),dom.isRightEdgePoint(e)&&list.contains(a,e.node)&&(r=e.node)):r=i?dom.ancestor(e.node,t):e.node,r&&t(r)&&s.push(r)}},!0),list.unique(s)},this.commonAncestor=function(){return dom.commonAncestor(t,r)},this.expand=function(e){var s=dom.ancestor(t,e),a=dom.ancestor(r,e);if(!s&&!a)return new i(t,n,r,o);var l=this.getPoints();return s&&(l.sc=s,l.so=0),a&&(l.ec=a,l.eo=dom.nodeLength(a)),new i(l.sc,l.so,l.ec,l.eo)},this.collapse=function(e){return e?new i(t,n,t,n):new i(r,o,r,o)},this.splitText=function(){var e=t===r,s=this.getPoints();return dom.isText(r)&&!dom.isEdgePoint(this.getEndPoint())&&r.splitText(o),dom.isText(t)&&!dom.isEdgePoint(this.getStartPoint())&&(s.sc=t.splitText(n),s.so=0,e&&(s.ec=s.sc,s.eo=o-n)),new i(s.sc,s.so,s.ec,s.eo)},this.deleteContents=function(){if(this.isCollapsed())return this;var t=this.splitText(),e=t.nodes(null,{fullyContains:!0}),n=dom.prevPointUntil(t.getStartPoint(),function(t){return!list.contains(e,t.node)}),r=[];return $.each(e,function(t,e){var i=e.parentNode;n.node!==i&&1===dom.nodeLength(i)&&r.push(i),dom.remove(e,!1)}),$.each(r,function(t,e){dom.remove(e,!1)}),new i(n.node,n.offset,n.node,n.offset).normalize()};var a=function(e){return function(){var i=dom.ancestor(t,e);return!!i&&i===dom.ancestor(r,e)}};this.isOnEditable=a(dom.isEditable),this.isOnList=a(dom.isList),this.isOnAnchor=a(dom.isAnchor),this.isOnCell=a(dom.isCell),this.isOnData=a(dom.isData),this.isLeftEdgeOf=function(t){if(!dom.isLeftEdgePoint(this.getStartPoint()))return!1;var e=dom.ancestor(this.sc,t);return e&&dom.isLeftEdgeOf(this.sc,e)},this.isCollapsed=function(){return t===r&&n===o},this.wrapBodyInlineWithPara=function(){if(dom.isBodyContainer(t)&&dom.isEmpty(t))return t.innerHTML=dom.emptyPara,new i(t.firstChild,0,t.firstChild,0);var e=this.normalize();if(dom.isParaInline(t)||dom.isPara(t))return e;var n;if(dom.isInline(e.sc)){var r=dom.listAncestor(e.sc,func.not(dom.isInline));n=list.last(r),dom.isInline(n)||(n=r[r.length-2]||e.sc.childNodes[e.so])}else n=e.sc.childNodes[e.so>0?e.so-1:0];var o=dom.listPrev(n,dom.isParaInline).reverse();if(o=o.concat(dom.listNext(n.nextSibling,dom.isParaInline)),o.length){var s=dom.wrap(list.head(o),"p");dom.appendChildNodes(s,list.tail(o))}return this.normalize()},this.insertNode=function(t){var e=this.wrapBodyInlineWithPara().deleteContents(),i=dom.splitPoint(e.getStartPoint(),dom.isInline(t));return i.rightNode?i.rightNode.parentNode.insertBefore(t,i.rightNode):i.container.appendChild(t),t},this.pasteHTML=function(t){var e=$("<div></div>").html(t)[0],i=list.from(e.childNodes),n=this.wrapBodyInlineWithPara().deleteContents();return i.reverse().map(function(t){return n.insertNode(t)}).reverse()},this.toString=function(){var t=s();return agent.isW3CRangeSupport?t.toString():t.text},this.getWordRange=function(t){var e=this.getEndPoint();if(!dom.isCharPoint(e))return this;var n=dom.prevPointUntil(e,function(t){return!dom.isCharPoint(t)});return t&&(e=dom.nextPointUntil(e,function(t){return!dom.isCharPoint(t)})),new i(n.node,n.offset,e.node,e.offset)},this.bookmark=function(e){return{s:{path:dom.makeOffsetPath(e,t),offset:n},e:{path:dom.makeOffsetPath(e,r),offset:o}}},this.paraBookmark=function(e){return{s:{path:list.tail(dom.makeOffsetPath(list.head(e),t)),offset:n},e:{path:list.tail(dom.makeOffsetPath(list.last(e),r)),offset:o}}},this.getClientRects=function(){return s().getClientRects()}};return{create:function(t,e,n,r){if(4===arguments.length)return new i(t,e,n,r);if(2===arguments.length)return n=t,r=e,new i(t,e,n,r);var o=this.createFromSelection();return o||1!==arguments.length?o:(o=this.createFromNode(arguments[0]),o.collapse(dom.emptyPara===arguments[0].innerHTML))},createFromSelection:function(){var e,n,r,o;if(agent.isW3CRangeSupport){var s=document.getSelection();if(!s||0===s.rangeCount)return null;if(dom.isBody(s.anchorNode))return null;var a=s.getRangeAt(0);e=a.startContainer,n=a.startOffset,r=a.endContainer,o=a.endOffset}else{var l=document.selection.createRange(),h=l.duplicate();h.collapse(!1);var c=l;c.collapse(!0);var u=t(c,!0),d=t(h,!1);dom.isText(u.node)&&dom.isLeftEdgePoint(u)&&dom.isTextNode(d.node)&&dom.isRightEdgePoint(d)&&d.node.nextSibling===u.node&&(u=d),e=u.cont,n=u.offset,r=d.cont,o=d.offset}return new i(e,n,r,o)},createFromNode:function(t){var e=t,i=0,n=t,r=dom.nodeLength(n);return dom.isVoid(e)&&(i=dom.listPrev(e).length-1,e=e.parentNode),dom.isBR(n)?(r=dom.listPrev(n).length-1,n=n.parentNode):dom.isVoid(n)&&(r=dom.listPrev(n).length,n=n.parentNode),this.create(e,i,n,r)},createFromNodeBefore:function(t){return this.createFromNode(t).collapse(!0)},createFromNodeAfter:function(t){return this.createFromNode(t).collapse()},createFromBookmark:function(t,e){var n=dom.fromOffsetPath(t,e.s.path),r=e.s.offset,o=dom.fromOffsetPath(t,e.e.path),s=e.e.offset;return new i(n,r,o,s)},createFromParaBookmark:function(t,e){var n=t.s.offset,r=t.e.offset,o=dom.fromOffsetPath(list.head(e),t.s.path),s=dom.fromOffsetPath(list.last(e),t.e.path);return new i(o,n,s,r)}}}(),async=function(){return{readFileAsDataURL:function(t){return $.Deferred(function(e){$.extend(new FileReader,{onload:function(t){var i=t.target.result;e.resolve(i)},onerror:function(){e.reject(this)}}).readAsDataURL(t)}).promise()},createImage:function(t){return $.Deferred(function(e){var i=$("<img>");i.one("load",function(){i.off("error abort"),e.resolve(i)}).one("error abort",function(){i.off("load").detach(),e.reject(i)}).css({display:"none"}).appendTo(document.body).attr("src",t)}).promise()}}}(),History=function(t){var e=[],i=-1,n=t[0],r=function(){var e=range.create(n),i={s:{path:[],offset:0},e:{path:[],offset:0}};return{contents:t.html(),bookmark:e?e.bookmark(n):i}},o=function(e){null!==e.contents&&t.html(e.contents),null!==e.bookmark&&range.createFromBookmark(n,e.bookmark).select()};this.rewind=function(){t.html()!==e[i].contents&&this.recordUndo(),i=0,o(e[i])},this.reset=function(){e=[],i=-1,t.html(""),this.recordUndo()},this.undo=function(){t.html()!==e[i].contents&&this.recordUndo(),0<i&&(i--,o(e[i]))},this.redo=function(){e.length-1>i&&(i++,o(e[i]))},this.recordUndo=function(){i++,e.length>i&&(e=e.slice(0,i)),e.push(r())}},Style=function(){var t=function(t,e){if(agent.jqueryVersion<1.9){var i={};return $.each(e,function(e,n){i[n]=t.css(n)}),i}return t.css.call(t,e)};this.fromNode=function(e){var i=["font-family","font-size","text-align","list-style-type","line-height"],n=t(e,i)||{};return n["font-size"]=parseInt(n["font-size"],10),n},this.stylePara=function(t,e){$.each(t.nodes(dom.isPara,{includeAncestor:!0}),function(t,i){$(i).css(e)})},this.styleNodes=function(t,e){t=t.splitText();var i=e&&e.nodeName||"SPAN",n=!(!e||!e.expandClosestSibling),r=!(!e||!e.onlyPartialContains);if(t.isCollapsed())return[t.insertNode(dom.create(i))];var o=dom.makePredByNodeName(i),s=t.nodes(dom.isText,{fullyContains:!0}).map(function(t){return dom.singleChildAncestor(t,o)||dom.wrap(t,i)});if(n){if(r){var a=t.nodes();o=func.and(o,function(t){return list.contains(a,t)})}return s.map(function(t){var e=dom.withClosestSiblings(t,o),i=list.head(e),n=list.tail(e);return $.each(n,function(t,e){dom.appendChildNodes(i,e.childNodes),dom.remove(e)}),list.head(e)})}return s},this.current=function(t){var e=$(dom.isElement(t.sc)?t.sc:t.sc.parentNode),i=this.fromNode(e);try{i=$.extend(i,{"font-bold":document.queryCommandState("bold")?"bold":"normal","font-italic":document.queryCommandState("italic")?"italic":"normal",
"font-underline":document.queryCommandState("underline")?"underline":"normal","font-subscript":document.queryCommandState("subscript")?"subscript":"normal","font-superscript":document.queryCommandState("superscript")?"superscript":"normal","font-strikethrough":document.queryCommandState("strikethrough")?"strikethrough":"normal"})}catch(t){}if(t.isOnList()){var n=["circle","disc","disc-leading-zero","square"],r=$.inArray(i["list-style-type"],n)>-1;i["list-style"]=r?"unordered":"ordered"}else i["list-style"]="none";var o=dom.ancestor(t.sc,dom.isPara);if(o&&o.style["line-height"])i["line-height"]=o.style.lineHeight;else{var s=parseInt(i["line-height"],10)/parseInt(i["font-size"],10);i["line-height"]=s.toFixed(1)}return i.anchor=t.isOnAnchor()&&dom.ancestor(t.sc,dom.isAnchor),i.ancestors=dom.listAncestor(t.sc,dom.isEditable),i.range=t,i}},Bullet=function(){var t=this;this.insertOrderedList=function(t){this.toggleList("OL",t)},this.insertUnorderedList=function(t){this.toggleList("UL",t)},this.indent=function(t){var e=this,i=range.create(t).wrapBodyInlineWithPara(),n=i.nodes(dom.isPara,{includeAncestor:!0}),r=list.clusterBy(n,func.peq2("parentNode"));$.each(r,function(t,i){var n=list.head(i);dom.isLi(n)?e.wrapList(i,n.parentNode.nodeName):$.each(i,function(t,e){$(e).css("marginLeft",function(t,e){return(parseInt(e,10)||0)+25})})}),i.select()},this.outdent=function(t){var e=this,i=range.create(t).wrapBodyInlineWithPara(),n=i.nodes(dom.isPara,{includeAncestor:!0}),r=list.clusterBy(n,func.peq2("parentNode"));$.each(r,function(t,i){var n=list.head(i);dom.isLi(n)?e.releaseList([i]):$.each(i,function(t,e){$(e).css("marginLeft",function(t,e){return e=parseInt(e,10)||0,e>25?e-25:""})})}),i.select()},this.toggleList=function(e,i){var n=range.create(i).wrapBodyInlineWithPara(),r=n.nodes(dom.isPara,{includeAncestor:!0}),o=n.paraBookmark(r),s=list.clusterBy(r,func.peq2("parentNode"));if(list.find(r,dom.isPurePara)){var a=[];$.each(s,function(i,n){a=a.concat(t.wrapList(n,e))}),r=a}else{var l=n.nodes(dom.isList,{includeAncestor:!0}).filter(function(t){return!$.nodeName(t,e)});l.length?$.each(l,function(t,i){dom.replace(i,e)}):r=this.releaseList(s,!0)}range.createFromParaBookmark(o,r).select()},this.wrapList=function(t,e){var i=list.head(t),n=list.last(t),r=dom.isList(i.previousSibling)&&i.previousSibling,o=dom.isList(n.nextSibling)&&n.nextSibling,s=r||dom.insertAfter(dom.create(e||"UL"),n);return t=t.map(function(t){return dom.isPurePara(t)?dom.replace(t,"LI"):t}),dom.appendChildNodes(s,t),o&&(dom.appendChildNodes(s,list.from(o.childNodes)),dom.remove(o)),t},this.releaseList=function(t,e){var i=[];return $.each(t,function(t,n){var r=list.head(n),o=list.last(n),s=e?dom.lastAncestor(r,dom.isList):r.parentNode,a=s.childNodes.length>1?dom.splitTree(s,{node:o.parentNode,offset:dom.position(o)+1},{isSkipPaddingBlankHTML:!0}):null,l=dom.splitTree(s,{node:r.parentNode,offset:dom.position(r)},{isSkipPaddingBlankHTML:!0});n=e?dom.listDescendant(l,dom.isLi):list.from(l.childNodes).filter(dom.isLi),!e&&dom.isList(s.parentNode)||(n=n.map(function(t){return dom.replace(t,"P")})),$.each(list.from(n).reverse(),function(t,e){dom.insertAfter(e,s)});var h=list.compact([s,l,a]);$.each(h,function(t,e){var i=[e].concat(dom.listDescendant(e,dom.isList));$.each(i.reverse(),function(t,e){dom.nodeLength(e)||dom.remove(e,!0)})}),i=i.concat(n)}),i}},Typing=function(){var t=new Bullet;this.insertTab=function(t,e){var i=dom.createText(new Array(e+1).join(dom.NBSP_CHAR));t=t.deleteContents(),t.insertNode(i,!0),t=range.create(i,e),t.select()},this.insertParagraph=function(e){var i=range.create(e);i=i.deleteContents(),i=i.wrapBodyInlineWithPara();var n,r=dom.ancestor(i.sc,dom.isPara);if(r){if(dom.isEmpty(r)&&dom.isLi(r))return void t.toggleList(r.parentNode.nodeName);if(dom.isEmpty(r)&&dom.isPara(r)&&dom.isBlockquote(r.parentNode))dom.insertAfter(r,r.parentNode),n=r;else{n=dom.splitTree(r,i.getStartPoint());var o=dom.listDescendant(r,dom.isEmptyAnchor);o=o.concat(dom.listDescendant(n,dom.isEmptyAnchor)),$.each(o,function(t,e){dom.remove(e)}),(dom.isHeading(n)||dom.isPre(n))&&dom.isEmpty(n)&&(n=dom.replace(n,"p"))}}else{var s=i.sc.childNodes[i.so];n=$(dom.emptyPara)[0],s?i.sc.insertBefore(n,s):i.sc.appendChild(n)}range.create(n,0).normalize().select().scrollIntoView(e)}},Table=function(){this.tab=function(t,e){var i=dom.ancestor(t.commonAncestor(),dom.isCell),n=dom.ancestor(i,dom.isTable),r=dom.listDescendant(n,dom.isCell),o=list[e?"prev":"next"](r,i);o&&range.create(o,0).select()},this.createTable=function(t,e,i){for(var n,r=[],o=0;o<t;o++)r.push("<td>"+dom.blank+"</td>");n=r.join("");for(var s,a=[],l=0;l<e;l++)a.push("<tr>"+n+"</tr>");s=a.join("");var h=$("<table>"+s+"</table>");return i&&i.tableClassName&&h.addClass(i.tableClassName),h[0]}},KEY_BOGUS="bogus",Editor=function(t){var e=this,i=t.layoutInfo.note,n=t.layoutInfo.editor,r=t.layoutInfo.editable,o=t.options,s=o.langInfo,a=r[0],l=null,h=new Style,c=new Table,u=new Typing,d=new Bullet,f=new History(r);this.initialize=function(){r.on("keydown",function(i){i.keyCode===key.code.ENTER&&t.triggerEvent("enter",i),t.triggerEvent("keydown",i),i.isDefaultPrevented()||(o.shortcuts?e.handleKeyMap(i):e.preventDefaultEditableShortCuts(i))}).on("keyup",function(e){t.triggerEvent("keyup",e)}).on("focus",function(e){t.triggerEvent("focus",e)}).on("blur",function(e){t.triggerEvent("blur",e)}).on("mousedown",function(e){t.triggerEvent("mousedown",e)}).on("mouseup",function(e){t.triggerEvent("mouseup",e)}).on("scroll",function(e){t.triggerEvent("scroll",e)}).on("paste",function(e){t.triggerEvent("paste",e)}),r.html(dom.html(i)||dom.emptyPara);var s=agent.isMSIE?"DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted":"input";r.on(s,func.debounce(function(){t.triggerEvent("change",r.html())},250)),n.on("focusin",function(e){t.triggerEvent("focusin",e)}).on("focusout",function(e){t.triggerEvent("focusout",e)}),o.airMode||(o.width&&n.outerWidth(o.width),o.height&&r.outerHeight(o.height),o.maxHeight&&r.css("max-height",o.maxHeight),o.minHeight&&r.css("min-height",o.minHeight)),f.recordUndo()},this.destroy=function(){r.off()},this.handleKeyMap=function(e){var i=o.keyMap[agent.isMac?"mac":"pc"],n=[];e.metaKey&&n.push("CMD"),e.ctrlKey&&!e.altKey&&n.push("CTRL"),e.shiftKey&&n.push("SHIFT");var r=key.nameFromCode[e.keyCode];r&&n.push(r);var s=i[n.join("+")];s?(e.preventDefault(),t.invoke(s)):key.isEdit(e.keyCode)&&this.afterCommand()},this.preventDefaultEditableShortCuts=function(t){(t.ctrlKey||t.metaKey)&&list.contains([66,73,85],t.keyCode)&&t.preventDefault()},this.createRange=function(){return this.focus(),range.create(a)},this.saveRange=function(t){l=this.createRange(),t&&l.collapse().select()},this.restoreRange=function(){l&&(l.select(),this.focus())},this.saveTarget=function(t){r.data("target",t)},this.clearTarget=function(){r.removeData("target")},this.restoreTarget=function(){return r.data("target")},this.currentStyle=function(){var t=range.create();return t&&(t=t.normalize()),t?h.current(t):h.fromNode(r)},this.styleFromNode=function(t){return h.fromNode(t)},this.undo=function(){t.triggerEvent("before.command",r.html()),f.undo(),t.triggerEvent("change",r.html())},t.memo("help.undo",s.help.undo),this.redo=function(){t.triggerEvent("before.command",r.html()),f.redo(),t.triggerEvent("change",r.html())},t.memo("help.redo",s.help.redo);for(var p=this.beforeCommand=function(){t.triggerEvent("before.command",r.html()),e.focus()},g=this.afterCommand=function(e){f.recordUndo(),e||t.triggerEvent("change",r.html())},m=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","fontName"],v=0,y=m.length;v<y;v++)this[m[v]]=function(t){return function(e){p(),document.execCommand(t,!1,e),g(!0)}}(m[v]),t.memo("help."+m[v],s.help[m[v]]);this.tab=function(){var t=this.createRange();t.isCollapsed()&&t.isOnCell()?c.tab(t):(p(),u.insertTab(t,o.tabSize),g())},t.memo("help.tab",s.help.tab),this.untab=function(){var t=this.createRange();t.isCollapsed()&&t.isOnCell()&&c.tab(t,!0)},t.memo("help.untab",s.help.untab),this.wrapCommand=function(t){return function(){p(),t.apply(e,arguments),g()}},this.insertParagraph=this.wrapCommand(function(){u.insertParagraph(a)}),t.memo("help.insertParagraph",s.help.insertParagraph),this.insertOrderedList=this.wrapCommand(function(){d.insertOrderedList(a)}),t.memo("help.insertOrderedList",s.help.insertOrderedList),this.insertUnorderedList=this.wrapCommand(function(){d.insertUnorderedList(a)}),t.memo("help.insertUnorderedList",s.help.insertUnorderedList),this.indent=this.wrapCommand(function(){d.indent(a)}),t.memo("help.indent",s.help.indent),this.outdent=this.wrapCommand(function(){d.outdent(a)}),t.memo("help.outdent",s.help.outdent),this.insertImage=function(e,i){return async.createImage(e,i).then(function(t){p(),"function"==typeof i?i(t):("string"==typeof i&&t.attr("data-filename",i),t.css("width",Math.min(r.width(),t.width()))),t.show(),range.create(a).insertNode(t[0]),range.createFromNodeAfter(t[0]).select(),g()}).fail(function(e){t.triggerEvent("image.upload.error",e)})},this.insertImages=function(i){$.each(i,function(i,n){var r=n.name;o.maximumImageFileSize&&o.maximumImageFileSize<n.size?t.triggerEvent("image.upload.error",s.image.maximumFileSizeError):async.readFileAsDataURL(n).then(function(t){return e.insertImage(t,r)}).fail(function(){t.triggerEvent("image.upload.error")})})},this.insertImagesOrCallback=function(e){o.callbacks.onImageUpload?t.triggerEvent("image.upload",e):this.insertImages(e)},this.insertNode=this.wrapCommand(function(t){this.createRange().insertNode(t),range.createFromNodeAfter(t).select()}),this.insertText=this.wrapCommand(function(t){var e=this.createRange(),i=e.insertNode(dom.createText(t));range.create(i,dom.nodeLength(i)).select()}),this.getSelectedText=function(){var t=this.createRange();return t.isOnAnchor()&&(t=range.createFromNode(dom.ancestor(t.sc,dom.isAnchor))),t.toString()},this.pasteHTML=this.wrapCommand(function(t){var e=this.createRange().pasteHTML(t);range.createFromNodeAfter(list.last(e)).select()}),this.formatBlock=this.wrapCommand(function(t){t=agent.isMSIE?"<"+t+">":t,document.execCommand("FormatBlock",!1,t)}),this.formatPara=function(){this.formatBlock("P")},t.memo("help.formatPara",s.help.formatPara);for(var v=1;v<=6;v++)this["formatH"+v]=function(t){return function(){this.formatBlock("H"+t)}}(v),t.memo("help.formatH"+v,s.help["formatH"+v]);this.fontSize=function(t){var e=this.createRange();if(e&&e.isCollapsed()){var i=h.styleNodes(e),n=list.head(i);$(i).css({"font-size":t+"px"}),n&&!dom.nodeLength(n)&&(n.innerHTML=dom.ZERO_WIDTH_NBSP_CHAR,range.createFromNodeAfter(n.firstChild).select(),r.data(KEY_BOGUS,n))}else p(),$(h.styleNodes(e)).css({"font-size":t+"px"}),g()},this.insertHorizontalRule=this.wrapCommand(function(){var t=this.createRange().insertNode(dom.create("HR"));t.nextSibling&&range.create(t.nextSibling,0).normalize().select()}),t.memo("help.insertHorizontalRule",s.help.insertHorizontalRule),this.removeBogus=function(){var t=r.data(KEY_BOGUS);if(t){var e=list.find(list.from(t.childNodes),dom.isText),i=e.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);-1!==i&&e.deleteData(i,1),dom.isEmpty(t)&&dom.remove(t),r.removeData(KEY_BOGUS)}},this.lineHeight=this.wrapCommand(function(t){h.stylePara(this.createRange(),{lineHeight:t})}),this.unlink=function(){var t=this.createRange();if(t.isOnAnchor()){var e=dom.ancestor(t.sc,dom.isAnchor);t=range.createFromNode(e),t.select(),p(),document.execCommand("unlink"),g()}},this.createLink=this.wrapCommand(function(t){var e=t.url,i=t.text,n=t.isNewWindow,r=t.range||this.createRange(),s=r.toString()!==i;"string"==typeof e&&(e=e.trim()),o.onCreateLink&&(e=o.onCreateLink(e));var a=[];if(s){r=r.deleteContents();var l=r.insertNode($("<A>"+i+"</A>")[0]);a.push(l)}else a=h.styleNodes(r,{nodeName:"A",expandClosestSibling:!0,onlyPartialContains:!0});$.each(a,function(t,i){e=/^[A-Za-z][A-Za-z0-9+-.]*\:[\/\/]?/.test(e)?e:"http://"+e,$(i).attr("href",e),n?$(i).attr("target","_blank"):$(i).removeAttr("target")});var c=range.createFromNodeBefore(list.head(a)),u=c.getStartPoint(),d=range.createFromNodeAfter(list.last(a)),f=d.getEndPoint();range.create(u.node,u.offset,f.node,f.offset).select()}),this.getLinkInfo=function(){var t=this.createRange().expand(dom.isAnchor),e=$(list.head(t.nodes(dom.isAnchor)));return{range:t,text:t.toString(),isNewWindow:!!e.length&&"_blank"===e.attr("target"),url:e.length?e.attr("href"):""}},this.color=this.wrapCommand(function(t){var e=t.foreColor,i=t.backColor;e&&document.execCommand("foreColor",!1,e),i&&document.execCommand("backColor",!1,i)}),this.insertTable=this.wrapCommand(function(t){var e=t.split("x");this.createRange().deleteContents().insertNode(c.createTable(e[0],e[1],o))}),this.floatMe=this.wrapCommand(function(t){$(this.restoreTarget()).css("float",t)}),this.resize=this.wrapCommand(function(t){$(this.restoreTarget()).css({width:100*t+"%",height:""})}),this.resizeTo=function(t,e,i){var n;if(i){var r=t.y/t.x,o=e.data("ratio");n={width:o>r?t.x:t.y/o,height:o>r?t.x*o:t.y}}else n={width:t.x,height:t.y};e.css(n)},this.removeMedia=this.wrapCommand(function(){var e=$(this.restoreTarget()).detach();t.triggerEvent("media.delete",e,r)}),this.hasFocus=function(){return r.is(":focus")},this.focus=function(){this.hasFocus()||r.focus()},this.isEmpty=function(){return dom.isEmpty(r[0])||dom.emptyPara===r.html()},this.empty=function(){t.invoke("code",dom.emptyPara)}},Clipboard=function(t){var e=this,i=t.layoutInfo.editable;this.events={"summernote.keydown":function(i,n){e.needKeydownHook()&&(n.ctrlKey||n.metaKey)&&n.keyCode===key.code.V&&(t.invoke("editor.saveRange"),e.$paste.focus(),setTimeout(function(){e.pasteByHook()},0))}},this.needKeydownHook=function(){return agent.isMSIE&&agent.browserVersion>10||agent.isFF},this.initialize=function(){this.needKeydownHook()?(this.$paste=$('<div tabindex="-1" />').attr("contenteditable",!0).css({position:"absolute",left:-1e5,opacity:0}),i.before(this.$paste),this.$paste.on("paste",function(e){t.triggerEvent("paste",e)})):i.on("paste",this.pasteByEvent)},this.destroy=function(){this.needKeydownHook()&&(this.$paste.remove(),this.$paste=null)},this.pasteByHook=function(){var e=this.$paste[0].firstChild;if(dom.isImg(e)){for(var i=e.src,n=atob(i.split(",")[1]),r=new Uint8Array(n.length),o=0;o<n.length;o++)r[o]=n.charCodeAt(o);var s=new Blob([r],{type:"image/png"});s.name="clipboard.png",t.invoke("editor.restoreRange"),t.invoke("editor.focus"),t.invoke("editor.insertImagesOrCallback",[s])}else{var a=$("<div />").html(this.$paste.html()).html();t.invoke("editor.restoreRange"),t.invoke("editor.focus"),a&&t.invoke("editor.pasteHTML",a)}this.$paste.empty()},this.pasteByEvent=function(e){var i=e.originalEvent.clipboardData;if(i&&i.items&&i.items.length){var n=list.head(i.items);"file"===n.kind&&-1!==n.type.indexOf("image/")&&t.invoke("editor.insertImagesOrCallback",[n.getAsFile()]),t.invoke("editor.afterCommand")}}},Dropzone=function(t){var e=$(document),i=t.layoutInfo.editor,n=t.layoutInfo.editable,r=t.options,o=r.langInfo,s={},a=$(['<div class="note-dropzone">','  <div class="note-dropzone-message"/>',"</div>"].join("")).prependTo(i),l=function(){Object.keys(s).forEach(function(t){e.off(t.substr(2).toLowerCase(),s[t])}),s={}};this.initialize=function(){r.disableDragAndDrop?(s.onDrop=function(t){t.preventDefault()},e.on("drop",s.onDrop)):this.attachDragAndDropEvent()},this.attachDragAndDropEvent=function(){var r=$(),l=a.find(".note-dropzone-message");s.onDragenter=function(e){var n=t.invoke("codeview.isActivated"),s=i.width()>0&&i.height()>0;n||r.length||!s||(i.addClass("dragover"),a.width(i.width()),a.height(i.height()),l.text(o.image.dragImageHere)),r=r.add(e.target)},s.onDragleave=function(t){r=r.not(t.target),r.length||i.removeClass("dragover")},s.onDrop=function(){r=$(),i.removeClass("dragover")},e.on("dragenter",s.onDragenter).on("dragleave",s.onDragleave).on("drop",s.onDrop),a.on("dragenter",function(){a.addClass("hover"),l.text(o.image.dropImage)}).on("dragleave",function(){a.removeClass("hover"),l.text(o.image.dragImageHere)}),a.on("drop",function(e){var i=e.originalEvent.dataTransfer;i&&i.files&&i.files.length?(e.preventDefault(),n.focus(),t.invoke("editor.insertImagesOrCallback",i.files)):$.each(i.types,function(e,n){var r=i.getData(n);n.toLowerCase().indexOf("text")>-1?t.invoke("editor.pasteHTML",r):$(r).each(function(){t.invoke("editor.insertNode",this)})})}).on("dragover",!1)},this.destroy=function(){l()}},CodeMirror;agent.hasCodeMirror&&(agent.isSupportAmd?require(["codemirror"],function(t){CodeMirror=t}):CodeMirror=window.CodeMirror);var Codeview=function(t){var e=t.layoutInfo.editor,i=t.layoutInfo.editable,n=t.layoutInfo.codable,r=t.options;this.sync=function(){this.isActivated()&&agent.hasCodeMirror&&n.data("cmEditor").save()},this.isActivated=function(){return e.hasClass("codeview")},this.toggle=function(){this.isActivated()?this.deactivate():this.activate(),t.triggerEvent("codeview.toggled")},this.activate=function(){if(n.val(dom.html(i,r.prettifyHtml)),n.height(i.height()),t.invoke("toolbar.updateCodeview",!0),e.addClass("codeview"),n.focus(),agent.hasCodeMirror){var o=CodeMirror.fromTextArea(n[0],r.codemirror);if(r.codemirror.tern){var s=new CodeMirror.TernServer(r.codemirror.tern);o.ternServer=s,o.on("cursorActivity",function(t){s.updateArgHints(t)})}o.setSize(null,i.outerHeight()),n.data("cmEditor",o)}},this.deactivate=function(){if(agent.hasCodeMirror){var o=n.data("cmEditor");n.val(o.getValue()),o.toTextArea()}var s=dom.value(n,r.prettifyHtml)||dom.emptyPara,a=i.html()!==s;i.html(s),i.height(r.height?n.height():"auto"),e.removeClass("codeview"),a&&t.triggerEvent("change",i.html(),i),i.focus(),t.invoke("toolbar.updateCodeview",!1)},this.destroy=function(){this.isActivated()&&this.deactivate()}},EDITABLE_PADDING=24,Statusbar=function(t){var e=$(document),i=t.layoutInfo.statusbar,n=t.layoutInfo.editable,r=t.options;this.initialize=function(){r.airMode||r.disableResizeEditor||i.on("mousedown",function(t){t.preventDefault(),t.stopPropagation();var i=n.offset().top-e.scrollTop();e.on("mousemove",function(t){var e=t.clientY-(i+EDITABLE_PADDING);e=r.minheight>0?Math.max(e,r.minheight):e,e=r.maxHeight>0?Math.min(e,r.maxHeight):e,n.height(e)}).one("mouseup",function(){e.off("mousemove")})})},this.destroy=function(){i.off(),i.remove()}},Fullscreen=function(t){var e=t.layoutInfo.editor,i=t.layoutInfo.toolbar,n=t.layoutInfo.editable,r=t.layoutInfo.codable,o=$(window),s=$("html, body");this.toggle=function(){var a=function(t){n.css("height",t.h),r.css("height",t.h),r.data("cmeditor")&&r.data("cmeditor").setsize(null,t.h)};e.toggleClass("fullscreen"),this.isFullscreen()?(n.data("orgHeight",n.css("height")),o.on("resize",function(){a({h:o.height()-i.outerHeight()})}).trigger("resize"),s.css("overflow","hidden")):(o.off("resize"),a({h:n.data("orgHeight")}),s.css("overflow","visible")),t.invoke("toolbar.updateFullscreen",this.isFullscreen())},this.isFullscreen=function(){return e.hasClass("fullscreen")}},Handle=function(t){var e=this,i=$(document),n=t.layoutInfo.editingArea,r=t.options;this.events={"summernote.mousedown":function(t,i){e.update(i.target)&&i.preventDefault()},"summernote.keyup summernote.scroll summernote.change summernote.dialog.shown":function(){e.update()}},this.initialize=function(){this.$handle=$(['<div class="note-handle">','<div class="note-control-selection">','<div class="note-control-selection-bg"></div>','<div class="note-control-holder note-control-nw"></div>','<div class="note-control-holder note-control-ne"></div>','<div class="note-control-holder note-control-sw"></div>','<div class="',r.disableResizeImage?"note-control-holder":"note-control-sizing",' note-control-se"></div>',r.disableResizeImage?"":'<div class="note-control-selection-info"></div>',"</div>","</div>"].join("")).prependTo(n),this.$handle.on("mousedown",function(n){if(dom.isControlSizing(n.target)){n.preventDefault(),n.stopPropagation();var r=e.$handle.find(".note-control-selection").data("target"),o=r.offset(),s=i.scrollTop();i.on("mousemove",function(i){t.invoke("editor.resizeTo",{x:i.clientX-o.left,y:i.clientY-(o.top-s)},r,!i.shiftKey),e.update(r[0])}).one("mouseup",function(e){e.preventDefault(),i.off("mousemove"),t.invoke("editor.afterCommand")}),r.data("ratio")||r.data("ratio",r.height()/r.width())}})},this.destroy=function(){this.$handle.remove()},this.update=function(e){var i=dom.isImg(e),n=this.$handle.find(".note-control-selection");if(t.invoke("imagePopover.update",e),i){var r=$(e),o=r.position(),s={w:r.outerWidth(!0),h:r.outerHeight(!0)};n.css({display:"block",left:o.left,top:o.top,width:s.w,height:s.h}).data("target",r);var a=s.w+"x"+s.h;n.find(".note-control-selection-info").text(a),t.invoke("editor.saveTarget",e)}else this.hide();return i},this.hide=function(){t.invoke("editor.clearTarget"),this.$handle.children().hide()}},AutoLink=function(t){var e=this,i=/^([A-Za-z][A-Za-z0-9+-.]*\:[\/\/]?|mailto:[A-Z0-9._%+-]+@)?(www\.)?(.+)$/i;this.events={"summernote.keyup":function(t,i){i.isDefaultPrevented()||e.handleKeyup(i)},"summernote.keydown":function(t,i){e.handleKeydown(i)}},this.initialize=function(){this.lastWordRange=null},this.destroy=function(){this.lastWordRange=null},this.replace=function(){if(this.lastWordRange){var e=this.lastWordRange.toString(),n=e.match(i);if(n&&(n[1]||n[2])){var r=n[1]?e:"http://"+e,o=$("<a />").html(e).attr("href",r)[0];this.lastWordRange.insertNode(o),this.lastWordRange=null,t.invoke("editor.focus")}}},this.handleKeydown=function(e){if(list.contains([key.code.ENTER,key.code.SPACE],e.keyCode)){var i=t.invoke("editor.createRange").getWordRange();this.lastWordRange=i}},this.handleKeyup=function(t){list.contains([key.code.ENTER,key.code.SPACE],t.keyCode)&&this.replace()}},AutoSync=function(t){var e=t.layoutInfo.note;this.events={"summernote.change":function(){e.val(t.invoke("code"))}},this.shouldInitialize=function(){return dom.isTextarea(e[0])}},Placeholder=function(t){var e=this,i=t.layoutInfo.editingArea,n=t.options;this.events={"summernote.init summernote.change":function(){e.update()},"summernote.codeview.toggled":function(){e.update()}},this.shouldInitialize=function(){return!!n.placeholder},this.initialize=function(){this.$placeholder=$('<div class="note-placeholder">'),this.$placeholder.on("click",function(){t.invoke("focus")}).text(n.placeholder).prependTo(i)},this.destroy=function(){this.$placeholder.remove()},this.update=function(){var e=!t.invoke("codeview.isActivated")&&t.invoke("editor.isEmpty");this.$placeholder.toggle(e)}},Buttons=function(t){var e=this,i=$.summernote.ui,n=t.layoutInfo.toolbar,r=t.options,o=r.langInfo,s=func.invertObject(r.keyMap[agent.isMac?"mac":"pc"]),a=this.representShortcut=function(t){var e=s[t];return r.shortcuts&&e?(agent.isMac&&(e=e.replace("CMD","\u2318").replace("SHIFT","\u21e7"))," ("+(e=e.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]"))+")"):""};this.initialize=function(){this.addToolbarButtons(),this.addImagePopoverButtons(),this.addLinkPopoverButtons(),this.fontInstalledMap={}},this.destroy=function(){delete this.fontInstalledMap},this.isFontInstalled=function(t){return e.fontInstalledMap.hasOwnProperty(t)||(e.fontInstalledMap[t]=agent.isFontInstalled(t)||list.contains(r.fontNamesIgnoreCheck,t)),e.fontInstalledMap[t]},this.addToolbarButtons=function(){t.memo("button.style",function(){return i.buttonGroup([i.button({className:"dropdown-toggle",contents:i.icon(r.icons.magic)+" "+i.icon(r.icons.caret,"span"),tooltip:o.style.style,data:{toggle:"dropdown"}}),i.dropdown({className:"dropdown-style",items:t.options.styleTags,template:function(t){"string"==typeof t&&(t={tag:t,title:o.style.hasOwnProperty(t)?o.style[t]:t});var e=t.tag,i=t.title;return"<"+e+(t.style?' style="'+t.style+'" ':"")+(t.className?' class="'+t.className+'"':"")+">"+i+"</"+e+">"},click:t.createInvokeHandler("editor.formatBlock")})]).render()}),t.memo("button.bold",function(){return i.button({className:"note-btn-bold",contents:i.icon(r.icons.bold),tooltip:o.font.bold+a("bold"),click:t.createInvokeHandler("editor.bold")}).render()}),t.memo("button.italic",function(){return i.button({className:"note-btn-italic",contents:i.icon(r.icons.italic),tooltip:o.font.italic+a("italic"),click:t.createInvokeHandler("editor.italic")}).render()}),t.memo("button.underline",function(){return i.button({className:"note-btn-underline",contents:i.icon(r.icons.underline),tooltip:o.font.underline+a("underline"),click:t.createInvokeHandler("editor.underline")}).render()}),t.memo("button.clear",function(){return i.button({contents:i.icon(r.icons.eraser),tooltip:o.font.clear+a("removeFormat"),click:t.createInvokeHandler("editor.removeFormat")}).render()}),t.memo("button.strikethrough",function(){return i.button({className:"note-btn-strikethrough",contents:i.icon(r.icons.strikethrough),tooltip:o.font.strikethrough+a("strikethrough"),click:t.createInvokeHandler("editor.strikethrough")}).render()}),t.memo("button.superscript",function(){return i.button({className:"note-btn-superscript",contents:i.icon(r.icons.superscript),tooltip:o.font.superscript,click:t.createInvokeHandler("editor.superscript")}).render()}),t.memo("button.subscript",function(){return i.button({className:"note-btn-subscript",contents:i.icon(r.icons.subscript),tooltip:o.font.subscript,click:t.createInvokeHandler("editor.subscript")}).render()}),t.memo("button.fontname",function(){return i.buttonGroup([i.button({className:"dropdown-toggle",contents:'<span class="note-current-fontname"/> '+i.icon(r.icons.caret,"span"),tooltip:o.font.name,data:{toggle:"dropdown"}}),i.dropdownCheck({className:"dropdown-fontname",checkClassName:r.icons.menuCheck,items:r.fontNames.filter(e.isFontInstalled),template:function(t){return'<span style="font-family:'+t+'">'+t+"</span>"},click:t.createInvokeHandler("editor.fontName")})]).render()}),t.memo("button.fontsize",function(){return i.buttonGroup([i.button({className:"dropdown-toggle",contents:'<span class="note-current-fontsize"/>'+i.icon(r.icons.caret,"span"),tooltip:o.font.size,data:{toggle:"dropdown"}}),i.dropdownCheck({className:"dropdown-fontsize",checkClassName:r.icons.menuCheck,items:r.fontSizes,click:t.createInvokeHandler("editor.fontSize")})]).render()}),t.memo("button.color",function(){return i.buttonGroup({className:"note-color",children:[i.button({className:"note-current-color-button",contents:i.icon(r.icons.font+" note-recent-color"),tooltip:o.color.recent,click:function(e){var i=$(e.currentTarget);t.invoke("editor.color",{backColor:i.attr("data-backColor"),foreColor:i.attr("data-foreColor")})},callback:function(t){t.find(".note-recent-color").css("background-color","#FFFF00"),t.attr("data-backColor","#FFFF00")}}),i.button({className:"dropdown-toggle",contents:i.icon(r.icons.caret,"span"),tooltip:o.color.more,data:{toggle:"dropdown"}}),i.dropdown({items:["<li>",'<div class="btn-group">','  <div class="note-palette-title">'+o.color.background+"</div>","  <div>",'    <button type="button" class="note-color-reset btn btn-default" data-event="backColor" data-value="inherit">',o.color.transparent,"    </button>","  </div>",'  <div class="note-holder" data-event="backColor"/>',"</div>",'<div class="btn-group">','  <div class="note-palette-title">'+o.color.foreground+"</div>","  <div>",'    <button type="button" class="note-color-reset btn btn-default" data-event="removeFormat" data-value="foreColor">',o.color.resetToDefault,"    </button>","  </div>",'  <div class="note-holder" data-event="foreColor"/>',"</div>","</li>"].join(""),callback:function(t){t.find(".note-holder").each(function(){var t=$(this);t.append(i.palette({colors:r.colors,eventName:t.data("event")}).render())})},click:function(e){var i=$(e.target),n=i.data("event"),r=i.data("value");if(n&&r){var o="backColor"===n?"background-color":"color",s=i.closest(".note-color").find(".note-recent-color"),a=i.closest(".note-color").find(".note-current-color-button");s.css(o,r),a.attr("data-"+n,r),t.invoke("editor."+n,r)}}})]}).render()}),t.memo("button.ul",function(){return i.button({contents:i.icon(r.icons.unorderedlist),tooltip:o.lists.unordered+a("insertUnorderedList"),click:t.createInvokeHandler("editor.insertUnorderedList")}).render()}),t.memo("button.ol",function(){return i.button({contents:i.icon(r.icons.orderedlist),tooltip:o.lists.ordered+a("insertOrderedList"),click:t.createInvokeHandler("editor.insertOrderedList")}).render()});var n=i.button({contents:i.icon(r.icons.alignLeft),tooltip:o.paragraph.left+a("justifyLeft"),click:t.createInvokeHandler("editor.justifyLeft")}),s=i.button({contents:i.icon(r.icons.alignCenter),tooltip:o.paragraph.center+a("justifyCenter"),click:t.createInvokeHandler("editor.justifyCenter")}),l=i.button({contents:i.icon(r.icons.alignRight),tooltip:o.paragraph.right+a("justifyRight"),click:t.createInvokeHandler("editor.justifyRight")}),h=i.button({contents:i.icon(r.icons.alignJustify),tooltip:o.paragraph.justify+a("justifyFull"),click:t.createInvokeHandler("editor.justifyFull")}),c=i.button({contents:i.icon(r.icons.outdent),tooltip:o.paragraph.outdent+a("outdent"),click:t.createInvokeHandler("editor.outdent")}),u=i.button({contents:i.icon(r.icons.indent),tooltip:o.paragraph.indent+a("indent"),click:t.createInvokeHandler("editor.indent")});t.memo("button.justifyLeft",func.invoke(n,"render")),t.memo("button.justifyCenter",func.invoke(s,"render")),t.memo("button.justifyRight",func.invoke(l,"render")),t.memo("button.justifyFull",func.invoke(h,"render")),t.memo("button.outdent",func.invoke(c,"render")),t.memo("button.indent",func.invoke(u,"render")),t.memo("button.paragraph",function(){return i.buttonGroup([i.button({className:"dropdown-toggle",contents:i.icon(r.icons.alignLeft)+" "+i.icon(r.icons.caret,"span"),tooltip:o.paragraph.paragraph,data:{toggle:"dropdown"}}),i.dropdown([i.buttonGroup({className:"note-align",children:[n,s,l,h]}),i.buttonGroup({className:"note-list",children:[c,u]})])]).render()}),t.memo("button.height",function(){return i.buttonGroup([i.button({className:"dropdown-toggle",contents:i.icon(r.icons.textHeight)+" "+i.icon(r.icons.caret,"span"),tooltip:o.font.height,data:{toggle:"dropdown"}}),i.dropdownCheck({items:r.lineHeights,checkClassName:r.icons.menuCheck,className:"dropdown-line-height",click:t.createInvokeHandler("editor.lineHeight")})]).render()}),t.memo("button.table",function(){return i.buttonGroup([i.button({className:"dropdown-toggle",contents:i.icon(r.icons.table)+" "+i.icon(r.icons.caret,"span"),tooltip:o.table.table,data:{toggle:"dropdown"}}),i.dropdown({className:"note-table",items:['<div class="note-dimension-picker">','  <div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"/>','  <div class="note-dimension-picker-highlighted"/>','  <div class="note-dimension-picker-unhighlighted"/>',"</div>",'<div class="note-dimension-display">1 x 1</div>'].join("")})],{callback:function(i){i.find(".note-dimension-picker-mousecatcher").css({width:r.insertTableMaxSize.col+"em",height:r.insertTableMaxSize.row+"em"}).mousedown(t.createInvokeHandler("editor.insertTable")).on("mousemove",e.tableMoveHandler)}}).render()}),t.memo("button.link",function(){return i.button({contents:i.icon(r.icons.link),tooltip:o.link.link+a("linkDialog.show"),click:t.createInvokeHandler("linkDialog.show")}).render()}),t.memo("button.picture",function(){return i.button({contents:i.icon(r.icons.picture),tooltip:o.image.image,click:t.createInvokeHandler("imageDialog.show")}).render()}),t.memo("button.video",function(){return i.button({contents:i.icon(r.icons.video),tooltip:o.video.video,click:t.createInvokeHandler("videoDialog.show")}).render()}),t.memo("button.hr",function(){return i.button({contents:i.icon(r.icons.minus),tooltip:o.hr.insert+a("insertHorizontalRule"),click:t.createInvokeHandler("editor.insertHorizontalRule")}).render()}),t.memo("button.fullscreen",function(){return i.button({className:"btn-fullscreen",contents:i.icon(r.icons.arrowsAlt),tooltip:o.options.fullscreen,click:t.createInvokeHandler("fullscreen.toggle")}).render()}),t.memo("button.codeview",function(){return i.button({className:"btn-codeview",contents:i.icon(r.icons.code),tooltip:o.options.codeview,click:t.createInvokeHandler("codeview.toggle")}).render()}),t.memo("button.redo",function(){return i.button({contents:i.icon(r.icons.redo),tooltip:o.history.redo+a("redo"),click:t.createInvokeHandler("editor.redo")}).render()}),t.memo("button.undo",function(){return i.button({contents:i.icon(r.icons.undo),tooltip:o.history.undo+a("undo"),click:t.createInvokeHandler("editor.undo")}).render()}),t.memo("button.help",function(){
return i.button({contents:i.icon(r.icons.question),tooltip:o.options.help,click:t.createInvokeHandler("helpDialog.show")}).render()})},this.addImagePopoverButtons=function(){t.memo("button.imageSize100",function(){return i.button({contents:'<span class="note-fontsize-10">100%</span>',tooltip:o.image.resizeFull,click:t.createInvokeHandler("editor.resize","1")}).render()}),t.memo("button.imageSize50",function(){return i.button({contents:'<span class="note-fontsize-10">50%</span>',tooltip:o.image.resizeHalf,click:t.createInvokeHandler("editor.resize","0.5")}).render()}),t.memo("button.imageSize25",function(){return i.button({contents:'<span class="note-fontsize-10">25%</span>',tooltip:o.image.resizeQuarter,click:t.createInvokeHandler("editor.resize","0.25")}).render()}),t.memo("button.floatLeft",function(){return i.button({contents:i.icon(r.icons.alignLeft),tooltip:o.image.floatLeft,click:t.createInvokeHandler("editor.floatMe","left")}).render()}),t.memo("button.floatRight",function(){return i.button({contents:i.icon(r.icons.alignRight),tooltip:o.image.floatRight,click:t.createInvokeHandler("editor.floatMe","right")}).render()}),t.memo("button.floatNone",function(){return i.button({contents:i.icon(r.icons.alignJustify),tooltip:o.image.floatNone,click:t.createInvokeHandler("editor.floatMe","none")}).render()}),t.memo("button.removeMedia",function(){return i.button({contents:i.icon(r.icons.trash),tooltip:o.image.remove,click:t.createInvokeHandler("editor.removeMedia")}).render()})},this.addLinkPopoverButtons=function(){t.memo("button.linkDialogShow",function(){return i.button({contents:i.icon(r.icons.link),tooltip:o.link.edit,click:t.createInvokeHandler("linkDialog.show")}).render()}),t.memo("button.unlink",function(){return i.button({contents:i.icon(r.icons.unlink),tooltip:o.link.unlink,click:t.createInvokeHandler("editor.unlink")}).render()})},this.build=function(e,n){for(var r=0,o=n.length;r<o;r++){for(var s=n[r],a=s[0],l=s[1],h=i.buttonGroup({className:"note-"+a}).render(),c=0,u=l.length;c<u;c++){var d=t.memo("button."+l[c]);d&&h.append("function"==typeof d?d(t):d)}h.appendTo(e)}},this.updateCurrentStyle=function(){var i=t.invoke("editor.currentStyle");if(this.updateBtnStates({".note-btn-bold":function(){return"bold"===i["font-bold"]},".note-btn-italic":function(){return"italic"===i["font-italic"]},".note-btn-underline":function(){return"underline"===i["font-underline"]},".note-btn-subscript":function(){return"subscript"===i["font-subscript"]},".note-btn-superscript":function(){return"superscript"===i["font-superscript"]},".note-btn-strikethrough":function(){return"strikethrough"===i["font-strikethrough"]}}),i["font-family"]){var r=i["font-family"].split(",").map(function(t){return t.replace(/[\'\"]/g,"").replace(/\s+$/,"").replace(/^\s+/,"")}),o=list.find(r,e.isFontInstalled);n.find(".dropdown-fontname li a").each(function(){var t=$(this).data("value")+""==o+"";this.className=t?"checked":""}),n.find(".note-current-fontname").text(o)}if(i["font-size"]){var s=i["font-size"];n.find(".dropdown-fontsize li a").each(function(){var t=$(this).data("value")+""==s+"";this.className=t?"checked":""}),n.find(".note-current-fontsize").text(s)}if(i["line-height"]){var a=i["line-height"];n.find(".dropdown-line-height li a").each(function(){var t=$(this).data("value")+""==a+"";this.className=t?"checked":""})}},this.updateBtnStates=function(t){$.each(t,function(t,e){i.toggleBtnActive(n.find(t),e())})},this.tableMoveHandler=function(t){var e,i=18,n=$(t.target.parentNode),o=n.next(),s=n.find(".note-dimension-picker-mousecatcher"),a=n.find(".note-dimension-picker-highlighted"),l=n.find(".note-dimension-picker-unhighlighted");if(t.offsetX===undefined){var h=$(t.target).offset();e={x:t.pageX-h.left,y:t.pageY-h.top}}else e={x:t.offsetX,y:t.offsetY};var c={c:Math.ceil(e.x/i)||1,r:Math.ceil(e.y/i)||1};a.css({width:c.c+"em",height:c.r+"em"}),s.data("value",c.c+"x"+c.r),3<c.c&&c.c<r.insertTableMaxSize.col&&l.css({width:c.c+1+"em"}),3<c.r&&c.r<r.insertTableMaxSize.row&&l.css({height:c.r+1+"em"}),o.html(c.c+" x "+c.r)}},Toolbar=function(t){var e=$.summernote.ui,i=t.layoutInfo.note,n=t.layoutInfo.toolbar,r=t.options;this.shouldInitialize=function(){return!r.airMode},this.initialize=function(){r.toolbar=r.toolbar||[],r.toolbar.length?t.invoke("buttons.build",n,r.toolbar):n.hide(),r.toolbarContainer&&n.appendTo(r.toolbarContainer),i.on("summernote.keyup summernote.mouseup summernote.change",function(){t.invoke("buttons.updateCurrentStyle")}),t.invoke("buttons.updateCurrentStyle")},this.destroy=function(){n.children().remove()},this.updateFullscreen=function(t){e.toggleBtnActive(n.find(".btn-fullscreen"),t)},this.updateCodeview=function(t){e.toggleBtnActive(n.find(".btn-codeview"),t),t?this.deactivate():this.activate()},this.activate=function(t){var i=n.find("button");t||(i=i.not(".btn-codeview")),e.toggleBtn(i,!0)},this.deactivate=function(t){var i=n.find("button");t||(i=i.not(".btn-codeview")),e.toggleBtn(i,!1)}},LinkDialog=function(t){var e=this,i=$.summernote.ui,n=t.layoutInfo.editor,r=t.options,o=r.langInfo;this.initialize=function(){var t=r.dialogsInBody?$(document.body):n,e='<div class="form-group"><label>'+o.link.textToDisplay+'</label><input class="note-link-text form-control" type="text" /></div><div class="form-group"><label>'+o.link.url+'</label><input class="note-link-url form-control" type="text" value="http://" /></div>'+(r.disableLinkTarget?"":'<div class="checkbox"><label><input type="checkbox" checked> '+o.link.openInNewWindow+"</label></div>"),s='<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+o.link.insert+"</button>";this.$dialog=i.dialog({className:"link-dialog",title:o.link.insert,fade:r.dialogsFade,body:e,footer:s}).render().appendTo(t)},this.destroy=function(){i.hideDialog(this.$dialog),this.$dialog.remove()},this.bindEnterKey=function(t,e){t.on("keypress",function(t){t.keyCode===key.code.ENTER&&e.trigger("click")})},this.toggleLinkBtn=function(t,e,n){i.toggleBtn(t,e.val()&&n.val())},this.showLinkDialog=function(n){return $.Deferred(function(r){var o=e.$dialog.find(".note-link-text"),s=e.$dialog.find(".note-link-url"),a=e.$dialog.find(".note-link-btn"),l=e.$dialog.find("input[type=checkbox]");i.onDialogShown(e.$dialog,function(){t.triggerEvent("dialog.shown"),n.url||(n.url=n.text),o.val(n.text);var i=function(){e.toggleLinkBtn(a,o,s),n.text=o.val()};o.on("input",i).on("paste",function(){setTimeout(i,0)});var h=function(){e.toggleLinkBtn(a,o,s),n.text||o.val(s.val())};s.on("input",h).on("paste",function(){setTimeout(h,0)}).val(n.url).trigger("focus"),e.toggleLinkBtn(a,o,s),e.bindEnterKey(s,a),e.bindEnterKey(o,a),l.prop("checked",n.isNewWindow),a.one("click",function(t){t.preventDefault(),r.resolve({range:n.range,url:s.val(),text:o.val(),isNewWindow:l.is(":checked")}),e.$dialog.modal("hide")})}),i.onDialogHidden(e.$dialog,function(){o.off("input paste keypress"),s.off("input paste keypress"),a.off("click"),"pending"===r.state()&&r.reject()}),i.showDialog(e.$dialog)}).promise()},this.show=function(){var e=t.invoke("editor.getLinkInfo");t.invoke("editor.saveRange"),this.showLinkDialog(e).then(function(e){t.invoke("editor.restoreRange"),t.invoke("editor.createLink",e)}).fail(function(){t.invoke("editor.restoreRange")})},t.memo("help.linkDialog.show",r.langInfo.help["linkDialog.show"])},LinkPopover=function(t){var e=this,i=$.summernote.ui,n=t.options;this.events={"summernote.keyup summernote.mouseup summernote.change summernote.scroll":function(){e.update()},"summernote.dialog.shown":function(){e.hide()}},this.shouldInitialize=function(){return!list.isEmpty(n.popover.link)},this.initialize=function(){this.$popover=i.popover({className:"note-link-popover",callback:function(t){t.find(".popover-content").prepend('<span><a target="_blank"></a>&nbsp;</span>')}}).render().appendTo("body");var e=this.$popover.find(".popover-content");t.invoke("buttons.build",e,n.popover.link)},this.destroy=function(){this.$popover.remove()},this.update=function(){if(!t.invoke("editor.hasFocus"))return void this.hide();var e=t.invoke("editor.createRange");if(e.isCollapsed()&&e.isOnAnchor()){var i=dom.ancestor(e.sc,dom.isAnchor),n=$(i).attr("href");this.$popover.find("a").attr("href",n).html(n);var r=dom.posFromPlaceholder(i);this.$popover.css({display:"block",left:r.left,top:r.top})}else this.hide()},this.hide=function(){this.$popover.hide()}},ImageDialog=function(t){var e=this,i=$.summernote.ui,n=t.layoutInfo.editor,r=t.options,o=r.langInfo;this.initialize=function(){var t=r.dialogsInBody?$(document.body):n,e="";if(r.maximumImageFileSize){var s=Math.floor(Math.log(r.maximumImageFileSize)/Math.log(1024)),a=1*(r.maximumImageFileSize/Math.pow(1024,s)).toFixed(2)+" "+" KMGTP"[s]+"B";e="<small>"+o.image.maximumFileSize+" : "+a+"</small>"}var l='<div class="form-group note-group-select-from-files"><label>'+o.image.selectFromFiles+'</label><input class="note-image-input form-control" type="file" name="files" accept="image/*" multiple="multiple" />'+e+'</div><div class="form-group note-group-image-url" style="overflow:auto;"><label>'+o.image.url+'</label><input class="note-image-url form-control col-md-12" type="text" /></div>',h='<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+o.image.insert+"</button>";this.$dialog=i.dialog({title:o.image.insert,fade:r.dialogsFade,body:l,footer:h}).render().appendTo(t)},this.destroy=function(){i.hideDialog(this.$dialog),this.$dialog.remove()},this.bindEnterKey=function(t,e){t.on("keypress",function(t){t.keyCode===key.code.ENTER&&e.trigger("click")})},this.show=function(){t.invoke("editor.saveRange"),this.showImageDialog().then(function(n){i.hideDialog(e.$dialog),t.invoke("editor.restoreRange"),"string"==typeof n?t.invoke("editor.insertImage",n):t.invoke("editor.insertImagesOrCallback",n)}).fail(function(){t.invoke("editor.restoreRange")})},this.showImageDialog=function(){return $.Deferred(function(n){var r=e.$dialog.find(".note-image-input"),o=e.$dialog.find(".note-image-url"),s=e.$dialog.find(".note-image-btn");i.onDialogShown(e.$dialog,function(){t.triggerEvent("dialog.shown"),r.replaceWith(r.clone().on("change",function(){n.resolve(this.files||this.value)}).val("")),s.click(function(t){t.preventDefault(),n.resolve(o.val())}),o.on("keyup paste",function(){var t=o.val();i.toggleBtn(s,t)}).val("").trigger("focus"),e.bindEnterKey(o,s)}),i.onDialogHidden(e.$dialog,function(){r.off("change"),o.off("keyup paste keypress"),s.off("click"),"pending"===n.state()&&n.reject()}),i.showDialog(e.$dialog)})}},ImagePopover=function(t){var e=$.summernote.ui,i=t.options;this.shouldInitialize=function(){return!list.isEmpty(i.popover.image)},this.initialize=function(){this.$popover=e.popover({className:"note-image-popover"}).render().appendTo("body");var n=this.$popover.find(".popover-content");t.invoke("buttons.build",n,i.popover.image)},this.destroy=function(){this.$popover.remove()},this.update=function(t){if(dom.isImg(t)){var e=dom.posFromPlaceholder(t);this.$popover.css({display:"block",left:e.left,top:e.top})}else this.hide()},this.hide=function(){this.$popover.hide()}},VideoDialog=function(t){var e=this,i=$.summernote.ui,n=t.layoutInfo.editor,r=t.options,o=r.langInfo;this.initialize=function(){var t=r.dialogsInBody?$(document.body):n,e='<div class="form-group row-fluid"><label>'+o.video.url+' <small class="text-muted">'+o.video.providers+'</small></label><input class="note-video-url form-control span12" type="text" /></div>',s='<button href="#" class="btn btn-primary note-video-btn disabled" disabled>'+o.video.insert+"</button>";this.$dialog=i.dialog({title:o.video.insert,fade:r.dialogsFade,body:e,footer:s}).render().appendTo(t)},this.destroy=function(){i.hideDialog(this.$dialog),this.$dialog.remove()},this.bindEnterKey=function(t,e){t.on("keypress",function(t){t.keyCode===key.code.ENTER&&e.trigger("click")})},this.createVideoNode=function(t){var e,i=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/,n=t.match(i),r=/(?:www\.|\/\/)instagram\.com\/p\/(.[a-zA-Z0-9_-]*)/,o=t.match(r),s=/\/\/vine\.co\/v\/([a-zA-Z0-9]+)/,a=t.match(s),l=/\/\/(player\.)?vimeo\.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/,h=t.match(l),c=/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/,u=t.match(c),d=/\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/,f=t.match(d),p=/^.+.(mp4|m4v)$/,g=t.match(p),m=/^.+.(ogg|ogv)$/,v=t.match(m),y=/^.+.(webm)$/,b=t.match(y);if(n&&11===n[1].length){var _=n[1];e=$("<iframe>").attr("frameborder",0).attr("src","//www.youtube.com/embed/"+_).attr("width","640").attr("height","360")}else if(o&&o[0].length)e=$("<iframe>").attr("frameborder",0).attr("src","https://instagram.com/p/"+o[1]+"/embed/").attr("width","612").attr("height","710").attr("scrolling","no").attr("allowtransparency","true");else if(a&&a[0].length)e=$("<iframe>").attr("frameborder",0).attr("src",a[0]+"/embed/simple").attr("width","600").attr("height","600").attr("class","vine-embed");else if(h&&h[3].length)e=$("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("frameborder",0).attr("src","//player.vimeo.com/video/"+h[3]).attr("width","640").attr("height","360");else if(u&&u[2].length)e=$("<iframe>").attr("frameborder",0).attr("src","//www.dailymotion.com/embed/video/"+u[2]).attr("width","640").attr("height","360");else if(f&&f[1].length)e=$("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("frameborder",0).attr("height","498").attr("width","510").attr("src","//player.youku.com/embed/"+f[1]);else{if(!(g||v||b))return!1;e=$("<video controls>").attr("src",t).attr("width","640").attr("height","360")}return e.addClass("note-video-clip"),e[0]},this.show=function(){var n=t.invoke("editor.getSelectedText");t.invoke("editor.saveRange"),this.showVideoDialog(n).then(function(n){i.hideDialog(e.$dialog),t.invoke("editor.restoreRange");var r=e.createVideoNode(n);r&&t.invoke("editor.insertNode",r)}).fail(function(){t.invoke("editor.restoreRange")})},this.showVideoDialog=function(n){return $.Deferred(function(r){var o=e.$dialog.find(".note-video-url"),s=e.$dialog.find(".note-video-btn");i.onDialogShown(e.$dialog,function(){t.triggerEvent("dialog.shown"),o.val(n).on("input",function(){i.toggleBtn(s,o.val())}).trigger("focus"),s.click(function(t){t.preventDefault(),r.resolve(o.val())}),e.bindEnterKey(o,s)}),i.onDialogHidden(e.$dialog,function(){o.off("input"),s.off("click"),"pending"===r.state()&&r.reject()}),i.showDialog(e.$dialog)})}},HelpDialog=function(t){var e=this,i=$.summernote.ui,n=t.layoutInfo.editor,r=t.options,o=r.langInfo;this.createShortCutList=function(){var e=r.keyMap[agent.isMac?"mac":"pc"];return Object.keys(e).map(function(i){var n=e[i],r=$('<div><div class="help-list-item"/></div>');return r.append($("<label><kbd>"+i+"</kdb></label>").css({width:180,"margin-right":10})).append($("<span/>").html(t.memo("help."+n)||n)),r.html()}).join("")},this.initialize=function(){var t=r.dialogsInBody?$(document.body):n,e=['<p class="text-center">','<a href="http://summernote.org/" target="_blank">Summernote 0.8.2</a> \xb7 ','<a href="https://github.com/summernote/summernote" target="_blank">Project</a> \xb7 ','<a href="https://github.com/summernote/summernote/issues" target="_blank">Issues</a>',"</p>"].join("");this.$dialog=i.dialog({title:o.options.help,fade:r.dialogsFade,body:this.createShortCutList(),footer:e,callback:function(t){t.find(".modal-body").css({"max-height":300,overflow:"scroll"})}}).render().appendTo(t)},this.destroy=function(){i.hideDialog(this.$dialog),this.$dialog.remove()},this.showHelpDialog=function(){return $.Deferred(function(n){i.onDialogShown(e.$dialog,function(){t.triggerEvent("dialog.shown"),n.resolve()}),i.showDialog(e.$dialog)}).promise()},this.show=function(){t.invoke("editor.saveRange"),this.showHelpDialog().then(function(){t.invoke("editor.restoreRange")})}},AirPopover=function(t){var e=this,i=$.summernote.ui,n=t.options;this.events={"summernote.keyup summernote.mouseup summernote.scroll":function(){e.update()},"summernote.change summernote.dialog.shown":function(){e.hide()},"summernote.focusout":function(t,i){agent.isFF||i.relatedTarget&&dom.ancestor(i.relatedTarget,func.eq(e.$popover[0]))||e.hide()}},this.shouldInitialize=function(){return n.airMode&&!list.isEmpty(n.popover.air)},this.initialize=function(){this.$popover=i.popover({className:"note-air-popover"}).render().appendTo("body");var e=this.$popover.find(".popover-content");t.invoke("buttons.build",e,n.popover.air)},this.destroy=function(){this.$popover.remove()},this.update=function(){var e=t.invoke("editor.currentStyle");if(e.range&&!e.range.isCollapsed()){var i=list.last(e.range.getClientRects());if(i){var n=func.rect2bnd(i);this.$popover.css({display:"block",left:Math.max(n.left+n.width/2,0)-20,top:n.top+n.height})}}else this.hide()},this.hide=function(){this.$popover.hide()}},HintPopover=function(t){var e=this,i=$.summernote.ui,n=5,r=t.options.hint||[],o=t.options.hintDirection||"bottom",s=$.isArray(r)?r:[r];this.events={"summernote.keyup":function(t,i){i.isDefaultPrevented()||e.handleKeyup(i)},"summernote.keydown":function(t,i){e.handleKeydown(i)},"summernote.dialog.shown":function(){e.hide()}},this.shouldInitialize=function(){return s.length>0},this.initialize=function(){this.lastWordRange=null,this.$popover=i.popover({className:"note-hint-popover",hideArrow:!0,direction:""}).render().appendTo("body"),this.$popover.hide(),this.$content=this.$popover.find(".popover-content"),this.$content.on("click",".note-hint-item",function(){e.$content.find(".active").removeClass("active"),$(this).addClass("active"),e.replace()})},this.destroy=function(){this.$popover.remove()},this.selectItem=function(t){this.$content.find(".active").removeClass("active"),t.addClass("active"),this.$content[0].scrollTop=t[0].offsetTop-this.$content.innerHeight()/2},this.moveDown=function(){var t=this.$content.find(".note-hint-item.active"),e=t.next();if(e.length)this.selectItem(e);else{var i=t.parent().next();i.length||(i=this.$content.find(".note-hint-group").first()),this.selectItem(i.find(".note-hint-item").first())}},this.moveUp=function(){var t=this.$content.find(".note-hint-item.active"),e=t.prev();if(e.length)this.selectItem(e);else{var i=t.parent().prev();i.length||(i=this.$content.find(".note-hint-group").last()),this.selectItem(i.find(".note-hint-item").last())}},this.replace=function(){var e=this.$content.find(".note-hint-item.active");if(e.length){var i=this.nodeFromItem(e);this.lastWordRange.insertNode(i),range.createFromNode(i).collapse().select(),this.lastWordRange=null,this.hide(),t.invoke("editor.focus")}},this.nodeFromItem=function(t){var e=s[t.data("index")],i=t.data("item"),n=e.content?e.content(i):i;return"string"==typeof n&&(n=dom.createText(n)),n},this.createItemTemplates=function(t,e){var i=s[t];return e.map(function(e,n){var r=$('<div class="note-hint-item"/>');return r.append(i.template?i.template(e):e+""),r.data({index:t,item:e}),0===t&&0===n&&r.addClass("active"),r})},this.handleKeydown=function(t){this.$popover.is(":visible")&&(t.keyCode===key.code.ENTER?(t.preventDefault(),this.replace()):t.keyCode===key.code.UP?(t.preventDefault(),this.moveUp()):t.keyCode===key.code.DOWN&&(t.preventDefault(),this.moveDown()))},this.searchKeyword=function(t,e,i){var n=s[t];if(n&&n.match.test(e)&&n.search){var r=n.match.exec(e);n.search(r[1],i)}else i()},this.createGroup=function(t,i){var n=$('<div class="note-hint-group note-hint-group-'+t+'"/>');return this.searchKeyword(t,i,function(i){i=i||[],i.length&&(n.html(e.createItemTemplates(t,i)),e.show())}),n},this.handleKeyup=function(i){if(list.contains([key.code.ENTER,key.code.UP,key.code.DOWN],i.keyCode)){if(i.keyCode===key.code.ENTER&&this.$popover.is(":visible"))return}else{var r=t.invoke("editor.createRange").getWordRange(),a=r.toString();if(s.length&&a){this.$content.empty();var l=func.rect2bnd(list.last(r.getClientRects()));l&&(this.$popover.hide(),this.lastWordRange=r,s.forEach(function(t,i){t.match.test(a)&&e.createGroup(i,a).appendTo(e.$content)}),"top"===o?this.$popover.css({left:l.left,top:l.top-this.$popover.outerHeight()-n}):this.$popover.css({left:l.left,top:l.top+l.height+n}))}else this.hide()}},this.show=function(){this.$popover.show()},this.hide=function(){this.$popover.hide()}};$.summernote=$.extend($.summernote,{version:"0.8.2",ui:ui,dom:dom,plugins:{},options:{modules:{editor:Editor,clipboard:Clipboard,dropzone:Dropzone,codeview:Codeview,statusbar:Statusbar,fullscreen:Fullscreen,handle:Handle,hintPopover:HintPopover,autoLink:AutoLink,autoSync:AutoSync,placeholder:Placeholder,buttons:Buttons,toolbar:Toolbar,linkDialog:LinkDialog,linkPopover:LinkPopover,imageDialog:ImageDialog,imagePopover:ImagePopover,videoDialog:VideoDialog,helpDialog:HelpDialog,airPopover:AirPopover},buttons:{},lang:"en-US",toolbar:[["style",["style"]],["font",["bold","underline","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","picture","video"]],["view",["fullscreen","codeview","help"]]],popover:{image:[["imagesize",["imageSize100","imageSize50","imageSize25"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]]],link:[["link",["linkDialogShow","unlink"]]],air:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]]},airMode:!1,width:null,height:null,focus:!1,tabSize:4,styleWithSpan:!0,shortcuts:!0,textareaAutoSync:!0,direction:null,styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Helvetica","Impact","Lucida Grande","Tahoma","Times New Roman","Verdana"],fontSizes:["8","9","10","11","12","14","18","24","36"],colors:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],tableClassName:"table table-bordered",insertTableMaxSize:{col:10,row:10},dialogsInBody:!1,dialogsFade:!1,maximumImageFileSize:null,callbacks:{onInit:null,onFocus:null,onBlur:null,onEnter:null,onKeyup:null,onKeydown:null,onImageUpload:null,onImageUploadError:null},codemirror:{mode:"text/html",htmlMode:!0,lineNumbers:!0},keyMap:{pc:{ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"linkDialog.show"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"linkDialog.show"}},icons:{align:"note-icon-align",alignCenter:"note-icon-align-center",alignJustify:"note-icon-align-justify",alignLeft:"note-icon-align-left",alignRight:"note-icon-align-right",indent:"note-icon-align-indent",outdent:"note-icon-align-outdent",arrowsAlt:"note-icon-arrows-alt",bold:"note-icon-bold",caret:"note-icon-caret",circle:"note-icon-circle",close:"note-icon-close",code:"note-icon-code",eraser:"note-icon-eraser",font:"note-icon-font",frame:"note-icon-frame",italic:"note-icon-italic",link:"note-icon-link",unlink:"note-icon-chain-broken",magic:"note-icon-magic",menuCheck:"note-icon-check",minus:"note-icon-minus",orderedlist:"note-icon-orderedlist",pencil:"note-icon-pencil",picture:"note-icon-picture",question:"note-icon-question",redo:"note-icon-redo",square:"note-icon-square",strikethrough:"note-icon-strikethrough",subscript:"note-icon-subscript",superscript:"note-icon-superscript",table:"note-icon-table",textHeight:"note-icon-text-height",trash:"note-icon-trash",underline:"note-icon-underline",undo:"note-icon-undo",unorderedlist:"note-icon-unorderedlist",video:"note-icon-video"}}})}),function(){function t(t){function e(e,i,n,r,o,s){for(;o>=0&&o<s;o+=t){var a=r?r[o]:o;n=i(n,e[a],a,e)}return n}return function(i,n,r,o){n=b(n,o,4);var s=!k(i)&&y.keys(i),a=(s||i).length,l=t>0?0:a-1;return arguments.length<3&&(r=i[s?s[l]:l],l+=t),e(i,n,r,s,l,a)}}function e(t){return function(e,i,n){i=_(i,n);for(var r=T(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(i(e[o],o,e))return o;return-1}}function i(t,e,i){return function(n,r,o){var s=0,a=T(n);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(i&&o&&a)return o=i(n,r),n[o]===r?o:-1;if(r!==r)return o=e(c.call(n,s,a),y.isNaN),o>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(n[o]===r)return o;return-1}}function n(t,e){var i=N.length,n=t.constructor,r=y.isFunction(n)&&n.prototype||a,o="constructor";for(y.has(t,o)&&!y.contains(e,o)&&e.push(o);i--;)(o=N[i])in t&&t[o]!==r[o]&&!y.contains(e,o)&&e.push(o)}var r=this,o=r._,s=Array.prototype,a=Object.prototype,l=Function.prototype,h=s.push,c=s.slice,u=a.toString,d=a.hasOwnProperty,f=Array.isArray,p=Object.keys,g=l.bind,m=Object.create,v=function(){},y=function(t){return t instanceof y?t:this instanceof y?void(this._wrapped=t):new y(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):r._=y,y.VERSION="1.8.3";var b=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,o){return t.call(e,i,n,r,o)}}return function(){return t.apply(e,arguments)}},_=function(t,e,i){return null==t?y.identity:y.isFunction(t)?b(t,e,i):y.isObject(t)?y.matcher(t):y.property(t)};y.iteratee=function(t,e){return _(t,e,Infinity)};var w=function(t,e){return function(i){var n=arguments.length;if(n<2||null==i)return i;for(var r=1;r<n;r++)for(var o=arguments[r],s=t(o),a=s.length,l=0;l<a;l++){var h=s[l];e&&void 0!==i[h]||(i[h]=o[h])}return i}},x=function(t){if(!y.isObject(t))return{};if(m)return m(t);v.prototype=t;var e=new v;return v.prototype=null,e},C=function(t){return function(e){return null==e?void 0:e[t]}},S=Math.pow(2,53)-1,T=C("length"),k=function(t){var e=T(t);return"number"==typeof e&&e>=0&&e<=S};y.each=y.forEach=function(t,e,i){e=b(e,i);var n,r;if(k(t))for(n=0,r=t.length;n<r;n++)e(t[n],n,t);else{var o=y.keys(t);for(n=0,r=o.length;n<r;n++)e(t[o[n]],o[n],t)}return t},y.map=y.collect=function(t,e,i){e=_(e,i);for(var n=!k(t)&&y.keys(t),r=(n||t).length,o=Array(r),s=0;s<r;s++){var a=n?n[s]:s;o[s]=e(t[a],a,t)}return o},y.reduce=y.foldl=y.inject=t(1),y.reduceRight=y.foldr=t(-1),y.find=y.detect=function(t,e,i){var n;if(void 0!==(n=k(t)?y.findIndex(t,e,i):y.findKey(t,e,i))&&-1!==n)return t[n]},y.filter=y.select=function(t,e,i){var n=[];return e=_(e,i),y.each(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n},y.reject=function(t,e,i){return y.filter(t,y.negate(_(e)),i)},y.every=y.all=function(t,e,i){e=_(e,i);for(var n=!k(t)&&y.keys(t),r=(n||t).length,o=0;o<r;o++){var s=n?n[o]:o;if(!e(t[s],s,t))return!1}return!0},y.some=y.any=function(t,e,i){e=_(e,i);for(var n=!k(t)&&y.keys(t),r=(n||t).length,o=0;o<r;o++){var s=n?n[o]:o;if(e(t[s],s,t))return!0}return!1},y.contains=y.includes=y.include=function(t,e,i,n){return k(t)||(t=y.values(t)),("number"!=typeof i||n)&&(i=0),y.indexOf(t,e,i)>=0},y.invoke=function(t,e){var i=c.call(arguments,2),n=y.isFunction(e);return y.map(t,function(t){var r=n?e:t[e];return null==r?r:r.apply(t,i)})},y.pluck=function(t,e){return y.map(t,y.property(e))},y.where=function(t,e){return y.filter(t,y.matcher(e))},y.findWhere=function(t,e){return y.find(t,y.matcher(e))},y.max=function(t,e,i){var n,r,o=-Infinity,s=-Infinity;if(null==e&&null!=t){t=k(t)?t:y.values(t);for(var a=0,l=t.length;a<l;a++)(n=t[a])>o&&(o=n)}else e=_(e,i),y.each(t,function(t,i,n){((r=e(t,i,n))>s||r===-Infinity&&o===-Infinity)&&(o=t,s=r)});return o},y.min=function(t,e,i){var n,r,o=Infinity,s=Infinity;if(null==e&&null!=t){t=k(t)?t:y.values(t);for(var a=0,l=t.length;a<l;a++)(n=t[a])<o&&(o=n)}else e=_(e,i),y.each(t,function(t,i,n){((r=e(t,i,n))<s||r===Infinity&&o===Infinity)&&(o=t,s=r)});return o},y.shuffle=function(t){for(var e,i=k(t)?t:y.values(t),n=i.length,r=Array(n),o=0;o<n;o++)e=y.random(0,o),e!==o&&(r[o]=r[e]),r[e]=i[o];return r},y.sample=function(t,e,i){return null==e||i?(k(t)||(t=y.values(t)),t[y.random(t.length-1)]):y.shuffle(t).slice(0,Math.max(0,e))},y.sortBy=function(t,e,i){return e=_(e,i),y.pluck(y.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var E=function(t){return function(e,i,n){var r={};return i=_(i,n),y.each(e,function(n,o){var s=i(n,o,e);t(r,n,s)}),r}};y.groupBy=E(function(t,e,i){y.has(t,i)?t[i].push(e):t[i]=[e]}),y.indexBy=E(function(t,e,i){t[i]=e}),y.countBy=E(function(t,e,i){y.has(t,i)?t[i]++:t[i]=1}),y.toArray=function(t){return t?y.isArray(t)?c.call(t):k(t)?y.map(t,y.identity):y.values(t):[]},y.size=function(t){return null==t?0:k(t)?t.length:y.keys(t).length},y.partition=function(t,e,i){e=_(e,i);var n=[],r=[];return y.each(t,function(t,i,o){(e(t,i,o)?n:r).push(t)}),[n,r]},y.first=y.head=y.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:y.initial(t,t.length-e)},y.initial=function(t,e,i){return c.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},y.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:y.rest(t,Math.max(0,t.length-e))},y.rest=y.tail=y.drop=function(t,e,i){return c.call(t,null==e||i?1:e)},y.compact=function(t){return y.filter(t,y.identity)};var P=function(t,e,i,n){for(var r=[],o=0,s=n||0,a=T(t);s<a;s++){var l=t[s];if(k(l)&&(y.isArray(l)||y.isArguments(l))){e||(l=P(l,e,i));var h=0,c=l.length;for(r.length+=c;h<c;)r[o++]=l[h++]}else i||(r[o++]=l)}return r};y.flatten=function(t,e){return P(t,e,!1)},y.without=function(t){return y.difference(t,c.call(arguments,1))},y.uniq=y.unique=function(t,e,i,n){y.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=_(i,n));for(var r=[],o=[],s=0,a=T(t);s<a;s++){var l=t[s],h=i?i(l,s,t):l;e?(s&&o===h||r.push(l),o=h):i?y.contains(o,h)||(o.push(h),r.push(l)):y.contains(r,l)||r.push(l)}return r},y.union=function(){return y.uniq(P(arguments,!0,!0))},y.intersection=function(t){for(var e=[],i=arguments.length,n=0,r=T(t);n<r;n++){var o=t[n];if(!y.contains(e,o)){for(var s=1;s<i&&y.contains(arguments[s],o);s++);s===i&&e.push(o)}}return e},y.difference=function(t){var e=P(arguments,!0,!0,1);return y.filter(t,function(t){return!y.contains(e,t)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(t){for(var e=t&&y.max(t,T).length||0,i=Array(e),n=0;n<e;n++)i[n]=y.pluck(t,n);return i},y.object=function(t,e){for(var i={},n=0,r=T(t);n<r;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},y.findIndex=e(1),y.findLastIndex=e(-1),y.sortedIndex=function(t,e,i,n){i=_(i,n,1);for(var r=i(e),o=0,s=T(t);o<s;){var a=Math.floor((o+s)/2);i(t[a])<r?o=a+1:s=a}return o},y.indexOf=i(1,y.findIndex,y.sortedIndex),y.lastIndexOf=i(-1,y.findLastIndex),y.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),o=0;o<n;o++,t+=i)r[o]=t;return r};var D=function(t,e,i,n,r){if(!(n instanceof e))return t.apply(i,r);var o=x(t.prototype),s=t.apply(o,r);return y.isObject(s)?s:o};y.bind=function(t,e){if(g&&t.bind===g)return g.apply(t,c.call(arguments,1))
;if(!y.isFunction(t))throw new TypeError("Bind must be called on a function");var i=c.call(arguments,2),n=function(){return D(t,n,e,this,i.concat(c.call(arguments)))};return n},y.partial=function(t){var e=c.call(arguments,1),i=function(){for(var n=0,r=e.length,o=Array(r),s=0;s<r;s++)o[s]=e[s]===y?arguments[n++]:e[s];for(;n<arguments.length;)o.push(arguments[n++]);return D(t,i,this,this,o)};return i},y.bindAll=function(t){var e,i,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(e=1;e<n;e++)i=arguments[e],t[i]=y.bind(t[i],t);return t},y.memoize=function(t,e){var i=function(n){var r=i.cache,o=""+(e?e.apply(this,arguments):n);return y.has(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return i.cache={},i},y.delay=function(t,e){var i=c.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},y.defer=y.partial(y.delay,y,1),y.throttle=function(t,e,i){var n,r,o,s=null,a=0;i||(i={});var l=function(){a=!1===i.leading?0:y.now(),s=null,o=t.apply(n,r),s||(n=r=null)};return function(){var h=y.now();a||!1!==i.leading||(a=h);var c=e-(h-a);return n=this,r=arguments,c<=0||c>e?(s&&(clearTimeout(s),s=null),a=h,o=t.apply(n,r),s||(n=r=null)):s||!1===i.trailing||(s=setTimeout(l,c)),o}},y.debounce=function(t,e,i){var n,r,o,s,a,l=function(){var h=y.now()-s;h<e&&h>=0?n=setTimeout(l,e-h):(n=null,i||(a=t.apply(o,r),n||(o=r=null)))};return function(){o=this,r=arguments,s=y.now();var h=i&&!n;return n||(n=setTimeout(l,e)),h&&(a=t.apply(o,r),o=r=null),a}},y.wrap=function(t,e){return y.partial(e,t)},y.negate=function(t){return function(){return!t.apply(this,arguments)}},y.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},y.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},y.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},y.once=y.partial(y.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),N=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(t){if(!y.isObject(t))return[];if(p)return p(t);var e=[];for(var i in t)y.has(t,i)&&e.push(i);return I&&n(t,e),e},y.allKeys=function(t){if(!y.isObject(t))return[];var e=[];for(var i in t)e.push(i);return I&&n(t,e),e},y.values=function(t){for(var e=y.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n},y.mapObject=function(t,e,i){e=_(e,i);for(var n,r=y.keys(t),o=r.length,s={},a=0;a<o;a++)n=r[a],s[n]=e(t[n],n,t);return s},y.pairs=function(t){for(var e=y.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=[e[r],t[e[r]]];return n},y.invert=function(t){for(var e={},i=y.keys(t),n=0,r=i.length;n<r;n++)e[t[i[n]]]=i[n];return e},y.functions=y.methods=function(t){var e=[];for(var i in t)y.isFunction(t[i])&&e.push(i);return e.sort()},y.extend=w(y.allKeys),y.extendOwn=y.assign=w(y.keys),y.findKey=function(t,e,i){e=_(e,i);for(var n,r=y.keys(t),o=0,s=r.length;o<s;o++)if(n=r[o],e(t[n],n,t))return n},y.pick=function(t,e,i){var n,r,o={},s=t;if(null==s)return o;y.isFunction(e)?(r=y.allKeys(s),n=b(e,i)):(r=P(arguments,!1,!1,1),n=function(t,e,i){return e in i},s=Object(s));for(var a=0,l=r.length;a<l;a++){var h=r[a],c=s[h];n(c,h,s)&&(o[h]=c)}return o},y.omit=function(t,e,i){if(y.isFunction(e))e=y.negate(e);else{var n=y.map(P(arguments,!1,!1,1),String);e=function(t,e){return!y.contains(n,e)}}return y.pick(t,e,i)},y.defaults=w(y.allKeys,!0),y.create=function(t,e){var i=x(t);return e&&y.extendOwn(i,e),i},y.clone=function(t){return y.isObject(t)?y.isArray(t)?t.slice():y.extend({},t):t},y.tap=function(t,e){return e(t),t},y.isMatch=function(t,e){var i=y.keys(e),n=i.length;if(null==t)return!n;for(var r=Object(t),o=0;o<n;o++){var s=i[o];if(e[s]!==r[s]||!(s in r))return!1}return!0};var M=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof y&&(t=t._wrapped),e instanceof y&&(e=e._wrapped);var r=u.call(t);if(r!==u.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var o="[object Array]"===r;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(y.isFunction(s)&&s instanceof s&&y.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===t)return n[l]===e;if(i.push(t),n.push(e),o){if((l=t.length)!==e.length)return!1;for(;l--;)if(!M(t[l],e[l],i,n))return!1}else{var h,c=y.keys(t);if(l=c.length,y.keys(e).length!==l)return!1;for(;l--;)if(h=c[l],!y.has(e,h)||!M(t[h],e[h],i,n))return!1}return i.pop(),n.pop(),!0};y.isEqual=function(t,e){return M(t,e)},y.isEmpty=function(t){return null==t||(k(t)&&(y.isArray(t)||y.isString(t)||y.isArguments(t))?0===t.length:0===y.keys(t).length)},y.isElement=function(t){return!(!t||1!==t.nodeType)},y.isArray=f||function(t){return"[object Array]"===u.call(t)},y.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){y["is"+t]=function(e){return u.call(e)==="[object "+t+"]"}}),y.isArguments(arguments)||(y.isArguments=function(t){return y.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(y.isFunction=function(t){return"function"==typeof t||!1}),y.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},y.isNaN=function(t){return y.isNumber(t)&&t!==+t},y.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===u.call(t)},y.isNull=function(t){return null===t},y.isUndefined=function(t){return void 0===t},y.has=function(t,e){return null!=t&&d.call(t,e)},y.noConflict=function(){return r._=o,this},y.identity=function(t){return t},y.constant=function(t){return function(){return t}},y.noop=function(){},y.property=C,y.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},y.matcher=y.matches=function(t){return t=y.extendOwn({},t),function(e){return y.isMatch(e,t)}},y.times=function(t,e,i){var n=Array(Math.max(0,t));e=b(e,i,1);for(var r=0;r<t;r++)n[r]=e(r);return n},y.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},y.now=Date.now||function(){return(new Date).getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},A=y.invert(L),R=function(t){var e=function(e){return t[e]},i="(?:"+y.keys(t).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,e):t}};y.escape=R(L),y.unescape=R(A),y.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),y.isFunction(n)?n.call(t):n};var O=0;y.uniqueId=function(t){var e=++O+"";return t?t+e:e},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\u2028|\u2029/g,B=function(t){return"\\"+H[t]};y.template=function(t,e,i){!e&&i&&(e=i),e=y.defaults({},e,y.templateSettings);var n=RegExp([(e.escape||z).source,(e.interpolate||z).source,(e.evaluate||z).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(n,function(e,i,n,s,a){return o+=t.slice(r,a).replace(F,B),r=a+e.length,i?o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}var a=function(t){return s.call(this,t,y)},l=e.variable||"obj";return a.source="function("+l+"){\n"+o+"}",a},y.chain=function(t){var e=y(t);return e._chain=!0,e};var $=function(t,e){return t._chain?y(e).chain():e};y.mixin=function(t){y.each(y.functions(t),function(e){var i=y[e]=t[e];y.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),$(this,i.apply(y,t))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];y.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],$(this,i)}}),y.each(["concat","join","slice"],function(t){var e=s[t];y.prototype[t]=function(){return $(this,e.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return y})}.call(this),function(t){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,n,r){e.Backbone=t(e,r,i,n)});else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(t){}t(e,exports,n,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(t,e,i,n){var r=t.Backbone,o=[],s=o.slice;e.VERSION="1.2.0",e.$=n,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={},l=/\s+/,h=function(t,e,n,r,o){var s,a=0;if(n&&"object"==typeof n)for(s=i.keys(n);a<s.length;a++)e=t(e,s[a],n[s[a]],o);else if(n&&l.test(n))for(s=n.split(l);a<s.length;a++)e=t(e,s[a],r,o);else e=t(e,n,r,o);return e};a.on=function(t,e,i){return c(this,t,e,i)};var c=function(t,e,i,n,r){if(t._events=h(u,t._events||{},e,i,{context:n,ctx:t,listening:r}),r){(t._listeners||(t._listeners={}))[r.id]=r}return t};a.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=i.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),s=o[r];if(!s){var a=this._listenId||(this._listenId=i.uniqueId("l"));s=o[r]={obj:t,objId:r,id:a,listeningTo:o,count:0}}return c(t,e,n,this,s),this};var u=function(t,e,i,n){if(i){var r=t[e]||(t[e]=[]),o=n.context,s=n.ctx,a=n.listening;a&&a.count++,r.push({callback:i,context:o,ctx:o||s,listening:a})}return t};a.off=function(t,e,i){return this._events?(this._events=h(d,this._events,t,e,{context:i,listeners:this._listeners}),this):this},a.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var o=t?[t._listenId]:i.keys(r),s=0;s<o.length;s++){var a=r[o[s]];if(!a)break;a.obj.off(e,n,this)}return i.isEmpty(r)&&(this._listeningTo=void 0),this};var d=function(t,e,n,r){if(t){var o,s=0,a=r.context,l=r.listeners;if(e||n||a){for(var h=e?[e]:i.keys(t);s<h.length;s++){e=h[s];var c=t[e];if(!c)break;for(var u=[],d=0;d<c.length;d++){var f=c[d];n&&n!==f.callback&&n!==f.callback._callback||a&&a!==f.context?u.push(f):(o=f.listening)&&0==--o.count&&(delete l[o.id],delete o.listeningTo[o.objId])}u.length?t[e]=u:delete t[e]}return i.size(t)?t:void 0}for(var p=i.keys(l);s<p.length;s++)o=l[p[s]],delete l[o.id],delete o.listeningTo[o.objId]}};a.once=function(t,e,n){var r=h(f,{},t,e,i.bind(this.off,this));return this.on(r,void 0,n)},a.listenToOnce=function(t,e,n){var r=h(f,{},e,n,i.bind(this.stopListening,this,t));return this.listenTo(t,r)};var f=function(t,e,n,r){if(n){var o=t[e]=i.once(function(){r(e,o),n.apply(this,arguments)});o._callback=n}return t};a.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return h(p,this._events,t,void 0,i),this};var p=function(t,e,i,n){if(t){var r=t[e],o=t.all;r&&o&&(o=o.slice()),r&&g(r,n),o&&g(o,[e].concat(n))}return t},g=function(t,e){var i,n=-1,r=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}},m=function(t,e,n){switch(t){case 1:return function(){return i[e](this[n])};case 2:return function(t){return i[e](this[n],t)};case 3:return function(t,r){return i[e](this[n],t,r)};case 4:return function(t,r,o){return i[e](this[n],t,r,o)};default:return function(){var t=s.call(arguments);return t.unshift(this[n]),i[e].apply(i,t)}}},v=function(t,e,n){i.each(e,function(e,r){i[r]&&(t.prototype[r]=m(e,r,n))})};a.bind=a.on,a.unbind=a.off,i.extend(e,a);var y=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(y.prototype,a,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,n){var r,o,s,a,l,h,c,u;if(null==t)return this;if("object"==typeof t?(o=t,n=e):(o={})[t]=e,n||(n={}),!this._validate(o,n))return!1;s=n.unset,l=n.silent,a=[],h=this._changing,this._changing=!0,h||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(r in o)e=o[r],i.isEqual(u[r],e)||a.push(r),i.isEqual(c[r],e)?delete this.changed[r]:this.changed[r]=e,s?delete u[r]:u[r]=e;if(!l){a.length&&(this._pending=n);for(var d=0;d<a.length;d++)this.trigger("change:"+a[d],this,u[a[d]],n)}if(h)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var o in t)i.isEqual(r[o],e=t[o])||((n||(n={}))[o]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){if(!e.set(e.parse(i,t),t))return!1;n&&n.call(t.context,e,i,t),e.trigger("sync",e,i,t)},H(this,t),this.sync("read",this,t)},save:function(t,e,n){var r,o,s,a,l=this.attributes;if(null==t||"object"==typeof t?(r=t,n=e):(r={})[t]=e,n=i.extend({validate:!0},n),a=n.wait,r&&!a){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&a&&(this.attributes=i.extend({},l,r)),void 0===n.parse&&(n.parse=!0);var h=this,c=n.success;return n.success=function(t){h.attributes=l;var e=n.parse?h.parse(t,n):t;if(a&&(e=i.extend(r||{},e)),i.isObject(e)&&!h.set(e,n))return!1;c&&c.call(n.context,h,t,n),h.trigger("sync",h,t,n)},H(this,n),o=this.isNew()?"create":n.patch?"patch":"update","patch"!==o||n.attrs||(n.attrs=r),s=this.sync(o,this,n),r&&a&&(this.attributes=l),s},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,r=t.wait,o=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){r&&o(),n&&n.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var s=!1;return this.isNew()?i.defer(t.success):(H(this,t),s=this.sync("delete",this,t)),r||o(),s},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||z();if(this.isNew())return t;var e=this.id||this.attributes[this.idAttribute];return t.replace(/([^\/])$/,"$1/")+encodeURIComponent(e)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1)}}),v(y,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var b=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},_={add:!0,remove:!0,merge:!0},w={add:!0,remove:!1};i.extend(b.prototype,a,{model:y,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,w))},remove:function(t,e){var n,r=!i.isArray(t);return t=r?[t]:i.clone(t),e||(e={}),n=this._removeModels(t,e),!e.silent&&n&&this.trigger("update",this,e),r?t[0]:t},set:function(t,e){e=i.defaults({},e,_),e.parse&&(t=this.parse(t,e));var n=!i.isArray(t);t=n?t?[t]:[]:t.slice();var r,o,s,a,l,h=e.at;null!=h&&(h=+h),h<0&&(h+=this.length+1);for(var c=this.comparator&&null==h&&!1!==e.sort,u=i.isString(this.comparator)?this.comparator:null,d=[],f=[],p={},g=e.add,m=e.merge,v=e.remove,y=!(c||!g||!v)&&[],b=!1,w=0;w<t.length;w++){if(s=t[w],a=this.get(s))v&&(p[a.cid]=!0),m&&s!==a&&(s=this._isModel(s)?s.attributes:s,e.parse&&(s=a.parse(s,e)),a.set(s,e),c&&!l&&a.hasChanged(u)&&(l=!0)),t[w]=a;else if(g){if(!(o=t[w]=this._prepareModel(s,e)))continue;d.push(o),this._addReference(o,e)}o=a||o,o&&(r=this.modelId(o.attributes),!y||!o.isNew()&&p[r]||(y.push(o),b=b||!this.models[w]||o.cid!==this.models[w].cid),p[r]=!0)}if(v){for(var w=0;w<this.length;w++)p[(o=this.models[w]).cid]||f.push(o);f.length&&this._removeModels(f,e)}if(d.length||b)if(c&&(l=!0),this.length+=d.length,null!=h)for(var w=0;w<d.length;w++)this.models.splice(h+w,0,d[w]);else{y&&(this.models.length=0);for(var x=y||d,w=0;w<x.length;w++)this.models.push(x[w])}if(l&&this.sort({silent:!0}),!e.silent){for(var C=null!=h?i.clone(e):e,w=0;w<d.length;w++)null!=h&&(C.index=h+w),(o=d[w]).trigger("add",o,this,C);(l||b)&&this.trigger("sort",this,e),(d.length||f.length)&&this.trigger("update",this,e)}return n?t[0]:t},reset:function(t,e){e=e?i.clone(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(null!=t){var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.cid]}},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){var n=i.matches(t);return this[e?"find":"filter"](function(t){return n(t.attributes)})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e.call(t.context,n,i,t),n.trigger("sync",n,i,t)},H(this,t),this.sync("read",this,t)},create:function(t,e){e=e?i.clone(e):{};var n=e.wait;if(!(t=this._prepareModel(t,e)))return!1;n||this.add(t,e);var r=this,o=e.success;return e.success=function(t,e,i){n&&r.add(t,i),o&&o.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var i,n,r,o=!1,i=0,s=0;i<t.length;i++){var r=t[i]=this.get(t[i]);if(r){var a=this.modelId(r.attributes);null!=a&&delete this._byId[a],delete this._byId[r.cid];var n=this.indexOf(r);this.models.splice(n,1),this.length--,e.silent||(e.index=n,r.trigger("remove",r,this,e)),t[s++]=r,this._removeReference(r,e),o=!0}}return t.length!==s&&(t=t.slice(0,s)),o},_isModel:function(t){return t instanceof y},_addReference:function(t){this._byId[t.cid]=t;var e=this.modelId(t.attributes);null!=e&&(this._byId[e]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if("add"!==t&&"remove"!==t||i===this){if("destroy"===t&&this.remove(e,n),"change"===t){var r=this.modelId(e.previousAttributes()),o=this.modelId(e.attributes);r!==o&&(null!=r&&delete this._byId[r],null!=o&&(this._byId[o]=e))}this.trigger.apply(this,arguments)}}}),v(b,{forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:2,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3},"models");var x=["groupBy","countBy","sortBy","indexBy"];i.each(x,function(t){i[t]&&(b.prototype[t]=function(e,n){var r=i.isFunction(e)?e:function(t){return t.get(e)};return i[t](this.models,r,n)})});var C=e.View=function(t){this.cid=i.uniqueId("view"),t||(t={}),i.extend(this,i.pick(t,T)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];i.extend(C.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(!t&&!(t=i.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[t[e]]),n){var r=e.match(S);this.delegate(r[1],r[2],i.bind(n,this))}}return this},delegate:function(t,e,i){this.$el.on(t+".delegateEvents"+this.cid,e,i)},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){this.$el.off(t+".delegateEvents"+this.cid,e,i)},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t["class"]=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,n,r){var o=k[t];i.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||z()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",o),a)return a.apply(this,arguments)}}"GET"===s.type||r.emulateJSON||(s.processData=!1);var l=r.error;r.error=function(t,e,i){r.textStatus=e,r.errorThrown=i,l&&l.call(r.context,t,e,i)};var h=r.xhr=e.ajax(i.extend(s,r));return n.trigger("request",n,h,r),h};var k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var E=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},P=/\((.*?)\)/g,D=/(\(\?)?:\w+/g,I=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(E.prototype,a,{initialize:function(){},route:function(t,n,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return e.history.route(t,function(i){var s=o._extractParameters(t,i);!1!==o.execute(r,s,n)&&(o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),e.history.trigger("route",o,n,s))}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(N,"\\$&").replace(P,"(?:$1)?").replace(D,function(t,e){return e?t:"([^/?]+)"}).replace(I,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var M=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,A=/^\/+|\/+$/g,R=/#.*$/;M.started=!1,i.extend(M.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(L,"")},start:function(t){if(M.started)throw new Error("Backbone.history has already been started");if(M.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window,this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(A,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){var n=document.createElement("iframe");n.src="javascript:0",n.style.display="none",n.tabIndex=-1;var r=document.body;this.iframe=r.insertBefore(n,r.firstChild).contentWindow,this.iframe.document.open().close(),this.iframe.location.hash="#"+this.fragment}var o=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe.frameElement),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!M.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;if(t=this.decodeFragment(t.replace(R,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe)&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new M;var O=function(t,e){var n,r=this;n=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,e);var o=function(){this.constructor=n};return o.prototype=r.prototype,n.prototype=new o,t&&i.extend(n.prototype,t),n.__super__=r.prototype,n};y.extend=b.extend=E.extend=C.extend=M.extend=O;var z=function(){throw new Error('A "url" property or function must be specified')},H=function(t,e){var i=e.error;e.error=function(n){i&&i.call(e.context,t,n,e),t.trigger("error",t,n,e)}};return e}),function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(t.style[i]!==undefined)return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("bsTransitionEnd",function(){i=!0});var r=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var i=t(this),r=i.data("bs.alert");r||i.data("bs.alert",r=new n(this)),"string"==typeof e&&r[e].call(i)})}var i='[data-dismiss="alert"]',n=function(e){t(e).on("click",i,this.close)};n.VERSION="3.3.7",n.TRANSITION_DURATION=150,n.prototype.close=function(e){function i(){s.detach().trigger("closed.bs.alert").remove()}var r=t(this),o=r.attr("data-target");o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,""));var s=t("#"===o?[]:o);e&&e.preventDefault(),s.length||(s=r.closest(".alert")),s.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i())};var r=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=r,this},t(document).on("click.bs.alert.data-api",i,n.prototype.close)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.button"),o="object"==typeof e&&e;r||n.data("bs.button",r=new i(this,o)),"toggle"==e?r.toggle():e&&r.setState(e)})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.isLoading=!1};i.VERSION="3.3.7",i.DEFAULTS={loadingText:"loading..."},
i.prototype.setState=function(e){var i="disabled",n=this.$element,r=n.is("input")?"val":"html",o=n.data();e+="Text",null==o.resetText&&n.data("resetText",n[r]()),setTimeout(t.proxy(function(){n[r](null==o[e]?this.options[e]:o[e]),"loadingText"==e?(this.isLoading=!0,n.addClass(i).attr(i,i).prop(i,!0)):this.isLoading&&(this.isLoading=!1,n.removeClass(i).removeAttr(i).prop(i,!1))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var n=t(i.target).closest(".btn");e.call(n,"toggle"),t(i.target).is('input[type="radio"], input[type="checkbox"]')||(i.preventDefault(),n.is("input,button")?n.trigger("focus"):n.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.carousel"),o=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e),s="string"==typeof e?e:o.slide;r||n.data("bs.carousel",r=new i(this,o)),"number"==typeof e?r.to(e):s?r[s]():o.interval&&r.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e);if(("prev"==t&&0===i||"next"==t&&i==this.$items.length-1)&&!this.options.wrap)return e;var n="prev"==t?-1:1,r=(i+n)%this.$items.length;return this.$items.eq(r)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){if(!this.sliding)return this.slide("next")},i.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},i.prototype.slide=function(e,n){var r=this.$element.find(".item.active"),o=n||this.getItemForDirection(e,r),s=this.interval,a="next"==e?"left":"right",l=this;if(o.hasClass("active"))return this.sliding=!1;var h=o[0],c=t.Event("slide.bs.carousel",{relatedTarget:h,direction:a});if(this.$element.trigger(c),!c.isDefaultPrevented()){if(this.sliding=!0,s&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var u=t(this.$indicators.children()[this.getItemIndex(o)]);u&&u.addClass("active")}var d=t.Event("slid.bs.carousel",{relatedTarget:h,direction:a});return t.support.transition&&this.$element.hasClass("slide")?(o.addClass(e),o[0].offsetWidth,r.addClass(a),o.addClass(a),r.one("bsTransitionEnd",function(){o.removeClass([e,a].join(" ")).addClass("active"),r.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(d)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(r.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger(d)),s&&this.cycle(),this}};var n=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this};var r=function(i){var n,r=t(this),o=t(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""));if(o.hasClass("carousel")){var s=t.extend({},o.data(),r.data()),a=r.attr("data-slide-to");a&&(s.interval=!1),e.call(o,s),a&&o.data("bs.carousel").to(a),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",r).on("click.bs.carousel.data-api","[data-slide-to]",r),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),function(t){"use strict";function e(e){var i,n=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(n)}function i(e){return this.each(function(){var i=t(this),r=i.data("bs.collapse"),o=t.extend({},n.DEFAULTS,i.data(),"object"==typeof e&&e);!r&&o.toggle&&/show|hide/.test(e)&&(o.toggle=!1),r||i.data("bs.collapse",r=new n(this,o)),"string"==typeof e&&r[e]()})}var n=function(e,i){this.$element=t(e),this.options=t.extend({},n.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};n.VERSION="3.3.7",n.TRANSITION_DURATION=350,n.DEFAULTS={toggle:!0},n.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},n.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,r=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(r&&r.length&&(e=r.data("bs.collapse"))&&e.transitioning)){var o=t.Event("show.bs.collapse");if(this.$element.trigger(o),!o.isDefaultPrevented()){r&&r.length&&(i.call(r,"hide"),e||r.data("bs.collapse",null));var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var l=t.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",t.proxy(a,this)).emulateTransitionEnd(n.TRANSITION_DURATION)[s](this.$element[0][l])}}}},n.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!t.support.transition)return r.call(this);this.$element[i](0).one("bsTransitionEnd",t.proxy(r,this)).emulateTransitionEnd(n.TRANSITION_DURATION)}}},n.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},n.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,n){var r=t(n);this.addAriaAndCollapsedClass(e(r),r)},this)).end()},n.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var r=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=n,t.fn.collapse.noConflict=function(){return t.fn.collapse=r,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(n){var r=t(this);r.attr("data-target")||n.preventDefault();var o=e(r),s=o.data("bs.collapse"),a=s?"toggle":r.data();i.call(o,a)})}(jQuery),function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}function i(i){i&&3===i.which||(t(r).remove(),t(o).each(function(){var n=t(this),r=e(n),o={relatedTarget:this};r.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(r[0],i.target)||(r.trigger(i=t.Event("hide.bs.dropdown",o)),i.isDefaultPrevented()||(n.attr("aria-expanded","false"),r.removeClass("open").trigger(t.Event("hidden.bs.dropdown",o)))))}))}function n(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new s(this)),"string"==typeof e&&n[e].call(i)})}var r=".dropdown-backdrop",o='[data-toggle="dropdown"]',s=function(e){t(e).on("click.bs.dropdown",this.toggle)};s.VERSION="3.3.7",s.prototype.toggle=function(n){var r=t(this);if(!r.is(".disabled, :disabled")){var o=e(r),s=o.hasClass("open");if(i(),!s){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var a={relatedTarget:this};if(o.trigger(n=t.Event("show.bs.dropdown",a)),n.isDefaultPrevented())return;r.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger(t.Event("shown.bs.dropdown",a))}return!1}},s.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var r=e(n),s=r.hasClass("open");if(!s&&27!=i.which||s&&27==i.which)return 27==i.which&&r.find(o).trigger("focus"),n.trigger("click");var a=" li:not(.disabled):visible a",l=r.find(".dropdown-menu"+a);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=n,t.fn.dropdown.Constructor=s,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",o,s.prototype.toggle).on("keydown.bs.dropdown.data-api",o,s.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",s.prototype.keydown)}(jQuery),function(t){"use strict";function e(e,n){return this.each(function(){var r=t(this),o=r.data("bs.modal"),s=t.extend({},i.DEFAULTS,r.data(),"object"==typeof e&&e);o||r.data("bs.modal",o=new i(this,s)),"string"==typeof e?o[e](n):s.show&&o.show(n)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var n=this,r=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var r=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),r&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var o=t.Event("shown.bs.modal",{relatedTarget:e});r?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(o)}).emulateTransitionEnd(i.TRANSITION_DURATION):n.$element.trigger("focus").trigger(o)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=t.support.transition&&r;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+r).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){if(this.ignoreBackdropClick)return void(this.ignoreBackdropClick=!1);t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;o?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){n.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var n=t(this),r=n.attr("href"),o=t(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=o.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(r)&&r},o.data(),n.data());n.is("a")&&i.preventDefault(),o.one("show.bs.modal",function(t){t.isDefaultPrevented()||o.one("hidden.bs.modal",function(){n.is(":visible")&&n.trigger("focus")})}),e.call(o,s,this)})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tab");r||n.data("bs.tab",r=new i(this)),"string"==typeof e&&r[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var r=i.find(".active:last a"),o=t.Event("hide.bs.tab",{relatedTarget:e[0]}),s=t.Event("show.bs.tab",{relatedTarget:r[0]});if(r.trigger(o),e.trigger(s),!s.isDefaultPrevented()&&!o.isDefaultPrevented()){var a=t(n);this.activate(e.closest("li"),i),this.activate(a,a.parent(),function(){r.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:r[0]})})}}},i.prototype.activate=function(e,n,r){function o(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),r&&r()}var s=n.find("> .active"),a=r&&t.support.transition&&(s.length&&s.hasClass("fade")||!!n.find("> .fade").length);s.length&&a?s.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),s.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var r=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',r).on("click.bs.tab.data-api",'[data-toggle="pill"]',r)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.affix"),o="object"==typeof e&&e;r||n.data("bs.affix",r=new i(this,o)),"string"==typeof e&&r[e]()})}var i=function(e,n){this.options=t.extend({},i.DEFAULTS,n),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.7",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,n){var r=this.$target.scrollTop(),o=this.$element.offset(),s=this.$target.height();if(null!=i&&"top"==this.affixed)return r<i&&"top";if("bottom"==this.affixed)return null!=i?!(r+this.unpin<=o.top)&&"bottom":!(r+s<=t-n)&&"bottom";var a=null==this.affixed,l=a?r:o.top,h=a?s:e;return null!=i&&r<=i?"top":null!=n&&l+h>=t-n&&"bottom"},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),n=this.options.offset,r=n.top,o=n.bottom,s=Math.max(t(document).height(),t(document.body).height());"object"!=typeof n&&(o=r=n),"function"==typeof r&&(r=n.top(this.$element)),"function"==typeof o&&(o=n.bottom(this.$element));var a=this.getState(s,e,r,o);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var l="affix"+(a?"-"+a:""),h=t.Event(l+".bs.affix");if(this.$element.trigger(h),h.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:s-e-o})}};var n=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),n=i.data();n.offset=n.offset||{},null!=n.offsetBottom&&(n.offset.bottom=n.offsetBottom),null!=n.offsetTop&&(n.offset.top=n.offsetTop),e.call(i,n)})})}(jQuery),function(t){"use strict";function e(i,n){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var n=t(this),r=n.data("bs.scrollspy"),o="object"==typeof i&&i;r||n.data("bs.scrollspy",r=new e(this,o)),"string"==typeof i&&r[i]()})}e.VERSION="3.3.7",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),r=e.data("target")||e.attr("href"),o=/^#./.test(r)&&t(r);return o&&o.length&&o.is(":visible")&&[[o[i]().top+n,r]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),n=this.options.offset+i-this.$scrollElement.height(),r=this.offsets,o=this.targets,s=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=n)return s!=(t=o[o.length-1])&&this.activate(t);if(s&&e<r[0])return this.activeTarget=null,this.clear();for(t=r.length;t--;)s!=o[t]&&e>=r[t]&&(r[t+1]===undefined||e<r[t+1])&&this.activate(o[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var n=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tooltip"),o="object"==typeof e&&e;!r&&/destroy|hide/.test(e)||(r||n.data("bs.tooltip",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,n){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var r=this.options.trigger.split(" "),o=r.length;o--;){var s=r[o];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,n){i[t]!=n&&(e[t]=n)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue()){if(clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)}},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var n=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!n)return;var r=this,o=this.tip(),s=this.getUID(this.type);this.setContent(),o.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(a);h&&(a=a.replace(l,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),u=o[0].offsetWidth,d=o[0].offsetHeight;if(h){var f=a,p=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+d>p.bottom?"top":"top"==a&&c.top-d<p.top?"bottom":"right"==a&&c.right+u>p.width?"left":"left"==a&&c.left-u<p.left?"right":a,o.removeClass(f).addClass(a)}var g=this.getCalculatedOffset(a,c,u,d);this.applyPlacement(g,a);var m=function(){var t=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==t&&r.leave(r)};t.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",m).emulateTransitionEnd(i.TRANSITION_DURATION):m()}},i.prototype.applyPlacement=function(e,i){var n=this.tip(),r=n[0].offsetWidth,o=n[0].offsetHeight,s=parseInt(n.css("margin-top"),10),a=parseInt(n.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top+=s,e.left+=a,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),n.addClass("in");var l=n[0].offsetWidth,h=n[0].offsetHeight;"top"==i&&h!=o&&(e.top=e.top+o-h);var c=this.getViewportAdjustedDelta(i,e,l,h);c.left?e.left+=c.left:e.top+=c.top;var u=/top|bottom/.test(i),d=u?2*c.left-r+l:2*c.top-o+h,f=u?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(d,n[0][f],u)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function n(){"in"!=r.hoverState&&o.detach(),r.$element&&r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),e&&e()}var r=this,o=t(this.$tip),s=t.Event("hide.bs."+this.type);if(this.$element.trigger(s),!s.isDefaultPrevented())return o.removeClass("in"),t.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(i.TRANSITION_DURATION):n(),this.hoverState=null,this},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],n="BODY"==i.tagName,r=i.getBoundingClientRect();null==r.width&&(r=t.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var o=window.SVGElement&&i instanceof window.SVGElement,s=n?{top:0,left:0}:o?null:e.offset(),a={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=n?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},r,a,l,s)},i.prototype.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,n){var r={top:0,left:0};if(!this.$viewport)return r;var o=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-o-s.scroll,l=e.top+o-s.scroll+n;a<s.top?r.top=s.top-a:l>s.top+s.height&&(r.top=s.top+s.height-l)}else{var h=e.left-o,c=e.left+o+i;h<s.left?r.left=s.left-h:c>s.right&&(r.left=s.left+s.width-c)}return r},i.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},i.prototype.getUID=function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&((i=t(e.currentTarget).data("bs."+this.type))||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,
t.$viewport=null,t.$element=null})};var n=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.popover"),o="object"==typeof e&&e;!r&&/destroy|hide/.test(e)||(r||n.data("bs.popover",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.7",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var n=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(jQuery),function(t){t.version={versionStr:"2.3.0",major:parseInt("2",10),minor:parseInt("3",10),revision:parseInt("0",10)};var e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;t.isFunction=function(e){return"function"===t.type(e)},t.isArray=Array.isArray||function(e){return"array"===t.type(e)},t.isWindow=function(t){return t&&"object"==typeof t&&"setInterval"in t},t.type=function(t){return null===t||t===undefined?String(t):e[i.call(t)]||"object"},t.isPlainObject=function(e){if(!e||"object"!==OpenSeadragon.type(e)||e.nodeType||t.isWindow(e))return!1;if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1;var i;for(var r in e)i=r;return i===undefined||n.call(e,i)},t.isEmptyObject=function(t){for(var e in t)return!1;return!0},t.freezeObject=function(e){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(t){return t},t.freezeObject(e)},t.supportsCanvas=function(){var e=document.createElement("canvas");return!(!t.isFunction(e.getContext)||!e.getContext("2d"))}(),t.isCanvasTainted=function(t){var e=!1;try{t.getContext("2d").getImageData(0,0,1,1)}catch(t){e=!0}return e},t.pixelDensityRatio=function(){if(t.supportsCanvas){var e=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(i,1)/n}return 1}()}(OpenSeadragon),function($){function getOffsetParent(t,e){return e&&t!=document.body?document.body:t.offsetParent}$.extend=function(){var t,e,i,n,r,o,s=arguments[0]||{},a=arguments.length,l=!1,h=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},h=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===h&&(s=this,--h);h<a;h++)if(null!==(t=arguments[h])||t!==undefined)for(e in t)i=s[e],n=t[e],s!==n&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(r=OpenSeadragon.isArray(n)))?(r?(r=!1,o=i&&OpenSeadragon.isArray(i)?i:[]):o=i&&OpenSeadragon.isPlainObject(i)?i:{},s[e]=OpenSeadragon.extend(l,o,n)):n!==undefined&&(s[e]=n));return s};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var t=navigator.userAgent;return"string"==typeof t&&(-1!==t.indexOf("iPhone")||-1!==t.indexOf("iPad")||-1!==t.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,degrees:0,opacity:1,preload:!1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(t,e){return function(){var i=arguments;return i===undefined&&(i=[]),e.apply(t,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(t){return"string"==typeof t&&(t=document.getElementById(t)),t},getElementPosition:function(t){var e,i,n=new $.Point;for(t=$.getElement(t),e="fixed"==$.getElementStyle(t).position,i=getOffsetParent(t,e);i;)n.x+=t.offsetLeft,n.y+=t.offsetTop,e&&(n=n.plus($.getPageScroll())),t=i,e="fixed"==$.getElementStyle(t).position,i=getOffsetParent(t,e);return n},getElementOffset:function(t){t=$.getElement(t);var e,i,n=t&&t.ownerDocument,r={top:0,left:0};return n?(e=n.documentElement,typeof t.getBoundingClientRect!=typeof undefined&&(r=t.getBoundingClientRect()),i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(r.left+(i.pageXOffset||e.scrollLeft)-(e.clientLeft||0),r.top+(i.pageYOffset||e.scrollTop)-(e.clientTop||0))):new $.Point},getElementSize:function(t){return t=$.getElement(t),new $.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=$.getElement(t),t.currentStyle}:function(t){return t=$.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var e={};return $.getCssPropertyWithVendorPrefix=function(t){if(e[t]!==undefined)return e[t];var i=document.createElement("div").style,n=null;if(i[t]!==undefined)n=t;else for(var r=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=$.capitalizeFirstLetter(t),s=0;s<r.length;s++){var a=r[s]+o;if(i[a]!==undefined){n=a;break}}return e[t]=n,n},$.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},positiveModulo:function(t,e){var i=t%e;return i<0&&(i+=e),i},pointInElement:function(t,e){t=$.getElement(t);var i=$.getElementOffset(t),n=$.getElementSize(t);return e.x>=i.x&&e.x<i.x+n.x&&e.y<i.y+n.y&&e.y>=i.y},getEvent:function(t){return $.getEvent=t?function(t){return t}:function(){return window.event},$.getEvent(t)},getMousePosition:function(t){if("number"==typeof t.pageX)$.getMousePosition=function(t){var e=new $.Point;return t=$.getEvent(t),e.x=t.pageX,e.y=t.pageY,e};else{if("number"!=typeof t.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(t){var e=new $.Point;return t=$.getEvent(t),e.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,e}}return $.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},e=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(e.scrollLeft||e.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!t.scrollLeft&&!t.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(t){if("undefined"!=typeof window.scrollTo)$.setPageScroll=function(t){window.scrollTo(t.x,t.y)};else{var e=$.getPageScroll();if(e.x===t.x&&e.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var i=$.getPageScroll();if(i.x!==e.x&&i.y!==e.y)return void($.setPageScroll=function(t){document.body.scrollLeft=t.x,document.body.scrollTop=t.y});if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,i=$.getPageScroll(),i.x!==e.x&&i.y!==e.y)return void($.setPageScroll=function(t){document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y});$.setPageScroll=function(){}}return $.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},e=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!e.clientWidth&&!e.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(t){t=$.getElement(t);var e=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(e[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(e[1].style,{display:"table-row"}),$.extend(e[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),e[0].appendChild(e[1]),e[1].appendChild(e[2]),e[2].appendChild(t),e[0]},makeNeutralElement:function(t){var e=document.createElement(t),i=e.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",e},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(t){return $.makeTransparentImage=function(t){var e=$.makeNeutralElement("img");return e.src=t,e},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(t){var e=$.makeNeutralElement("img"),i=null;return i=$.makeNeutralElement("span"),i.style.display="inline-block",e.onload=function(){i.style.width=i.style.width||e.width+"px",i.style.height=i.style.height||e.height+"px",e.onload=null,e=null},e.src=t,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",i}),$.makeTransparentImage(t)},setElementOpacity:function(t,e,i){var n,r;t=$.getElement(t),i&&!$.Browser.alpha&&(e=Math.round(e)),$.Browser.opacity?t.style.opacity=e<1?e:"":e<1?(n=Math.round(100*e),r="alpha(opacity="+n+")",t.style.filter=r):t.style.filter=""},setElementTouchActionNone:function(t){t=$.getElement(t),"undefined"!=typeof t.style.touchAction?t.style.touchAction="none":"undefined"!=typeof t.style.msTouchAction&&(t.style.msTouchAction="none")},addClass:function(t,e){t=$.getElement(t),t.className?-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=" "+e):t.className=e},indexOf:function(t,e,i){return Array.prototype.indexOf?this.indexOf=function(t,e,i){return t.indexOf(e,i)}:this.indexOf=function(t,e,i){var n,r,o=i||0;if(!t)throw new TypeError;if(0===(r=t.length)||o>=r)return-1;for(o<0&&(o=r-Math.abs(o)),n=o;n<r;n++)if(t[n]===e)return n;return-1},this.indexOf(t,e,i)},removeClass:function(t,e){var i,n,r=[];for(t=$.getElement(t),i=t.className.split(/\s+/),n=0;n<i.length;n++)i[n]&&i[n]!==e&&r.push(i[n]);t.className=r.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,e,i,n){t=$.getElement(t),t.addEventListener(e,i,n)};if(window.attachEvent)return function(t,e,i){t=$.getElement(t),t.attachEvent("on"+e,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,e,i,n){t=$.getElement(t),t.removeEventListener(e,i,n)};if(window.detachEvent)return function(t,e,i){t=$.getElement(t),t.detachEvent("on"+e,i)};throw new Error("No known event model.")}(),cancelEvent:function(t){t=$.getEvent(t),t.preventDefault?$.cancelEvent=function(t){t.preventDefault()}:$.cancelEvent=function(t){t=$.getEvent(t),t.cancel=!0,t.returnValue=!1},$.cancelEvent(t)},stopEvent:function(t){t=$.getEvent(t),t.stopPropagation?$.stopEvent=function(t){t.stopPropagation()}:$.stopEvent=function(t){t=$.getEvent(t),t.cancelBubble=!0},$.stopEvent(t)},createCallback:function(t,e){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,r=n.concat([]);for(i=0;i<arguments.length;i++)r.push(arguments[i]);return e.apply(t,r)}},getUrlParameter:function(t){var e=URLPARAMS[t];return e||null},getUrlProtocol:function(t){var e=t.match(/^([a-z]+:)\/\//i);return null===e?window.location.protocol:e[1].toLowerCase()},createAjaxRequest:function(t){var e;try{e=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}if(e)window.XMLHttpRequest?$.createAjaxRequest=function(t){return t?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(t)},makeAjaxRequest:function(t,e,i){var n,r,o;$.isPlainObject(t)&&(e=t.success,i=t.error,n=t.withCredentials,r=t.headers,o=t.responseType||null,t=t.url);var s=$.getUrlProtocol(t),a=$.createAjaxRequest("file:"===s);if(!$.isFunction(e))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},a.status>=200&&a.status<300||0===a.status&&"http:"!==s&&"https:"!==s?e(a):($.console.log("AJAX request returned %d: %s",a.status,t),$.isFunction(i)&&i(a)))};try{if(a.open("GET",t,!0),o&&(a.responseType=o),r)for(var l in r)r.hasOwnProperty(l)&&r[l]&&a.setRequestHeader(l,r[l]);n&&(a.withCredentials=!0),a.send(null)}catch(n){var h=n.message,c=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(c&&"undefined"!=typeof n.number&&-2147024891==n.number&&(h+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",n.name,h),a.onreadystatechange=function(){},window.XDomainRequest){var u=new XDomainRequest;if(u){u.onload=function(){$.isFunction(e)&&e({responseText:u.responseText,status:200,statusText:"OK"})},u.onerror=function(){$.isFunction(i)&&i({responseText:u.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{u.open("GET",t),u.send()}catch(t){$.isFunction(i)&&i(a,n)}}}else $.isFunction(i)&&i(a,n)}return a},jsonp:function(t){var e,i=t.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=t.callbackName||"openseadragon"+$.now(),o=window[r],s="$1"+r+"$2",a=t.param||"callback",l=t.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,s),i+=(/\?/.test(i)?"&":"?")+a+"="+r,window[r]=function(t){if(o)window[r]=o;else try{delete window[r]}catch(t){}l&&$.isFunction(l)&&l(t)},e=document.createElement("script"),undefined===t.async&&!1===t.async||(e.async="async"),t.scriptCharset&&(e.charset=t.scriptCharset),e.src=i,e.onload=e.onreadystatechange=function(t,i){(i||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,n&&e.parentNode&&n.removeChild(e),e=undefined)},n.insertBefore(e,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)$.parseXml=function(t){var e;return e=new DOMParser,e.parseFromString(t,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(t){var e=null;return e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(t),e}}return $.parseXml(t)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(t){return t=t||"",!!FILEFORMATS[t.toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var t,e=navigator.appVersion,i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(i.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):i.indexOf("Safari")>=0?($.Browser.vendor=i.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))):(t=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==t.exec(i)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var n,r,o,s=window.location.search.substring(1),a=s.split("&");for(o=0;o<a.length;o++)n=a[o],(r=n.indexOf("="))>0&&(URLPARAMS[n.substring(0,r)]=decodeURIComponent(n.substring(r+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(t){var e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,i=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(e&&i)$.requestAnimationFrame=function(){return e.apply(t,arguments)},$.cancelAnimationFrame=function(){return i.apply(t,arguments)};else{var n,r=[],o=[],s=0;$.requestAnimationFrame=function(t){return r.push([++s,t]),n||(n=setInterval(function(){if(r.length){var t=$.now(),e=o;for(o=r,r=e;o.length;)o.shift()[1](t)}else clearInterval(n),n=undefined},20)),s},$.cancelAnimationFrame=function(t){var e,i;for(e=0,i=r.length;e<i;e+=1)if(r[e][0]===t)return void r.splice(e,1);for(e=0,i=o.length;e<i;e+=1)if(o[e][0]===t)return void o.splice(e,1)}}}(window)}(OpenSeadragon),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.OpenSeadragon=e()}(this,function(){return OpenSeadragon}),function(t){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.fullscreenElement},e.requestFullScreen=function(t){return t.requestFullscreen()},e.exitFullScreen=function(){document.exitFullscreen()},e.fullScreenEventName="fullscreenchange",e.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.msFullscreenElement},e.requestFullScreen=function(t){return t.msRequestFullscreen()},e.exitFullScreen=function(){document.msExitFullscreen()},e.fullScreenEventName="MSFullscreenChange",e.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitFullscreenElement},e.requestFullScreen=function(t){return t.webkitRequestFullscreen()},e.exitFullScreen=function(){document.webkitExitFullscreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},e.requestFullScreen=function(t){return t.webkitRequestFullScreen()},e.exitFullScreen=function(){document.webkitCancelFullScreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.mozFullScreenElement},e.requestFullScreen=function(t){return t.mozRequestFullScreen()},e.exitFullScreen=function(){document.mozCancelFullScreen()},e.fullScreenEventName="mozfullscreenchange",e.fullScreenErrorEventName="mozfullscreenerror"),e.isFullScreen=function(){return null!==e.getFullScreenElement()},e.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),e.exitFullScreen()},t.extend(t,e)}(OpenSeadragon),function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(t,e,i,n){var r=this;n=n||1;var o=0,s=function(i){o++,o===n&&r.removeHandler(t,s),e(i)};this.addHandler(t,s,i)},addHandler:function(e,i,n){var r=this.events[e];r||(this.events[e]=r=[]),i&&t.isFunction(i)&&(r[r.length]={handler:i,userData:n||null})},removeHandler:function(e,i){var n,r=this.events[e],o=[];if(r&&t.isArray(r)){for(n=0;n<r.length;n++)r[n].handler!==i&&o.push(r[n]);this.events[e]=o}},removeAllHandlers:function(t){if(t)this.events[t]=[];else for(var e in this.events)this.events[e]=[]},getHandler:function(t){var e=this.events[t];return e&&e.length?(e=1===e.length?[e[0]]:Array.apply(null,e),function(t,i){var n,r=e.length;for(n=0;n<r;n++)e[n]&&(i.eventSource=t,i.userData=e[n].userData,e[n].handler(i))}):null},raiseEvent:function(t,e){var i=this.getHandler(t);i&&(e||(e={}),i(this,e))}}}(OpenSeadragon),function(t){function e(e){var i,n=gt[e.hash],r=n.activePointersLists.length;for(i=0;i<r;i++)n.activePointersLists[i].captureCount>0&&(t.removeEvent(t.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[i].captureCount=0);for(i=0;i<r;i++)n.activePointersLists.pop()}function i(i){var n,r,o=gt[i.hash];if(!o.tracking){for(r=0;r<t.MouseTracker.subscribeEvents.length;r++)n=t.MouseTracker.subscribeEvents[r],t.addEvent(i.element,n,o[n],!1);e(i),o.tracking=!0}}function n(i){var n,r,o=gt[i.hash];if(o.tracking){for(r=0;r<t.MouseTracker.subscribeEvents.length;r++)n=t.MouseTracker.subscribeEvents[r],t.removeEvent(i.element,n,o[n],!1);e(i),o.tracking=!1}}function r(e,i){var n=gt[e.hash];if("pointerevent"===i)return{upName:t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:n.pointerupcaptured,moveName:t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:n.pointermovecaptured};if("mouse"===i)return{upName:"mouseup",upHandler:n.mouseupcaptured,moveName:"mousemove",moveHandler:n.mousemovecaptured};if("touch"===i)return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function o(e,i,n){var o,s=e.getActivePointersListByType(i);s.captureCount+=n||1,1===s.captureCount&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?e.element.setCapture(!0):(o=r(e,t.MouseTracker.havePointerEvents?"pointerevent":i),mt&&ft(window.top)&&t.addEvent(window.top,o.upName,o.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,o.upName,o.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,o.moveName,o.moveHandler,!0)))}function s(e,i,n){var o,s=e.getActivePointersListByType(i);s.captureCount-=n||1,0===s.captureCount&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?e.element.releaseCapture():(o=r(e,t.MouseTracker.havePointerEvents?"pointerevent":i),mt&&ft(window.top)&&t.removeEvent(window.top,o.upName,o.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,o.moveName,o.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,o.upName,o.upHandler,!0)))}function a(e){var i;if(t.MouseTracker.unprefixedPointerEvents)i=e.pointerType;else switch(e.pointerType){case 2:i="touch";break;case 3:i="pen";break;case 4:i="mouse";break;default:i=""}return i}function l(e){return t.getMousePosition(e)}function h(t,e){return c(l(t),e)}function c(e,i){var n=t.getElementOffset(i);return e.minus(n)}function u(e,i){return new t.Point((e.x+i.x)/2,(e.y+i.y)/2)}function d(e,i){e.clickHandler&&t.cancelEvent(i)}function f(e,i){e.dblClickHandler&&t.cancelEvent(i)}function p(e,i){e.keyDownHandler&&(i=t.getEvent(i),e.keyDownHandler({eventSource:e,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})||t.cancelEvent(i))}function g(e,i){e.keyUpHandler&&(i=t.getEvent(i),e.keyUpHandler({eventSource:e,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})||t.cancelEvent(i))}function m(e,i){e.keyHandler&&(i=t.getEvent(i),e.keyHandler({eventSource:e,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})||t.cancelEvent(i))}function v(e,i){e.focusHandler&&(i=t.getEvent(i),!1===e.focusHandler({eventSource:e,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i))}function y(e,i){e.blurHandler&&(i=t.getEvent(i),!1===e.blurHandler({eventSource:e,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i))}function b(t,e){w(t,e,e)}function _(e,i){i=t.getEvent(i);var n={target:i.target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==t.MouseTracker.wheelEventName?n.deltaY=-i.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:n.deltaY=i.detail,w(e,n,i)}function w(e,i,n){var r=0;r=i.deltaY<0?1:-1,e.scrollHandler&&!1===e.scrollHandler({eventSource:e,pointerType:"mouse",position:h(i,e.element),scroll:r,shift:i.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(n)}function x(t,e){if(t===e)return!1;for(;e&&e!==t;)e=e.parentNode;return e===t}function C(e,i){i=t.getEvent(i),T(e,i)}function S(e,i){i=t.getEvent(i),i.currentTarget===i.relatedTarget||x(i.currentTarget,i.relatedTarget)||T(e,i)}function T(e,i){st(e,i,[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()}])}function k(e,i){i=t.getEvent(i),P(e,i)}function E(e,i){i=t.getEvent(i),i.currentTarget===i.relatedTarget||x(i.currentTarget,i.relatedTarget)||P(e,i)}function P(e,i){at(e,i,[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()}])}function D(e){return t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?1===e?0:2===e?2:4===e?1:-1:e}function I(e,i){var n;i=t.getEvent(i),n={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()},lt(e,i,[n],D(i.button))&&(t.stopEvent(i),o(e,"mouse")),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler)&&t.cancelEvent(i)}function N(t,e){L(t,e)}function M(e,i){L(e,i),t.stopEvent(i)}function L(e,i){var n;i=t.getEvent(i),n={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()},ht(e,i,[n],D(i.button))&&s(e,"mouse")}function A(t,e){O(t,e)}function R(e,i){O(e,i),t.stopEvent(i)}function O(e,i){var n;i=t.getEvent(i),n={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()},ct(e,i,[n])}function z(t,e,i){var n,r=i.getLength(),o=[];if("touch"===i.type||i.contacts>0){for(n=0;n<r;n++)o.push(i.getByIndex(n));o.length>0&&(ht(t,e,o,0),i.captureCount=1,s(t,i.type),at(t,e,o))}}function H(e,i){var n,r,s,a,h=i.changedTouches.length,c=[],u=e.getActivePointersListByType("touch");for(n=t.now(),u.getLength()>i.touches.length-h&&(t.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),z(e,i,u)),r=0;r<h;r++)c.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:l(i.changedTouches[r]),currentTime:n});for(st(e,i,c),r=0;r<pt.length;r++)if(pt[r]!==e&&pt[r].isTracking()&&x(pt[r].element,e.element)){for(a=[],s=0;s<h;s++)a.push({id:i.changedTouches[s].identifier,type:"touch",currentPos:l(i.changedTouches[s]),currentTime:n});st(pt[r],i,a)}lt(e,i,c,0)&&(t.stopEvent(i),o(e,"touch",h)),t.cancelEvent(i)}function F(t,e){$(t,e)}function B(e,i){$(e,i),t.stopEvent(i)}function $(e,i){var n,r,o,a,h=i.changedTouches.length,c=[];for(n=t.now(),r=0;r<h;r++)c.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:l(i.changedTouches[r]),currentTime:n});for(ht(e,i,c,0)&&s(e,"touch",h),at(e,i,c),r=0;r<pt.length;r++)if(pt[r]!==e&&pt[r].isTracking()&&x(pt[r].element,e.element)){for(a=[],o=0;o<h;o++)a.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:l(i.changedTouches[o]),currentTime:n});at(pt[r],i,a)}t.cancelEvent(i)}function j(t,e){q(t,e)}function W(e,i){q(e,i),t.stopEvent(i)}
function q(e,i){var n,r=i.changedTouches.length,o=[];for(n=0;n<r;n++)o.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:l(i.changedTouches[n]),currentTime:t.now()});ct(e,i,o),t.cancelEvent(i)}function U(t,e){z(t,e,t.getActivePointersListByType("touch"))}function V(t,e){return e.stopPropagation(),e.preventDefault(),!1}function G(t,e){return e.stopPropagation(),e.preventDefault(),!1}function Z(e,i){var n;i.currentTarget===i.relatedTarget||x(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},st(e,i,[n]))}function K(e,i){var n;i.currentTarget===i.relatedTarget||x(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},at(e,i,[n]))}function Y(e,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},lt(e,i,[n],i.button)&&(t.stopEvent(i),o(e,n.type)),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler||e.pinchHandler)&&t.cancelEvent(i)}function X(t,e){Q(t,e)}function J(e,i){e.getActivePointersListByType(a(i)).getById(i.pointerId)&&Q(e,i),t.stopEvent(i)}function Q(e,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},ht(e,i,[n],i.button)&&s(e,n.type)}function tt(t,e){it(t,e)}function et(e,i){e.getActivePointersListByType(a(i)).getById(i.pointerId)&&it(e,i),t.stopEvent(i)}function it(e,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},ct(e,i,[n])}function nt(t,e){var i;i={id:e.pointerId,type:a(e)},ut(t,e,[i])}function rt(t,e){return e.hasOwnProperty("isPrimary")||(0===t.getLength()?e.isPrimary=!0:e.isPrimary=!1),e.speed=0,e.direction=0,e.contactPos=e.currentPos,e.contactTime=e.currentTime,e.lastPos=e.currentPos,e.lastTime=e.currentTime,t.add(e)}function ot(t,e){var i,n;return t.getById(e.id)?(i=t.removeById(e.id),e.hasOwnProperty("isPrimary")||(n=t.getPrimary())||(n=t.getByIndex(0))&&(n.isPrimary=!0)):i=t.getLength(),i}function st(e,i,n){var r,o,s,a=e.getActivePointersListByType(n[0].type),l=n.length;for(r=0;r<l;r++)o=n[r],s=a.getById(o.id),s?(s.insideElement=!0,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime,o=s):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,rt(a,o)),e.enterHandler&&!1===e.enterHandler({eventSource:e,pointerType:o.type,position:c(o.currentPos,e.element),buttons:a.buttons,pointers:e.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)}function at(e,i,n){var r,o,s,a=e.getActivePointersListByType(n[0].type),l=n.length;for(r=0;r<l;r++)o=n[r],s=a.getById(o.id),s&&(s.captured?(s.insideElement=!1,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):ot(a,s),o=s),e.exitHandler&&!1===e.exitHandler({eventSource:e,pointerType:o.type,position:c(o.currentPos,e.element),buttons:a.buttons,pointers:e.getActivePointerCount(),insideElementPressed:!!s&&s.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)}function lt(e,i,n,r){var o,s,a,l=gt[e.hash],h=e.getActivePointersListByType(n[0].type),d=n.length;"undefined"!=typeof i.buttons?h.buttons=i.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?0===r?h.buttons+=1:1===r?h.buttons+=4:2===r?h.buttons+=2:3===r?h.buttons+=8:4===r?h.buttons+=16:5===r&&(h.buttons+=32):0===r?h.buttons|=1:1===r?h.buttons|=4:2===r?h.buttons|=2:3===r?h.buttons|=8:4===r?h.buttons|=16:5===r&&(h.buttons|=32);var f=e.getActivePointersListsExceptType(n[0].type);for(o=0;o<f.length;o++)z(e,i,f[o]);if(0!==r)return e.nonPrimaryPressHandler&&!1===e.nonPrimaryPressHandler({eventSource:e,pointerType:n[0].type,position:c(n[0].currentPos,e.element),button:r,buttons:h.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),!1;for(o=0;o<d;o++)s=n[o],a=h.getById(s.id),a?(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,a.contactPos=s.currentPos,a.contactTime=s.currentTime,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=s.currentPos,a.currentTime=s.currentTime,s=a):(s.captured=!0,s.insideElementPressed=!0,s.insideElement=!0,rt(h,s)),h.addContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(e,s),1===h.contacts?e.pressHandler&&!1===e.pressHandler({eventSource:e,pointerType:s.type,position:c(s.contactPos,e.element),buttons:h.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i):2===h.contacts&&e.pinchHandler&&"touch"===s.type&&(l.pinchGPoints=h.asArray(),l.lastPinchDist=l.currentPinchDist=l.pinchGPoints[0].currentPos.distanceTo(l.pinchGPoints[1].currentPos),l.lastPinchCenter=l.currentPinchCenter=u(l.pinchGPoints[0].currentPos,l.pinchGPoints[1].currentPos));return!0}function ht(e,i,n,r){var o,s,a,l,h,d,f=gt[e.hash],p=e.getActivePointersListByType(n[0].type),g=n.length,m=!1,v=!1;if("undefined"!=typeof i.buttons?p.buttons=i.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?0===r?p.buttons-=1:1===r?p.buttons-=4:2===r?p.buttons-=2:3===r?p.buttons-=8:4===r?p.buttons-=16:5===r&&(p.buttons-=32):0===r?p.buttons^=-2:1===r?p.buttons^=-5:2===r?p.buttons^=-3:3===r?p.buttons^=-9:4===r?p.buttons^=-17:5===r&&(p.buttons^=-33),0!==r){e.nonPrimaryReleaseHandler&&!1===e.nonPrimaryReleaseHandler({eventSource:e,pointerType:n[0].type,position:c(n[0].currentPos,e.element),button:r,buttons:p.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i);return z(e,i,e.getActivePointersListByType("mouse")),!1}for(a=0;a<g;a++)l=n[a],(h=p.getById(l.id))&&(h.captured&&(h.captured=!1,m=!0,v=!0),h.lastPos=h.currentPos,h.lastTime=h.currentTime,h.currentPos=l.currentPos,h.currentTime=l.currentTime,h.insideElement||ot(p,h),o=h.currentPos,s=h.currentTime,v?(p.removeContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(e,h),0===p.contacts?(e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:h.type,position:c(o,e.element),buttons:p.buttons,insideElementPressed:h.insideElementPressed,insideElementReleased:h.insideElement,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),e.dragEndHandler&&!h.currentPos.equals(h.contactPos)&&!1===e.dragEndHandler({eventSource:e,pointerType:h.type,position:c(h.currentPos,e.element),speed:h.speed,direction:h.direction,shift:i.shiftKey,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),(e.clickHandler||e.dblClickHandler)&&h.insideElement&&(d=s-h.contactTime<=e.clickTimeThreshold&&h.contactPos.distanceTo(o)<=e.clickDistThreshold,e.clickHandler&&!1===e.clickHandler({eventSource:e,pointerType:h.type,position:c(h.currentPos,e.element),quick:d,shift:i.shiftKey,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),e.dblClickHandler&&d&&(p.clicks++,1===p.clicks?(f.lastClickPos=o,f.dblClickTimeOut=setTimeout(function(){p.clicks=0},e.dblClickTimeThreshold)):2===p.clicks&&(clearTimeout(f.dblClickTimeOut),p.clicks=0,f.lastClickPos.distanceTo(o)<=e.dblClickDistThreshold&&!1===e.dblClickHandler({eventSource:e,pointerType:h.type,position:c(h.currentPos,e.element),shift:i.shiftKey,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),f.lastClickPos=null)))):2===p.contacts&&e.pinchHandler&&"touch"===h.type&&(f.pinchGPoints=p.asArray(),f.lastPinchDist=f.currentPinchDist=f.pinchGPoints[0].currentPos.distanceTo(f.pinchGPoints[1].currentPos),f.lastPinchCenter=f.currentPinchCenter=u(f.pinchGPoints[0].currentPos,f.pinchGPoints[1].currentPos))):e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:h.type,position:c(o,e.element),buttons:p.buttons,insideElementPressed:h.insideElementPressed,insideElementReleased:h.insideElement,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i));return m}function ct(e,i,n){var r,o,s,a,l,h=gt[e.hash],d=e.getActivePointersListByType(n[0].type),f=n.length;for("undefined"!=typeof i.buttons&&(d.buttons=i.buttons),r=0;r<f;r++)o=n[r],s=d.getById(o.id),s?(o.hasOwnProperty("isPrimary")&&(s.isPrimary=o.isPrimary),s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,rt(d,o));e.stopHandler&&"mouse"===n[0].type&&(clearTimeout(e.stopTimeOut),e.stopTimeOut=setTimeout(function(){dt(e,i,n[0].type)},e.stopDelay)),0===d.contacts?e.moveHandler&&!1===e.moveHandler({eventSource:e,pointerType:n[0].type,position:c(n[0].currentPos,e.element),buttons:d.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i):1===d.contacts?(e.moveHandler&&(s=d.asArray()[0],!1===e.moveHandler({eventSource:e,pointerType:s.type,position:c(s.currentPos,e.element),buttons:d.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)),e.dragHandler&&(s=d.asArray()[0],l=s.currentPos.minus(s.lastPos),!1===e.dragHandler({eventSource:e,pointerType:s.type,position:c(s.currentPos,e.element),buttons:d.buttons,delta:l,speed:s.speed,direction:s.direction,shift:i.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i))):2===d.contacts&&(e.moveHandler&&(a=d.asArray(),!1===e.moveHandler({eventSource:e,pointerType:a[0].type,position:c(u(a[0].currentPos,a[1].currentPos),e.element),buttons:d.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)),e.pinchHandler&&"touch"===n[0].type&&(l=h.pinchGPoints[0].currentPos.distanceTo(h.pinchGPoints[1].currentPos))!=h.currentPinchDist&&(h.lastPinchDist=h.currentPinchDist,h.currentPinchDist=l,h.lastPinchCenter=h.currentPinchCenter,h.currentPinchCenter=u(h.pinchGPoints[0].currentPos,h.pinchGPoints[1].currentPos),!1===e.pinchHandler({eventSource:e,pointerType:"touch",gesturePoints:h.pinchGPoints,lastCenter:c(h.lastPinchCenter,e.element),center:c(h.currentPinchCenter,e.element),lastDistance:h.lastPinchDist,distance:h.currentPinchDist,shift:i.shiftKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)))}function ut(t,e,i){ht(t,e,i,0),at(t,e,i)}function dt(t,e,i){t.stopHandler&&t.stopHandler({eventSource:t,pointerType:i,position:h(e,t.element),buttons:t.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:e,preventDefaultAction:!1,userData:t.userData})}function ft(t){try{return t.addEventListener&&t.removeEventListener}catch(t){return!1}}var pt=[],gt={};t.MouseTracker=function(e){pt.push(this);var i=arguments;t.isPlainObject(e)||(e={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=t.getElement(e.element),this.clickTimeThreshold=e.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=e.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=e.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=e.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=e.userData||null,this.stopDelay=e.stopDelay||50,this.enterHandler=e.enterHandler||null,this.exitHandler=e.exitHandler||null,this.pressHandler=e.pressHandler||null,this.nonPrimaryPressHandler=e.nonPrimaryPressHandler||null,this.releaseHandler=e.releaseHandler||null,this.nonPrimaryReleaseHandler=e.nonPrimaryReleaseHandler||null,this.moveHandler=e.moveHandler||null,this.scrollHandler=e.scrollHandler||null,this.clickHandler=e.clickHandler||null,this.dblClickHandler=e.dblClickHandler||null,this.dragHandler=e.dragHandler||null,this.dragEndHandler=e.dragEndHandler||null,this.pinchHandler=e.pinchHandler||null,this.stopHandler=e.stopHandler||null,this.keyDownHandler=e.keyDownHandler||null,this.keyUpHandler=e.keyUpHandler||null,this.keyHandler=e.keyHandler||null,this.focusHandler=e.focusHandler||null,this.blurHandler=e.blurHandler||null;var n=this;gt[this.hash]={click:function(t){d(n,t)},dblclick:function(t){f(n,t)},keydown:function(t){p(n,t)},keyup:function(t){g(n,t)},keypress:function(t){m(n,t)},focus:function(t){v(n,t)},blur:function(t){y(n,t)},wheel:function(t){b(n,t)},mousewheel:function(t){_(n,t)},DOMMouseScroll:function(t){_(n,t)},MozMousePixelScroll:function(t){_(n,t)},mouseenter:function(t){C(n,t)},mouseleave:function(t){k(n,t)},mouseover:function(t){S(n,t)},mouseout:function(t){E(n,t)},mousedown:function(t){I(n,t)},mouseup:function(t){N(n,t)},mouseupcaptured:function(t){M(n,t)},mousemove:function(t){A(n,t)},mousemovecaptured:function(t){R(n,t)},touchstart:function(t){H(n,t)},touchend:function(t){F(n,t)},touchendcaptured:function(t){B(n,t)},touchmove:function(t){j(n,t)},touchmovecaptured:function(t){W(n,t)},touchcancel:function(t){U(n,t)},gesturestart:function(t){V(n,t)},gesturechange:function(t){G(n,t)},pointerover:function(t){Z(n,t)},MSPointerOver:function(t){Z(n,t)},pointerout:function(t){K(n,t)},MSPointerOut:function(t){K(n,t)},pointerdown:function(t){Y(n,t)},MSPointerDown:function(t){Y(n,t)},pointerup:function(t){X(n,t)},MSPointerUp:function(t){X(n,t)},pointermove:function(t){tt(n,t)},MSPointerMove:function(t){tt(n,t)},pointercancel:function(t){nt(n,t)},MSPointerCancel:function(t){nt(n,t)},pointerupcaptured:function(t){J(n,t)},pointermovecaptured:function(t){et(n,t)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},e.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){var t;for(n(this),this.element=null,t=0;t<pt.length;t++)if(pt[t]===this){pt.splice(t,1);break}gt[this.hash]=null,delete gt[this.hash]},isTracking:function(){return gt[this.hash].tracking},setTracking:function(t){return t?i(this):n(this),this},getActivePointersListsExceptType:function(t){for(var e=gt[this.hash],i=[],n=0;n<e.activePointersLists.length;++n)e.activePointersLists[n].type!==t&&i.push(e.activePointersLists[n]);return i},getActivePointersListByType:function(e){var i,n,r=gt[this.hash],o=r.activePointersLists.length;for(i=0;i<o;i++)if(r.activePointersLists[i].type===e)return r.activePointersLists[i];return n=new t.MouseTracker.GesturePointList(e),r.activePointersLists.push(n),n},getActivePointerCount:function(){var t,e=gt[this.hash],i=e.activePointersLists.length,n=0;for(t=0;t<i;t++)n+=e.activePointersLists[t].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},t.MouseTracker.resetAllMouseTrackers=function(){for(var t=0;t<pt.length;t++)pt[t].isTracking()&&(pt[t].setTracking(!1),pt[t].setTracking(!0))},t.MouseTracker.gesturePointVelocityTracker=function(){var e=[],i=0,n=0,r=function(t,e){return t.hash.toString()+e.type+e.id.toString()},o=function(){var i,r,o,s,a,l,h=e.length,c=t.now();for(s=c-n,n=c,i=0;i<h;i++)r=e[i],o=r.gPoint,o.direction=Math.atan2(o.currentPos.y-r.lastPos.y,o.currentPos.x-r.lastPos.x),a=r.lastPos.distanceTo(o.currentPos),r.lastPos=o.currentPos,l=1e3*a/(s+1),o.speed=.75*l+.25*o.speed};return{addPoint:function(s,a){var l=r(s,a);e.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===e.length&&(n=t.now(),i=window.setInterval(o,50))},removePoint:function(t,n){var o,s=r(t,n),a=e.length;for(o=0;o<a;o++)if(e[o].guid===s){e.splice(o,1),0===--a&&window.clearInterval(i);break}}}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor==t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll",t.MouseTracker.supportsMouseCapture=function(){var e=document.createElement("div");return t.isFunction(e.setCapture)&&t.isFunction(e.releaseCapture)}(),t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",t.MouseTracker.wheelEventName],"DOMMouseScroll"==t.MouseTracker.wheelEventName&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||t.Browser.vendor!==t.BROWSERS.IE)?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),t.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):(t.MouseTracker.havePointerEvents=!1,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?(t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),t.MouseTracker.haveMouseEnter=!0):(t.MouseTracker.subscribeEvents.push("mouseover","mouseout"),t.MouseTracker.haveMouseEnter=!1),t.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.maxTouchPoints=10),t.MouseTracker.GesturePointList=function(t){this._gPoints=[],this.type=t,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(t){return this._gPoints.push(t)},removeById:function(t){var e,i=this._gPoints.length;for(e=0;e<i;e++)if(this._gPoints[e].id===t){this._gPoints.splice(e,1);break}return this._gPoints.length},getByIndex:function(t){return t<this._gPoints.length?this._gPoints[t]:null},getById:function(t){var e,i=this._gPoints.length;for(e=0;e<i;e++)if(this._gPoints[e].id===t)return this._gPoints[e];return null},getPrimary:function(){var t,e=this._gPoints.length;for(t=0;t<e;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts<0&&(this.contacts=0)}};var mt=function(){try{return window.self!==window.top}catch(t){return!0}}()}(OpenSeadragon),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(e,i,n){var r=e.parentNode;"number"==typeof i&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer="undefined"==typeof i.attachToViewer||i.attachToViewer,this.autoFade="undefined"==typeof i.autoFade||i.autoFade,this.element=e,this.anchor=i.anchor,this.container=n,this.anchor==t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==t.ControlAnchor.TOP_RIGHT||this.anchor==t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):r.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor==t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[t.SIGNAL]&&t.Browser.vendor==t.BROWSERS.IE?t.setElementOpacity(this.element,e,!0):t.setElementOpacity(this.wrapper,e,!0)}}}(OpenSeadragon),function(t){function e(t,e){var i,n=t.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==e)return i;return-1}t.ControlDock=function(e){var i,n,r=["topleft","topright","bottomright","bottomleft"];for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(1e6*Math.random()),container:t.makeNeutralElement("div"),controls:[]},e),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<r.length;n++)i=r[n],this.controls[i]=t.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(i,n){i=t.getElement(i);var r=null;if(!(e(this,i)>=0)){switch(n.anchor){case t.ControlAnchor.TOP_RIGHT:r=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:r=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:r=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:r=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:r=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case t.ControlAnchor.NONE:r=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new t.Control(i,n,r)),i.style.display="inline-block"}},removeControl:function(i){i=t.getElement(i);var n=e(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var t;for(t=this.controls.length-1;t>=0;t--)if(this.controls[t].isVisible())return!0;return!1},setControlsEnabled:function(t){var e;for(e=this.controls.length-1;e>=0;e--)this.controls[e].setVisible(t);return this}}}(OpenSeadragon),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(t){function e(e){return e=t.getElement(e),new t.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function i(e,i,n,r,o){function s(t,e){t.ready?r(t):(t.addHandler("ready",function(){r(t)}),t.addHandler("open-failed",function(t){o({message:t.message,source:e})}))}var a=e;if("string"==t.type(i))if(i.match(/^\s*<.*>\s*$/))i=t.parseXml(i);else if(i.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var l=t.parseJSON(i);i=l}catch(t){}setTimeout(function(){if("string"==t.type(i))i=new t.TileSource({url:i,crossOriginPolicy:n.crossOriginPolicy!==undefined?n.crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,ajaxHeaders:e.ajaxHeaders,useCanvas:e.useCanvas,success:function(t){r(t.tileSource)}}),i.addHandler("open-failed",function(t){o(t)});else if(t.isPlainObject(i)||i.nodeType)if(i.crossOriginPolicy!==undefined||n.crossOriginPolicy===undefined&&e.crossOriginPolicy===undefined||(i.crossOriginPolicy=n.crossOriginPolicy!==undefined?n.crossOriginPolicy:e.crossOriginPolicy),i.ajaxWithCredentials===undefined&&(i.ajaxWithCredentials=e.ajaxWithCredentials),i.useCanvas===undefined&&(i.useCanvas=e.useCanvas),t.isFunction(i.getTileUrl)){var l=new t.TileSource(i);l.getTileUrl=i.getTileUrl,r(l)}else{var h=t.TileSource.determineType(a,i);if(!h)return void o({message:"Unable to load TileSource",source:i});var c=h.prototype.configure.apply(a,[i]);s(new h(c),i)}else s(i,i)})}function n(e,i){if(i instanceof t.Overlay)return i;var n=null;if(i.element)n=t.getElement(i.element);else{var r=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());n=t.getElement(i.id),n||(n=document.createElement("a"),n.href="#/overlay/"+r),n.id=r,t.addClass(n,i.className?i.className:"openseadragon-overlay")}var o=i.location,s=i.width,a=i.height;if(!o){var l=i.x,h=i.y;if(i.px!==undefined){var c=e.viewport.imageToViewportRectangle(new t.Rect(i.px,i.py,s||0,a||0));l=c.x,h=c.y,s=s!==undefined?c.width:undefined,a=a!==undefined?c.height:undefined}o=new t.Point(l,h)}var u=i.placement;return u&&"string"===t.type(u)&&(u=t.Placement[i.placement.toUpperCase()]),new t.Overlay({element:n,location:o,placement:u,onDraw:i.onDraw,checkResize:i.checkResize,width:s,height:a,rotationMode:i.rotationMode})}function r(t,e){var i;for(i=t.length-1;i>=0;i--)if(t[i].element===e)return i;return-1}function o(e,i){return t.requestAnimationFrame(function(){i(e)})}function s(e){t.requestAnimationFrame(function(){l(e)})}function a(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=t.now()+e.controlsFadeDelay,window.setTimeout(function(){s(e)},e.controlsFadeDelay))}function l(e){var i,n,r,o;if(e.controlsShouldFade){for(i=t.now(),n=i-e.controlsFadeBeginTime,r=1-n/e.controlsFadeLength,r=Math.min(1,r),r=Math.max(0,r),o=e.controls.length-1;o>=0;o--)e.controls[o].autoFade&&e.controls[o].setOpacity(r);r>0&&s(e)}}function h(t){var e;for(t.controlsShouldFade=!1,e=t.controls.length-1;e>=0;e--)t.controls[e].setOpacity(1)}function c(){h(this)}function u(){a(this)}function d(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints(),!1;case 40:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints(),!1;case 37:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints(),!1;case 39:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function f(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints(),!1;case 115:case 83:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints(),!1;case 97:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints(),!1;case 100:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function p(t){var e;document.activeElement==this.canvas||this.canvas.focus();var i={tracker:t.eventSource,position:t.position,quick:t.quick,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&t.quick&&(e=this.gestureSettingsByDeviceType(t.pointerType),e.clickToZoom&&(this.viewport.zoomBy(t.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(t.position,!0)),this.viewport.applyConstraints()))}function g(t){var e;!t.preventDefaultAction&&this.viewport&&(e=this.gestureSettingsByDeviceType(t.pointerType),e.dblClickToZoom&&(this.viewport.zoomBy(t.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(t.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-double-click",{tracker:t.eventSource,position:t.position,shift:t.shift,originalEvent:t.originalEvent})}function m(t){var e,i={tracker:t.eventSource,position:t.position,delta:t.delta,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};if(this.raiseEvent("canvas-drag",i),!t.preventDefaultAction&&this.viewport){if(e=this.gestureSettingsByDeviceType(t.pointerType),this.panHorizontal||(t.delta.x=0),this.panVertical||(t.delta.y=0),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(t.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var r=this.viewport.getBounds(),o=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,r.x!=o.x&&(t.delta.x=0),r.y!=o.y&&(t.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(t.delta.negate()),e.flickEnabled&&!this.constrainDuringPan)}}function v(e){if(!e.preventDefaultAction&&this.viewport){var i=this.gestureSettingsByDeviceType(e.pointerType);if(i.flickEnabled&&e.speed>=i.flickMinSpeed){var n=0;this.panHorizontal&&(n=i.flickMomentum*e.speed*Math.cos(e.direction));var r=0;this.panVertical&&(r=i.flickMomentum*e.speed*Math.sin(e.direction));var o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),s=this.viewport.pointFromPixel(new t.Point(o.x-n,o.y-r));this.viewport.panTo(s,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:e.eventSource,position:e.position,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent})}function y(t){this.raiseEvent("canvas-enter",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function b(e){
window.location!=window.parent.location&&t.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function _(t){this.raiseEvent("canvas-press",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,insideElementPressed:t.insideElementPressed,insideElementReleased:t.insideElementReleased,originalEvent:t.originalEvent})}function w(t){this.raiseEvent("canvas-release",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,insideElementPressed:t.insideElementPressed,insideElementReleased:t.insideElementReleased,originalEvent:t.originalEvent})}function x(t){this.raiseEvent("canvas-nonprimary-press",{tracker:t.eventSource,position:t.position,pointerType:t.pointerType,button:t.button,buttons:t.buttons,originalEvent:t.originalEvent})}function C(t){this.raiseEvent("canvas-nonprimary-release",{tracker:t.eventSource,position:t.position,pointerType:t.pointerType,button:t.button,buttons:t.buttons,originalEvent:t.originalEvent})}function S(t){var e,i,n,r;if(!t.preventDefaultAction&&this.viewport&&(e=this.gestureSettingsByDeviceType(t.pointerType),e.pinchToZoom&&(i=this.viewport.pointFromPixel(t.center,!0),n=this.viewport.pointFromPixel(t.lastCenter,!0),r=n.minus(i),this.panHorizontal||(r.x=0),this.panVertical||(r.y=0),this.viewport.zoomBy(t.distance/t.lastDistance,i,!0),this.viewport.panBy(r,!0),this.viewport.applyConstraints()),e.pinchRotate)){var o=Math.atan2(t.gesturePoints[0].currentPos.y-t.gesturePoints[1].currentPos.y,t.gesturePoints[0].currentPos.x-t.gesturePoints[1].currentPos.x),s=Math.atan2(t.gesturePoints[0].lastPos.y-t.gesturePoints[1].lastPos.y,t.gesturePoints[0].lastPos.x-t.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(o-s)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:t.eventSource,gesturePoints:t.gesturePoints,lastCenter:t.lastCenter,center:t.center,lastDistance:t.lastDistance,distance:t.distance,shift:t.shift,originalEvent:t.originalEvent}),!1}function T(e){var i,n,r;if(r=t.now(),r-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=r,!e.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(e.pointerType),i.scrollToZoom&&(n=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(n,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),i&&i.scrollToZoom)return!1}else if((i=this.gestureSettingsByDeviceType(e.pointerType))&&i.scrollToZoom)return!1}function k(t){V[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:t.eventSource,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function E(t){t.pointers<1&&(V[this.hash].mouseInside=!1,V[this.hash].animating||a(this)),this.raiseEvent("container-exit",{tracker:t.eventSource,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function P(t){D(t),t.isOpen()?t._updateRequestId=o(t,P):t._updateRequestId=!1}function D(t){if(!t._opening){if(t.autoResize){var i=e(t.container),n=V[t.hash].prevContainerSize;if(!i.equals(n)){var r=t.viewport;if(t.preserveImageSizeOnResize){var o=n.x/i.x,s=r.getZoom()*o,l=r.getCenter();r.resize(i,!1),r.zoomTo(s,null,!0),r.panTo(l,!0)}else{var c=r.getBounds();r.resize(i,!0),r.fitBoundsWithConstraints(c,!0)}V[t.hash].prevContainerSize=i,V[t.hash].forceRedraw=!0}}var u=t.viewport.update(),d=t.world.update()||u;u&&t.raiseEvent("viewport-change"),t.referenceStrip&&(d=t.referenceStrip.update(t.viewport)||d),!V[t.hash].animating&&d&&(t.raiseEvent("animation-start"),h(t)),(d||V[t.hash].forceRedraw||t.world.needsDraw())&&(I(t),t._drawOverlays(),t.navigator&&t.navigator.update(t.viewport),V[t.hash].forceRedraw=!1,d&&t.raiseEvent("animation")),V[t.hash].animating&&!d&&(t.raiseEvent("animation-finish"),V[t.hash].mouseInside||a(t)),V[t.hash].animating=d}}function I(t){t.imageLoader.clear(),t.drawer.clear(),t.world.draw(),t.raiseEvent("update-viewport",{})}function N(t,e){return t?t+e:e}function M(){V[this.hash].lastZoomTime=t.now(),V[this.hash].zoomFactor=this.zoomPerSecond,V[this.hash].zooming=!0,R(this)}function L(){V[this.hash].lastZoomTime=t.now(),V[this.hash].zoomFactor=1/this.zoomPerSecond,V[this.hash].zooming=!0,R(this)}function A(){V[this.hash].zooming=!1}function R(e){t.requestAnimationFrame(t.delegate(e,O))}function O(){var e,i,n;V[this.hash].zooming&&this.viewport&&(e=t.now(),i=e-V[this.hash].lastZoomTime,n=Math.pow(V[this.hash].zoomFactor,i/1e3),this.viewport.zoomBy(n),this.viewport.applyConstraints(),V[this.hash].lastZoomTime=e,R(this))}function z(){this.viewport&&(V[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function H(){this.viewport&&(V[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function F(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function B(){this.viewport&&this.viewport.goHome()}function $(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function j(){if(this.viewport){var t=this.viewport.getRotation();0===t?t=270:t-=90,this.viewport.setRotation(t)}}function W(){if(this.viewport){var t=this.viewport.getRotation();270===t?t=0:t+=90,this.viewport.setRotation(t)}}function q(){var t=this._sequenceIndex-1;this.navPrevNextWrap&&t<0&&(t+=this.tileSources.length),this.goToPage(t)}function U(){var t=this._sequenceIndex+1;this.navPrevNextWrap&&t>=this.tileSources.length&&(t=0),this.goToPage(t)}var V={},G=1;t.Viewer=function(i){var n,r=arguments,s=this;if(t.isPlainObject(i)||(i={id:r[0],xmlPath:r.length>1?r[1]:undefined,prefixUrl:r.length>2?r[2]:undefined,controls:r.length>3?r[3]:undefined,overlays:r.length>4?r[4]:undefined}),i.config&&(t.extend(!0,i,i.config),delete i.config),t.extend(!0,this,{id:i.id,hash:i.hash||G++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},t.DEFAULT_SETTINGS,i),"undefined"==typeof this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for("undefined"!=typeof V[this.hash]&&t.console.warn("Hash "+this.hash+" has already been used."),V[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(e){var i=t.getString("Errors.OpenFailed",e.eventSource,e.message);s._showMessage(i)}),t.ControlDock.call(this,i),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(t){t.width="100%",t.height="100%",t.overflow="hidden",t.position="absolute",t.top="0px",t.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),""!==i.tabIndex&&(this.canvas.tabIndex=i.tabIndex===undefined?0:i.tabIndex),this.container.className="openseadragon-container",function(t){t.width="100%",t.height="100%",t.position="relative",t.overflow="hidden",t.left="0px",t.top="0px",t.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:t.delegate(this,d),keyHandler:t.delegate(this,f),clickHandler:t.delegate(this,p),dblClickHandler:t.delegate(this,g),dragHandler:t.delegate(this,m),dragEndHandler:t.delegate(this,v),enterHandler:t.delegate(this,y),exitHandler:t.delegate(this,b),pressHandler:t.delegate(this,_),releaseHandler:t.delegate(this,w),nonPrimaryPressHandler:t.delegate(this,x),nonPrimaryReleaseHandler:t.delegate(this,C),scrollHandler:t.delegate(this,T),pinchHandler:t.delegate(this,S)}),this.outerTracker=new t.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,k),exitHandler:t.delegate(this,E)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),V[this.hash].prevContainerSize=e(this.container),this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(){s.source=s.world.getItemAt(0).source,V[s.hash].forceRedraw=!0,s._updateRequestId||(s._updateRequestId=o(s,P))}),this.world.addHandler("remove-item",function(){s.world.getItemCount()?s.source=s.world.getItemAt(0).source:s.source=null,V[s.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(){s.viewport&&s.viewport._setContentBounds(s.world.getHomeBounds(),s.world.getContentFactor())}),this.world.addHandler("item-index-change",function(){s.source=s.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:V[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:i.timeout}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(n=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(n,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(n=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(n,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new t.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),n=0;n<this.customControls.length;n++)this.addControl(this.customControls[n].id,{anchor:this.customControls[n].anchor});t.requestAnimationFrame(function(){a(s)})},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(e){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(e)},openTileSource:function(e){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(e)},open:function(e,i){var r=this;if(this.close(),e){if(this.sequenceMode&&t.isArray(e))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===i||isNaN(i)||(this.initialPage=i),this.tileSources=e,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(t.isArray(e)||(e=[e]),e.length){this._opening=!0;for(var o,s=e.length,a=0,l=0,h=function(){if(a+l===s)if(a){!r._firstOpen&&r.preserveViewport||(r.viewport.goHome(!0),r.viewport.update()),r._firstOpen=!1;var t=e[0];if(t.tileSource&&(t=t.tileSource),r.overlays&&!r.preserveOverlays)for(var i=0;i<r.overlays.length;i++)r.currentOverlays[i]=n(r,r.overlays[i]);r._drawOverlays(),r._opening=!1,r.raiseEvent("open",{source:t})}else r._opening=!1,r.raiseEvent("open-failed",o)},c=function(e){t.isPlainObject(e)&&e.tileSource||(e={tileSource:e}),e.index!==undefined&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete e.index),e.collectionImmediately===undefined&&(e.collectionImmediately=!0);var i=e.success;e.success=function(t){if(a++,e.tileSource.overlays)for(var n=0;n<e.tileSource.overlays.length;n++)r.addOverlay(e.tileSource.overlays[n]);i&&i(t),h()};var n=e.error;e.error=function(t){l++,o||(o=t),n&&n(t),h()},r.addTiledImage(e)},u=0;u<e.length;u++)c(e[u]);return this}}},close:function(){return V[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),V[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(V[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),V[this.hash]=null,delete V[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(t){return this.innerTracker.setTracking(t),this.outerTracker.setTracking(t),this.raiseEvent("mouse-enabled",{enabled:t}),this},areControlsEnabled:function(){var t,e=this.controls.length;for(t=0;t<this.controls.length;t++)e=e&&this.controls[t].isVisibile();return e},setControlsEnabled:function(t){return t?h(this):a(this),this.raiseEvent("controls-enabled",{enabled:t}),this},setDebugMode:function(t){for(var e=0;e<this.world.getItemCount();e++)this.world.getItemAt(e).debugMode=t;this.debugMode=t,this.forceRedraw()},isFullPage:function(){return V[this.hash].fullPage},setFullPage:function(e){var i,n,r=document.body,o=r.style,s=document.documentElement.style,a=this;if(e==this.isFullPage())return this;var l={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",l),l.preventDefaultAction)return this;if(e){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=s.margin,o.margin="0",s.margin="0",this.bodyPadding=o.padding,this.docPadding=s.padding,o.padding="0",s.padding="0",this.bodyWidth=o.width,this.docWidth=s.width,o.width="100%",s.width="100%",this.bodyHeight=o.height,this.docHeight=s.height,o.height="100%",s.height="100%",this.previousBody=[],V[this.hash].prevElementParent=this.element.parentNode,V[this.hash].prevNextSibling=this.element.nextSibling,V[this.hash].prevElementWidth=this.element.style.width,V[this.hash].prevElementHeight=this.element.style.height,i=r.childNodes.length,n=0;n<i;n++)this.previousBody.push(r.childNodes[0]),r.removeChild(r.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,r.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),r.appendChild(this.element),this.element.style.height=t.getWindowSize().y+"px",this.element.style.width=t.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),V[this.hash].fullPage=!0,t.delegate(this,k)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,s.margin=this.docMargin,o.padding=this.bodyPadding,s.padding=this.docPadding,o.width=this.bodyWidth,s.width=this.docWidth,o.height=this.bodyHeight,s.height=this.docHeight,r.removeChild(this.element),i=this.previousBody.length,n=0;n<i;n++)r.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),V[this.hash].prevElementParent.insertBefore(this.element,V[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(r.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=V[this.hash].prevElementWidth,this.element.style.height=V[this.hash].prevElementHeight;var h=0,c=function(){t.setPageScroll(a.pageScroll);var e=t.getPageScroll();++h<10&&(e.x!==a.pageScroll.x||e.y!==a.pageScroll.y)&&t.requestAnimationFrame(c)};t.requestAnimationFrame(c),V[this.hash].fullPage=!1,t.delegate(this,E)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e}),this},setFullScreen:function(e){var i=this;if(!t.supportsFullScreen)return this.setFullPage(e);if(t.isFullScreen()===e)return this;var n={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var r=function(){var e=t.isFullScreen();e||(t.removeEvent(document,t.fullScreenEventName,r),t.removeEvent(document,t.fullScreenErrorEventName,r),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&i.navigator.update(i.viewport),i.raiseEvent("full-screen",{fullScreen:e})};t.addEvent(document,t.fullScreenEventName,r),t.addEvent(document,t.fullScreenErrorEventName,r),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(t){return this.container.style.visibility=t?"":"hidden",this.raiseEvent("visible",{visible:t}),this},addTiledImage:function(e){function n(t){for(var i=0;i<s._loadQueue.length;i++)if(s._loadQueue[i]===a){s._loadQueue.splice(i,1);break}0===s._loadQueue.length&&r(a),s.raiseEvent("add-item-failed",t),e.error&&e.error(t)}function r(t){s.collectionMode&&(s.world.arrange({immediately:t.options.collectionImmediately,rows:s.collectionRows,columns:s.collectionColumns,layout:s.collectionLayout,tileSize:s.collectionTileSize,tileMargin:s.collectionTileMargin}),s.world.setAutoRefigureSizes(!0))}function o(){for(var e,i,n;s._loadQueue.length&&(e=s._loadQueue[0],e.tileSource);){if(s._loadQueue.splice(0,1),e.options.replace){var o=s.world.getIndexOfItem(e.options.replaceItem);-1!=o&&(e.options.index=o),s.world.removeItem(e.options.replaceItem)}i=new t.TiledImage({viewer:s,source:e.tileSource,viewport:s.viewport,drawer:s.drawer,tileCache:s.tileCache,imageLoader:s.imageLoader,x:e.options.x,y:e.options.y,width:e.options.width,height:e.options.height,fitBounds:e.options.fitBounds,fitBoundsPlacement:e.options.fitBoundsPlacement,clip:e.options.clip,placeholderFillStyle:e.options.placeholderFillStyle,opacity:e.options.opacity,preload:e.options.preload,degrees:e.options.degrees,compositeOperation:e.options.compositeOperation,springStiffness:s.springStiffness,animationTime:s.animationTime,minZoomImageRatio:s.minZoomImageRatio,wrapHorizontal:s.wrapHorizontal,wrapVertical:s.wrapVertical,immediateRender:s.immediateRender,blendTime:s.blendTime,alwaysBlend:s.alwaysBlend,minPixelRatio:s.minPixelRatio,smoothTileEdgesMinZoom:s.smoothTileEdgesMinZoom,iOSDevice:s.iOSDevice,crossOriginPolicy:e.options.crossOriginPolicy,ajaxWithCredentials:e.options.ajaxWithCredentials,loadTilesWithAjax:e.options.loadTilesWithAjax,ajaxHeaders:e.options.ajaxHeaders,debugMode:s.debugMode}),s.collectionMode&&s.world.setAutoRefigureSizes(!1),s.world.addItem(i,{index:e.options.index}),0===s._loadQueue.length&&r(e),1!==s.world.getItemCount()||s.preserveViewport||s.viewport.goHome(!0),s.navigator&&(n=t.extend({},e.options,{replace:!1,originalTiledImage:i,tileSource:e.tileSource}),s.navigator.addTiledImage(n)),e.options.success&&e.options.success({item:i})}}t.console.assert(e,"[Viewer.addTiledImage] options is required"),t.console.assert(e.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!e.replace||e.index>-1&&e.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var s=this;e.replace&&(e.replaceItem=s.world.getItemAt(e.index)),this._hideMessage(),e.placeholderFillStyle===undefined&&(e.placeholderFillStyle=this.placeholderFillStyle),e.opacity===undefined&&(e.opacity=this.opacity),e.preload===undefined&&(e.preload=this.preload),e.compositeOperation===undefined&&(e.compositeOperation=this.compositeOperation),e.crossOriginPolicy===undefined&&(e.crossOriginPolicy=e.tileSource.crossOriginPolicy!==undefined?e.tileSource.crossOriginPolicy:this.crossOriginPolicy),e.ajaxWithCredentials===undefined&&(e.ajaxWithCredentials=this.ajaxWithCredentials),e.loadTilesWithAjax===undefined&&(e.loadTilesWithAjax=this.loadTilesWithAjax),e.ajaxHeaders===undefined||null===e.ajaxHeaders?e.ajaxHeaders=this.ajaxHeaders:t.isPlainObject(e.ajaxHeaders)&&t.isPlainObject(this.ajaxHeaders)&&(e.ajaxHeaders=t.extend({},this.ajaxHeaders,e.ajaxHeaders));var a={options:e};if(t.isArray(e.tileSource))return void setTimeout(function(){n({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:e.tileSource,options:e})});this._loadQueue.push(a),i(this,e.tileSource,e,function(t){a.tileSource=t,o()},function(t){t.options=e,n(t),o()})},addSimpleImage:function(e){t.console.assert(e,"[Viewer.addSimpleImage] options is required"),t.console.assert(e.url,"[Viewer.addSimpleImage] options.url is required");var i=t.extend({},e,{tileSource:{type:"image",url:e.url}});delete i.url,this.addTiledImage(i)},addLayer:function(e){var i=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var n=t.extend({},e,{success:function(t){i.raiseEvent("add-layer",{options:e,drawer:t.item})},error:function(t){i.raiseEvent("add-layer-failed",t)}});return this.addTiledImage(n),this},getLayerAtLevel:function(e){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(e)},getLevelOfLayer:function(e){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(e)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(e,i){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(e,i)},removeLayer:function(e){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(e)},forceRedraw:function(){return V[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var e=t.delegate(this,c),i=t.delegate(this,u),n=t.delegate(this,U),r=t.delegate(this,q),o=this.navImages,s=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(s=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:N(this.prefixUrl,o.previous.REST),srcGroup:N(this.prefixUrl,o.previous.GROUP),srcHover:N(this.prefixUrl,o.previous.HOVER),srcDown:N(this.prefixUrl,o.previous.DOWN),onRelease:r,onFocus:e,onBlur:i}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:N(this.prefixUrl,o.next.REST),srcGroup:N(this.prefixUrl,o.next.GROUP),srcHover:N(this.prefixUrl,o.next.HOVER),srcDown:N(this.prefixUrl,o.next.DOWN),onRelease:n,onFocus:e,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),s&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=t.delegate(this,M),i=t.delegate(this,A),n=t.delegate(this,z),r=t.delegate(this,L),o=t.delegate(this,H),s=t.delegate(this,B),a=t.delegate(this,$),l=t.delegate(this,j),h=t.delegate(this,W),d=t.delegate(this,c),f=t.delegate(this,u),p=this.navImages,g=[],m=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(m=!1),this.showZoomControl&&(g.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:N(this.prefixUrl,p.zoomIn.REST),srcGroup:N(this.prefixUrl,p.zoomIn.GROUP),srcHover:N(this.prefixUrl,p.zoomIn.HOVER),srcDown:N(this.prefixUrl,p.zoomIn.DOWN),onPress:e,onRelease:i,onClick:n,onEnter:e,onExit:i,onFocus:d,onBlur:f})),g.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:N(this.prefixUrl,p.zoomOut.REST),srcGroup:N(this.prefixUrl,p.zoomOut.GROUP),srcHover:N(this.prefixUrl,p.zoomOut.HOVER),srcDown:N(this.prefixUrl,p.zoomOut.DOWN),onPress:r,onRelease:i,onClick:o,onEnter:r,onExit:i,onFocus:d,onBlur:f}))),this.showHomeControl&&g.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:N(this.prefixUrl,p.home.REST),srcGroup:N(this.prefixUrl,p.home.GROUP),srcHover:N(this.prefixUrl,p.home.HOVER),srcDown:N(this.prefixUrl,p.home.DOWN),onRelease:s,onFocus:d,onBlur:f})),this.showFullPageControl&&g.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:N(this.prefixUrl,p.fullpage.REST),srcGroup:N(this.prefixUrl,p.fullpage.GROUP),srcHover:N(this.prefixUrl,p.fullpage.HOVER),srcDown:N(this.prefixUrl,p.fullpage.DOWN),onRelease:a,onFocus:d,onBlur:f})),this.showRotationControl&&(g.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:N(this.prefixUrl,p.rotateleft.REST),srcGroup:N(this.prefixUrl,p.rotateleft.GROUP),srcHover:N(this.prefixUrl,p.rotateleft.HOVER),srcDown:N(this.prefixUrl,p.rotateleft.DOWN),onRelease:l,onFocus:d,onBlur:f})),g.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:N(this.prefixUrl,p.rotateright.REST),srcGroup:N(this.prefixUrl,p.rotateright.GROUP),srcHover:N(this.prefixUrl,p.rotateright.HOVER),srcDown:N(this.prefixUrl,p.rotateright.DOWN),onRelease:h,onFocus:d,onBlur:f}))),m&&(this.buttons=new t.ButtonGroup({buttons:g,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",t.delegate(this,F)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(t){return this.tileSources&&t>=0&&t<this.tileSources.length&&(this.raiseEvent("page",{page:t}),this._sequenceIndex=t,this._updateSequenceButtons(t),this.open(this.tileSources[t]),this.referenceStrip&&this.referenceStrip.setFocus(t)),this},addOverlay:function(e,i,o,s){var a;if(a=t.isPlainObject(e)?e:{element:e,location:i,placement:o,onDraw:s},e=t.getElement(a.element),r(this.currentOverlays,e)>=0)return this;var l=n(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:e,location:a.location,placement:a.placement}),this},updateOverlay:function(e,i,n){var o;return e=t.getElement(e),o=r(this.currentOverlays,e),o>=0&&(this.currentOverlays[o].update(i,n),V[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:i,placement:n})),this},removeOverlay:function(e){var i;return e=t.getElement(e),i=r(this.currentOverlays,e),i>=0&&(this.currentOverlays[i].destroy(),this.currentOverlays.splice(i,1),V[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return V[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(e){var i;return e=t.getElement(e),i=r(this.currentOverlays,e),i>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(t){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==t?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(t>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var i=t.makeNeutralElement("div");i.appendChild(document.createTextNode(e)),this.messageDiv=t.makeCenteredNode(i),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var t=this.messageDiv;t&&(t.parentNode.removeChild(t),delete this.messageDiv)},gestureSettingsByDeviceType:function(t){switch(t){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":
return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var t,e=this.currentOverlays.length;for(t=0;t<e;t++)this.currentOverlays[t].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(t){function e(t){t.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(t.position)),this.viewer.viewport.applyConstraints())}function i(t){this.viewer.viewport&&(this.panHorizontal||(t.delta.x=0),this.panVertical||(t.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(t.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(t){t.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function r(t){return this.viewer.raiseEvent("navigator-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),!1}function o(t,e){t.style.webkitTransform="rotate("+e+"deg)",t.style.mozTransform="rotate("+e+"deg)",t.style.msTransform="rotate("+e+"deg)",t.style.oTransform="rotate("+e+"deg)",t.style.transform="rotate("+e+"deg)"}t.Navigator=function(s){function a(t){o(u.displayRegionContainer,t),o(u.displayRegion,-t),u.viewport.setRotation(t)}var l,h,c=s.viewer,u=this;if(s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),s.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:s.autoFade},s.position&&("BOTTOM_RIGHT"==s.position?s.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==s.position?s.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==s.position?s.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==s.position?s.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:"ABSOLUTE"==s.position&&(s.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",s=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize,minZoomImageRatio:1}),s.minPixelRatio=this.minPixelRatio=c.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),s.controlOptions.anchor!=t.ControlAnchor.NONE&&function(t,e){t.margin="0px",t.border=e+"px solid #555",t.padding="0px",t.background="#000",t.opacity=.8,t.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(t,e){t.position="relative",t.top="0px",t.left="0px",t.fontSize="0px",t.overflow="hidden",t.border=e+"px solid #900",t.margin="0px",t.padding="0px",t.background="transparent",t["float"]="left",t.cssFloat="left",t.styleFloat="left",t.zIndex=999999999,t.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",c.addControl(this.element,s.controlOptions),this._resizeWithViewer=s.controlOptions.anchor!=t.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!=t.ControlAnchor.NONE,this._resizeWithViewer&&(s.width&&s.height?(this.element.style.height="number"==typeof s.height?s.height+"px":s.height,this.element.style.width="number"==typeof s.width?s.width+"px":s.width):(l=t.getElementSize(c.element),this.element.style.height=Math.round(l.y*s.sizeRatio)+"px",this.element.style.width=Math.round(l.x*s.sizeRatio)+"px",this.oldViewerSize=l),h=t.getElementSize(this.element),this.elementArea=h.x*h.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),s.navigatorRotate){a(s.viewer.viewport?s.viewer.viewport.getRotation():s.viewer.degrees||0),s.viewer.addHandler("rotate",function(t){a(t.degrees)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,i),clickHandler:t.delegate(this,e),releaseHandler:t.delegate(this,n),scrollHandler:t.delegate(this,r)}),this.addHandler("reset-size",function(){u.viewport&&u.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(t){window.setTimeout(function(){var e=u.world.getItemAt(t.previousIndex);u.world.setItemIndex(e,t.newIndex)},1)}),c.world.addHandler("remove-item",function(t){var e=t.item,i=u._getMatchingItem(e);i&&u.world.removeItem(i)}),this.update(c.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var e=new t.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);e.equals(this.oldContainerSize)||(this.viewport.resize(e,!0),this.viewport.goHome(!0),this.oldContainerSize=e,this.drawer.clear(),this.world.draw())}},update:function(e){var i,n,r,o,s,a;if(i=t.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(n=i.x*this.sizeRatio,r=i.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(i.x/i.y)),r=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(r)+"px",this.elementArea||(this.elementArea=n*r),this.updateSize()),e&&this.viewport){o=e.getBoundsNoRotate(!0),s=this.viewport.pixelFromPointNoRotate(o.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(o.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(s.y)+"px",l.left=Math.round(s.x)+"px";var h=Math.abs(s.x-a.x),c=Math.abs(s.y-a.y);l.width=Math.round(Math.max(h,0))+"px",l.height=Math.round(Math.max(c,0))+"px"}},addTiledImage:function(e){var i=this,n=e.originalTiledImage;delete e.original;var r=t.extend({},e,{success:function(t){function e(){i._matchBounds(s,n)}function r(){i._matchOpacity(s,n)}function o(){i._matchCompositeOperation(s,n)}var s=t.item;s._originalForNavigator=n,i._matchBounds(s,n,!0),n.addHandler("bounds-change",e),n.addHandler("clip-change",e),n.addHandler("opacity-change",r),n.addHandler("composite-operation-change",o)}});return t.Viewer.prototype.addTiledImage.apply(this,[r])},_getMatchingItem:function(t){for(var e,i=this.world.getItemCount(),n=0;n<i;n++)if(e=this.world.getItemAt(n),e._originalForNavigator===t)return e;return null},_matchBounds:function(t,e,i){var n=e.getBoundsNoRotate();t.setPosition(n.getTopLeft(),i),t.setWidth(n.width,i),t.setRotation(e.getRotation(),i),t.setClip(e.getClip())},_matchOpacity:function(t,e){t.setOpacity(e.opacity)},_matchCompositeOperation:function(t,e){t.setCompositeOperation(e.compositeOperation)}})}(OpenSeadragon),function(t){var e={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};t.extend(t,{getString:function(i){var n,r=i.split("."),o=null,s=arguments,a=e;for(n=0;n<r.length-1;n++)a=a[r[n]]||{};return o=a[r[n]],"string"!=typeof o&&(t.console.log("Untranslated source string:",i),o=""),o.replace(/\{\d+\}/g,function(t){var e=parseInt(t.match(/\d+/),10)+1;return e<s.length?s[e]:""})},setString:function(t,i){var n,r=t.split("."),o=e;for(n=0;n<r.length-1;n++)o[r[n]]||(o[r[n]]={}),o=o[r[n]];o[r[n]]=i}})}(OpenSeadragon),function(t){t.Point=function(t,e){this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(e){return new t.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new t.Point(this.x-e.x,this.y-e.y)},times:function(e){return new t.Point(this.x*e,this.y*e)},divide:function(e){return new t.Point(this.x/e,this.y/e)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},squaredDistanceTo:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},apply:function(e){return new t.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof t.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,i){i=i||new t.Point(0,0);var n,r;if(e%90==0){switch(t.positiveModulo(e,360)){case 0:n=1,r=0;break;case 90:n=0,r=1;break;case 180:n=-1,r=0;break;case 270:n=0,r=-1}}else{var o=e*Math.PI/180;n=Math.cos(o),r=Math.sin(o)}var s=n*(this.x-i.x)-r*(this.y-i.y)+i.x,a=r*(this.x-i.x)+n*(this.y-i.y)+i.y;return new t.Point(s,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(t){function e(e){var i,n,r=e.responseText,o=e.status;if(!e)throw new Error(t.getString("Errors.Security"));if(200!==e.status&&0!==e.status)throw o=e.status,i=404==o?"Not Found":e.statusText,new Error(t.getString("Errors.Status",o,i));if(r.match(/\s*<.*/))try{n=e.responseXML&&e.responseXML.documentElement?e.responseXML:t.parseXml(r)}catch(t){n=e.responseText}else if(r.match(/\s*[\{\[].*/))try{n=t.parseJSON(r)}catch(t){n=r}else n=r;return n}t.TileSource=function(e){var i,n,r=this,o=arguments;if(i=t.isPlainObject(e)?e:{width:o[0],height:o[1],tileSize:o[2],tileOverlap:o[3],minLevel:o[4],maxLevel:o[5]},t.EventSource.call(this),t.extend(!0,this,i),!this.success)for(n=0;n<arguments.length;n++)if(t.isFunction(arguments[n])){this.success=arguments[n];break}this.success&&this.addHandler("ready",function(t){r.success(t)}),"string"==t.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=i.width&&i.height?i.width/i.height:1,this.dimensions=new t.Point(i.width,i.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=i.tileOverlap?i.tileOverlap:0,this.minLevel=i.minLevel?i.minLevel:0,this.maxLevel=undefined!==i.maxLevel&&null!==i.maxLevel?i.maxLevel:i.width&&i.height?Math.ceil(Math.log(Math.max(i.width,i.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(){return t.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(t){return this._tileWidth?this._tileWidth:this.getTileSize(t)},getTileHeight:function(t){return this._tileHeight?this._tileHeight:this.getTileSize(t)},getLevelScale:function(t){var e,i={};for(e=0;e<=this.maxLevel;e++)i[e]=1/Math.pow(2,this.maxLevel-e);return this.getLevelScale=function(t){return i[t]},this.getLevelScale(t)},getNumTiles:function(e){var i=this.getLevelScale(e),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(e)),r=Math.ceil(i*this.dimensions.y/this.getTileHeight(e));return new t.Point(n,r)},getPixelRatio:function(e){var i=this.dimensions.times(this.getLevelScale(e)),n=1/i.x,r=1/i.y;return new t.Point(n,r)},getClosestLevel:function(){var t,e;for(t=this.minLevel+1;t<=this.maxLevel&&(e=this.getNumTiles(t),!(e.x>1||e.y>1));t++);return t-1},getTileAtPoint:function(e,i){var n=i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1/this.aspectRatio;t.console.assert(n,"[TileSource.getTileAtPoint] must be called with a valid point.");var r=this.dimensions.x*this.getLevelScale(e),o=i.x*r,s=i.y*r,a=Math.floor(o/this.getTileWidth(e)),l=Math.floor(s/this.getTileHeight(e));return i.x>=1&&(a=this.getNumTiles(e).x-1),i.y>=1/this.aspectRatio&&(l=this.getNumTiles(e).y-1),new t.Point(a,l)},getTileBounds:function(e,i,n){var r=this.dimensions.times(this.getLevelScale(e)),o=this.getTileWidth(e),s=this.getTileHeight(e),a=0===i?0:o*i-this.tileOverlap,l=0===n?0:s*n-this.tileOverlap,h=o+(0===i?1:2)*this.tileOverlap,c=s+(0===n?1:2)*this.tileOverlap,u=1/r.x;return h=Math.min(h,r.x-a),c=Math.min(c,r.y-l),new t.Rect(a*u,l*u,h*u,c*u)},getImageInfo:function(i){var n,r,o,s,a,l,h,c=this;i&&(a=i.split("/"),l=a[a.length-1],(h=l.lastIndexOf("."))>-1&&(a[a.length-1]=l.slice(0,h))),r=function(e){"string"==typeof e&&(e=t.parseXml(e));var n=t.TileSource.determineType(c,e,i);if(!n)return void c.raiseEvent("open-failed",{message:"Unable to load TileSource",source:i});s=n.prototype.configure.apply(c,[e,i]),s.ajaxWithCredentials===undefined&&(s.ajaxWithCredentials=c.ajaxWithCredentials),o=new n(s),c.ready=!0,c.raiseEvent("ready",{tileSource:o})},i.match(/\.js$/)?(n=i.split("/").pop().replace(".js",""),t.jsonp({url:i,async:!1,callbackName:n,callback:r})):t.makeAjaxRequest({url:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var i=e(t);r(i)},error:function(t,e){var n;try{n="HTTP "+t.status+" attempting to load TileSource"}catch(t){var r;r=void 0!==e&&e.toString?e.toString():"Unknown error",n=r+" attempting to load TileSource"}c.raiseEvent("open-failed",{message:n,source:i})}})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(){return{}},tileExists:function(t,e,i){var n=this.getNumTiles(t);return t>=this.minLevel&&t<=this.maxLevel&&e>=0&&i>=0&&e<n.x&&i<n.y}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype),t.TileSource.determineType=function(e,i,n){var r;for(r in OpenSeadragon)if(r.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[r])&&t.isFunction(OpenSeadragon[r].prototype.supports)&&OpenSeadragon[r].prototype.supports.call(e,i,n))return OpenSeadragon[r];t.console.error("No TileSource was able to open %s %s",n,i)}}(OpenSeadragon),function(t){function e(e,n){if(!n||!n.documentElement)throw new Error(t.getString("Errors.Xml"));var r,o,s,a,l,h=n.documentElement,c=h.localName||h.tagName,u=n.documentElement.namespaceURI,d=null,f=[];if("Image"==c)try{if(a=h.getElementsByTagName("Size")[0],a===undefined&&(a=h.getElementsByTagNameNS(u,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!t.imageFormatSupported(d.Image.Format))throw new Error(t.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(r=h.getElementsByTagName("DisplayRect"),r===undefined&&(r=h.getElementsByTagNameNS(u,"DisplayRect")[0]),l=0;l<r.length;l++)o=r[l],s=o.getElementsByTagName("Rect")[0],s===undefined&&(s=o.getElementsByTagNameNS(u,"Rect")[0]),f.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(o.getAttribute("MinLevel"),10),MaxLevel:parseInt(o.getAttribute("MaxLevel"),10)}});return f.length&&(d.Image.DisplayRect=f),i(e,d)}catch(e){throw e instanceof Error?e:new Error(t.getString("Errors.Dzi"))}else{if("Collection"==c)throw new Error(t.getString("Errors.Dzc"));if("Error"==c){var p=h.getElementsByTagName("Message")[0],g=p.firstChild.nodeValue;throw new Error(g)}}throw new Error(t.getString("Errors.Dzi"))}function i(e,i){var n,r,o=i.Image,s=o.Url,a=o.Format,l=o.Size,h=o.DisplayRect||[],c=parseInt(l.Width,10),u=parseInt(l.Height,10),d=parseInt(o.TileSize,10),f=parseInt(o.Overlap,10),p=[];for(r=0;r<h.length;r++)n=h[r].Rect,p.push(new t.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return t.extend(!0,{width:c,height:u,tileSize:d,tileOverlap:f,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:a,displayRects:p},i)}t.DziTileSource=function(e){var i,n,r,o;if(o=t.isPlainObject(e)?e:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=o.tilesUrl,this.fileFormat=o.fileFormat,this.displayRects=o.displayRects,this.displayRects)for(i=this.displayRects.length-1;i>=0;i--)for(n=this.displayRects[i],r=n.minLevel;r<=n.maxLevel;r++)this._levelRects[r]||(this._levelRects[r]=[]),this._levelRects[r].push(n);t.TileSource.apply(this,[o])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(t){var e;return t.Image?e=t.Image.xmlns:t.documentElement&&("Image"!=t.documentElement.localName&&"Image"!=t.documentElement.tagName||(e=t.documentElement.namespaceURI)),e=(e||"").toLowerCase(),-1!==e.indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==e.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(n,r){var o;return o=t.isPlainObject(n)?i(this,n):e(this,n),r&&!o.tilesUrl&&(o.tilesUrl=r.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=r.search(/\.(dzi|xml|js)\?/)?o.queryParams=r.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(t,e,i){return[this.tilesUrl,t,"/",e,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(t,e,i){var n,r,o,s,a,l,h,c=this._levelRects[t];if(!c||!c.length)return!0;for(h=c.length-1;h>=0;h--)if(n=c[h],!(t<n.minLevel||t>n.maxLevel)&&(r=this.getLevelScale(t),o=n.x*r,s=n.y*r,a=o+n.width*r,l=s+n.height*r,o=Math.floor(o/this._tileWidth),s=Math.floor(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),o<=e&&e<a&&s<=i&&i<l))return!0;return!1}})}(OpenSeadragon),function(t){function e(t){return!(-1!=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(t[0]))||-1!=t.indexOf("sizeByW")}function i(t){for(var e=[],i=0;i<t.sizes.length;i++)e.push({url:t["@id"]+"/full/"+t.sizes[i].width+",/0/default.jpg",width:t.sizes[i].width,height:t.sizes[i].height});return e.sort(function(t,e){return t.width-e.width})}function n(e){if(!e||!e.documentElement)throw new Error(t.getString("Errors.Xml"));var i=e.documentElement,n=i.tagName,o=null;if("info"==n)try{return o={},r(i,o),o}catch(e){throw e instanceof Error?e:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function r(e,i,n){var o,s;if(3==e.nodeType&&n)s=e.nodeValue.trim(),s.match(/^\d*$/)&&(s=Number(s)),i[n]?(t.isArray(i[n])||(i[n]=[i[n]]),i[n].push(s)):i[n]=s;else if(1==e.nodeType)for(o=0;o<e.childNodes.length;o++)r(e.childNodes[o],i,e.nodeName)}t.IIIFTileSource=function(n){if(t.extend(!0,this,n),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(n.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var r=0;r<this.tiles.length;r++)for(var o=0;o<this.tiles[r].scaleFactors.length;o++){var s=this.tiles[r].scaleFactors[o];this.scale_factors.push(s),n.tileSizePerScaleFactor[s]={width:this.tiles[r].width,height:this.tiles[r].height||this.tiles[r].width}}}else if(e(n.profile)){for(var a=Math.min(this.height,this.width),l=[256,512,1024],h=[],c=0;c<l.length;c++)l[c]<=a&&h.push(l[c]);h.length>0?n.tileSize=Math.max.apply(null,h):n.tileSize=a}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,n.levels=i(this),t.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):t.console.error("Nothing in the info.json to construct image pyramids from");n.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?n.maxLevel=Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),.5)):n.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),t.TileSource.apply(this,[n])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(t){return!(!t.protocol||"http://iiif.io/api/image"!=t.protocol)||(!(!t["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=t["@context"]&&"http://iiif.io/api/image/1/context.json"!=t["@context"])||(!(!t.profile||0!==t.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(t.identifier&&t.width&&t.height)||!(!t.documentElement||"info"!=t.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=t.documentElement.namespaceURI))))},configure:function(e,i){if(t.isPlainObject(e))return e["@context"]?e:(e["@context"]="http://iiif.io/api/image/1.0/context.json",e["@id"]=i.replace("/info.json",""),e);var r=n(e);return r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=i.replace("/info.xml",""),r},getTileWidth:function(e){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,e);var i=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(e){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,e);var i=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(e){if(this.emulateLegacyImagePyramid){var i=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].width/this.levels[this.maxLevel].width),i}return t.TileSource.prototype.getLevelScale.call(this,e)},getNumTiles:function(e){if(this.emulateLegacyImagePyramid){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)}return t.TileSource.prototype.getNumTiles.call(this,e)},getTileAtPoint:function(e,i){return this.emulateLegacyImagePyramid?new t.Point(0,0):t.TileSource.prototype.getTileAtPoint.call(this,e,i)},getTileUrl:function(t,e,i){if(this.emulateLegacyImagePyramid){var n=null;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(n=this.levels[t].url),n}var r,o,s,a,l,h,c,u,d,f,p,g="0",m=Math.pow(.5,this.maxLevel-t),v=Math.ceil(this.width*m),y=Math.ceil(this.height*m);return r=this.getTileWidth(t),o=this.getTileHeight(t),s=Math.ceil(r/m),a=Math.ceil(o/m),p=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1?"native.jpg":"default.jpg",v<r&&y<o?(f=v+",",l="full"):(h=e*s,c=i*a,u=Math.min(s,this.width-h),d=Math.min(a,this.height-c),f=Math.ceil(u*m)+",",l=[h,c,u,d].join(",")),[this["@id"],l,f,g,p].join("/")}})}(OpenSeadragon),function(t){t.OsmTileSource=function(e){var i;i=t.isPlainObject(e)?e:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},i.width&&i.height||(i.width=65572864,i.height=65572864),i.tileSize||(i.tileSize=256,i.tileOverlap=0),i.tilesUrl||(i.tilesUrl="http://tile.openstreetmap.org/"),i.minLevel=8,t.TileSource.apply(this,[i])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"openstreetmaps"==t.type},configure:function(t){return t},getTileUrl:function(t,e,i){return this.tilesUrl+(t-8)+"/"+e+"/"+i+".png"}})}(OpenSeadragon),function(t){t.TmsTileSource=function(e){var i;i=t.isPlainObject(e)?e:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var n,r=256*Math.ceil(i.width/256),o=256*Math.ceil(i.height/256);n=r>o?r/256:o/256,i.maxLevel=Math.ceil(Math.log(n)/Math.log(2))-1,i.tileSize=256,i.width=r,i.height=o,t.TileSource.apply(this,[i])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"tiledmapservice"==t.type},configure:function(t){return t},getTileUrl:function(t,e,i){var n=this.getNumTiles(t).y-1;return this.tilesUrl+t+"/"+e+"/"+(n-i)+".png"}})}(OpenSeadragon),function(t){t.ZoomifyTileSource=function(t){t.tileSize=256;var e={x:t.width,y:t.height};for(t.imageSizes=[{x:t.width,y:t.height}],t.gridSize=[this._getGridSize(t.width,t.height,t.tileSize)];parseInt(e.x,10)>t.tileSize||parseInt(e.y,10)>t.tileSize;)e.x=Math.floor(e.x/2),e.y=Math.floor(e.y/2),t.imageSizes.push({x:e.x,y:e.y}),t.gridSize.push(this._getGridSize(e.x,e.y,t.tileSize));t.imageSizes.reverse(),t.gridSize.reverse(),t.minLevel=0,t.maxLevel=t.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[t])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(t,e,i){return{x:Math.ceil(t/i),y:Math.ceil(e/i)}},_calculateAbsoluteTileNumber:function(t,e,i){for(var n=0,r={},o=0;o<t;o++)r=this.gridSize[o],n+=r.x*r.y;return r=this.gridSize[t],n+=r.x*i+e},supports:function(t){return t.type&&"zoomifytileservice"==t.type},configure:function(t){return t},getTileUrl:function(t,e,i){var n=0,r=this._calculateAbsoluteTileNumber(t,e,i);return n=Math.floor(r/256),this.tilesUrl+"TileGroup"+n+"/"+t+"-"+e+"-"+i+".jpg"}})}(OpenSeadragon),function(t){function e(e){var i,n,r=[];for(n=0;n<e.length;n++)i=e[n],i.height&&i.width&&i.url?r.push({url:i.url,width:Number(i.width),height:Number(i.height)}):t.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return r.sort(function(t,e){return t.height-e.height})}function i(e,i){if(!i||!i.documentElement)throw new Error(t.getString("Errors.Xml"));var r,o,s=i.documentElement,a=s.tagName,l=null,h=[];if("image"==a)try{for(l={type:s.getAttribute("type"),levels:[]},h=s.getElementsByTagName("level"),o=0;o<h.length;o++)r=h[o],l.levels.push({url:r.getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return n(e,l)}catch(t){throw t instanceof Error?t:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+i)}throw new Error("Unknown element "+a)}function n(t,e){return e.levels}t.LegacyTileSource=function(i){var n,r,o;t.isArray(i)&&(n={type:"legacy-image-pyramid",levels:i}),n.levels=e(n.levels),n.levels.length>0?(r=n.levels[n.levels.length-1].width,o=n.levels[n.levels.length-1].height):(r=0,o=0,t.console.error("No supported image formats found")),t.extend(!0,n,{width:r,height:o,tileSize:Math.max(o,r),tileOverlap:0,minLevel:0,maxLevel:n.levels.length>0?n.levels.length-1:0}),t.TileSource.apply(this,[n]),this.levels=n.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"legacy-image-pyramid"==t.type||t.documentElement&&"legacy-image-pyramid"==t.documentElement.getAttribute("type")},configure:function(e){return t.isPlainObject(e)?n(this,e):i(this,e)},getLevelScale:function(t){var e=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].width/this.levels[this.maxLevel].width),e},getNumTiles:function(e){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(t){var e=null;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].url),e}})}(OpenSeadragon),function(t){t.ImageTileSource=function(e){e=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),t.TileSource.apply(this,[e])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"image"===t.type},configure:function(t){return t},getImageInfo:function(e){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),t.addEvent(i,"load",function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),t.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),i.src=e},getLevelScale:function(t){var e=NaN;return t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].width/this.levels[this.maxLevel].width),e},getNumTiles:function(e){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(t){var e=null;return t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].url),e},getContext2D:function(t){var e=null;return t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].context2D),e},_buildLevels:function(){var e=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,e;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,r=document.createElement("canvas"),o=r.getContext("2d");if(r.width=i,r.height=n,o.drawImage(this._image,0,0,i,n),e[0].context2D=o,delete this._image,t.isCanvasTainted(r))return e;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var s=document.createElement("canvas"),a=s.getContext("2d");s.width=i,s.height=n,a.drawImage(r,0,0,i,n),e.splice(0,0,{context2D:a,width:i,height:n}),r=s,o=a}return e}})}(OpenSeadragon),function(t){t.TileSourceCollection=function(){t.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(t){function e(e){t.requestAnimationFrame(function(){i(e)})}function i(i){var n,r,o;i.shouldFade&&(n=t.now(),r=n-i.fadeBeginTime,o=1-r/i.fadeLength,o=Math.min(1,o),o=Math.max(0,o),i.imgGroup&&t.setElementOpacity(i.imgGroup,o,!0),o>0&&e(i))}function n(i){i.shouldFade=!0,i.fadeBeginTime=t.now()+i.fadeDelay,window.setTimeout(function(){e(i)},i.fadeDelay)}function r(e){e.shouldFade=!1,e.imgGroup&&t.setElementOpacity(e.imgGroup,1,!0)}function o(e,i){e.element.disabled||(i>=t.ButtonState.GROUP&&e.currentState==t.ButtonState.REST&&(r(e),e.currentState=t.ButtonState.GROUP),
i>=t.ButtonState.HOVER&&e.currentState==t.ButtonState.GROUP&&(e.imgHover&&(e.imgHover.style.visibility=""),e.currentState=t.ButtonState.HOVER),i>=t.ButtonState.DOWN&&e.currentState==t.ButtonState.HOVER&&(e.imgDown&&(e.imgDown.style.visibility=""),e.currentState=t.ButtonState.DOWN))}function s(e,i){e.element.disabled||(i<=t.ButtonState.HOVER&&e.currentState==t.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=t.ButtonState.HOVER),i<=t.ButtonState.GROUP&&e.currentState==t.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=t.ButtonState.GROUP),i<=t.ButtonState.REST&&e.currentState==t.ButtonState.GROUP&&(n(e),e.currentState=t.ButtonState.REST))}t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(e){var i=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},e),this.element=e.element||t.makeNeutralElement("div"),e.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor==t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){e.insideElementPressed?(o(i,t.ButtonState.DOWN),i.raiseEvent("enter",{originalEvent:e.originalEvent})):e.buttonDownAny||o(i,t.ButtonState.HOVER)},focusHandler:function(t){this.enterHandler(t),i.raiseEvent("focus",{originalEvent:t.originalEvent})},exitHandler:function(e){s(i,t.ButtonState.GROUP),e.insideElementPressed&&i.raiseEvent("exit",{originalEvent:e.originalEvent})},blurHandler:function(t){this.exitHandler(t),i.raiseEvent("blur",{originalEvent:t.originalEvent})},pressHandler:function(e){o(i,t.ButtonState.DOWN),i.raiseEvent("press",{originalEvent:e.originalEvent})},releaseHandler:function(e){e.insideElementPressed&&e.insideElementReleased?(s(i,t.ButtonState.HOVER),i.raiseEvent("release",{originalEvent:e.originalEvent})):e.insideElementPressed?s(i,t.ButtonState.GROUP):o(i,t.ButtonState.HOVER)},clickHandler:function(t){t.quick&&i.raiseEvent("click",{originalEvent:t.originalEvent})},keyHandler:function(t){return 13!==t.keyCode||(i.raiseEvent("click",{originalEvent:t.originalEvent}),i.raiseEvent("release",{originalEvent:t.originalEvent}),!1)}}),s(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){o(this,t.ButtonState.GROUP)},notifyGroupExit:function(){s(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(t){t.ButtonGroup=function(e){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var i,n=this.buttons.concat([]),r=this;if(this.element=e.element||t.makeNeutralElement("div"),!e.group)for(this.label=t.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),i=0;i<n.length;i++)this.element.appendChild(n[i].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var t;for(t=0;t<r.buttons.length;t++)r.buttons[t].notifyGroupEnter()},exitHandler:function(t){var e;if(!t.insideElementPressed)for(e=0;e<r.buttons.length;e++)r.buttons[e].notifyGroupExit()}})},t.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(t){t.Rect=function(e,i,n,r,o){this.x="number"==typeof e?e:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof r?r:0,this.degrees="number"==typeof o?o:0,this.degrees=t.positiveModulo(this.degrees,360);var s,a;this.degrees>=270?(s=this.getTopRight(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(s=this.getBottomRight(),this.x=s.x,this.y=s.y,this.degrees-=180):this.degrees>=90&&(s=this.getBottomLeft(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},t.Rect.fromSummits=function(e,i,n){var r=e.distanceTo(i),o=e.distanceTo(n),s=i.minus(e),a=Math.atan(s.y/s.x);return s.x<0?a+=Math.PI:s.y<0&&(a+=2*Math.PI),new t.Rect(e.x,e.y,r,o,a/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(e){return e instanceof t.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new t.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new t.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var i=this.getBoundingBox(),n=e.getBoundingBox(),r=Math.min(i.x,n.x),o=Math.min(i.y,n.y),s=Math.max(i.x+i.width,n.x+n.width),a=Math.max(i.y+i.height,n.y+n.height);return new t.Rect(r,o,s-r,a-o)},intersection:function(e){function i(e,i,r,o){var s=i.minus(e),a=o.minus(r),l=-a.x*s.y+s.x*a.y;if(0===l)return null;var h=(s.x*(e.y-r.y)-s.y*(e.x-r.x))/l,c=(a.x*(e.y-r.y)-a.y*(e.x-r.x))/l;return-n<=h&&h<=1-n&&-n<=c&&c<=1-n?new t.Point(e.x+c*s.x,e.y+c*s.y):null}var n=1e-10,r=[],o=this.getTopLeft();e.containsPoint(o,n)&&r.push(o);var s=this.getTopRight();e.containsPoint(s,n)&&r.push(s);var a=this.getBottomLeft();e.containsPoint(a,n)&&r.push(a);var l=this.getBottomRight();e.containsPoint(l,n)&&r.push(l);var h=e.getTopLeft();this.containsPoint(h,n)&&r.push(h);var c=e.getTopRight();this.containsPoint(c,n)&&r.push(c);var u=e.getBottomLeft();this.containsPoint(u,n)&&r.push(u);var d=e.getBottomRight();this.containsPoint(d,n)&&r.push(d);for(var f=this._getSegments(),p=e._getSegments(),g=0;g<f.length;g++)for(var m=f[g],v=0;v<p.length;v++){var y=p[v],b=i(m[0],m[1],y[0],y[1]);b&&r.push(b)}if(0===r.length)return null;for(var _=r[0].x,w=r[0].x,x=r[0].y,C=r[0].y,S=1;S<r.length;S++){var T=r[S];T.x<_&&(_=T.x),T.x>w&&(w=T.x),T.y<x&&(x=T.y),T.y>C&&(C=T.y)}return new t.Rect(_,x,w-_,C-x)},_getSegments:function(){var t=this.getTopLeft(),e=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[t,e],[e,n],[n,i],[i,t]]},rotate:function(e,i){if(0===(e=t.positiveModulo(e,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(e,i),r=this.getTopRight().rotate(e,i),o=r.minus(n);o=o.apply(function(t){return Math.abs(t)<1e-15?0:t});var s=Math.atan(o.y/o.x);return o.x<0?s+=Math.PI:o.y<0&&(s+=2*Math.PI),new t.Rect(n.x,n.y,this.width,this.height,s/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),r=this.getBottomRight(),o=Math.min(e.x,i.x,n.x,r.x),s=Math.max(e.x,i.x,n.x,r.x),a=Math.min(e.y,i.y,n.y,r.y),l=Math.max(e.y,i.y,n.y,r.y);return new t.Rect(o,a,s-o,l-a)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),i=Math.floor(e.x),n=Math.floor(e.y),r=Math.ceil(e.width+e.x-i),o=Math.ceil(e.height+e.y-n);return new t.Rect(i,n,r,o)},containsPoint:function(t,e){e=e||0;var i=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),o=n.minus(i),s=r.minus(i);return(t.x-i.x)*o.x+(t.y-i.y)*o.y>=-e&&(t.x-n.x)*o.x+(t.y-n.y)*o.y<=e&&(t.x-i.x)*s.x+(t.y-i.y)*s.y>=-e&&(t.x-r.x)*s.x+(t.y-r.y)*s.y<=e},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(t){function e(e){var i=Number(this.element.style.marginLeft.replace("px","")),r=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=t.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-e.delta.x>0?i>-(o-a.x)&&(this.element.style.marginLeft=i+2*e.delta.x+"px",n(this,a.x,i+2*e.delta.x)):-e.delta.x<0&&i<0&&(this.element.style.marginLeft=i+2*e.delta.x+"px",n(this,a.x,i+2*e.delta.x)):-e.delta.y>0?r>-(s-a.y)&&(this.element.style.marginTop=r+2*e.delta.y+"px",n(this,a.y,r+2*e.delta.y)):-e.delta.y<0&&r<0&&(this.element.style.marginTop=r+2*e.delta.y+"px",n(this,a.y,r+2*e.delta.y))),!1}function i(e){var i=Number(this.element.style.marginLeft.replace("px","")),r=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=t.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?e.scroll>0?i>-(o-a.x)&&(this.element.style.marginLeft=i-60*e.scroll+"px",n(this,a.x,i-60*e.scroll)):e.scroll<0&&i<0&&(this.element.style.marginLeft=i-60*e.scroll+"px",n(this,a.x,i-60*e.scroll)):e.scroll<0?r>a.y-s&&(this.element.style.marginTop=r+60*e.scroll+"px",n(this,a.y,r+60*e.scroll)):e.scroll>0&&r<0&&(this.element.style.marginTop=r+60*e.scroll+"px",n(this,a.y,r+60*e.scroll))),!1}function n(e,i,n){var r,o,s,a,l,h,c;for(r="horizontal"==e.scroll?e.panelWidth:e.panelHeight,o=Math.ceil(i/r)+5,s=Math.ceil((Math.abs(n)+i)/r)+1,o=s-o,o=o<0?0:o,h=o;h<s&&h<e.panels.length;h++)if(c=e.panels[h],!c.activePanel){var u,d=e.viewer.tileSources[h];u=d.referenceStripThumbnailUrl?{type:"image",url:d.referenceStripThumbnailUrl}:d,a=new t.Viewer({id:c.id,tileSources:[u],element:c,navigatorSizeRatio:e.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),a.displayRegion=t.makeNeutralElement("div"),a.displayRegion.id=c.id+"-displayregion",a.displayRegion.className="displayregion",l=a.displayRegion.style,l.position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l["float"]="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=e.panelWidth-4+"px",l.height=e.panelHeight-4+"px",a.displayRegion.innerTracker=new t.MouseTracker({element:a.displayRegion,startDisabled:!0}),c.getElementsByTagName("div")[0].appendChild(a.displayRegion),e.miniViewers[c.id]=a,c.activePanel=!0}}function r(t){var e=t.eventSource.element;return"horizontal"==this.scroll?e.style.marginBottom="0px":e.style.marginLeft="0px",!1}function o(e){var i=e.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+t.getElementSize(i).y/2+"px":i.style.marginLeft="-"+t.getElementSize(i).x/2+"px",!1}function s(t){if(t.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function a(t){if(t.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 61:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}var l={};t.ReferenceStrip=function(h){var c,u,d,f=this,p=h.viewer,g=t.getElementSize(p.element);for(h.id||(h.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=h.id,this.element.className="referencestrip"),h=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},h,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),t.extend(this,h),l[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,u=this.element.style,u.marginTop="0px",u.marginRight="0px",u.marginBottom="0px",u.marginLeft="0px",u.left="0px",u.bottom="0px",u.border="0px",u.background="#000",u.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,e),scrollHandler:t.delegate(this,i),enterHandler:t.delegate(this,r),exitHandler:t.delegate(this,o),keyDownHandler:t.delegate(this,s),keyHandler:t.delegate(this,a)}),h.width&&h.height?(this.element.style.width=h.width+"px",this.element.style.height=h.height+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):"horizontal"==h.scroll?(this.element.style.width=g.x*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=g.y*h.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=g.y*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=g.x*h.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=g.x*this.sizeRatio+8,this.panelHeight=g.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<p.tileSources.length;d++)c=t.makeNeutralElement("div"),c.id=this.element.id+"-"+d,c.style.width=f.panelWidth+"px",c.style.height=f.panelHeight+"px",c.style.display="inline",c.style["float"]="left",c.style.cssFloat="left",c.style.styleFloat="left",c.style.padding="2px",t.setElementTouchActionNone(c),c.innerTracker=new t.MouseTracker({element:c,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(e){e.eventSource.dragging=t.now()},releaseHandler:function(e){var i=e.eventSource,n=i.element.id,r=Number(n.split("-")[2]),o=t.now();e.insideElementPressed&&e.insideElementReleased&&i.dragging&&o-i.dragging<i.clickTimeThreshold&&(i.dragging=null,p.goToPage(r))}}),this.element.appendChild(c),c.activePanel=!1,this.panels.push(c);n(this,"vertical"==this.scroll?g.y:g.x,0),this.setFocus(0)},t.extend(t.ReferenceStrip.prototype,t.EventSource.prototype,t.Viewer.prototype,{setFocus:function(e){var i,o=t.getElement(this.element.id+"-"+e),s=t.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==o&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=o,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(e)*(this.panelWidth+3),i>h+s.x-this.panelWidth?(i=Math.min(i,a-s.x),this.element.style.marginLeft=-i+"px",n(this,s.x,-i)):i<h&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",n(this,s.x,-i))):(i=Number(e)*(this.panelHeight+3),i>c+s.y-this.panelHeight?(i=Math.min(i,l-s.y),this.element.style.marginTop=-i+"px",n(this,s.y,-i)):i<c&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",n(this,s.y,-i))),this.currentPage=e,r.call(this,{eventSource:this.innerTracker}))},update:function(){return!!l[this.id].animating&&(t.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var t in this.miniViewers)this.miniViewers[t].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(t){t.DisplayRect=function(e,i,n,r,o,s){t.Rect.apply(this,[e,i,n,r]),this.minLevel=o,this.maxLevel=s},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(OpenSeadragon),function(t){function e(t,e){return(1-Math.exp(t*-e))/(1-Math.exp(-t))}t.Spring=function(e){var i=arguments;"object"!=typeof e&&(e={initial:i.length&&"number"==typeof i[0]?i[0]:undefined,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),t.console.assert("number"==typeof e.springStiffness&&0!==e.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert("number"==typeof e.animationTime&&e.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),e.exponential&&(this._exponential=!0,delete e.exponential),t.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(e){t.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(e){t.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(e){this.start.value+=e,this.target.value+=e,this._exponential&&(t.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(e){this._exponential=e,this._exponential&&(t.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var i,n;this._exponential?(i=this.start._logValue,n=this.target._logValue):(i=this.start.value,n=this.target.value);var r=this.current.time>=this.target.time?n:i+(n-i)*e(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(r):this.current.value=r,o!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(t){function e(e){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},e),this.image=null}function i(t,e,i){var n;t.jobsInProgress--,(!t.jobLimit||t.jobsInProgress<t.jobLimit)&&t.jobQueue.length>0&&(n=t.jobQueue.shift(),n.start(),t.jobsInProgress++),i(e.image,e.errorMsg,e.request)}e.prototype={errorMsg:null,start:function(){var e=this,i=this.abort;this.image=new Image,this.image.onload=function(){e.finish(!0)},this.image.onabort=this.image.onerror=function(){e.errorMsg="Image load aborted",e.finish(!1)},this.jobId=window.setTimeout(function(){e.errorMsg="Image load exceeded timeout",e.finish(!1)},this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(t){var i;try{i=new window.Blob([t.response])}catch(e){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===e.name&&n){var r=new n;r.append(t.response),i=r.getBlob()}}0===i.size&&(e.errorMsg="Empty image response.",e.finish(!1));var o=(window.URL||window.webkitURL).createObjectURL(i);e.image.src=o},error:function(){e.errorMsg="Image load aborted - XHR error",e.finish(!1)}}),this.abort=function(){e.request.abort(),"function"==typeof i&&i()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(t){this.image.onload=this.image.onerror=this.image.onabort=null,t||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(e){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},e)},t.ImageLoader.prototype={addJob:function(t){var n=this,r=function(e){i(n,e,t.callback)},o={src:t.src,loadWithAjax:t.loadWithAjax,ajaxHeaders:t.loadWithAjax?t.ajaxHeaders:null,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:r,abort:t.abort,timeout:this.timeout},s=new e(o);!this.jobLimit||this.jobsInProgress<this.jobLimit?(s.start(),this.jobsInProgress++):this.jobQueue.push(s)},clear:function(){for(var t=0;t<this.jobQueue.length;t++){var e=this.jobQueue[t];"function"==typeof e.abort&&e.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(t){t.Tile=function(t,e,i,n,r,o,s,a,l){this.level=t,this.x=e,this.y=i,this.bounds=n,this.exists=r,this.url=o,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){return this.cacheImageRecord?this.loaded?(this.element||(this.element=t.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=e&&e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",void t.setElementOpacity(this.element,this.opacity)):void t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):void t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(e,i,n,r){var o,s=this.position.times(t.pixelDensityRatio),a=this.size.times(t.pixelDensityRatio);return this.context2D||this.cacheImageRecord?(o=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&o?(e.save(),e.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(s=s.times(n),a=a.times(n)),r instanceof t.Point&&(s=s.plus(r)),1===e.globalAlpha&&this._hasTransparencyChannel()&&e.clearRect(s.x+1,s.y+1,a.x-2,a.y-2),i({context:e,tile:this,rendered:o}),e.drawImage(o.canvas,0,0,o.canvas.width,o.canvas.height,s.x,s.y,a.x,a.y),void e.restore()):void t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):void t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,i,n){var r=Math.max(1,Math.ceil((n.x-i.x)/2)),o=Math.max(1,Math.ceil((n.y-i.y)/2));return new t.Point(r,o).minus(this.position.times(t.pixelDensityRatio).times(e||1).apply(function(t){return t%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(e,i,n){var r;r=t.isPlainObject(e)?e:{element:e,location:i,placement:n},this.element=r.element,this.style=r.element.style,this._init(r)},t.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=e.placement===undefined?t.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=e.checkResize===undefined||e.checkResize,this.width=e.width===undefined?null:e.width,this.height=e.height===undefined?null:e.height,this.rotationMode=e.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,i){var n=t.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?e.x-=i.x/2:n.isRight&&(e.x-=i.x),n.isVerticallyCentered?e.y-=i.y/2:n.isBottom&&(e.y-=i.y))},destroy:function(){var e=this.element,i=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(i.display="none",document.body.appendChild(e))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var n=t.getCssPropertyWithVendorPrefix("transformOrigin"),r=t.getCssPropertyWithVendorPrefix("transform");n&&r&&(i[n]="",i[r]="")},drawHTML:function(e,i){var n=this.element;n.parentNode!==e&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,e.appendChild(n),this.style.position="absolute",this.size=t.getElementSize(n));var r=this._getOverlayPositionAndSize(i),o=r.position,s=this.size=r.size,a=r.rotate;if(this.onDraw)this.onDraw(o,s,this.element);else{var l=this.style;l.left=o.x+"px",l.top=o.y+"px",null!==this.width&&(l.width=s.x+"px"),null!==this.height&&(l.height=s.y+"px");var h=t.getCssPropertyWithVendorPrefix("transformOrigin"),c=t.getCssPropertyWithVendorPrefix("transform");h&&c&&(a?(l[h]=this._getTransformOrigin(),l[c]="rotate("+a+"deg)"):(l[h]="",l[c]="")),"none"!==l.display&&(l.display="block")}},_getOverlayPositionAndSize:function(e){var i=e.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(e);this.adjust(i,n);var r=0;if(e.degrees&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var o=new t.Rect(i.x,i.y,n.x,n.y),s=this._getBoundingBox(o,e.degrees);i=s.getTopLeft(),n=s.getSize()}else r=e.degrees;return{position:i,size:n,rotate:r}},_getSizeInPixels:function(e){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var r=e.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=r.x),null!==this.height&&(n=r.y)}if(this.checkResize&&(null===this.width||null===this.height)){var o=this.size=t.getElementSize(this.element);null===this.width&&(i=o.x),null===this.height&&(n=o.y)}return new t.Point(i,n)},_getBoundingBox:function(t,e){var i=this._getPlacementPoint(t);return t.rotate(e,i).getBoundingBox()},_getPlacementPoint:function(e){var i=new t.Point(e.x,e.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=e.width/2:n.isRight&&(i.x+=e.width),n.isVerticallyCentered?i.y+=e.height/2:n.isBottom&&(i.y+=e.height)),i},_getTransformOrigin:function(){var e="",i=t.Placement.properties[this.placement];return i?(i.isLeft?e="left":i.isRight&&(e="right"),i.isTop?e+=" top":i.isBottom&&(e+=" bottom"),e):e},update:function(e,i){var n=t.isPlainObject(e)?e:{location:e,placement:i};this._init({location:n.location||this.location,placement:n.placement!==undefined?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:n.width!==undefined?n.width:this.width,height:n.height!==undefined?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(e){t.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var r=e.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=r.x),null===n&&(n=r.y)}var o=this.location.clone();return this.adjust(o,new t.Point(i,n)),this._adjustBoundsForRotation(e,new t.Rect(o.x,o.y,i,n))},_adjustBoundsForRotation:function(e,i){if(!e||0===e.degrees||this.rotationMode===t.OverlayRotationMode.EXACT)return i;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new t.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-e.degrees,this._getPlacementPoint(i))}}}(OpenSeadragon),function(t){t.Drawer=function(e){t.console.assert(e.viewer,"[Drawer] options.viewer is required");var i=arguments;if(t.isPlainObject(e)||(e={source:i[0],viewport:i[1],element:i[2]}),t.console.assert(e.viewport,"[Drawer] options.viewport is required"),t.console.assert(e.element,"[Drawer] options.element is required"),e.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor=e.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,e.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),
this.container=t.getElement(e.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},t.Drawer.prototype={addOverlay:function(e,i,n,r){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,i,n,r),this},updateOverlay:function(e,i,n){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,i,n),this},removeOverlay:function(e){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(e){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(e);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,i=0,n=0;n<e.getItemCount();n++){var r=e.getItemAt(n).getOpacity();r>i&&(i=r)}return i},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var t=this._calculateCanvasSize();if((this.canvas.width!=t.x||this.canvas.height!=t.y)&&(this.canvas.width=t.x,this.canvas.height=t.y,null!==this.sketchCanvas)){var e=this._calculateSketchCanvasSize();this.sketchCanvas.width=e.x,this.sketchCanvas.height=e.y}this._clear()}},_clear:function(t,e){if(this.useCanvas){var i=this._getContext(t);if(e)i.clearRect(e.x,e.y,e.width,e.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(e){var i=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new t.Rect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio)},drawTile:function(e,i,n,r,o){if(t.console.assert(e,"[Drawer.drawTile] tile is required"),t.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var s=this._getContext(n);r=r||1,e.drawCanvas(s,i,r,o)}else e.drawHTML(this.canvas)},_getContext:function(t){var e=this.context;if(t){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",function t(){if(0!==n.viewport.getRotation()){n.viewer.removeHandler("rotate",t);var e=n._calculateSketchCanvasSize();n.sketchCanvas.width=e.x,n.sketchCanvas.height=e.y}})}}e=this.sketchContext}return e},saveContext:function(t){this.useCanvas&&this._getContext(t).save()},restoreContext:function(t){this.useCanvas&&this._getContext(t).restore()},setClip:function(t,e){if(this.useCanvas){var i=this._getContext(e);i.beginPath(),i.rect(t.x,t.y,t.width,t.height),i.clip()}},drawRectangle:function(t,e,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=e,n.fillRect(t.x,t.y,t.width,t.height),n.restore()}},blendSketch:function(e,i,n,r){var o=e;if(t.isPlainObject(o)||(o={opacity:e,scale:i,translate:n,compositeOperation:r}),this.useCanvas&&this.sketchCanvas){e=o.opacity,r=o.compositeOperation;var s=o.bounds;if(this.context.save(),this.context.globalAlpha=e,r&&(this.context.globalCompositeOperation=r),s)s.x<0&&(s.width+=s.x,s.x=0),s.x+s.width>this.canvas.width&&(s.width=this.canvas.width-s.x),s.y<0&&(s.height+=s.y,s.y=0),s.y+s.height>this.canvas.height&&(s.height=this.canvas.height-s.y),this.context.drawImage(this.sketchCanvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height);else{i=o.scale||1,n=o.translate;var a=n instanceof t.Point?n:new t.Point(0,0),l=0,h=0;if(n){var c=this.sketchCanvas.width-this.canvas.width,u=this.sketchCanvas.height-this.canvas.height;l=Math.round(c/2),h=Math.round(u/2)}this.context.drawImage(this.sketchCanvas,a.x-l*i,a.y-h*i,(this.canvas.width+2*l)*i,(this.canvas.height+2*h)*i,-l,-h,this.canvas.width+2*l,this.canvas.height+2*h)}this.context.restore()}},drawDebugInfo:function(e,i,n,r){if(this.useCanvas){var o=this.context;o.save(),o.lineWidth=2*t.pixelDensityRatio,o.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor,o.fillStyle=this.debugGridColor,0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),r.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:r.getRotation(!0),point:r.viewport.pixelFromPointNoRotate(r._getRotationPoint(!0),!0)}),o.strokeRect(e.position.x*t.pixelDensityRatio,e.position.y*t.pixelDensityRatio,e.size.x*t.pixelDensityRatio,e.size.y*t.pixelDensityRatio);var s=(e.position.x+e.size.x/2)*t.pixelDensityRatio,a=(e.position.y+e.size.y/2)*t.pixelDensityRatio;o.translate(s,a),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-s,-a),0===e.x&&0===e.y&&(o.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*t.pixelDensityRatio,(e.position.y-30)*t.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*t.pixelDensityRatio,(e.position.y-20)*t.pixelDensityRatio)),o.fillText("Level: "+e.level,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+20)*t.pixelDensityRatio),o.fillText("Column: "+e.x,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+30)*t.pixelDensityRatio),o.fillText("Row: "+e.y,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+40)*t.pixelDensityRatio),o.fillText("Order: "+n+" of "+i,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+50)*t.pixelDensityRatio),o.fillText("Size: "+e.size.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+60)*t.pixelDensityRatio),o.fillText("Position: "+e.position.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+70)*t.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),r.getRotation(!0)%360!=0&&this._restoreRotationChanges(),o.restore()}},debugRect:function(e){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*t.pixelDensityRatio,i.strokeStyle=this.debugGridColor,i.fillStyle=this.debugGridColor,i.strokeRect(e.x*t.pixelDensityRatio,e.y*t.pixelDensityRatio,e.width*t.pixelDensityRatio,e.height*t.pixelDensityRatio),i.restore()}},getCanvasSize:function(e){var i=this._getContext(e).canvas;return new t.Point(i.width,i.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var i=e.point?e.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(e.useSketch);n.save(),n.translate(i.x,i.y),n.rotate(Math.PI/180*e.degrees),n.translate(-i.x,-i.y)},_restoreRotationChanges:function(t){this._getContext(t).restore()},_calculateCanvasSize:function(){var e=t.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:i.x*e,y:i.y*e}},_calculateSketchCanvasSize:function(){var t=this._calculateCanvasSize();if(0===this.viewport.getRotation())return t;var e=Math.ceil(Math.sqrt(t.x*t.x+t.y*t.y));return{x:e,y:e}}}}(OpenSeadragon),function(t){t.Viewport=function(e){var i=arguments;i.length&&i[0]instanceof t.Point&&(e={containerSize:i[0],contentSize:i[1],config:i[2]}),e.config&&(t.extend(!0,e,e.config),delete e.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,degrees:t.DEFAULT_SETTINGS.degrees,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer},e),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={resetContentSize:function(e){return t.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(e instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(e.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(e.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,i){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,i)},_setContentBounds:function(e,i){t.console.assert(e,"[Viewport._setContentBounds] bounds is required"),t.console.assert(e instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(e.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(e.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?t>=1?t:1:t>=1?1:t)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new t.Rect(e.x-i/2,e.y-n/2,i,n)},goHome:function(t){return this.viewer&&this.viewer.raiseEvent("home",{immediately:t}),this.fitBounds(this.getHomeBounds(),t)},getMinZoom:function(){var t=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*t},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),Math.max(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(e){t.console.assert("object"===t.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var i=this.getCenter(e),n=1/this.getZoom(e),r=n/this.getAspectRatio();return new t.Rect(i.x-n/2,i.y-r/2,n,r)},getBoundsWithMargins:function(t){return this.getBoundsNoRotateWithMargins(t).rotate(-this.getRotation(),this.getCenter(t))},getBoundsNoRotateWithMargins:function(t){var e=this.getBoundsNoRotate(t),i=this._containerInnerSize.x*this.getZoom(t);return e.x-=this._margins.left/i,e.y-=this._margins.top/i,e.width+=(this._margins.left+this._margins.right)/i,e.height+=(this._margins.top+this._margins.bottom)/i,e},getCenter:function(e){var i,n,r,o,s,a,l,h,c=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),u=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return e?c:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),n=this.getZoom(),r=1/n,o=r/this.getAspectRatio(),s=new t.Rect(c.x-r/2,c.y-o/2,r,o),a=this._pixelFromPoint(this.zoomPoint,s),l=a.minus(i),h=l.divide(this._containerInnerSize.x*n),u.plus(h)):u},getZoom:function(t){return t?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(t){return Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var i=new t.Rect(e.x,e.y,e.width,e.height);if(this.wrapHorizontal);else{var n=this.visibilityRatio*i.width,r=i.x+i.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,s=this._contentBoundsNoRotate.x-r+n,a=o-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(s+a)/2:a<0?i.x+=a:s>0&&(i.x+=s)}if(this.wrapVertical);else{var l=this.visibilityRatio*i.height,h=i.y+i.height,c=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,u=this._contentBoundsNoRotate.y-h+l,d=c-i.y-l;l>this._contentBoundsNoRotate.height?i.y+=(u+d)/2:d<0?i.y+=d:u>0&&(i.y+=u)}return i},_raiseConstraintsEvent:function(t){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:t})},applyConstraints:function(t){var e=this.getZoom(),i=this._applyZoomConstraints(e);e!==i&&this.zoomTo(i,this.zoomPoint,t);var n=this.getBoundsNoRotate(),r=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(t),(n.x!==r.x||n.y!==r.y||t)&&this.fitBounds(r.rotate(-this.getRotation()),t),this},ensureVisible:function(t){return this.applyConstraints(t)},_fitBounds:function(e,i){i=i||{};var n=i.immediately||!1,r=i.constraints||!1,o=this.getAspectRatio(),s=e.getCenter(),a=new t.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=o?a.height=a.width/o:a.width=a.height*o,a.x=s.x-a.width/2,a.y=s.y-a.height/2;var l=1/a.width;if(r){var h=a.getAspectRatio(),c=this._applyZoomConstraints(l);l!==c&&(l=c,a.width=1/l,a.x=s.x-a.width/2,a.height=a.width/h,a.y=s.y-a.height/2),a=this._applyBoundaryConstraints(a),s=a.getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(s,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var u=this.getBounds(),d=this.getZoom();if(0===d||Math.abs(l/d-1)<1e-8)return this.zoomTo(l,!0),this.panTo(s,n);a=a.rotate(-this.getRotation());var f=a.getTopLeft().times(l).minus(u.getTopLeft().times(d)).divide(l-d);return this.zoomTo(l,f,n)},fitBounds:function(t,e){return this._fitBounds(t,{immediately:e,constraints:!1})},fitBoundsWithConstraints:function(t,e){return this._fitBounds(t,{immediately:e,constraints:!0})},fitVertically:function(e){var i=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,e)},fitHorizontally:function(e){var i=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,e)},getConstrainedBounds:function(t){var e;return e=this.getBounds(t),this._applyBoundaryConstraints(e)},panBy:function(e,i){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(e),i)},panTo:function(t,e){return e?(this.centerSpringX.resetTo(t.x),this.centerSpringY.resetTo(t.y)):(this.centerSpringX.springTo(t.x),this.centerSpringY.springTo(t.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:t,immediately:e}),this},zoomBy:function(t,e,i){return this.zoomTo(this.zoomSpring.target.value*t,e,i)},zoomTo:function(e,i,n){var r=this;return this.zoomPoint=i instanceof t.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){r.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:i,immediately:n}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=t.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e}),this):this},getRotation:function(){return this.degrees},resize:function(t,e){var i,n=this.getBoundsNoRotate(),r=n;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),e&&(i=t.x/this.containerSize.x,r.width=n.width*i,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:e}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var t=this;this._adjustCenterSpringsForZoomPoint(function(){t.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var e=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,e},_adjustCenterSpringsForZoomPoint:function(t){if(this.zoomPoint){var e=this.pixelFromPoint(this.zoomPoint,!0);t();var i=this.pixelFromPoint(this.zoomPoint,!0),n=i.minus(e),r=this.deltaPointsFromPixels(n,!0);this.centerSpringX.shiftBy(r.x),this.centerSpringY.shiftBy(r.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else t()},deltaPixelsFromPointsNoRotate:function(t,e){return t.times(this._containerInnerSize.x*this.getZoom(e))},deltaPixelsFromPoints:function(t,e){return this.deltaPixelsFromPointsNoRotate(t.rotate(this.getRotation()),e)},deltaPointsFromPixelsNoRotate:function(t,e){return t.divide(this._containerInnerSize.x*this.getZoom(e))},deltaPointsFromPixels:function(t,e){return this.deltaPointsFromPixelsNoRotate(t,e).rotate(-this.getRotation())},pixelFromPointNoRotate:function(t,e){return this._pixelFromPointNoRotate(t,this.getBoundsNoRotate(e))},pixelFromPoint:function(t,e){return this._pixelFromPoint(t,this.getBoundsNoRotate(e))},_pixelFromPointNoRotate:function(e,i){return e.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(t,e){return this._pixelFromPointNoRotate(t.rotate(this.getRotation(),this.getCenter(!0)),e)},pointFromPixelNoRotate:function(e,i){var n=this.getBoundsNoRotate(i);return e.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(t,e){return this.pointFromPixelNoRotate(t,e).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(e,i){if(e instanceof t.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n){var r=this.viewer.world.getItemAt(0);return r.viewportToImageCoordinates(e,i,!0)}}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(e,i){if(e instanceof t.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n){var r=this.viewer.world.getItemAt(0);return r.imageToViewportCoordinates(e,i,!0)}}var o=this._imageToViewportDelta(e,i);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(e,i,n,r){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===s){var a=this.viewer.world.getItemAt(0);return a.imageToViewportRectangle(e,i,n,r,!0)}}var l=this.imageToViewportCoordinates(o.x,o.y),h=this._imageToViewportDelta(o.width,o.height);return new t.Rect(l.x,l.y,h.x,h.y,o.degrees)},viewportToImageRectangle:function(e,i,n,r){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===s){var a=this.viewer.world.getItemAt(0);return a.viewportToImageRectangle(e,i,n,r,!0)}}var l=this.viewportToImageCoordinates(o.x,o.y),h=this._viewportToImageDelta(o.width,o.height);return new t.Rect(l.x,l.y,h.x,h.y,o.degrees)},viewerElementToImageCoordinates:function(t){var e=this.pointFromPixel(t,!0);return this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(t){var e=this.imageToViewportCoordinates(t);return this.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(e).plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(t){return this.pointFromPixel(t,!0)},viewportToViewerElementCoordinates:function(t){return this.pixelFromPoint(t,!0)},viewerElementToViewportRectangle:function(e){return t.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return t.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(e).plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i){var n=this.viewer.world.getItemAt(0);return n.viewportToImageZoom(e)}}var r=this._contentSizeNoRotate.x;return e*(this._containerInnerSize.x/r*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i){var n=this.viewer.world.getItemAt(0);return n.imageToViewportZoom(e)}}return e*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)}}}(OpenSeadragon),function(t){function e(t,e,n,r,o,s,a,l,h){var c=a.getBoundingBox().getTopLeft(),u=a.getBoundingBox().getBottomRight();t.viewer&&t.viewer.raiseEvent("update-level",{tiledImage:t,havedrawn:e,level:r,opacity:o,visibility:s,drawArea:a,topleft:c,bottomright:u,currenttime:l,best:h}),d(t.coverage,r),d(t.loadingCoverage,r);for(var f=t._getCornerTiles(r,c,u),p=f.topLeft,g=f.bottomRight,m=t.source.getNumTiles(r),v=t.viewport.pixelFromPoint(t.viewport.getCenter()),y=p.x;y<=g.x;y++)for(var b=p.y;b<=g.y;b++){if(!t.wrapHorizontal&&!t.wrapVertical){var _=t.source.getTileBounds(r,y,b);if(null===a.intersection(_))continue}h=i(t,n,e,y,b,r,o,s,v,m,l,h)}return h}function i(t,e,i,r,o,h,d,p,g,m,v,y){var b=n(r,o,h,t,t.source,t.tilesMatrix,v,m,t._worldWidthCurrent,t._worldHeightCurrent),_=i;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:b}),u(t.coverage,h,r,o,!1);var w=b.loaded||b.loading||c(t.loadingCoverage,h,r,o);if(u(t.loadingCoverage,h,r,o,w),!b.exists)return y;if(e&&!_&&(c(t.coverage,h,r,o)?u(t.coverage,h,r,o,!0):_=!0),!_)return y;if(a(b,t.source.tileOverlap,t.viewport,g,p,t),!b.loaded)if(b.context2D)s(t,b);else{var x=t._tileCache.getImageRecord(b.cacheKey);if(x){var C=x.getImage();s(t,b,C)}}if(b.loaded){l(t,b,r,o,h,d,v)&&(t._needsDraw=!0)}else b.loading?t._tilesLoading++:w||(y=f(y,b));return y}function n(e,i,n,r,o,s,a,l,h,c){var u,d,f,p,g,m,v,y;return s[n]||(s[n]={}),s[n][e]||(s[n][e]={}),s[n][e][i]||(u=(l.x+e%l.x)%l.x,d=(l.y+i%l.y)%l.y,f=o.getTileBounds(n,u,d),p=o.tileExists(n,u,d),g=o.getTileUrl(n,u,d),r.loadTilesWithAjax?(m=o.getTileAjaxHeaders(n,u,d),t.isPlainObject(r.ajaxHeaders)&&(m=t.extend({},r.ajaxHeaders,m))):m=null,v=o.getContext2D?o.getContext2D(n,u,d):undefined,f.x+=(e-u)/l.x,f.y+=c/h*((i-d)/l.y),s[n][e][i]=new t.Tile(n,e,i,f,p,g,v,r.loadTilesWithAjax,m)),y=s[n][e][i],y.lastTouchTime=a,y}function r(t,e,i){e.loading=!0,t._imageLoader.addJob({src:e.url,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(n,r,s){o(t,e,i,n,r,s)},abort:function(){e.loading=!1}})}function o(e,i,n,r,o,a){if(!r)return t.console.log("Tile %s failed to load: %s - error: %s",i,i.url,o),e.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:e,time:n,message:o,tileRequest:a}),i.loading=!1,void(i.exists=!1);if(n<e.lastResetTime)return t.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var l=function(){var t=e.source.getClosestLevel();s(e,i,r,t,a)};e._midDraw?window.setTimeout(l,1):l()}function s(t,e,i,n,r){function o(){return a++,s}function s(){0===--a&&(e.loading=!1,e.loaded=!0,e.context2D||t._tileCache.cacheTile({image:i,tile:e,cutoff:n,tiledImage:t}),t._needsDraw=!0)}var a=0;t.viewer.raiseEvent("tile-loaded",{tile:e,tiledImage:t,tileRequest:r,image:i,getCompletionCallback:o}),o()()}function a(e,i,n,r,o,s){var a=e.bounds.getTopLeft();a.x*=s._scaleSpring.current.value,a.y*=s._scaleSpring.current.value,a.x+=s._xSpring.current.value,a.y+=s._ySpring.current.value;var l=e.bounds.getSize();l.x*=s._scaleSpring.current.value,l.y*=s._scaleSpring.current.value;var h=n.pixelFromPointNoRotate(a,!0),c=n.pixelFromPointNoRotate(a,!1),u=n.deltaPixelsFromPointsNoRotate(l,!0),d=n.deltaPixelsFromPointsNoRotate(l,!1),f=c.plus(d.divide(2)),p=r.squaredDistanceTo(f);i||(u=u.plus(new t.Point(1,1))),e.position=h,e.size=u,e.squaredDistance=p,e.visibility=o}function l(t,e,i,n,r,o,s){var a,l,h=1e3*t.blendTime;if(e.blendStart||(e.blendStart=s),a=s-e.blendStart,l=h?Math.min(1,a/h):1,t.alwaysBlend&&(l*=o),e.opacity=l,t.lastDrawn.push(e),1==l)u(t.coverage,r,i,n,!0),t._hasOpaqueTile=!0;else if(a<h)return!0;return!1}function h(t,e,i,n){var r,o,s,a;if(!t[e])return!1;if(i===undefined||n===undefined){r=t[e];for(s in r)if(r.hasOwnProperty(s)){o=r[s];for(a in o)if(o.hasOwnProperty(a)&&!o[a])return!1}return!0}return t[e][i]===undefined||t[e][i][n]===undefined||!0===t[e][i][n]}function c(t,e,i,n){return i===undefined||n===undefined?h(t,e+1):h(t,e+1,2*i,2*n)&&h(t,e+1,2*i,2*n+1)&&h(t,e+1,2*i+1,2*n)&&h(t,e+1,2*i+1,2*n+1)}function u(e,i,n,r,o){if(!e[i])return void t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i);e[i][n]||(e[i][n]={}),e[i][n][r]=o}function d(t,e){t[e]={}}function f(t,e){return t?e.visibility>t.visibility?e:e.visibility==t.visibility&&e.squaredDistance<t.squaredDistance?e:t:e}function p(e,i){if(0!==e.opacity&&0!==i.length){var n,r,o=i[0],s=e.opacity<1||e.compositeOperation&&"source-over"!==e.compositeOperation||!e._isBottomItem()&&o._hasTransparencyChannel(),a=e.viewport.getZoom(!0),l=e.viewportToImageZoom(a);i.length>1&&l>e.smoothTileEdgesMinZoom&&!e.iOSDevice&&e.getRotation(!0)%360==0&&t.supportsCanvas&&(s=!0,n=o.getScaleForEdgeSmoothing(),r=o.getTranslationForEdgeSmoothing(n,e._drawer.getCanvasSize(!1),e._drawer.getCanvasSize(!0)));var h;s&&(n||(h=e.viewport.viewportToViewerElementRectangle(e.getClippedBounds(!0)).getIntegerBoundingBox().times(t.pixelDensityRatio)),e._drawer._clear(!0,h)),n||(0!==e.viewport.degrees&&e._drawer._offsetForRotation({degrees:e.viewport.degrees,useSketch:s}),e.getRotation(!0)%360!=0&&e._drawer._offsetForRotation({degrees:e.getRotation(!0),point:e.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:s}));var c=!1;if(e._clip){e._drawer.saveContext(s);var u=e.imageToViewportRectangle(e._clip,!0);u=u.rotate(-e.getRotation(!0),e._getRotationPoint(!0));var d=e._drawer.viewportToDrawerRectangle(u);n&&(d=d.times(n)),r&&(d=d.translate(r)),e._drawer.setClip(d,s),c=!0}if(e.placeholderFillStyle&&!1===e._hasOpaqueTile){var f=e._drawer.viewportToDrawerRectangle(e.getBounds(!0));n&&(f=f.times(n)),r&&(f=f.translate(r));var p=null;p="function"==typeof e.placeholderFillStyle?e.placeholderFillStyle(e,e._drawer.context):e.placeholderFillStyle,e._drawer.drawRectangle(f,p,s)}for(var m=i.length-1;m>=0;m--)o=i[m],e._drawer.drawTile(o,e._drawingHandler,s,n,r),o.beingDrawn=!0,e.viewer&&e.viewer.raiseEvent("tile-drawn",{tiledImage:e,tile:o});c&&e._drawer.restoreContext(s),n||(e.getRotation(!0)%360!=0&&e._drawer._restoreRotationChanges(s),0!==e.viewport.degrees&&e._drawer._restoreRotationChanges(s)),s&&(n&&(0!==e.viewport.degrees&&e._drawer._offsetForRotation({degrees:e.viewport.degrees,useSketch:!1}),e.getRotation(!0)%360!=0&&e._drawer._offsetForRotation({degrees:e.getRotation(!0),point:e.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:!1})),e._drawer.blendSketch({opacity:e.opacity,scale:n,translate:r,compositeOperation:e.compositeOperation,bounds:h}),n&&(e.getRotation(!0)%360!=0&&e._drawer._restoreRotationChanges(!1),0!==e.viewport.degrees&&e._drawer._restoreRotationChanges(!1))),g(e,i)}}function g(e,i){if(e.debugMode)for(var n=i.length-1;n>=0;n--){var r=i[n];try{e._drawer.drawDebugInfo(r,i.length,n,e)}catch(e){t.console.error(e)}}}t.TiledImage=function(e){var i=this;t.console.assert(e.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(e.drawer,"[TiledImage] options.drawer is required"),t.console.assert(e.viewer,"[TiledImage] options.viewer is required"),t.console.assert(e.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(e.source,"[TiledImage] options.source is required"),
t.console.assert(!e.clip||e.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=e.tileCache,delete e.tileCache,this._drawer=e.drawer,delete e.drawer,this._imageLoader=e.imageLoader,delete e.imageLoader,e.clip instanceof t.Rect&&(this._clip=e.clip.clone()),delete e.clip;var n=e.x||0;delete e.x;var r=e.y||0;delete e.y,this.normHeight=e.source.dimensions.y/e.source.dimensions.x,this.contentAspectX=e.source.dimensions.x/e.source.dimensions.y;var o=1;e.width?(o=e.width,delete e.width,e.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete e.height)):e.height&&(o=e.height/this.normHeight,delete e.height);var s=e.fitBounds;delete e.fitBounds;var a=e.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete e.fitBoundsPlacement;var l=e.degrees||0;delete e.degrees,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation},e),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),s&&this.fitBounds(s,a,!0),this._drawingHandler=function(e){i.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:i},e))}},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(t){t!==this._fullyLoaded&&(this._fullyLoaded=t,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var t=this._xSpring.update(),e=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(t||e||i||n)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){(0!==this.opacity||this._preload)&&(this._midDraw=!0,this._updateViewport(),this._midDraw=!1)},destroy:function(){this.reset()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(this.getRotation(t),this._getRotationPoint(t))},getBoundsNoRotate:function(e){return e?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(e){var i=this.getBoundsNoRotate(e);if(this._clip){var n=e?this._worldWidthCurrent:this._worldWidthTarget,r=n/this.source.dimensions.x,o=this._clip.times(r);i=new t.Rect(i.x+o.x,i.y+o.y,o.width,o.height)}return i.rotate(this.getRotation(e),this._getRotationPoint(e))},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(e,i,n){var r=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(e*(this.source.dimensions.x/r),i*(this.source.dimensions.y*this.contentAspectX/r))},viewportToImageCoordinates:function(e,i,n){var r;return e instanceof t.Point?(n=i,r=e):r=new t.Point(e,i),r=r.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(r.x-this._xSpring.current.value,r.y-this._ySpring.current.value):this._viewportToImageDelta(r.x-this._xSpring.target.value,r.y-this._ySpring.target.value)},_imageToViewportDelta:function(e,i,n){var r=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(e/this.source.dimensions.x*r,i/this.source.dimensions.y/this.contentAspectX*r)},imageToViewportCoordinates:function(e,i,n){e instanceof t.Point&&(n=i,i=e.y,e=e.x);var r=this._imageToViewportDelta(e,i);return n?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(e,i,n,r,o){var s=e;s instanceof t.Rect?o=i:s=new t.Rect(e,i,n,r);var a=this.imageToViewportCoordinates(s.getTopLeft(),o),l=this._imageToViewportDelta(s.width,s.height,o);return new t.Rect(a.x,a.y,l.x,l.y,s.degrees+this.getRotation(o))},viewportToImageRectangle:function(e,i,n,r,o){var s=e;e instanceof t.Rect?o=i:s=new t.Rect(e,i,n,r);var a=this.viewportToImageCoordinates(s.getTopLeft(),o),l=this._viewportToImageDelta(s.width,s.height,o);return new t.Rect(a.x,a.y,l.x,l.y,s.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(t){var e=this.viewport.pointFromPixel(t,!0);return this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(t){var e=this.imageToViewportCoordinates(t);return this.viewport.pixelFromPoint(e,!0)},windowToImageCoordinates:function(t){var e=t.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(t){return this.imageToViewerElementCoordinates(t).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(e){var i=this._scaleSpring.current.value;return e=e.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((e.x-this._xSpring.current.value)/i,(e.y-this._ySpring.current.value)/i,e.width/i,e.height/i,e.degrees)},viewportToImageZoom:function(t){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*t},imageToViewportZoom:function(t){return t/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(t,e){var i=this._xSpring.target.value===t.x&&this._ySpring.target.value===t.y;if(e){if(i&&this._xSpring.current.value===t.x&&this._ySpring.current.value===t.y)return;this._xSpring.resetTo(t.x),this._ySpring.resetTo(t.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(t.x),this._ySpring.springTo(t.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(t,e){this._setScale(t,e)},setHeight:function(t,e){this._setScale(t/this.normHeight,e)},fitBounds:function(e,i,n){i=i||t.Placement.CENTER;var r=t.Placement.properties[i],o=this.contentAspectX,s=0,a=0,l=1,h=1;if(this._clip&&(o=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,h=this._clip.height/this.source.dimensions.y,e.getAspectRatio()>o?(s=this._clip.x/this._clip.height*e.height,a=this._clip.y/this._clip.height*e.height):(s=this._clip.x/this._clip.width*e.width,a=this._clip.y/this._clip.width*e.width)),e.getAspectRatio()>o){var c=e.height/h,u=0;r.isHorizontallyCentered?u=(e.width-e.height*o)/2:r.isRight&&(u=e.width-e.height*o),this.setPosition(new t.Point(e.x-s+u,e.y-a),n),this.setHeight(c,n)}else{var d=e.width/l,f=0;r.isVerticallyCentered?f=(e.height-e.width/o)/2:r.isBottom&&(f=e.height-e.width/o),this.setPosition(new t.Point(e.x-s,e.y-a+f),n),this.setWidth(d,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){t.console.assert(!e||e instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),e instanceof t.Rect?this._clip=e.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(t){t!==this.opacity&&(this.opacity=t,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(t){this._preload=!!t,this._needsDraw=!0},getRotation:function(t){return t?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(t,e){this._degreesSpring.target.value===t&&this._degreesSpring.isAtTargetValue()||(e?this._degreesSpring.resetTo(t):this._degreesSpring.springTo(t),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(t){return this.getBoundsNoRotate(t).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(t){t!==this.compositeOperation&&(this.compositeOperation=t,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(t,e){var i=this._scaleSpring.target.value===t;if(e){if(i&&this._scaleSpring.current.value===t)return;this._scaleSpring.resetTo(t),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(t),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var t=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),e=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(e/this.minPixelRatio)/Math.log(2))));return t=Math.min(t,i),{lowestLevel:t,highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var i=this.viewport,n=this._viewportToTiledImageRectangle(i.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var o=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(n=n.intersection(o)))return}for(var s=this._getLevelsInterval(),a=s.lowestLevel,l=s.highestLevel,c=null,u=!1,d=t.now(),f=l;f>=a;f--){var g=!1,m=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(f),!0).x*this._scaleSpring.current.value;if(f===a||!u&&m>=this.minPixelRatio)g=!0,u=!0;else if(!u)continue;var v=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(f),!1).x*this._scaleSpring.current.value,y=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,b=this.immediateRender?1:y;if(c=e(this,u,g,f,Math.min(1,(m-.5)/.5),b/Math.abs(b-v),n,d,c),h(this.coverage,f))break}p(this,this.lastDrawn),c&&!c.context2D?(r(this,c,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(e,i,n){var r,o;this.wrapHorizontal?(r=t.positiveModulo(i.x,1),o=t.positiveModulo(n.x,1)):(r=Math.max(0,i.x),o=Math.min(1,n.x));var s,a,l=1/this.source.aspectRatio;this.wrapVertical?(s=t.positiveModulo(i.y,l),a=t.positiveModulo(n.y,l)):(s=Math.max(0,i.y),a=Math.min(l,n.y));var h=this.source.getTileAtPoint(e,new t.Point(r,s)),c=this.source.getTileAtPoint(e,new t.Point(o,a)),u=this.source.getNumTiles(e);return this.wrapHorizontal&&(h.x+=u.x*Math.floor(i.x),c.x+=u.x*Math.floor(n.x)),this.wrapVertical&&(h.y+=u.y*Math.floor(i.y/l),c.y+=u.y*Math.floor(n.y/l)),{topLeft:h,bottomRight:c}}})}(OpenSeadragon),function(t){var e=function(e){t.console.assert(e,"[TileCache.cacheTile] options is required"),t.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=e.tile,this.tiledImage=e.tiledImage},i=function(e){t.console.assert(e,"[ImageRecord] options is required"),t.console.assert(e.image,"[ImageRecord] options.image is required"),this._image=e.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var t=document.createElement("canvas");t.width=this._image.width,t.height=this._image.height,this._renderedContext=t.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(e){t.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=e},addTile:function(e){t.console.assert(e,"[ImageRecord.addTile] tile is required"),this._tiles.push(e)},removeTile:function(e){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===e)return void this._tiles.splice(i,1);t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(e){e=e||{},this._maxImageCacheCount=e.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var r=n.cutoff||0,o=this._tilesLoaded.length,s=this._imagesLoaded[n.tile.cacheKey];if(s||(t.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),s=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),s.addTile(n.tile),n.tile.cacheImageRecord=s,this._imagesLoadedCount>this._maxImageCacheCount){for(var a,l,h,c,u,d,f=null,p=-1,g=null,m=this._tilesLoaded.length-1;m>=0;m--)d=this._tilesLoaded[m],a=d.tile,a.level<=r||a.beingDrawn||(f?(c=a.lastTouchTime,l=f.lastTouchTime,u=a.level,h=f.level,(c<l||c==l&&u>h)&&(f=a,p=m,g=d)):(f=a,p=m,g=d));f&&p>=0&&(this._unloadTile(g),o=p)}this._tilesLoaded[o]=new e({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(e){t.console.assert(e,"[TileCache.clearTilesFor] tiledImage is required");for(var i,n=0;n<this._tilesLoaded.length;++n)i=this._tilesLoaded[n],i.tiledImage===e&&(this._unloadTile(i),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(e){return t.console.assert(e,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[e]},_unloadTile:function(e){t.console.assert(e,"[TileCache._unloadTile] tileRecord is required");var i=e.tile,n=e.tiledImage;i.unload(),i.cacheImageRecord=null;var r=this._imagesLoaded[i.cacheKey];r.removeTile(i),r.getTileCount()||(r.destroy(),delete this._imagesLoaded[i.cacheKey],this._imagesLoadedCount--),n.viewer.raiseEvent("tile-unloaded",{tile:i,tiledImage:n})}}}(OpenSeadragon),function(t){t.World=function(e){var i=this;t.console.assert(e.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(e,i){if(t.console.assert(e,"[World.addItem] item is required"),t.console.assert(e instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),i=i||{},i.index!==undefined){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,e)}else this._items.push(e);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return t.console.assert(e!==undefined,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return t.console.assert(e,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,i){t.console.assert(e,"[World.setItemIndex] item is required"),t.console.assert(i!==undefined,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(e);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:n,newIndex:i}))},removeItem:function(e){t.console.assert(e,"[World.removeItem] item is required");var i=t.indexOf(this._items,e);-1!==i&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){this.viewer._cancelPendingImages();var t,e;for(e=0;e<this._items.length;e++)t=this._items[e],t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,e=0;e<i.length;e++)t=i[e],this._raiseRemoveItem(t)},resetItems:function(){for(var t=0;t<this._items.length;t++)this._items[t].reset()},update:function(){for(var t=!1,e=0;e<this._items.length;e++)t=this._items[e].update()||t;return t},draw:function(){for(var t=0;t<this._items.length;t++)this._items[t].draw();this._needsDraw=!1},needsDraw:function(){for(var t=0;t<this._items.length;t++)if(this._items[t].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(t){this._autoRefigureSizes=t,t&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){e=e||{};var i,n=e.immediately||!1,r=e.layout||t.DEFAULT_SETTINGS.collectionLayout,o=e.rows||t.DEFAULT_SETTINGS.collectionRows,s=e.columns||t.DEFAULT_SETTINGS.collectionColumns,a=e.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,l=e.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,h=a+l;i=!e.rows&&s?s:Math.ceil(this._items.length/o);var c,u,d,f,p,g=0,m=0;this.setAutoRefigureSizes(!1);for(var v=0;v<this._items.length;v++)v&&v%i==0&&("horizontal"===r?(m+=h,g=0):(g+=h,m=0)),c=this._items[v],u=c.getBounds(),d=u.width>u.height?a:a*(u.width/u.height),f=d*(u.height/u.width),p=new t.Point(g+(a-d)/2,m+(a-f)/2),c.setPosition(p,n),c.setWidth(d,n),"horizontal"===r?g+=h:m+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var r=this._items[0],o=r.getBounds();this._contentFactor=r.getContentSize().x/o.width;for(var s=r.getClippedBounds().getBoundingBox(),a=s.x,l=s.y,h=s.x+s.width,c=s.y+s.height,u=1;u<this._items.length;u++)r=this._items[u],o=r.getBounds(),this._contentFactor=Math.max(this._contentFactor,r.getContentSize().x/o.width),s=r.getClippedBounds().getBoundingBox(),a=Math.min(a,s.x),l=Math.min(l,s.y),h=Math.max(h,s.x+s.width),c=Math.max(c,s.y+s.height);this._homeBounds=new t.Rect(a,l,h-a,c-l),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(e)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(t){this.raiseEvent("remove-item",{item:t})}})}(OpenSeadragon),function(t){"use strict";function e(t){for(var e=window,i=t.split("."),n=i.pop(),r=0,o=i.length;r<o;r++)e=e[i[r]];return function(){e[n].call(this)}}var i;if(!t.fn.popover)throw new Error("Confirmation requires popover.js");var n=function(t,e){e.trigger="click",this.init(t,e)};n.VERSION="2.4.0",n.KEYMAP={13:"Enter",27:"Escape",39:"ArrowRight",40:"ArrowDown"},n.DEFAULTS=t.extend({},t.fn.popover.Constructor.DEFAULTS,{placement:"top",title:"Are you sure?",popout:!1,singleton:!1,copyAttributes:"href target",buttons:null,onConfirm:t.noop,onCancel:t.noop,btnOkClass:"btn-xs btn-primary",btnOkIcon:"glyphicon glyphicon-ok",btnOkLabel:"Yes",btnCancelClass:"btn-xs btn-default",btnCancelIcon:"glyphicon glyphicon-remove",btnCancelLabel:"No",template:'<div class="popover confirmation"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"><p class="confirmation-content"></p><div class="confirmation-buttons text-center"><div class="btn-group"><a href="#" class="btn" data-apply="confirmation"></a><a href="#" class="btn" data-dismiss="confirmation"></a></div></div></div></div>'}),n.prototype=t.extend({},t.fn.popover.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.init=function(e,i){if(t.fn.popover.Constructor.prototype.init.call(this,"confirmation",e,i),(this.options.popout||this.options.singleton)&&!i.rootSelector)throw new Error("The rootSelector option is required to use popout and singleton features since jQuery 3.");this.options._isDelegate=!1,i.selector?this.options._selector=this._options._selector=i.rootSelector+" "+i.selector:i._selector?(this.options._selector=i._selector,this.options._isDelegate=!0):this.options._selector=i.rootSelector;var n=this;this.options.selector?this.$element.on(this.options.trigger,this.options.selector,function(t,e){e||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}):(this.options._attributes={},this.options.copyAttributes?"string"==typeof this.options.copyAttributes&&(this.options.copyAttributes=this.options.copyAttributes.split(" ")):this.options.copyAttributes=[],this.options.copyAttributes.forEach(function(t){this.options._attributes[t]=this.$element.attr(t)},this),this.$element.on(this.options.trigger,function(t,e){e||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}),this.$element.on("show.bs.confirmation",function(){n.options.singleton&&t(n.options._selector).not(t(this)).filter(function(){return void 0!==t(this).data("bs.confirmation")}).confirmation("hide")})),this.options._isDelegate||(this.eventBody=!1,this.uid=this.$element[0].id||this.getUID("group_"),this.$element.on("shown.bs.confirmation",function(){n.options.popout&&!n.eventBody&&(n.eventBody=t("body").on("click.bs.confirmation."+n.uid,function(e){t(n.options._selector).is(e.target)||(t(n.options._selector).filter(function(){return void 0!==t(this).data("bs.confirmation")}).confirmation("hide"),t("body").off("click.bs."+n.uid),n.eventBody=!1)}))}))},n.prototype.hasContent=function(){return!0},n.prototype.setContent=function(){var e=this,n=this.tip(),r=this.getTitle(),o=this.getContent();if(n.find(".popover-title")[this.options.html?"html":"text"](r),n.find(".confirmation-content").toggle(!!o).children().detach().end()[this.options.html?"string"==typeof o?"html":"append":"text"](o),n.on("click",function(t){t.stopPropagation()}),this.options.buttons){var s=n.find(".confirmation-buttons .btn-group").empty();this.options.buttons.forEach(function(i){s.append(t('<a href="#"></a>').addClass(i["class"]||"btn btn-xs btn-default").html(i.label||"").attr(i.attr||{}).prepend(t("<i></i>").addClass(i.icon)," ").one("click",function(n){"#"===t(this).attr("href")&&n.preventDefault(),i.onClick&&i.onClick.call(e.$element),i.cancel?(e.getOnCancel.call(e).call(e.$element),e.$element.trigger("canceled.bs.confirmation")):(e.getOnConfirm.call(e).call(e.$element),e.$element.trigger("confirmed.bs.confirmation")),e.inState&&(e.inState.click=!1),e.hide()}))},this)}else n.find('[data-apply="confirmation"]').addClass(this.options.btnOkClass).html(this.options.btnOkLabel).attr(this.options._attributes).prepend(t("<i></i>").addClass(this.options.btnOkIcon)," ").off("click").one("click",function(i){"#"===t(this).attr("href")&&i.preventDefault(),e.getOnConfirm.call(e).call(e.$element),e.$element.trigger("confirmed.bs.confirmation"),e.$element.trigger(e.options.trigger,[!0]),e.hide()}),n.find('[data-dismiss="confirmation"]').addClass(this.options.btnCancelClass).html(this.options.btnCancelLabel).prepend(t("<i></i>").addClass(this.options.btnCancelIcon)," ").off("click").one("click",function(t){t.preventDefault(),e.getOnCancel.call(e).call(e.$element),e.$element.trigger("canceled.bs.confirmation"),e.inState&&(e.inState.click=!1),e.hide()});n.removeClass("fade top bottom left right in"),n.find(".popover-title").html()||n.find(".popover-title").hide(),i=this,t(window).off("keyup.bs.confirmation").on("keyup.bs.confirmation",this._onKeyup.bind(this))},n.prototype.destroy=function(){i===this&&(i=void 0,t(window).off("keyup.bs.confirmation")),t.fn.popover.Constructor.prototype.destroy.call(this)},n.prototype.hide=function(){i===this&&(i=void 0,t(window).off("keyup.bs.confirmation")),t.fn.popover.Constructor.prototype.hide.call(this)},n.prototype._onKeyup=function(e){if(!this.$tip)return i=void 0,void t(window).off("keyup.bs.confirmation");var r,o=e.key||n.KEYMAP[e.keyCode||e.which],s=this.$tip.find(".confirmation-buttons .btn-group"),a=s.find(".active");switch(o){case"Escape":this.hide();break;case"ArrowRight":r=a.length&&a.next().length?a.next():s.children().first(),a.removeClass("active"),r.addClass("active").focus();break;case"ArrowLeft":r=a.length&&a.prev().length?a.prev():s.children().last(),a.removeClass("active"),r.addClass("active").focus()}},n.prototype.getOnConfirm=function(){return this.$element.attr("data-on-confirm")?e(this.$element.attr("data-on-confirm")):this.options.onConfirm},n.prototype.getOnCancel=function(){return this.$element.attr("data-on-cancel")?e(this.$element.attr("data-on-cancel")):this.options.onCancel};var r=t.fn.confirmation;t.fn.confirmation=function(e){var i="object"==typeof e&&e||{};return i.rootSelector=this.selector||i.rootSelector,this.each(function(){var r=t(this),o=r.data("bs.confirmation");(o||"destroy"!=e)&&(o||r.data("bs.confirmation",o=new n(this,i)),"string"==typeof e&&(o[e](),"hide"==e&&o.inState&&(o.inState.click=!1)))})},t.fn.confirmation.Constructor=n,t.fn.confirmation.noConflict=function(){return t.fn.confirmation=r,this}}(jQuery),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CodeMirror=e()}(this,function(){"use strict";function t(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}function e(t){for(var e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function i(t,i){return e(t).appendChild(i)}function n(t,e,i,n){var r=document.createElement(t);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof e)r.appendChild(document.createTextNode(e));else if(e)for(var o=0;o<e.length;++o)r.appendChild(e[o]);return r}function r(t,e,i,r){var o=n(t,e,i,r);return o.setAttribute("role","presentation"),o}function o(t,e){if(3==e.nodeType&&(e=e.parentNode),t.contains)return t.contains(e);do{if(11==e.nodeType&&(e=e.host),e==t)return!0}while(e=e.parentNode)}function s(){var t;try{t=document.activeElement}catch(e){t=document.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function a(e,i){var n=e.className;t(i).test(n)||(e.className+=(n?" ":"")+i)}function l(e,i){for(var n=e.split(" "),r=0;r<n.length;r++)n[r]&&!t(n[r]).test(i)&&(i+=" "+n[r]);return i}function h(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function c(t,e,i){e||(e={});for(var n in t)!t.hasOwnProperty(n)||!1===i&&e.hasOwnProperty(n)||(e[n]=t[n]);return e}function u(t,e,i,n,r){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(var o=n||0,s=r||0;;){var a=t.indexOf("\t",o);if(a<0||a>=e)return s+(e-o);s+=a-o,s+=i-s%i,o=a+1}}function d(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1}function f(t,e,i){for(var n=0,r=0;;){var o=t.indexOf("\t",n);-1==o&&(o=t.length);var s=o-n;if(o==t.length||r+s>=e)return n+Math.min(s,e-r);if(r+=o-n,r+=i-r%i,n=o+1,r>=e)return n}}function p(t){for(;Ws.length<=t;)Ws.push(g(Ws)+" ");return Ws[t]}function g(t){return t[t.length-1]}function m(t,e){for(var i=[],n=0;n<t.length;n++)i[n]=e(t[n],n);return i}function v(t,e,i){for(var n=0,r=i(e);n<t.length&&i(t[n])<=r;)n++;t.splice(n,0,e)}function y(){}function b(t,e){var i;return Object.create?i=Object.create(t):(y.prototype=t,i=new y),e&&c(e,i),i}function _(t){return/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||qs.test(t))}function w(t,e){return e?!!(e.source.indexOf("\\w")>-1&&_(t))||e.test(t):_(t)}function x(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}function C(t){return t.charCodeAt(0)>=768&&Us.test(t)}function S(t,e,i){for(;(i<0?e>0:e<t.length)&&C(t.charAt(e));)e+=i;return e}function T(t,e,i){for(;;){if(Math.abs(e-i)<=1)return t(e)?e:i;var n=Math.floor((e+i)/2);t(n)?i=n:e=n}}function k(t,e,i){var o=this;this.input=i,o.scrollbarFiller=n("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=n("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=r("div",null,"CodeMirror-code"),o.selectionDiv=n("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=n("div",null,"CodeMirror-cursors"),o.measure=n("div",null,"CodeMirror-measure"),o.lineMeasure=n("div",null,"CodeMirror-measure"),o.lineSpace=r("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var s=r("div",[o.lineSpace],"CodeMirror-lines");o.mover=n("div",[s],null,"position: relative"),o.sizer=n("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=n("div",null,null,"position: absolute; height: "+Hs+"px; width: 1px;"),o.gutters=n("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=n("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=n("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),ps&&gs<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),ms||cs&&Ts||(o.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(o.wrapper):t(o.wrapper)),o.viewFrom=o.viewTo=e.first,o.reportedViewFrom=o.reportedViewTo=e.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,i.init(o)}function E(t,e){if((e-=t.first)<0||e>=t.size)throw new Error("There is no line "+(e+t.first)+" in the document.");for(var i=t;!i.lines;)for(var n=0;;++n){var r=i.children[n],o=r.chunkSize();if(e<o){i=r;break}e-=o}return i.lines[e]}function P(t,e,i){var n=[],r=e.line;return t.iter(e.line,i.line+1,function(t){var o=t.text;r==i.line&&(o=o.slice(0,i.ch)),r==e.line&&(o=o.slice(e.ch)),n.push(o),++r}),n}function D(t,e,i){var n=[];return t.iter(e,i,function(t){n.push(t.text)}),n}function I(t,e){var i=e-t.height;if(i)for(var n=t;n;n=n.parent)n.height+=i}function N(t){if(null==t.parent)return null;for(var e=t.parent,i=d(e.lines,t),n=e.parent;n;e=n,n=n.parent)for(var r=0;n.children[r]!=e;++r)i+=n.children[r].chunkSize();return i+e.first}function M(t,e){
var i=t.first;t:do{for(var n=0;n<t.children.length;++n){var r=t.children[n],o=r.height;if(e<o){t=r;continue t}e-=o,i+=r.chunkSize()}return i}while(!t.lines);for(var s=0;s<t.lines.length;++s){var a=t.lines[s],l=a.height;if(e<l)break;e-=l}return i+s}function L(t,e){return e>=t.first&&e<t.first+t.size}function A(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function R(t,e,i){if(void 0===i&&(i=null),!(this instanceof R))return new R(t,e,i);this.line=t,this.ch=e,this.sticky=i}function O(t,e){return t.line-e.line||t.ch-e.ch}function z(t,e){return t.sticky==e.sticky&&0==O(t,e)}function H(t){return R(t.line,t.ch)}function F(t,e){return O(t,e)<0?e:t}function B(t,e){return O(t,e)<0?t:e}function $(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function j(t,e){if(e.line<t.first)return R(t.first,0);var i=t.first+t.size-1;return e.line>i?R(i,E(t,i).text.length):W(e,E(t,e.line).text.length)}function W(t,e){var i=t.ch;return null==i||i>e?R(t.line,e):i<0?R(t.line,0):t}function q(t,e){for(var i=[],n=0;n<e.length;n++)i[n]=j(t,e[n]);return i}function U(){Vs=!0}function V(){Gs=!0}function G(t,e,i){this.marker=t,this.from=e,this.to=i}function Z(t,e){if(t)for(var i=0;i<t.length;++i){var n=t[i];if(n.marker==e)return n}}function K(t,e){for(var i,n=0;n<t.length;++n)t[n]!=e&&(i||(i=[])).push(t[n]);return i}function Y(t,e){t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],e.marker.attachLine(t)}function X(t,e,i){var n;if(t)for(var r=0;r<t.length;++r){var o=t[r],s=o.marker,a=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);if(a||o.from==e&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var l=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);(n||(n=[])).push(new G(s,o.from,l?null:o.to))}}return n}function J(t,e,i){var n;if(t)for(var r=0;r<t.length;++r){var o=t[r],s=o.marker,a=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);if(a||o.from==e&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var l=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);(n||(n=[])).push(new G(s,l?null:o.from-e,null==o.to?null:o.to-e))}}return n}function Q(t,e){if(e.full)return null;var i=L(t,e.from.line)&&E(t,e.from.line).markedSpans,n=L(t,e.to.line)&&E(t,e.to.line).markedSpans;if(!i&&!n)return null;var r=e.from.ch,o=e.to.ch,s=0==O(e.from,e.to),a=X(i,r,s),l=J(n,o,s),h=1==e.text.length,c=g(e.text).length+(h?r:0);if(a)for(var u=0;u<a.length;++u){var d=a[u];if(null==d.to){var f=Z(l,d.marker);f?h&&(d.to=null==f.to?null:f.to+c):d.to=r}}if(l)for(var p=0;p<l.length;++p){var m=l[p];if(null!=m.to&&(m.to+=c),null==m.from){var v=Z(a,m.marker);v||(m.from=c,h&&(a||(a=[])).push(m))}else m.from+=c,h&&(a||(a=[])).push(m)}a&&(a=tt(a)),l&&l!=a&&(l=tt(l));var y=[a];if(!h){var b,_=e.text.length-2;if(_>0&&a)for(var w=0;w<a.length;++w)null==a[w].to&&(b||(b=[])).push(new G(a[w].marker,null,null));for(var x=0;x<_;++x)y.push(b);y.push(l)}return y}function tt(t){for(var e=0;e<t.length;++e){var i=t[e];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&t.splice(e--,1)}return t.length?t:null}function et(t,e,i){var n=null;if(t.iter(e.line,i.line+1,function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var i=t.markedSpans[e].marker;!i.readOnly||n&&-1!=d(n,i)||(n||(n=[])).push(i)}}),!n)return null;for(var r=[{from:e,to:i}],o=0;o<n.length;++o)for(var s=n[o],a=s.find(0),l=0;l<r.length;++l){var h=r[l];if(!(O(h.to,a.from)<0||O(h.from,a.to)>0)){var c=[l,1],u=O(h.from,a.from),f=O(h.to,a.to);(u<0||!s.inclusiveLeft&&!u)&&c.push({from:h.from,to:a.from}),(f>0||!s.inclusiveRight&&!f)&&c.push({from:a.to,to:h.to}),r.splice.apply(r,c),l+=c.length-3}}return r}function it(t){var e=t.markedSpans;if(e){for(var i=0;i<e.length;++i)e[i].marker.detachLine(t);t.markedSpans=null}}function nt(t,e){if(e){for(var i=0;i<e.length;++i)e[i].marker.attachLine(t);t.markedSpans=e}}function rt(t){return t.inclusiveLeft?-1:0}function ot(t){return t.inclusiveRight?1:0}function st(t,e){var i=t.lines.length-e.lines.length;if(0!=i)return i;var n=t.find(),r=e.find(),o=O(n.from,r.from)||rt(t)-rt(e);if(o)return-o;var s=O(n.to,r.to)||ot(t)-ot(e);return s||e.id-t.id}function at(t,e){var i,n=Gs&&t.markedSpans;if(n)for(var r=void 0,o=0;o<n.length;++o)r=n[o],r.marker.collapsed&&null==(e?r.from:r.to)&&(!i||st(i,r.marker)<0)&&(i=r.marker);return i}function lt(t){return at(t,!0)}function ht(t){return at(t,!1)}function ct(t,e,i,n,r){var o=E(t,e),s=Gs&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var h=l.marker.find(0),c=O(h.from,i)||rt(l.marker)-rt(r),u=O(h.to,n)||ot(l.marker)-ot(r);if(!(c>=0&&u<=0||c<=0&&u>=0)&&(c<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?O(h.to,i)>=0:O(h.to,i)>0)||c>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?O(h.from,n)<=0:O(h.from,n)<0)))return!0}}}function ut(t){for(var e;e=lt(t);)t=e.find(-1,!0).line;return t}function dt(t){for(var e;e=ht(t);)t=e.find(1,!0).line;return t}function ft(t){for(var e,i;e=ht(t);)t=e.find(1,!0).line,(i||(i=[])).push(t);return i}function pt(t,e){var i=E(t,e),n=ut(i);return i==n?e:N(n)}function gt(t,e){if(e>t.lastLine())return e;var i,n=E(t,e);if(!mt(t,n))return e;for(;i=ht(n);)n=i.find(1,!0).line;return N(n)+1}function mt(t,e){var i=Gs&&e.markedSpans;if(i)for(var n=void 0,r=0;r<i.length;++r)if(n=i[r],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&vt(t,e,n))return!0}}function vt(t,e,i){if(null==i.to){var n=i.marker.find(1,!0);return vt(t,n.line,Z(n.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==e.text.length)return!0;for(var r=void 0,o=0;o<e.markedSpans.length;++o)if(r=e.markedSpans[o],r.marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(null==r.to||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&vt(t,e,r))return!0}function yt(t){t=ut(t);for(var e=0,i=t.parent,n=0;n<i.lines.length;++n){var r=i.lines[n];if(r==t)break;e+=r.height}for(var o=i.parent;o;i=o,o=i.parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==i)break;e+=a.height}return e}function bt(t){if(0==t.height)return 0;for(var e,i=t.text.length,n=t;e=lt(n);){var r=e.find(0,!0);n=r.from.line,i+=r.from.ch-r.to.ch}for(n=t;e=ht(n);){var o=e.find(0,!0);i-=n.text.length-o.from.ch,n=o.to.line,i+=n.text.length-o.to.ch}return i}function _t(t){var e=t.display,i=t.doc;e.maxLine=E(i,i.first),e.maxLineLength=bt(e.maxLine),e.maxLineChanged=!0,i.iter(function(t){var i=bt(t);i>e.maxLineLength&&(e.maxLineLength=i,e.maxLine=t)})}function wt(t,e,i,n){if(!t)return n(e,i,"ltr");for(var r=!1,o=0;o<t.length;++o){var s=t[o];(s.from<i&&s.to>e||e==i&&s.to==e)&&(n(Math.max(s.from,e),Math.min(s.to,i),1==s.level?"rtl":"ltr"),r=!0)}r||n(e,i,"ltr")}function xt(t,e,i){var n;Zs=null;for(var r=0;r<t.length;++r){var o=t[r];if(o.from<e&&o.to>e)return r;o.to==e&&(o.from!=o.to&&"before"==i?n=r:Zs=r),o.from==e&&(o.from!=o.to&&"before"!=i?n=r:Zs=r)}return null!=n?n:Zs}function Ct(t,e){var i=t.order;return null==i&&(i=t.order=Ks(t.text,e)),i}function St(t,e,i){var n=S(t.text,e+i,i);return n<0||n>t.text.length?null:n}function Tt(t,e,i){var n=St(t,e.ch,i);return null==n?null:new R(e.line,n,i<0?"after":"before")}function kt(t,e,i,n,r){if(t){var o=Ct(i,e.doc.direction);if(o){var s,a=r<0?g(o):o[0],l=r<0==(1==a.level),h=l?"after":"before";if(a.level>0){var c=Xe(e,i);s=r<0?i.text.length-1:0;var u=Je(e,c,s).top;s=T(function(t){return Je(e,c,t).top==u},r<0==(1==a.level)?a.from:a.to-1,s),"before"==h&&(s=St(i,s,1))}else s=r<0?a.to:a.from;return new R(n,s,h)}}return new R(n,r<0?i.text.length:0,r<0?"before":"after")}function Et(t,e,i,n){var r=Ct(e,t.doc.direction);if(!r)return Tt(e,i,n);i.ch>=e.text.length?(i.ch=e.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");var o=xt(r,i.ch,i.sticky),s=r[o];if("ltr"==t.doc.direction&&s.level%2==0&&(n>0?s.to>i.ch:s.from<i.ch))return Tt(e,i,n);var a,l=function(t,i){return St(e,t instanceof R?t.ch:t,i)},h=function(i){return t.options.lineWrapping?(a=a||Xe(t,e),mi(t,e,a,i)):{begin:0,end:e.text.length}},c=h("before"==i.sticky?l(i,-1):i.ch);if("rtl"==t.doc.direction||1==s.level){var u=1==s.level==n<0,d=l(i,u?1:-1);if(null!=d&&(u?d<=s.to&&d<=c.end:d>=s.from&&d>=c.begin)){var f=u?"before":"after";return new R(i.line,d,f)}}var p=function(t,e,n){for(var o=function(t,e){return e?new R(i.line,l(t,1),"before"):new R(i.line,t,"after")};t>=0&&t<r.length;t+=e){var s=r[t],a=e>0==(1!=s.level),h=a?n.begin:l(n.end,-1);if(s.from<=h&&h<s.to)return o(h,a);if(h=a?s.from:l(s.to,-1),n.begin<=h&&h<n.end)return o(h,a)}},g=p(o+n,n,c);if(g)return g;var m=n>0?c.end:l(c.begin,-1);return null==m||n>0&&m==e.text.length||!(g=p(n>0?0:r.length-1,n,h(m)))?null:g}function Pt(t,e){return t._handlers&&t._handlers[e]||Ys}function Dt(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i,!1);else if(t.detachEvent)t.detachEvent("on"+e,i);else{var n=t._handlers,r=n&&n[e];if(r){var o=d(r,i);o>-1&&(n[e]=r.slice(0,o).concat(r.slice(o+1)))}}}function It(t,e){var i=Pt(t,e);if(i.length)for(var n=Array.prototype.slice.call(arguments,2),r=0;r<i.length;++r)i[r].apply(null,n)}function Nt(t,e,i){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),It(t,i||e.type,t,e),zt(e)||e.codemirrorIgnore}function Mt(t){var e=t._handlers&&t._handlers.cursorActivity;if(e)for(var i=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]),n=0;n<e.length;++n)-1==d(i,e[n])&&i.push(e[n])}function Lt(t,e){return Pt(t,e).length>0}function At(t){t.prototype.on=function(t,e){Xs(this,t,e)},t.prototype.off=function(t,e){Dt(this,t,e)}}function Rt(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function Ot(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function zt(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function Ht(t){Rt(t),Ot(t)}function Ft(t){return t.target||t.srcElement}function Bt(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),ks&&t.ctrlKey&&1==e&&(e=3),e}function $t(t){if(null==Os){var e=n("span","\u200b");i(t,n("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Os=e.offsetWidth<=1&&e.offsetHeight>2&&!(ps&&gs<8))}var r=Os?n("span","\u200b"):n("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}function jt(t){if(null!=zs)return zs;var n=i(t,document.createTextNode("A\u062eA")),r=Is(n,0,1).getBoundingClientRect(),o=Is(n,1,2).getBoundingClientRect();return e(t),!(!r||r.left==r.right)&&(zs=o.right-r.right<3)}function Wt(t){if(null!=ia)return ia;var e=i(t,n("span","x")),r=e.getBoundingClientRect(),o=Is(e,0,1).getBoundingClientRect();return ia=Math.abs(r.left-o.left)>1}function qt(t,e){arguments.length>2&&(e.dependencies=Array.prototype.slice.call(arguments,2)),na[t]=e}function Ut(t,e){ra[t]=e}function Vt(t){if("string"==typeof t&&ra.hasOwnProperty(t))t=ra[t];else if(t&&"string"==typeof t.name&&ra.hasOwnProperty(t.name)){var e=ra[t.name];"string"==typeof e&&(e={name:e}),t=b(e,t),t.name=e.name}else{if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return Vt("application/xml");if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return Vt("application/json")}return"string"==typeof t?{name:t}:t||{name:"null"}}function Gt(t,e){e=Vt(e);var i=na[e.name];if(!i)return Gt(t,"text/plain");var n=i(t,e);if(oa.hasOwnProperty(e.name)){var r=oa[e.name];for(var o in r)r.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=r[o])}if(n.name=e.name,e.helperType&&(n.helperType=e.helperType),e.modeProps)for(var s in e.modeProps)n[s]=e.modeProps[s];return n}function Zt(t,e){c(e,oa.hasOwnProperty(t)?oa[t]:oa[t]={})}function Kt(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);var i={};for(var n in e){var r=e[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i}function Yt(t,e){for(var i;t.innerMode&&(i=t.innerMode(e))&&i.mode!=t;)e=i.state,t=i.mode;return i||{mode:t,state:e}}function Xt(t,e,i){return!t.startState||t.startState(e,i)}function Jt(t,e,i,n){var r=[t.state.modeGen],o={};se(t,e.text,t.doc.mode,i,function(t,e){return r.push(t,e)},o,n);for(var s=i.state,a=function(n){var s=t.state.overlays[n],a=1,l=0;i.state=!0,se(t,e.text,s.mode,i,function(t,e){for(var i=a;l<t;){var n=r[a];n>t&&r.splice(a,1,t,r[a+1],n),a+=2,l=Math.min(t,n)}if(e)if(s.opaque)r.splice(i,a-i,t,"overlay "+e),a=i+2;else for(;i<a;i+=2){var o=r[i+1];r[i+1]=(o?o+" ":"")+"overlay "+e}},o)},l=0;l<t.state.overlays.length;++l)a(l);return i.state=s,{styles:r,classes:o.bgClass||o.textClass?o:null}}function Qt(t,e,i){if(!e.styles||e.styles[0]!=t.state.modeGen){var n=te(t,N(e)),r=e.text.length>t.options.maxHighlightLength&&Kt(t.doc.mode,n.state),o=Jt(t,e,n);r&&(n.state=r),e.stateAfter=n.save(!r),e.styles=o.styles,o.classes?e.styleClasses=o.classes:e.styleClasses&&(e.styleClasses=null),i===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return e.styles}function te(t,e,i){var n=t.doc,r=t.display;if(!n.mode.startState)return new la(n,!0,e);var o=ae(t,e,i),s=o>n.first&&E(n,o-1).stateAfter,a=s?la.fromSaved(n,s,o):new la(n,Xt(n.mode),o);return n.iter(o,e,function(i){ee(t,i.text,a);var n=a.line;i.stateAfter=n==e-1||n%5==0||n>=r.viewFrom&&n<r.viewTo?a.save():null,a.nextLine()}),i&&(n.modeFrontier=a.line),a}function ee(t,e,i,n){var r=t.doc.mode,o=new sa(e,t.options.tabSize,i);for(o.start=o.pos=n||0,""==e&&ie(r,i.state);!o.eol();)ne(r,o,i.state),o.start=o.pos}function ie(t,e){if(t.blankLine)return t.blankLine(e);if(t.innerMode){var i=Yt(t,e);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}}function ne(t,e,i,n){for(var r=0;r<10;r++){n&&(n[0]=Yt(t,i).mode);var o=t.token(e,i);if(e.pos>e.start)return o}throw new Error("Mode "+t.name+" failed to advance stream.")}function re(t,e,i,n){var r,o=t.doc,s=o.mode;e=j(o,e);var a,l=E(o,e.line),h=te(t,e.line,i),c=new sa(l.text,t.options.tabSize,h);for(n&&(a=[]);(n||c.pos<e.ch)&&!c.eol();)c.start=c.pos,r=ne(s,c,h.state),n&&a.push(new ha(c,r,Kt(o.mode,h.state)));return n?a:new ha(c,r,h.state)}function oe(t,e){if(t)for(;;){var i=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;t=t.slice(0,i.index)+t.slice(i.index+i[0].length);var n=i[1]?"bgClass":"textClass";null==e[n]?e[n]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(e[n])||(e[n]+=" "+i[2])}return t}function se(t,e,i,n,r,o,s){var a=i.flattenSpans;null==a&&(a=t.options.flattenSpans);var l,h=0,c=null,u=new sa(e,t.options.tabSize,n),d=t.options.addModeClass&&[null];for(""==e&&oe(ie(i,n.state),o);!u.eol();){if(u.pos>t.options.maxHighlightLength?(a=!1,s&&ee(t,e,n,u.pos),u.pos=e.length,l=null):l=oe(ne(i,u,n.state,d),o),d){var f=d[0].name;f&&(l="m-"+(l?f+" "+l:f))}if(!a||c!=l){for(;h<u.start;)h=Math.min(u.start,h+5e3),r(h,c);c=l}u.start=u.pos}for(;h<u.pos;){var p=Math.min(u.pos,h+5e3);r(p,c),h=p}}function ae(t,e,i){for(var n,r,o=t.doc,s=i?-1:e-(t.doc.mode.innerMode?1e3:100),a=e;a>s;--a){if(a<=o.first)return o.first;var l=E(o,a-1),h=l.stateAfter;if(h&&(!i||a+(h instanceof aa?h.lookAhead:0)<=o.modeFrontier))return a;var c=u(l.text,null,t.options.tabSize);(null==r||n>c)&&(r=a-1,n=c)}return r}function le(t,e){if(t.modeFrontier=Math.min(t.modeFrontier,e),!(t.highlightFrontier<e-10)){for(var i=t.first,n=e-1;n>i;n--){var r=E(t,n).stateAfter;if(r&&(!(r instanceof aa)||n+r.lookAhead<e)){i=n+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,i)}}function he(t,e,i,n){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),it(t),nt(t,i);var r=n?n(t):1;r!=t.height&&I(t,r)}function ce(t){t.parent=null,it(t)}function ue(t,e){if(!t||/^\s*$/.test(t))return null;var i=e.addModeClass?fa:da;return i[t]||(i[t]=t.replace(/\S+/g,"cm-$&"))}function de(t,e){var i=r("span",null,null,ms?"padding-right: .1px":null),n={pre:r("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:(ps||ms)&&t.getOption("lineWrapping")};e.measure={};for(var o=0;o<=(e.rest?e.rest.length:0);o++){var s=o?e.rest[o-1]:e.line,a=void 0;n.pos=0,n.addToken=pe,jt(t.display.measure)&&(a=Ct(s,t.doc.direction))&&(n.addToken=me(n.addToken,a)),n.map=[];ye(s,n,Qt(t,s,e!=t.display.externalMeasured&&N(s))),s.styleClasses&&(s.styleClasses.bgClass&&(n.bgClass=l(s.styleClasses.bgClass,n.bgClass||"")),s.styleClasses.textClass&&(n.textClass=l(s.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild($t(t.display.measure))),0==o?(e.measure.map=n.map,e.measure.cache={}):((e.measure.maps||(e.measure.maps=[])).push(n.map),(e.measure.caches||(e.measure.caches=[])).push({}))}if(ms){var h=n.content.lastChild;(/\bcm-tab\b/.test(h.className)||h.querySelector&&h.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return It(t,"renderLine",t,e.line,n.pre),n.pre.className&&(n.textClass=l(n.pre.className,n.textClass||"")),n}function fe(t){var e=n("span","\u2022","cm-invalidchar");return e.title="\\u"+t.charCodeAt(0).toString(16),e.setAttribute("aria-label",e.title),e}function pe(t,e,i,r,o,s,a){if(e){var l,h=t.splitSpaces?ge(e,t.trailingSpace):e,c=t.cm.state.specialChars,u=!1;if(c.test(e)){l=document.createDocumentFragment();for(var d=0;;){c.lastIndex=d;var f=c.exec(e),g=f?f.index-d:e.length-d;if(g){var m=document.createTextNode(h.slice(d,d+g));ps&&gs<9?l.appendChild(n("span",[m])):l.appendChild(m),t.map.push(t.pos,t.pos+g,m),t.col+=g,t.pos+=g}if(!f)break;d+=g+1;var v=void 0;if("\t"==f[0]){var y=t.cm.options.tabSize,b=y-t.col%y;v=l.appendChild(n("span",p(b),"cm-tab")),v.setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),t.col+=b}else"\r"==f[0]||"\n"==f[0]?(v=l.appendChild(n("span","\r"==f[0]?"\u240d":"\u2424","cm-invalidchar")),v.setAttribute("cm-text",f[0]),t.col+=1):(v=t.cm.options.specialCharPlaceholder(f[0]),v.setAttribute("cm-text",f[0]),ps&&gs<9?l.appendChild(n("span",[v])):l.appendChild(v),t.col+=1);t.map.push(t.pos,t.pos+1,v),t.pos++}}else t.col+=e.length,l=document.createTextNode(h),t.map.push(t.pos,t.pos+e.length,l),ps&&gs<9&&(u=!0),t.pos+=e.length;if(t.trailingSpace=32==h.charCodeAt(e.length-1),i||r||o||u||a){var _=i||"";r&&(_+=r),o&&(_+=o);var w=n("span",[l],_,a);return s&&(w.title=s),t.content.appendChild(w)}t.content.appendChild(l)}}function ge(t,e){if(t.length>1&&!/  /.test(t))return t;for(var i=e,n="",r=0;r<t.length;r++){var o=t.charAt(r);" "!=o||!i||r!=t.length-1&&32!=t.charCodeAt(r+1)||(o="\xa0"),n+=o,i=" "==o}return n}function me(t,e){return function(i,n,r,o,s,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var h=i.pos,c=h+n.length;;){for(var u=void 0,d=0;d<e.length&&(u=e[d],!(u.to>h&&u.from<=h));d++);if(u.to>=c)return t(i,n,r,o,s,a,l);t(i,n.slice(0,u.to-h),r,o,null,a,l),o=null,n=n.slice(u.to-h),h=u.to}}}function ve(t,e,i,n){var r=!n&&i.widgetNode;r&&t.map.push(t.pos,t.pos+e,r),!n&&t.cm.display.input.needsContentAttribute&&(r||(r=t.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",i.id)),r&&(t.cm.display.input.setUneditable(r),t.content.appendChild(r)),t.pos+=e,t.trailingSpace=!1}function ye(t,e,i){var n=t.markedSpans,r=t.text,o=0;if(n)for(var s,a,l,h,c,u,d,f=r.length,p=0,g=1,m="",v=0;;){if(v==p){l=h=c=u=a="",d=null,v=Infinity;for(var y=[],b=void 0,_=0;_<n.length;++_){var w=n[_],x=w.marker;"bookmark"==x.type&&w.from==p&&x.widgetNode?y.push(x):w.from<=p&&(null==w.to||w.to>p||x.collapsed&&w.to==p&&w.from==p)?(null!=w.to&&w.to!=p&&v>w.to&&(v=w.to,h=""),x.className&&(l+=" "+x.className),x.css&&(a=(a?a+";":"")+x.css),x.startStyle&&w.from==p&&(c+=" "+x.startStyle),x.endStyle&&w.to==v&&(b||(b=[])).push(x.endStyle,w.to),x.title&&!u&&(u=x.title),x.collapsed&&(!d||st(d.marker,x)<0)&&(d=w)):w.from>p&&v>w.from&&(v=w.from)}if(b)for(var C=0;C<b.length;C+=2)b[C+1]==v&&(h+=" "+b[C]);if(!d||d.from==p)for(var S=0;S<y.length;++S)ve(e,0,y[S]);if(d&&(d.from||0)==p){if(ve(e,(null==d.to?f+1:d.to)-p,d.marker,null==d.from),null==d.to)return;d.to==p&&(d=!1)}}if(p>=f)break;for(var T=Math.min(f,v);;){if(m){var k=p+m.length;if(!d){var E=k>T?m.slice(0,T-p):m;e.addToken(e,E,s?s+l:l,c,p+E.length==v?h:"",u,a)}if(k>=T){m=m.slice(T-p),p=T;break}p=k,c=""}m=r.slice(o,o=i[g++]),s=ue(i[g++],e.cm.options)}}else for(var P=1;P<i.length;P+=2)e.addToken(e,r.slice(o,o=i[P]),ue(i[P+1],e.cm.options))}function be(t,e,i){this.line=e,this.rest=ft(e),this.size=this.rest?N(g(this.rest))-i+1:1,this.node=this.text=null,this.hidden=mt(t,e)}function _e(t,e,i){for(var n,r=[],o=e;o<i;o=n){var s=new be(t.doc,E(t.doc,o),o);n=o+s.size,r.push(s)}return r}function we(t){pa?pa.ops.push(t):t.ownsGroup=pa={ops:[t],delayedCallbacks:[]}}function xe(t){var e=t.delayedCallbacks,i=0;do{for(;i<e.length;i++)e[i].call(null);for(var n=0;n<t.ops.length;n++){var r=t.ops[n];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(i<e.length)}function Ce(t,e){var i=t.ownsGroup;if(i)try{xe(i)}finally{pa=null,e(i)}}function Se(t,e){var i=Pt(t,e);if(i.length){var n,r=Array.prototype.slice.call(arguments,2);pa?n=pa.delayedCallbacks:ga?n=ga:(n=ga=[],setTimeout(Te,0));for(var o=function(t){n.push(function(){return i[t].apply(null,r)})},s=0;s<i.length;++s)o(s)}}function Te(){var t=ga;ga=null;for(var e=0;e<t.length;++e)t[e]()}function ke(t,e,i,n){for(var r=0;r<e.changes.length;r++){var o=e.changes[r];"text"==o?Ie(t,e):"gutter"==o?Me(t,e,i,n):"class"==o?Ne(t,e):"widget"==o&&Le(t,e,n)}e.changes=null}function Ee(t){return t.node==t.text&&(t.node=n("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),ps&&gs<8&&(t.node.style.zIndex=2)),t.node}function Pe(t,e){var i=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),e.background)i?e.background.className=i:(e.background.parentNode.removeChild(e.background),e.background=null);else if(i){var r=Ee(e);e.background=r.insertBefore(n("div",null,i),r.firstChild),t.display.input.setUneditable(e.background)}}function De(t,e){var i=t.display.externalMeasured;return i&&i.line==e.line?(t.display.externalMeasured=null,e.measure=i.measure,i.built):de(t,e)}function Ie(t,e){var i=e.text.className,n=De(t,e);e.text==e.node&&(e.node=n.pre),e.text.parentNode.replaceChild(n.pre,e.text),e.text=n.pre,n.bgClass!=e.bgClass||n.textClass!=e.textClass?(e.bgClass=n.bgClass,e.textClass=n.textClass,Ne(t,e)):i&&(e.text.className=i)}function Ne(t,e){Pe(t,e),e.line.wrapClass?Ee(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var i=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=i||""}function Me(t,e,i,r){if(e.gutter&&(e.node.removeChild(e.gutter),e.gutter=null),e.gutterBackground&&(e.node.removeChild(e.gutterBackground),e.gutterBackground=null),e.line.gutterClass){var o=Ee(e);e.gutterBackground=n("div",null,"CodeMirror-gutter-background "+e.line.gutterClass,"left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),t.display.input.setUneditable(e.gutterBackground),o.insertBefore(e.gutterBackground,e.text)}var s=e.line.gutterMarkers;if(t.options.lineNumbers||s){var a=Ee(e),l=e.gutter=n("div",null,"CodeMirror-gutter-wrapper","left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(t.display.input.setUneditable(l),a.insertBefore(l,e.text),e.line.gutterClass&&(l.className+=" "+e.line.gutterClass),!t.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(e.lineNumber=l.appendChild(n("div",A(t.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+t.display.lineNumInnerWidth+"px"))),s)for(var h=0;h<t.options.gutters.length;++h){var c=t.options.gutters[h],u=s.hasOwnProperty(c)&&s[c];u&&l.appendChild(n("div",[u],"CodeMirror-gutter-elt","left: "+r.gutterLeft[c]+"px; width: "+r.gutterWidth[c]+"px"))}}}function Le(t,e,i){e.alignable&&(e.alignable=null);for(var n=e.node.firstChild,r=void 0;n;n=r)r=n.nextSibling,"CodeMirror-linewidget"==n.className&&e.node.removeChild(n);Re(t,e,i)}function Ae(t,e,i,n){var r=De(t,e);return e.text=e.node=r.pre,r.bgClass&&(e.bgClass=r.bgClass),r.textClass&&(e.textClass=r.textClass),Ne(t,e),Me(t,e,i,n),Re(t,e,n),e.node}function Re(t,e,i){if(Oe(t,e.line,e,i,!0),e.rest)for(var n=0;n<e.rest.length;n++)Oe(t,e.rest[n],e,i,!1)}function Oe(t,e,i,r,o){if(e.widgets)for(var s=Ee(i),a=0,l=e.widgets;a<l.length;++a){var h=l[a],c=n("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),ze(h,c,i,r),t.display.input.setUneditable(c),o&&h.above?s.insertBefore(c,i.gutter||i.text):s.appendChild(c),Se(h,"redraw")}}function ze(t,e,i,n){if(t.noHScroll){(i.alignable||(i.alignable=[])).push(e);var r=n.wrapperWidth;e.style.left=n.fixedPos+"px",t.coverGutter||(r-=n.gutterTotalWidth,e.style.paddingLeft=n.gutterTotalWidth+"px"),e.style.width=r+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-n.gutterTotalWidth+"px"))}function He(t){if(null!=t.height)return t.height;var e=t.doc.cm;if(!e)return 0;if(!o(document.body,t.node)){var r="position: relative;";t.coverGutter&&(r+="margin-left: -"+e.display.gutters.offsetWidth+"px;"),t.noHScroll&&(r+="width: "+e.display.wrapper.clientWidth+"px;"),i(e.display.measure,n("div",[t.node],null,r))}return t.height=t.node.parentNode.offsetHeight}function Fe(t,e){for(var i=Ft(e);i!=t.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==t.sizer&&i!=t.mover)return!0}function Be(t){return t.lineSpace.offsetTop}function $e(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function je(t){if(t.cachedPaddingH)return t.cachedPaddingH;var e=i(t.measure,n("pre","x")),r=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,o={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(t.cachedPaddingH=o),o}function We(t){return Hs-t.display.nativeBarWidth}function qe(t){return t.display.scroller.clientWidth-We(t)-t.display.barWidth}function Ue(t){return t.display.scroller.clientHeight-We(t)-t.display.barHeight}function Ve(t,e,i){var n=t.options.lineWrapping,r=n&&qe(t);if(!e.measure.heights||n&&e.measure.width!=r){var o=e.measure.heights=[];if(n){e.measure.width=r;for(var s=e.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],h=s[a+1];Math.abs(l.bottom-h.bottom)>2&&o.push((l.bottom+h.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Ge(t,e,i){if(t.line==e)return{map:t.measure.map,cache:t.measure.cache};for(var n=0;n<t.rest.length;n++)if(t.rest[n]==e)return{map:t.measure.maps[n],cache:t.measure.caches[n]};for(var r=0;r<t.rest.length;r++)if(N(t.rest[r])>i)return{map:t.measure.maps[r],cache:t.measure.caches[r],before:!0}}function Ze(t,e){e=ut(e);var n=N(e),r=t.display.externalMeasured=new be(t.doc,e,n);r.lineN=n;var o=r.built=de(t,r);return r.text=o.pre,i(t.display.lineMeasure,o.pre),r}function Ke(t,e,i,n){return Je(t,Xe(t,e),i,n)}function Ye(t,e){if(e>=t.display.viewFrom&&e<t.display.viewTo)return t.display.view[Ti(t,e)];var i=t.display.externalMeasured;return i&&e>=i.lineN&&e<i.lineN+i.size?i:void 0}function Xe(t,e){var i=N(e),n=Ye(t,i);n&&!n.text?n=null:n&&n.changes&&(ke(t,n,i,_i(t)),t.curOp.forceUpdate=!0),n||(n=Ze(t,e));var r=Ge(n,e,i);return{line:e,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function Je(t,e,i,n,r){e.before&&(i=-1);var o,s=i+(n||"");return e.cache.hasOwnProperty(s)?o=e.cache[s]:(e.rect||(e.rect=e.view.text.getBoundingClientRect()),e.hasHeights||(Ve(t,e.view,e.rect),e.hasHeights=!0),o=ei(t,e,i,n),o.bogus||(e.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}function Qe(t,e,i){for(var n,r,o,s,a,l,h=0;h<t.length;h+=3)if(a=t[h],l=t[h+1],e<a?(r=0,o=1,s="left"):e<l?(r=e-a,o=r+1):(h==t.length-3||e==l&&t[h+3]>e)&&(o=l-a,r=o-1,e>=l&&(s="right")),null!=r){if(n=t[h+2],a==l&&i==(n.insertLeft?"left":"right")&&(s=i),"left"==i&&0==r)for(;h&&t[h-2]==t[h-3]&&t[h-1].insertLeft;)n=t[2+(h-=3)],s="left";if("right"==i&&r==l-a)for(;h<t.length-3&&t[h+3]==t[h+4]&&!t[h+5].insertLeft;)n=t[(h+=3)+2],s="right";break}return{node:n,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function ti(t,e){var i=ma;if("left"==e)for(var n=0;n<t.length&&(i=t[n]).left==i.right;n++);else for(var r=t.length-1;r>=0&&(i=t[r]).left==i.right;r--);return i}function ei(t,e,i,n){var r,o=Qe(e.map,i,n),s=o.node,a=o.start,l=o.end,h=o.collapse;if(3==s.nodeType){for(var c=0;c<4;c++){for(;a&&C(e.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&C(e.line.text.charAt(o.coverStart+l));)++l;if(r=ps&&gs<9&&0==a&&l==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():ti(Is(s,a,l).getClientRects(),n),r.left||r.right||0==a)break;l=a,a-=1,h="right"}ps&&gs<11&&(r=ii(t.display.measure,r))}else{a>0&&(h=n="right");var u;r=t.options.lineWrapping&&(u=s.getClientRects()).length>1?u["right"==n?u.length-1:0]:s.getBoundingClientRect()}if(ps&&gs<9&&!a&&(!r||!r.left&&!r.right)){var d=s.parentNode.getClientRects()[0];r=d?{left:d.left,right:d.left+bi(t.display),top:d.top,bottom:d.bottom}:ma}for(var f=r.top-e.rect.top,p=r.bottom-e.rect.top,g=(f+p)/2,m=e.view.measure.heights,v=0;v<m.length-1&&!(g<m[v]);v++);var y=v?m[v-1]:0,b=m[v],_={left:("right"==h?r.right:r.left)-e.rect.left,right:("left"==h?r.left:r.right)-e.rect.left,top:y,bottom:b};return r.left||r.right||(_.bogus=!0),t.options.singleCursorHeightPerLine||(_.rtop=f,_.rbottom=p),_}function ii(t,e){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Wt(t))return e;var i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:e.left*i,right:e.right*i,top:e.top*n,bottom:e.bottom*n}}function ni(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(var e=0;e<t.rest.length;e++)t.measure.caches[e]={}}function ri(t){t.display.externalMeasure=null,e(t.display.lineMeasure);for(var i=0;i<t.display.view.length;i++)ni(t.display.view[i])}function oi(t){ri(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function si(){return ys&&Ss?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function ai(){return ys&&Ss?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function li(t,e,i,n,r){if(!r&&e.widgets)for(var o=0;o<e.widgets.length;++o)if(e.widgets[o].above){var s=He(e.widgets[o]);i.top+=s,i.bottom+=s}if("line"==n)return i;n||(n="local");var a=yt(e);if("local"==n?a+=Be(t.display):a-=t.display.viewOffset,"page"==n||"window"==n){var l=t.display.lineSpace.getBoundingClientRect();a+=l.top+("window"==n?0:ai());var h=l.left+("window"==n?0:si());i.left+=h,i.right+=h}return i.top+=a,i.bottom+=a,i}function hi(t,e,i){if("div"==i)return e;var n=e.left,r=e.top;if("page"==i)n-=si(),r-=ai();else if("local"==i||!i){var o=t.display.sizer.getBoundingClientRect();n+=o.left,r+=o.top}var s=t.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:r-s.top}}function ci(t,e,i,n,r){return n||(n=E(t.doc,e.line)),li(t,n,Ke(t,n,e.ch,r),i)}function ui(t,e,i,n,r,o){function s(e,s){var a=Je(t,r,e,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,li(t,n,a,i)}function a(t,e,i){var n=l[e],r=n.level%2!=0;return s(i?t-1:t,r!=i)}n=n||E(t.doc,e.line),r||(r=Xe(t,n));var l=Ct(n,t.doc.direction),h=e.ch,c=e.sticky;if(h>=n.text.length?(h=n.text.length,c="before"):h<=0&&(h=0,c="after"),!l)return s("before"==c?h-1:h,"before"==c);var u=xt(l,h,c),d=Zs,f=a(h,u,"before"==c);return null!=d&&(f.other=a(h,d,"before"!=c)),f}function di(t,e){var i=0;e=j(t.doc,e),t.options.lineWrapping||(i=bi(t.display)*e.ch);var n=E(t.doc,e.line),r=yt(n)+Be(t.display);return{left:i,right:i,top:r,bottom:r+n.height}}function fi(t,e,i,n,r){var o=R(t,e,i);return o.xRel=r,n&&(o.outside=!0),o}function pi(t,e,i){var n=t.doc;if((i+=t.display.viewOffset)<0)return fi(n.first,0,null,!0,-1);var r=M(n,i),o=n.first+n.size-1;if(r>o)return fi(n.first+n.size-1,E(n,o).text.length,null,!0,1);e<0&&(e=0);for(var s=E(n,r);;){var a=vi(t,s,r,e,i),l=ht(s),h=l&&l.find(0,!0);if(!l||!(a.ch>h.from.ch||a.ch==h.from.ch&&a.xRel>0))return a;r=N(s=h.to.line)}}function gi(t,e,i,n){var r=function(n){return li(t,e,Je(t,i,n),"line")},o=e.text.length,s=T(function(t){return r(t-1).bottom<=n},o,0);return o=T(function(t){return r(t).top>n},s,o),{begin:s,end:o}}function mi(t,e,i,n){return gi(t,e,i,li(t,e,Je(t,i,n),"line").top)}function vi(t,e,i,n,r){r-=yt(e);var o,s=0,a=e.text.length,l=Xe(t,e);if(Ct(e,t.doc.direction)){if(t.options.lineWrapping){var h;h=gi(t,e,l,r),s=h.begin,a=h.end}o=new R(i,Math.floor(s+(a-s)/2))
;var c,u,d=ui(t,o,"line",e,l).left,f=d<n?1:-1,p=d-n,g=Math.ceil((a-s)/4);t:do{c=p,u=o;for(var m=0;m<g;++m){var v=o;if(null==(o=Et(t,e,o,f))||o.ch<s||a<=("before"==o.sticky?o.ch-1:o.ch)){o=v;break t}}if(p=ui(t,o,"line",e,l).left-n,g>1){var y=Math.abs(p-c)/g;g=Math.min(g,Math.ceil(Math.abs(p)/y)),f=p<0?1:-1}}while(0!=p&&(g>1||f<0!=p<0&&Math.abs(p)<=Math.abs(c)));if(Math.abs(p)>Math.abs(c)){if(p<0==c<0)throw new Error("Broke out of infinite loop in coordsCharInner");o=u}}else{var b=T(function(i){var o=li(t,e,Je(t,l,i),"line");return o.top>r?(a=Math.min(i,a),!0):!(o.bottom<=r)&&(o.left>n||!(o.right<n)&&n-o.left<o.right-n)},s,a);b=S(e.text,b,1),o=new R(i,b,b==a?"before":"after")}var _=ui(t,o,"line",e,l);return(r<_.top||_.bottom<r)&&(o.outside=!0),o.xRel=n<_.left?-1:n>_.right?1:0,o}function yi(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==ua){ua=n("pre");for(var r=0;r<49;++r)ua.appendChild(document.createTextNode("x")),ua.appendChild(n("br"));ua.appendChild(document.createTextNode("x"))}i(t.measure,ua);var o=ua.offsetHeight/50;return o>3&&(t.cachedTextHeight=o),e(t.measure),o||1}function bi(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var e=n("span","xxxxxxxxxx"),r=n("pre",[e]);i(t.measure,r);var o=e.getBoundingClientRect(),s=(o.right-o.left)/10;return s>2&&(t.cachedCharWidth=s),s||10}function _i(t){for(var e=t.display,i={},n={},r=e.gutters.clientLeft,o=e.gutters.firstChild,s=0;o;o=o.nextSibling,++s)i[t.options.gutters[s]]=o.offsetLeft+o.clientLeft+r,n[t.options.gutters[s]]=o.clientWidth;return{fixedPos:wi(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:e.wrapper.clientWidth}}function wi(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function xi(t){var e=yi(t.display),i=t.options.lineWrapping,n=i&&Math.max(5,t.display.scroller.clientWidth/bi(t.display)-3);return function(r){if(mt(t.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return i?o+(Math.ceil(r.text.length/n)||1)*e:o+e}}function Ci(t){var e=t.doc,i=xi(t);e.iter(function(t){var e=i(t);e!=t.height&&I(t,e)})}function Si(t,e,i,n){var r=t.display;if(!i&&"true"==Ft(e).getAttribute("cm-not-content"))return null;var o,s,a=r.lineSpace.getBoundingClientRect();try{o=e.clientX-a.left,s=e.clientY-a.top}catch(e){return null}var l,h=pi(t,o,s);if(n&&1==h.xRel&&(l=E(t.doc,h.line).text).length==h.ch){var c=u(l,l.length,t.options.tabSize)-l.length;h=R(h.line,Math.max(0,Math.round((o-je(t.display).left)/bi(t.display))-c))}return h}function Ti(t,e){if(e>=t.display.viewTo)return null;if((e-=t.display.viewFrom)<0)return null;for(var i=t.display.view,n=0;n<i.length;n++)if((e-=i[n].size)<0)return n}function ki(t){t.display.input.showSelection(t.display.input.prepareSelection())}function Ei(t,e){for(var i=t.doc,n={},r=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=0;s<i.sel.ranges.length;s++)if(!1!==e||s!=i.sel.primIndex){var a=i.sel.ranges[s];if(!(a.from().line>=t.display.viewTo||a.to().line<t.display.viewFrom)){var l=a.empty();(l||t.options.showCursorWhenSelecting)&&Pi(t,a.head,r),l||Di(t,a,o)}}return n}function Pi(t,e,i){var r=ui(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),o=i.appendChild(n("div","\xa0","CodeMirror-cursor"));if(o.style.left=r.left+"px",o.style.top=r.top+"px",o.style.height=Math.max(0,r.bottom-r.top)*t.options.cursorHeight+"px",r.other){var s=i.appendChild(n("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"));s.style.display="",s.style.left=r.other.left+"px",s.style.top=r.other.top+"px",s.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Di(t,e,i){function r(t,e,i,r){e<0&&(e=0),e=Math.round(e),r=Math.round(r),l.appendChild(n("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px;\n                             top: "+e+"px; width: "+(null==i?u-t:i)+"px;\n                             height: "+(r-e)+"px"))}function o(e,i,n){function o(i,n){return ci(t,R(e,i),"div",h,n)}var s,l,h=E(a,e),d=h.text.length;return wt(Ct(h,a.direction),i||0,null==n?d:n,function(t,e,a){var h,f,p,g=o(t,"left");if(t==e)h=g,f=p=g.left;else{if(h=o(e-1,"right"),"rtl"==a){var m=g;g=h,h=m}f=g.left,p=h.right}null==i&&0==t&&(f=c),h.top-g.top>3&&(r(f,g.top,null,g.bottom),f=c,g.bottom<h.top&&r(f,g.bottom,null,h.top)),null==n&&e==d&&(p=u),(!s||g.top<s.top||g.top==s.top&&g.left<s.left)&&(s=g),(!l||h.bottom>l.bottom||h.bottom==l.bottom&&h.right>l.right)&&(l=h),f<c+1&&(f=c),r(f,h.top,p-f,h.bottom)}),{start:s,end:l}}var s=t.display,a=t.doc,l=document.createDocumentFragment(),h=je(t.display),c=h.left,u=Math.max(s.sizerWidth,qe(t)-s.sizer.offsetLeft)-h.right,d=e.from(),f=e.to();if(d.line==f.line)o(d.line,d.ch,f.ch);else{var p=E(a,d.line),g=E(a,f.line),m=ut(p)==ut(g),v=o(d.line,d.ch,m?p.text.length+1:null).end,y=o(f.line,m?0:null,f.ch).start;m&&(v.top<y.top-2?(r(v.right,v.top,null,v.bottom),r(c,y.top,y.left,y.bottom)):r(v.right,v.top,y.left-v.right,v.bottom)),v.bottom<y.top&&r(c,v.bottom,null,y.top)}i.appendChild(l)}function Ii(t){if(t.state.focused){var e=t.display;clearInterval(e.blinker);var i=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval(function(){return e.cursorDiv.style.visibility=(i=!i)?"":"hidden"},t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}}function Ni(t){t.state.focused||(t.display.input.focus(),Li(t))}function Mi(t){t.state.delayingBlurEvent=!0,setTimeout(function(){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,Ai(t))},100)}function Li(t,e){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(It(t,"focus",t,e),t.state.focused=!0,a(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),ms&&setTimeout(function(){return t.display.input.reset(!0)},20)),t.display.input.receivedFocus()),Ii(t))}function Ai(t,e){t.state.delayingBlurEvent||(t.state.focused&&(It(t,"blur",t,e),t.state.focused=!1,Ls(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout(function(){t.state.focused||(t.display.shift=!1)},150))}function Ri(t){for(var e=t.display,i=e.lineDiv.offsetTop,n=0;n<e.view.length;n++){var r=e.view[n],o=void 0;if(!r.hidden){if(ps&&gs<8){var s=r.node.offsetTop+r.node.offsetHeight;o=s-i,i=s}else{var a=r.node.getBoundingClientRect();o=a.bottom-a.top}var l=r.line.height-o;if(o<2&&(o=yi(e)),(l>.005||l<-.005)&&(I(r.line,o),Oi(r.line),r.rest))for(var h=0;h<r.rest.length;h++)Oi(r.rest[h])}}}function Oi(t){if(t.widgets)for(var e=0;e<t.widgets.length;++e)t.widgets[e].height=t.widgets[e].node.parentNode.offsetHeight}function zi(t,e,i){var n=i&&null!=i.top?Math.max(0,i.top):t.scroller.scrollTop;n=Math.floor(n-Be(t));var r=i&&null!=i.bottom?i.bottom:n+t.wrapper.clientHeight,o=M(e,n),s=M(e,r);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;a<o?(o=a,s=M(e,yt(E(e,a))+t.wrapper.clientHeight)):Math.min(l,e.lastLine())>=s&&(o=M(e,yt(E(e,l))-t.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function Hi(t){var e=t.display,i=e.view;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var n=wi(e)-e.scroller.scrollLeft+t.doc.scrollLeft,r=e.gutters.offsetWidth,o=n+"px",s=0;s<i.length;s++)if(!i[s].hidden){t.options.fixedGutter&&(i[s].gutter&&(i[s].gutter.style.left=o),i[s].gutterBackground&&(i[s].gutterBackground.style.left=o));var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}t.options.fixedGutter&&(e.gutters.style.left=n+r+"px")}}function Fi(t){if(!t.options.lineNumbers)return!1;var e=t.doc,i=A(t.options,e.first+e.size-1),r=t.display;if(i.length!=r.lineNumChars){var o=r.measure.appendChild(n("div",[n("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),s=o.firstChild.offsetWidth,a=o.offsetWidth-s;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(s,r.lineGutter.offsetWidth-a)+1,r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",Nn(t),!0}return!1}function Bi(t,e){if(!Nt(t,"scrollCursorIntoView")){var i=t.display,r=i.sizer.getBoundingClientRect(),o=null;if(e.top+r.top<0?o=!0:e.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!xs){var s=n("div","\u200b",null,"position: absolute;\n                         top: "+(e.top-i.viewOffset-Be(t.display))+"px;\n                         height: "+(e.bottom-e.top+We(t)+i.barHeight)+"px;\n                         left: "+e.left+"px; width: "+Math.max(2,e.right-e.left)+"px;");t.display.lineSpace.appendChild(s),s.scrollIntoView(o),t.display.lineSpace.removeChild(s)}}}function $i(t,e,i,n){null==n&&(n=0);var r;t.options.lineWrapping||e!=i||(e=e.ch?R(e.line,"before"==e.sticky?e.ch-1:e.ch,"after"):e,i="before"==e.sticky?R(e.line,e.ch+1,"before"):e);for(var o=0;o<5;o++){var s=!1,a=ui(t,e),l=i&&i!=e?ui(t,i):a;r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-n,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+n};var h=Wi(t,r),c=t.doc.scrollTop,u=t.doc.scrollLeft;if(null!=h.scrollTop&&(Yi(t,h.scrollTop),Math.abs(t.doc.scrollTop-c)>1&&(s=!0)),null!=h.scrollLeft&&(Ji(t,h.scrollLeft),Math.abs(t.doc.scrollLeft-u)>1&&(s=!0)),!s)break}return r}function ji(t,e){var i=Wi(t,e);null!=i.scrollTop&&Yi(t,i.scrollTop),null!=i.scrollLeft&&Ji(t,i.scrollLeft)}function Wi(t,e){var i=t.display,n=yi(t.display);e.top<0&&(e.top=0);var r=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:i.scroller.scrollTop,o=Ue(t),s={};e.bottom-e.top>o&&(e.bottom=e.top+o);var a=t.doc.height+$e(i),l=e.top<n,h=e.bottom>a-n;if(e.top<r)s.scrollTop=l?0:e.top;else if(e.bottom>r+o){var c=Math.min(e.top,(h?a:e.bottom)-o);c!=r&&(s.scrollTop=c)}var u=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:i.scroller.scrollLeft,d=qe(t)-(t.options.fixedGutter?i.gutters.offsetWidth:0),f=e.right-e.left>d;return f&&(e.right=e.left+d),e.left<10?s.scrollLeft=0:e.left<u?s.scrollLeft=Math.max(0,e.left-(f?0:10)):e.right>d+u-3&&(s.scrollLeft=e.right+(f?0:10)-d),s}function qi(t,e){null!=e&&(Zi(t),t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+e)}function Ui(t){Zi(t);var e=t.getCursor();t.curOp.scrollToPos={from:e,to:e,margin:t.options.cursorScrollMargin}}function Vi(t,e,i){null==e&&null==i||Zi(t),null!=e&&(t.curOp.scrollLeft=e),null!=i&&(t.curOp.scrollTop=i)}function Gi(t,e){Zi(t),t.curOp.scrollToPos=e}function Zi(t){var e=t.curOp.scrollToPos;if(e){t.curOp.scrollToPos=null;Ki(t,di(t,e.from),di(t,e.to),e.margin)}}function Ki(t,e,i,n){var r=Wi(t,{left:Math.min(e.left,i.left),top:Math.min(e.top,i.top)-n,right:Math.max(e.right,i.right),bottom:Math.max(e.bottom,i.bottom)+n});Vi(t,r.scrollLeft,r.scrollTop)}function Yi(t,e){Math.abs(t.doc.scrollTop-e)<2||(cs||Dn(t,{top:e}),Xi(t,e,!0),cs&&Dn(t),xn(t,100))}function Xi(t,e,i){e=Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,e),(t.display.scroller.scrollTop!=e||i)&&(t.doc.scrollTop=e,t.display.scrollbars.setScrollTop(e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e))}function Ji(t,e,i,n){e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),(i?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)&&!n||(t.doc.scrollLeft=e,Hi(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbars.setScrollLeft(e))}function Qi(t){var e=t.display,i=e.gutters.offsetWidth,n=Math.round(t.doc.height+$e(t.display));return{clientHeight:e.scroller.clientHeight,viewHeight:e.wrapper.clientHeight,scrollWidth:e.scroller.scrollWidth,clientWidth:e.scroller.clientWidth,viewWidth:e.wrapper.clientWidth,barLeft:t.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+We(t)+e.barHeight,nativeBarWidth:e.nativeBarWidth,gutterWidth:i}}function tn(t,e){e||(e=Qi(t));var i=t.display.barWidth,n=t.display.barHeight;en(t,e);for(var r=0;r<4&&i!=t.display.barWidth||n!=t.display.barHeight;r++)i!=t.display.barWidth&&t.options.lineWrapping&&Ri(t),en(t,Qi(t)),i=t.display.barWidth,n=t.display.barHeight}function en(t,e){var i=t.display,n=i.scrollbars.update(e);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px",i.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=n.bottom+"px",i.scrollbarFiller.style.width=n.right+"px"):i.scrollbarFiller.style.display="",n.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=n.bottom+"px",i.gutterFiller.style.width=e.gutterWidth+"px"):i.gutterFiller.style.display=""}function nn(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&Ls(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new ba[t.options.scrollbarStyle](function(e){t.display.wrapper.insertBefore(e,t.display.scrollbarFiller),Xs(e,"mousedown",function(){t.state.focused&&setTimeout(function(){return t.display.input.focus()},0)}),e.setAttribute("cm-not-content","true")},function(e,i){"horizontal"==i?Ji(t,e):Yi(t,e)},t),t.display.scrollbars.addClass&&a(t.display.wrapper,t.display.scrollbars.addClass)}function rn(t){t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++_a},we(t.curOp)}function on(t){Ce(t.curOp,function(t){for(var e=0;e<t.ops.length;e++)t.ops[e].cm.curOp=null;sn(t)})}function sn(t){for(var e=t.ops,i=0;i<e.length;i++)an(e[i]);for(var n=0;n<e.length;n++)ln(e[n]);for(var r=0;r<e.length;r++)hn(e[r]);for(var o=0;o<e.length;o++)cn(e[o]);for(var s=0;s<e.length;s++)un(e[s])}function an(t){var e=t.cm,i=e.display;Sn(e),t.updateMaxLine&&_t(e),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<i.viewFrom||t.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&e.options.lineWrapping,t.update=t.mustUpdate&&new wa(e,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function ln(t){t.updatedDisplay=t.mustUpdate&&En(t.cm,t.update)}function hn(t){var e=t.cm,i=e.display;t.updatedDisplay&&Ri(e),t.barMeasure=Qi(e),i.maxLineChanged&&!e.options.lineWrapping&&(t.adjustWidthTo=Ke(e,i.maxLine,i.maxLine.text.length).left+3,e.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+t.adjustWidthTo+We(e)+e.display.barWidth),t.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+t.adjustWidthTo-qe(e))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=i.input.prepareSelection(t.focus))}function cn(t){var e=t.cm;null!=t.adjustWidthTo&&(e.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<e.doc.scrollLeft&&Ji(e,Math.min(e.display.scroller.scrollLeft,t.maxScrollLeft),!0),e.display.maxLineChanged=!1);var i=t.focus&&t.focus==s()&&(!document.hasFocus||document.hasFocus());t.preparedSelection&&e.display.input.showSelection(t.preparedSelection,i),(t.updatedDisplay||t.startHeight!=e.doc.height)&&tn(e,t.barMeasure),t.updatedDisplay&&Mn(e,t.barMeasure),t.selectionChanged&&Ii(e),e.state.focused&&t.updateInput&&e.display.input.reset(t.typing),i&&Ni(t.cm)}function un(t){var e=t.cm,i=e.display,n=e.doc;if(t.updatedDisplay&&Pn(e,t.update),null==i.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=t.scrollTop&&Xi(e,t.scrollTop,t.forceScroll),null!=t.scrollLeft&&Ji(e,t.scrollLeft,!0,!0),t.scrollToPos){Bi(e,$i(e,j(n,t.scrollToPos.from),j(n,t.scrollToPos.to),t.scrollToPos.margin))}var r=t.maybeHiddenMarkers,o=t.maybeUnhiddenMarkers;if(r)for(var s=0;s<r.length;++s)r[s].lines.length||It(r[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&It(o[a],"unhide");i.wrapper.offsetHeight&&(n.scrollTop=e.display.scroller.scrollTop),t.changeObjs&&It(e,"changes",e,t.changeObjs),t.update&&t.update.finish()}function dn(t,e){if(t.curOp)return e();rn(t);try{return e()}finally{on(t)}}function fn(t,e){return function(){if(t.curOp)return e.apply(t,arguments);rn(t);try{return e.apply(t,arguments)}finally{on(t)}}}function pn(t){return function(){if(this.curOp)return t.apply(this,arguments);rn(this);try{return t.apply(this,arguments)}finally{on(this)}}}function gn(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);rn(e);try{return t.apply(this,arguments)}finally{on(e)}}}function mn(t,e,i,n){null==e&&(e=t.doc.first),null==i&&(i=t.doc.first+t.doc.size),n||(n=0);var r=t.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>e)&&(r.updateLineNumbers=e),t.curOp.viewChanged=!0,e>=r.viewTo)Gs&&pt(t.doc,e)<r.viewTo&&yn(t);else if(i<=r.viewFrom)Gs&&gt(t.doc,i+n)>r.viewFrom?yn(t):(r.viewFrom+=n,r.viewTo+=n);else if(e<=r.viewFrom&&i>=r.viewTo)yn(t);else if(e<=r.viewFrom){var o=bn(t,i,i+n,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=n):yn(t)}else if(i>=r.viewTo){var s=bn(t,e,e,-1);s?(r.view=r.view.slice(0,s.index),r.viewTo=s.lineN):yn(t)}else{var a=bn(t,e,e,-1),l=bn(t,i,i+n,1);a&&l?(r.view=r.view.slice(0,a.index).concat(_e(t,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=n):yn(t)}var h=r.externalMeasured;h&&(i<h.lineN?h.lineN+=n:e<h.lineN+h.size&&(r.externalMeasured=null))}function vn(t,e,i){t.curOp.viewChanged=!0;var n=t.display,r=t.display.externalMeasured;if(r&&e>=r.lineN&&e<r.lineN+r.size&&(n.externalMeasured=null),!(e<n.viewFrom||e>=n.viewTo)){var o=n.view[Ti(t,e)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==d(s,i)&&s.push(i)}}}function yn(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function bn(t,e,i,n){var r,o=Ti(t,e),s=t.display.view;if(!Gs||i==t.doc.first+t.doc.size)return{index:o,lineN:i};for(var a=t.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=e){if(n>0){if(o==s.length-1)return null;r=a+s[o].size-e,o++}else r=a-e;e+=r,i+=r}for(;pt(t.doc,i)!=i;){if(o==(n<0?0:s.length-1))return null;i+=n*s[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:i}}function _n(t,e,i){var n=t.display;0==n.view.length||e>=n.viewTo||i<=n.viewFrom?(n.view=_e(t,e,i),n.viewFrom=e):(n.viewFrom>e?n.view=_e(t,e,n.viewFrom).concat(n.view):n.viewFrom<e&&(n.view=n.view.slice(Ti(t,e))),n.viewFrom=e,n.viewTo<i?n.view=n.view.concat(_e(t,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,Ti(t,i)))),n.viewTo=i}function wn(t){for(var e=t.display.view,i=0,n=0;n<e.length;n++){var r=e[n];r.hidden||r.node&&!r.changes||++i}return i}function xn(t,e){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(e,h(Cn,t))}function Cn(t){var e=t.doc;if(!(e.highlightFrontier>=t.display.viewTo)){var i=+new Date+t.options.workTime,n=te(t,e.highlightFrontier),r=[];e.iter(n.line,Math.min(e.first+e.size,t.display.viewTo+500),function(o){if(n.line>=t.display.viewFrom){var s=o.styles,a=o.text.length>t.options.maxHighlightLength?Kt(e.mode,n.state):null,l=Jt(t,o,n,!0);a&&(n.state=a),o.styles=l.styles;var h=o.styleClasses,c=l.classes;c?o.styleClasses=c:h&&(o.styleClasses=null);for(var u=!s||s.length!=o.styles.length||h!=c&&(!h||!c||h.bgClass!=c.bgClass||h.textClass!=c.textClass),d=0;!u&&d<s.length;++d)u=s[d]!=o.styles[d];u&&r.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=t.options.maxHighlightLength&&ee(t,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>i)return xn(t,t.options.workDelay),!0}),e.highlightFrontier=n.line,e.modeFrontier=Math.max(e.modeFrontier,n.line),r.length&&dn(t,function(){for(var e=0;e<r.length;e++)vn(t,r[e],"text")})}}function Sn(t){var e=t.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=We(t)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=We(t)+"px",e.scrollbarsClipped=!0)}function Tn(t){if(t.hasFocus())return null;var e=s();if(!e||!o(t.display.lineDiv,e))return null;var i={activeElt:e};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&o(t.display.lineDiv,n.anchorNode)&&(i.anchorNode=n.anchorNode,i.anchorOffset=n.anchorOffset,i.focusNode=n.focusNode,i.focusOffset=n.focusOffset)}return i}function kn(t){if(t&&t.activeElt&&t.activeElt!=s()&&(t.activeElt.focus(),t.anchorNode&&o(document.body,t.anchorNode)&&o(document.body,t.focusNode))){var e=window.getSelection(),i=document.createRange();i.setEnd(t.anchorNode,t.anchorOffset),i.collapse(!1),e.removeAllRanges(),e.addRange(i),e.extend(t.focusNode,t.focusOffset)}}function En(t,i){var n=t.display,r=t.doc;if(i.editorIsHidden)return yn(t),!1;if(!i.force&&i.visible.from>=n.viewFrom&&i.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==wn(t))return!1;Fi(t)&&(yn(t),i.dims=_i(t));var o=r.first+r.size,s=Math.max(i.visible.from-t.options.viewportMargin,r.first),a=Math.min(o,i.visible.to+t.options.viewportMargin);n.viewFrom<s&&s-n.viewFrom<20&&(s=Math.max(r.first,n.viewFrom)),n.viewTo>a&&n.viewTo-a<20&&(a=Math.min(o,n.viewTo)),Gs&&(s=pt(t.doc,s),a=gt(t.doc,a));var l=s!=n.viewFrom||a!=n.viewTo||n.lastWrapHeight!=i.wrapperHeight||n.lastWrapWidth!=i.wrapperWidth;_n(t,s,a),n.viewOffset=yt(E(t.doc,n.viewFrom)),t.display.mover.style.top=n.viewOffset+"px";var h=wn(t);if(!l&&0==h&&!i.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var c=Tn(t);return h>4&&(n.lineDiv.style.display="none"),In(t,n.updateLineNumbers,i.dims),h>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,kn(c),e(n.cursorDiv),e(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,l&&(n.lastWrapHeight=i.wrapperHeight,n.lastWrapWidth=i.wrapperWidth,xn(t,400)),n.updateLineNumbers=null,!0}function Pn(t,e){for(var i=e.viewport,n=!0;(n&&t.options.lineWrapping&&e.oldDisplayWidth!=qe(t)||(i&&null!=i.top&&(i={top:Math.min(t.doc.height+$e(t.display)-Ue(t),i.top)}),e.visible=zi(t.display,t.doc,i),!(e.visible.from>=t.display.viewFrom&&e.visible.to<=t.display.viewTo)))&&En(t,e);n=!1){Ri(t);var r=Qi(t);ki(t),tn(t,r),Mn(t,r),e.force=!1}e.signal(t,"update",t),t.display.viewFrom==t.display.reportedViewFrom&&t.display.viewTo==t.display.reportedViewTo||(e.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function Dn(t,e){var i=new wa(t,e);if(En(t,i)){Ri(t),Pn(t,i);var n=Qi(t);ki(t),tn(t,n),Mn(t,n),i.finish()}}function In(t,i,n){function r(e){var i=e.nextSibling;return ms&&ks&&t.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),i}for(var o=t.display,s=t.options.lineNumbers,a=o.lineDiv,l=a.firstChild,h=o.view,c=o.viewFrom,u=0;u<h.length;u++){var f=h[u];if(f.hidden);else if(f.node&&f.node.parentNode==a){for(;l!=f.node;)l=r(l);var p=s&&null!=i&&i<=c&&f.lineNumber;f.changes&&(d(f.changes,"gutter")>-1&&(p=!1),ke(t,f,c,n)),p&&(e(f.lineNumber),f.lineNumber.appendChild(document.createTextNode(A(t.options,c)))),l=f.node.nextSibling}else{var g=Ae(t,f,c,n);a.insertBefore(g,l)}c+=f.size}for(;l;)l=r(l)}function Nn(t){var e=t.display.gutters.offsetWidth;t.display.sizer.style.marginLeft=e+"px"}function Mn(t,e){t.display.sizer.style.minHeight=e.docHeight+"px",t.display.heightForcer.style.top=e.docHeight+"px",t.display.gutters.style.height=e.docHeight+t.display.barHeight+We(t)+"px"}function Ln(t){var i=t.display.gutters,r=t.options.gutters;e(i);for(var o=0;o<r.length;++o){var s=r[o],a=i.appendChild(n("div",null,"CodeMirror-gutter "+s));"CodeMirror-linenumbers"==s&&(t.display.lineGutter=a,a.style.width=(t.display.lineNumWidth||1)+"px")}i.style.display=o?"":"none",Nn(t)}function An(t){var e=d(t.gutters,"CodeMirror-linenumbers");-1==e&&t.lineNumbers?t.gutters=t.gutters.concat(["CodeMirror-linenumbers"]):e>-1&&!t.lineNumbers&&(t.gutters=t.gutters.slice(0),t.gutters.splice(e,1))}function Rn(t){var e=t.wheelDeltaX,i=t.wheelDeltaY;return null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(e=t.detail),null==i&&t.detail&&t.axis==t.VERTICAL_AXIS?i=t.detail:null==i&&(i=t.wheelDelta),{x:e,y:i}}function On(t){var e=Rn(t);return e.x*=Ca,e.y*=Ca,e}function zn(t,e){var i=Rn(e),n=i.x,r=i.y,o=t.display,s=o.scroller,a=s.scrollWidth>s.clientWidth,l=s.scrollHeight>s.clientHeight;if(n&&a||r&&l){if(r&&ks&&ms)t:for(var h=e.target,c=o.view;h!=s;h=h.parentNode)for(var u=0;u<c.length;u++)if(c[u].node==h){t.display.currentWheelTarget=h;break t}if(n&&!cs&&!bs&&null!=Ca)return r&&l&&Yi(t,Math.max(0,s.scrollTop+r*Ca)),Ji(t,Math.max(0,s.scrollLeft+n*Ca)),(!r||r&&l)&&Rt(e),void(o.wheelStartX=null);if(r&&null!=Ca){var d=r*Ca,f=t.doc.scrollTop,p=f+o.wrapper.clientHeight;d<0?f=Math.max(0,f+d-50):p=Math.min(t.doc.height,p+d+50),Dn(t,{top:f,bottom:p})}xa<20&&(null==o.wheelStartX?(o.wheelStartX=s.scrollLeft,o.wheelStartY=s.scrollTop,o.wheelDX=n,o.wheelDY=r,setTimeout(function(){if(null!=o.wheelStartX){var t=s.scrollLeft-o.wheelStartX,e=s.scrollTop-o.wheelStartY,i=e&&o.wheelDY&&e/o.wheelDY||t&&o.wheelDX&&t/o.wheelDX;o.wheelStartX=o.wheelStartY=null,i&&(Ca=(Ca*xa+i)/(xa+1),++xa)}},200)):(o.wheelDX+=n,o.wheelDY+=r))}}function Hn(t,e){var i=t[e];t.sort(function(t,e){return O(t.from(),e.from())}),e=d(t,i);for(var n=1;n<t.length;n++){var r=t[n],o=t[n-1];if(O(o.to(),r.from())>=0){var s=B(o.from(),r.from()),a=F(o.to(),r.to()),l=o.empty()?r.from()==r.head:o.from()==o.head;n<=e&&--e,t.splice(--n,2,new Ta(l?a:s,l?s:a))}}return new Sa(t,e)}function Fn(t,e){return new Sa([new Ta(t,e||t)],0)}function Bn(t){return t.text?R(t.from.line+t.text.length-1,g(t.text).length+(1==t.text.length?t.from.ch:0)):t.to}function $n(t,e){if(O(t,e.from)<0)return t;if(O(t,e.to)<=0)return Bn(e);var i=t.line+e.text.length-(e.to.line-e.from.line)-1,n=t.ch;return t.line==e.to.line&&(n+=Bn(e).ch-e.to.ch),R(i,n)}function jn(t,e){for(var i=[],n=0;n<t.sel.ranges.length;n++){var r=t.sel.ranges[n];i.push(new Ta($n(r.anchor,e),$n(r.head,e)))}return Hn(i,t.sel.primIndex)}function Wn(t,e,i){return t.line==e.line?R(i.line,t.ch-e.ch+i.ch):R(i.line+(t.line-e.line),t.ch)}function qn(t,e,i){for(var n=[],r=R(t.first,0),o=r,s=0;s<e.length;s++){var a=e[s],l=Wn(a.from,r,o),h=Wn(Bn(a),r,o);if(r=a.to,o=h,"around"==i){var c=t.sel.ranges[s],u=O(c.head,c.anchor)<0;n[s]=new Ta(u?h:l,u?l:h)}else n[s]=new Ta(l,l)}return new Sa(n,t.sel.primIndex)}function Un(t){t.doc.mode=Gt(t.options,t.doc.modeOption),Vn(t)}function Vn(t){t.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,xn(t,100),t.state.modeGen++,t.curOp&&mn(t)}function Gn(t,e){return 0==e.from.ch&&0==e.to.ch&&""==g(e.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function Zn(t,e,i,n){function r(t){return i?i[t]:null}function o(t,i,r){he(t,i,r,n),Se(t,"change",t,e)}function s(t,e){for(var i=[],o=t;o<e;++o)i.push(new ca(h[o],r(o),n));return i}var a=e.from,l=e.to,h=e.text,c=E(t,a.line),u=E(t,l.line),d=g(h),f=r(h.length-1),p=l.line-a.line;if(e.full)t.insert(0,s(0,h.length)),t.remove(h.length,t.size-h.length);else if(Gn(t,e)){var m=s(0,h.length-1);o(u,u.text,f),p&&t.remove(a.line,p),m.length&&t.insert(a.line,m)}else if(c==u)if(1==h.length)o(c,c.text.slice(0,a.ch)+d+c.text.slice(l.ch),f);else{var v=s(1,h.length-1);v.push(new ca(d+c.text.slice(l.ch),f,n)),o(c,c.text.slice(0,a.ch)+h[0],r(0)),t.insert(a.line+1,v)}else if(1==h.length)o(c,c.text.slice(0,a.ch)+h[0]+u.text.slice(l.ch),r(0)),t.remove(a.line+1,p);else{o(c,c.text.slice(0,a.ch)+h[0],r(0)),o(u,d+u.text.slice(l.ch),f);var y=s(1,h.length-1);p>1&&t.remove(a.line+1,p-1),t.insert(a.line+1,y)}Se(t,"change",t,e)}function Kn(t,e,i){function n(t,r,o){if(t.linked)for(var s=0;s<t.linked.length;++s){var a=t.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;i&&!l||(e(a.doc,l),n(a.doc,t,l))}}}n(t,null,!0)}function Yn(t,e){if(e.cm)throw new Error("This document is already in use.");t.doc=e,e.cm=t,Ci(t),Un(t),Xn(t),t.options.lineWrapping||_t(t),t.options.mode=e.modeOption,mn(t)}function Xn(t){("rtl"==t.doc.direction?a:Ls)(t.display.lineDiv,"CodeMirror-rtl")}function Jn(t){dn(t,function(){Xn(t),mn(t)})}function Qn(t){this.done=[],this.undone=[],this.undoDepth=Infinity,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t||1}function tr(t,e){var i={from:H(e.from),to:Bn(e),text:P(t,e.from,e.to)};return ar(t,i,e.from.line,e.to.line+1),Kn(t,function(t){return ar(t,i,e.from.line,e.to.line+1)},!0),i}function er(t){for(;t.length;){if(!g(t).ranges)break;t.pop()}}function ir(t,e){return e?(er(t.done),g(t.done)):t.done.length&&!g(t.done).ranges?g(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),g(t.done)):void 0}function nr(t,e,i,n){var r=t.history;r.undone.length=0;var o,s,a=+new Date;if((r.lastOp==n||r.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&t.cm&&r.lastModTime>a-t.cm.options.historyEventDelay||"*"==e.origin.charAt(0)))&&(o=ir(r,r.lastOp==n)))s=g(o.changes),0==O(e.from,e.to)&&0==O(e.from,s.to)?s.to=Bn(e):o.changes.push(tr(t,e));else{var l=g(r.done);for(l&&l.ranges||sr(t.sel,r.done),o={changes:[tr(t,e)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=n,r.lastOrigin=r.lastSelOrigin=e.origin,s||It(t,"historyAdded")}function rr(t,e,i,n){var r=e.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}function or(t,e,i,n){var r=t.history,o=n&&n.origin;i==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||rr(t,o,g(r.done),e))?r.done[r.done.length-1]=e:sr(e,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=i,n&&!1!==n.clearRedo&&er(r.undone)}function sr(t,e){var i=g(e);i&&i.ranges&&i.equals(t)||e.push(t)}function ar(t,e,i,n){var r=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,i),Math.min(t.first+t.size,n),function(i){i.markedSpans&&((r||(r=e["spans_"+t.id]={}))[o]=i.markedSpans),++o})}function lr(t){if(!t)return null;for(var e,i=0;i<t.length;++i)t[i].marker.explicitlyCleared?e||(e=t.slice(0,i)):e&&e.push(t[i]);return e?e.length?e:null:t}function hr(t,e){var i=e["spans_"+t.id];if(!i)return null;for(var n=[],r=0;r<e.text.length;++r)n.push(lr(i[r]));return n}function cr(t,e){var i=hr(t,e),n=Q(t,e);if(!i)return n;if(!n)return i;for(var r=0;r<i.length;++r){var o=i[r],s=n[r];if(o&&s)t:for(var a=0;a<s.length;++a){for(var l=s[a],h=0;h<o.length;++h)if(o[h].marker==l.marker)continue t;o.push(l)}else s&&(i[r]=s)}return i}function ur(t,e,i){for(var n=[],r=0;r<t.length;++r){var o=t[r];if(o.ranges)n.push(i?Sa.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];n.push({changes:a});for(var l=0;l<s.length;++l){var h=s[l],c=void 0;if(a.push({from:h.from,to:h.to,text:h.text}),e)for(var u in h)(c=u.match(/^spans_(\d+)$/))&&d(e,Number(c[1]))>-1&&(g(a)[u]=h[u],delete h[u])}}}return n}function dr(t,e,i,n){if(n){var r=t.anchor;if(i){var o=O(e,r)<0;o!=O(i,r)<0?(r=e,e=i):o!=O(e,i)<0&&(e=i)}return new Ta(r,e)}return new Ta(i||e,e)}function fr(t,e,i,n,r){null==r&&(r=t.cm&&(t.cm.display.shift||t.extend)),br(t,new Sa([dr(t.sel.primary(),e,i,r)],0),n)}function pr(t,e,i){for(var n=[],r=t.cm&&(t.cm.display.shift||t.extend),o=0;o<t.sel.ranges.length;o++)n[o]=dr(t.sel.ranges[o],e[o],null,r);br(t,Hn(n,t.sel.primIndex),i)}function gr(t,e,i,n){var r=t.sel.ranges.slice(0);r[e]=i,br(t,Hn(r,t.sel.primIndex),n)}function mr(t,e,i,n){br(t,Fn(e,i),n)}function vr(t,e,i){var n={ranges:e.ranges,update:function(e){var i=this;this.ranges=[];for(var n=0;n<e.length;n++)i.ranges[n]=new Ta(j(t,e[n].anchor),j(t,e[n].head))},origin:i&&i.origin};return It(t,"beforeSelectionChange",t,n),t.cm&&It(t.cm,"beforeSelectionChange",t.cm,n),n.ranges!=e.ranges?Hn(n.ranges,n.ranges.length-1):e}function yr(t,e,i){var n=t.history.done,r=g(n);r&&r.ranges?(n[n.length-1]=e,_r(t,e,i)):br(t,e,i)}function br(t,e,i){_r(t,e,i),or(t,t.sel,t.cm?t.cm.curOp.id:NaN,i)}function _r(t,e,i){(Lt(t,"beforeSelectionChange")||t.cm&&Lt(t.cm,"beforeSelectionChange"))&&(e=vr(t,e,i)),wr(t,Cr(t,e,i&&i.bias||(O(e.primary().head,t.sel.primary().head)<0?-1:1),!0)),i&&!1===i.scroll||!t.cm||Ui(t.cm)}function wr(t,e){e.equals(t.sel)||(t.sel=e,t.cm&&(t.cm.curOp.updateInput=t.cm.curOp.selectionChanged=!0,Mt(t.cm)),Se(t,"cursorActivity",t))}function xr(t){wr(t,Cr(t,t.sel,null,!1))}function Cr(t,e,i,n){for(var r,o=0;o<e.ranges.length;o++){
var s=e.ranges[o],a=e.ranges.length==t.sel.ranges.length&&t.sel.ranges[o],l=Tr(t,s.anchor,a&&a.anchor,i,n),h=Tr(t,s.head,a&&a.head,i,n);(r||l!=s.anchor||h!=s.head)&&(r||(r=e.ranges.slice(0,o)),r[o]=new Ta(l,h))}return r?Hn(r,e.primIndex):e}function Sr(t,e,i,n,r){var o=E(t,e.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker;if((null==a.from||(l.inclusiveLeft?a.from<=e.ch:a.from<e.ch))&&(null==a.to||(l.inclusiveRight?a.to>=e.ch:a.to>e.ch))){if(r&&(It(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){var h=l.find(n<0?1:-1),c=void 0;if((n<0?l.inclusiveRight:l.inclusiveLeft)&&(h=kr(t,h,-n,h&&h.line==e.line?o:null)),h&&h.line==e.line&&(c=O(h,i))&&(n<0?c<0:c>0))return Sr(t,h,e,n,r)}var u=l.find(n<0?-1:1);return(n<0?l.inclusiveLeft:l.inclusiveRight)&&(u=kr(t,u,n,u.line==e.line?o:null)),u?Sr(t,u,e,n,r):null}}return e}function Tr(t,e,i,n,r){var o=n||1,s=Sr(t,e,i,o,r)||!r&&Sr(t,e,i,o,!0)||Sr(t,e,i,-o,r)||!r&&Sr(t,e,i,-o,!0);return s||(t.cantEdit=!0,R(t.first,0))}function kr(t,e,i,n){return i<0&&0==e.ch?e.line>t.first?j(t,R(e.line-1)):null:i>0&&e.ch==(n||E(t,e.line)).text.length?e.line<t.first+t.size-1?R(e.line+1,0):null:new R(e.line,e.ch+i)}function Er(t){t.setSelection(R(t.firstLine(),0),R(t.lastLine()),Bs)}function Pr(t,e,i){var n={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return n.canceled=!0}};return i&&(n.update=function(e,i,r,o){e&&(n.from=j(t,e)),i&&(n.to=j(t,i)),r&&(n.text=r),o!==undefined&&(n.origin=o)}),It(t,"beforeChange",t,n),t.cm&&It(t.cm,"beforeChange",t.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Dr(t,e,i){if(t.cm){if(!t.cm.curOp)return fn(t.cm,Dr)(t,e,i);if(t.cm.state.suppressEdits)return}if(!(Lt(t,"beforeChange")||t.cm&&Lt(t.cm,"beforeChange"))||(e=Pr(t,e,!0))){var n=Vs&&!i&&et(t,e.from,e.to);if(n)for(var r=n.length-1;r>=0;--r)Ir(t,{from:n[r].from,to:n[r].to,text:r?[""]:e.text});else Ir(t,e)}}function Ir(t,e){if(1!=e.text.length||""!=e.text[0]||0!=O(e.from,e.to)){var i=jn(t,e);nr(t,e,i,t.cm?t.cm.curOp.id:NaN),Lr(t,e,i,Q(t,e));var n=[];Kn(t,function(t,i){i||-1!=d(n,t.history)||(Hr(t.history,e),n.push(t.history)),Lr(t,e,null,Q(t,e))})}}function Nr(t,e,i){if(!t.cm||!t.cm.state.suppressEdits||i){for(var n,r=t.history,o=t.sel,s="undo"==e?r.done:r.undone,a="undo"==e?r.undone:r.done,l=0;l<s.length&&(n=s[l],i?!n.ranges||n.equals(t.sel):n.ranges);l++);if(l!=s.length){for(r.lastOrigin=r.lastSelOrigin=null;n=s.pop(),n.ranges;){if(sr(n,a),i&&!n.equals(t.sel))return void br(t,n,{clearRedo:!1});o=n}var h=[];sr(o,a),a.push({changes:h,generation:r.generation}),r.generation=n.generation||++r.maxGeneration;for(var c=Lt(t,"beforeChange")||t.cm&&Lt(t.cm,"beforeChange"),u=function(i){var r=n.changes[i];if(r.origin=e,c&&!Pr(t,r,!1))return s.length=0,{};h.push(tr(t,r));var o=i?jn(t,r):g(s);Lr(t,r,o,cr(t,r)),!i&&t.cm&&t.cm.scrollIntoView({from:r.from,to:Bn(r)});var a=[];Kn(t,function(t,e){e||-1!=d(a,t.history)||(Hr(t.history,r),a.push(t.history)),Lr(t,r,null,cr(t,r))})},f=n.changes.length-1;f>=0;--f){var p=u(f);if(p)return p.v}}}}function Mr(t,e){if(0!=e&&(t.first+=e,t.sel=new Sa(m(t.sel.ranges,function(t){return new Ta(R(t.anchor.line+e,t.anchor.ch),R(t.head.line+e,t.head.ch))}),t.sel.primIndex),t.cm)){mn(t.cm,t.first,t.first-e,e);for(var i=t.cm.display,n=i.viewFrom;n<i.viewTo;n++)vn(t.cm,n,"gutter")}}function Lr(t,e,i,n){if(t.cm&&!t.cm.curOp)return fn(t.cm,Lr)(t,e,i,n);if(e.to.line<t.first)return void Mr(t,e.text.length-1-(e.to.line-e.from.line));if(!(e.from.line>t.lastLine())){if(e.from.line<t.first){var r=e.text.length-1-(t.first-e.from.line);Mr(t,r),e={from:R(t.first,0),to:R(e.to.line+r,e.to.ch),text:[g(e.text)],origin:e.origin}}var o=t.lastLine();e.to.line>o&&(e={from:e.from,to:R(o,E(t,o).text.length),text:[e.text[0]],origin:e.origin}),e.removed=P(t,e.from,e.to),i||(i=jn(t,e)),t.cm?Ar(t.cm,e,n):Zn(t,e,n),_r(t,i,Bs)}}function Ar(t,e,i){var n=t.doc,r=t.display,o=e.from,s=e.to,a=!1,l=o.line;t.options.lineWrapping||(l=N(ut(E(n,o.line))),n.iter(l,s.line+1,function(t){if(t==r.maxLine)return a=!0,!0})),n.sel.contains(e.from,e.to)>-1&&Mt(t),Zn(n,e,i,xi(t)),t.options.lineWrapping||(n.iter(l,o.line+e.text.length,function(t){var e=bt(t);e>r.maxLineLength&&(r.maxLine=t,r.maxLineLength=e,r.maxLineChanged=!0,a=!1)}),a&&(t.curOp.updateMaxLine=!0)),le(n,o.line),xn(t,400);var h=e.text.length-(s.line-o.line)-1;e.full?mn(t):o.line!=s.line||1!=e.text.length||Gn(t.doc,e)?mn(t,o.line,s.line+1,h):vn(t,o.line,"text");var c=Lt(t,"changes"),u=Lt(t,"change");if(u||c){var d={from:o,to:s,text:e.text,removed:e.removed,origin:e.origin};u&&Se(t,"change",t,d),c&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(d)}t.display.selForContextMenu=null}function Rr(t,e,i,n,r){if(n||(n=i),O(n,i)<0){var o=n;n=i,i=o}"string"==typeof e&&(e=t.splitLines(e)),Dr(t,{from:i,to:n,text:e,origin:r})}function Or(t,e,i,n){i<t.line?t.line+=n:e<t.line&&(t.line=e,t.ch=0)}function zr(t,e,i,n){for(var r=0;r<t.length;++r){var o=t[r],s=!0;if(o.ranges){o.copied||(o=t[r]=o.deepCopy(),o.copied=!0);for(var a=0;a<o.ranges.length;a++)Or(o.ranges[a].anchor,e,i,n),Or(o.ranges[a].head,e,i,n)}else{for(var l=0;l<o.changes.length;++l){var h=o.changes[l];if(i<h.from.line)h.from=R(h.from.line+n,h.from.ch),h.to=R(h.to.line+n,h.to.ch);else if(e<=h.to.line){s=!1;break}}s||(t.splice(0,r+1),r=0)}}}function Hr(t,e){var i=e.from.line,n=e.to.line,r=e.text.length-(n-i)-1;zr(t.done,i,n,r),zr(t.undone,i,n,r)}function Fr(t,e,i,n){var r=e,o=e;return"number"==typeof e?o=E(t,$(t,e)):r=N(e),null==r?null:(n(o,r)&&t.cm&&vn(t.cm,r,i),o)}function Br(t){var e=this;this.lines=t,this.parent=null;for(var i=0,n=0;n<t.length;++n)t[n].parent=e,i+=t[n].height;this.height=i}function $r(t){var e=this;this.children=t;for(var i=0,n=0,r=0;r<t.length;++r){var o=t[r];i+=o.chunkSize(),n+=o.height,o.parent=e}this.size=i,this.height=n,this.parent=null}function jr(t,e,i){yt(e)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&qi(t,i)}function Wr(t,e,i,n){var r=new ka(t,i,n),o=t.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),Fr(t,e,"widget",function(e){var i=e.widgets||(e.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length-1,Math.max(0,r.insertAt)),0,r),r.line=e,o&&!mt(t,e)){var n=yt(e)<t.scrollTop;I(e,e.height+He(r)),n&&qi(o,r.height),o.curOp.forceUpdate=!0}return!0}),Se(o,"lineWidgetAdded",o,r,"number"==typeof e?e:N(e)),r}function qr(t,e,i,n,o){if(n&&n.shared)return Ur(t,e,i,n,o);if(t.cm&&!t.cm.curOp)return fn(t.cm,qr)(t,e,i,n,o);var s=new Pa(t,o),a=O(e,i);if(n&&c(n,s,!1),a>0||0==a&&!1!==s.clearWhenEmpty)return s;if(s.replacedWith&&(s.collapsed=!0,s.widgetNode=r("span",[s.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||s.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(s.widgetNode.insertLeft=!0)),s.collapsed){if(ct(t,e.line,e,i,s)||e.line!=i.line&&ct(t,i.line,e,i,s))throw new Error("Inserting collapsed marker partially overlapping an existing one");V()}s.addToHistory&&nr(t,{from:e,to:i,origin:"markText"},t.sel,NaN);var l,h=e.line,u=t.cm;if(t.iter(h,i.line+1,function(t){u&&s.collapsed&&!u.options.lineWrapping&&ut(t)==u.display.maxLine&&(l=!0),s.collapsed&&h!=e.line&&I(t,0),Y(t,new G(s,h==e.line?e.ch:null,h==i.line?i.ch:null)),++h}),s.collapsed&&t.iter(e.line,i.line+1,function(e){mt(t,e)&&I(e,0)}),s.clearOnEnter&&Xs(s,"beforeCursorEnter",function(){return s.clear()}),s.readOnly&&(U(),(t.history.done.length||t.history.undone.length)&&t.clearHistory()),s.collapsed&&(s.id=++Ea,s.atomic=!0),u){if(l&&(u.curOp.updateMaxLine=!0),s.collapsed)mn(u,e.line,i.line+1);else if(s.className||s.title||s.startStyle||s.endStyle||s.css)for(var d=e.line;d<=i.line;d++)vn(u,d,"text");s.atomic&&xr(u.doc),Se(u,"markerAdded",u,s)}return s}function Ur(t,e,i,n,r){n=c(n),n.shared=!1;var o=[qr(t,e,i,n,r)],s=o[0],a=n.widgetNode;return Kn(t,function(t){a&&(n.widgetNode=a.cloneNode(!0)),o.push(qr(t,j(t,e),j(t,i),n,r));for(var l=0;l<t.linked.length;++l)if(t.linked[l].isParent)return;s=g(o)}),new Da(o,s)}function Vr(t){return t.findMarks(R(t.first,0),t.clipPos(R(t.lastLine())),function(t){return t.parent})}function Gr(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=n.find(),o=t.clipPos(r.from),s=t.clipPos(r.to);if(O(o,s)){var a=qr(t,o,s,n.primary,n.primary.type);n.markers.push(a),a.parent=n}}}function Zr(t){for(var e=function(e){var i=t[e],n=[i.primary.doc];Kn(i.primary.doc,function(t){return n.push(t)});for(var r=0;r<i.markers.length;r++){var o=i.markers[r];-1==d(n,o.doc)&&(o.parent=null,i.markers.splice(r--,1))}},i=0;i<t.length;i++)e(i)}function Kr(t){var e=this;if(Jr(e),!Nt(e,t)&&!Fe(e.display,t)){Rt(t),ps&&(Ma=+new Date);var i=Si(e,t,!0),n=t.dataTransfer.files;if(i&&!e.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var r=n.length,o=Array(r),s=0,a=function(t,n){if(!e.options.allowDropFileTypes||-1!=d(e.options.allowDropFileTypes,t.type)){var a=new FileReader;a.onload=fn(e,function(){var t=a.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(t)&&(t=""),o[n]=t,++s==r){i=j(e.doc,i);var l={from:i,to:i,text:e.doc.splitLines(o.join(e.doc.lineSeparator())),origin:"paste"};Dr(e.doc,l),yr(e.doc,Fn(i,Bn(l)))}}),a.readAsText(t)}},l=0;l<r;++l)a(n[l],l);else{if(e.state.draggingText&&e.doc.sel.contains(i)>-1)return e.state.draggingText(t),void setTimeout(function(){return e.display.input.focus()},20);try{var h=t.dataTransfer.getData("Text");if(h){var c;if(e.state.draggingText&&!e.state.draggingText.copy&&(c=e.listSelections()),_r(e.doc,Fn(i,i)),c)for(var u=0;u<c.length;++u)Rr(e.doc,"",c[u].anchor,c[u].head,"drag");e.replaceSelection(h,"around","paste"),e.display.input.focus()}}catch(t){}}}}function Yr(t,e){if(ps&&(!t.state.draggingText||+new Date-Ma<100))return void Ht(e);if(!Nt(t,e)&&!Fe(t.display,e)&&(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!_s)){var i=n("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",bs&&(i.width=i.height=1,t.display.wrapper.appendChild(i),i._top=i.offsetTop),e.dataTransfer.setDragImage(i,0,0),bs&&i.parentNode.removeChild(i)}}function Xr(t,e){var r=Si(t,e);if(r){var o=document.createDocumentFragment();Pi(t,r,o),t.display.dragCursor||(t.display.dragCursor=n("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),i(t.display.dragCursor,o)}}function Jr(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function Qr(t){if(document.getElementsByClassName)for(var e=document.getElementsByClassName("CodeMirror"),i=0;i<e.length;i++){var n=e[i].CodeMirror;n&&t(n)}}function to(){La||(eo(),La=!0)}function eo(){var t;Xs(window,"resize",function(){null==t&&(t=setTimeout(function(){t=null,Qr(io)},100))}),Xs(window,"blur",function(){return Qr(Ai)})}function io(t){var e=t.display;e.lastWrapHeight==e.wrapper.clientHeight&&e.lastWrapWidth==e.wrapper.clientWidth||(e.cachedCharWidth=e.cachedTextHeight=e.cachedPaddingH=null,e.scrollbarsClipped=!1,t.setSize())}function no(t){var e=t.split(/-(?!$)/);t=e[e.length-1];for(var i,n,r,o,s=0;s<e.length-1;s++){var a=e[s];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))i=!0;else if(/^(c|ctrl|control)$/i.test(a))n=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);r=!0}}return i&&(t="Alt-"+t),n&&(t="Ctrl-"+t),o&&(t="Cmd-"+t),r&&(t="Shift-"+t),t}function ro(t){var e={};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==n){delete t[i];continue}for(var r=m(i.split(" "),no),o=0;o<r.length;o++){var s=void 0,a=void 0;o==r.length-1?(a=r.join(" "),s=n):(a=r.slice(0,o+1).join(" "),s="...");var l=e[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else e[a]=s}delete t[i]}for(var h in e)t[h]=e[h];return t}function oo(t,e,i,n){e=ho(e);var r=e.call?e.call(t,n):e[t];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&i(r))return"handled";if(e.fallthrough){if("[object Array]"!=Object.prototype.toString.call(e.fallthrough))return oo(t,e.fallthrough,i,n);for(var o=0;o<e.fallthrough.length;o++){var s=oo(t,e.fallthrough[o],i,n);if(s)return s}}}function so(t){var e="string"==typeof t?t:Aa[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function ao(t,e,i){var n=t;return e.altKey&&"Alt"!=n&&(t="Alt-"+t),(Ns?e.metaKey:e.ctrlKey)&&"Ctrl"!=n&&(t="Ctrl-"+t),(Ns?e.ctrlKey:e.metaKey)&&"Cmd"!=n&&(t="Cmd-"+t),!i&&e.shiftKey&&"Shift"!=n&&(t="Shift-"+t),t}function lo(t,e){if(bs&&34==t.keyCode&&t["char"])return!1;var i=Aa[t.keyCode];return null!=i&&!t.altGraphKey&&ao(i,t,e)}function ho(t){return"string"==typeof t?Ha[t]:t}function co(t,e){for(var i=t.doc.sel.ranges,n=[],r=0;r<i.length;r++){for(var o=e(i[r]);n.length&&O(o.from,g(n).to)<=0;){var s=n.pop();if(O(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}dn(t,function(){for(var e=n.length-1;e>=0;e--)Rr(t.doc,"",n[e].from,n[e].to,"+delete");Ui(t)})}function uo(t,e){var i=E(t.doc,e),n=ut(i);return n!=i&&(e=N(n)),kt(!0,t,n,e,1)}function fo(t,e){var i=E(t.doc,e),n=dt(i);return n!=i&&(e=N(n)),kt(!0,t,i,e,-1)}function po(t,e){var i=uo(t,e.line),n=E(t.doc,i.line),r=Ct(n,t.doc.direction);if(!r||0==r[0].level){var o=Math.max(0,n.text.search(/\S/)),s=e.line==i.line&&e.ch<=o&&e.ch;return R(i.line,s?0:o,i.sticky)}return i}function go(t,e,i){if("string"==typeof e&&!(e=Fa[e]))return!1;t.display.input.ensurePolled();var n=t.display.shift,r=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),i&&(t.display.shift=!1),r=e(t)!=Fs}finally{t.display.shift=n,t.state.suppressEdits=!1}return r}function mo(t,e,i){for(var n=0;n<t.state.keyMaps.length;n++){var r=oo(e,t.state.keyMaps[n],i,t);if(r)return r}return t.options.extraKeys&&oo(e,t.options.extraKeys,i,t)||oo(e,t.options.keyMap,i,t)}function vo(t,e,i,n){var r=t.state.keySeq;if(r){if(so(e))return"handled";Ba.set(50,function(){t.state.keySeq==r&&(t.state.keySeq=null,t.display.input.reset())}),e=r+" "+e}var o=mo(t,e,n);return"multi"==o&&(t.state.keySeq=e),"handled"==o&&Se(t,"keyHandled",t,e,i),"handled"!=o&&"multi"!=o||(Rt(i),Ii(t)),r&&!o&&/\'$/.test(e)?(Rt(i),!0):!!o}function yo(t,e){var i=lo(e,!0);return!!i&&(e.shiftKey&&!t.state.keySeq?vo(t,"Shift-"+i,e,function(e){return go(t,e,!0)})||vo(t,i,e,function(e){if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return go(t,e)}):vo(t,i,e,function(e){return go(t,e)}))}function bo(t,e,i){return vo(t,"'"+i+"'",e,function(e){return go(t,e,!0)})}function _o(t){var e=this;if(e.curOp.focus=s(),!Nt(e,t)){ps&&gs<11&&27==t.keyCode&&(t.returnValue=!1);var i=t.keyCode;e.display.shift=16==i||t.shiftKey;var n=yo(e,t);bs&&($a=n?i:null,!n&&88==i&&!ea&&(ks?t.metaKey:t.ctrlKey)&&e.replaceSelection("",null,"cut")),18!=i||/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)||wo(e)}}function wo(t){function e(t){18!=t.keyCode&&t.altKey||(Ls(i,"CodeMirror-crosshair"),Dt(document,"keyup",e),Dt(document,"mouseover",e))}var i=t.display.lineDiv;a(i,"CodeMirror-crosshair"),Xs(document,"keyup",e),Xs(document,"mouseover",e)}function xo(t){16==t.keyCode&&(this.doc.sel.shift=!1),Nt(this,t)}function Co(t){var e=this;if(!(Fe(e.display,t)||Nt(e,t)||t.ctrlKey&&!t.altKey||ks&&t.metaKey)){var i=t.keyCode,n=t.charCode;if(bs&&i==$a)return $a=null,void Rt(t);if(!bs||t.which&&!(t.which<10)||!yo(e,t)){var r=String.fromCharCode(null==n?i:n);"\b"!=r&&(bo(e,t,r)||e.display.input.onKeyPress(t))}}}function So(t,e){var i=+new Date;return qa&&qa.compare(i,t,e)?(Wa=qa=null,"triple"):Wa&&Wa.compare(i,t,e)?(qa=new ja(i,t,e),Wa=null,"double"):(Wa=new ja(i,t,e),qa=null,"single")}function To(t){var e=this,i=e.display;if(!(Nt(e,t)||i.activeTouch&&i.input.supportsTouch())){if(i.input.ensurePolled(),i.shift=t.shiftKey,Fe(i,t))return void(ms||(i.scroller.draggable=!1,setTimeout(function(){return i.scroller.draggable=!0},100)));if(!Lo(e,t)){var n=Si(e,t),r=Bt(t),o=n?So(n,r):"single";window.focus(),1==r&&e.state.selectingText&&e.state.selectingText(t),n&&ko(e,r,n,o,t)||(1==r?n?Po(e,n,o,t):Ft(t)==i.scroller&&Rt(t):2==r?(n&&fr(e.doc,n),setTimeout(function(){return i.input.focus()},20)):3==r&&(Ms?Ao(e,t):Mi(e)))}}}function ko(t,e,i,n,r){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),o=(1==e?"Left":2==e?"Middle":"Right")+o,vo(t,ao(o,r),r,function(e){if("string"==typeof e&&(e=Fa[e]),!e)return!1;var n=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),n=e(t,i)!=Fs}finally{t.state.suppressEdits=!1}return n})}function Eo(t,e,i){var n=t.getOption("configureMouse"),r=n?n(t,e,i):{};if(null==r.unit){var o=Es?i.shiftKey&&i.metaKey:i.altKey;r.unit=o?"rectangle":"single"==e?"char":"double"==e?"word":"line"}return(null==r.extend||t.doc.extend)&&(r.extend=t.doc.extend||i.shiftKey),null==r.addNew&&(r.addNew=ks?i.metaKey:i.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(ks?i.altKey:i.ctrlKey)),r}function Po(t,e,i,n){ps?setTimeout(h(Ni,t),0):t.curOp.focus=s();var r,o=Eo(t,i,n),a=t.doc.sel;t.options.dragDrop&&Js&&!t.isReadOnly()&&"single"==i&&(r=a.contains(e))>-1&&(O((r=a.ranges[r]).from(),e)<0||e.xRel>0)&&(O(r.to(),e)>0||e.xRel<0)?Do(t,n,e,o):No(t,n,e,o)}function Do(t,e,i,n){var r=t.display,o=!1,s=fn(t,function(e){ms&&(r.scroller.draggable=!1),t.state.draggingText=!1,Dt(document,"mouseup",s),Dt(document,"mousemove",a),Dt(r.scroller,"dragstart",l),Dt(r.scroller,"drop",s),o||(Rt(e),n.addNew||fr(t.doc,i,null,null,n.extend),ms||ps&&9==gs?setTimeout(function(){document.body.focus(),r.input.focus()},20):r.input.focus())}),a=function(t){o=o||Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)>=10},l=function(){return o=!0};ms&&(r.scroller.draggable=!0),t.state.draggingText=s,s.copy=!n.moveOnDrag,r.scroller.dragDrop&&r.scroller.dragDrop(),Xs(document,"mouseup",s),Xs(document,"mousemove",a),Xs(r.scroller,"dragstart",l),Xs(r.scroller,"drop",s),Mi(t),setTimeout(function(){return r.input.focus()},20)}function Io(t,e,i){if("char"==i)return new Ta(e,e);if("word"==i)return t.findWordAt(e);if("line"==i)return new Ta(R(e.line,0),j(t.doc,R(e.line+1,0)));var n=i(t,e);return new Ta(n.from,n.to)}function No(t,e,i,n){function r(e){if(0!=O(v,e))if(v=e,"rectangle"==n.unit){for(var r=[],o=t.options.tabSize,s=u(E(h,i.line).text,i.ch,o),a=u(E(h,e.line).text,e.ch,o),l=Math.min(s,a),g=Math.max(s,a),m=Math.min(i.line,e.line),y=Math.min(t.lastLine(),Math.max(i.line,e.line));m<=y;m++){var b=E(h,m).text,_=f(b,l,o);l==g?r.push(new Ta(R(m,_),R(m,_))):b.length>_&&r.push(new Ta(R(m,_),R(m,f(b,g,o))))}r.length||r.push(new Ta(i,i)),br(h,Hn(p.ranges.slice(0,d).concat(r),d),{origin:"*mouse",scroll:!1}),t.scrollIntoView(e)}else{var w,x=c,C=Io(t,e,n.unit),S=x.anchor;O(C.anchor,S)>0?(w=C.head,S=B(x.from(),C.anchor)):(w=C.anchor,S=F(x.to(),C.head));var T=p.ranges.slice(0);T[d]=new Ta(j(h,S),w),br(h,Hn(T,d),$s)}}function o(e){var i=++b,a=Si(t,e,!0,"rectangle"==n.unit);if(a)if(0!=O(a,v)){t.curOp.focus=s(),r(a);var c=zi(l,h);(a.line>=c.to||a.line<c.from)&&setTimeout(fn(t,function(){b==i&&o(e)}),150)}else{var u=e.clientY<y.top?-20:e.clientY>y.bottom?20:0;u&&setTimeout(fn(t,function(){b==i&&(l.scroller.scrollTop+=u,o(e))}),50)}}function a(e){t.state.selectingText=!1,b=Infinity,Rt(e),l.input.focus(),Dt(document,"mousemove",_),Dt(document,"mouseup",w),h.history.lastSelOrigin=null}var l=t.display,h=t.doc;Rt(e);var c,d,p=h.sel,g=p.ranges;if(n.addNew&&!n.extend?(d=h.sel.contains(i),c=d>-1?g[d]:new Ta(i,i)):(c=h.sel.primary(),d=h.sel.primIndex),"rectangle"==n.unit)n.addNew||(c=new Ta(i,i)),i=Si(t,e,!0,!0),d=-1;else{var m=Io(t,i,n.unit);c=n.extend?dr(c,m.anchor,m.head,n.extend):m}n.addNew?-1==d?(d=g.length,br(h,Hn(g.concat([c]),d),{scroll:!1,origin:"*mouse"})):g.length>1&&g[d].empty()&&"char"==n.unit&&!n.extend?(br(h,Hn(g.slice(0,d).concat(g.slice(d+1)),0),{scroll:!1,origin:"*mouse"}),p=h.sel):gr(h,d,c,$s):(d=0,br(h,new Sa([c],0),$s),p=h.sel);var v=i,y=l.wrapper.getBoundingClientRect(),b=0,_=fn(t,function(t){Bt(t)?o(t):a(t)}),w=fn(t,a);t.state.selectingText=w,Xs(document,"mousemove",_),Xs(document,"mouseup",w)}function Mo(t,e,i,n){var r,o;try{r=e.clientX,o=e.clientY}catch(e){return!1}if(r>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;n&&Rt(e);var s=t.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!Lt(t,i))return zt(e);o-=a.top-s.viewOffset;for(var l=0;l<t.options.gutters.length;++l){var h=s.gutters.childNodes[l];if(h&&h.getBoundingClientRect().right>=r){return It(t,i,t,M(t.doc,o),t.options.gutters[l],e),zt(e)}}}function Lo(t,e){return Mo(t,e,"gutterClick",!0)}function Ao(t,e){Fe(t.display,e)||Ro(t,e)||Nt(t,e,"contextmenu")||t.display.input.onContextMenu(e)}function Ro(t,e){return!!Lt(t,"gutterContextMenu")&&Mo(t,e,"gutterContextMenu",!1)}function Oo(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),oi(t)}function zo(t){function e(e,n,r,o){t.defaults[e]=n,r&&(i[e]=o?function(t,e,i){i!=Ua&&r(t,e,i)}:r)}var i=t.optionHandlers;t.defineOption=e,t.Init=Ua,e("value","",function(t,e){return t.setValue(e)},!0),e("mode",null,function(t,e){t.doc.modeOption=e,Un(t)},!0),e("indentUnit",2,Un,!0),e("indentWithTabs",!1),e("smartIndent",!0),e("tabSize",4,function(t){Vn(t),oi(t),mn(t)},!0),e("lineSeparator",null,function(t,e){if(t.doc.lineSep=e,e){var i=[],n=t.doc.first;t.doc.iter(function(t){for(var r=0;;){var o=t.text.indexOf(e,r);if(-1==o)break;r=o+e.length,i.push(R(n,o))}n++});for(var r=i.length-1;r>=0;r--)Rr(t.doc,e,i[r],R(i[r].line,i[r].ch+e.length))}}),e("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(t,e,i){t.state.specialChars=new RegExp(e.source+(e.test("\t")?"":"|\t"),"g"),i!=Ua&&t.refresh()}),e("specialCharPlaceholder",fe,function(t){return t.refresh()},!0),e("electricChars",!0),e("inputStyle",Ts?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),e("spellcheck",!1,function(t,e){return t.getInputField().spellcheck=e},!0),e("rtlMoveVisually",!Ps),e("wholeLineUpdateBefore",!0),e("theme","default",function(t){Oo(t),Ho(t)},!0),e("keyMap","default",function(t,e,i){var n=ho(e),r=i!=Ua&&ho(i);r&&r.detach&&r.detach(t,n),n.attach&&n.attach(t,r||null)}),e("extraKeys",null),e("configureMouse",null),e("lineWrapping",!1,Bo,!0),e("gutters",[],function(t){An(t.options),Ho(t)},!0),e("fixedGutter",!0,function(t,e){t.display.gutters.style.left=e?wi(t.display)+"px":"0",t.refresh()},!0),e("coverGutterNextToScrollbar",!1,function(t){return tn(t)},!0),e("scrollbarStyle","native",function(t){nn(t),tn(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)},!0),e("lineNumbers",!1,function(t){An(t.options),Ho(t)},!0),e("firstLineNumber",1,Ho,!0),e("lineNumberFormatter",function(t){return t},Ho,!0),e("showCursorWhenSelecting",!1,ki,!0),e("resetSelectionOnContextMenu",!0),e("lineWiseCopyCut",!0),e("pasteLinesPerSelection",!0),e("readOnly",!1,function(t,e){"nocursor"==e&&(Ai(t),t.display.input.blur()),t.display.input.readOnlyChanged(e)}),e("disableInput",!1,function(t,e){e||t.display.input.reset()},!0),e("dragDrop",!0,Fo),e("allowDropFileTypes",null),e("cursorBlinkRate",530),e("cursorScrollMargin",0),e("cursorHeight",1,ki,!0),e("singleCursorHeightPerLine",!0,ki,!0),e("workTime",100),e("workDelay",100),e("flattenSpans",!0,Vn,!0),e("addModeClass",!1,Vn,!0),e("pollInterval",100),e("undoDepth",200,function(t,e){return t.doc.history.undoDepth=e}),e("historyEventDelay",1250),e("viewportMargin",10,function(t){return t.refresh()},!0),e("maxHighlightLength",1e4,Vn,!0),e("moveInputWithCursor",!0,function(t,e){e||t.display.input.resetPosition()}),e("tabindex",null,function(t,e){return t.display.input.getField().tabIndex=e||""}),e("autofocus",null),e("direction","ltr",function(t,e){return t.doc.setDirection(e)},!0)}function Ho(t){Ln(t),mn(t),Hi(t)}function Fo(t,e,i){if(!e!=!(i&&i!=Ua)){var n=t.display.dragFunctions,r=e?Xs:Dt;r(t.display.scroller,"dragstart",n.start),r(t.display.scroller,"dragenter",n.enter),r(t.display.scroller,"dragover",n.over),r(t.display.scroller,"dragleave",n.leave),r(t.display.scroller,"drop",n.drop)}}function Bo(t){t.options.lineWrapping?(a(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(Ls(t.display.wrapper,"CodeMirror-wrap"),_t(t)),Ci(t),mn(t),oi(t),setTimeout(function(){return tn(t)},100)}function $o(t,e){var i=this;if(!(this instanceof $o))return new $o(t,e);this.options=e=e?c(e):{},c(Va,e,!1),An(e);var n=e.value;"string"==typeof n&&(n=new Na(n,e.mode,null,e.lineSeparator,e.direction)),this.doc=n;var r=new $o.inputStyles[e.inputStyle](this),o=this.display=new k(t,n,r);o.wrapper.CodeMirror=this,Ln(this),Oo(this),e.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),nn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Rs,keySeq:null,specialChars:null},e.autofocus&&!Ts&&o.input.focus(),ps&&gs<11&&setTimeout(function(){return i.display.input.reset(!0)},20),jo(this),to(),rn(this),this.curOp.forceUpdate=!0,Yn(this,n),e.autofocus&&!Ts||this.hasFocus()?setTimeout(h(Li,this),20):Ai(this);for(var s in Ga)Ga.hasOwnProperty(s)&&Ga[s](i,e[s],Ua);Fi(this),e.finishInit&&e.finishInit(this);for(var a=0;a<Za.length;++a)Za[a](i);on(this),ms&&e.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function jo(t){function e(){r.activeTouch&&(o=setTimeout(function(){return r.activeTouch=null},1e3),s=r.activeTouch,s.end=+new Date)}function i(t){if(1!=t.touches.length)return!1;var e=t.touches[0];return e.radiusX<=1&&e.radiusY<=1}function n(t,e){if(null==e.left)return!0;var i=e.left-t.left,n=e.top-t.top;return i*i+n*n>400}var r=t.display;Xs(r.scroller,"mousedown",fn(t,To)),ps&&gs<11?Xs(r.scroller,"dblclick",fn(t,function(e){if(!Nt(t,e)){var i=Si(t,e);if(i&&!Lo(t,e)&&!Fe(t.display,e)){Rt(e);var n=t.findWordAt(i);fr(t.doc,n.anchor,n.head)}}})):Xs(r.scroller,"dblclick",function(e){return Nt(t,e)||Rt(e)}),Ms||Xs(r.scroller,"contextmenu",function(e){return Ao(t,e)});var o,s={end:0};Xs(r.scroller,"touchstart",function(e){if(!Nt(t,e)&&!i(e)){r.input.ensurePolled(),clearTimeout(o);var n=+new Date;r.activeTouch={start:n,moved:!1,prev:n-s.end<=300?s:null},1==e.touches.length&&(r.activeTouch.left=e.touches[0].pageX,r.activeTouch.top=e.touches[0].pageY)}}),Xs(r.scroller,"touchmove",function(){r.activeTouch&&(r.activeTouch.moved=!0)}),Xs(r.scroller,"touchend",function(i){var o=r.activeTouch;if(o&&!Fe(r,i)&&null!=o.left&&!o.moved&&new Date-o.start<300){var s,a=t.coordsChar(r.activeTouch,"page");s=!o.prev||n(o,o.prev)?new Ta(a,a):!o.prev.prev||n(o,o.prev.prev)?t.findWordAt(a):new Ta(R(a.line,0),j(t.doc,R(a.line+1,0))),t.setSelection(s.anchor,s.head),t.focus(),Rt(i)}e()}),Xs(r.scroller,"touchcancel",e),Xs(r.scroller,"scroll",function(){r.scroller.clientHeight&&(Yi(t,r.scroller.scrollTop),Ji(t,r.scroller.scrollLeft,!0),It(t,"scroll",t))}),Xs(r.scroller,"mousewheel",function(e){return zn(t,e)}),Xs(r.scroller,"DOMMouseScroll",function(e){return zn(t,e)}),Xs(r.wrapper,"scroll",function(){return r.wrapper.scrollTop=r.wrapper.scrollLeft=0}),r.dragFunctions={enter:function(e){Nt(t,e)||Ht(e)},over:function(e){Nt(t,e)||(Xr(t,e),Ht(e))},start:function(e){return Yr(t,e)},drop:fn(t,Kr),leave:function(e){Nt(t,e)||Jr(t)}};var a=r.input.getField();Xs(a,"keyup",function(e){return xo.call(t,e)}),Xs(a,"keydown",fn(t,_o)),Xs(a,"keypress",fn(t,Co)),Xs(a,"focus",function(e){return Li(t,e)}),Xs(a,"blur",function(e){return Ai(t,e)})}function Wo(t,e,i,n){var r,o=t.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?r=te(t,e).state:i="prev");var s=t.options.tabSize,a=E(o,e),l=u(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var h,c=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&((h=o.mode.indent(r,a.text.slice(c.length),a.text))==Fs||h>150)){if(!n)return;i="prev"}}else h=0,i="not";"prev"==i?h=e>o.first?u(E(o,e-1).text,null,s):0:"add"==i?h=l+t.options.indentUnit:"subtract"==i?h=l-t.options.indentUnit:"number"==typeof i&&(h=l+i),h=Math.max(0,h);var d="",f=0;if(t.options.indentWithTabs)for(var g=Math.floor(h/s);g;--g)f+=s,d+="\t";if(f<h&&(d+=p(h-f)),d!=c)return Rr(o,d,R(e,0),R(e,c.length),"+input"),a.stateAfter=null,!0;for(var m=0;m<o.sel.ranges.length;m++){var v=o.sel.ranges[m];if(v.head.line==e&&v.head.ch<c.length){var y=R(e,c.length);gr(o,m,new Ta(y,y));break}}}function qo(t){Ka=t}function Uo(t,e,i,n,r){var o=t.doc;t.display.shift=!1,n||(n=o.sel);var s=t.state.pasteIncoming||"paste"==r,a=Qs(e),l=null;if(s&&n.ranges.length>1)if(Ka&&Ka.text.join("\n")==e){if(n.ranges.length%Ka.text.length==0){l=[];for(var h=0;h<Ka.text.length;h++)l.push(o.splitLines(Ka.text[h]))}}else a.length==n.ranges.length&&t.options.pasteLinesPerSelection&&(l=m(a,function(t){return[t]}));for(var c,u=n.ranges.length-1;u>=0;u--){var d=n.ranges[u],f=d.from(),p=d.to();d.empty()&&(i&&i>0?f=R(f.line,f.ch-i):t.state.overwrite&&!s?p=R(p.line,Math.min(E(o,p.line).text.length,p.ch+g(a).length)):Ka&&Ka.lineWise&&Ka.text.join("\n")==e&&(f=p=R(f.line,0))),c=t.curOp.updateInput;var v={from:f,to:p,text:l?l[u%l.length]:a,origin:r||(s?"paste":t.state.cutIncoming?"cut":"+input")};Dr(t.doc,v),Se(t,"inputRead",t,v)}e&&!s&&Go(t,e),Ui(t),t.curOp.updateInput=c,t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=!1}function Vo(t,e){var i=t.clipboardData&&t.clipboardData.getData("Text");if(i)return t.preventDefault(),e.isReadOnly()||e.options.disableInput||dn(e,function(){return Uo(e,i,0,null,"paste")}),!0}function Go(t,e){if(t.options.electricChars&&t.options.smartIndent)for(var i=t.doc.sel,n=i.ranges.length-1;n>=0;n--){var r=i.ranges[n];if(!(r.head.ch>100||n&&i.ranges[n-1].head.line==r.head.line)){var o=t.getModeAt(r.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(e.indexOf(o.electricChars.charAt(a))>-1){s=Wo(t,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(E(t.doc,r.head.line).text.slice(0,r.head.ch))&&(s=Wo(t,r.head.line,"smart"));s&&Se(t,"electricInput",t,r.head.line)}}}function Zo(t){for(var e=[],i=[],n=0;n<t.doc.sel.ranges.length;n++){var r=t.doc.sel.ranges[n].head.line,o={anchor:R(r,0),head:R(r+1,0)};i.push(o),e.push(t.getRange(o.anchor,o.head))}return{text:e,ranges:i}}function Ko(t,e){t.setAttribute("autocorrect","off"),t.setAttribute("autocapitalize","off"),t.setAttribute("spellcheck",!!e)}function Yo(){var t=n("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),e=n("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return ms?t.style.width="1000px":t.setAttribute("wrap","off"),Cs&&(t.style.border="1px solid black"),Ko(t),e}function Xo(t){var e=t.optionHandlers,i=t.helpers={};t.prototype={constructor:t,focus:function(){window.focus(),this.display.input.focus()},setOption:function(t,i){var n=this.options,r=n[t];n[t]==i&&"mode"!=t||(n[t]=i,e.hasOwnProperty(t)&&fn(this,e[t])(this,i,r),It(this,"optionChange",this,t))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](ho(t))},removeKeyMap:function(t){for(var e=this.state.keyMaps,i=0;i<e.length;++i)if(e[i]==t||e[i].name==t)return e.splice(i,1),!0},addOverlay:pn(function(e,i){var n=e.token?e:t.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");v(this.state.overlays,{mode:n,modeSpec:e,opaque:i&&i.opaque,priority:i&&i.priority||0},function(t){return t.priority}),this.state.modeGen++,mn(this)}),removeOverlay:pn(function(t){for(var e=this,i=this.state.overlays,n=0;n<i.length;++n){var r=i[n].modeSpec;if(r==t||"string"==typeof t&&r.name==t)return i.splice(n,1),e.state.modeGen++,void mn(e)}}),indentLine:pn(function(t,e,i){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),L(this.doc,t)&&Wo(this,t,e,i)}),indentSelection:pn(function(t){for(var e=this,i=this.doc.sel.ranges,n=-1,r=0;r<i.length;r++){var o=i[r];if(o.empty())o.head.line>n&&(Wo(e,o.head.line,t,!0),n=o.head.line,r==e.doc.sel.primIndex&&Ui(e));else{var s=o.from(),a=o.to(),l=Math.max(n,s.line);n=Math.min(e.lastLine(),a.line-(a.ch?0:1))+1;for(var h=l;h<n;++h)Wo(e,h,t);var c=e.doc.sel.ranges;0==s.ch&&i.length==c.length&&c[r].from().ch>0&&gr(e.doc,r,new Ta(s,c[r].to()),Bs)}}}),getTokenAt:function(t,e){return re(this,t,e)},getLineTokens:function(t,e){return re(this,R(t),e,!0)},getTokenTypeAt:function(t){t=j(this.doc,t);var e,i=Qt(this,E(this.doc,t.line)),n=0,r=(i.length-1)/2,o=t.ch;if(0==o)e=i[2];else for(;;){var s=n+r>>1
;if((s?i[2*s-1]:0)>=o)r=s;else{if(!(i[2*s+1]<o)){e=i[2*s+2];break}n=s+1}}var a=e?e.indexOf("overlay "):-1;return a<0?e:0==a?null:e.slice(0,a-1)},getModeAt:function(e){var i=this.doc.mode;return i.innerMode?t.innerMode(i,this.getTokenAt(e).state).mode:i},getHelper:function(t,e){return this.getHelpers(t,e)[0]},getHelpers:function(t,e){var n=this,r=[];if(!i.hasOwnProperty(e))return r;var o=i[e],s=this.getModeAt(t);if("string"==typeof s[e])o[s[e]]&&r.push(o[s[e]]);else if(s[e])for(var a=0;a<s[e].length;a++){var l=o[s[e][a]];l&&r.push(l)}else s.helperType&&o[s.helperType]?r.push(o[s.helperType]):o[s.name]&&r.push(o[s.name]);for(var h=0;h<o._global.length;h++){var c=o._global[h];c.pred(s,n)&&-1==d(r,c.val)&&r.push(c.val)}return r},getStateAfter:function(t,e){var i=this.doc;return t=$(i,null==t?i.first+i.size-1:t),te(this,t+1,e).state},cursorCoords:function(t,e){var i,n=this.doc.sel.primary();return i=null==t?n.head:"object"==typeof t?j(this.doc,t):t?n.from():n.to(),ui(this,i,e||"page")},charCoords:function(t,e){return ci(this,j(this.doc,t),e||"page")},coordsChar:function(t,e){return t=hi(this,t,e||"page"),pi(this,t.left,t.top)},lineAtHeight:function(t,e){return t=hi(this,{top:t,left:0},e||"page").top,M(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e,i){var n,r=!1;if("number"==typeof t){var o=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>o&&(t=o,r=!0),n=E(this.doc,t)}else n=t;return li(this,n,{top:0,left:0},e||"page",i||r).top+(r?this.doc.height-yt(n):0)},defaultTextHeight:function(){return yi(this.display)},defaultCharWidth:function(){return bi(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,e,i,n,r){var o=this.display;t=ui(this,j(this.doc,t));var s=t.bottom,a=t.left;if(e.style.position="absolute",e.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(e),o.sizer.appendChild(e),"over"==n)s=t.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),h=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||t.bottom+e.offsetHeight>l)&&t.top>e.offsetHeight?s=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=l&&(s=t.bottom),a+e.offsetWidth>h&&(a=h-e.offsetWidth)}e.style.top=s+"px",e.style.left=e.style.right="","right"==r?(a=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=a+"px"),i&&ji(this,{left:a,top:s,right:a+e.offsetWidth,bottom:s+e.offsetHeight})},triggerOnKeyDown:pn(_o),triggerOnKeyPress:pn(Co),triggerOnKeyUp:xo,triggerOnMouseDown:pn(To),execCommand:function(t){if(Fa.hasOwnProperty(t))return Fa[t].call(null,this)},triggerElectric:pn(function(t){Go(this,t)}),findPosH:function(t,e,i,n){var r=this,o=1;e<0&&(o=-1,e=-e);for(var s=j(this.doc,t),a=0;a<e&&(s=Jo(r.doc,s,o,i,n),!s.hitSide);++a);return s},moveH:pn(function(t,e){var i=this;this.extendSelectionsBy(function(n){return i.display.shift||i.doc.extend||n.empty()?Jo(i.doc,n.head,t,e,i.options.rtlMoveVisually):t<0?n.from():n.to()},js)}),deleteH:pn(function(t,e){var i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):co(this,function(i){var r=Jo(n,i.head,t,e,!1);return t<0?{from:r,to:i.head}:{from:i.head,to:r}})}),findPosV:function(t,e,i,n){var r=this,o=1,s=n;e<0&&(o=-1,e=-e);for(var a=j(this.doc,t),l=0;l<e;++l){var h=ui(r,a,"div");if(null==s?s=h.left:h.left=s,a=Qo(r,h,o,i),a.hitSide)break}return a},moveV:pn(function(t,e){var i=this,n=this.doc,r=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(s){if(o)return t<0?s.from():s.to();var a=ui(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=Qo(i,a,t,e);return"page"==e&&s==n.sel.primary()&&qi(i,ci(i,l,"div").top-a.top),l},js),r.length)for(var s=0;s<n.sel.ranges.length;s++)n.sel.ranges[s].goalColumn=r[s]}),findWordAt:function(t){var e=this.doc,i=E(e,t.line).text,n=t.ch,r=t.ch;if(i){var o=this.getHelper(t,"wordChars");"before"!=t.sticky&&r!=i.length||!n?++r:--n;for(var s=i.charAt(n),a=w(s,o)?function(t){return w(t,o)}:/\s/.test(s)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!w(t)};n>0&&a(i.charAt(n-1));)--n;for(;r<i.length&&a(i.charAt(r));)++r}return new Ta(R(t.line,n),R(t.line,r))},toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?a(this.display.cursorDiv,"CodeMirror-overwrite"):Ls(this.display.cursorDiv,"CodeMirror-overwrite"),It(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==s()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pn(function(t,e){Vi(this,t,e)}),getScrollInfo:function(){var t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-We(this)-this.display.barHeight,width:t.scrollWidth-We(this)-this.display.barWidth,clientHeight:Ue(this),clientWidth:qe(this)}},scrollIntoView:pn(function(t,e){null==t?(t={from:this.doc.sel.primary().head,to:null},null==e&&(e=this.options.cursorScrollMargin)):"number"==typeof t?t={from:R(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=e||0,null!=t.from.line?Gi(this,t):Ki(this,t.from,t.to,t.margin)}),setSize:pn(function(t,e){var i=this,n=function(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t};null!=t&&(this.display.wrapper.style.width=n(t)),null!=e&&(this.display.wrapper.style.height=n(e)),this.options.lineWrapping&&ri(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,function(t){if(t.widgets)for(var e=0;e<t.widgets.length;e++)if(t.widgets[e].noHScroll){vn(i,r,"widget");break}++r}),this.curOp.forceUpdate=!0,It(this,"refresh",this)}),operation:function(t){return dn(this,t)},startOperation:function(){return rn(this)},endOperation:function(){return on(this)},refresh:pn(function(){var t=this.display.cachedTextHeight;mn(this),this.curOp.forceUpdate=!0,oi(this),Vi(this,this.doc.scrollLeft,this.doc.scrollTop),Nn(this),(null==t||Math.abs(t-yi(this.display))>.5)&&Ci(this),It(this,"refresh",this)}),swapDoc:pn(function(t){var e=this.doc;return e.cm=null,Yn(this,t),oi(this),this.display.input.reset(),Vi(this,t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,Se(this,"swapDoc",this,e),e}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},At(t),t.registerHelper=function(e,n,r){i.hasOwnProperty(e)||(i[e]=t[e]={_global:[]}),i[e][n]=r},t.registerGlobalHelper=function(e,n,r,o){t.registerHelper(e,n,o),i[e]._global.push({pred:r,val:o})}}function Jo(t,e,i,n,r){function o(){var n=e.line+i;return!(n<t.first||n>=t.first+t.size)&&(e=new R(n,e.ch,e.sticky),h=E(t,n))}function s(n){var s;if(null==(s=r?Et(t.cm,h,e,i):Tt(h,e,i))){if(n||!o())return!1;e=kt(r,t.cm,h,e.line,i)}else e=s;return!0}var a=e,l=i,h=E(t,e.line);if("char"==n)s();else if("column"==n)s(!0);else if("word"==n||"group"==n)for(var c=null,u="group"==n,d=t.cm&&t.cm.getHelper(e,"wordChars"),f=!0;!(i<0)||s(!f);f=!1){var p=h.text.charAt(e.ch)||"\n",g=w(p,d)?"w":u&&"\n"==p?"n":!u||/\s/.test(p)?null:"p";if(!u||f||g||(g="s"),c&&c!=g){i<0&&(i=1,s(),e.sticky="after");break}if(g&&(c=g),i>0&&!s(!f))break}var m=Tr(t,e,a,l,!0);return z(a,m)&&(m.hitSide=!0),m}function Qo(t,e,i,n){var r,o=t.doc,s=e.left;if("page"==n){var a=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),l=Math.max(a-.5*yi(t.display),3);r=(i>0?e.bottom:e.top)+i*l}else"line"==n&&(r=i>0?e.bottom+3:e.top-3);for(var h;h=pi(t,s,r),h.outside;){if(i<0?r<=0:r>=o.height){h.hitSide=!0;break}r+=5*i}return h}function ts(t,e){var i=Ye(t,e.line);if(!i||i.hidden)return null;var n=E(t.doc,e.line),r=Ge(i,n,e.line),o=Ct(n,t.doc.direction),s="left";if(o){s=xt(o,e.ch)%2?"right":"left"}var a=Qe(r.map,e.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function es(t){for(var e=t;e;e=e.parentNode)if(/CodeMirror-gutter-wrapper/.test(e.className))return!0;return!1}function is(t,e){return e&&(t.bad=!0),t}function ns(t,e,i,n,r){function o(t){return function(e){return e.id==t}}function s(){c&&(h+=u,c=!1)}function a(t){t&&(s(),h+=t)}function l(e){if(1==e.nodeType){var i=e.getAttribute("cm-text");if(null!=i)return void a(i||e.textContent.replace(/\u200b/g,""));var h,d=e.getAttribute("cm-marker");if(d){var f=t.findMarks(R(n,0),R(r+1,0),o(+d));return void(f.length&&(h=f[0].find())&&a(P(t.doc,h.from,h.to).join(u)))}if("false"==e.getAttribute("contenteditable"))return;var p=/^(pre|div|p)$/i.test(e.nodeName);p&&s();for(var g=0;g<e.childNodes.length;g++)l(e.childNodes[g]);p&&(c=!0)}else 3==e.nodeType&&a(e.nodeValue)}for(var h="",c=!1,u=t.doc.lineSeparator();l(e),e!=i;)e=e.nextSibling;return h}function rs(t,e,i){var n;if(e==t.display.lineDiv){if(!(n=t.display.lineDiv.childNodes[i]))return is(t.clipPos(R(t.display.viewTo-1)),!0);e=null,i=0}else for(n=e;;n=n.parentNode){if(!n||n==t.display.lineDiv)return null;if(n.parentNode&&n.parentNode==t.display.lineDiv)break}for(var r=0;r<t.display.view.length;r++){var o=t.display.view[r];if(o.node==n)return os(o,e,i)}}function os(t,e,i){function n(e,i,n){for(var r=-1;r<(u?u.length:0);r++)for(var o=r<0?c.map:u[r],s=0;s<o.length;s+=3){var a=o[s+2];if(a==e||a==i){var l=N(r<0?t.line:t.rest[r]),h=o[s]+n;return(n<0||a!=e)&&(h=o[s+(n?1:0)]),R(l,h)}}}var r=t.text.firstChild,s=!1;if(!e||!o(r,e))return is(R(N(t.line),0),!0);if(e==r&&(s=!0,e=r.childNodes[i],i=0,!e)){var a=t.rest?g(t.rest):t.line;return is(R(N(a),a.text.length),s)}var l=3==e.nodeType?e:null,h=e;for(l||1!=e.childNodes.length||3!=e.firstChild.nodeType||(l=e.firstChild,i&&(i=l.nodeValue.length));h.parentNode!=r;)h=h.parentNode;var c=t.measure,u=c.maps,d=n(l,h,i);if(d)return is(d,s);for(var f=h.nextSibling,p=l?l.nodeValue.length-i:0;f;f=f.nextSibling){if(d=n(f,f.firstChild,0))return is(R(d.line,d.ch-p),s);p+=f.textContent.length}for(var m=h.previousSibling,v=i;m;m=m.previousSibling){if(d=n(m,m.firstChild,-1))return is(R(d.line,d.ch+v),s);v+=m.textContent.length}}function ss(t,e){function i(){t.value=l.getValue()}if(e=e?c(e):{},e.value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus){var n=s();e.autofocus=n==t||null!=t.getAttribute("autofocus")&&n==document.body}var r;if(t.form&&(Xs(t.form,"submit",i),!e.leaveSubmitMethodAlone)){var o=t.form;r=o.submit;try{var a=o.submit=function(){i(),o.submit=r,o.submit(),o.submit=a}}catch(t){}}e.finishInit=function(e){e.save=i,e.getTextArea=function(){return t},e.toTextArea=function(){e.toTextArea=isNaN,i(),t.parentNode.removeChild(e.getWrapperElement()),t.style.display="",t.form&&(Dt(t.form,"submit",i),"function"==typeof t.form.submit&&(t.form.submit=r))}},t.style.display="none";var l=$o(function(e){return t.parentNode.insertBefore(e,t.nextSibling)},e);return l}function as(t){t.off=Dt,t.on=Xs,t.wheelEventPixels=On,t.Doc=Na,t.splitLines=Qs,t.countColumn=u,t.findColumn=f,t.isWordChar=_,t.Pass=Fs,t.signal=It,t.Line=ca,t.changeEnd=Bn,t.scrollbarModel=ba,t.Pos=R,t.cmpPos=O,t.modes=na,t.mimeModes=ra,t.resolveMode=Vt,t.getMode=Gt,t.modeExtensions=oa,t.extendMode=Zt,t.copyState=Kt,t.startState=Xt,t.innerMode=Yt,t.commands=Fa,t.keyMap=Ha,t.keyName=lo,t.isModifierKey=so,t.lookupKey=oo,t.normalizeKeyMap=ro,t.StringStream=sa,t.SharedTextMarker=Da,t.TextMarker=Pa,t.LineWidget=ka,t.e_preventDefault=Rt,t.e_stopPropagation=Ot,t.e_stop=Ht,t.addClass=a,t.contains=o,t.rmClass=Ls,t.keyNames=Aa}var ls=navigator.userAgent,hs=navigator.platform,cs=/gecko\/\d/i.test(ls),us=/MSIE \d/.test(ls),ds=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ls),fs=/Edge\/(\d+)/.exec(ls),ps=us||ds||fs,gs=ps&&(us?document.documentMode||6:+(fs||ds)[1]),ms=!fs&&/WebKit\//.test(ls),vs=ms&&/Qt\/\d+\.\d+/.test(ls),ys=!fs&&/Chrome\//.test(ls),bs=/Opera\//.test(ls),_s=/Apple Computer/.test(navigator.vendor),ws=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ls),xs=/PhantomJS/.test(ls),Cs=!fs&&/AppleWebKit/.test(ls)&&/Mobile\/\w+/.test(ls),Ss=/Android/.test(ls),Ts=Cs||Ss||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ls),ks=Cs||/Mac/.test(hs),Es=/\bCrOS\b/.test(ls),Ps=/win/i.test(hs),Ds=bs&&ls.match(/Version\/(\d*\.\d*)/);Ds&&(Ds=Number(Ds[1])),Ds&&Ds>=15&&(bs=!1,ms=!0);var Is,Ns=ks&&(vs||bs&&(null==Ds||Ds<12.11)),Ms=cs||ps&&gs>=9,Ls=function(e,i){var n=e.className,r=t(i).exec(n);if(r){var o=n.slice(r.index+r[0].length);e.className=n.slice(0,r.index)+(o?r[1]+o:"")}};Is=document.createRange?function(t,e,i,n){var r=document.createRange();return r.setEnd(n||t,i),r.setStart(t,e),r}:function(t,e,i){var n=document.body.createTextRange();try{n.moveToElementText(t.parentNode)}catch(t){return n}return n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",e),n};var As=function(t){t.select()};Cs?As=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:ps&&(As=function(t){try{t.select()}catch(t){}});var Rs=function(){this.id=null};Rs.prototype.set=function(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)};var Os,zs,Hs=30,Fs={toString:function(){return"CodeMirror.Pass"}},Bs={scroll:!1},$s={origin:"*mouse"},js={origin:"+move"},Ws=[""],qs=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Us=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Vs=!1,Gs=!1,Zs=null,Ks=function(){function t(t){return t<=247?i.charAt(t):1424<=t&&t<=1524?"R":1536<=t&&t<=1785?n.charAt(t-1536):1774<=t&&t<=2220?"r":8192<=t&&t<=8203?"w":8204==t?"b":"L"}function e(t,e,i){this.level=t,this.from=e,this.to=i}var i="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,s=/[LRr]/,a=/[Lb1n]/,l=/[1n]/;return function(i,n){var h="ltr"==n?"L":"R";if(0==i.length||"ltr"==n&&!r.test(i))return!1;for(var c=i.length,u=[],d=0;d<c;++d)u.push(t(i.charCodeAt(d)));for(var f=0,p=h;f<c;++f){var m=u[f];"m"==m?u[f]=p:p=m}for(var v=0,y=h;v<c;++v){var b=u[v];"1"==b&&"r"==y?u[v]="n":s.test(b)&&(y=b,"r"==b&&(u[v]="R"))}for(var _=1,w=u[0];_<c-1;++_){var x=u[_];"+"==x&&"1"==w&&"1"==u[_+1]?u[_]="1":","!=x||w!=u[_+1]||"1"!=w&&"n"!=w||(u[_]=w),w=x}for(var C=0;C<c;++C){var S=u[C];if(","==S)u[C]="N";else if("%"==S){var T=void 0;for(T=C+1;T<c&&"%"==u[T];++T);for(var k=C&&"!"==u[C-1]||T<c&&"1"==u[T]?"1":"N",E=C;E<T;++E)u[E]=k;C=T-1}}for(var P=0,D=h;P<c;++P){var I=u[P];"L"==D&&"1"==I?u[P]="L":s.test(I)&&(D=I)}for(var N=0;N<c;++N)if(o.test(u[N])){var M=void 0;for(M=N+1;M<c&&o.test(u[M]);++M);for(var L="L"==(N?u[N-1]:h),A="L"==(M<c?u[M]:h),R=L==A?L?"L":"R":h,O=N;O<M;++O)u[O]=R;N=M-1}for(var z,H=[],F=0;F<c;)if(a.test(u[F])){var B=F;for(++F;F<c&&a.test(u[F]);++F);H.push(new e(0,B,F))}else{var $=F,j=H.length;for(++F;F<c&&"L"!=u[F];++F);for(var W=$;W<F;)if(l.test(u[W])){$<W&&H.splice(j,0,new e(1,$,W));var q=W;for(++W;W<F&&l.test(u[W]);++W);H.splice(j,0,new e(2,q,W)),$=W}else++W;$<F&&H.splice(j,0,new e(1,$,F))}return 1==H[0].level&&(z=i.match(/^\s+/))&&(H[0].from=z[0].length,H.unshift(new e(0,0,z[0].length))),1==g(H).level&&(z=i.match(/\s+$/))&&(g(H).to-=z[0].length,H.push(new e(0,c-z[0].length,c))),"rtl"==n?H.reverse():H}}(),Ys=[],Xs=function(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else if(t.attachEvent)t.attachEvent("on"+e,i);else{var n=t._handlers||(t._handlers={});n[e]=(n[e]||Ys).concat(i)}},Js=function(){if(ps&&gs<9)return!1;var t=n("div");return"draggable"in t||"dragDrop"in t}(),Qs=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,i=[],n=t.length;e<=n;){var r=t.indexOf("\n",e);-1==r&&(r=t.length);var o=t.slice(e,"\r"==t.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),e+=s+1):(i.push(o),e=r+1)}return i}:function(t){return t.split(/\r\n?|\n/)},ta=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){var e;try{e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},ea=function(){var t=n("div");return"oncopy"in t||(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)}(),ia=null,na={},ra={},oa={},sa=function(t,e,i){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i};sa.prototype.eol=function(){return this.pos>=this.string.length},sa.prototype.sol=function(){return this.pos==this.lineStart},sa.prototype.peek=function(){return this.string.charAt(this.pos)||undefined},sa.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},sa.prototype.eat=function(t){var e=this.string.charAt(this.pos);if("string"==typeof t?e==t:e&&(t.test?t.test(e):t(e)))return++this.pos,e},sa.prototype.eatWhile=function(t){for(var e=this.pos;this.eat(t););return this.pos>e},sa.prototype.eatSpace=function(){for(var t=this,e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++t.pos;return this.pos>e},sa.prototype.skipToEnd=function(){this.pos=this.string.length},sa.prototype.skipTo=function(t){var e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0},sa.prototype.backUp=function(t){this.pos-=t},sa.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=u(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?u(this.string,this.lineStart,this.tabSize):0)},sa.prototype.indentation=function(){return u(this.string,null,this.tabSize)-(this.lineStart?u(this.string,this.lineStart,this.tabSize):0)},sa.prototype.match=function(t,e,i){if("string"!=typeof t){var n=this.string.slice(this.pos).match(t);return n&&n.index>0?null:(n&&!1!==e&&(this.pos+=n[0].length),n)}var r=function(t){return i?t.toLowerCase():t};if(r(this.string.substr(this.pos,t.length))==r(t))return!1!==e&&(this.pos+=t.length),!0},sa.prototype.current=function(){return this.string.slice(this.start,this.pos)},sa.prototype.hideFirstChars=function(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}},sa.prototype.lookAhead=function(t){var e=this.lineOracle;return e&&e.lookAhead(t)};var aa=function(t,e){this.state=t,this.lookAhead=e},la=function(t,e,i,n){this.state=e,this.doc=t,this.line=i,this.maxLookAhead=n||0};la.prototype.lookAhead=function(t){var e=this.doc.getLine(this.line+t);return null!=e&&t>this.maxLookAhead&&(this.maxLookAhead=t),e},la.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},la.fromSaved=function(t,e,i){return e instanceof aa?new la(t,Kt(t.mode,e.state),i,e.lookAhead):new la(t,Kt(t.mode,e),i)},la.prototype.save=function(t){var e=!1!==t?Kt(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new aa(e,this.maxLookAhead):e};var ha=function(t,e,i){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=e||null,this.state=i},ca=function(t,e,i){this.text=t,nt(this,e),this.height=i?i(this):1};ca.prototype.lineNo=function(){return N(this)},At(ca);var ua,da={},fa={},pa=null,ga=null,ma={left:0,right:0,top:0,bottom:0},va=function(t,e,i){this.cm=i;var r=this.vert=n("div",[n("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=n("div",[n("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");t(r),t(o),Xs(r,"scroll",function(){r.clientHeight&&e(r.scrollTop,"vertical")}),Xs(o,"scroll",function(){o.clientWidth&&e(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,ps&&gs<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};va.prototype.update=function(t){var e=t.scrollWidth>t.clientWidth+1,i=t.scrollHeight>t.clientHeight+1,n=t.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=e?n+"px":"0";var r=t.viewHeight-(e?n:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+r)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(e){this.horiz.style.display="block",this.horiz.style.right=i?n+"px":"0",this.horiz.style.left=t.barLeft+"px";var o=t.viewWidth-t.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?n:0,bottom:e?n:0}},va.prototype.setScrollLeft=function(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},va.prototype.setScrollTop=function(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},va.prototype.zeroWidthHack=function(){var t=ks&&!ws?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Rs,this.disableVert=new Rs},va.prototype.enableZeroWidthBar=function(t,e,i){function n(){var r=t.getBoundingClientRect();("vert"==i?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=t?t.style.pointerEvents="none":e.set(1e3,n)}t.style.pointerEvents="auto",e.set(1e3,n)},va.prototype.clear=function(){var t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)};var ya=function(){};ya.prototype.update=function(){return{bottom:0,right:0}},ya.prototype.setScrollLeft=function(){},ya.prototype.setScrollTop=function(){},ya.prototype.clear=function(){};var ba={"native":va,"null":ya},_a=0,wa=function(t,e,i){var n=t.display;this.viewport=e,this.visible=zi(n,t.doc,e),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=qe(t),this.force=i,this.dims=_i(t),this.events=[]};wa.prototype.signal=function(t,e){Lt(t,e)&&this.events.push(arguments)},wa.prototype.finish=function(){for(var t=this,e=0;e<this.events.length;e++)It.apply(null,t.events[e])};var xa=0,Ca=null;ps?Ca=-.53:cs?Ca=15:ys?Ca=-.7:_s&&(Ca=-1/3);var Sa=function(t,e){this.ranges=t,this.primIndex=e};Sa.prototype.primary=function(){return this.ranges[this.primIndex]},Sa.prototype.equals=function(t){var e=this;if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(var i=0;i<this.ranges.length;i++){var n=e.ranges[i],r=t.ranges[i];if(!z(n.anchor,r.anchor)||!z(n.head,r.head))return!1}return!0},Sa.prototype.deepCopy=function(){for(var t=this,e=[],i=0;i<this.ranges.length;i++)e[i]=new Ta(H(t.ranges[i].anchor),H(t.ranges[i].head));return new Sa(e,this.primIndex)},Sa.prototype.somethingSelected=function(){for(var t=this,e=0;e<this.ranges.length;e++)if(!t.ranges[e].empty())return!0;return!1},Sa.prototype.contains=function(t,e){var i=this;e||(e=t);for(var n=0;n<this.ranges.length;n++){var r=i.ranges[n];if(O(e,r.from())>=0&&O(t,r.to())<=0)return n}return-1};var Ta=function(t,e){this.anchor=t,this.head=e};Ta.prototype.from=function(){return B(this.anchor,this.head)},Ta.prototype.to=function(){return F(this.anchor,this.head)},Ta.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Br.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var i=this,n=t,r=t+e;n<r;++n){var o=i.lines[n];i.height-=o.height,ce(o),Se(o,"delete")}this.lines.splice(t,e)},collapse:function(t){t.push.apply(t,this.lines)},insertInner:function(t,e,i){var n=this;this.height+=i,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var r=0;r<e.length;++r)e[r].parent=n},iterN:function(t,e,i){for(var n=this,r=t+e;t<r;++t)if(i(n.lines[t]))return!0}},$r.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){var i=this;this.size-=e;for(var n=0;n<this.children.length;++n){var r=i.children[n],o=r.chunkSize();if(t<o){var s=Math.min(e,o-t),a=r.height;if(r.removeInner(t,s),i.height-=a-r.height,o==s&&(i.children.splice(n--,1),r.parent=null),0==(e-=s))break;t=0}else t-=o}if(this.size-e<25&&(this.children.length>1||!(this.children[0]instanceof Br))){var l=[];this.collapse(l),this.children=[new Br(l)],this.children[0].parent=this}},collapse:function(t){for(var e=this,i=0;i<this.children.length;++i)e.children[i].collapse(t)},insertInner:function(t,e,i){var n=this;this.size+=e.length,this.height+=i;for(var r=0;r<this.children.length;++r){var o=n.children[r],s=o.chunkSize();if(t<=s){if(o.insertInner(t,e,i),o.lines&&o.lines.length>50){for(var a=o.lines.length%25+25,l=a;l<o.lines.length;){var h=new Br(o.lines.slice(l,l+=25));o.height-=h.height,n.children.splice(++r,0,h),h.parent=n}o.lines=o.lines.slice(0,a),n.maybeSpill()}break}t-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e=t.children.splice(t.children.length-5,5),i=new $r(e);if(t.parent){t.size-=i.size,t.height-=i.height;var n=d(t.parent.children,t);t.parent.children.splice(n+1,0,i)}else{var r=new $r(t.children);r.parent=t,t.children=[r,i],t=r}i.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,e,i){for(var n=this,r=0;r<this.children.length;++r){var o=n.children[r],s=o.chunkSize();if(t<s){var a=Math.min(e,s-t);if(o.iterN(t,a,i))return!0;if(0==(e-=a))break;t=0}else t-=s}}};var ka=function(t,e,i){var n=this;if(i)for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);this.doc=t,this.node=e};ka.prototype.clear=function(){var t=this,e=this.doc.cm,i=this.line.widgets,n=this.line,r=N(n);if(null!=r&&i){for(var o=0;o<i.length;++o)i[o]==t&&i.splice(o--,1);i.length||(n.widgets=null);var s=He(this);I(n,Math.max(0,n.height-s)),e&&(dn(e,function(){jr(e,n,-s),vn(e,r,"widget")}),Se(e,"lineWidgetCleared",e,this,r))}},ka.prototype.changed=function(){var t=this,e=this.height,i=this.doc.cm,n=this.line;this.height=null;var r=He(this)-e;r&&(I(n,n.height+r),i&&dn(i,function(){i.curOp.forceUpdate=!0,jr(i,n,r),Se(i,"lineWidgetChanged",i,t,N(n))}))},At(ka);var Ea=0,Pa=function(t,e){this.lines=[],this.type=e,this.doc=t,this.id=++Ea};Pa.prototype.clear=function(){var t=this;if(!this.explicitlyCleared){var e=this.doc.cm,i=e&&!e.curOp;if(i&&rn(e),Lt(this,"clear")){var n=this.find();n&&Se(this,"clear",n.from,n.to)}for(var r=null,o=null,s=0;s<this.lines.length;++s){var a=t.lines[s],l=Z(a.markedSpans,t);e&&!t.collapsed?vn(e,N(a),"text"):e&&(null!=l.to&&(o=N(a)),null!=l.from&&(r=N(a))),a.markedSpans=K(a.markedSpans,l),null==l.from&&t.collapsed&&!mt(t.doc,a)&&e&&I(a,yi(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var h=0;h<this.lines.length;++h){var c=ut(t.lines[h]),u=bt(c);u>e.display.maxLineLength&&(e.display.maxLine=c,e.display.maxLineLength=u,e.display.maxLineChanged=!0)}null!=r&&e&&this.collapsed&&mn(e,r,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&xr(e.doc)),e&&Se(e,"markerCleared",e,this,r,o),i&&on(e),this.parent&&this.parent.clear()}},Pa.prototype.find=function(t,e){var i=this;null==t&&"bookmark"==this.type&&(t=1);for(var n,r,o=0;o<this.lines.length;++o){var s=i.lines[o],a=Z(s.markedSpans,i);if(null!=a.from&&(n=R(e?s:N(s),a.from),-1==t))return n;if(null!=a.to&&(r=R(e?s:N(s),a.to),1==t))return r}return n&&{from:n,to:r}},Pa.prototype.changed=function(){var t=this,e=this.find(-1,!0),i=this,n=this.doc.cm;e&&n&&dn(n,function(){var r=e.line,o=N(e.line),s=Ye(n,o);if(s&&(ni(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!mt(i.doc,r)&&null!=i.height){var a=i.height;i.height=null;var l=He(i)-a;l&&I(r,r.height+l)}Se(n,"markerChanged",n,t)})},Pa.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=d(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},Pa.prototype.detachLine=function(t){if(this.lines.splice(d(this.lines,t),1),!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}},At(Pa);var Da=function(t,e){var i=this;this.markers=t,this.primary=e;for(var n=0;n<t.length;++n)t[n].parent=i};Da.prototype.clear=function(){var t=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)t.markers[e].clear();Se(this,"clear")}},Da.prototype.find=function(t,e){return this.primary.find(t,e)},At(Da);var Ia=0,Na=function(t,e,i,n,r){if(!(this instanceof Na))return new Na(t,e,i,n,r);null==i&&(i=0),$r.call(this,[new Br([new ca("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;var o=R(i,0);this.sel=Fn(o),this.history=new Qn(null),this.id=++Ia,this.modeOption=e,this.lineSep=n,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof t&&(t=this.splitLines(t)),Zn(this,{from:o,to:o,text:t}),br(this,Fn(o),Bs)};Na.prototype=b($r.prototype,{constructor:Na,iter:function(t,e,i){i?this.iterN(t-this.first,e-t,i):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var i=0,n=0;n<e.length;++n)i+=e[n].height;this.insertInner(t-this.first,e,i)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=D(this,this.first,this.first+this.size);return!1===t?e:e.join(t||this.lineSeparator())},setValue:gn(function(t){var e=R(this.first,0),i=this.first+this.size-1;Dr(this,{from:e,to:R(i,E(this,i).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&Vi(this.cm,0,0),br(this,Fn(e),Bs)}),replaceRange:function(t,e,i,n){e=j(this,e),i=i?j(this,i):e,Rr(this,t,e,i,n)},getRange:function(t,e,i){var n=P(this,j(this,t),j(this,e));return!1===i?n:n.join(i||this.lineSeparator())},getLine:function(t){var e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){if(L(this,t))return E(this,t)},getLineNumber:function(t){return N(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=E(this,t)),ut(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return j(this,t)},getCursor:function(t){var e=this.sel.primary();return null==t||"head"==t?e.head:"anchor"==t?e.anchor:"end"==t||"to"==t||!1===t?e.to():e.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},
setCursor:gn(function(t,e,i){mr(this,j(this,"number"==typeof t?R(t,e||0):t),null,i)}),setSelection:gn(function(t,e,i){mr(this,j(this,t),j(this,e||t),i)}),extendSelection:gn(function(t,e,i){fr(this,j(this,t),e&&j(this,e),i)}),extendSelections:gn(function(t,e){pr(this,q(this,t),e)}),extendSelectionsBy:gn(function(t,e){pr(this,q(this,m(this.sel.ranges,t)),e)}),setSelections:gn(function(t,e,i){var n=this;if(t.length){for(var r=[],o=0;o<t.length;o++)r[o]=new Ta(j(n,t[o].anchor),j(n,t[o].head));null==e&&(e=Math.min(t.length-1,this.sel.primIndex)),br(this,Hn(r,e),i)}}),addSelection:gn(function(t,e,i){var n=this.sel.ranges.slice(0);n.push(new Ta(j(this,t),j(this,e||t))),br(this,Hn(n,n.length-1),i)}),getSelection:function(t){for(var e,i=this,n=this.sel.ranges,r=0;r<n.length;r++){var o=P(i,n[r].from(),n[r].to());e=e?e.concat(o):o}return!1===t?e:e.join(t||this.lineSeparator())},getSelections:function(t){for(var e=this,i=[],n=this.sel.ranges,r=0;r<n.length;r++){var o=P(e,n[r].from(),n[r].to());!1!==t&&(o=o.join(t||e.lineSeparator())),i[r]=o}return i},replaceSelection:function(t,e,i){for(var n=[],r=0;r<this.sel.ranges.length;r++)n[r]=t;this.replaceSelections(n,e,i||"+input")},replaceSelections:gn(function(t,e,i){for(var n=this,r=[],o=this.sel,s=0;s<o.ranges.length;s++){var a=o.ranges[s];r[s]={from:a.from(),to:a.to(),text:n.splitLines(t[s]),origin:i}}for(var l=e&&"end"!=e&&qn(this,r,e),h=r.length-1;h>=0;h--)Dr(n,r[h]);l?yr(this,l):this.cm&&Ui(this.cm)}),undo:gn(function(){Nr(this,"undo")}),redo:gn(function(){Nr(this,"redo")}),undoSelection:gn(function(){Nr(this,"undo",!0)}),redoSelection:gn(function(){Nr(this,"redo",!0)}),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){for(var t=this.history,e=0,i=0,n=0;n<t.done.length;n++)t.done[n].ranges||++e;for(var r=0;r<t.undone.length;r++)t.undone[r].ranges||++i;return{undo:e,redo:i}},clearHistory:function(){this.history=new Qn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:ur(this.history.done),undone:ur(this.history.undone)}},setHistory:function(t){var e=this.history=new Qn(this.history.maxGeneration);e.done=ur(t.done.slice(0),null,!0),e.undone=ur(t.undone.slice(0),null,!0)},setGutterMarker:gn(function(t,e,i){return Fr(this,t,"gutter",function(t){var n=t.gutterMarkers||(t.gutterMarkers={});return n[e]=i,!i&&x(n)&&(t.gutterMarkers=null),!0})}),clearGutter:gn(function(t){var e=this;this.iter(function(i){i.gutterMarkers&&i.gutterMarkers[t]&&Fr(e,i,"gutter",function(){return i.gutterMarkers[t]=null,x(i.gutterMarkers)&&(i.gutterMarkers=null),!0})})}),lineInfo:function(t){var e;if("number"==typeof t){if(!L(this,t))return null;if(e=t,!(t=E(this,t)))return null}else if(null==(e=N(t)))return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:gn(function(e,i,n){return Fr(this,e,"gutter"==i?"gutter":"class",function(e){var r="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass";if(e[r]){if(t(n).test(e[r]))return!1;e[r]+=" "+n}else e[r]=n;return!0})}),removeLineClass:gn(function(e,i,n){return Fr(this,e,"gutter"==i?"gutter":"class",function(e){var r="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass",o=e[r];if(!o)return!1;if(null==n)e[r]=null;else{var s=o.match(t(n));if(!s)return!1;var a=s.index+s[0].length;e[r]=o.slice(0,s.index)+(s.index&&a!=o.length?" ":"")+o.slice(a)||null}return!0})}),addLineWidget:gn(function(t,e,i){return Wr(this,t,e,i)}),removeLineWidget:function(t){t.clear()},markText:function(t,e,i){return qr(this,j(this,t),j(this,e),i,i&&i.type||"range")},setBookmark:function(t,e){var i={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft,clearWhenEmpty:!1,shared:e&&e.shared,handleMouseEvents:e&&e.handleMouseEvents};return t=j(this,t),qr(this,t,t,i,"bookmark")},findMarksAt:function(t){t=j(this,t);var e=[],i=E(this,t.line).markedSpans;if(i)for(var n=0;n<i.length;++n){var r=i[n];(null==r.from||r.from<=t.ch)&&(null==r.to||r.to>=t.ch)&&e.push(r.marker.parent||r.marker)}return e},findMarks:function(t,e,i){t=j(this,t),e=j(this,e);var n=[],r=t.line;return this.iter(t.line,e.line+1,function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&r==t.line&&t.ch>=l.to||null==l.from&&r!=t.line||null!=l.from&&r==e.line&&l.from>=e.ch||i&&!i(l.marker)||n.push(l.marker.parent||l.marker)}++r}),n},getAllMarks:function(){var t=[];return this.iter(function(e){var i=e.markedSpans;if(i)for(var n=0;n<i.length;++n)null!=i[n].from&&t.push(i[n].marker)}),t},posFromIndex:function(t){var e,i=this.first,n=this.lineSeparator().length;return this.iter(function(r){var o=r.text.length+n;if(o>t)return e=t,!0;t-=o,++i}),j(this,R(i,e))},indexFromPos:function(t){t=j(this,t);var e=t.ch;if(t.line<this.first||t.ch<0)return 0;var i=this.lineSeparator().length;return this.iter(this.first,t.line,function(t){e+=t.text.length+i}),e},copy:function(t){var e=new Na(D(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel=this.sel,e.extend=!1,t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});var e=this.first,i=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<i&&(i=t.to);var n=new Na(D(this,e,i),t.mode||this.modeOption,e,this.lineSep,this.direction);return t.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:t.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],Gr(n,Vr(this)),n},unlinkDoc:function(t){var e=this;if(t instanceof $o&&(t=t.doc),this.linked)for(var i=0;i<this.linked.length;++i){var n=e.linked[i];if(n.doc==t){e.linked.splice(i,1),t.unlinkDoc(e),Zr(Vr(e));break}}if(t.history==this.history){var r=[t.id];Kn(t,function(t){return r.push(t.id)},!0),t.history=new Qn(null),t.history.done=ur(this.history.done,r),t.history.undone=ur(this.history.undone,r)}},iterLinkedDocs:function(t){Kn(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):Qs(t)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:gn(function(t){"rtl"!=t&&(t="ltr"),t!=this.direction&&(this.direction=t,this.iter(function(t){return t.order=null}),this.cm&&Jn(this.cm))})}),Na.prototype.eachLine=Na.prototype.iter;for(var Ma=0,La=!1,Aa={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ra=0;Ra<10;Ra++)Aa[Ra+48]=Aa[Ra+96]=String(Ra);for(var Oa=65;Oa<=90;Oa++)Aa[Oa]=String.fromCharCode(Oa);for(var za=1;za<=12;za++)Aa[za+111]=Aa[za+63235]="F"+za;var Ha={};Ha.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Ha.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Ha.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Ha.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Ha["default"]=ks?Ha.macDefault:Ha.pcDefault;var Fa={selectAll:Er,singleSelection:function(t){return t.setSelection(t.getCursor("anchor"),t.getCursor("head"),Bs)},killLine:function(t){return co(t,function(e){if(e.empty()){var i=E(t.doc,e.head.line).text.length;return e.head.ch==i&&e.head.line<t.lastLine()?{from:e.head,to:R(e.head.line+1,0)}:{from:e.head,to:R(e.head.line,i)}}return{from:e.from(),to:e.to()}})},deleteLine:function(t){return co(t,function(e){return{from:R(e.from().line,0),to:j(t.doc,R(e.to().line+1,0))}})},delLineLeft:function(t){return co(t,function(t){return{from:R(t.from().line,0),to:t.from()}})},delWrappedLineLeft:function(t){return co(t,function(e){var i=t.charCoords(e.head,"div").top+5;return{from:t.coordsChar({left:0,top:i},"div"),to:e.from()}})},delWrappedLineRight:function(t){return co(t,function(e){var i=t.charCoords(e.head,"div").top+5,n=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div");return{from:e.from(),to:n}})},undo:function(t){return t.undo()},redo:function(t){return t.redo()},undoSelection:function(t){return t.undoSelection()},redoSelection:function(t){return t.redoSelection()},goDocStart:function(t){return t.extendSelection(R(t.firstLine(),0))},goDocEnd:function(t){return t.extendSelection(R(t.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy(function(e){return uo(t,e.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy(function(e){return po(t,e.head)},{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy(function(e){return fo(t,e.head.line)},{origin:"+move",bias:-1})},goLineRight:function(t){return t.extendSelectionsBy(function(e){var i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div")},js)},goLineLeft:function(t){return t.extendSelectionsBy(function(e){var i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:i},"div")},js)},goLineLeftSmart:function(t){return t.extendSelectionsBy(function(e){var i=t.cursorCoords(e.head,"div").top+5,n=t.coordsChar({left:0,top:i},"div");return n.ch<t.getLine(n.line).search(/\S/)?po(t,e.head):n},js)},goLineUp:function(t){return t.moveV(-1,"line")},goLineDown:function(t){return t.moveV(1,"line")},goPageUp:function(t){return t.moveV(-1,"page")},goPageDown:function(t){return t.moveV(1,"page")},goCharLeft:function(t){return t.moveH(-1,"char")},goCharRight:function(t){return t.moveH(1,"char")},goColumnLeft:function(t){return t.moveH(-1,"column")},goColumnRight:function(t){return t.moveH(1,"column")},goWordLeft:function(t){return t.moveH(-1,"word")},goGroupRight:function(t){return t.moveH(1,"group")},goGroupLeft:function(t){return t.moveH(-1,"group")},goWordRight:function(t){return t.moveH(1,"word")},delCharBefore:function(t){return t.deleteH(-1,"char")},delCharAfter:function(t){return t.deleteH(1,"char")},delWordBefore:function(t){return t.deleteH(-1,"word")},delWordAfter:function(t){return t.deleteH(1,"word")},delGroupBefore:function(t){return t.deleteH(-1,"group")},delGroupAfter:function(t){return t.deleteH(1,"group")},indentAuto:function(t){return t.indentSelection("smart")},indentMore:function(t){return t.indentSelection("add")},indentLess:function(t){return t.indentSelection("subtract")},insertTab:function(t){return t.replaceSelection("\t")},insertSoftTab:function(t){for(var e=[],i=t.listSelections(),n=t.options.tabSize,r=0;r<i.length;r++){var o=i[r].from(),s=u(t.getLine(o.line),o.ch,n);e.push(p(n-s%n))}t.replaceSelections(e)},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:function(t){return dn(t,function(){for(var e=t.listSelections(),i=[],n=0;n<e.length;n++)if(e[n].empty()){var r=e[n].head,o=E(t.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new R(r.line,r.ch-1)),r.ch>0)r=new R(r.line,r.ch+1),t.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),R(r.line,r.ch-2),r,"+transpose");else if(r.line>t.doc.first){var s=E(t.doc,r.line-1).text;s&&(r=new R(r.line,1),t.replaceRange(o.charAt(0)+t.doc.lineSeparator()+s.charAt(s.length-1),R(r.line-1,s.length-1),r,"+transpose"))}i.push(new Ta(r,r))}t.setSelections(i)})},newlineAndIndent:function(t){return dn(t,function(){for(var e=t.listSelections(),i=e.length-1;i>=0;i--)t.replaceRange(t.doc.lineSeparator(),e[i].anchor,e[i].head,"+input");e=t.listSelections();for(var n=0;n<e.length;n++)t.indentLine(e[n].from().line,null,!0);Ui(t)})},openLine:function(t){return t.replaceSelection("\n","start")},toggleOverwrite:function(t){return t.toggleOverwrite()}},Ba=new Rs,$a=null,ja=function(t,e,i){this.time=t,this.pos=e,this.button=i};ja.prototype.compare=function(t,e,i){return this.time+400>t&&0==O(e,this.pos)&&i==this.button};var Wa,qa,Ua={toString:function(){return"CodeMirror.Init"}},Va={},Ga={};$o.defaults=Va,$o.optionHandlers=Ga;var Za=[];$o.defineInitHook=function(t){return Za.push(t)};var Ka=null,Ya=function(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Rs,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Ya.prototype.init=function(t){function e(t){if(!Nt(r,t)){if(r.somethingSelected())qo({lineWise:!1,text:r.getSelections()}),"cut"==t.type&&r.replaceSelection("",null,"cut");else{if(!r.options.lineWiseCopyCut)return;var e=Zo(r);qo({lineWise:!0,text:e.text}),"cut"==t.type&&r.operation(function(){r.setSelections(e.ranges,0,Bs),r.replaceSelection("",null,"cut")})}if(t.clipboardData){t.clipboardData.clearData();var i=Ka.text.join("\n");if(t.clipboardData.setData("Text",i),t.clipboardData.getData("Text")==i)return void t.preventDefault()}var s=Yo(),a=s.firstChild;r.display.lineSpace.insertBefore(s,r.display.lineSpace.firstChild),a.value=Ka.text.join("\n");var l=document.activeElement;As(a),setTimeout(function(){r.display.lineSpace.removeChild(s),l.focus(),l==o&&n.showPrimarySelection()},50)}}var i=this,n=this,r=n.cm,o=n.div=t.lineDiv;Ko(o,r.options.spellcheck),Xs(o,"paste",function(t){Nt(r,t)||Vo(t,r)||gs<=11&&setTimeout(fn(r,function(){return i.updateFromDOM()}),20)}),Xs(o,"compositionstart",function(t){i.composing={data:t.data,done:!1}}),Xs(o,"compositionupdate",function(t){i.composing||(i.composing={data:t.data,done:!1})}),Xs(o,"compositionend",function(t){i.composing&&(t.data!=i.composing.data&&i.readFromDOMSoon(),i.composing.done=!0)}),Xs(o,"touchstart",function(){return n.forceCompositionEnd()}),Xs(o,"input",function(){i.composing||i.readFromDOMSoon()}),Xs(o,"copy",e),Xs(o,"cut",e)},Ya.prototype.prepareSelection=function(){var t=Ei(this.cm,!1);return t.focus=this.cm.state.focused,t},Ya.prototype.showSelection=function(t,e){t&&this.cm.display.view.length&&((t.focus||e)&&this.showPrimarySelection(),this.showMultipleSelections(t))},Ya.prototype.showPrimarySelection=function(){var t=window.getSelection(),e=this.cm,i=e.doc.sel.primary(),n=i.from(),r=i.to();if(e.display.viewTo==e.display.viewFrom||n.line>=e.display.viewTo||r.line<e.display.viewFrom)return void t.removeAllRanges();var o=rs(e,t.anchorNode,t.anchorOffset),s=rs(e,t.focusNode,t.focusOffset);if(!o||o.bad||!s||s.bad||0!=O(B(o,s),n)||0!=O(F(o,s),r)){var a=e.display.view,l=n.line>=e.display.viewFrom&&ts(e,n)||{node:a[0].measure.map[2],offset:0},h=r.line<e.display.viewTo&&ts(e,r);if(!h){var c=a[a.length-1].measure,u=c.maps?c.maps[c.maps.length-1]:c.map;h={node:u[u.length-1],offset:u[u.length-2]-u[u.length-3]}}if(!l||!h)return void t.removeAllRanges();var d,f=t.rangeCount&&t.getRangeAt(0);try{d=Is(l.node,l.offset,h.offset,h.node)}catch(t){}d&&(!cs&&e.state.focused?(t.collapse(l.node,l.offset),d.collapsed||(t.removeAllRanges(),t.addRange(d))):(t.removeAllRanges(),t.addRange(d)),f&&null==t.anchorNode?t.addRange(f):cs&&this.startGracePeriod()),this.rememberSelection()}},Ya.prototype.startGracePeriod=function(){var t=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){t.gracePeriod=!1,t.selectionChanged()&&t.cm.operation(function(){return t.cm.curOp.selectionChanged=!0})},20)},Ya.prototype.showMultipleSelections=function(t){i(this.cm.display.cursorDiv,t.cursors),i(this.cm.display.selectionDiv,t.selection)},Ya.prototype.rememberSelection=function(){var t=window.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset},Ya.prototype.selectionInEditor=function(){var t=window.getSelection();if(!t.rangeCount)return!1;var e=t.getRangeAt(0).commonAncestorContainer;return o(this.div,e)},Ya.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Ya.prototype.blur=function(){this.div.blur()},Ya.prototype.getField=function(){return this.div},Ya.prototype.supportsTouch=function(){return!0},Ya.prototype.receivedFocus=function(){function t(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,t))}var e=this;this.selectionInEditor()?this.pollSelection():dn(this.cm,function(){return e.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,t)},Ya.prototype.selectionChanged=function(){var t=window.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset},Ya.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var t=window.getSelection(),e=this.cm;if(Ss&&ys&&this.cm.options.gutters.length&&es(t.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var i=rs(e,t.anchorNode,t.anchorOffset),n=rs(e,t.focusNode,t.focusOffset);i&&n&&dn(e,function(){br(e.doc,Fn(i,n),Bs),(i.bad||n.bad)&&(e.curOp.selectionChanged=!0)})}}},Ya.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var t=this.cm,e=t.display,i=t.doc.sel.primary(),n=i.from(),r=i.to();if(0==n.ch&&n.line>t.firstLine()&&(n=R(n.line-1,E(t.doc,n.line-1).length)),r.ch==E(t.doc,r.line).text.length&&r.line<t.lastLine()&&(r=R(r.line+1,0)),n.line<e.viewFrom||r.line>e.viewTo-1)return!1;var o,s,a;n.line==e.viewFrom||0==(o=Ti(t,n.line))?(s=N(e.view[0].line),a=e.view[0].node):(s=N(e.view[o].line),a=e.view[o-1].node.nextSibling);var l,h,c=Ti(t,r.line);if(c==e.view.length-1?(l=e.viewTo-1,h=e.lineDiv.lastChild):(l=N(e.view[c+1].line)-1,h=e.view[c+1].node.previousSibling),!a)return!1;for(var u=t.doc.splitLines(ns(t,a,h,s,l)),d=P(t.doc,R(s,0),R(l,E(t.doc,l).text.length));u.length>1&&d.length>1;)if(g(u)==g(d))u.pop(),d.pop(),l--;else{if(u[0]!=d[0])break;u.shift(),d.shift(),s++}for(var f=0,p=0,m=u[0],v=d[0],y=Math.min(m.length,v.length);f<y&&m.charCodeAt(f)==v.charCodeAt(f);)++f;for(var b=g(u),_=g(d),w=Math.min(b.length-(1==u.length?f:0),_.length-(1==d.length?f:0));p<w&&b.charCodeAt(b.length-p-1)==_.charCodeAt(_.length-p-1);)++p;if(1==u.length&&1==d.length&&s==n.line)for(;f&&f>n.ch&&b.charCodeAt(b.length-p-1)==_.charCodeAt(_.length-p-1);)f--,p++;u[u.length-1]=b.slice(0,b.length-p).replace(/^\u200b+/,""),u[0]=u[0].slice(f).replace(/\u200b+$/,"");var x=R(s,f),C=R(l,d.length?g(d).length-p:0);return u.length>1||u[0]||O(x,C)?(Rr(t.doc,u,x,C,"+input"),!0):void 0},Ya.prototype.ensurePolled=function(){this.forceCompositionEnd()},Ya.prototype.reset=function(){this.forceCompositionEnd()},Ya.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Ya.prototype.readFromDOMSoon=function(){var t=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(t.readDOMTimeout=null,t.composing){if(!t.composing.done)return;t.composing=null}t.updateFromDOM()},80))},Ya.prototype.updateFromDOM=function(){var t=this;!this.cm.isReadOnly()&&this.pollContent()||dn(this.cm,function(){return mn(t.cm)})},Ya.prototype.setUneditable=function(t){t.contentEditable="false"},Ya.prototype.onKeyPress=function(t){0!=t.charCode&&(t.preventDefault(),this.cm.isReadOnly()||fn(this.cm,Uo)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0))},Ya.prototype.readOnlyChanged=function(t){this.div.contentEditable=String("nocursor"!=t)},Ya.prototype.onContextMenu=function(){},Ya.prototype.resetPosition=function(){},Ya.prototype.needsContentAttribute=!0;var Xa=function(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new Rs,this.hasSelection=!1,this.composing=null};Xa.prototype.init=function(t){function e(t){if(!Nt(r,t)){if(r.somethingSelected())qo({lineWise:!1,text:r.getSelections()});else{if(!r.options.lineWiseCopyCut)return;var e=Zo(r);qo({lineWise:!0,text:e.text}),"cut"==t.type?r.setSelections(e.ranges,null,Bs):(n.prevInput="",s.value=e.text.join("\n"),As(s))}"cut"==t.type&&(r.state.cutIncoming=!0)}}var i=this,n=this,r=this.cm,o=this.wrapper=Yo(),s=this.textarea=o.firstChild;t.wrapper.insertBefore(o,t.wrapper.firstChild),Cs&&(s.style.width="0px"),Xs(s,"input",function(){ps&&gs>=9&&i.hasSelection&&(i.hasSelection=null),n.poll()}),Xs(s,"paste",function(t){Nt(r,t)||Vo(t,r)||(r.state.pasteIncoming=!0,n.fastPoll())}),Xs(s,"cut",e),Xs(s,"copy",e),Xs(t.scroller,"paste",function(e){Fe(t,e)||Nt(r,e)||(r.state.pasteIncoming=!0,n.focus())}),Xs(t.lineSpace,"selectstart",function(e){Fe(t,e)||Rt(e)}),Xs(s,"compositionstart",function(){var t=r.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:t,range:r.markText(t,r.getCursor("to"),{className:"CodeMirror-composing"})}}),Xs(s,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Xa.prototype.prepareSelection=function(){var t=this.cm,e=t.display,i=t.doc,n=Ei(t);if(t.options.moveInputWithCursor){var r=ui(t,i.sel.primary().head,"div"),o=e.wrapper.getBoundingClientRect(),s=e.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(e.wrapper.clientHeight-10,r.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(e.wrapper.clientWidth-10,r.left+s.left-o.left))}return n},Xa.prototype.showSelection=function(t){var e=this.cm,n=e.display;i(n.cursorDiv,t.cursors),i(n.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")},Xa.prototype.reset=function(t){if(!this.contextMenuPending&&!this.composing){var e=this.cm;if(e.somethingSelected()){this.prevInput="";var i=e.getSelection();this.textarea.value=i,e.state.focused&&As(this.textarea),ps&&gs>=9&&(this.hasSelection=i)}else t||(this.prevInput=this.textarea.value="",ps&&gs>=9&&(this.hasSelection=null))}},Xa.prototype.getField=function(){return this.textarea},Xa.prototype.supportsTouch=function(){return!1},Xa.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Ts||s()!=this.textarea))try{this.textarea.focus()}catch(t){}},Xa.prototype.blur=function(){this.textarea.blur()},Xa.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Xa.prototype.receivedFocus=function(){this.slowPoll()},Xa.prototype.slowPoll=function(){var t=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){t.poll(),t.cm.state.focused&&t.slowPoll()})},Xa.prototype.fastPoll=function(){function t(){i.poll()||e?(i.pollingFast=!1,i.slowPoll()):(e=!0,i.polling.set(60,t))}var e=!1,i=this;i.pollingFast=!0,i.polling.set(20,t)},Xa.prototype.poll=function(){var t=this,e=this.cm,i=this.textarea,n=this.prevInput;if(this.contextMenuPending||!e.state.focused||ta(i)&&!n&&!this.composing||e.isReadOnly()||e.options.disableInput||e.state.keySeq)return!1;var r=i.value;if(r==n&&!e.somethingSelected())return!1;if(ps&&gs>=9&&this.hasSelection===r||ks&&/[\uf700-\uf7ff]/.test(r))return e.display.input.reset(),!1;if(e.doc.sel==e.display.selForContextMenu){var o=r.charCodeAt(0);if(8203!=o||n||(n="\u200b"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var s=0,a=Math.min(n.length,r.length);s<a&&n.charCodeAt(s)==r.charCodeAt(s);)++s;return dn(e,function(){Uo(e,r.slice(s),n.length-s,null,t.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?i.value=t.prevInput="":t.prevInput=r,t.composing&&(t.composing.range.clear(),t.composing.range=e.markText(t.composing.start,e.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Xa.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Xa.prototype.onKeyPress=function(){ps&&gs>=9&&(this.hasSelection=null),this.fastPoll()},Xa.prototype.onContextMenu=function(t){function e(){if(null!=s.selectionStart){var t=r.somethingSelected(),e="\u200b"+(t?s.value:"");s.value="\u21da",s.value=e,n.prevInput=t?"":"\u200b",s.selectionStart=1,s.selectionEnd=e.length,o.selForContextMenu=r.doc.sel}}function i(){if(n.contextMenuPending=!1,n.wrapper.style.cssText=c,s.style.cssText=h,ps&&gs<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=l),null!=s.selectionStart){(!ps||ps&&gs<9)&&e();var t=0,i=function(){o.selForContextMenu==r.doc.sel&&0==s.selectionStart&&s.selectionEnd>0&&"\u200b"==n.prevInput?fn(r,Er)(r):t++<10?o.detectingSelectAll=setTimeout(i,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(i,200)}}var n=this,r=n.cm,o=r.display,s=n.textarea,a=Si(r,t),l=o.scroller.scrollTop;if(a&&!bs){r.options.resetSelectionOnContextMenu&&-1==r.doc.sel.contains(a)&&fn(r,br)(r.doc,Fn(a),Bs);var h=s.style.cssText,c=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var u=n.wrapper.getBoundingClientRect();s.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(t.clientY-u.top-5)+"px; left: "+(t.clientX-u.left-5)+"px;\n      z-index: 1000; background: "+(ps?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var d;if(ms&&(d=window.scrollY),o.input.focus(),ms&&window.scrollTo(null,d),o.input.reset(),r.somethingSelected()||(s.value=n.prevInput=" "),n.contextMenuPending=!0,o.selForContextMenu=r.doc.sel,clearTimeout(o.detectingSelectAll),ps&&gs>=9&&e(),Ms){Ht(t);var f=function(){Dt(window,"mouseup",f),setTimeout(i,20)};Xs(window,"mouseup",f)}else setTimeout(i,50)}},Xa.prototype.readOnlyChanged=function(t){t||this.reset(),this.textarea.disabled="nocursor"==t},Xa.prototype.setUneditable=function(){},Xa.prototype.needsContentAttribute=!1,zo($o),Xo($o);var Ja="iter insert remove copy getEditor constructor".split(" ");for(var Qa in Na.prototype)Na.prototype.hasOwnProperty(Qa)&&d(Ja,Qa)<0&&($o.prototype[Qa]=function(t){return function(){return t.apply(this.doc,arguments)}}(Na.prototype[Qa]));return At(Na),$o.inputStyles={textarea:Xa,contenteditable:Ya},$o.defineMode=function(t){$o.defaults.mode||"null"==t||($o.defaults.mode=t),qt.apply(this,arguments)},$o.defineMIME=Ut,$o.defineMode("null",function(){return{token:function(t){return t.skipToEnd()}}}),$o.defineMIME("text/plain","null"),$o.defineExtension=function(t,e){$o.prototype[t]=e},$o.defineDocExtension=function(t,e){Na.prototype[t]=e},$o.fromTextArea=ss,as($o),$o.version="5.28.0",$o}),function(){if(!window.OpenSeadragon)return void console.error("[openseadragon-canvas-overlay] requires OpenSeadragon");OpenSeadragon.Viewer.prototype.paperjsOverlay=function(){return this._paperjsOverlayInfo?this._paperjsOverlayInfo:(this._paperjsOverlayInfo=new t(this),this._paperjsOverlayInfo)};var t=function(t){var e=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._canvasdiv=document.createElement("div"),this._canvasdiv.style.position="absolute",this._canvasdiv.style.left=0,this._canvasdiv.style.top=0,this._canvasdiv.style.width="100%",this._canvasdiv.style.height="100%",this._viewer.canvas.appendChild(this._canvasdiv),this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","osd-overlaycanvas"),this._canvasdiv.appendChild(this._canvas),this.resize(),paper.setup(this._canvas),this._viewer.addHandler("update-viewport",function(){e.resize(),e.resizecanvas()}),this._viewer.addHandler("open",function(){e.resize(),e.resizecanvas()}),this.resize()};t.prototype={paperCanvas:function(){return this._canvas},clear:function(){},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._canvasdiv.setAttribute("width",this._containerWidth),this._canvas.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._canvasdiv.setAttribute("height",this._containerHeight),this._canvas.setAttribute("height",this._containerHeight))},resizecanvas:function(){this._canvasdiv.setAttribute("width",this._containerWidth),this._canvas.setAttribute("width",this._containerWidth),this._canvasdiv.setAttribute("height",this._containerHeight),this._canvas.setAttribute("height",this._containerHeight),paper.view.viewSize=new paper.Size(this._containerWidth,this._containerHeight);var t=this._viewer.viewport.getZoom(!0),e=this._viewer.world.getItemAt(0);paper.view.zoom=e.viewportToImageZoom(t);var i=this._viewer.viewport.viewportToImageCoordinates(this._viewer.viewport.getCenter(!0));paper.view.center=new paper.Point(i.x,i.y)}}}();var paper=new function(t){var e=new function(){function i(t,i,n,r,s){function a(o,a){"string"==typeof(a=a||(a=h(i,o))&&(a.get?a:a.value))&&"#"===a[0]&&(a=t[a.substring(1)]||a);var c,d="function"==typeof a,f=a,p=s||d&&!a.base?a&&a.get?o in t:t[o]:null;s&&p||(d&&p&&(a.base=p),d&&!1!==r&&(c=o.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),f&&!d&&f.get&&"function"==typeof f.get&&e.isPlainObject(f)||(f={value:f,writable:!0}),(h(t,o)||{configurable:!0}).configurable&&(f.configurable=!0,f.enumerable=n),u(t,o,f))}var l={};if(i){for(var c in i)i.hasOwnProperty(c)&&!o.test(c)&&a(c);for(var c in l){var d=l[c],f=t["set"+d],p=t["get"+d]||f&&t["is"+d];!p||!0!==r&&0!==p.length||a(c,{get:p,set:f})}}return t}function n(t,e,i){return t&&("length"in t&&!t.getLength&&"number"==typeof t.length?s:a).call(t,e,i=i||t),i}function r(t,e,i){for(var n in e)!e.hasOwnProperty(n)||i&&i[n]||(t[n]=e[n]);return t}var o=/^(statics|enumerable|beans|preserve)$/,s=[].forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},a=function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)},l=Object.create||function(t){return{__proto__:t}},h=Object.getOwnPropertyDescriptor||function(t,e){var i=t.__lookupGetter__&&t.__lookupGetter__(e);return i?{get:i,set:t.__lookupSetter__(e),enumerable:!0,configurable:!0}:t.hasOwnProperty(e)?{value:t[e],enumerable:!0,configurable:!0,writable:!0}:null},c=Object.defineProperty||function(t,e,i){return(i.get||i.set)&&t.__defineGetter__?(i.get&&t.__defineGetter__(e,i.get),i.set&&t.__defineSetter__(e,i.set)):t[e]=i.value,t},u=function(t,e,i){return delete t[e],c(t,e,i)};return i(function(){for(var t=0,e=arguments.length;t<e;t++)r(this,arguments[t])},{
inject:function(t){if(t){var e=!0===t.statics?t:t.statics,n=t.beans,r=t.preserve;e!==t&&i(this.prototype,t,t.enumerable,n,r),i(this,e,!0,n,r)}for(var o=1,s=arguments.length;o<s;o++)this.inject(arguments[o]);return this},extend:function(){for(var t,e,n=this,r=0,o=arguments.length;r<o&&!(t=arguments[r].initialize);r++);return t=t||function(){n.apply(this,arguments)},e=t.prototype=l(this.prototype),u(e,"constructor",{value:t,writable:!0,configurable:!0}),i(t,this,!0),arguments.length&&this.inject.apply(t,arguments),t.base=n,t}},!0).inject({inject:function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];n&&i(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=l(this);return t.inject.apply(t,arguments)},each:function(t,e){return n(this,t,e)},set:function(t){return r(this,t)},clone:function(){return new this.constructor(this)},statics:{each:n,create:l,define:u,describe:h,set:r,clone:function(t){return r(new t.constructor,t)},isPlainObject:function(t){var i=null!=t&&t.constructor;return i&&(i===Object||i===e||"Object"===i.name)},pick:function(e,i){return e!==t?e:i}}})};"undefined"!=typeof module&&(module.exports=e),e.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+e.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?o.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},exportJSON:function(t){return e.exportJSON(this,t)},toJSON:function(){return e.serialize(this)},_set:function(i,n,r){if(i&&(r||e.isPlainObject(i))){for(var o=Object.keys(i._filtering||i),s=0,a=o.length;s<a;s++){var l=o[s];if(!n||!n[l]){var h=i[l];h!==t&&(this[l]=h)}}return!0}},statics:{exports:{enumerable:!0},extend:function t(){var i=t.base.apply(this,arguments),n=i.prototype._class;return n&&!e.exports[n]&&(e.exports[n]=i),i},equals:function(t,i){if(t===i)return!0;if(t&&t.equals)return t.equals(i);if(i&&i.equals)return i.equals(t);if(t&&i&&"object"==typeof t&&"object"==typeof i){if(Array.isArray(t)&&Array.isArray(i)){var n=t.length;if(n!==i.length)return!1;for(;n--;)if(!e.equals(t[n],i[n]))return!1}else{var r=Object.keys(t),n=r.length;if(n!==Object.keys(i).length)return!1;for(;n--;){var o=r[n];if(!i.hasOwnProperty(o)||!e.equals(t[o],i[o]))return!1}}return!0}return!1},read:function(i,n,r,o){if(this===e){var s=this.peek(i,n);return i.__index++,s}var a=this.prototype,l=a._readIndex,h=n||l&&i.__index||0;o||(o=i.length-h);var c=i[h];return c instanceof this||r&&r.readNull&&null==c&&o<=1?(l&&(i.__index=h+1),c&&r&&r.clone?c.clone():c):(c=e.create(this.prototype),l&&(c.__read=!0),c=c.initialize.apply(c,h>0||o<i.length?Array.prototype.slice.call(i,h,h+o):i)||c,l&&(i.__index=h+c.__read,c.__read=t),c)},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readAll:function(t,e,i){for(var n,r=[],o=e||0,s=t.length;o<s;o++)r.push(Array.isArray(n=t[o])?this.read(n,0,i):this.read(t,o,i,1));return r},readNamed:function(i,n,r,o,s){var a=this.getNamed(i,n),l=a!==t;if(l){var h=i._filtered;h||(h=i._filtered=e.create(i[0]),h._filtering=i[0]),h[n]=t}return this.read(l?[a]:i,r,o,s)},getNamed:function(i,n){var r=i[0];if(i._hasObject===t&&(i._hasObject=1===i.length&&e.isPlainObject(r)),i._hasObject)return n?r[n]:i._filtered||r},hasNamed:function(t,e){return!!this.getNamed(t,e)},isPlainValue:function(t,e){return this.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,i,n,r){i=i||{};var s,a=!r;if(a&&(i.formatter=new o(i.precision),r={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),o=t._class;o&&r[0]!==o&&r.unshift(o),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){s=t._serialize(i,r);var l=t._class;!l||n||s._compact||s[0]===l||s.unshift(l)}else if(Array.isArray(t)){s=[];for(var h=0,c=t.length;h<c;h++)s[h]=e.serialize(t[h],i,n,r);n&&(s._compact=!0)}else if(e.isPlainObject(t)){s={};for(var u=Object.keys(t),h=0,c=u.length;h<c;h++){var d=u[h];s[d]=e.serialize(t[d],i,n,r)}}else s="number"==typeof t?i.formatter.number(t,i.precision):t;return a&&r.length>0?[["dictionary",r.definitions],s]:s},deserialize:function(t,i,n,r){var o=t,s=!n;if(n=n||{},Array.isArray(t)){var a=t[0],l="dictionary"===a;if(1==t.length&&/^#/.test(a))return n.dictionary[a];a=e.exports[a],o=[],r&&(n.dictionary=o);for(var h=a?1:0,c=t.length;h<c;h++)o.push(e.deserialize(t[h],i,n,l));if(a){var u=o;i?o=i(a,u):(o=e.create(a.prototype),a.apply(o,u))}}else if(e.isPlainObject(t)){o={},r&&(n.dictionary=o);for(var d in t)o[d]=e.deserialize(t[d],i,n)}return s&&t&&t.length&&"dictionary"===t[0][0]?o[1]:o},exportJSON:function(t,i){var n=e.serialize(t,i);return i&&!1===i.asString?n:JSON.stringify(n)},importJSON:function(t,i){return e.deserialize("string"==typeof t?JSON.parse(t):t,function(t,n){var r=i&&i.constructor===t?i:e.create(t.prototype),o=r===i;if(1===n.length&&r instanceof y&&(o||!(r instanceof _))){var s=n[0];e.isPlainObject(s)&&(s.insert=!1)}return t.apply(r,n),o&&(i=null),r})},splice:function(e,i,n,r){var o=i&&i.length,s=n===t;(n=s?e.length:n)>e.length&&(n=e.length);for(var a=0;a<o;a++)i[a]._index=n+a;if(s)return e.push.apply(e,i),[];var l=[n,r];i&&l.push.apply(l,i);for(var h=e.splice.apply(e,l),a=0,c=h.length;a<c;a++)h[a]._index=t;for(var a=n+o,c=e.length;a<c;a++)e[a]._index=a;return h},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var i={on:function(t,i){if("string"!=typeof t)e.each(t,function(t,e){this.on(e,t)},this);else{var n=this._eventTypes,r=n&&n[t],o=this._callbacks=this._callbacks||{};o=o[t]=o[t]||[],-1===o.indexOf(i)&&(o.push(i),r&&r.install&&1===o.length&&r.install.call(this,t))}return this},off:function(t,i){if("string"!=typeof t)return void e.each(t,function(t,e){this.off(e,t)},this);var n,r=this._eventTypes,o=r&&r[t],s=this._callbacks&&this._callbacks[t];return s&&(!i||-1!==(n=s.indexOf(i))&&1===s.length?(o&&o.uninstall&&o.uninstall.call(this,t),delete this._callbacks[t]):-1!==n&&s.splice(n,1)),this},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=[].slice.call(arguments,1);i=i.slice();for(var r=0,o=i.length;r<o;r++)if(!1===i[r].apply(this,n)){e&&e.stop&&e.stop();break}return!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._callbacks,i=t?"install":"uninstall";for(var n in e)if(e[n].length>0){var r=this._eventTypes,o=r&&r[n],s=o&&o[i];s&&s.call(this,n)}},statics:{inject:function t(i){var n=i._events;if(n){var r={};e.each(n,function(t,n){var o="string"==typeof t,s=o?t:n,a=e.capitalize(s),l=s.substring(2).toLowerCase();r[l]=o?{}:t,s="_"+s,i["get"+a]=function(){return this[s]},i["set"+a]=function(t){var e=this[s];e&&this.off(l,e),t&&this.on(l,t),this[s]=t}}),i._eventTypes=r}return t.base.apply(this,arguments)}}},n=e.extend({_class:"PaperScope",initialize:function t(){paper=this,this.settings=new e({applyMatrix:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=t._id++,t._scopes[this._id]=this;var i=t.prototype;if(!this.support){var n=Y.getContext(1,1);i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:X.nativeModes},Y.release(n)}if(!this.browser){var r=navigator.userAgent.toLowerCase(),o=(/(win)/.exec(r)||/(mac)/.exec(r)||/(linux)/.exec(r)||[])[0],s=i.browser={platform:o};o&&(s[o]=!0),r.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:([.\d]+))?/g,function(t,e,i,n,r){if(!s.chrome){var o="opera"===e?n:i;"trident"===e&&(o=r,e="msie"),s.version=o,s.versionNumber=parseFloat(o),s.name=e,s[e]=!0}}),s.chrome&&delete s.webkit,s.atom&&delete s.chrome}},version:"0.9.25",getView:function(){return this.project&&this.project.getView()},getPaper:function(){return this},execute:function(t,e,i){paper.PaperScript.execute(t,this,e,i),j.updateFocus()},install:function(t){var i=this;e.each(["project","view","tool"],function(n){e.define(t,n,{configurable:!0,get:function(){return i[n]}})});for(var n in this)!/^_/.test(n)&&this[n]&&(t[n]=this[n])},setup:function(t){return paper=this,this.project=new m(t),this},activate:function(){paper=this},clear:function(){for(var t=this.projects.length-1;t>=0;t--)this.projects[t].remove();for(var t=this.tools.length-1;t>=0;t--)this.tools[t].remove();for(var t=this.palettes.length-1;t>=0;t--)this.palettes[t].remove()},remove:function(){this.clear(),delete n._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),r=e.extend(i,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(e.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),o=e.extend({initialize:function(t){this.precision=t||5,this.multiplier=Math.pow(10,this.precision)},number:function(t){return Math.round(t*this.multiplier)/this.multiplier},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});o.instance=new o;var s=new function(){function t(t,e,i){return t<e?e:t>i?i:t}var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],i=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],n=Math.abs,r=Math.sqrt,o=Math.pow,a=1e-12,l=1.12e-16;return{TOLERANCE:1e-6,EPSILON:a,MACHINE_EPSILON:l,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:2e-7,WINDING_EPSILON:2e-7,TRIGONOMETRIC_EPSILON:1e-7,CLIPPING_EPSILON:1e-7,KAPPA:4*(r(2)-1)/3,isZero:function(t){return t>=-a&&t<=a},integrate:function(t,n,r,o){for(var s=e[o-2],a=i[o-2],l=.5*(r-n),h=l+n,c=0,u=o+1>>1,d=1&o?a[c++]*t(h):0;c<u;){var f=l*s[c];d+=a[c++]*(t(h+f)+t(h-f))}return l*d},findRoot:function(t,e,i,r,o,s,a){for(var l=0;l<s;l++){var h=t(i),c=h/e(i),u=i-c;if(n(c)<a)return u;h>0?(o=i,i=u<=r?.5*(r+o):u):(r=i,i=u>=o?.5*(r+o):u)}return i},solveQuadratic:function(e,i,s,h,c,u){var d,f,p=0,g=c-a,m=u+a,v=Infinity,y=i;if(i/=-2,0!==(f=i*i-e*s)&&n(f)<l){var b=o(n(e*i*s),1/3);if(b<1e-8){var _=o(10,n(Math.floor(Math.log(b)*Math.LOG10E)));isFinite(_)||(_=0),e*=_,i*=_,s*=_,f=i*i-e*s}}if(n(e)<a){if(n(y)<a)return n(s)<a?-1:0;d=-s/y}else if(f>=-l){var w=f<0?0:r(f),x=i+(i<0?-w:w);0===x?(d=s/e,v=-d):(d=x/e,v=s/x)}return isFinite(d)&&(null==c||d>g&&d<m)&&(h[p++]=null==c?d:t(d,c,u)),v!==d&&isFinite(v)&&(null==c||v>g&&v<m)&&(h[p++]=null==c?v:t(v,c,u)),p},solveCubic:function(e,i,h,c,u,d,f){var p,g,m,v=0;if(n(e)<a)e=i,g=h,m=c,p=Infinity;else if(n(c)<a)g=i,m=h,p=0;else{var y,b,_,w,x,C,S,T=1+l;if(p=-i/e/3,S=e*p,g=S+i,m=g*p+h,_=(S+g)*p+m,b=m*p+c,w=b/e,x=o(n(w),1/3),C=w<0?-1:1,w=-_/e,x=w>0?1.3247179572*Math.max(x,r(w)):x,(y=p-C*x)!==p){do{if(p=y,S=e*p,g=S+i,m=g*p+h,_=(S+g)*p+m,b=m*p+c,(y=0===_?p:p-b/_/T)===p){p=y;break}}while(C*y>C*p);n(e)*p*p>n(c/p)&&(m=-c/p,g=(m-h)/p)}}var v=s.solveQuadratic(e,g,m,u,d,f);return isFinite(p)&&(0===v||p!==u[v-1])&&(null==d||p>d-a&&p<f+a)&&(u[v++]=null==d?p:t(p,d,f)),v}}},a={_id:1,_pools:{},get:function(t){if(t){var e=t._class,i=this._pools[e];return i||(i=this._pools[e]={_id:1}),i._id++}return this._id++}},l=e.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;this.x=t,this.y=n?e:t,this.__read&&(this.__read=n?2:1)}else"undefined"===i||null===t?(this.x=this.y=0,this.__read&&(this.__read=null===t?1:0)):(Array.isArray(t)?(this.x=t[0],this.y=t.length>1?t[1]:t[0]):null!=t.x?(this.x=t.x,this.y=t.y):null!=t.width?(this.x=t.width,this.y=t.height):null!=t.angle?(this.x=t.length,this.y=0,this.setAngle(t.angle)):(this.x=this.y=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new l(this.x,this.y)},toString:function(){var t=o.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this.set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();s.isZero(i)&&this.getAngle(),this.set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=l.read(arguments),e=this.getLength()*t.getLength();if(s.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this.set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=l.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=l.read(arguments),i=t.x-this.x,n=t.y-this.y,r=i*i+n*n;return e.read(arguments)?r:Math.sqrt(r)},normalize:function(e){e===t&&(e=1);var i=this.getLength(),n=0!==i?e/i:0,r=new l(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new l(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=l.read(arguments);return new l(this.x+t.x,this.y+t.y)},subtract:function(){var t=l.read(arguments);return new l(this.x-t.x,this.y-t.y)},multiply:function(){var t=l.read(arguments);return new l(this.x*t.x,this.y*t.y)},divide:function(){var t=l.read(arguments);return new l(this.x/t.x,this.y/t.y)},modulo:function(){var t=l.read(arguments);return new l(this.x%t.x,this.y%t.y)},negate:function(){return new l(-this.x,-this.y)},isInside:function(){return d.read(arguments).contains(this)},isClose:function(){var t=l.read(arguments),i=e.read(arguments);return this.getDistance(t)<i},isCollinear:function(){var t=l.read(arguments);return l.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=l.read(arguments);return l.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){return s.isZero(this.x)&&s.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var t=l.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=l.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=l.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new l(t.x*e,t.y*e)},statics:{min:function(){var t=l.read(arguments),e=l.read(arguments);return new l(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=l.read(arguments),e=l.read(arguments);return new l(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new l(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},e.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new l(e(this.x),e(this.y))}},{})),h=l.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)}}),c=e.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;this.width=t,this.height=n?e:t,this.__read&&(this.__read=n?2:1)}else"undefined"===i||null===t?(this.width=this.height=0,this.__read&&(this.__read=null===t?1:0)):(Array.isArray(t)?(this.width=t[0],this.height=t.length>1?t[1]:t[0]):null!=t.width?(this.width=t.width,this.height=t.height):null!=t.x?(this.width=t.x,this.height=t.y):(this.width=this.height=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new c(this.width,this.height)},toString:function(){var t=o.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=c.read(arguments);return new c(this.width+t.width,this.height+t.height)},subtract:function(){var t=c.read(arguments);return new c(this.width-t.width,this.height-t.height)},multiply:function(){var t=c.read(arguments);return new c(this.width*t.width,this.height*t.height)},divide:function(){var t=c.read(arguments);return new c(this.width/t.width,this.height/t.height)},modulo:function(){var t=c.read(arguments);return new c(this.width%t.width,this.height%t.height)},negate:function(){return new c(-this.width,-this.height)},isZero:function(){return s.isZero(this.width)&&s.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new c(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new c(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new c(Math.random(),Math.random())}}},e.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new c(e(this.width),e(this.height))}},{})),u=c.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),d=e.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(i,n,r,o){var s=typeof i,a=0;if("number"===s?(this.x=i,this.y=n,this.width=r,this.height=o,a=4):"undefined"===s||null===i?(this.x=this.y=this.width=this.height=0,a=null===i?1:0):1===arguments.length&&(Array.isArray(i)?(this.x=i[0],this.y=i[1],this.width=i[2],this.height=i[3],a=1):i.x!==t||i.width!==t?(this.x=i.x||0,this.y=i.y||0,this.width=i.width||0,this.height=i.height||0,a=1):i.from===t&&i.to===t&&(this.x=this.y=this.width=this.height=0,this._set(i),a=1)),!a){var h=l.readNamed(arguments,"from"),u=e.peek(arguments);if(this.x=h.x,this.y=h.y,u&&u.x!==t||e.hasNamed(arguments,"to")){var d=l.readNamed(arguments,"to");this.width=d.x-h.x,this.height=d.y-h.y,this.width<0&&(this.x=d.x,this.width=-this.width),this.height<0&&(this.y=d.y,this.height=-this.height)}else{var f=c.read(arguments);this.width=f.width,this.height=f.height}a=arguments.__index}this.__read&&(this.__read=a)},set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new d(this.x,this.y,this.width,this.height)},equals:function(t){var i=e.isPlainValue(t)?d.read(arguments):t;return i===this||i&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height||!1},toString:function(){var t=o.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?l:h)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=l.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?c:u)(this.width,this.height,this,"setSize")},setSize:function(){var t=c.read(arguments);this._fixX&&(this.x+=(this.width-t.width)*this._fixX),this._fixY&&(this.y+=(this.height-t.height)*this._fixY),this.width=t.width,this.height=t.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(t){this._fixW||(this.width-=t-this.x),this.x=t,this._fixX=0},getTop:function(){return this.y},setTop:function(t){this._fixH||(this.height-=t-this.y),this.y=t,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(e){this._fixX!==t&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=e-this.width:this.width=e-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(e){this._fixY!==t&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=e-this.height:this.height=e-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(t){this.x=t-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(t){this.y=t-.5*this.height,this._fixY=.5},getCenter:function(t){return new(t?l:h)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=l.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(e){return e&&e.width!==t||4==(Array.isArray(e)?e:arguments).length?this._containsRectangle(d.read(arguments)):this._containsPoint(l.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=d.read(arguments);return t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height},touches:function(){var t=d.read(arguments);return t.x+t.width>=this.x&&t.y+t.height>=this.y&&t.x<=this.x+this.width&&t.y<=this.y+this.height},intersect:function(){var t=d.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new d(e,i,n-e,r-i)},unite:function(){var t=d.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new d(e,i,n-e,r-i)},include:function(){var t=l.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new d(e,i,n-e,r-i)},expand:function(){var t=c.read(arguments),e=t.width,i=t.height;return new d(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(e,i){return this.expand(this.width*e-this.width,this.height*(i===t?e:i)-this.height)}},e.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],o=t[n?1:0],s="get"+r,a="get"+o,c="set"+r,u="set"+o,d="get"+i,f="set"+i;this[d]=function(t){return new(t?l:h)(this[s](),this[a](),this,f)},this[f]=function(){var t=l.read(arguments);this[c](t.x),this[u](t.y)}},{beans:!0})),f=d.extend({initialize:function(t,e,i,n,r,o){this.set(t,e,i,n,!0),this._owner=r,this._setter=o},set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=d.prototype;return e.each(["x","y","width","height"],function(t){var i=e.capitalize(t),n="_"+t;this["get"+i]=function(){return this[n]},this["set"+i]=function(t){this[n]=t,this._dontNotify||this._owner[this._setter](this)}},e.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(t){var e=this._owner;e.setSelected&&(e._boundsSelected=t,e.setSelected(t||e._selectedSegmentState>0))}}))}),p=e.extend({_class:"Matrix",initialize:function t(e){var i=arguments.length,n=!0;if(6===i?this.set.apply(this,arguments):1===i?e instanceof t?this.set(e._a,e._c,e._b,e._d,e._tx,e._ty):Array.isArray(e)?this.set.apply(this,e):n=!1:0===i?this.reset():n=!1,!n)throw new Error("Unsupported matrix parameters")},set:function(t,e,i,n,r,o,s){return this._a=t,this._c=e,this._b=i,this._d=n,this._tx=r,this._ty=o,s||this._changed(),this},_serialize:function(t){return e.serialize(this.getValues(),t)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new p(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty||!1},toString:function(){var t=o.instance;return"[["+[t.number(this._a),t.number(this._b),t.number(this._tx)].join(", ")+"], ["+[t.number(this._c),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,i){var n=this._owner;return!!n&&(n.transform(null,!0,e.pick(t,!0),i),this.isIdentity())},translate:function(){var t=l.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._b,this._ty+=e*this._c+i*this._d,this._changed(),this},scale:function(){var t=l.read(arguments),e=l.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._c*=t.x,this._b*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=l.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),o=Math.sin(t),s=i-i*r+n*o,a=n-i*o-n*r,h=this._a,c=this._b,u=this._c,d=this._d;return this._a=r*h+o*c,this._b=-o*h+r*c,this._c=r*u+o*d,this._d=-o*u+r*d,this._tx+=s*h+a*c,this._ty+=s*u+a*d,this._changed(),this},shear:function(){var t=l.read(arguments),e=l.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._c;return this._a+=t.y*this._b,this._c+=t.y*this._d,this._b+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=l.read(arguments),e=l.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new l(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},concatenate:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,o=t._a,s=t._b,a=t._c,l=t._d,h=t._tx,c=t._ty;return this._a=o*e+a*i,this._b=s*e+l*i,this._c=o*n+a*r,this._d=s*n+l*r,this._tx+=h*e+c*i,this._ty+=h*n+c*r,this._changed(),this},preConcatenate:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,o=this._tx,s=this._ty,a=t._a,l=t._b,h=t._c,c=t._d,u=t._tx,d=t._ty;return this._a=a*e+l*n,this._b=a*i+l*r,this._c=h*e+c*n,this._d=h*i+c*r,this._tx=a*o+l*s+u,this._ty=h*o+c*s+d,this._changed(),this},chain:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,o=this._tx,s=this._ty,a=t._a,l=t._b,h=t._c,c=t._d,u=t._tx,d=t._ty;return new p(a*e+h*i,a*n+h*r,l*e+c*i,l*n+c*r,o+u*e+d*i,s+u*n+d*r)},isIdentity:function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(l.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new l),e.set(n*this._a+r*this._b+this._tx,n*this._c+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=0,o=2*i;n<o;){var s=t[n++],a=t[n++];e[r++]=s*this._a+a*this._b+this._tx,e[r++]=s*this._c+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,o=[e,i,n,i,n,r,e,r];return this._transformCoordinates(o,o,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),o=r.slice(),s=2;s<8;s++){var a=n[s],l=1&s;a<r[l]?r[l]=a:a>o[l]&&(o[l]=a)}return e||(e=new d),e.set(r[0],r[1],o[0]-r[0],o[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(l.read(arguments))},_getDeterminant:function(){var t=this._a*this._d-this._b*this._c;return isFinite(t)&&!s.isZero(t)&&isFinite(this._tx)&&isFinite(this._ty)?t:null},_inverseTransform:function(t,e,i){var n=this._getDeterminant();if(!n)return null;var r=t.x-this._tx,o=t.y-this._ty;return e||(e=new l),e.set((r*this._d-o*this._b)/n,(o*this._a-r*this._c)/n,i)},decompose:function(){var t=this._a,e=this._b,i=this._c,n=this._d;if(s.isZero(t*n-e*i))return null;var r=Math.sqrt(t*t+e*e);t/=r,e/=r;var o=t*i+e*n;i-=t*o,n-=e*o;var a=Math.sqrt(i*i+n*n);return i/=a,n/=a,o/=a,t*n<e*i&&(t=-t,e=-e,o=-o,r=-r),{scaling:new l(r,a),rotation:180*-Math.atan2(e,t)/Math.PI,shearing:o}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new l(this._tx,this._ty)},
getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var t=this._getDeterminant();return t&&new p(this._d/t,-this._c/t,-this._b/t,this._a/t,(this._b*this._ty-this._d*this._tx)/t,(this._c*this._tx-this._a*this._ty)/t)},shiftless:function(){return new p(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(t){t.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},e.each(["a","c","b","d","tx","ty"],function(t){var i=e.capitalize(t),n="_"+t;this["get"+i]=function(){return this[n]},this["set"+i]=function(t){this[n]=t,this._changed()}},{})),g=e.extend({_class:"Line",initialize:function(t,e,i,n,r){var o=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,o=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,o=i),o||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new l(this._px,this._py)},getVector:function(){return new l(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return g.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return g.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(g.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0))},isCollinear:function(t){return l.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return l.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,o,a,h,c,u){c||(i-=t,n-=e,a-=r,h-=o);var d=i*h-n*a;if(!s.isZero(d)){var f=t-r,p=e-o,g=(a*p-h*f)/d,m=(i*p-n*f)/d,v=1e-12,y=-v,b=1+v;if(u||y<g&&g<b&&y<m&&m<b)return u||(g=g<=0?0:g>=1?1:g),new l(t+g*i,e+g*n)}},getSide:function(t,e,i,n,r,o,s,a){s||(i-=t,n-=e);var l=r-t,h=o-e,c=l*n-h*i;return 0!==c||a||(c=(l*i+l*i)/(i*i+n*n))>=0&&c<=1&&(c=0),c<0?-1:c>0?1:0},getSignedDistance:function(t,e,i,n,r,o,s){return s||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?o-e:e-o:((r-t)*n-(o-e)*i)/Math.sqrt(i*i+n*n)}}}),m=r.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function(t){r.call(this,!0),this.layers=[],this._activeLayer=null,this.symbols=[],this._currentStyle=new F(null,null,this),this._view=j.create(this,t||Y.getCanvas(1,1)),this._selectedItems={},this._selectedItemCount=0,this._updateVersion=0},_serialize:function(t,i){return e.serialize(this.layers,t,!0,i)},clear:function(){for(var t=this.layers.length-1;t>=0;t--)this.layers[t].remove();this.symbols=[]},isEmpty:function(){return 0===this.layers.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.initialize(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getActiveLayer:function(){return this._activeLayer||new _({project:this})},getSelectedItems:function(){var t=[];for(var e in this._selectedItems){var i=this._selectedItems[e];i.isInserted()&&t.push(i)}return t},insertChild:function(t,i,n){return i instanceof _?(i._remove(!1,!0),e.splice(this.layers,[i],t,0),i._setProject(this,!0),this._changes&&i._changed(5),this._activeLayer||(this._activeLayer=i)):i instanceof y?(this._activeLayer||this.insertChild(t,new _(y.NO_INSERT))).insertChild(t,i,n):i=null,i},addChild:function(e,i){return this.insertChild(t,e,i)},_updateSelection:function(t){var e=t._id,i=this._selectedItems;t._selected?i[e]!==t&&(this._selectedItemCount++,i[e]=t):i[e]===t&&(this._selectedItemCount--,delete i[e])},selectAll:function(){for(var t=this.layers,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectedItems;for(var e in t)t[e].setFullySelected(!1)},hitTest:function(){for(var t=l.read(arguments),i=S.getOptions(e.read(arguments)),n=this.layers.length-1;n>=0;n--){var r=this.layers[n]._hitTest(t,i);if(r)return r}return null},getItems:function(t){return y._getItems(this.layers,t)},getItem:function(t){return y._getItems(this.layers,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var i=this._activeLayer;return e.importJSON(t,i&&i.isEmpty()&&i)},draw:function(t,i,n){this._updateVersion++,t.save(),i.applyToContext(t);for(var r=new e({offset:new l(0,0),pixelRatio:n,viewMatrix:i.isIdentity()?null:i,matrices:[new p],updateMatrix:!0}),o=0,s=this.layers,a=s.length;o<a;o++)s[o].draw(t,r);if(t.restore(),this._selectedItemCount>0){t.save(),t.strokeWidth=1;var h=this._selectedItems,c=this._scope.settings.handleSize,u=this._updateVersion;for(var d in h)h[d]._drawSelection(t,i,c,h,u);t.restore()}}}),v=e.extend({_class:"Symbol",initialize:function(t,e){this._id=a.get(),this.project=paper.project,this.project.symbols.push(this),t&&this.setDefinition(t,e)},_serialize:function(t,i){return i.add(this,function(){return e.serialize([this._class,this._definition],t,!1,i)})},_changed:function(t){8&t&&y._clearBoundsCache(this),1&t&&(this.project._needsUpdate=!0)},getDefinition:function(){return this._definition},setDefinition:function(t,e){t._parentSymbol&&(t=t.clone()),this._definition&&(this._definition._parentSymbol=null),this._definition=t,t.remove(),t.setSelected(!1),e||t.setPosition(new l),t._parentSymbol=this,this._changed(9)},place:function(t){return new C(this,t)},clone:function(){return new v(this._definition.clone(!1))},equals:function(t){return t===this||t&&this.definition.equals(t.definition)||!1}}),y=e.extend(i,{statics:{extend:function t(i){return i._serializeFields&&(i._serializeFields=new e(this.prototype._serializeFields,i._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_applyMatrix:!0,_canApplyMatrix:!0,_boundsSelected:!1,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new p,pivot:null,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,selected:!1,clipMask:!1,data:{}},initialize:function(){},_initialize:function(t,i){var n=t&&e.isPlainObject(t),r=n&&!0===t.internal,o=this._matrix=new p,s=n&&t.project||paper.project;return r||(this._id=a.get()),this._applyMatrix=this._canApplyMatrix&&paper.settings.applyMatrix,i&&o.translate(i),o._owner=this,this._style=new F(s._currentStyle,this,s),this._project||(r||n&&!1===t.insert?this._setProject(s):n&&t.parent?this.setParent(t.parent):(s._activeLayer||new _).addChild(this)),n&&t!==y.NO_INSERT&&this._set(t,{insert:!0,project:!0,parent:!0},!0),n},_events:e.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(t){this[t]={install:function(t){this.getView()._installEvent(t)},uninstall:function(t){this.getView()._uninstallEvent(t)}}},{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{}}),_serialize:function(t,i){function n(n){for(var s in n){var a=o[s];e.equals(a,"leading"===s?1.2*n.fontSize:n[s])||(r[s]=e.serialize(a,t,"data"!==s,i))}}var r={},o=this;return n(this._serializeFields),this instanceof b||n(this._style._defaults),[this._class,r]},_changed:function(e){var i=this._parentSymbol,n=this._parent||i,r=this._project;if(8&e&&(this._bounds=this._position=this._decomposed=this._globalMatrix=this._currentPath=t),n&&40&e&&y._clearBoundsCache(n),2&e&&y._clearBoundsCache(this),r&&(1&e&&(r._needsUpdate=!0),r._changes)){var o=r._changesById[this._id];o?o.flags|=e:(o={item:this,flags:e},r._changesById[this._id]=o,r._changes.push(o))}i&&i._changed(e)},set:function(t){return t&&this._set(t),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(e,i){if(this._name&&this._removeNamed(),e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var n=this._parent;if(e&&n){for(var r=n._children,o=n._namedChildren,s=e,a=1;i&&r[e];)e=s+" "+a++;(o[e]=o[e]||[]).push(this),r[e]=this}this._name=e||t,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},e.each(["locked","visible","blendMode","opacity","guide"],function(t){var i=e.capitalize(t),t="_"+t;this["get"+i]=function(){return this[t]},this["set"+i]=function(e){e!=this[t]&&(this[t]=e,this._changed("_locked"===t?128:129))}},{}),{beans:!0,_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return this._selected},setSelected:function(t,e){if(!e&&this._selectChildren)for(var i=this._children,n=0,r=i.length;n<r;n++)i[n].setSelected(t);(t=!!t)^this._selected&&(this._selected=t,this._project._updateSelection(this),this._changed(129))},_selected:!1,isFullySelected:function(){var t=this._children;if(t&&this._selected){for(var e=0,i=t.length;e<i;e++)if(!t[e].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this.setSelected(t,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},_clipMask:!1,getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?l:h;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(l.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(t){var e=this._pivot;if(e){e=new(t?l:h)(e.x,e.y,this,"setPivot")}return e},setPivot:function(){this._pivot=l.read(arguments,0,{clone:!0,readNull:!0}),this._position=t},_pivot:null},e.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],function(t){var i="get"+e.capitalize(t),n=t.match(/^internal(.*)$/),r=n?"get"+n[1]:null;this[i]=function(e){var n=this._boundsGetter,o=!r&&("string"==typeof n?n:n&&n[i])||i,s=this._getCachedBounds(o,e,this,r);return"bounds"===t?new f(s.x,s.y,s.width,s.height,this,"setBounds"):s}},{beans:!0,_getBounds:function(t,e,i){var n=this._children;if(!n||0==n.length)return new d;y._updateBoundsCache(this,i);for(var r=Infinity,o=-r,s=r,a=o,l=0,h=n.length;l<h;l++){var c=n[l];if(c._visible&&!c.isEmpty()){var u=c._getCachedBounds(t,e&&e.chain(c._matrix),i);r=Math.min(u.x,r),s=Math.min(u.y,s),o=Math.max(u.x+u.width,o),a=Math.max(u.y+u.height,a)}}return isFinite(r)?new d(r,s,o-r,a-s):new d},setBounds:function(){var t=d.read(arguments),e=this.getBounds(),i=new p,n=t.getCenter();i.translate(n),t.width==e.width&&t.height==e.height||i.scale(0!=e.width?t.width/e.width:1,0!=e.height?t.height/e.height:1),n=e.getCenter(),i.translate(-n.x,-n.y),this.transform(i)},_getCachedBounds:function(t,e,i,n){e=e&&e.orNullIfIdentity();var r=n?null:this._matrix.orNullIfIdentity(),o=(!e||e.equals(r))&&t;if(y._updateBoundsCache(this._parent||this._parentSymbol,i),o&&this._bounds&&this._bounds[o])return this._bounds[o].clone();var s=this._getBounds(n||t,e||r,i);if(o){this._bounds||(this._bounds={});(this._bounds[o]=s.clone())._internal=!!n}return s},statics:{_updateBoundsCache:function(t,e){if(t){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(e){var i=e._boundsCache;if(i){e._bounds=e._position=e._boundsCache=t;for(var n=0,r=i.list,o=r.length;n<o;n++){var s=r[n];s!==e&&(s._bounds=s._position=t,s._boundsCache&&y._clearBoundsCache(s))}}}}}),{beans:!0,_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var t=this._decomposed||this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i.rotation=t,this._decomposed=i}},getScaling:function(t){var e=this._decomposed||this._decompose(),i=e&&e.scaling,n=t?l:h;return i&&new n(i.x,i.y,this,"setScaling")},setScaling:function(){var t=this.getScaling();if(t){var e=l.read(arguments,0,{clone:!0}),i=this._decomposed;this.scale(e.x/t.x,e.y/t.y),i.scaling=e,this._decomposed=i}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments),this._applyMatrix?this.transform(null,!0):this._changed(9)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;n&&e.preConcatenate(n.getGlobalMatrix(!0)),e._updateVersion=i}return t?e:e.clone()},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project.getView()},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof _)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return e.equals(this._children,t._children)},clone:function(t){return this._clone(new this.constructor(y.NO_INSERT),t)},_clone:function(i,n,r){var o=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],s=this._children;i.setStyle(this._style);for(var a=0,l=s&&s.length;a<l;a++)i.addChild(s[a].clone(!1),!0);for(var a=0,l=o.length;a<l;a++){var h=o[a];this.hasOwnProperty(h)&&(i[h]=this[h])}return!1!==r&&i._matrix.initialize(this._matrix),i.setApplyMatrix(this._applyMatrix),i.setPivot(this._pivot),i.setSelected(this._selected),i._data=this._data?e.clone(this._data):null,(n||n===t)&&i.insertAbove(this),this._name&&i.setName(this._name,!0),i},copyTo:function(t){return t.addChild(this.clone(!1))},rasterize:function(t){var i=this.getStrokeBounds(),n=(t||this.getView().getResolution())/72,r=i.getTopLeft().floor(),o=i.getBottomRight().ceil(),s=new c(o.subtract(r)),a=Y.getCanvas(s.multiply(n)),l=a.getContext("2d"),h=(new p).scale(n).translate(r.negate());l.save(),h.applyToContext(l),this.draw(l,new e({matrices:[h]})),l.restore();var u=new x(y.NO_INSERT);return u.setCanvas(a),u.transform((new p).translate(r.add(s.divide(2))).scale(1/n)),u.insertAbove(this),u},contains:function(){return!!this._contains(this._matrix._inverseTransform(l.read(arguments)))},_contains:function(t){if(this._children){for(var e=this._children.length-1;e>=0;e--)if(this._children[e].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return d.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new I.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof y&&this._asPathItem().getIntersections(t._asPathItem(),null,e||t._matrix,!0).length>0},hitTest:function(){return this._hitTest(l.read(arguments),S.getOptions(e.read(arguments)))},_hitTest:function(t,i){function n(i,n){var r=f["get"+n]();if(t.subtract(r).divide(l).length<=1)return new S(i,d,{name:e.hyphenate(n),point:r})}if(this._locked||!this._visible||this._guide&&!i.guides||this.isEmpty())return null;var r=this._matrix,o=i._totalMatrix,s=this.getView(),a=i._totalMatrix=o?o.chain(r):this.getGlobalMatrix().preConcatenate(s._matrix),l=i._tolerancePadding=new c(I._getPenPadding(1,a.inverted())).multiply(Math.max(i.tolerance,1e-6));if(t=r._inverseTransform(t),!this._children&&!this.getInternalRoughBounds().expand(l.multiply(2))._containsPoint(t))return null;var h,u=!(i.guides&&!this._guide||i.selected&&!this._selected||i.type&&i.type!==e.hyphenate(this._class)||i["class"]&&!(this instanceof i["class"])),d=this;if(u&&(i.center||i.bounds)&&this._parent){var f=this.getInternalBounds();if(i.center&&(h=n("center","Center")),!h&&i.bounds)for(var p=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],g=0;g<8&&!h;g++)h=n("bounds",p[g])}var m=!h&&this._children;if(m)for(var v=this._getChildHitTestOptions(i),g=m.length-1;g>=0&&!h;g--)h=m[g]._hitTest(t,v);return!h&&u&&(h=this._hitTestSelf(t,i)),h&&h.point&&(h.point=r.transform(h.point)),i._totalMatrix=o,h},_getChildHitTestOptions:function(t){return t},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new S("fill",this)},matches:function(t,i){function n(t,i){for(var r in t)if(t.hasOwnProperty(r)){var o=t[r],s=i[r];if(e.isPlainObject(o)&&e.isPlainObject(s)){if(!n(o,s))return!1}else if(!e.equals(o,s))return!1}return!0}var r=typeof t;if("object"===r){for(var o in t)if(t.hasOwnProperty(o)&&!this.matches(o,t[o]))return!1}else{if("function"===r)return t(this);var s=/^(empty|editable)$/.test(t)?this["is"+e.capitalize(t)]():"type"===t?e.hyphenate(this._class):this[t];if(/^(constructor|class)$/.test(t)){if(!(this instanceof i))return!1}else if(i instanceof RegExp){if(!i.test(s))return!1}else if("function"==typeof i){if(!i(s))return!1}else if(e.isPlainObject(i)){if(!n(i,s))return!1}else if(!e.equals(s,i))return!1}return!0},getItems:function(t){return y._getItems(this._children,t,this._matrix)},getItem:function(t){return y._getItems(this._children,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(i,n,r,o,s){if(!o&&"object"==typeof n){var a=n.overlapping,l=n.inside,h=a||l,c=h&&d.read([h]);o={items:[],inside:!!l,overlapping:!!a,rect:c,path:a&&new I.Rectangle({rectangle:c,insert:!1})},h&&(n=e.set({},n,{inside:!0,overlapping:!0}))}var u=o&&o.items,c=o&&o.rect;r=c&&(r||new p);for(var f=0,g=i&&i.length;f<g;f++){var m=i[f],v=r&&r.chain(m._matrix),y=!0;if(c){var h=m.getBounds(v);if(!c.intersects(h))continue;o.inside&&c.contains(h)||o.overlapping&&(h.contains(c)||o.path.intersects(m,v))||(y=!1)}if(y&&m.matches(n)&&(u.push(m),s))break;if(t(m._children,n,v,o,s),s&&u.length>0)break}return u}}},{importJSON:function(t){var i=e.importJSON(t,this);return i!==this?this.addChild(i):i},addChild:function(e,i){return this.insertChild(t,e,i)},insertChild:function(t,e,i){var n=e?this.insertChildren(t,[e],i):null;return n&&n[0]},addChildren:function(t,e){return this.insertChildren(this._children.length,t,e)},insertChildren:function(t,i,n,r){var o=this._children;if(o&&i&&i.length>0){i=Array.prototype.slice.apply(i);for(var s=i.length-1;s>=0;s--){var a=i[s];if(!r||a instanceof r){var l=a._parent===this&&a._index<t;a._remove(!1,!0)&&l&&t--}else i.splice(s,1)}e.splice(o,i,t,0);for(var h=this._project,c=h&&h._changes,s=0,u=i.length;s<u;s++){var a=i[s];a._parent=this,a._setProject(this._project,!0),a._name&&a.setName(a._name),c&&this._changed(5)}this._changed(11)}else i=null;return i},_insertSibling:function(t,e,i){return this._parent?this._parent.insertChild(t,e,i):null},insertAbove:function(t,e){return t._insertSibling(t._index+1,this,e)},insertBelow:function(t,e){return t._insertSibling(t._index,this,e)},sendToBack:function(){return(this._parent||this instanceof _&&this._project).insertChild(0,this)},bringToFront:function(){return(this._parent||this instanceof _&&this._project).addChild(this)},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&1===this._children.length){var t=this._children[0].reduce();return t.insertAbove(this),t.setStyle(this._style),this.remove(),t}return this},_removeNamed:function(){var t=this._parent;if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],o=r?r.indexOf(this):-1;-1!==o&&(e[n]==this&&delete e[n],r.splice(o,1),r.length?e[n]=r[r.length-1]:delete i[n])}},_remove:function(t,i){var n=this._parent;if(n){if(this._name&&this._removeNamed(),null!=this._index&&e.splice(n._children,null,this._index,1),this._installEvents(!1),t){var r=this._project;r&&r._changes&&this._changed(5)}return i&&n._changed(11),this._parent=null,!0}return!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,i){if(!this._children)return null;t=t||0,i=e.pick(i,this._children.length);for(var n=e.splice(this._children,null,t,i-t),r=n.length-1;r>=0;r--)n[r]._remove(!0,!1);return n.length>0&&this._changed(11),n},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){return!this._children||0===this._children.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,o=Math.min(i.length,n.length);r<o;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e==t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1},translate:function(){var t=new p;return this.transform(t.translate.apply(t,arguments))},rotate:function(t){return this.transform((new p).rotate(t,l.read(arguments,1,{readNull:!0})||this.getPosition(!0)))}},e.each(["scale","shear","skew"],function(t){this[t]=function(){var e=l.read(arguments),i=l.read(arguments,0,{readNull:!0});return this.transform((new p)[t](e,i||this.getPosition(!0)))}},{}),{transform:function(t,e,i,n){t&&t.isIdentity()&&(t=null);var r=this._matrix,o=(e||this._applyMatrix)&&(!r.isIdentity()||t||e&&i&&this._children);if(!t&&!o)return this;if(t&&r.preConcatenate(t),o=o&&this._transformContent(r,i,n)){var s=this._pivot,a=this._style,l=a.getFillColor(!0),h=a.getStrokeColor(!0);s&&r._transformPoint(s,s,!0),l&&l.transform(r),h&&h.transform(r),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var c=this._bounds,u=this._position;this._changed(9);var d=c&&t&&t.decompose();if(d&&!d.shearing&&d.rotation%90==0){for(var f in c){var p=c[f];!o&&p._internal||t._transformBounds(p,p)}var g=this._boundsGetter,p=c[g&&g.getBounds||g||"getBounds"];p&&(this._position=p.getCenter(!0)),this._bounds=c}else t&&u&&(this._position=t._transformPoint(u,u));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,o=n.length;r<o;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(l.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(l.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(l.read(arguments))},localToParent:function(){return this._matrix._transformPoint(l.read(arguments))},fitBounds:function(t,e){t=d.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,o=(e?n>r:n<r)?t.width/i.width:t.height/i.height,s=new d(new l,new c(i.width*o,i.height*o));s.setCenter(t.getCenter()),this.setBounds(s)},_setStyles:function(t){var e=this._style,i=e.getFillColor(),n=e.getStrokeColor(),r=e.getShadowColor();if(i&&(t.fillStyle=i.toCanvasStyle(t)),n){var o=e.getStrokeWidth();if(o>0){t.strokeStyle=n.toCanvasStyle(t),t.lineWidth=o;var s=e.getStrokeJoin(),a=e.getStrokeCap(),l=e.getMiterLimit();if(s&&(t.lineJoin=s),a&&(t.lineCap=a),l&&(t.miterLimit=l),paper.support.nativeDash){var h=e.getDashArray(),c=e.getDashOffset();h&&h.length&&("setLineDash"in t?(t.setLineDash(h),t.lineDashOffset=c):(t.mozDash=h,t.mozDashOffset=c))}}}if(r){var u=e.getShadowBlur();if(u>0){t.shadowColor=r.toCanvasStyle(t),t.shadowBlur=u;var d=this.getShadowOffset();t.shadowOffsetX=d.x,t.shadowOffsetY=d.y}}},draw:function(t,e,i){function n(t){return s?s.chain(t):t}var r=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var o=e.matrices,s=e.viewMatrix,a=this._matrix,l=o[o.length-1].chain(a);if(l.isInvertible()){o.push(l),e.updateMatrix&&(l._updateVersion=r,this._globalMatrix=l);var h,c,u,d=this._blendMode,f=this._opacity,p="normal"===d,g=X.nativeModes[d],m=p&&1===f||e.dontStart||e.clip||(g||p&&f<1)&&this._canComposite(),v=e.pixelRatio||1;if(!m){var y=this.getStrokeBounds(n(l));if(!y.width||!y.height)return;u=e.offset,c=e.offset=y.getTopLeft().floor(),h=t,t=Y.getContext(y.getSize().ceil().add(1).multiply(v)),1!==v&&t.scale(v,v)}t.save();var b=i?i.chain(a):!this.getStrokeScaling(!0)&&n(l),_=!m&&e.clipItem,w=!b||_;if(m?(t.globalAlpha=f,g&&(t.globalCompositeOperation=d)):w&&t.translate(-c.x,-c.y),w&&(m?a:n(l)).applyToContext(t),_&&e.clipItem.draw(t,e.extend({clip:!0})),b){t.setTransform(v,0,0,v,0,0);var x=e.offset;x&&t.translate(-x.x,-x.y)}this._draw(t,e,b),t.restore(),o.pop(),e.clip&&!e.dontFinish&&t.clip(),m||(X.process(d,t,h,f,c.subtract(u).multiply(v)),Y.release(t),e.offset=u)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof N)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){if((this._drawSelected||this._boundsSelected)&&this._isUpdated(r)){var o=this.getSelectedColor(!0)||this.getLayer().getSelectedColor(!0),s=e.chain(this.getGlobalMatrix(!0));if(t.strokeStyle=t.fillStyle=o?o.toCanvasStyle(t):"#009dec",this._drawSelected&&this._drawSelected(t,s,n),this._boundsSelected){var a=i/2,l=s._transformCorners(this.getInternalBounds());t.beginPath();for(var h=0;h<8;h++)t[0===h?"moveTo":"lineTo"](l[h],l[++h]);t.closePath(),t.stroke();for(var h=0;h<8;h++)t.fillRect(l[h]-a,l[++h]-a,i,i)}}},_canComposite:function(){return!1}},e.each(["down","drag","up","move"],function(t){this["removeOn"+e.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),b=y.extend({_class:"Group",_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function e(i){e.base.call(this,i),1026&i&&(this._clipItem=t)},_getClipItem:function(){var e=this._clipItem;if(e===t){e=null;for(var i=0,n=this._children.length;i<n;i++){var r=this._children[i];if(r._clipMask){e=r;break}}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem(),r=!0;if(e=e.extend({clipItem:n,clip:!1}),i?this._currentPath?(t.currentPath=this._currentPath,r=!1):(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0})),r)for(var o=0,s=this._children.length;o<s;o++){var a=this._children[o];a!==n&&a.draw(t,e)}i&&(this._currentPath=t.currentPath)}}),_=b.extend({_class:"Layer",initialize:function(i){var n=e.isPlainObject(i)?new e(i):{children:Array.isArray(i)?i:arguments},r=n.insert;n.insert=!1,b.call(this,n),(r||r===t)&&(this._project.addChild(this),this.activate())},_remove:function t(i,n){if(this._parent)return t.base.call(this,i,n);if(null!=this._index){var r=this._project;return r._activeLayer===this&&(r._activeLayer=this.getNextSibling()||this.getPreviousSibling()),e.splice(r.layers,null,this._index,1),this._installEvents(!1),i&&r._changes&&this._changed(5),n&&(r._needsUpdate=!0),!0}return!1},getNextSibling:function t(){return this._parent?t.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function t(){return this._parent?t.base.call(this):this._project.layers[this._index-1]||null},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_insertSibling:function t(e,i,n){return this._parent?t.base.call(this,e,i,n):this._project.insertChild(e,i,n)}}),w=y.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_boundsSelected:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t){this._initialize(t)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&e.equals(this._radius,t._radius)},clone:function(t){var e=new w(y.NO_INSERT);return e.setType(this._type),e.setSize(this._size),e.setRadius(this._radius),this._clone(e,t)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new u(t.width,t.height,this,"setSize")},setSize:function(){var t=c.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;if("rectangle"===e){var r=c.min(this._radius,t.divide(2));this._radius.set(r.width,r.height)}else"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius.set(i/2,n/2);this._size.set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new u(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size.set(i,i)}else if(t=c.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t.width,t.height),"rectangle"===e){var i=c.max(this._size,t.multiply(2));this._size.set(i.width,i.height)}else"ellipse"===e&&this._size.set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=this._clone(new(I[e.capitalize(this._type)])({center:new l,size:this._size,radius:this._radius,insert:!1}),t);return paper.settings.applyMatrix&&i.setApplyMatrix(!0),i},_draw:function(t,e,i){var n=this._style,r=n.hasFill(),o=n.hasStroke(),s=e.dontFinish||e.clip,a=!i;if(r||o||s){var l=this._type,h=this._radius,c="circle"===l;if(e.dontStart||t.beginPath(),a&&c)t.arc(0,0,h,0,2*Math.PI,!0);else{var u=c?h:h.width,d=c?h:h.height,f=this._size,p=f.width,g=f.height;if(a&&"rectangle"===l&&0===u&&0===d)t.rect(-p/2,-g/2,p,g);else{var m=p/2,v=g/2,y=.44771525016920644,b=u*y,_=d*y,w=[-m,-v+d,-m,-v+_,-m+b,-v,-m+u,-v,m-u,-v,m-b,-v,m,-v+_,m,-v+d,m,v-d,m,v-_,m-b,v,m-u,v,-m+u,v,-m+b,v,-m,v-_,-m,v-d];i&&i.transform(w,w,32),t.moveTo(w[0],w[1]),t.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),m!==u&&t.lineTo(w[8],w[9]),t.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),v!==d&&t.lineTo(w[16],w[17]),t.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),m!==u&&t.lineTo(w[24],w[25]),t.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}t.closePath()}s||!r&&!o||(this._setStyles(t),r&&(t.fill(n.getWindingRule()),t.shadowColor="rgba(0,0,0,0)"),o&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new d(this._size).setCenter(0,0);return"getBounds"!==t&&this.hasStroke()&&(i=i.expand(this.getStrokeWidth())),e?e._transformBounds(i):i}},new function(){function t(t,e,i){var n=t._radius
;if(!n.isZero())for(var r=t._size.divide(2),o=0;o<4;o++){var s=new l(1&o?1:-1,o>1?1:-1),a=s.multiply(r),h=a.subtract(s.multiply(n)),c=new d(a,h);if((i?c.expand(i):c).contains(e))return h}}function e(t,e){var i=t.getAngleInRadians(),n=2*e.width,r=2*e.height,o=n*Math.sin(i),s=r*Math.cos(i);return n*r/(2*Math.sqrt(o*o+s*s))}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r){var o=!1;if(this.hasStroke()){var s=this._type,a=this._radius,l=this.getStrokeWidth()+2*r.tolerance;if("rectangle"===s){var h=t(this,n,l);if(h){var c=n.subtract(h);o=2*Math.abs(c.getLength()-e(c,a))<=l}else{var u=new d(this._size).setCenter(0,0),f=u.expand(l),p=u.expand(-l);o=f._containsPoint(n)&&!p._containsPoint(n)}}else"ellipse"===s&&(a=e(n,a)),o=2*Math.abs(n.getLength()-a)<=l}return o?new S("stroke",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,i,n,r,o){var s=new w(e.getNamed(o));return s._type=t,s._size=n,s._radius=r,s.translate(i)}return{Circle:function(){var i=l.readNamed(arguments,"center"),n=e.readNamed(arguments,"radius");return t("circle",i,new c(2*n),n,arguments)},Rectangle:function(){var e=d.readNamed(arguments,"rectangle"),i=c.min(c.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=w._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var i,n;if(e.hasNamed(t,"radius"))i=l.readNamed(t,"center"),n=c.readNamed(t,"radius");else{var r=d.readNamed(t,"rectangle");i=r.getCenter(!0),n=r.getSize(!0).divide(2)}return{center:i,radius:n}}}}}),x=y.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{crossOrigin:null,source:null},initialize:function(e,i){this._initialize(e,i!==t&&l.read(arguments,1))||("string"==typeof e?this.setSource(e):this.setImage(e)),this._size||(this._size=new c,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},clone:function(t){var e=new x(y.NO_INSERT),i=this._image,n=this._canvas;if(i)e.setImage(i);else if(n){var r=Y.getCanvas(this._size);r.getContext("2d").drawImage(n,0,0),e.setImage(r)}return e._crossOrigin=this._crossOrigin,this._clone(e,t)},getSize:function(){var t=this._size;return new u(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=c.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this.setImage(Y.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&Y.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new l(0,0).transform(t),i=new l(1,0).transform(t).subtract(e),n=new l(0,1).transform(t).subtract(e);return new c(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){this._canvas&&Y.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=t&&t.complete),this._size=new c(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=Y.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){Y.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(t){function e(){var t=n.getView();t&&(paper=t._scope,n.setImage(i),n.emit("load"),t.update())}var i,n=this,r=this._crossOrigin;i=document.getElementById(t)||new Image,r&&(i.crossOrigin=r),i.naturalWidth&&i.naturalHeight?setTimeout(e,0):($.add(i,{load:e}),i.src||(i.src=t)),this.setImage(i)},getCrossOrigin:function(){return this._image&&this._image.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t,this._image&&(this._image.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=d.read(arguments),e=Y.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=d.read(arguments),e=new x(y.NO_INSERT);return e.setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.preConcatenate(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image&&this._image.src;if(/^data:/.test(t))return t;var e=this.getCanvas();return e?e.toDataURL.apply(e,arguments):null},drawImage:function(t){var e=l.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var i,n;t?t instanceof D?(n=t,i=t.getBounds()):t.width?i=new d(t):t.x&&(i=new d(t.x-.5,t.y-.5,1,1)):i=this.getBounds();var r=32,o=Math.min(i.width,r),s=Math.min(i.height,r),a=x._sampleContext;a?a.clearRect(0,0,r+1,r+1):a=x._sampleContext=Y.getContext(new c(r)),a.save();var l=(new p).scale(o/i.width,s/i.height).translate(-i.x,-i.y);l.applyToContext(a),n&&n.draw(a,new e({clip:!0,matrices:[l]})),this._matrix.applyToContext(a);var h=this.getElement(),u=this._size;h&&a.drawImage(h,-u.width/2,-u.height/2),a.restore();for(var f=a.getImageData(.5,.5,Math.ceil(o),Math.ceil(s)).data,g=[0,0,0],m=0,v=0,y=f.length;v<y;v+=4){var b=f[v+3];m+=b,b/=255,g[0]+=f[v]*b,g[1]+=f[v+1]*b,g[2]+=f[v+2]*b}for(var v=0;v<3;v++)g[v]/=m;return m?O.read(g):null},getPixel:function(){var t=l.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new O("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=l.read(arguments),e=O.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),o=r.createImageData(1,1),s=o.data;s[0]=255*i[0],s[1]=255*i[1],s[2]=255*i[2],s[3]=null!=n?255*n:255,r.putImageData(o,t.x,t.y)},createImageData:function(){var t=c.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=d.read(arguments);return t.isEmpty()&&(t=new d(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=l.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new d(this._size).setCenter(0,0);return e?e._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new S("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),C=y.extend({_class:"PlacedSymbol",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function(e,i){this._initialize(e,i!==t&&l.read(arguments,1))||this.setSymbol(e instanceof v?e:new v(e))},_equals:function(t){return this._symbol===t._symbol},getSymbol:function(){return this._symbol},setSymbol:function(t){this._symbol=t,this._changed(9)},clone:function(t){var e=new C(y.NO_INSERT);return e.setSymbol(this._symbol),this._clone(e,t)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(t,e,i){var n=this.symbol._definition;return n._getCachedBounds(t,e&&e.chain(n._matrix),i)},_hitTestSelf:function(t,e){var i=this._symbol._definition._hitTest(t,e);return i&&(i.item=this),i},_draw:function(t,e){this.symbol._definition.draw(t,e)}}),S=e.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&(i.enumerable=!0,this.inject(i))},statics:{getOptions:function(t){return new e({type:null,tolerance:paper.settings.hitTolerance,fill:!t,stroke:!t,segments:!t,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},t)}}}),T=e.extend({_class:"Segment",beans:!0,initialize:function(e,i,n,r,o,s){var a,l,h,c=arguments.length;0===c||(1===c?"point"in e?(a=e.point,l=e.handleIn,h=e.handleOut):a=e:2===c&&"number"==typeof e?a=arguments:c<=3?(a=e,l=i,h=n):(a=e!==t?[e,i]:null,l=n!==t?[n,r]:null,h=o!==t?[o,s]:null)),new k(a,this,"_point"),new k(l,this,"_handleIn"),new k(h,this,"_handleOut")},_serialize:function(t){return e.serialize(this.hasHandles()?[this._point,this._handleIn,this._handleOut]:this._point,t,!0)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){var t=l.read(arguments);this._point.set(t.x,t.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var t=l.read(arguments);this._handleIn.set(t.x,t.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var t=l.read(arguments);this._handleOut.set(t.x,t.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},_selectionState:0,isSelected:function(t){var e=this._selectionState;return t?t===this._point?!!(4&e):t===this._handleIn?!!(1&e):t===this._handleOut&&!!(2&e):!!(7&e)},setSelected:function(t,e){var i=this._path,t=!!t,n=this._selectionState,r=n,o=e?e===this._point?4:e===this._handleIn?1:e===this._handleOut?2:0:7;t?n|=o:n&=~o,this._selectionState=n,i&&n!==r&&(i._updateSelection(this,r,n),i._changed(129))},getIndex:function(){return this._index!==t?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new P(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t._x,n=t._y;t.set(e._x,e._y),e.set(i,n)},reversed:function(){return new T(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new T(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,o=i&&this._handleOut.isZero()?null:this._handleOut,s=n._x,a=n._y,l=2;return e[0]=s,e[1]=a,r&&(e[l++]=r._x+s,e[l++]=r._y+a),o&&(e[l++]=o._x+s,e[l++]=o._y+a),t&&(t._transformCoordinates(e,e,l/2),s=e[0],a=e[1],i?(n._x=s,n._y=a,l=2,r&&(r._x=e[l++]-s,r._y=e[l++]-a),o&&(o._x=e[l++]-s,o._y=e[l++]-a)):(r||(e[l++]=s,e[l++]=a),o||(e[l++]=s,e[l++]=a))),e}}),k=l.extend({initialize:function(e,i,n){var r,o,s;if(e)if((r=e[0])!==t)o=e[1];else{var a=e;(r=a.x)===t&&(a=l.read(arguments),r=a.x),o=a.y,s=a.selected}else r=o=0;this._x=r,this._y=o,this._owner=i,i[n]=this,s&&this.setSelected(!0)},set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},_serialize:function(t){var e=t.formatter,i=e.number(this._x),n=e.number(this._y);return this.isSelected()?{x:i,y:n,selected:!0}:[i,n]},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){return s.isZero(this._x)&&s.isZero(this._y)},setSelected:function(t){this._owner.setSelected(t,this)},isSelected:function(){return this._owner.isSelected(this)}}),E=e.extend({_class:"Curve",initialize:function(t,e,i,n,r,o,s,a){var l,h,c,u,d,f,p=arguments.length;3===p?(this._path=t,l=e,h=i):0===p?(l=new T,h=new T):1===p?"segment1"in t?(l=new T(t.segment1),h=new T(t.segment2)):"point1"in t?(c=t.point1,d=t.handle1,f=t.handle2,u=t.point2):Array.isArray(t)&&(c=[t[0],t[1]],u=[t[6],t[7]],d=[t[2]-t[0],t[3]-t[1]],f=[t[4]-t[6],t[5]-t[7]]):2===p?(l=new T(t),h=new T(e)):4===p?(c=t,d=e,f=i,u=n):8===p&&(c=[t,e],u=[s,a],d=[i-t,n-e],f=[r-s,o-a]),this._segment1=l||new T(c,null,d),this._segment2=h||new T(u,f,null)},_serialize:function(t){return e.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0)},_changed:function(){this._length=this._bounds=t},clone:function(){return new E(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;t=e.remove(),t&&this._segment1._handleOut.set(i.x,i.y)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){var t=l.read(arguments);this._segment1._point.set(t.x,t.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var t=l.read(arguments);this._segment2._point.set(t.x,t.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var t=l.read(arguments);this._segment1._handleOut.set(t.x,t.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var t=l.read(arguments);this._segment2._handleIn.set(t.x,t.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return E.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new l(t[i],t[i+1]));return e},getLength:function(){return null==this._length&&(this._length=E.getLength(this.getValues(),0,1)),this._length},getArea:function(){return E.getArea(this.getValues())},getLine:function(){return new g(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new E(E.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return E.getLength(this.getValues(),t,e)},getIntersections:function(t){return E._getIntersections(this.getValues(),t&&t!==this?t.getValues():null,this,t,[],{})},_getParameter:function(e,i){return i?e:e&&e.curve===this?e.parameter:e===t&&i===t?.5:this.getParameterAt(e,0)},divide:function(t,e,i){var n=this._getParameter(t,e),r=4e-7,o=1-r,s=null;if(n>=r&&n<=o){var a=E.subdivide(this.getValues(),n),h=a[0],c=a[1],u=i||this.hasHandles(),d=this._segment1,f=this._segment2,p=this._path;u&&(d._handleOut.set(h[2]-h[0],h[3]-h[1]),f._handleIn.set(c[4]-c[6],c[5]-c[7]));var g=h[6],m=h[7],v=new T(new l(g,m),u&&new l(h[4]-g,h[5]-m),u&&new l(c[2]-g,c[3]-m));p?(p.insert(d._index+1,v),s=this.getNext()):(this._segment2=v,s=new E(v,f))}return s},split:function(t,e){return this._path?this._path.split(this._segment1._index,this._getParameter(t,e)):null},reversed:function(){return new E(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0),this._segment2._handleIn.set(0,0)},statics:{getValues:function(t,e,i){var n=t._point,r=t._handleOut,o=e._handleIn,s=e._point,a=[n._x,n._y,n._x+r._x,n._y+r._y,s._x+o._x,s._y+o._y,s._x,s._y];return i&&i._transformCoordinates(a,a,4),a},subdivide:function(e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],c=e[7];i===t&&(i=.5);var u=1-i,d=u*n+i*o,f=u*r+i*s,p=u*o+i*a,g=u*s+i*l,m=u*a+i*h,v=u*l+i*c,y=u*d+i*p,b=u*f+i*g,_=u*p+i*m,w=u*g+i*v,x=u*y+i*_,C=u*b+i*w;return[[n,r,d,f,y,b,x,C],[x,C,_,w,m,v,h,c]]},solveCubic:function(t,e,i,n,r,o){var a=t[e],l=t[e+2],h=t[e+4],c=t[e+6],u=3*(l-a),d=3*(h-l)-u,f=c-a-u-d;return s.solveCubic(f,d,u,a-i,n,r,o)},getParameterOf:function(t,e){var i=new l(t[0],t[1]),n=new l(t[6],t[7]),r=1e-12,o=e.isClose(i,r)?0:e.isClose(n,r)?1:null;if(null!==o)return o;for(var s=[e.x,e.y],a=[],h=2e-7,c=0;c<2;c++)for(var u=E.solveCubic(t,c,s[c],a,0,1),d=0;d<u;d++)if(o=a[d],e.isClose(E.getPoint(t,o),h))return o;return e.isClose(i,h)?0:e.isClose(n,h)?1:null},getNearestParameter:function(t,e){function i(i){if(i>=0&&i<=1){var n=e.getDistance(E.getPoint(t,i),!0);if(n<f)return f=n,p=i,!0}}if(E.isStraight(t)){var n=t[0],r=t[1],o=t[6],s=t[7],a=o-n,h=s-r,c=a*a+h*h;if(0===c)return 0;var u=((e.x-n)*a+(e.y-r)*h)/c;return u<1e-12?0:u>.999999999999?1:E.getParameterOf(t,new l(n+u*a,r+u*h))}for(var d=100,f=Infinity,p=0,g=0;g<=d;g++)i(g/d);for(var m=1/(2*d);m>4e-7;)i(p-m)||i(p+m)||(m/=2);return p},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=E.subdivide(t,e)[1]),i<1&&(t=E.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},hasHandles:function(t){var e=s.isZero;return!(e(t[0]-t[2])&&e(t[1]-t[3])&&e(t[4]-t[6])&&e(t[5]-t[7]))},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],h=t[7],c=3*r-2*i-l,u=3*o-2*n-h,d=3*s-2*l-i,f=3*a-2*h-n;return Math.max(c*c,d*d)+Math.max(u*u,f*f)<10*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[6],r=t[7],o=(t[2]+e)/2,s=(t[3]+i)/2,a=(t[4]+t[6])/2,l=(t[5]+t[7])/2;return 6*((e-o)*(s+i)+(o-a)*(l+s)+(a-n)*(r+l))/10},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)E._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new d(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,o,a,l,h){function c(t,e){var i=t-e,n=t+e;i<a[r]&&(a[r]=i),n>l[r]&&(l[r]=n)}var u=3*(e-i)-t+n,d=2*(t+i)-4*e,f=e-t,p=s.solveQuadratic(u,d,f,h),g=4e-7,m=1-g;c(n,0);for(var v=0;v<p;v++){var y=h[v],b=1-y;g<y&&y<m&&c(b*b*b*t+3*b*b*y*e+3*b*y*y*i+y*y*y*n,o)}}}},e.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];if(!e){var i=this._path;e=this._bounds[t]=I[t]([this._segment1,this._segment2],!1,i&&i.getStyle())}return e.clone()}},{}),e.each({isStraight:function(t,e,i){if(e.isZero()&&i.isZero())return!0;if(t.isZero())return!1;if(e.isCollinear(t)&&i.isCollinear(t)){var n=t.dot(t),r=t.dot(e)/n,o=t.dot(i)/n;return r>=0&&r<=1&&o<=0&&o>=-1}return!1},isLinear:function(t,e,i){var n=t.divide(3);return e.equals(n)&&i.negate().equals(n)}},function(t,e){this[e]=function(){var e=this._segment1,i=this._segment2;return t(i._point.subtract(e._point),e._handleOut,i._handleIn)},this.statics[e]=function(e){var i=e[0],n=e[1],r=e[6],o=e[7];return t(new l(r-i,o-n),new l(e[2]-i,e[3]-n),new l(e[4]-r,e[5]-o))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).y)<1e-7},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).x)<1e-7}}),{beans:!1,getParameterAt:function(t,e){return E.getParameterAt(this.getValues(),t,e)},getParameterOf:function(){return E.getParameterOf(this.getValues(),l.read(arguments))},getLocationAt:function(t,e){var i=e?t:this.getParameterAt(t);return null!=i&&i>=0&&i<=1?new P(this,i):null},getLocationOf:function(){return this.getLocationAt(this.getParameterOf(l.read(arguments)),!0)},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getNearestLocation:function(){var t=l.read(arguments),e=this.getValues(),i=E.getNearestParameter(e,t),n=E.getPoint(e,i);return new P(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return e.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return E[t](n,i?e:E.getParameterAt(n,e,0))}},{statics:{evaluateMethods:t}})},new function(){function e(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],h=9*(n-o)+3*(a-e),c=6*(e+o)-12*n,u=3*(n-e),d=9*(r-s)+3*(l-i),f=6*(i+s)-12*r,p=3*(r-i);return function(t){var e=(h*t+c)*t+u,i=(d*t+f)*t+p;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r,o,s=t[0],a=t[1],h=t[2],c=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=4e-7,m=1-g;if(0===i&&(e<g||e>m)){var v=e<g;r=v?s:f,o=v?a:p}else{var y=3*(h-s),b=3*(u-h)-y,_=f-s-y-b,w=3*(c-a),x=3*(d-c)-w,C=p-a-w-x;if(0===i)r=((_*e+b)*e+y)*e+s,o=((C*e+x)*e+w)*e+a;else{if(e<g?(r=y,o=w):e>m?(r=3*(f-u),o=3*(p-d)):(r=(3*_*e+2*b)*e+y,o=(3*C*e+2*x)*e+w),n){0===r&&0===o&&(e<g||e>m)&&(r=u-h,o=d-c);var S=Math.sqrt(r*r+o*o);S&&(r/=S,o/=S)}if(3===i){var T=6*_*e+2*b,k=6*C*e+2*x,E=Math.pow(r*r+o*o,1.5);r=0!==E?(r*k-o*T)/E:0,o=0}}}return 2===i?new l(o,-r):new l(r,o)}return{statics:{getLength:function(n,r,o){if(r===t&&(r=0),o===t&&(o=1),0===r&&1===o&&E.isStraight(n)){var a=n[6]-n[0],l=n[7]-n[1];return Math.sqrt(a*a+l*l)}var h=e(n);return s.integrate(h,r,o,i(r,o))},getParameterAt:function(n,r,o){function a(t){return g+=s.integrate(d,o,t,i(o,t)),o=t,g-r}if(o===t&&(o=r<0?1:0),0===r)return o;var l=Math.abs,h=r>0,c=h?o:0,u=h?1:o,d=e(n),f=s.integrate(d,c,u,i(c,u));if(l(r-f)<1e-12)return h?u:c;if(l(r)>f)return null;var p=r/f,g=0;return s.findRoot(a,d,o+p,c,u,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x}}}},new function(){function t(t,e,i,n,r,o,s,a,l,h,c){var u=e.startConnected,d=e.endConnected,f=4e-7,p=1-f;if(null==r&&(r=E.getParameterOf(i,o)),null!==r&&r>=(u?f:0)&&r<=(d?p:1)&&(null==l&&(l=E.getParameterOf(s,h)),null!==l&&l>=(d?f:0)&&l<=(u?p:1))){var g=e.renormalize;if(g){var m=g(r,l);r=m[0],l=m[1]}var v=new P(n,r,o||E.getPoint(i,r),c),y=new P(a,l,h||E.getPoint(s,l),c),b=v.getPath()===y.getPath()&&v.getIndex()>y.getIndex(),_=b?y:v,w=e.include;v._intersection=y,y._intersection=v,w&&!w(_)||P.insert(t,_,!0)}}function e(r,o,s,a,l,h,c,u,d,f,p,m,v){if(!(++v>=24)){var y,b,_=o[0],w=o[1],x=o[6],C=o[7],S=g.getSignedDistance,T=S(_,w,x,C,o[2],o[3]),k=S(_,w,x,C,o[4],o[5]),P=T*k>0?.75:4/9,D=P*Math.min(0,T,k),I=P*Math.max(0,T,k),N=S(_,w,x,C,r[0],r[1]),M=S(_,w,x,C,r[2],r[3]),L=S(_,w,x,C,r[4],r[5]),A=S(_,w,x,C,r[6],r[7]),R=i(N,M,L,A),O=R[0],z=R[1];if(null!=(y=n(O,z,D,I))&&null!=(b=n(O.reverse(),z.reverse(),D,I))){r=E.getPart(r,y,b);var H=b-y,F=c+(u-c)*y,B=c+(u-c)*b;if(p>.5&&H>.5)if(B-F>f-d){var $=E.subdivide(r,.5),j=F+(B-F)/2;e(o,$[0],a,s,l,h,d,f,F,j,H,!m,v),e(o,$[1],a,s,l,h,d,f,j,B,H,!m,v)}else{var $=E.subdivide(o,.5),j=d+(f-d)/2;e($[0],r,a,s,l,h,d,j,F,B,H,!m,v),e($[1],r,a,s,l,h,j,f,F,B,H,!m,v)}else if(Math.max(f-d,B-F)<1e-7){var W=F+(B-F)/2,q=d+(f-d)/2;r=s.getValues(),o=a.getValues(),t(l,h,m?o:r,m?a:s,m?q:W,null,m?r:o,m?s:a,m?W:q,null)}else H>1e-12&&e(o,r,a,s,l,h,d,f,F,B,H,!m,v)}}}function i(t,e,i,n){var r,o=[0,t],s=[1/3,e],a=[2/3,i],l=[1,n],h=e-(2*t+n)/3,c=i-(t+2*n)/3;if(h*c<0)r=[[o,s,l],[o,a,l]];else{var u=h/c;r=[u>=2?[o,s,l]:u<=.5?[o,a,l]:[o,s,a,l],[o,l]]}return(h||c)<0?r.reverse():r}function n(t,e,i,n){return t[0][1]<i?r(t,!0,i):e[0][1]>n?r(e,!1,n):t[0][0]}function r(t,e,i){for(var n=t[0][0],r=t[0][1],o=1,s=t.length;o<s;o++){var a=t[o][0],l=t[o][1];if(e?l>=i:l<=i)return l===i?a:n+(i-r)*(a-n)/(l-r);n=a,r=l}return null}function o(e,i,n,r,o,a){for(var l=E.isStraight(e),h=l?i:e,c=l?e:i,u=c[0],d=c[1],f=c[6],p=c[7],g=f-u,m=p-d,v=Math.atan2(-m,g),y=Math.sin(v),b=Math.cos(v),_=[],w=0;w<8;w+=2){var x=h[w]-u,C=h[w+1]-d;_.push(x*b-C*y,x*y+C*b)}for(var S=[],T=E.solveCubic(_,1,0,S,0,1),w=0;w<T;w++){var k=S[w],P=E.getPoint(h,k),D=E.getParameterOf(c,P);if(null!==D){var I=E.getPoint(c,D),N=l?D:k,M=l?k:D;(!a.endConnected||M>s.CURVETIME_EPSILON)&&t(o,a,e,n,N,l?I:P,i,r,M,l?P:I)}}}function a(e,i,n,r,o,s){var a=g.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);a&&t(o,s,e,n,null,a,i,r,null,a)}return{statics:{_getIntersections:function(i,n,r,s,h,c){if(!n)return E._getSelfIntersection(i,r,h,c);var u=i[0],d=i[1],f=i[6],p=i[7],g=n[0],m=n[1],v=n[6],y=n[7],b=(3*i[2]+u)/4,_=(3*i[3]+d)/4,w=(3*i[4]+f)/4,x=(3*i[5]+p)/4,C=(3*n[2]+g)/4,S=(3*n[3]+m)/4,T=(3*n[4]+v)/4,k=(3*n[5]+y)/4,P=Math.min,D=Math.max;if(!(D(u,b,w,f)>=P(g,C,T,v)&&P(u,b,w,f)<=D(g,C,T,v)&&D(d,_,x,p)>=P(m,S,k,y)&&P(d,_,x,p)<=D(m,S,k,y)))return h;if(!c.startConnected&&!c.endConnected){var I=E.getOverlaps(i,n);if(I){for(var N=0;N<2;N++){var M=I[N];t(h,c,i,r,M[0],null,n,s,M[1],null,!0)}return h}}var L=E.isStraight(i),A=E.isStraight(n),R=L&&A,O=1e-12,z=h.length;if((R?a:L||A?o:e)(i,n,r,s,h,c,0,1,0,1,0,!1,0),R&&h.length>z)return h;var H=new l(u,d),F=new l(f,p),B=new l(g,m),$=new l(v,y);return H.isClose(B,O)&&t(h,c,i,r,0,H,n,s,0,B),!c.startConnected&&H.isClose($,O)&&t(h,c,i,r,0,H,n,s,1,$),!c.endConnected&&F.isClose(B,O)&&t(h,c,i,r,1,F,n,s,0,B),F.isClose($,O)&&t(h,c,i,r,1,F,n,s,1,$),h},_getSelfIntersection:function(t,e,i,n){var r=t[0],o=t[1],a=t[2],h=t[3],c=t[4],u=t[5],d=t[6],f=t[7],p=new g(r,o,d,f,!1),m=p.getSide(new l(a,h),!0);if(m===p.getSide(new l(c,u),!0)&&((r-c)*(h-f)+(a-d)*(u-o))*m>0)return i;var v=d-3*c+3*a-r,y=c-2*a+r,b=a-r,_=f-3*u+3*h-o,w=u-2*h+o,x=h-o,C=_*b-v*x;if(C*C-4*(_*y-v*w)*(w*b-y*x)<0){var S,T=[],k=s.solveCubic(v*v+_*_,3*(v*y+_*w),2*(y*y+w*w)+v*b+_*x,y*b+w*x,T,0,1);if(k>0){for(var P=0,D=0;P<k;P++){var I=Math.abs(e.getCurvatureAt(T[P],!0));I>D&&(D=I,S=T[P])}var N=E.subdivide(t,S);n.endConnected=!0,n.renormalize=function(t,e){return[t*S,e*(1-S)+S]},E._getIntersections(N[0],N[1],e,e,i,n)}}return i},getOverlaps:function(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=4e-7,o=2e-7,s=E.isStraight(t),a=E.isStraight(e),h=s&&a;if(h){var c=i(t)<i(e),u=c?e:t,d=c?t:e,f=new g(u[0],u[1],u[6],u[7]);if(f.getDistance(new l(d[0],d[1]))>o||f.getDistance(new l(d[6],d[7]))>o)return null}else if(s^a)return null;for(var p=[t,e],m=[],v=0,y=0;v<2&&m.length<2;v+=0===y?0:1,y^=1){var b=E.getParameterOf(p[1^v],new l(p[v][0===y?0:6],p[v][0===y?1:7]));if(null!=b){var _=0===v?[y,b]:[b,y];(0===m.length||n(_[0]-m[0][0])>r&&n(_[1]-m[0][1])>r)&&m.push(_)}if(1===v&&0===m.length)break}if(2!==m.length)m=null;else if(!h){var w=E.getPart(t,m[0][0],m[1][0]),x=E.getPart(e,m[0][1],m[1][1]);(n(x[2]-w[2])>o||n(x[3]-w[3])>o||n(x[4]-w[4])>o||n(x[5]-w[5])>o)&&(m=null)}return m}}}}),P=e.extend({_class:"CurveLocation",beans:!0,initialize:function t(e,i,n,r,o){if(i>.9999996){var s=e.getNext();s&&(i=0,e=s)}this._id=a.get(t),this._setCurve(e),this._parameter=i,this._point=n||e.getPointAt(i,!0),this._overlap=r,this._distance=o,this._intersection=this._next=this._prev=null},_setCurve:function(t){var e=t._path;this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._parameter=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this.getCurve(),e=this._segment;if(!e){var i=this.getParameter();0===i?e=t._segment1:1===i?e=t._segment2:null!=i&&(e=t.getPartLength(0,i)<t.getPartLength(i,1)?t._segment1:t._segment2),this._segment=e}return e},getCurve:function(){function t(t){var e=t&&t.getCurve();if(e&&null!=(n._parameter=e.getParameterOf(n._point)))return n._setCurve(e),n._segment=t,e}var e=this._curve,i=e&&e._path,n=this;return i&&i._version!==this._version&&(e=this._parameter=this._curve=this._offset=null),e||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getParameter:function(){var t=this.getCurve(),e=this._parameter;return t&&null==e?this._parameter=t.getParameterOf(this._point):e},getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this.getCurve(),e=this.getParameter();return null!=e&&t&&t.getPartLength(0,e)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=null;return t&&(e=t.divide(this.getParameter(),!0))&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve();return t?t.split(this.getParameter(),!0):null},equals:function(t,e){var i=this===t,n=2e-7;if(!i&&t instanceof P&&this.getPath()===t.getPath()&&this.getPoint().isClose(t.getPoint(),n)){var r=this.getCurve(),o=t.getCurve(),s=Math.abs,a=s((r.isLast()&&o.isFirst()?-1:r.getIndex())+this.getParameter()-((o.isLast()&&r.isFirst()?-1:o.getIndex())+t.getParameter()));i=(a<4e-7||(a=s(this.getOffset()-t.getOffset()))<n||s(this.getPath().getLength()-a)<n)&&(e||!this._intersection&&!t._intersection||this._intersection&&this._intersection.equals(t._intersection,!0))}return i},toString:function(){var t=[],e=this.getPoint(),i=o.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getParameter();return null!=r&&t.push("parameter: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){function t(t,e,i){return e<i?t>e&&t<i:t>e&&t<=c||t>=-c&&t<i}var e=this._intersection;if(!e)return!1;var i=this.getParameter(),n=e.getParameter(),r=4e-7,o=1-r;if(i>=r&&i<=o||n>=r&&n<=o)return!this.isTouching();var s=this.getCurve(),a=s.getPrevious(),l=e.getCurve(),h=l.getPrevious(),c=Math.PI;if(!a||!h)return!1;var u=a.getTangentAt(o,!0).negate().getAngleInRadians(),d=s.getTangentAt(r,!0).getAngleInRadians(),f=h.getTangentAt(o,!0).negate().getAngleInRadians(),p=l.getTangentAt(r,!0).getAngleInRadians();return t(f,u,d)^t(p,u,d)&&t(f,d,u)^t(p,d,u)},isOverlap:function(){return!!this._overlap}},e.each(E.evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getParameter(),i=this.getCurve();return null!=t&&i&&i[e](t,!0)}},{preserve:!0}),new function(){function t(t,e,i){function n(i,n){for(var o=i+n;o>=-1&&o<=r;o+=n){var s=t[(o%r+r)%r];if(!e.getPoint().isClose(s.getPoint(),2e-7))break;if(e.equals(s))return s}return null}for(var r=t.length,o=0,s=r-1;o<=s;){var a,l=o+s>>>1,h=t[l];if(i&&(a=e.equals(h)?h:n(l,-1)||n(l,1)))return e._overlap&&(a._overlap=a._intersection._overlap=!0),a;var c=e.getPath(),u=h.getPath()
;(c===u?e.getIndex()+e.getParameter()-(h.getIndex()+h.getParameter()):c._id-u._id)<0?s=l-1:o=l+1}return t.splice(o,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=0,r=e.length;n<r;n++)t(i,e[n]._intersection,!1);return i}}}}),D=y.extend({_class:"PathItem",initialize:function(){},getIntersections:function(t,e,i,n){var r=this===t||!t,o=this._matrix.orNullIfIdentity(),s=r?o:(i||t._matrix).orNullIfIdentity();if(!r&&!this.getBounds(o).touches(t.getBounds(s)))return[];for(var a,t,l=this.getCurves(),h=r?l:t.getCurves(),c=l.length,u=r?c:h.length,d=[],f=[],p=0;p<u;p++)d[p]=h[p].getValues(s);for(var p=0;p<c;p++){var g=l[p],m=r?d[p]:g.getValues(o),v=g.getPath();v!==t&&(t=v,a=[],f.push(a)),r&&E._getSelfIntersection(m,g,a,{include:e,startConnected:1===c&&g.getPoint1().equals(g.getPoint2())});for(var y=r?p+1:0;y<u;y++){if(n&&a.length)return a;var b=h[y];E._getIntersections(m,d[y],g,b,a,{include:e,startConnected:r&&g.getPrevious()===b,endConnected:r&&g.getNext()===b})}}a=[];for(var p=0,_=f.length;p<_;p++)a.push.apply(a,f[p]);return a},getCrossings:function(t){return this.getIntersections(t,function(t){return t.isCrossing()})},_asPathItem:function(){return this},setPathData:function(t){function e(t,e){var i=+n[t];return a&&(i+=h[e]),i}function i(t){return new l(e(t,"x"),e(t+1,"y"))}var n,r,o,s=t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),a=!1,h=new l,u=new l;this.clear();for(var d=0,f=s&&s.length;d<f;d++){var p=s[d],g=p[0],m=g.toLowerCase();n=p.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var v=n&&n.length;switch(a=g===m,"z"!==r||/[mz]/.test(m)||this.moveTo(h=u),m){case"m":case"l":for(var y="m"===m,b=0;b<v;b+=2)this[0===b&&y?"moveTo":"lineTo"](h=i(b));o=h,y&&(u=h);break;case"h":case"v":for(var _="h"===m?"x":"y",b=0;b<v;b++)h[_]=e(b,_),this.lineTo(h);o=h;break;case"c":for(var b=0;b<v;b+=6)this.cubicCurveTo(i(b),o=i(b+2),h=i(b+4));break;case"s":for(var b=0;b<v;b+=4)this.cubicCurveTo(/[cs]/.test(r)?h.multiply(2).subtract(o):h,o=i(b),h=i(b+2)),r=m;break;case"q":for(var b=0;b<v;b+=4)this.quadraticCurveTo(o=i(b),h=i(b+2));break;case"t":for(var b=0;b<v;b+=2)this.quadraticCurveTo(o=/[qt]/.test(r)?h.multiply(2).subtract(o):h,h=i(b)),r=m;break;case"a":for(var b=0;b<v;b+=7)this.arcTo(h=i(b+5),new c(+n[b],+n[b+1]),+n[b+2],+n[b+4],+n[b+3]);break;case"z":this.closePath(!0)}r=m}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=this._getWinding(t,!1,!0);return!!("evenodd"===this.getWindingRule()?1&e:e)}}),I=D.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(e){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(e)?"object"==typeof e[0]?e:arguments:!e||e.size!==t||e.x===t&&e.point===t?null:arguments;i&&i.length>0?this.setSegments(i):(this._curves=t,this._selectedSegmentState=0,i||"string"!=typeof e||(this.setPathData(e),e=null)),this._initialize(!i&&e)},_equals:function(t){return this._closed===t._closed&&e.equals(this._segments,t._segments)},clone:function(e){var i=new I(y.NO_INSERT);return i.setSegments(this._segments),i._closed=this._closed,this._clockwise!==t&&(i._clockwise=this._clockwise),this._clone(i,e)},_changed:function e(i){if(e.base.call(this,i),8&i){var n=this._parent;if(n&&(n._currentPath=t),this._length=this._area=this._clockwise=this._monoCurves=t,16&i)this._version++;else if(this._curves)for(var r=0,o=this._curves.length;r<o;r++)this._curves[r]._changed()}else 32&i&&(this._bounds=t)},getStyle:function(){var t=this._parent;return(t instanceof N?t:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var i=this.isFullySelected();this._segments.length=0,this._selectedSegmentState=0,this._curves=t,e&&e.length>0&&this._add(T.readAll(e)),i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new E(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new E(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){function i(e,i){e._transformCoordinates(t,g,!1),n=g[0],r=g[1],m?(v.push("M"+p.pair(n,r)),m=!1):(l=g[2],h=g[3],l===n&&h===r&&c===s&&u===a?i||v.push("l"+p.pair(n-s,r-a)):v.push("c"+p.pair(c-s,u-a)+" "+p.pair(l-s,h-a)+" "+p.pair(n-s,r-a))),s=n,a=r,c=g[4],u=g[5]}var n,r,s,a,l,h,c,u,d=this._segments,f=d.length,p=new o(e),g=new Array(6),m=!0,v=[];if(0===f)return"";for(var y=0;y<f;y++)i(d[y]);return this._closed&&f>0&&(i(d[0],!0),v.push("z")),v.join("")}},{isEmpty:function(){return 0===this._segments.length},_transformContent:function(t){for(var e=new Array(6),i=0,n=this._segments.length;i<n;i++)this._segments[i]._transformCoordinates(t,e,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,o=null==e,e=o?i.length:e,s=0;s<r;s++){var a=t[s];a._path&&(a=t[s]=a.clone()),a._path=this,a._index=e+s,a._selectionState&&this._updateSelection(a,0,a._selectionState)}if(o)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));for(var s=e+r,l=i.length;s<l;s++)i[s]._index=s}if(n){var h=this._countCurves(),c=e+r-1===h?e-1:e,u=c,d=Math.min(c+r,h);t._curves&&(n.splice.apply(n,[c,0].concat(t._curves)),u+=t._curves.length);for(var s=u;s<d;s++)n.splice(s,0,new E(this,null,null));this._adjustCurves(c,d)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,o=t;o<e;o++)i=r[o],i._path=this,i._segment1=n[o],i._segment2=n[o+1]||n[0],i._changed();(i=r[this._closed&&0===t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(T.readAll(arguments)):this._add([T.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(T.readAll(arguments,1),t):this._add([T.read(arguments,1)],t)[0]},addSegment:function(){return this._add([T.read(arguments)])[0]},insertSegment:function(t){return this._add([T.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(T.readAll(t))},insertSegments:function(t,e){return this._add(T.readAll(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,i,n){t=t||0,i=e.pick(i,this._segments.length);var r=this._segments,o=this._curves,s=r.length,a=r.splice(t,i-t),l=a.length;if(!l)return a;for(var h=0;h<l;h++){var c=a[h];c._selectionState&&this._updateSelection(c,c._selectionState,0),c._index=c._path=null}for(var h=t,u=r.length;h<u;h++)r[h]._index=h;if(o){var d=t>0&&i===s+(this._closed?1:0)?t-1:t,o=o.splice(d,l);n&&(a._curves=o.slice(1)),this._adjustCurves(d,d)}return this._changed(25),a},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){if(null==this._area){for(var t=this._segments,e=t.length,i=e-1,n=0,r=0,o=this._closed?e:i;r<o;r++)n+=E.getArea(E.getValues(t[r],t[r<i?r+1:0]));this._area=n}return this._area},isClockwise:function(){return this._clockwise!==t?this._clockwise:this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse(),this._clockwise=t},isFullySelected:function(){var t=this._segments.length;return this._selected&&t>0&&this._selectedSegmentState===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelected:function t(e){e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments.length;this._selectedSegmentState=t?7*e:0;for(var i=0;i<e;i++)this._segments[i]._selectionState=t?7:0},_updateSelection:function(t,e,i){t._selectionState=i,(this._selectedSegmentState+=i-e)>0&&this.setSelected(!0)},flatten:function(t){for(var e=new M(this,64,.1),i=0,n=e.length/Math.ceil(e.length/t),r=e.length+(this._closed?-n:n)/2,o=[];i<=r;)o.push(new T(e.getPointAt(i))),i+=n;this.setSegments(o)},reduce:function(){for(var t=this.getCurves(),e=t.length-1;e>=0;e--){var i=t[e];i.hasHandles()||0!==i.getLength()&&!i.isCollinear(i.getNext())||i.remove()}return this},simplify:function(t){if(this._segments.length>2){var e=new L(this,t||2.5);this.setSegments(e.fit())}},split:function(t,e){if(null===e)return null;if(1===arguments.length){var i=t;if("number"==typeof i&&(i=this.getLocationAt(i)),!i)return null;t=i.index,e=i.parameter}var n=4e-7;e>=1-n&&(t++,e--);var r=this.getCurves();if(t>=0&&t<r.length){e>=n&&r[t++].divide(e,!0);var o,s=this.removeSegments(t,this._segments.length,!0);return this._closed?(this.setClosed(!1),o=this):(o=new I(y.NO_INSERT),o.insertAbove(this,!0),this._clone(o)),o._add(s,0),this.addSegment(s[0]),o}return null},reverse:function(){this._segments.reverse();for(var e=0,i=this._segments.length;e<i;e++){var n=this._segments[e],r=n._handleIn;n._handleIn=n._handleOut,n._handleOut=r,n._index=e}this._curves=null,this._clockwise!==t&&(this._clockwise=!this._clockwise),this._changed(9)},join:function(t){if(t){var e=t._segments,i=this.getLastSegment(),n=t.getLastSegment();if(!n)return this;i&&i._point.equals(n._point)&&t.reverse();var r=t.getFirstSegment();if(i&&i._point.equals(r._point))i.setHandleOut(r._handleOut),this._add(e.slice(1));else{var o=this.getFirstSegment();o&&o._point.equals(r._point)&&t.reverse(),n=t.getLastSegment(),o&&o._point.equals(n._point)?(o.setHandleIn(n._handleIn),this._add(e.slice(0,e.length-1),0)):this._add(e.slice())}t._closed&&this._add([e[0]]),t.remove()}var s=this.getFirstSegment(),a=this.getLastSegment();return s!==a&&s._point.equals(a._point)&&(s.setHandleIn(a._handleIn),a.remove(),this.setClosed(!0)),this},toShape:function(t){function e(t,e){var i=u[t],n=i.getNext(),r=u[e],o=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&o._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(o._point.subtract(r._point))}function i(t){var e=u[t],i=e.getPrevious(),n=e.getNext();return i._handleOut.isZero()&&e._handleIn.isZero()&&e._handleOut.isZero()&&n._handleIn.isZero()&&e._point.subtract(i._point).isOrthogonal(n._point.subtract(e._point))}function n(t){var e=u[t],i=e.getNext(),n=e._handleOut,r=i._handleIn,o=.5522847498307936;if(n.isOrthogonal(r)){var a=e._point,l=i._point,h=new g(a,n,!0).intersect(new g(l,r,!0),!0);return h&&s.isZero(n.getLength()/h.subtract(a).getLength()-o)&&s.isZero(r.getLength()/h.subtract(l).getLength()-o)}return!1}function r(t,e){return u[t]._point.getDistance(u[e]._point)}if(!this._closed)return null;var o,a,l,h,u=this._segments;if(!this.hasHandles()&&4===u.length&&e(0,2)&&e(1,3)&&i(1)?(o=w.Rectangle,a=new c(r(0,3),r(0,1)),h=u[1]._point.add(u[2]._point).divide(2)):8===u.length&&n(0)&&n(2)&&n(4)&&n(6)&&e(1,5)&&e(3,7)?(o=w.Rectangle,a=new c(r(1,6),r(0,3)),l=a.subtract(new c(r(0,7),r(1,2))).divide(2),h=u[3]._point.add(u[4]._point).divide(2)):4===u.length&&n(0)&&n(1)&&n(2)&&n(3)&&(s.isZero(r(0,2)-r(1,3))?(o=w.Circle,l=r(0,2)/2):(o=w.Ellipse,l=new c(r(2,0)/2,r(3,1)/2)),h=u[1]._point),o){var d=this.getPosition(!0),f=this._clone(new o({center:d,size:a,radius:l,insert:!1}),t,!1);return f.rotate(h.subtract(d).getAngle()+90),f}return null},_hitTestSelf:function(t,e){function i(e,i){return t.subtract(e).divide(i).length<=1}function n(t,n,r){if(!e.selected||n.isSelected()){var o=t._point;if(n!==o&&(n=n.add(o)),i(n,_))return new S(r,p,{segment:t,point:n})}}function r(t,i){return(i||e.segments)&&n(t,t._point,"segment")||!i&&e.handles&&(n(t,t._handleIn,"handle-in")||n(t,t._handleOut,"handle-out"))}function o(t){u.add(t)}function s(e){if(("round"!==a||"round"!==h)&&(u=new I({internal:!0,closed:!0}),y||e._index>0&&e._index<v-1?"round"!==a&&(e._handleIn.isZero()||e._handleOut.isZero())&&I._addBevelJoin(e,a,T,c,o,!0):"round"!==h&&I._addSquareCap(e,h,T,o,!0),!u.isEmpty())){var n;return u.contains(t)||(n=u.getNearestLocation(t))&&i(n.getPoint(),b)}return i(e._point,_)}var a,h,c,u,d,f,p=this,g=this.getStyle(),m=this._segments,v=m.length,y=this._closed,b=e._tolerancePadding,_=b,w=e.stroke&&g.hasStroke(),x=e.fill&&g.hasFill(),C=e.curves,T=w?g.getStrokeWidth()/2:x&&e.tolerance>0||C?0:null;if(null!==T&&(T>0?(a=g.getStrokeJoin(),h=g.getStrokeCap(),c=T*g.getMiterLimit(),_=b.add(new l(T,T))):a=h="round"),!e.ends||e.segments||y){if(e.segments||e.handles)for(var k=0;k<v;k++)if(f=r(m[k]))return f}else if(f=r(m[0],!0)||r(m[v-1],!0))return f;if(null!==T){if(d=this.getNearestLocation(t)){var E=d.getParameter();0===E||1===E&&v>1?s(d.getSegment())||(d=null):i(d.getPoint(),_)||(d=null)}if(!d&&"miter"===a&&v>1)for(var k=0;k<v;k++){var P=m[k];if(t.getDistance(P._point)<=c&&s(P)){d=P.getLocation();break}}}return!d&&x&&this._contains(t)||d&&!w&&!C?new S("fill",this):d?new S(w?"stroke":"curve",this,{location:d,point:d.getPoint()}):null}},e.each(E.evaluateMethods,function(t){this[t+"At"]=function(e,i){var n=this.getLocationAt(e,i);return n&&n[t]()}},{beans:!1,getLocationOf:function(){for(var t=l.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t,e){var i=this.getCurves(),n=0;if(e){var r=~~t,o=i[r];return o?o.getLocationAt(t-r,!0):null}for(var s=0,a=i.length;s<a;s++){var l=n,o=i[s];if((n+=o.getLength())>t)return o.getLocationAt(t-l)}return i.length>0&&t<=this.getLength()?new P(i[i.length-1],1):null},getNearestLocation:function(){for(var t=l.read(arguments),e=this.getCurves(),i=Infinity,n=null,r=0,o=e.length;r<o;r++){var s=e[r].getNearestLocation(t);s._distance<i&&(i=s._distance,n=s)}return n},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function t(t,e,i,n){function r(e){var i=s[e],n=s[e+1];u==i&&d==n||(t.beginPath(),t.moveTo(u,d),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,o,0,2*Math.PI,!0),t.fill())}for(var o=n/2,s=new Array(6),a=0,l=e.length;a<l;a++){var h=e[a];h._transformCoordinates(i,s,!1);var c=h._selectionState,u=s[0],d=s[1];if(1&c&&r(2),2&c&&r(4),t.fillRect(u-o,d-o,n,n),!(4&c)){var f=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(u-o+1,d-o+1,n-2,n-2),t.fillStyle=f}}}function e(t,e,i){function n(e){if(i)e._transformCoordinates(i,p,!1),r=p[0],o=p[1];else{var n=e._point;r=n._x,o=n._y}if(g)t.moveTo(r,o),g=!1;else{if(i)l=p[2],h=p[3];else{var d=e._handleIn;l=r+d._x,h=o+d._y}l===r&&h===o&&c===s&&u===a?t.lineTo(r,o):t.bezierCurveTo(c,u,l,h,r,o)}if(s=r,a=o,i)c=p[4],u=p[5];else{var d=e._handleOut;c=s+d._x,u=a+d._y}}for(var r,o,s,a,l,h,c,u,d=e._segments,f=d.length,p=new Array(6),g=!0,m=0;m<f;m++)n(d[m]);e._closed&&f>0&&n(d[0])}return{_draw:function(t,i,n){function r(t){return c[(t%u+u)%u]}var o=i.dontStart,s=i.dontFinish||i.clip,a=this.getStyle(),l=a.hasFill(),h=a.hasStroke(),c=a.getDashArray(),u=!paper.support.nativeDash&&h&&c&&c.length;if(o||t.beginPath(),!o&&this._currentPath?t.currentPath=this._currentPath:(l||h&&!u||s)&&(e(t,this,n),this._closed&&t.closePath(),o||(this._currentPath=t.currentPath)),!s&&(l||h)&&(this._setStyles(t),l&&(t.fill(a.getWindingRule()),t.shadowColor="rgba(0,0,0,0)"),h)){if(u){o||t.beginPath();var d,f=new M(this,32,.25,n),p=f.length,g=-a.getDashOffset(),m=0;for(g%=p;g>0;)g-=r(m--)+r(m--);for(;g<p;)d=g+r(m++),(g>0||d>0)&&f.drawPart(t,Math.max(g,0),Math.max(d,0)),g=d+r(m++)}t.stroke()}},_drawSelected:function(i,n){i.beginPath(),e(i,this,n),i.stroke(),t(i,this._segments,n,paper.settings.handleSize)}}},new function(){function t(t){var e=t.length,i=[],n=[],r=2;i[0]=t[0]/r;for(var o=1;o<e;o++)n[o]=1/r,r=(o<e-1?4:2)-n[o],i[o]=(t[o]-i[o-1])/r;for(var o=1;o<e;o++)i[e-o-1]-=n[e-o]*i[e-o];return i}return{smooth:function(){var e=this._segments,i=e.length,n=this._closed,r=i,o=0;if(!(i<=2)){n&&(o=Math.min(i,4),r+=2*Math.min(i,o));for(var s=[],a=0;a<i;a++)s[a+o]=e[a]._point;if(n)for(var a=0;a<o;a++)s[a]=e[a+i-o]._point,s[a+i+o]=e[a]._point;else r--;for(var h=[],a=1;a<r-1;a++)h[a]=4*s[a]._x+2*s[a+1]._x;h[0]=s[0]._x+2*s[1]._x,h[r-1]=3*s[r-1]._x;for(var c=t(h),a=1;a<r-1;a++)h[a]=4*s[a]._y+2*s[a+1]._y;h[0]=s[0]._y+2*s[1]._y,h[r-1]=3*s[r-1]._y;var u=t(h);if(n){for(var a=0,d=i;a<o;a++,d++){var f=a/o,p=1-f,g=a+o,m=d+o;c[d]=c[a]*f+c[d]*p,u[d]=u[a]*f+u[d]*p,c[m]=c[g]*p+c[m]*f,u[m]=u[g]*p+u[m]*f}r--}for(var v=null,a=o;a<=r-o;a++){var y=e[a-o];v&&y.setHandleIn(v.subtract(y._point)),a<r&&(y.setHandleOut(new l(c[a],u[a]).subtract(y._point)),v=a<r-1?new l(2*s[a+1]._x-c[a+1],2*s[a+1]._y-u[a+1]):new l((s[r]._x+c[r-1])/2,(s[r]._y+u[r-1])/2))}if(n&&v){var y=this._segments[0];y.setHandleIn(v.subtract(y._point))}}}}},new function(){function t(t){var e=t._segments;if(0===e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new T(l.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new T(l.read(arguments))])},cubicCurveTo:function(){var e=l.read(arguments),i=l.read(arguments),n=l.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new T(n,i.subtract(n))])},quadraticCurveTo:function(){var e=l.read(arguments),i=l.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var i=l.read(arguments),n=l.read(arguments),r=e.pick(e.read(arguments),.5),o=1-r,s=t(this)._point,a=i.subtract(s.multiply(o*o)).subtract(n.multiply(r*r)).divide(2*r*o);if(a.isNaN())throw new Error("Cannot put a curve through points with parameter = "+r);this.quadraticCurveTo(a,n)},arcTo:function(){var i,n,r,o,s,a=t(this),h=a._point,u=l.read(arguments),d=e.peek(arguments),f=e.pick(d,!0);if("boolean"==typeof f)var m=h.add(u).divide(2),i=m.add(m.subtract(h).rotate(f?-90:90));else if(e.remain(arguments)<=2)i=u,u=l.read(arguments);else{var v=c.read(arguments);if(v.isZero())return this.lineTo(u);var y=e.read(arguments),f=!!e.read(arguments),b=!!e.read(arguments),m=h.add(u).divide(2),_=h.subtract(m).rotate(-y),w=_.x,x=_.y,C=Math.abs,S=C(v.width),k=C(v.height),E=S*S,P=k*k,D=w*w,I=x*x,N=Math.sqrt(D/E+I/P);if(N>1&&(S*=N,k*=N,E=S*S,P=k*k),N=(E*P-E*I-P*D)/(E*I+P*D),C(N)<1e-12&&(N=0),N<0)throw new Error("Cannot create an arc with the given arguments");n=new l(S*x/k,-k*w/S).multiply((b===f?-1:1)*Math.sqrt(N)).rotate(y).add(m),s=(new p).translate(n).rotate(y).scale(S,k),o=s._inverseTransform(h),r=o.getDirectedAngle(s._inverseTransform(u)),!f&&r>0?r-=360:f&&r<0&&(r+=360)}if(i){var M=new g(h.add(i).divide(2),i.subtract(h).rotate(90),!0),L=new g(i.add(u).divide(2),u.subtract(i).rotate(90),!0),A=new g(h,u),R=A.getSide(i);if(!(n=M.intersect(L,!0))){if(!R)return this.lineTo(u);throw new Error("Cannot create an arc with the given arguments")}o=h.subtract(n),r=o.getDirectedAngle(u.subtract(n));var O=A.getSide(n);0===O?r=R*Math.abs(r):R===O&&(r+=r<0?360:-360)}for(var z=Math.abs(r),H=z>=360?4:Math.ceil(z/90),F=r/H,B=F*Math.PI/360,$=4/3*Math.sin(B)/(1+Math.cos(B)),j=[],W=0;W<=H;W++){var _=u,q=null;if(W<H&&(q=o.rotate(90).multiply($),s?(_=s._transformPoint(o),q=s._transformPoint(o.add(q)).subtract(_)):_=n.add(o)),0===W)a.setHandleOut(q);else{var U=o.rotate(-90).multiply($);s&&(U=s._transformPoint(o.add(U)).subtract(_)),j.push(new T(_,U,q))}o=o.rotate(F)}this._add(j)},lineBy:function(){var e=l.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var i=l.read(arguments),n=l.read(arguments),r=e.read(arguments),o=t(this)._point;this.curveTo(o.add(i),o.add(n),r)},cubicCurveBy:function(){var e=l.read(arguments),i=l.read(arguments),n=l.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=l.read(arguments),i=l.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var i=t(this)._point,n=i.add(l.read(arguments)),r=e.pick(e.peek(arguments),!0);"boolean"==typeof r?this.arcTo(n,r):this.arcTo(n,i.add(l.read(arguments)))},closePath:function(t){this.setClosed(!0),t&&this.join()}}},{_getBounds:function(t,e){return I[t](this._segments,this._closed,this.getStyle(),e)},statics:{getBounds:function(t,e,i,n,r){function o(t){t._transformCoordinates(n,a,!1);for(var e=0;e<2;e++)E._addBounds(l[e],l[e+4],a[e+2],a[e],e,r?r[e]:0,h,c,u);var i=l;l=a,a=i}var s=t[0];if(!s)return new d;for(var a=new Array(6),l=s._transformCoordinates(n,new Array(6),!1),h=l.slice(0,2),c=h.slice(),u=new Array(2),f=1,p=t.length;f<p;f++)o(t[f]);return e&&o(s),new d(h[0],h[1],c[0]-h[0],c[1]-h[1])},getStrokeBounds:function(t,e,i,n){function r(t){f=f.include(n?n._transformPoint(t,t):t)}function o(t){f=f.unite(v.setCenter(n?n._transformPoint(t._point):t._point))}function s(t,e){var i=t._handleIn,n=t._handleOut;"round"===e||!i.isZero()&&!n.isZero()&&i.isCollinear(n)?o(t):I._addBevelJoin(t,e,h,m,r)}function a(t,e){"round"===e?o(t):I._addSquareCap(t,e,h,r)}if(!i.hasStroke())return I.getBounds(t,e,i,n);for(var l=t.length-(e?0:1),h=i.getStrokeWidth()/2,u=I._getPenPadding(h,n),f=I.getBounds(t,e,i,n,u),p=i.getStrokeJoin(),g=i.getStrokeCap(),m=h*i.getMiterLimit(),v=new d(new c(u).multiply(2)),y=1;y<l;y++)s(t[y],p);return e?s(t[0],p):l>0&&(a(t[0],g),a(t[t.length-1],g)),f},_getPenPadding:function(t,e){if(!e)return[t,t];var i=e.shiftless(),n=i.transform(new l(t,0)),r=i.transform(new l(0,t)),o=n.getAngleInRadians(),s=n.getLength(),a=r.getLength(),h=Math.sin(o),c=Math.cos(o),u=Math.tan(o),d=-Math.atan(a*u/s),f=Math.atan(a/(u*s));return[Math.abs(s*Math.cos(d)*c-a*Math.sin(d)*h),Math.abs(a*Math.sin(f)*c+s*Math.cos(f)*h)]},_addBevelJoin:function(t,e,i,n,r,o){var s=t.getCurve(),a=s.getPrevious(),h=s.getPointAt(0,!0),c=a.getNormalAt(1,!0),u=s.getNormalAt(0,!0),d=c.getDirectedAngle(u)<0?-i:i;if(c.setLength(d),u.setLength(d),o&&(r(h),r(h.add(c))),"miter"===e){var f=new g(h.add(c),new l(-c.y,c.x),!0).intersect(new g(h.add(u),new l(-u.y,u.x),!0),!0);if(f&&h.getDistance(f)<=n&&(r(f),!o))return}o||r(h.add(c)),r(h.add(u))},_addSquareCap:function(t,e,i,n,r){var o=t._point,s=t.getLocation(),a=s.getNormal().multiply(i);r&&(n(o.subtract(a)),n(o.add(a))),"square"===e&&(o=o.add(a.rotate(0===s.getParameter()?-90:90))),n(o.add(a)),n(o.subtract(a))},getHandleBounds:function(t,e,i,n,r,o){for(var s=new Array(6),a=Infinity,l=-a,h=a,c=l,u=0,f=t.length;u<f;u++){t[u]._transformCoordinates(n,s,!1);for(var p=0;p<6;p+=2){var g=0===p?o:r,m=g?g[0]:0,v=g?g[1]:0,y=s[p],b=s[p+1],_=y-m,w=y+m,x=b-v,C=b+v;_<a&&(a=_),w>l&&(l=w),x<h&&(h=x),C>c&&(c=C)}}return new d(a,h,l-a,c-h)},getRoughBounds:function(t,e,i,n){var r=i.hasStroke()?i.getStrokeWidth()/2:0,o=r;return r>0&&("miter"===i.getStrokeJoin()&&(o=r*i.getMiterLimit()),"square"===i.getStrokeCap()&&(o=Math.max(o,r*Math.sqrt(2)))),I.getHandleBounds(t,e,i,n,I._getPenPadding(r,n),I._getPenPadding(o,n))}}});I.inject({statics:new function(){function t(t,i,n){var r=e.getNamed(n),o=new I(r&&!1===r.insert&&y.NO_INSERT);return o._add(t),o._closed=i,o.set(r)}function i(e,i,n){for(var o=new Array(4),s=0;s<4;s++){var a=r[s];o[s]=new T(a._point.multiply(i).add(e),a._handleIn.multiply(i),a._handleOut.multiply(i))}return t(o,!0,n)}var n=.5522847498307936,r=[new T([-1,0],[0,n],[0,-n]),new T([0,-1],[-n,0],[n,0]),new T([1,0],[0,-n],[0,n]),new T([0,1],[n,0],[-n,0])];return{Line:function(){return t([new T(l.readNamed(arguments,"from")),new T(l.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=l.readNamed(arguments,"center"),n=e.readNamed(arguments,"radius");return i(t,new c(n),arguments)},Rectangle:function(){var e,i=d.readNamed(arguments,"rectangle"),r=c.readNamed(arguments,"radius",0,{readNull:!0}),o=i.getBottomLeft(!0),s=i.getTopLeft(!0),a=i.getTopRight(!0),l=i.getBottomRight(!0);if(!r||r.isZero())e=[new T(o),new T(s),new T(a),new T(l)];else{r=c.min(r,i.getSize(!0).divide(2));var h=r.width,u=r.height,f=h*n,p=u*n;e=[new T(o.add(h,0),null,[-f,0]),new T(o.subtract(0,u),[0,p]),new T(s.add(0,u),null,[0,-p]),new T(s.add(h,0),[-f,0],null),new T(a.subtract(h,0),null,[f,0]),new T(a.add(0,u),[0,-p],null),new T(l.subtract(0,u),null,[0,p]),new T(l.subtract(h,0),[f,0])]}return t(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=w._readEllipse(arguments);return i(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=l.readNamed(arguments,"from"),i=l.readNamed(arguments,"through"),n=l.readNamed(arguments,"to"),r=e.getNamed(arguments),o=new I(r&&!1===r.insert&&y.NO_INSERT);return o.moveTo(t),o.arcTo(i,n),o.set(r)},RegularPolygon:function(){for(var i=l.readNamed(arguments,"center"),n=e.readNamed(arguments,"sides"),r=e.readNamed(arguments,"radius"),o=360/n,s=!(n%3),a=new l(0,s?-r:r),h=s?-1:.5,c=new Array(n),u=0;u<n;u++)c[u]=new T(i.add(a.rotate((u+h)*o)));return t(c,!0,arguments)},Star:function(){for(var i=l.readNamed(arguments,"center"),n=2*e.readNamed(arguments,"points"),r=e.readNamed(arguments,"radius1"),o=e.readNamed(arguments,"radius2"),s=360/n,a=new l(0,-1),h=new Array(n),c=0;c<n;c++)h[c]=new T(i.add(a.rotate(s*c).multiply(c%2?o:r)));return t(h,!0,arguments)}}}});var N=D.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function e(i,n,r){for(var o=n.length-1;o>=0;o--){var s=n[o];s instanceof N&&(n.splice.apply(n,[o,1].concat(s.removeChildren())),s.remove())}n=e.base.call(this,i,n,r,I);for(var o=0,a=!r&&n&&n.length;o<a;o++){var s=n[o];s._clockwise===t&&s.setClockwise(0===s._index)}return n},reverse:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].reverse()},smooth:function(){for(var t=0,e=this._children.length;t<e;t++)this._children[t].smooth()},reduce:function t(){for(var e=this._children,i=e.length-1;i>=0;i--){var n=e[i].reduce();n.isEmpty()&&e.splice(i,1)}if(0===e.length){var n=new I(y.NO_INSERT);return n.insertAbove(this),n.setStyle(this._style),this.remove(),n}return t.base.call(this)},isClockwise:function(){var t=this.getFirstChild();return t&&t.isClockwise()},setClockwise:function(t){this.isClockwise()!==!!t&&this.reverse()},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getFirstCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e}},{beans:!0,getPathData:function(t,e){for(var i=this._children,n=[],r=0,o=i.length;r<o;r++){var s=i[r],a=s._matrix;n.push(s.getPathData(t&&!a.isIdentity()?t.chain(a):t,e))}return n.join(" ")}},{_getChildHitTestOptions:function(t){return t["class"]===I||"path"===t.type?t:new e(t,{fill:!1})},_draw:function(t,e,i){var n=this._children;if(0!==n.length){if(this._currentPath)t.currentPath=this._currentPath;else{e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var r=0,o=n.length;r<o;r++)n[r].draw(t,e,i);this._currentPath=t.currentPath}if(!e.clip){this._setStyles(t);var s=this._style;s.hasFill()&&(t.fill(s.getWindingRule()),t.shadowColor="rgba(0,0,0,0)"),s.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,o=n.length;r<o;r++){var s=n[r],a=s._matrix;i[s._id]||s._drawSelected(t,a.isIdentity()?e:e.chain(a))}}},new function(){function t(t,e){var i=t._children;if(e&&0===i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}var i={moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new I(y.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=l.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}};return e.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){i[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}}),i});D.inject(new function(){function t(t,e){var i=t.clone(!1).reduce().transform(null,!0,!0);return e?i.resolveCrossings().reorient():i}function e(t,e,i,n,r){var o=new t(y.NO_INSERT);return o.addChildren(e,!0),r&&(o=o.reduce()),o.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),o.setStyle(i._style),o}function i(i,r,s){function a(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];f.push.apply(f,n._segments),p.push.apply(p,n._getMonoCurves())}}if(!i._children&&!i._closed)return n(i,r,s);var l=t(i,!0),u=r&&i!==r&&t(r,!0);u&&/^(subtract|exclude)$/.test(s)^u.isClockwise()!==l.isClockwise()&&u.reverse();var d=P.expand(l.getIntersections(u,function(t){return u&&t.isOverlap()||t.isCrossing()}));o(d);var f=[],p=[];a(l._children||[l]),u&&a(u._children||[u]);for(var g=0,m=d.length;g<m;g++)h(d[g]._segment,l,u,p,s);for(var g=0,m=f.length;g<m;g++){var v=f[g];null==v._winding&&h(v,l,u,p,s)}return e(N,c(f,s),i,r,!0)}function n(i,n,r){function o(t){if(a.contains(t.getPointAt(t.getLength()/2))^h)return c.unshift(t),!0}if(!n||!n._children&&!n._closed||!/^(subtract|intersect)$/.test(r))return null;for(var s=t(i,!1),a=t(n,!1),l=s.getIntersections(a,function(t){return t.isOverlap()||t.isCrossing()}),h="subtract"===r,c=[],u=l.length-1;u>=0;u--){var d=l[u].split();d&&(o(d)&&d.getFirstSegment().setHandleIn(0,0),s.getLastSegment().setHandleOut(0,0))}return o(s),e(b,c,i,n)}function r(t,e){for(var i=t;i;){if(i===e)return;i=i._prev}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._prev;)e=e._prev;t._next=e,e._prev=t}}function o(t){for(var e,i,n=4e-7,o=1-n,s=!1,a=[],l=t.length-1;l>=0;l--){var h=t[l],c=h._curve,u=h._parameter,d=u;c!==e?s=!c.hasHandles():i>0&&(u/=i);var f;u<n?f=c._segment1:u>o?f=c._segment2:(f=c.divide(u,!0,!0)._segment1,s&&a.push(f)),h._setSegment(f);var p=f._intersection,g=h._intersection;if(p){r(p,g);for(var m=p;m;)r(m._intersection,p),m=m._next}else f._intersection=g;e=c,i=d}for(var l=0,v=a.length;l<v;l++)a[l].clearHandles()}function a(t,e,i,n){var r=2e-7,o=4e-7,h=1-o,c=t.x,u=t.y,d=0,f=0,p=[],g=Math.abs;if(i){for(var m=-Infinity,v=Infinity,y=u-r,b=u+r,_=0,w=e.length;_<w;_++){var x=e[_].values;if(E.solveCubic(x,0,c,p,0,1)>0)for(var C=p.length-1;C>=0;C--){var S=E.getPoint(x,p[C]).y;S<y&&S>m?m=S:S>b&&S<v&&(v=S)}}m=(m+u)/2,v=(v+u)/2,m>-Infinity&&(d=a(new l(c,m),e,!1,n)),v<Infinity&&(f=a(new l(c,v),e,!1,n))}else for(var T,k,P=c-r,D=c+r,I=!1,_=0,w=e.length;_<w;_++){var N=e[_],x=N.values,M=N.winding;if(M&&(1===M&&u>=x[1]&&u<=x[7]||u>=x[7]&&u<=x[1])&&1===E.solveCubic(x,1,u,p,0,1)){var L=p[0];if(!(L>h&&I&&N.next!==e[_+1]||L<o&&k>h&&N.previous===T)){var A=E.getPoint(x,L).x,R=E.getTangent(x,L).y,O=!1;s.isZero(R)&&!E.isStraight(x)||L<o&&R*E.getTangent(N.previous.values,1).y<0||L>h&&R*E.getTangent(N.next.values,0).y<0?n&&A>=P&&A<=D&&(++d,++f,O=!0):A<=P?(d+=M,O=!0):A>=D&&(f+=M,O=!0),N.previous!==e[_-1]&&(I=L<o&&O)}T=N,k=L}}return Math.max(g(d),g(f))}function h(t,e,i,n,r){var o=2e-7,s=[],l=t,h=0,c=0;do{var u=t.getCurve(),d=u.getLength();s.push({segment:t,curve:u,length:d}),h+=d,t=t.getNext()}while(t&&!t._intersection&&t!==l);for(var f=0;f<3;f++)for(var d=h*(f+1)/4,p=0,g=s.length;p<g;p++){var m=s[p],v=m.length;if(d<=v){(d<o||v-d<o)&&(d=v/2);var u=m.curve,y=u._path,b=y._parent,_=u.getPointAt(d),w=u.isHorizontal();b instanceof N&&(y=b),c+="subtract"===r&&i&&(y===e&&i._getWinding(_,w)||y===i&&!e._getWinding(_,w))?0:a(_,n,w);break}d-=v}for(var x=Math.round(c/3),C=s.length-1;C>=0;C--)s[C].segment._winding=x}function c(t,e){function i(t,e){if(t._visited)return!1;if(!c)return!0;var i=t._winding,n=t._intersection;return n&&e&&d&&n.isOverlap()&&(i=d[i]||i),c(i)}function n(t){return t===a||t===l}function r(t,e){if(!t._next)return t;for(;t;){var r=t._segment,o=r.getNext(),s=o._intersection;if(n(o)||!r._visited&&!o._visited&&(!c||(!e||i(r))&&(!(e&&s&&s.isOverlap())&&i(o)||!e&&s&&i(s._segment))))return t;t=t._next}return null}function o(t,e){for(;t;){var i=t._segment;if(n(i))return i;t=t[e?"_next":"_prev"]}}
for(var a,l,h=[],c=u[e],d={unite:{1:2},intersect:{2:1}}[e],f=0,p=t.length;f<p;f++){var g=t[f],m=null,v=!1;if(i(g,!0)){for(a=l=null;!v;){var b=g._intersection,_=m&&g._handleIn;b=b&&(r(b,!0)||r(b,!1))||b;var w=b&&b._segment;if(w&&i(w)&&(g=w),g._visited){if(!(v=n(g))&&b){var x=o(b,!0)||o(b,!1);x&&(g=x,v=!0)}break}m||(m=new I(y.NO_INSERT),a=g,l=w),m.add(new T(g._point,_,g._handleOut)),g._visited=!0,g=g.getNext(),v=n(g)}v?(m.firstSegment.setHandleIn(g._handleIn),m.setClosed(!0)):m&&(console.error("Boolean operation resulted in open path","segments =",m._segments.length,"length =",m.getLength()),m=null),m&&(m._segments.length>8||!s.isZero(m.getArea()))&&(h.push(m),m=null)}}return h}var u={unite:function(t){return 1===t||0===t},intersect:function(t){return 2===t},subtract:function(t){return 1===t},exclude:function(t){return 1===t}};return{_getWinding:function(t,e,i){return a(t,this._getMonoCurves(),e,i)},unite:function(t){return i(this,t,"unite")},intersect:function(t){return i(this,t,"intersect")},subtract:function(t){return i(this,t,"subtract")},exclude:function(t){return i(this,t,"exclude")},divide:function(t){return e(b,[this.subtract(t),this.intersect(t)],this,t,!0)},resolveCrossings:function(){var t=this.getCrossings();if(!t.length)return this;o(P.expand(t));for(var i=this._children||[this],n=[],r=0,s=i.length;r<s;r++)n.push.apply(n,i[r]._segments);return e(N,c(n),this,null,!1)}}}),I.inject({_getMonoCurves:function(){function t(t){var e=t[1],r=t[7],o={values:t,winding:e===r?0:e>r?-1:1,previous:i,next:null};i&&(i.next=o),n.push(o),i=o}function e(e){if(0!==E.getLength(e)){var i=e[1],n=e[3],r=e[5],o=e[7];if(E.isStraight(e))t(e);else{var a=3*(n-r)-i+o,l=2*(i+r)-4*n,h=n-i,c=4e-7,u=1-c,d=[],f=s.solveQuadratic(a,l,h,d,c,u);if(0===f)t(e);else{d.sort();var p=d[0],g=E.subdivide(e,p);t(g[0]),f>1&&(p=(d[1]-p)/(1-p),g=E.subdivide(g[1],p),t(g[0])),t(g[1])}}}}var i,n=this._monoCurves;if(!n){n=this._monoCurves=[];for(var r=this.getCurves(),o=this._segments,a=0,l=r.length;a<l;a++)e(r[a].getValues());if(!this._closed&&o.length>1){var h=o[o.length-1]._point,c=o[0]._point,u=h._x,d=h._y,f=c._x,p=c._y;e([u,d,u,d,f,p,f,p])}if(n.length>0){var g=n[0],m=n[n.length-1];g.previous=m,m.next=g}}return n},getInteriorPoint:function(){var t=this.getBounds(),e=t.getCenter(!0);if(!this.contains(e)){for(var i=this._getMonoCurves(),n=[],r=e.y,o=[],s=0,a=i.length;s<a;s++){var l=i[s].values;if((1===i[s].winding&&r>=l[1]&&r<=l[7]||r>=l[7]&&r<=l[1])&&E.solveCubic(l,1,r,n,0,1)>0)for(var h=n.length-1;h>=0;h--)o.push(E.getPoint(l,n[h]).x);if(o.length>1)break}e.x=(o[0]+o[1])/2}return e},reorient:function(){return this.setClockwise(!0),this}}),N.inject({_getMonoCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i]._getMonoCurves());return e},reorient:function(){var t=this.removeChildren().sort(function(t,e){return e.getBounds().getArea()-t.getBounds().getArea()});if(t.length>0){this.addChildren(t);for(var e=t[0].isClockwise(),i=1,n=t.length;i<n;i++){for(var r=t[i].getInteriorPoint(),o=0,s=i-1;s>=0;s--)t[s].contains(r)&&o++;t[i].setClockwise(o%2==0&&e)}}return this}});var M=e.extend({_class:"PathIterator",initialize:function(t,e,i,n){function r(t,e){var i=E.getValues(t,e,n);a.push(i),o(i,t._index,0,1)}function o(t,e,n,r){if(r-n>c&&!E.isFlatEnough(t,i||.25)){var s=E.subdivide(t,.5),a=(n+r)/2;o(s[0],e,n,a),o(s[1],e,a,r)}else{var u=t[6]-t[0],d=t[7]-t[1],f=Math.sqrt(u*u+d*d);f>1e-6&&(h+=f,l.push({offset:h,value:r,index:e}))}}for(var s,a=[],l=[],h=0,c=1/(e||32),u=t._segments,d=u[0],f=1,p=u.length;f<p;f++)s=u[f],r(d,s),d=s;t._closed&&r(s,u[0]),this.curves=a,this.parts=l,this.length=h,this.index=0},getParameterAt:function(t){for(var e,i=this.index;e=i,!(0==i||this.parts[--i].offset<t););for(var n=this.parts.length;e<n;e++){var r=this.parts[e];if(r.offset>=t){this.index=e;var o=this.parts[e-1],s=o&&o.index==r.index?o.value:0,a=o?o.offset:0;return{value:s+(r.value-s)*(t-a)/(r.offset-a),index:r.index}}}var r=this.parts[this.parts.length-1];return{value:1,index:r.index}},drawPart:function(t,e,i){e=this.getParameterAt(e),i=this.getParameterAt(i);for(var n=e.index;n<=i.index;n++){var r=E.getPart(this.curves[n],n==e.index?e.value:0,n==i.index?i.value:1);n==e.index&&t.moveTo(r[0],r[1]),t.bezierCurveTo.apply(t,r.slice(2))}}},e.each(E.evaluateMethods,function(t){this[t+"At"]=function(e,i){var n=this.getParameterAt(e);return E[t](this.curves[n.index],n.value,i)}},{})),L=e.extend({initialize:function(t,e){for(var i,n=this.points=[],r=t._segments,o=0,s=r.length;o<s;o++){var a=r[o].point.clone();i&&i.equals(a)||(n.push(a),i=a)}t._closed&&(this.closed=!0,n.unshift(n[n.length-1]),n.push(n[1])),this.error=e},fit:function(){var t=this.points,e=t.length,i=this.segments=e>0?[new T(t[0])]:[];return e>1&&this.fitCubic(0,e-1,t[1].subtract(t[0]).normalize(),t[e-2].subtract(t[e-1]).normalize()),this.closed&&(i.shift(),i.pop()),i},fitCubic:function(t,e,i,n){if(e-t==1){var r=this.points[t],o=this.points[e],s=r.getDistance(o)/3;return void this.addCurve([r,r.add(i.normalize(s)),o.add(n.normalize(s)),o])}for(var a,l=this.chordLengthParameterize(t,e),h=Math.max(this.error,this.error*this.error),c=!0,u=0;u<=4;u++){var d=this.generateBezier(t,e,l,i,n),f=this.findMaxError(t,e,d,l);if(f.error<this.error&&c)return void this.addCurve(d);if(a=f.index,f.error>=h)break;c=this.reparameterize(t,e,l,d),h=f.error}var p=this.points[a-1].subtract(this.points[a]),g=this.points[a].subtract(this.points[a+1]),m=p.add(g).divide(2).normalize();this.fitCubic(t,a,i,m),this.fitCubic(a,e,m.negate(),n)},addCurve:function(t){this.segments[this.segments.length-1].setHandleOut(t[1].subtract(t[0])),this.segments.push(new T(t[3],t[2].subtract(t[3])))},generateBezier:function(t,e,i,n,r){for(var o=1e-12,s=this.points[t],a=this.points[e],l=[[0,0],[0,0]],h=[0,0],c=0,u=e-t+1;c<u;c++){var d=i[c],f=1-d,p=3*d*f,g=f*f*f,m=p*f,v=p*d,y=d*d*d,b=n.normalize(m),_=r.normalize(v),w=this.points[t+c].subtract(s.multiply(g+m)).subtract(a.multiply(v+y));l[0][0]+=b.dot(b),l[0][1]+=b.dot(_),l[1][0]=l[0][1],l[1][1]+=_.dot(_),h[0]+=b.dot(w),h[1]+=_.dot(w)}var x,C,S=l[0][0]*l[1][1]-l[1][0]*l[0][1];if(Math.abs(S)>o){var T=l[0][0]*h[1]-l[1][0]*h[0];x=(h[0]*l[1][1]-h[1]*l[0][1])/S,C=T/S}else{var k=l[0][0]+l[0][1],E=l[1][0]+l[1][1];x=C=Math.abs(k)>o?h[0]/k:Math.abs(E)>o?h[1]/E:0}var P,D,I=a.getDistance(s),N=o*I;if(x<N||C<N)x=C=I/3;else{var M=a.subtract(s);P=n.normalize(x),D=r.normalize(C),P.dot(M)-D.dot(M)>I*I&&(x=C=I/3,P=D=null)}return[s,s.add(P||n.normalize(x)),a.add(D||r.normalize(C)),a]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);for(var r=1,o=i.length;r<o;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],o=0;o<=2;o++)n[o]=t[o+1].subtract(t[o]).multiply(3);for(var o=0;o<=1;o++)r[o]=n[o+1].subtract(n[o]).multiply(2);var s=this.evaluate(3,t,i),a=this.evaluate(2,n,i),l=this.evaluate(1,r,i),h=s.subtract(e),c=a.dot(a)+h.dot(l);return Math.abs(c)<1e-6?i:i-h.dot(a)/c},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var o=0;o<=t-r;o++)n[o]=n[o].multiply(1-i).add(n[o+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);for(var n=1,r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),o=0,s=t+1;s<e;s++){var a=this.evaluate(3,i,n[s-t]),l=a.subtract(this.points[s]),h=l.x*l.x+l.y*l.y;h>=o&&(o=h,r=s)}return{error:o,index:r}}}),A=y.extend({_class:"TextItem",_boundsSelected:!0,_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function(i){this._content="",this._lines=[];var n=i&&e.isPlainObject(i)&&i.x===t&&i.y===t;this._initialize(n&&i,!n&&l.read(arguments))},_equals:function(t){return this._content===t._content},_clone:function t(e,i,n){return e.setContent(this._content),t.base.call(this,e,i,n)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),R=A.extend({_class:"PointText",initialize:function(){A.apply(this,arguments)},clone:function(t){return this._clone(new R(y.NO_INSERT),t)},getPoint:function(){var t=this._matrix.getTranslation();return new h(t.x,t.y,this,"setPoint")},setPoint:function(){var t=l.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t){if(this._content){this._setStyles(t);var e=this._style,i=this._lines,n=e.getLeading(),r=t.shadowColor;t.font=e.getFontStyle(),t.textAlign=e.getJustification();for(var o=0,s=i.length;o<s;o++){t.shadowColor=r;var a=i[o];e.hasFill()&&(t.fillText(a,0,0),t.shadowColor="rgba(0,0,0,0)"),e.hasStroke()&&t.strokeText(a,0,0),t.translate(0,n)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,o=i.getJustification(),s=i.getLeading(),a=this.getView().getTextWidth(i.getFontStyle(),n),l=0;"left"!==o&&(l-=a/("center"===o?2:1));var h=new d(l,r?-.75*s:0,a,r*s);return e?e._transformBounds(h,h):h}}),O=e.extend(new function(){function t(t){var e,n=t.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(n){e=[0,0,0];for(var r=0;r<3;r++){var o=n[r+1];e[r]=parseInt(1==o.length?o+o:o,16)/255}}else if(n=t.match(/^rgba?\((.*)\)$/)){e=n[1].split(",");for(var r=0,a=e.length;r<a;r++){var o=+e[r];e[r]=r<3?o/255:o}}else{var l=s[t];if(!l){i||(i=Y.getContext(1,1),i.globalCompositeOperation="copy"),i.fillStyle="rgba(0,0,0,0)",i.fillStyle=t,i.fillRect(0,0,1,1);var h=i.getImageData(0,0,1,1).data;l=s[t]=[h[0]/255,h[1]/255,h[2]/255]}e=l.slice()}return e}var i,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},r={},s={},h=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],c={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),o=n-r;return[0===o?0:60*(n==t?(e-i)/o+(e<i?6:0):n==e?(i-t)/o+2:(t-e)/o+4),0===n?0:o/n,n]},"hsb-rgb":function(t,e,i){t=(t/60%6+6)%6;var n=Math.floor(t),r=t-n,n=h[n],o=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[o[n[0]],o[n[1]],o[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),o=n-r,s=0===o,a=s?0:60*(n==t?(e-i)/o+(e<i?6:0):n==e?(i-t)/o+2:(t-e)/o+4),l=(n+r)/2;return[a,s?0:l<.5?o/(n+r):o/(2-n-r),l]},"hsl-rgb":function(t,e,i){if(t=(t/360%1+1)%1,0===e)return[i,i,i];for(var n=[t+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,o=2*i-r,s=[],a=0;a<3;a++){var l=n[a];l<0&&(l+=1),l>1&&(l-=1),s[a]=6*l<1?o+6*(r-o)*l:2*l<1?r:3*l<2?o+(r-o)*(2/3-l)*6:o}return s},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return e.each(n,function(t,i){r[i]=[],e.each(t,function(t,o){var s=e.capitalize(t),a=/^(hue|saturation)$/.test(t),h=r[i][o]="gradient"===t?function(t){var e=this._components[0];return t=z.read(Array.isArray(t)?t:arguments,0,{readNull:!0}),e!==t&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===i?function(){return l.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+s]=function(){return this._type===i||a&&/^hs[bl]$/.test(this._type)?this._components[o]:this._convert(i)[o]},this["set"+s]=function(t){this._type===i||a&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(i),this._properties=n[i],this._type=i),this._components[o]=h.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function e(i){var o,s,l,h,c=Array.prototype.slice,u=arguments,d=0;Array.isArray(i)&&(u=i,i=u[0]);var f=null!=i&&typeof i;if("string"===f&&i in n&&(o=i,i=u[1],Array.isArray(i)?(s=i,l=u[2]):(this.__read&&(d=1),u=c.call(u,1),f=typeof i)),!s){if(h="number"===f?u:"object"===f&&null!=i.length?i:null){o||(o=h.length>=3?"rgb":"gray");var p=n[o].length;l=h[p],this.__read&&(d+=h===arguments?p+(null!=l?1:0):1),h.length>p&&(h=c.call(h,0,p))}else if("string"===f)o="rgb",s=t(i),4===s.length&&(l=s[3],s.length--);else if("object"===f)if(i.constructor===e){if(o=i._type,s=i._components.slice(),l=i._alpha,"gradient"===o)for(var g=1,m=s.length;g<m;g++){var v=s[g];v&&(s[g]=v.clone())}}else if(i.constructor===z)o="gradient",h=u;else{o="hue"in i?"lightness"in i?"hsl":"hsb":"gradient"in i||"stops"in i||"radial"in i?"gradient":"gray"in i?"gray":"rgb";var y=n[o],b=r[o];this._components=s=[];for(var g=0,m=y.length;g<m;g++){var _=i[y[g]];null==_&&0===g&&"gradient"===o&&"stops"in i&&(_={stops:i.stops,radial:i.radial}),_=b[g].call(this,_),null!=_&&(s[g]=_)}l=i.alpha}this.__read&&o&&(d=1)}if(this._type=o||"rgb",this._id=a.get(e),!s){this._components=s=[];for(var b=r[this._type],g=0,m=b.length;g<m;g++){var _=b[g].call(this,h&&h[g]);null!=_&&(s[g]=_)}}this._components=s,this._properties=n[this._type],this._alpha=l,this.__read&&(this.__read=d)},_serialize:function(t,i){var n=this.getComponents();return e.serialize(/^(gray|rgb)$/.test(this._type)?n:[this._type].concat(n),t,!0,i)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=c[this._type+"-"+t])?e.apply(this,this._components):c["rgb-"+t].apply(this,c[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new O(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var i=e.isPlainValue(t,!0)?O.read(arguments):t;return i===this||i&&this._class===i._class&&this._type===i._type&&this._alpha===i._alpha&&e.equals(this._components,i._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=o.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(i?a:n.number(a)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){function e(t){return Math.round(255*(t<0?0:t>1?1:t))}var i=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;return i=[e(i[0]),e(i[1]),e(i[2])],n<1&&i.push(n<0?0:n),t?"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).slice(1):(4==i.length?"rgba(":"rgb(")+i.join(",")+")"},toCanvasStyle:function(t){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var e,i=this._components,n=i[0],r=n._stops,o=i[1],s=i[2];if(n._radial){var a=s.getDistance(o),l=i[3];if(l){var h=l.subtract(o);h.getLength()>a&&(l=o.add(h.normalize(a-.1)))}var c=l||o;e=t.createRadialGradient(c.x,c.y,0,o.x,o.y,a)}else e=t.createLinearGradient(o.x,o.y,s.x,s.y);for(var u=0,d=r.length;u<d;u++){var f=r[u];e.addColorStop(f._rampPoint,f._color.toCanvasStyle())}return this._canvasStyle=e},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new O(t(),t(),t())}}})},new function(){var t={add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}};return e.each(t,function(t,e){this[e]=function(e){e=O.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),o=0,s=n.length;o<s;o++)r[o]=t(n[o],r[o]);return new O(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),z=e.extend({_class:"Gradient",initialize:function(t,e){this._id=a.get(),t&&this._set(t)&&(t=e=null),this._stops||this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,i){return i.add(this,function(){return e.serialize([this._stops,this._radial],t,!0,i)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(e){var i=this._owners?this._owners.indexOf(e):-1;-1!=i&&(this._owners.splice(i,1),0===this._owners.length&&(this._owners=t))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new z(t,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(this.stops)for(var i=0,n=this._stops.length;i<n;i++)this._stops[i]._owner=t;if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=H.readAll(e,0,{clone:!0});for(var i=0,n=this._stops.length;i<n;i++){var r=this._stops[i];r._owner=this,r._defaultRamp&&r.setRampPoint(i/(n-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class&&this._stops.length===t._stops.length){for(var e=0,i=this._stops.length;e<i;e++)if(!this._stops[e].equals(t._stops[e]))return!1;return!0}return!1}}),H=e.extend({_class:"GradientStop",initialize:function(e,i){if(e){var n,r;i===t&&Array.isArray(e)?(n=e[0],r=e[1]):e.color?(n=e.color,r=e.rampPoint):(n=e,r=i),this.setColor(n),this.setRampPoint(r)}},clone:function(){return new H(this._color.clone(),this._rampPoint)},_serialize:function(t,i){return e.serialize([this._color,this._rampPoint],t,!0,i)},_changed:function(){this._owner&&this._owner._changed(65)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(t){this._defaultRamp=null==t,this._rampPoint=t||0,this._changed()},getColor:function(){return this._color},setColor:function(t){this._color=O.read(arguments),this._color===t&&(this._color=t.clone()),this._color._owner=this,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._rampPoint==t._rampPoint||!1}}),F=e.extend(new function(){var i={fillColor:t,strokeColor:t,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:t,shadowBlur:0,shadowOffset:new l,selectedColor:t,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"},n={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},r={beans:!0},o={_defaults:i,_textDefaults:new e(i,{fillColor:new O}),beans:!0};return e.each(i,function(i,s){var a=/Color$/.test(s),h="shadowOffset"===s,c=e.capitalize(s),u=n[s],d="set"+c,f="get"+c;o[d]=function(e){var i=this._owner,n=i&&i._children;if(n&&n.length>0&&!(i instanceof N))for(var r=0,o=n.length;r<o;r++)n[r]._style[d](e);else{var l=this._values[s];l!==e&&(a&&(l&&(l._owner=t),e&&e.constructor===O&&(e._owner&&(e=e.clone()),e._owner=i)),this._values[s]=e,i&&i._changed(u||65))}},o[f]=function(i){var n,r=this._owner,o=r&&r._children;if(!o||0===o.length||i||r instanceof N){var n=this._values[s];if(n===t)(n=this._defaults[s])&&n.clone&&(n=n.clone());else{var c=a?O:h?l:null;!c||n&&n.constructor===c||(this._values[s]=n=c.read([n],0,{readNull:!0,clone:!0}),n&&a&&(n._owner=r))}return n}for(var u=0,d=o.length;u<d;u++){var p=o[u]._style[f]();if(0===u)n=p;else if(!e.equals(n,p))return t}return n},r[f]=function(t){return this._style[f](t)},r[d]=function(t){this._style[d](t)}}),y.inject(r),o},{_class:"Style",initialize:function(t,e,i){this._values={},this._owner=e,this._project=e&&e._project||i||paper.project,e instanceof A&&(this._defaults=this._textDefaults),t&&this.set(t)},set:function(t){var e=t instanceof F,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){return t===this||t&&this._class===t._class&&e.equals(this._values,t._values)||!1},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getView:function(){return this._project.getView()},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),B=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],o=e[0].toUpperCase()+e.substring(1),s=0;s<6;s++){var a=r[s],l=a?a+o:e;if(l in t){if(!i)return t[l];t[l]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,o=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var s=i.left-(o.clientLeft||r.clientLeft||0),a=i.top-(o.clientTop||r.clientTop||0);if(!e){var l=n.defaultView;s+=l.pageXOffset||o.scrollLeft||r.scrollLeft,a+=l.pageYOffset||o.scrollTop||r.scrollTop}return new d(s,a,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new d(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return B.getBounds(t,e).getPoint()},getSize:function(t){return B.getBounds(t,!0).getSize()},isInvisible:function(t){return B.getSize(t).equals(new c(0,0))},isInView:function(t){return!B.isInvisible(t)&&B.getViewportBounds(t).intersects(B.getBounds(t,!0))},getPrefixed:function(e,i){return t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},$={add:function(t,e){for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),o=0,s=r.length;o<s;o++)t.addEventListener(r[o],n,!1)},remove:function(t,e){for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),o=0,s=r.length;o<s;o++)t.removeEventListener(r[o],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new l(e.pageX||e.clientX+document.documentElement.scrollLeft,e.pageY||e.clientY+document.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return $.getPoint(t).subtract(B.getOffset(e||$.getTarget(t)))},stop:function(t){t.stopPropagation(),t.preventDefault()}};$.requestAnimationFrame=new function(){function t(){for(var e=o.length-1;e>=0;e--){var a=o[e],l=a[0],h=a[1];(!h||("true"==n.getAttribute(h,"keepalive")||s)&&B.isInView(h))&&(o.splice(e,1),l())}i&&(o.length?i(t):r=!1)}var e,i=B.getPrefixed(window,"requestAnimationFrame"),r=!1,o=[],s=!0;return $.add(window,{focus:function(){s=!0},blur:function(){s=!1}}),function(n,s){o.push([n,s]),i?r||(i(t),r=!0):e||(e=setInterval(t,1e3/60))}};var j=e.extend(i,{_class:"View",initialize:function t(e,i){function r(t){return i[t]||parseInt(i.getAttribute(t),10)}function o(){var t=B.getSize(i);return t.isNaN()||t.isZero()?new c(r("width"),r("height")):t}this._project=e,this._scope=e._scope,this._element=i;var s;this._pixelRatio||(this._pixelRatio=window.devicePixelRatio||1),this._id=i.getAttribute("id"),null==this._id&&i.setAttribute("id",this._id="view-"+t._id++),$.add(i,this._viewEvents);var a="none";if(B.setPrefixed(i.style,{userSelect:a,touchAction:a,touchCallout:a,contentZooming:a,userDrag:a,tapHighlightColor:"rgba(0,0,0,0)"}),n.hasAttribute(i,"resize")){var l=this;$.add(window,this._windowEvents={resize:function(){l.setViewSize(o())}})}if(this._setViewSize(s=o()),n.hasAttribute(i,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var h=this._stats.domElement,u=h.style,d=B.getOffset(i);u.position="absolute",u.left=d.x+"px",u.top=d.y+"px",document.body.appendChild(h)}t._views.push(this),t._viewsById[this._id]=this,this._viewSize=s,(this._matrix=new p)._owner=this,this._zoom=1,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0},remove:function(){return!!this._project&&(j._focused===this&&(j._focused=null),j._views.splice(j._views.indexOf(this),1),delete j._viewsById[this._id],this._project._view===this&&(this._project._view=null),$.remove(this._element,this._viewEvents),$.remove(window,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0)},_events:e.each(["onResize","onMouseDown","onMouseUp","onMouseMove"],function(t){this[t]={install:function(t){this._installEvent(t)},uninstall:function(t){this._uninstallEvent(t)}}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,_requestFrame:function(){var t=this;$.requestAnimationFrame(function(){t._requested=!1,t._animate&&(t._requestFrame(),t._handleFrame())},this._element),this._requested=!0},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,i=this._before?t-this._before:0;this._before=t,this._handlingFrame=!0,this.emit("frame",new e({delta:i,time:this._time+=i,count:this._count++})),this._stats&&this._stats.update(),this._handlingFrame=!1,this.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var i in this._frameItems){var n=this._frameItems[i];n.item.emit("frame",new e(t,{time:n.time+=t.delta,count:n.count++}))}},_update:function(){this._project._needsUpdate=!0,this._handlingFrame||(this._animate?this._handleFrame():this.update())},_changed:function(t){1&t&&(this._project._needsUpdate=!0)},_transform:function(t){this._matrix.concatenate(t),this._bounds=null,this._update()},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new u(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=c.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._viewSize.set(t.width,t.height),this._setViewSize(t),this._bounds=null,this.emit("resize",{size:t,delta:e}),this._update())},_setViewSize:function(t){var e=this._element;e.width=t.width,e.height=t.height},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new d(new l,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=l.read(arguments);this.scrollBy(t.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(t){this._transform((new p).scale(t/this._zoom,this.getCenter())),this._zoom=t},isVisible:function(){return B.isInView(this._element)},scrollBy:function(){this._transform((new p).translate(l.read(arguments).negate()))},play:function(){this._animate=!0,this._requested||this._requestFrame()},pause:function(){this._animate=!1},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(l.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(l.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return"string"==typeof e&&(e=document.getElementById(e)),new W(t,e)}}},new function(){function t(t){var e=$.getTarget(t);return e.getAttribute&&j._viewsById[e.getAttribute("id")]}function e(t,e){return t.viewToProject($.getOffset(e,t._element))}function i(){if(!j._focused||!j._focused.isVisible())for(var t=0,e=j._views.length;t<e;t++){var i=j._views[t];if(i&&i.isVisible()){j._focused=s=i;break}}}function n(t,e,i){t._handleEvent("mousemove",e,i);var n=t._scope.tool;return n&&n._handleEvent(c&&n.responds("mousedrag")?"mousedrag":"mousemove",e,i),t.update(),n}var r,o,s,a,l,h,c=!1,u=window.navigator;u.pointerEnabled||u.msPointerEnabled?(a="pointerdown MSPointerDown",l="pointermove MSPointerMove",h="pointerup pointercancel MSPointerUp MSPointerCancel"):(a="touchstart",l="touchmove",h="touchend touchcancel","ontouchstart"in window&&u.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(a+=" mousedown",l+=" mousemove",h+=" mouseup"));var d={"selectstart dragstart":function(t){c&&t.preventDefault()}},f={mouseout:function(t){var i=j._focused,r=$.getRelatedTarget(t);!i||r&&"HTML"!==r.nodeName||n(i,e(i,t),t)},scroll:i};d[a]=function(i){var n=j._focused=t(i),o=e(n,i);c=!0,n._handleEvent("mousedown",o,i),(r=n._scope.tool)&&r._handleEvent("mousedown",o,i),n.update()},f[l]=function(a){var l=j._focused;if(!c){var h=t(a);h?(l!==h&&n(l,e(l,a),a),o=l,l=j._focused=s=h):s&&s===l&&(l=j._focused=o,i())}if(l){var u=e(l,a);(c||l.getBounds().contains(u))&&(r=n(l,u,a))}},f[h]=function(t){var i=j._focused;if(i&&c){var n=e(i,t);c=!1,i._handleEvent("mouseup",n,t),r&&r._handleEvent("mouseup",n,t),i.update()}},$.add(document,f),$.add(window,{load:i});var p={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:d,_handleEvent:function(){},_installEvent:function(t){var e=this._eventCounters;if(e)for(var i in p)e[i]=(e[i]||0)+(p[i][t]||0)},_uninstallEvent:function(t){var e=this._eventCounters;if(e)for(var i in p)e[i]-=p[i][t]||0},statics:{updateFocus:i}}}),W=j.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof HTMLCanvasElement)){var i=c.read(arguments,1);if(i.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));e=Y.getCanvas(i)}if(this._context=e.getContext("2d"),this._eventCounters={},this._pixelRatio=1,!/^off|false$/.test(n.getAttribute(e,"hidpi"))){var r=window.devicePixelRatio||1,o=B.getPrefixed(this._context,"backingStorePixelRatio")||1;this._pixelRatio=r/o}j.call(this,t,e)},_setViewSize:function(t){var e=this._element,i=this._pixelRatio,r=t.width,o=t.height;if(e.width=r*i,e.height=o*i,1!==i){if(!n.hasAttribute(e,"resize")){var s=e.style;s.width=r+"px",s.height=o+"px"}this._context.scale(i,i)}},getPixelSize:function(t){var e,i=paper.browser;if(i&&i.firefox){var n=this._element.parentNode,r=document.createElement("div");r.style.fontSize=t,n.appendChild(r),e=parseFloat(B.getStyles(r).fontSize),n.removeChild(r)}else{var o=this._context,s=o.font;o.font=t+" serif",e=parseFloat(o.font),o.font=s}return e},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var o=0,s=e.length;o<s;o++)r=Math.max(r,i.measureText(e[o]).width);return i.font=n,r},update:function(t){var e=this._project;if(!e||!t&&!e._needsUpdate)return!1;var i=this._context,n=this._viewSize;return i.clearRect(0,0,n.width+1,n.height+1),e.draw(i,this._matrix,this._pixelRatio),e._needsUpdate=!1,!0}},new function(){function t(t,e,i,n,r,o){function s(t){if(t.responds(e)&&(a||(a=new G(e,i,n,r,o?n.subtract(o):null)),t.emit(e,a)&&a.isStopped))return i.preventDefault(),!0}for(var a,l=r;l;){if(s(l))return!0;l=l.getParent()}return!!s(t)}var e,i,n,r,o,s,a,l,h;return{_handleEvent:function(c,u,d){if(this._eventCounters[c]){var f=this._project,p=f.hitTest(u,{tolerance:0,fill:!0,stroke:!0}),g=p&&p.item,m=!1;switch(c){case"mousedown":for(m=t(this,c,d,u,g),l=o==g&&Date.now()-h<300,r=o=g,e=i=n=u,a=!m&&g;a&&!a.responds("mousedrag");)a=a._parent;break;case"mouseup":m=t(this,c,d,u,g,e),a&&(i&&!i.equals(u)&&t(this,"mousedrag",d,u,a,i),g!==a&&(n=u,t(this,"mousemove",d,u,g,n))),!m&&g&&g===r&&(h=Date.now(),t(this,l&&r.responds("doubleclick")?"doubleclick":"click",d,e,g),l=!1),r=a=null;break;case"mousemove":a&&(m=t(this,"mousedrag",d,u,a,i)),m||(g!==s&&(n=u),m=t(this,c,d,u,g,n)),i=n=u,g!==s&&(t(this,"mouseleave",d,u,s),s=g,t(this,"mouseenter",d,u,g))}return m}}}}),q=e.extend({_class:"Event",initialize:function(t){this.event=t},isPrevented:!1,isStopped:!1,preventDefault:function(){this.isPrevented=!0,this.event.preventDefault()},stopPropagation:function(){this.isStopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return V.modifiers}}),U=q.extend({_class:"KeyEvent",initialize:function(t,e,i,n){q.call(this,n),this.type=t?"keydown":"keyup",this.key=e,this.character=i},toString:function(){
return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),V=new function(){function t(n,o,h,c){var u,d=h?String.fromCharCode(h):"",f=r[o],p=f||d.toLowerCase(),g=n?"keydown":"keyup",m=j._focused,v=m&&m.isVisible()&&m._scope,y=v&&v.tool;if(l[p]=n,n?a[o]=h:delete a[o],f&&(u=e.camelize(f))in s){s[u]=n;var b=paper.browser;if("command"===u&&b&&b.mac)if(n)i={};else{for(var _ in i)_ in a&&t(!1,_,i[_],c);i=null}}else n&&i&&(i[o]=h);y&&y.responds(g)&&(paper=v,y.emit(g,new U(n,p,d,c)),m&&m.update())}var i,n,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},o={9:!0,13:!0,32:!0},s=new e({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),a={},l={};return $.add(document,{keydown:function(e){var i=e.which||e.keyCode;i in r||s.command?t(!0,i,i in o||s.command?i:0,e):n=i},keypress:function(e){null!=n&&(t(!0,n,e.which||e.keyCode,e),n=null)},keyup:function(e){var i=e.which||e.keyCode;i in a&&t(!1,i,a[i],e)}}),$.add(window,{blur:function(e){for(var i in a)t(!1,i,a[i],e)}}),{modifiers:s,isDown:function(t){return!!l[t]}}},G=q.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){q.call(this,e),this.type=t,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Z=q.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),K=(r.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function(t){r.call(this),this._firstMove=!0,this._count=0,this._downCount=0,this._set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_updateEvent:function(t,e,i,n,r,o,s){if(!r){if(null!=i||null!=n){var a=null!=i?i:0,l=e.subtract(this._point),h=l.getLength();if(h<a)return!1;if(null!=n&&0!=n)if(h>n)e=this._point.add(l.normalize(n));else if(s)return!1}if(o&&e.equals(this._point))return!1}switch(this._lastPoint=r&&"mousemove"==t?e:this._point,this._point=e,t){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=r?0:this._count+1,!0},_fireEvent:function(t,e){var i=paper.project._removeSets;if(i){"mouseup"===t&&(i.mousedrag=null);var n=i[t];if(n){for(var r in n){var o=n[r];for(var s in i){var a=i[s];a&&a!=n&&delete a[o._id]}o.remove()}i[t]=null}}return this.responds(t)&&this.emit(t,new Z(this,t,e))},_handleEvent:function(t,e,i){paper=this._scope;var n=!1;switch(t){case"mousedown":this._updateEvent(t,e,null,null,!0,!1,!1),n=this._fireEvent(t,i);break;case"mousedrag":for(var r=!1,o=!1;this._updateEvent(t,e,this.minDistance,this.maxDistance,!1,r,o);)n=this._fireEvent(t,i)||n,r=!0,o=!0;break;case"mouseup":!e.equals(this._point)&&this._updateEvent("mousedrag",e,this.minDistance,this.maxDistance,!1,!1,!1)&&(n=this._fireEvent("mousedrag",i)),this._updateEvent(t,e,null,this.maxDistance,!1,!1,!1),n=this._fireEvent(t,i)||n,this._updateEvent(t,e,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(t,e,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)n=this._fireEvent(t,i)||n,this._firstMove=!1}return n&&i.preventDefault(),n}}),{request:function(e,i,n,r){r=r===t||r;var o=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return o.open(e.toUpperCase(),i,r),"overrideMimeType"in o&&o.overrideMimeType("text/plain"),o.onreadystatechange=function(){if(4===o.readyState){var t=o.status;if(0!==t&&200!==t)throw new Error("Could not load "+i+" (Error "+t+")");n.call(o,o.responseText)}},o.send(null)}}),Y={canvases:[],getCanvas:function(t,e){var i,n=!0;"object"==typeof t&&(e=t.height,t=t.width),i=this.canvases.length?this.canvases.pop():document.createElement("canvas");var r=i.getContext("2d");return i.width===t&&i.height===e?n&&r.clearRect(0,0,t+1,e+1):(i.width=t,i.height=e),r.save(),i},getContext:function(t,e){return this.getCanvas(t,e).getContext("2d")},release:function(t){var e=t.canvas?t.canvas:t;e.getContext("2d").restore(),this.canvases.push(e)}},X=new function(){function t(t,e,i){return.2989*t+.587*e+.114*i}function i(e,i,n,r){var o=r-t(e,i,n);f=e+o,p=i+o,g=n+o;var r=t(f,p,g),s=m(f,p,g),a=v(f,p,g);if(s<0){var l=r-s;f=r+(f-r)*r/l,p=r+(p-r)*r/l,g=r+(g-r)*r/l}if(a>255){var h=255-r,c=a-r;f=r+(f-r)*h/c,p=r+(p-r)*h/c,g=r+(g-r)*h/c}}function n(t,e,i){return v(t,e,i)-m(t,e,i)}function r(t,e,i,n){var r,o=[t,e,i],s=v(t,e,i),a=m(t,e,i);a=a===t?0:a===e?1:2,s=s===t?0:s===e?1:2,r=0===m(a,s)?1===v(a,s)?2:1:0,o[s]>o[a]?(o[r]=(o[r]-o[a])*n/(o[s]-o[a]),o[s]=n):o[r]=o[s]=0,o[a]=0,f=o[0],p=o[1],g=o[2]}var o,s,a,l,h,c,u,d,f,p,g,m=Math.min,v=Math.max,y=Math.abs,b={multiply:function(){f=h*o/255,p=c*s/255,g=u*a/255},screen:function(){f=h+o-h*o/255,p=c+s-c*s/255,g=u+a-u*a/255},overlay:function(){f=h<128?2*h*o/255:255-2*(255-h)*(255-o)/255,p=c<128?2*c*s/255:255-2*(255-c)*(255-s)/255,g=u<128?2*u*a/255:255-2*(255-u)*(255-a)/255},"soft-light":function(){var t=o*h/255;f=t+h*(255-(255-h)*(255-o)/255-t)/255,t=s*c/255,p=t+c*(255-(255-c)*(255-s)/255-t)/255,t=a*u/255,g=t+u*(255-(255-u)*(255-a)/255-t)/255},"hard-light":function(){f=o<128?2*o*h/255:255-2*(255-o)*(255-h)/255,p=s<128?2*s*c/255:255-2*(255-s)*(255-c)/255,g=a<128?2*a*u/255:255-2*(255-a)*(255-u)/255},"color-dodge":function(){f=0===h?0:255===o?255:m(255,255*h/(255-o)),p=0===c?0:255===s?255:m(255,255*c/(255-s)),g=0===u?0:255===a?255:m(255,255*u/(255-a))},"color-burn":function(){f=255===h?255:0===o?0:v(0,255-255*(255-h)/o),p=255===c?255:0===s?0:v(0,255-255*(255-c)/s),g=255===u?255:0===a?0:v(0,255-255*(255-u)/a)},darken:function(){f=h<o?h:o,p=c<s?c:s,g=u<a?u:a},lighten:function(){f=h>o?h:o,p=c>s?c:s,g=u>a?u:a},difference:function(){f=h-o,f<0&&(f=-f),p=c-s,p<0&&(p=-p),(g=u-a)<0&&(g=-g)},exclusion:function(){f=h+o*(255-h-h)/255,p=c+s*(255-c-c)/255,g=u+a*(255-u-u)/255},hue:function(){r(o,s,a,n(h,c,u)),i(f,p,g,t(h,c,u))},saturation:function(){r(h,c,u,n(o,s,a)),i(f,p,g,t(h,c,u))},luminosity:function(){i(h,c,u,t(o,s,a))},color:function(){i(o,s,a,t(h,c,u))},add:function(){f=m(h+o,255),p=m(c+s,255),g=m(u+a,255)},subtract:function(){f=v(h-o,0),p=v(c-s,0),g=v(u-a,0)},average:function(){f=(h+o)/2,p=(c+s)/2,g=(u+a)/2},negation:function(){f=255-y(255-o-h),p=255-y(255-s-c),g=255-y(255-a-u)}},_=this.nativeModes=e.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),w=Y.getContext(1,1);e.each(b,function(t,e){var i="darken"===e,n=!1;w.save();try{w.fillStyle=i?"#300":"#a00",w.fillRect(0,0,1,1),w.globalCompositeOperation=e,w.globalCompositeOperation===e&&(w.fillStyle=i?"#a00":"#300",w.fillRect(0,0,1,1),n=w.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}w.restore(),_[e]=n}),Y.release(w),this.process=function(t,e,i,n,r){var m=e.canvas,v="normal"===t;if(v||_[t])i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=n,v||(i.globalCompositeOperation=t),i.drawImage(m,r.x,r.y),i.restore();else{var y=b[t];if(!y)return;for(var w=i.getImageData(r.x,r.y,m.width,m.height),x=w.data,C=e.getImageData(0,0,m.width,m.height).data,S=0,T=x.length;S<T;S+=4){o=C[S],h=x[S],s=C[S+1],c=x[S+1],a=C[S+2],u=x[S+2],l=C[S+3],d=x[S+3],y();var k=l*n/255,E=1-k;x[S]=k*f+E*h,x[S+1]=k*p+E*c,x[S+2]=k*g+E*u,x[S+3]=l*n+E*d}i.putImageData(w,r.x,r.y)}}},J=e.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{"true":"none","false":"non-scaling-stroke"},function(t,e){return!e&&(t instanceof D||t instanceof w||t instanceof A)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(t,i){var n=e.capitalize(i),r=t[2];this[i]={type:t[1],property:i,attribute:t[0],toSVG:r,fromSVG:r&&e.each(r,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+n,set:"set"+n}},{}),Q={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};return new function(){function t(t,e){for(var i in e){var n=e[i],r=Q[i];"number"==typeof n&&(n=x.number(n)),r?t.setAttributeNS(r,i,n):t.setAttribute(i,n)}return t}function i(e,i){return t(document.createElementNS("http://www.w3.org/2000/svg",e),i)}function n(t,i,n){var r=new e,o=t.getTranslation();if(i){t=t.shiftless();var a=t._inverseTransform(o);r[n?"cx":"x"]=a.x,r[n?"cy":"y"]=a.y,o=null}if(!t.isIdentity()){var l=t.decompose();if(l&&!l.shearing){var h=[],c=l.rotation,u=l.scaling;o&&!o.isZero()&&h.push("translate("+x.point(o)+")"),s.isZero(u.x-1)&&s.isZero(u.y-1)||h.push("scale("+x.point(u)+")"),c&&h.push("rotate("+x.number(c)+")"),r.transform=h.join(" ")}else r.transform="matrix("+t.getValues().join(",")+")"}return r}function r(e,r){for(var o=n(e._matrix),s=e._children,a=i("g",o),l=0,h=s.length;l<h;l++){var c=s[l],u=_(c,r);if(u)if(c.isClipMask()){var d=i("clipPath");d.appendChild(u),v(c,d,"clip"),t(a,{"clip-path":"url(#"+d.id+")"})}else a.appendChild(u)}return a}function a(t,e){var r=n(t._matrix,!0),o=t.getSize(),s=t.getImage();return r.x-=o.width/2,r.y-=o.height/2,r.width=o.width,r.height=o.height,r.href=!1===e.embedImages&&s&&s.src||t.toDataURL(),i("image",r)}function l(t,e){var r=e.matchShapes;if(r){var o=t.toShape(!1);if(o)return h(o,e)}var s,a=t._segments,l=n(t._matrix);if(0===a.length)return null;if(r&&!t.hasHandles())if(a.length>=3){s=t._closed?"polygon":"polyline";for(var c=[],u=0,d=a.length;u<d;u++)c.push(x.point(a[u]._point));l.points=c.join(" ")}else{s="line";var f=a[0]._point,p=a[a.length-1]._point;l.set({x1:f.x,y1:f.y,x2:p.x,y2:p.y})}else s="path",l.d=t.getPathData(null,e.precision);return i(s,l)}function h(t){var e=t._type,r=t._radius,o=n(t._matrix,!0,"rectangle"!==e);if("rectangle"===e){e="rect";var s=t._size,a=s.width,l=s.height;o.x-=a/2,o.y-=l/2,o.width=a,o.height=l,r.isZero()&&(r=null)}return r&&("circle"===e?o.r=r:(o.rx=r.width,o.ry=r.height)),i(e,o)}function c(t,e){var r=n(t._matrix),o=t.getPathData(null,e.precision);return o&&(r.d=o),i("path",r)}function u(t,e){var r=n(t._matrix,!0),o=t.getSymbol(),s=g(o,"symbol"),a=o.getDefinition(),l=a.getBounds();return s||(s=i("symbol",{viewBox:x.rectangle(l)}),s.appendChild(_(a,e)),v(o,s,"symbol")),r.href="#"+s.id,r.x+=l.x,r.y+=l.y,r.width=x.number(l.width),r.height=x.number(l.height),r.overflow="visible",i("use",r)}function d(t){var e=g(t,"color");if(!e){var n,r=t.getGradient(),o=r._radial,s=t.getOrigin().transform(),a=t.getDestination().transform();if(o){n={cx:s.x,cy:s.y,r:s.getDistance(a)};var l=t.getHighlight();l&&(l=l.transform(),n.fx=l.x,n.fy=l.y)}else n={x1:s.x,y1:s.y,x2:a.x,y2:a.y};n.gradientUnits="userSpaceOnUse",e=i((o?"radial":"linear")+"Gradient",n);for(var h=r._stops,c=0,u=h.length;c<u;c++){var d=h[c],f=d._color,p=f.getAlpha();n={offset:d._rampPoint,"stop-color":f.toCSS(!0)},p<1&&(n["stop-opacity"]=p),e.appendChild(i("stop",n))}v(t,e,"color")}return"url(#"+e.id+")"}function f(t){var e=i("text",n(t._matrix,!0));return e.textContent=t._content,e}function p(i,n,r){var o={},s=!r&&i.getParent();return null!=i._name&&(o.id=i._name),e.each(J,function(t){var n=t.get,r=t.type,a=i[n]();if(t.exportFilter?t.exportFilter(i,a):!s||!e.equals(s[n](),a)){if("color"===r&&null!=a){var l=a.getAlpha();l<1&&(o[t.attribute+"-opacity"]=l)}o[t.attribute]=null==a?"none":"number"===r?x.number(a):"color"===r?a.gradient?d(a,i):a.toCSS(!0):"array"===r?a.join(","):"lookup"===r?t.toSVG[a]:a}}),1===o.opacity&&delete o.opacity,i._visible||(o.visibility="hidden"),t(n,o)}function g(t,e){return C||(C={ids:{},svgs:{}}),t&&C.svgs[e+"-"+t._id]}function v(t,e,i){C||g();var n=C.ids[i]=(C.ids[i]||0)+1;e.id=i+"-"+n,C.svgs[i+"-"+t._id]=e}function b(t,e){var n=t,r=null;if(C){n="svg"===t.nodeName.toLowerCase()&&t;for(var o in C.svgs)r||(n||(n=i("svg"),n.appendChild(t)),r=n.insertBefore(i("defs"),n.firstChild)),r.appendChild(C.svgs[o]);C=null}return e.asString?(new XMLSerializer).serializeToString(n):n}function _(t,e,i){var n=S[t._class],r=n&&n(t,e);if(r){var o=e.onExport;o&&(r=o(t,r,e)||r);var s=JSON.stringify(t._data);s&&"{}"!==s&&"null"!==s&&r.setAttribute("data-paper-data",s)}return r&&p(t,r,i)}function w(t){return t||(t={}),x=new o(t.precision),t}var x,C,S={Group:r,Layer:r,Raster:a,Path:l,Shape:h,CompoundPath:c,PlacedSymbol:u,PointText:f};y.inject({exportSVG:function(t){return t=w(t),b(_(this,t,!0),t)}}),m.inject({exportSVG:function(t){t=w(t);var e=this.layers,r=this.getView(),o=r.getViewSize(),s=i("svg",{x:0,y:0,width:o.width,height:o.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),a=s,l=r._matrix;l.isIdentity()||(a=s.appendChild(i("g",n(l))));for(var h=0,c=e.length;h<c;h++)a.appendChild(_(e[h],t,!0));return b(s,t)}})},new function(){function i(t,e,i,n){var r=Q[e],o=r?t.getAttributeNS(r,e):t.getAttribute(e);return"null"===o&&(o=null),null==o?n?null:i?"":0:i?o:parseFloat(o)}function n(t,e,n,r){return e=i(t,e,!1,r),n=i(t,n,!1,r),!r||null!=e&&null!=n?new l(e,n):null}function r(t,e,n,r){return e=i(t,e,!1,r),n=i(t,n,!1,r),!r||null!=e&&null!=n?new c(e,n):null}function o(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?S(t)||t:"lookup"===e?i[t]:t}function s(t,e,i,n){var r=t.childNodes,o="clippath"===e,s=new b,a=s._project,l=a._currentStyle,h=[];if(o||(s=C(s,t,n),a._currentStyle=s._style.clone()),n)for(var c=t.querySelectorAll("defs"),u=0,d=c.length;u<d;u++)T(c[u],i,!1);for(var u=0,d=r.length;u<d;u++){var f,p=r[u];1!==p.nodeType||"defs"===p.nodeName.toLowerCase()||!(f=T(p,i,!1))||f instanceof v||h.push(f)}return s.addChildren(h),o&&(s=C(s.reduce(),t,n)),a._currentStyle=l,(o||"defs"===e)&&(s.remove(),s=null),s}function a(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,o=i.length;r<o;r+=2)n.push(new l(parseFloat(i[r]),parseFloat(i[r+1])));var s=new I(n);return"polygon"===e&&s.closePath(),s}function h(t){var e=t.getAttribute("d"),i={pathData:e};return(e.match(/m/gi)||[]).length>1||/z\S+/i.test(e)?new N(i):new I(i)}function u(t,e){var r,o=(i(t,"href",!0)||"").substring(1),s="radialgradient"===e;if(o)r=P[o].getGradient();else{for(var a=t.childNodes,l=[],h=0,c=a.length;h<c;h++){var u=a[h];1===u.nodeType&&l.push(C(new H,u))}r=new z(l,s)}var d,f,p;return s?(d=n(t,"cx","cy"),f=d.add(i(t,"r"),0),p=n(t,"fx","fy",!0)):(d=n(t,"x1","y1"),f=n(t,"x2","y2")),C(new O(r,d,f,p),t),null}function f(t,e,i,n){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),o=new p,s=0,a=r.length;s<a;s++){var l=r[s];if(!l)break;for(var h=l.split(/\(\s*/),c=h[0],u=h[1].split(/[\s,]+/g),d=0,f=u.length;d<f;d++)u[d]=parseFloat(u[d]);switch(c){case"matrix":o.concatenate(new p(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":o.rotate(u[0],u[1],u[2]);break;case"translate":o.translate(u[0],u[1]);break;case"scale":o.scale(u);break;case"skewX":o.skew(u[0],0);break;case"skewY":o.skew(0,u[0])}}t.transform(o)}function g(t,e,i){var n=t["fill-opacity"===i?"getFillColor":"getStrokeColor"]();n&&n.setAlpha(parseFloat(e))}function _(i,n,r){var o=i.attributes[n],s=o&&o.value;if(!s){var a=e.camelize(n);s=i.style[a],s||r.node[a]===r.parent[a]||(s=r.node[a])}return s?"none"===s?null:s:t}function C(i,n,r){var o={node:B.getStyles(n)||{},parent:!r&&B.getStyles(n.parentNode)||{}};return e.each(E,function(r,s){var a=_(n,s,o);a!==t&&(i=e.pick(r(i,a,s,n,o),i))}),i}function S(t){var e=t&&t.match(/\((?:#|)([^)']+)/);return e&&P[e[1]]}function T(t,i,n){function r(t){paper=s;var e=T(t,i,n),r=i.onLoad,o=s.project&&s.getView();r&&r.call(this,e),o.update()}if(!t)return null;i?"function"==typeof i&&(i={onLoad:i}):i={};var o=t,s=paper;if(n)if("string"!=typeof t||/^.*</.test(t)){if("undefined"!=typeof File&&t instanceof File){var a=new FileReader;return a.onload=function(){r(a.result)},a.readAsText(t)}}else{if(!(o=document.getElementById(t)))return K.request("get",t,r);t=null}if("string"==typeof t&&(o=(new DOMParser).parseFromString(t,"image/svg+xml")),!o.nodeName)throw new Error("Unsupported SVG source: "+t);var l,h=o.nodeName.toLowerCase(),c=k[h],u=o.getAttribute&&o.getAttribute("data-paper-data"),d=s.settings,f=d.applyMatrix;if(d.applyMatrix=!1,l=c&&c(o,h,i,n)||null,d.applyMatrix=f,l){"#document"===h||l instanceof b||(l=C(l,o,n));var p=i.onImport;p&&(l=p(o,l,i)||l),i.expandShapes&&l instanceof w&&(l.remove(),l=l.toPath()),u&&(l._data=JSON.parse(u))}return n&&(P={},l&&e.pick(i.applyMatrix,f)&&l.matrix.apply(!0,!0)),l}var k={"#document":function(t,e,i,n){for(var r=t.childNodes,o=0,s=r.length;o<s;o++){var a=r[o];if(1===a.nodeType){var l=a.nextSibling;document.body.appendChild(a);var h=T(a,i,n);return l?t.insertBefore(a,l):t.appendChild(a),h}}},g:s,svg:s,clippath:s,polygon:a,polyline:a,path:h,lineargradient:u,radialgradient:u,image:function(t){var e=new x(i(t,"href",!0));return e.on("load",function(){var e=r(t,"width","height");this.setSize(e);var i=this._matrix._transformPoint(n(t,"x","y").add(e.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new v(s(t,e,i,n),!0)},defs:s,use:function(t){var e=(i(t,"href",!0)||"").substring(1),r=P[e],o=n(t,"x","y");return r?r instanceof v?r.place(o):r.clone().translate(o):null},circle:function(t){return new w.Circle(n(t,"cx","cy"),i(t,"r"))},ellipse:function(t){return new w.Ellipse({center:n(t,"cx","cy"),radius:r(t,"rx","ry")})},rect:function(t){var e=n(t,"x","y"),i=r(t,"width","height"),o=r(t,"rx","ry");return new w.Rectangle(new d(e,i),o)},line:function(t){return new I.Line(n(t,"x1","y1"),n(t,"x2","y2"))},text:function(t){var e=new R(n(t,"x","y").add(n(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}},E=e.set(e.each(J,function(t){this[t.attribute]=function(e,i){if(e[t.set](o(i,t.type,t.fromSVG)),"color"===t.type&&e instanceof w){var n=e[t.get]();n&&n.transform((new p).translate(e.getPosition(!0).negate()))}}},{}),{id:function(t,e){P[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=S(e);if(i){if(i=i.clone(),i.setClipMask(!0),!(t instanceof b))return new b(i,t);t.insertChild(0,i)}},gradientTransform:f,transform:f,"fill-opacity":g,"stroke-opacity":g,visibility:function(t,e){t.setVisible("visible"===e)},display:function(t,e){t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){var i=e.match(/(.*)%$/);t.setRampPoint(i?i[1]/100:parseFloat(e))},viewBox:function(t,e,i,n,s){var a=new d(o(e,"array")),l=r(n,"width","height",!0);if(t instanceof b){var h=l?a.getSize().divide(l):1,c=(new p).translate(a.getPoint()).scale(h);t.transform(c.inverted())}else if(t instanceof v){l&&a.setSize(l);var u="visible"!=_(n,"overflow",s),f=t._definition;u&&!a.contains(f.getBounds())&&(u=new w.Rectangle(a).transform(f._matrix),u.setClipMask(!0),f.addChild(u))}}}),P={};y.inject({importSVG:function(t,e){return this.addChild(T(t,e,!0))}}),m.inject({importSVG:function(t,e){return this.activate(),T(t,e,!0)}})},paper=new(n.inject(e.exports,{enumerable:!0,Base:e,Numerical:s,Key:V})),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper};!function(t){"use strict";function e(){var e=t(this),i=f(e);e.is(".fixed-top, .fixed-bottom, .horizontal-percent")?e.css("min-height",m(i.first)+m(i.last)+t(i.divider).height()+"px"):e.css("min-width",v(i.first)+v(i.last)+t(i.divider).width()+"px")}function i(e){e.preventDefault();var i=t(this),r=i.parent(),o=i.siblings(".split-pane-resize-shim");o.show(),i.addClass("dragged"),e.type.match(/^touch/)&&i.addClass("touch");var a=s(r,p(e),g(e));t(document).on("touchmove mousemove",a),t(document).one("touchend mouseup",function(){t(document).off("touchmove mousemove",a),i.removeClass("dragged touch"),o.hide(),r.trigger("dividerdragend",[n(r)])}),r.trigger("dividerdragstart",[n(r)]),window.dispatchEvent(new Event("resize"))}function n(t){var e=t.is(".fixed-top, .fixed-bottom, .horizontal-percent")?"height":"width";return{firstComponentSize:t.find(".split-pane-component:first")[e](),lastComponentSize:t.find(".split-pane-component:last")[e]()}}function r(){var e=t(this),i=o(e),n=e.parent().closest(".split-pane")[0]||window;t(n).on(n===window?"resize":"splitpaneresize",function(t){(t.target===document?window:t.target)===n&&i(t)})}function o(t){var e=f(t);return t.is(".fixed-top")?function(){var i=m(e.last),n=e.splitPane.offsetHeight-i-e.divider.offsetHeight;e.first.offsetHeight>n&&_(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".fixed-bottom")?function(){var i=m(e.first),n=e.splitPane.offsetHeight-i-e.divider.offsetHeight;e.last.offsetHeight>n&&w(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".horizontal-percent")?function(){var i=m(e.last),n=m(e.first),r=e.splitPane.offsetHeight-n-e.divider.offsetHeight;e.last.offsetHeight>r?w(e,r/e.splitPane.offsetHeight*100+"%"):e.splitPane.offsetHeight-e.first.offsetHeight-e.divider.offsetHeight<i&&w(e,i/e.splitPane.offsetHeight*100+"%"),t.trigger("splitpaneresize")}:t.is(".fixed-left")?function(){var i=v(e.last),n=e.splitPane.offsetWidth-i-e.divider.offsetWidth;e.first.offsetWidth>n&&x(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".fixed-right")?function(){var i=v(e.first),n=e.splitPane.offsetWidth-i-e.divider.offsetWidth;e.last.offsetWidth>n&&C(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".vertical-percent")?function(){var i=v(e.last),n=v(e.first),r=e.splitPane.offsetWidth-n-e.divider.offsetWidth;e.last.offsetWidth>r?C(e,r/e.splitPane.offsetWidth*100+"%"):e.splitPane.offsetWidth-e.first.offsetWidth-e.divider.offsetWidth<i&&C(e,i/e.splitPane.offsetWidth*100+"%"),t.trigger("splitpaneresize")}:void 0}function s(t,e,i){var n=f(t);return t.is(".fixed-top")?a(n,i):t.is(".fixed-bottom")?l(n,i):t.is(".horizontal-percent")?h(n,i):t.is(".fixed-left")?c(n,e):t.is(".fixed-right")?u(n,e):t.is(".vertical-percent")?d(n,e):void 0}function a(e,i){var n=m(e.first),r=e.splitPane.offsetHeight-m(e.last)-e.divider.offsetHeight,o=e.divider.offsetTop-i;return function(i){i.preventDefault&&i.preventDefault();var s=y(n,r,o+g(i));_(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function l(e,i){var n=m(e.last),r=e.splitPane.offsetHeight-m(e.first)-e.divider.offsetHeight,o=e.last.offsetHeight+i;return function(i){i.preventDefault&&i.preventDefault();var s=Math.min(Math.max(n,o-g(i)),r);w(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function h(e,i){var n=e.splitPane.offsetHeight,r=m(e.last),o=n-m(e.first)-e.divider.offsetHeight,s=e.last.offsetHeight+i;return function(i){i.preventDefault&&i.preventDefault();var a=Math.min(Math.max(r,s-g(i)),o);w(e,a/n*100+"%"),t(e.splitPane).trigger("splitpaneresize")}}function c(e,i){var n=v(e.first),r=e.splitPane.offsetWidth-v(e.last)-e.divider.offsetWidth,o=e.divider.offsetLeft-i;return function(i){i.preventDefault&&i.preventDefault();var s=b(n,r,o+p(i));x(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function u(e,i){var n=v(e.last),r=e.splitPane.offsetWidth-v(e.first)-e.divider.offsetWidth,o=e.last.offsetWidth+i;return function(i){i.preventDefault&&i.preventDefault();var s=Math.min(Math.max(n,o-p(i)),r);C(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function d(e,i){var n=e.splitPane.offsetWidth,r=v(e.last),o=n-v(e.first)-e.divider.offsetWidth,s=e.last.offsetWidth+i;return function(i){i.preventDefault&&i.preventDefault();var a=Math.min(Math.max(r,s-p(i)),o);C(e,a/n*100+"%"),t(e.splitPane).trigger("splitpaneresize")}}function f(t){return{splitPane:t[0],first:t.children(".split-pane-component:first")[0],divider:t.children(".split-pane-divider")[0],last:t.children(".split-pane-component:last")[0]}}function p(t){return t.pageX!==undefined?t.pageX:t.originalEvent.pageX!==undefined?t.originalEvent.pageX:t.originalEvent.touches?t.originalEvent.touches[0].pageX:void 0}function g(t){return t.pageY!==undefined?t.pageY:t.originalEvent.pageY!==undefined?t.originalEvent.pageY:t.originalEvent.touches?t.originalEvent.touches[0].pageY:void 0}function m(e){return parseInt(t(e).css("min-height"),10)||0}function v(e){return parseInt(t(e).css("min-width"),10)||0}function y(t,e,i){return Math.min(Math.max(t,i),e)}function b(t,e,i){return Math.min(Math.max(t,i),e)}function _(t,e){t.first.style.height=e,t.divider.style.top=e,t.last.style.top=e}function w(t,e){t.first.style.bottom=e,t.divider.style.bottom=e,t.last.style.height=e}function x(t,e){t.first.style.width=e,t.divider.style.left=e,t.last.style.left=e}function C(t,e){t.first.style.right=e,t.divider.style.right=e,t.last.style.width=e}var S={};S.init=function(){var n=this;n.each(e),n.append('<div class="split-pane-resize-shim">'),n.children(".split-pane-divider").html('<div class="split-pane-divider-inner"></div>'),n.children(".split-pane-divider").on("touchstart mousedown",i),setTimeout(function(){n.each(r),t(window).trigger("resize")},100)},S.firstComponentSize=function(e){this.each(function(){var i=t(this),n=f(i);i.is(".fixed-top")?a(n,n.divider.offsetTop)({pageY:e}):i.is(".fixed-bottom")?(e=n.splitPane.offsetHeight-n.divider.offsetHeight-e,l(n,-n.last.offsetHeight)({pageY:-e})):i.is(".horizontal-percent")?(e=n.splitPane.offsetHeight-n.divider.offsetHeight-e,h(n,-n.last.offsetHeight)({pageY:-e})):i.is(".fixed-left")?c(n,n.divider.offsetLeft)({pageX:e}):i.is(".fixed-right")?(e=n.splitPane.offsetWidth-n.divider.offsetWidth-e,u(n,-n.last.offsetWidth)({pageX:-e})):i.is(".vertical-percent")&&(e=n.splitPane.offsetWidth-n.divider.offsetWidth-e,d(n,-n.last.offsetWidth)({pageX:-e}))})},S.lastComponentSize=function(e){this.each(function(){var i=t(this),n=f(i);i.is(".fixed-top")?(e=n.splitPane.offsetHeight-n.divider.offsetHeight-e,a(n,n.divider.offsetTop)({pageY:e})):i.is(".fixed-bottom")?l(n,-n.last.offsetHeight)({pageY:-e}):i.is(".horizontal-percent")?h(n,-n.last.offsetHeight)({pageY:-e}):i.is(".fixed-left")?(e=n.splitPane.offsetWidth-n.divider.offsetWidth-e,c(n,n.divider.offsetLeft)({pageX:e})):i.is(".fixed-right")?u(n,-n.last.offsetWidth)({pageX:-e}):i.is(".vertical-percent")&&d(n,-n.last.offsetWidth)({pageX:-e})})},t.fn.splitPane=function(e){S[e||"init"].apply(this,t.grep(arguments,function(t,e){return e>0}))}}(jQuery),function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";var e={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},i={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1};t.defineMode("xml",function(n,r){function o(t,e){function i(i){return e.tokenize=i,i(t,e)}var n=t.next();if("<"==n)return t.eat("!")?t.eat("[")?t.match("CDATA[")?i(l("atom","]]>")):null:t.match("--")?i(l("comment","-->")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),i(h(1))):null:t.eat("?")?(t.eatWhile(/[\w\._\-]/),e.tokenize=l("meta","?>"),"meta"):(k=t.eat("/")?"closeTag":"openTag",e.tokenize=s,"tag bracket");if("&"==n){var r;return r=t.eat("#")?t.eat("x")?t.eatWhile(/[a-fA-F\d]/)&&t.eat(";"):t.eatWhile(/[\d]/)&&t.eat(";"):t.eatWhile(/[\w\.\-:]/)&&t.eat(";"),r?"atom":"error"}return t.eatWhile(/[^&<]/),null}function s(t,e){var i=t.next();if(">"==i||"/"==i&&t.eat(">"))return e.tokenize=o,k=">"==i?"endTag":"selfcloseTag","tag bracket";if("="==i)return k="equals",null;if("<"==i){e.tokenize=o,e.state=f,e.tagName=e.tagStart=null;var n=e.tokenize(t,e);return n?n+" tag error":"tag error"}return/[\'\"]/.test(i)?(e.tokenize=a(i),e.stringStartCol=t.column(),e.tokenize(t,e)):(t.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function a(t){var e=function(e,i){for(;!e.eol();)if(e.next()==t){i.tokenize=s;break}return"string"};return e.isInAttribute=!0,e}function l(t,e){return function(i,n){for(;!i.eol();){if(i.match(e)){n.tokenize=o;break}i.next()}return t}}function h(t){return function(e,i){for(var n;null!=(n=e.next());){if("<"==n)return i.tokenize=h(t+1),i.tokenize(e,i);if(">"==n){if(1==t){i.tokenize=o;break}return i.tokenize=h(t-1),i.tokenize(e,i)}}return"meta"}}function c(t,e,i){this.prev=t.context,this.tagName=e,this.indent=t.indented,this.startOfLine=i,(C.doNotIndent.hasOwnProperty(e)||t.context&&t.context.noIndent)&&(this.noIndent=!0)}function u(t){t.context&&(t.context=t.context.prev)}function d(t,e){for(var i;;){if(!t.context)return;if(i=t.context.tagName,!C.contextGrabbers.hasOwnProperty(i)||!C.contextGrabbers[i].hasOwnProperty(e))return;u(t)}}function f(t,e,i){return"openTag"==t?(i.tagStart=e.column(),p):"closeTag"==t?g:f}function p(t,e,i){return"word"==t?(i.tagName=e.current(),E="tag",y):(E="error",p)}function g(t,e,i){if("word"==t){var n=e.current();return i.context&&i.context.tagName!=n&&C.implicitlyClosed.hasOwnProperty(i.context.tagName)&&u(i),i.context&&i.context.tagName==n||!1===C.matchClosing?(E="tag",m):(E="tag error",v)}return E="error",v}function m(t,e,i){return"endTag"!=t?(E="error",m):(u(i),f)}function v(t,e,i){return E="error",m(t,e,i)}function y(t,e,i){if("word"==t)return E="attribute",b;if("endTag"==t||"selfcloseTag"==t){var n=i.tagName,r=i.tagStart;return i.tagName=i.tagStart=null,"selfcloseTag"==t||C.autoSelfClosers.hasOwnProperty(n)?d(i,n):(d(i,n),i.context=new c(i,n,r==i.indented)),f}return E="error",y}function b(t,e,i){return"equals"==t?_:(C.allowMissing||(E="error"),y(t,e,i))}function _(t,e,i){return"string"==t?w:"word"==t&&C.allowUnquoted?(E="string",y):(E="error",y(t,e,i))}function w(t,e,i){return"string"==t?w:y(t,e,i)}var x=n.indentUnit,C={},S=r.htmlMode?e:i;for(var T in S)C[T]=S[T];for(var T in r)C[T]=r[T];var k,E
;return o.isInText=!0,{startState:function(t){var e={tokenize:o,state:f,indented:t||0,tagName:null,tagStart:null,context:null};return null!=t&&(e.baseIndent=t),e},token:function(t,e){if(!e.tagName&&t.sol()&&(e.indented=t.indentation()),t.eatSpace())return null;k=null;var i=e.tokenize(t,e);return(i||k)&&"comment"!=i&&(E=null,e.state=e.state(k||i,t,e),E&&(i="error"==E?i+" error":E)),i},indent:function(e,i,n){var r=e.context;if(e.tokenize.isInAttribute)return e.tagStart==e.indented?e.stringStartCol+1:e.indented+x;if(r&&r.noIndent)return t.Pass;if(e.tokenize!=s&&e.tokenize!=o)return n?n.match(/^(\s*)/)[0].length:0;if(e.tagName)return!1!==C.multilineTagIndentPastTag?e.tagStart+e.tagName.length+2:e.tagStart+x*(C.multilineTagIndentFactor||1);if(C.alignCDATA&&/<!\[CDATA\[/.test(i))return 0;var a=i&&/^<(\/)?([\w_:\.-]*)/.exec(i);if(a&&a[1])for(;r;){if(r.tagName==a[2]){r=r.prev;break}if(!C.implicitlyClosed.hasOwnProperty(r.tagName))break;r=r.prev}else if(a)for(;r;){var l=C.contextGrabbers[r.tagName];if(!l||!l.hasOwnProperty(a[2]))break;r=r.prev}for(;r&&r.prev&&!r.startOfLine;)r=r.prev;return r?r.indent+x:e.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:C.htmlMode?"html":"xml",helperType:C.htmlMode?"html":"xml",skipAttribute:function(t){t.state==_&&(t.state=y)}}}),t.defineMIME("text/xml","xml"),t.defineMIME("application/xml","xml"),t.mimeModes.hasOwnProperty("text/html")||t.defineMIME("text/html",{name:"xml",htmlMode:!0})});var TextLab={};$(document).ready(function(){new TextLab.Routes(TextLabSettings);Backbone.history.start()}),TextLab.Config=Backbone.Model.extend({urlRoot:"project_configs"}),TextLab.ConfigCollection=Backbone.Collection.extend({model:TextLab.Config,url:"project_configs"}),TextLab.Document=Backbone.Model.extend({urlRoot:"documents",afterLoad:function(t){this.leafs=new TextLab.LeafCollection(t.leafs,{documentID:t.id}),this.documentNodes=new TextLab.DocumentNodeCollection(t.document_nodes,{document:this}),this.documentSections=new TextLab.DocumentSectionCollection(t.sections),this.members=new TextLab.MembershipCollection(t.members),this.loadProjectConfig(t.project_config),this.leafs.document=this,this.documentNodes.document=this,this.documentSections.document=this,this.members.document=this},sync:function(t,e,i){if(this.afterLoad&&("read"==t||"create"==t))if(i.success){var n=i.success;i.success=_.bind(function(t){this.afterLoad(t),n(t)},this)}else i.success=_.bind(this.afterLoad,this);Backbone.sync(t,e,i)},getRootNode:function(){return _.find(this.documentNodes.models,function(t){return t.isRoot()})},loadProjectConfig:function(t){this.config=t,this.config.vocabs=JSON.parse(t.vocabs),this.config.tags=JSON.parse(t.tags)},getProjectConfigs:function(t){(new TextLab.ConfigCollection).fetch({success:t,error:TextLab.Routes.routes.onError})},updateProjectConfig:function(t,e){new TextLab.Config({id:t}).fetch({success:_.bind(function(t){this.loadProjectConfig(t.toJSON()),e()},this),error:TextLab.Routes.routes.onError})},addSection:function(t){t.set("document_id",this.id),this.documentSections.add(t)},addLeaf:function(t){t.set("document_id",this.id),this.leafs.add(t)}}),TextLab.DocumentCollection=Backbone.Collection.extend({model:TextLab.Document,url:"documents"}),TextLab.DocumentNode=Backbone.Model.extend({urlRoot:"document_nodes",initialize:function(){},getChildren:function(){var t=this.id;return this.collection.document.documentNodes.where({document_node_id:t})},getAncestors:function(){for(var t=[],e=this,i=e.getParent();null!=i;)t.push(i),e=i,i=e.getParent();return t.reverse()},getParent:function(){return this.collection.document.documentNodes.findWhere({id:this.get("document_node_id")})},getSection:function(){var t=this.get("document_section_id");if(null==t)return null;var e=this.collection.document.documentSections.models;return _.find(e,function(e){return e.id==t})},getLeaf:function(){var t=this.get("leaf_id");if(null==t)return null;var e=this.collection.document.leafs.models;return _.find(e,function(e){return e.id==t})},isLeaf:function(){return null!=this.get("leaf_id")},isSection:function(){return null!=this.get("document_section_id")},isRoot:function(){return null==this.get("document_node_id")}}),TextLab.DocumentNodeCollection=Backbone.Collection.extend({model:TextLab.DocumentNode,url:"document_nodes"}),TextLab.DocumentSection=Backbone.Model.extend({urlRoot:"document_sections",initialize:function(){}}),TextLab.DocumentSectionCollection=Backbone.Collection.extend({model:TextLab.DocumentSection,url:"document_sections"}),TextLab.Leaf=Backbone.Model.extend({urlRoot:"leafs",initialize:function(t){this.afterLoad(t)},afterLoad:function(t){t&&t.zones?this.zones=new TextLab.ZoneCollection(t.zones):this.zones=new TextLab.ZoneCollection},beforeSave:function(){},sync:function(t,e,i){if(this.afterLoad&&("read"==t||"create"==t))if(i.success){var n=i.success;i.success=_.bind(function(t){this.afterLoad(t),n(t)},this)}else i.success=_.bind(this.afterLoad,this);this.beforeSave&&"update"==t&&this.beforeSave(),Backbone.sync(t,e,i)},addZone:function(t){var e=this.get("next_zone_label");this.set("next_zone_label",e+1),t.set("leaf_id",this.id),t.generateZoneLabel(e),this.zones.add(t)},getTranscriptions:function(t){var e=_.template("/transcriptions?leaf_id=<%= leafID %>"),i=this.id;$.ajax({url:e({leafID:i}),dataType:"json",success:function(e){var i=new TextLab.TranscriptionCollection(e);t(i)}})},getSequences:function(t){var e=_.template("/sequences?leaf_id=<%= leafID %>"),i=this.id;$.ajax({url:e({leafID:i}),dataType:"json",success:function(e){var i=new TextLab.SequenceCollection(e);t(i)}})},getZoneLabelPrefix:function(){return"#"+this.get("xml_id")+"-"},removeZoneLabelPrefix:function(t){var e=this.getZoneLabelPrefix();return t.slice(e.length)},getTileSource:function(t){if(!this.get("tile_source"))return void t(null);var e=_.template("<%= tileSource %>/info.json");$.ajax({url:e({tileSource:this.get("tile_source")}),dataType:"json",success:function(e){t(new OpenSeadragon.IIIFTileSource(e))}})}}),TextLab.LeafCollection=Backbone.Collection.extend({model:TextLab.Leaf,url:"leafs",addLeaf:function(t){t.set("document_id",this.documentID),this.add(t)}}),TextLab.Membership=Backbone.Model.extend({urlRoot:"memberships",initialize:function(){}}),TextLab.MembershipCollection=Backbone.Collection.extend({model:TextLab.Membership,url:"memberships"}),TextLab.NarrativeStep=Backbone.Model.extend({urlRoot:"narrative_steps"}),TextLab.NarrativeStepCollection=Backbone.Collection.extend({model:TextLab.NarrativeStep,url:"narrative_steps",comparator:"step_number"}),TextLab.Sequence=Backbone.Model.extend({urlRoot:"sequences",initialize:function(t){this.afterLoad(t)},afterLoad:function(t){t&&t.narrative_steps?this.narrativeSteps=new TextLab.NarrativeStepCollection(t.narrative_steps):this.narrativeSteps=new TextLab.NarrativeStepCollection},sync:function(t,e,i){if(this.afterLoad&&("read"==t||"create"==t))if(i.success){var n=i.success;i.success=_.bind(function(t){this.afterLoad(t),n(t)},this)}else i.success=_.bind(this.afterLoad,this);this.beforeSave&&"update"==t&&this.beforeSave(),Backbone.sync(t,e,i)},moveStep:function(t,e){var i=t.get("step_number");this.narrativeSteps.findWhere({step_number:e}).set("step_number",i),t.set("step_number",e),this.narrativeSteps=_.sortBy(this.narrativeSteps.models,function(t){return t.get("step_number")})},renumberSteps:function(){var t=this.narrativeSteps.models,e=0;_.each(t,function(t){t.set("step_number",e++)})},isReadOnly:function(t){var e=this.get("owner"),i=this.get("shared"),n=this.get("submitted"),r=!1;return i&&!e&&(r=!0),n&&e&&(r=!0),n&&t&&(r=!1),r}}),TextLab.Sequence.newSequence=function(t){return new TextLab.Sequence({leaf_id:t.id,name:"untitled",document_id:t.get("document_id"),shared:!1,submitted:!1,published:!1,owner:!0})},TextLab.SequenceCollection=Backbone.Collection.extend({model:TextLab.Sequence,url:"sequences"}),TextLab.Site=Backbone.Model.extend({urlRoot:"sites",afterLoad:function(){},sync:function(t,e,i){if(this.afterLoad&&("read"==t||"create"==t))if(i.success){var n=i.success;i.success=_.bind(function(t){this.afterLoad(t),n(t)},this)}else i.success=_.bind(this.afterLoad,this);Backbone.sync(t,e,i)}}),TextLab.SiteCollection=Backbone.Collection.extend({model:TextLab.Site,url:"sites"}),TextLab.Transcription=Backbone.Model.extend({urlRoot:"transcriptions",initialize:function(){},isReadOnly:function(t){var e=this.get("owner"),i=this.get("shared"),n=this.get("submitted"),r=!1;return i&&!e&&(r=!0),n&&e&&(r=!0),n&&t&&(r=!1),r},sync:function(t,e,i){if(this.afterLoad&&("read"==t||"create"==t))if(i.success){var n=i.success;i.success=_.bind(function(t){this.afterLoad(t),n(t)},this)}else i.success=_.bind(this.afterLoad,this);this.beforeSave&&"update"==t&&this.beforeSave(),Backbone.sync(t,e,i)}}),TextLab.Transcription.newTranscription=function(t){return new TextLab.Transcription({leaf_id:t.id,name:"untitled",document_id:t.get("document_id"),shared:!1,submitted:!1,published:!1,owner:!0})},TextLab.TranscriptionCollection=Backbone.Collection.extend({model:TextLab.Transcription,url:"transcriptions"}),TextLab.User=Backbone.Model.extend({urlRoot:"accounts",afterLoad:function(){},sync:function(t,e,i){if(this.afterLoad&&("read"==t||"create"==t))if(i.success){var n=i.success;i.success=_.bind(function(t){this.afterLoad(t),n(t)},this)}else i.success=_.bind(this.afterLoad,this);Backbone.sync(t,e,i)}}),TextLab.UserCollection=Backbone.Collection.extend({model:TextLab.User,url:"accounts",getSites:function(t){(new TextLab.SiteCollection).fetch({success:t,error:TextLab.Routes.routes.onError})}}),TextLab.Zone=Backbone.Model.extend({urlRoot:"zones",generateZoneLabel:function(t){var e="";t<10&&(e+="0"),t<100&&(e+="0"),t<1e3&&(e+="0");var i=e+t;this.set("zone_label",i)}}),TextLab.ZoneCollection=Backbone.Collection.extend({model:TextLab.Zone,url:"zones",getZoneByLabel:function(t){return _.find(this.models,function(e){return e.get("zone_label")==t})}}),TextLab.Routes=Backbone.Router.extend({routes:{"":"documentListView","documents/:id":"documentEditView",admin:"adminView",sites:"siteListView"},initialize:function(){_.bindAll(this,"onError"),TextLab.Routes.routes=this},documentListView:function(){this.loadDocuments(_.bind(function(t){var e=new TextLab.DocumentListView({collection:t});e.render(),$(".textlab-app").html(e.$el)},this))},documentEditView:function(t){new TextLab.Document({id:t}).fetch({success:function(t){var e=new TextLab.PrimaryEditingView({model:t});e.render(),$(".textlab-app").html(e.$el),e.postRender()},error:this.onError})},adminView:function(){"user"!=TextLabSettings.user_type&&this.loadUsers(_.bind(function(t){var e=new TextLab.UserListView({collection:t});e.render(),$(".textlab-app").html(e.$el)},this))},siteListView:function(){"user"!=TextLabSettings.user_type&&this.loadSites(_.bind(function(t){var e=new TextLab.SiteListView({collection:t});e.render(),$(".textlab-app").html(e.$el)},this))},loadDocuments:function(t){(new TextLab.DocumentCollection).fetch({success:t,error:this.onError})},loadUsers:function(t){(new TextLab.UserCollection).fetch({success:t,error:this.onError})},loadSites:function(t){(new TextLab.SiteCollection).fetch({success:t,error:this.onError})},onError:function(t,e){console.log("Server Error: \n"+e)}}),function(){this.JST||(this.JST={}),this.JST["textlab/templates/attribute-modal-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push('<div class="modal fade" id="attributes-modal" tabindex="-1" role="dialog" aria-labelledby="attributeModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="attributeModal">Insert &lt;',tag.tag,'&gt; Element</h4>\n      </div>\n      <div class="modal-body">\n        <ul>\n          ');var elementIndex=0;__p.push("\n          ");var tag=config.tags[tag.tag];__p.push("\n          "),_.each(tag.attributes,function(t,e){__p.push("\n            ",renderAttributeField(elementIndex,t,e,zones),"\n          ")}),__p.push("\n\n          "),_.each(tag.elements,function(t){__p.push('\n            <div class="panel panel-default">\n              ');var e=config.tags[t];__p.push("\n              "),elementIndex+=1,__p.push('\n              <div class="panel-heading">',e.tag,'</div>\n              <div class="panel-body">\n                '),_.each(e.attributes,function(t,e){__p.push("\n                  ",renderAttributeField(elementIndex,t,e,zones),"\n                ")}),__p.push("\n              </div>\n            </div>\n          ")}),__p.push('\n        </ul>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary create-button">Insert Element</button>\n      </div>\n    </div>\n  </div>\n</div>\n')}return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/common/check-mark"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="row ',error?"has-error":"",'">\n  <div class="col-sm-9 field-wrapper">\n\t  <input type="checkbox" id="',field_name,'" ',field_value?" checked ":"","/><span> ",field_title,"</span>\n  </div>\n</div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/common/dropdown-input"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push('<div class="row ',error?"has-error":"",'">\n  <label for="',field_name,'" class="control-label col-sm-2">',field_title,':</label>\n  <div class="col-sm-9 field-wrapper">\n  \t<select type="text" class="form-control" id="',field_name,'">\n  \t\t'),"undefined"!=typeof no_blank&&no_blank||__p.push("\n        <option></option>\n      "),__p.push("\n  \t\t");for(var i=0;i<options.length;i++)__p.push('\n  \t\t<option value="',options[i].value,'" ',options[i].value===field_value?'selected="selected"':"",">",options[i].text,"</option>\n  \t\t");__p.push('\n  \t</select>\n  \t<div class="instructions">',field_instructions,"</div>\n  </div>\n</div>\n")}return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/common/number-input"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="row ',error?"has-error":"",'">\n  <label for="',field_name,'" class="control-label col-sm-2">',field_title,':</label>\n  <div class="col-sm-9 field-wrapper">\n\t  <input type="number" class="form-control year-input" id="',field_name,'" value="',field_value,'" >\n\t  <div class="instructions">',field_instructions,"</div>\n  </div>\n</div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/common/string-input"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="row ',error?"has-error":"",'">\n  <label for="',field_name,'" class="control-label col-sm-2">',field_title,':</label>\n  <div class="col-sm-9 field-wrapper">\n\t  <input type="text" class="form-control" id="',field_name,'" value="',field_value,'">\n\t  <div class="instructions">',field_instructions,"</div>\n  </div>\n</div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/common/tab-pane"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="',id,'" class="tab-pane"></div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/common/tab"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<li class='doc-tab' id='",id,"' >\n\t<span>\n\t\t<i class=\"accept-star ",star?"fa fa-star":"",'"></i> \n\t\t<i class="',icon,"\"></i> \n\t\t<span class='name'>",name,'</span>\n\t</span> \n\t<div class="close-x fa fa-times-circle" data-tab-id="',id,'"></div>\n</li>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/document-explorer"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div class='top-bar'>\n\t"),canEditSection&&__p.push(" \n\t\t<a class='btn btn-sm btn-default' id='edit-info-button' href='#'>\n\t\t\t<span class=\"fa fa-file-o\" aria-hidden=\"true\"></span> Edit Section\n\t\t</a>\n\t"),__p.push('\n\t<ol class="breadcrumb">\n\t  '),_.each(ancestors,function(t){__p.push(" \n\t\t  <li><a class='breadcrumb' data-id=\"",t.id,'">',t.name,"</a></li>\n\t  ")}),__p.push('\n\t  <li class="active">',name,"</li>\n\t</ol>\n\n</div>\n\n"),0==items.length?__p.push(" \n\t<div class='no-leaf'>\n\t  <h2><i class=\"fa fa-folder-o fa-5x\"></i><span class='message'>This section is empty.</span>\n\t</div>\n"):(__p.push('\n\n\t<div class="thumb-container">\n\t'),_.each(items,function(t){__p.push("\n\n\t\t"),"thumb"==t.nodeType&&__p.push(" \n\t\t\t<div class='document-node' data-id='",t.id,"' >\n\t\t\t\t<img class='thumb' src='",t.imgSrc,"'/>\n\t\t\t\t<div class='thumb-label' >",t.name,"</div>\n\t\t\t</div>\n\t\t"),__p.push("\n\t\t\n\t\t"),"blank-thumb"==t.nodeType&&__p.push(" \n\t\t\t<div class='document-node' data-id='",t.id,"' >\n\t\t\t\t<i class=\"fa fa-file-o fa-5x thumb-icon\"></i>\n\t\t\t\t<div class='thumb-label' >",t.name,"</div>\n\t\t\t</div>\n\t\t"),__p.push("\n\n\t\t"),"section"==t.nodeType&&__p.push(" \n\t\t\t<div class='document-node' data-id='",t.id,"' >\n\t\t\t\t<i class=\"fa fa-folder fa-5x thumb-icon\"></i>\n\t\t\t\t<div class='thumb-label' >",t.name,"</div>\n\t\t\t</div>\n\t\t"),__p.push("\n\n\t")}),__p.push("\n\t</div>\n\n")),__p.push("\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/document-list-view"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<!-- Stop the loading modal -->\n<script>$( document ).ready(function() {loadingModal_stop();});</script>\n\n<!-- Project listing -->\n<div id="modal-container"></div>\n\n<h2>My Projects</h2>\n\n'),_.each(documents,function(t){__p.push("\n  <div class=\"panel panel-default project\">\n    <div class=\"panel-body\">\n\n      <div class='info'>\n        <div class='icon'><span class='fa fa-4x fa-book'></span></div>\n        "),t.owner||t.accepted?__p.push('\n          <h4><a onClick="loadingModal_start()" href=\'#documents/',t.id,"'>",t.name,"</a></h4>\n        "):__p.push("\n          <h4>",t.name,"</h4>\n        "),__p.push('\n        <p class="description">',t.description,"</p>\n      </div>\n        <div class='actions'>\n          <a onClick=\"loadingModal_start()\" href='#documents/",t.id,'\' class="btn btn-sm btn-default">Edit</a>\n\t\t  <a href="/document_sections/',t.root_node,'.html" target="_blank" class="btn btn-sm btn-default">View</a>\n          '),t.owner&&__p.push('\n            <button class="btn btn-sm btn-danger delete-document-button" data-title="Delete this Project?" data-doc-id="',t.id,'">Delete</button>\n          '),__p.push("\n        </div>\n\n      "),t.owner||t.accepted||__p.push('\n        <div class=\'actions\'>\n          <button class="btn btn-sm btn-success yes-button" data-doc-id="',t.id,'">Join Project</button>\n          <button class="btn btn-sm btn-default no-button" data-doc-id="',t.id,'">Decline</button>\n        </div>\n      '),__p.push("\n\n      "),t.owner||(__p.push("\n        <div class='owner-name'><i>\n        "),t.accepted?__p.push("\n          shared by: ",t.owner_name,"\n        "):__p.push("\n          ",t.owner_name," has invited you to join this project.\n        "),__p.push("\n        </i></div>\n      ")),__p.push("\n\n    </div>\n  </div>\n")}),__p.push('\n\n<button class="btn btn-primary new-document-button">New Project</button>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/document-tree-view"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push(""),owner&&__p.push(' \n  <div id="document-toolbar">\n    <button class=\'btn btn-default btn-sm add-leaf-button\'><i class="fa fa-file-o fa-lg"></i> Add Leaf</button>\n    <button class=\'btn btn-default btn-sm add-section-button\'><i class="fa fa-folder fa-lg"></i> Add Section</button>\n    <button class="btn btn-default btn-sm edit-settings-button"><i class="fa fa-cog fa-lg"></i> Edit Settings</button>\n  </div>\n'),__p.push('\n<div id="tree-container">\n  <div id="document-tree"></div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/edit-settings-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="edit-settings-modal" tabindex="-1" role="dialog" aria-labelledby="settingsModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="settingsModal">Edit Project Settings</h4>\n      </div>\n      <div class="modal-body">\n        <h4>Publishing Settings</h4>\n        ',partials.checkMark({field_name:"published",field_title:publishFieldTitle,field_value:document.published,error:!1}),"\n        \n        <h4>General Settings</h4>\n        ",partials.stringInput({field_name:"name",field_title:"Project Name",field_value:document.name,field_instructions:"Please enter a name for this project.",error:!1}),"        \n        ",partials.stringInput({field_name:"description",field_title:"Project Description",field_value:document.description,field_instructions:"Please enter a brief description of this project.",error:!1}),"    \n        ",partials.dropdownInput({field_name:"projectConfig",field_title:"Project Configuration",field_value:document.project_config_id,field_instructions:"Project configuration determines the tags and vocabs.",no_blank:!0,options:projectConfigs,error:!1}),'       \n      \n      <h4>Project Members</h4>  \n      <div id="members-panel"></div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary update-button">Update</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/leaf-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="leaf-modal" tabindex="-1" role="dialog" aria-labelledby="leafModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="documentModal">',"edit"==mode?"Edit":"New",' Leaf</h4>\n      </div>\n      <div class="modal-body">\n        ',partials.stringInput({field_name:"name",field_title:"Name",field_value:leaf.get("name"),field_instructions:"Please enter a unique name for this leaf.",error:!1}),"\n        ",partials.stringInput({field_name:"xml_id",field_title:"XML ID",field_value:leaf.get("xml_id"),field_instructions:"Valid XML ID for identifying this leaf.",error:!1}),"        \n        ",partials.stringInput({field_name:"tile_source",field_title:"URL",field_value:leaf.get("tile_source"),field_instructions:"Please enter a IIIF image resource URL.",error:!1}),'        \n      </div>\n      <div class="modal-footer">\n        '),"edit"==mode&&__p.push('\n          <button type="button" class="btn btn-danger delete-button">Delete</button>\n        '),__p.push('\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary ok-button">OK</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/leaf-manifest-panel"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div id=\"drop-zone\"><span class='drop-zone-message'>",dropZoneInstructions,"</span></div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/members-panel"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<p class="validation-message">',validationMessage,'</p>\n<div class="members-panel panel panel-default">\n  <div class="panel-body">\n    '),members.length>0?(__p.push("\n      "),_.each(members,function(t){__p.push("\n          <div class='member-row'>\n            <span class='display-name'>",t.first_name+" "+t.last_name+" ("+t.username+")","</span>\n            <div class='row-actions'>\n              "),t.accepted?__p.push(' \n                <button class="btn btn-xs btn-danger remove-member-button" data-member-id="',t.id,'">Remove</button> \n              '):__p.push(' \n                <button class="btn btn-xs btn-danger cancel-invite-button" data-member-id="',t.id,'">Cancel Invite</button> \n              '),__p.push("\n            </div>\n          </div>\n      ")}),__p.push("      \n    ")):__p.push("\n        <p><i>This project does not yet have any members.</i></p>      \n    "),__p.push('\n  </div>\n</div>\n\n<!--input member -->\n<div class=\'invite-member\'>\n  <p>Enter a user name below to invite them to this project:</p>\n  <input type="text" class="form-control" id="invite-username" value="">\n  <button class="btn btn-sm btn-primary invite-user-button">Invite User</button>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/narrative-step-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="step-modal" tabindex="-1" role="dialog" aria-labelledby="stepModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="documentModal">',"edit"==mode?"Edit":"New",' Step</h4>\n      </div>\n      <div class="modal-body">\n\n        ',partials.dropdownInput({field_name:"zone_id",field_title:"Zone",field_value:model.zone_id,field_instructions:"Please select the zone referenced in this step.",no_blank:!0,options:zones,error:!1}),'\n\n        <b>Transcription at this step:</b>\n        <div id="step">',model.step,'</div>\n\n        <b>Narrative of this step:</b>\n        <div id="narrative">',model.narrative,'</div>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary ok-button">OK</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/new-document-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="new-document-modal" tabindex="-1" role="dialog" aria-labelledby="documentModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="documentModal">New Project</h4>\n      </div>\n      <div class="modal-body">\n        ',partials.stringInput({field_name:"name",field_title:"Project Name",field_value:"",field_instructions:"Please enter a name for this project.",error:!1}),"        \n        ",partials.stringInput({field_name:"description",field_title:"Project Description",field_value:"",field_instructions:"Please enter a brief description of this project.",error:!1}),"        \n        ",partials.dropdownInput({field_name:"projectConfig",field_title:"Project Configuration",field_value:_.first(projectConfigs).value,field_instructions:"Project configuration determines the tags and vocabs.",no_blank:!0,options:projectConfigs,error:!1}),'      \n\n        <div id="leaf-manifest-panel"></div>\n\n      </div>\n      <div class="modal-footer">\n        <div class="import-message"></div>\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary create-button">Create Project</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/open-tab-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="open-tab-modal" tabindex="-1" role="dialog" aria-labelledby="open-tabModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="open-tabModal">Open Tab</h4>\n      </div>\n      <div class="modal-body">      \n        ',partials.dropdownInput({field_name:"tab",field_title:"Tabs",field_value:"",field_instructions:"Select an existing transcription or sequence.",no_blank:!0,options:tabs,error:!1}),'    \n      </div>      \n      <div class="modal-footer">\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary ok-button">OK</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/primary-editing-view"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class=\'popover-anchor\'></div>\n<div id="modal-container"></div>\n<div class="pretty-split-pane-frame">\n\n\t<div class="split-pane fixed-left">\n\t\t<div class="split-pane-component" id="document-tree-panel">\n\t\t\t<div class="pretty-split-pane-component-inner">\n\t\t\t\t<div id=\'document-tree-view\'></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="split-pane-divider" id="vertical-divider"></div>\n\t\t<div class="split-pane-component" id="right-component">\n\t\t\t<!-- Editor View -->\n\t\t\t<div class="split-pane horizontal-percent editor-view">\n\t\t\t\t<div class="split-pane-component" id="surface-view-panel">\n\t\t\t\t\t<div class="pretty-split-pane-component-inner">\n\t\t\t\t\t\t<div id=\'surface-view\'></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="split-pane-divider editor-view" id="horizontal-divider2"></div>\n\t\t\t\t<div class="split-pane-component editor-view" id="xml-editor-panel">\n\t\t\t\t\t<div class="pretty-split-pane-component-inner">\n\t\t\t\t\t\t<div id=\'tabbed-editor\'></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<!--  Explorer View -->\n\t\t\t<div class="pretty-split-pane-component-inner explorer-view">\n\t\t\t\t<div id=\'document-explorer\'></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/section-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="section-modal" tabindex="-1" role="dialog" aria-labelledby="sectionModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="sectionModal">',"edit"==mode?"Edit":"New",' Section</h4>\n      </div>\n      <div class="modal-body">\n        ',partials.stringInput({field_name:"name",field_title:"Name",field_value:section.get("name"),field_instructions:"Please enter a name for this section.",error:!1}),'\n\n        <div id="leaf-manifest-panel"></div>\n      </div>\n      <div class="modal-footer">\n       <div class="import-message"></div>\n        '),
"edit"==mode&&__p.push('\n          <button type="button" data-placement="bottom" data-title="Are you sure you want to delete this entire SECTION?" class="btn btn-danger delete-button">Delete</button>\n        '),__p.push('\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary ok-button">OK</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/sequence-editor"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div class='btn-toolbar sequence-editor-toolbar'>\n  \n  "),showAddStep&&__p.push(" \n    <button class='add-step-button toolbar-button btn btn-sm btn-default' href='#' >Add Step</button>\n  "),__p.push(' \n\n  <div class="status-message">',statusMessage,"</div> \n\n  <div class='actions ",actionWidthClass,"' >    \n    "),showPublishButton&&__p.push(" \n      <button class='toolbar-button btn btn-sm btn-default publish-button ",published?"hidden":"","' href='#' ><i class=\"fa fa-star\" aria-hidden=\"true\"></i> Accept</button>\n      <button class='toolbar-button btn btn-sm btn-default unpublish-button ",published?"":"hidden",'\' href=\'#\' ><i class="fa fa-star-o" aria-hidden="true"></i> Return</button>          \n    '),__p.push("\n\n    "),showReturnButton&&__p.push("\n      <button class='toolbar-button btn btn-sm btn-default return-button ",submitted?"":"hidden",'\' href=\'#\' ><i class="fa fa-send-o" aria-hidden="true"></i> Return to Sender</button>         \n    '),__p.push("\n\n    "),showActionMenu&&(__p.push(' \n      <div class="dropdown">\n        <button id="action-dropdown" class="btn btn-sm btn-default dropdown-toggle" type="button" data-toggle="dropdown">\n          <i class="fa fa-bars" aria-hidden="true"></i>\n        </button>\n        <ul class="dropdown-menu">\n          '),showSubmitButton&&__p.push("\n            <li><a class='submit-button ",submitted?"hidden":"",'\' href="#"><i class="fa fa-send" aria-hidden="true"></i> Submit</a></li>\n          '),__p.push("\n          <li><a class='share-button ",shared?"hidden":"",'\' href="#"><i class="fa fa-share-square" aria-hidden="true"></i> Share</a></li>\n          <li><a class=\'stop-sharing-button ',shared?"":"hidden",'\' href="#"><i class="fa fa-share-square-o" aria-hidden="true"></i> Stop Sharing</a></li>\n          <li><a class=\'rename-button\' href="#"><i class="fa fa-pencil-square" aria-hidden="true"></i> Rename</a></li>\n          <li><a class=\'delete-button\' href="#"><i class="fa fa-trash" aria-hidden="true"></i> Delete</a></li>\n        </ul>\n      </div>\n    ')),__p.push("\n    \n  </div>\n  \n</div>\n\n<div id='sequence-grid'></div>\n\n\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/sequence-grid"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<h4>Revision Sequence</h4>\n<table class="table table-striped">\n\t<tr>\n\t\t<th>'),readOnly||__p.push("Step Order"),__p.push("</th>\n\t\t<th>Zone</th>\n\t\t<th>Step</th>\n\t\t<th>Narrative</th>\n\t\t<th>"),readOnly||__p.push("Actions"),__p.push("</th>\n\t</tr>\n\t"),_.each(narrativeSteps,function(t){__p.push("\n\t\t<tr>\n\t\t\t<td>\n\t\t\t\t"),readOnly||(__p.push("\n\t\t\t\t\t<span class='arrows'>\n\t\t\t          "),t.step_number>0&&__p.push("\n\t\t\t            <a class='btn btn-xs btn-default up-step-button arrow-button' data-step-id='",t.id,'\' href="#"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></a>\n\t\t\t          '),__p.push("\n\t\t\t          "),t.step_number<narrativeSteps.length-1&&__p.push("\n\t\t\t            <a class='btn btn-xs btn-default down-step-button arrow-button' data-step-id='",t.id,'\' href="#"><i class="fa fa-arrow-circle-down" aria-hidden="true"></i></a>\n\t\t\t          '),__p.push("\n        \t</span>\n\t\t\t\t")),__p.push('\n\t\t \t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<a href="#" class="zone-link" data-zone-id="',t.zone_id,'">\n\t\t\t\t\t\t',t.zoneLabel,"\n\t\t\t\t\t</a>\n\t\t\t\t</td>\n\t\t\t\t<td class='step-column'>\n\t\t\t\t\t",t.step,"\n\t\t\t\t</td>\n\t\t\t\t<td class='narrative-column'>\n\t\t\t\t\t",t.narrative,"\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t"),readOnly||__p.push("\n\t\t\t\t\t\t<a class='btn btn-xs btn-default edit-step-button' data-step-id='",t.id,'\' href="#"><i class="fa fa-pencil-square" aria-hidden="true"></i> Edit</a>\n\t\t\t\t\t\t<a class=\'btn btn-xs btn-danger delete-step-button\' data-step-id=\'',t.id,'\' data-title="Delete this Step?" href="#"><i class="fa fa-trash" aria-hidden="true"></i> Delete</a>\n\t\t\t\t'),__p.push("\n\t\t\t\t</td>\n\t\t</tr>\n\t\t")}),__p.push("\n</table>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/site-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="site-modal" tabindex="-1" role="dialog" aria-labelledby="siteModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="sectionModal">',"edit"==mode?"Edit":"New",' Site</h4>\n      </div>\n      <div class="modal-body">\n        ',partials.stringInput({field_name:"name",field_title:"Name",field_value:site.get("name"),field_instructions:"Please enter a name for this site.",error:!1}),'\n      </div>\n      <div class="modal-footer">\n        '),"edit"==mode&&__p.push('\n          <button type="button" data-placement="bottom" data-title="Are you sure you want to delete this site? Affiliated user accounts will be disabled." class="btn btn-danger delete-button">Delete</button>\n        '),__p.push('\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary ok-button">OK</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/site-list-view"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="modal-container"></div>\n\n<h2>Sites</h2>\n\n<p><a href=\'#admin\'>Manage Users</a></p>\n\n<button class="btn btn-primary new-site-button">New Site</button>\n\n<table class="table table-striped">\n  <tr>\n    <th>Name</th>\n    <th>Number of Accounts</th>\n    <th>Actions</th>\n  </tr>\n  '),_.each(sites,function(t){__p.push(" \n    <tr>\n      <td>",t.name,"</td>\n      <td>",t.account_count," / ",t.max_accounts,'</td>\n      <td><button data-id="',t.id,'" class="btn btn-default btn-sm edit-site-button"><i class="fa fa-pencil fa-lg"></i> Edit</button></td>\n    </tr>\n  ')}),__p.push("\n</table>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/surface-view"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div class='viewer-toolbar'>\n  <div class=\"btn-group\" role=\"group\">\n    <a class='btn btn-default' href='#' id='add-mode-button' >\n      <span class=\"glyphicon glyphicon-pencil\"  aria-hidden=\"true\"></span>    \n    </a>\n    <a class='btn btn-default' href='#' id='nav-mode-button' >\n      <span class=\"glyphicon glyphicon-move\" aria-hidden=\"true\"></span>    \n    </a>\n  </div>  \n  <a class='btn btn-default' href='#' id='toggle-zones-button'>\n    <span id='viz-icon' class=\"glyphicon glyphicon-eye-open\" aria-hidden=\"true\"></span>    \n  </a>\n  \n  <div class=\"btn-group\" role=\"group\">\n    <a class='btn btn-default' id='zoom-in-button' href='#'>\n      <span class=\"glyphicon glyphicon-zoom-in\" aria-hidden=\"true\"></span>\n    </a>\n    <a class='btn btn-default' id='zoom-out-button' href='#'>\n      <span class=\"glyphicon glyphicon-zoom-out\" aria-hidden=\"true\"></span>\n    </a>\n  </div>\n  \n  "),canEditLeafInfo&&__p.push(" \n    <a class='btn btn-default' id='edit-info-button' href='#'>\n      <span class=\"fa fa-file-o\" aria-hidden=\"true\"></span>\n    </a>\n  "),__p.push("\n\n</div>\n<div id='openseadragon'></div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/tab-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="tab-modal" tabindex="-1" role="dialog" aria-labelledby="tabModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="tabModal">',"edit"==mode?"Rename":"New",' Editor</h4>\n      </div>\n      <div class="modal-body">\n        ',partials.stringInput({field_name:"name",field_title:"Name",field_value:name,field_instructions:"Please enter a name for this tab.",error:!1}),"\n        "),"edit"!=mode&&__p.push(" \n          ",partials.dropdownInput({field_name:"editorType",field_title:"Editor Type",field_value:_.first(editorTypes).value,field_instructions:"Choose the type of editor to open.",no_blank:!0,options:editorTypes,error:!1}),"  \n        "),__p.push('\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary ok-button">OK</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/tabbed-editor"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="editor_buttons">\n\t<button class=\'btn btn-default btn-xs tab-button open-tab-button\'><i class="fa fa-pencil"></i> Open</button>\n\t<button class=\'btn btn-default btn-xs tab-button new-tab-button\'><i class="fa fa-plus"></i> New</button>\n</div>\n<ul class="tabs">\n</ul>\n<div class="clr"></div>\n<div class="tab-panes">\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/user-dialog"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal fade" id="user-modal" tabindex="-1" role="dialog" aria-labelledby="userModal">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel-button" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title" id="userModal">Edit User Account</h4>\n      </div>\n      <div class="modal-body">\n        ',partials.stringInput({field_name:"first_name",field_title:"First Name",field_value:user.get("first_name"),field_instructions:"Please enter a first name for this account.",error:!1}),"\n        ",partials.stringInput({field_name:"last_name",field_title:"Last Name",field_value:user.get("last_name"),field_instructions:"Please enter a last name for this account.",error:!1}),"\n        ",partials.stringInput({field_name:"username",field_title:"Username",field_value:user.get("username"),field_instructions:"Please enter a username for this account.",error:!1}),"\n        ",partials.stringInput({field_name:"email",field_title:"Email",field_value:user.get("email"),field_instructions:"Please enter a email for this account.",error:!1}),"\n        "),isAdmin&&__p.push(" \n          ",partials.dropdownInput({field_name:"site",field_title:"Site",field_value:user.get("site_id"),field_instructions:"Site for this account.",no_blank:!1,options:sites,error:!1}),"  \n          ",partials.dropdownInput({field_name:"user_type",field_title:"User Type",field_value:user.get("user_type"),field_instructions:"User Type for this account.",no_blank:!0,options:userTypes,error:!1}),"  \n        "),__p.push(' \n      </div>\n      <div class="modal-footer">\n        '),"archived"!=user.get("account_status")&&__p.push(' \n          <button data-id="',user.id,'" class="btn btn-danger btn-sm archive-user-button"><i class="fa fa-archive fa-lg"></i> Archive</button>\n        '),__p.push('\n        <button type="button" class="btn btn-default cancel-button">Cancel</button>\n        <button type="button" class="btn btn-primary ok-button">OK</button>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/user-list-view"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div id="modal-container"></div>\n\n\n'),isAdmin?__p.push(" \n  <h2>User Accounts</h2>\n  <p><a href='#sites'>Manage Sites</a></p>\n"):__p.push("\n  <h2>",siteName," - User Accounts (",users.length,")</h2>\n"),__p.push("\n\n<div class='filter-panel'>\n  ",partials.dropdownInput({field_name:"statusFilter",field_title:"Filter",field_instructions:"",field_value:statusFilter,no_blank:!0,options:accountFilterTypes,error:!1})," \n</div>\n\n"),0==users.length?__p.push(" \n  <div class='no-users-panel'>\n    No users of this type were found.\n  </div>\n"):(__p.push('\n  <table class="table table-striped">\n    <tr>\n      <th>Full Name</th>\n      <th>Username</th>\n      <th>Email</th> \n      '),isAdmin&&__p.push(" \n        <th>Site Name</th> \n        <th>User Type</th>\n      "),__p.push("\n      <th>Status</th> \n      <th>Actions</th>\n    </tr>\n    "),_.each(users,function(t){__p.push(" \n      <tr>\n        <td>",t.full_name,"</td>\n        <td>",t.username,"</td>\n        <td>",t.email,"</td>\n        "),isAdmin&&__p.push(" \n          <td>",t.site_name,"</td> \n          <td>",t.user_type,"</td> \n        "),__p.push("\n        <td>\n          "),"active"==t.account_status?__p.push('\n            <span class="label label-success">active</span>\n          '):"pending"==t.account_status?__p.push('\n            <span class="label label-warning">pending</span>\n          '):__p.push('\n            <span class="label label-default">archived</span>\n          '),__p.push('\n        </td>\n        <td>\n          <button data-id="',t.id,'" class="btn btn-default btn-sm edit-user-button"><i class="fa fa-pencil fa-lg"></i> Edit</button>\n          '),"pending"!=t.account_status&&"archived"!=t.account_status||__p.push(' \n            <button data-id="',t.id,'" class="btn btn-success btn-sm activate-user-button"><i class="fa fa-check fa-lg"></i> Activate</button>\n          '),__p.push("\n        </td>\n      </tr>\n    ")}),__p.push("\n  </table>\n")),__p.push("\n\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/xml-editor"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("\n<div class='btn-toolbar xml-editor-toolbar'>\n\n  "),showTags&&(__p.push('\n    <div class="dropdown">\n      <button id="xml-tag-dropdown" class="btn btn-sm btn-default dropdown-toggle" type="button" data-toggle="dropdown">\n        Tags\n        <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu scrollable-menu">\n        '),_.each(tags,function(t){__p.push("\n          "),"pb"==t?__p.push("\n            <li><a class='pb-button' data-tag-id='",t,'\' href="#">',t,"</a></li>\n          "):__p.push("\n            <li><a class='tag-menu-item' data-tag-id='",t,'\' href="#">',t,"</a></li>\n          "),__p.push("\n        ")}),__p.push("\n      </ul>\n    </div>\n\n    <button class='tag-menu-item toolbar-button btn btn-sm btn-default' data-tag-id='milestone' href='#' >milestone</button>\n    <button class='pb-button toolbar-button btn btn-sm btn-default' data-tag-id='pb' href='#'>pb</button>\n    <button class='tag-menu-item toolbar-button btn btn-sm btn-default' data-tag-id='ab' href='#' >ab</button>\n    <button class='lb-mode-button btn btn-sm btn-default' data-tag-id='lb' href='#' >lb</button>\n\n  ")),__p.push('\n\n  <div class="status-message">',statusMessage,'</div>\n  <div class="error-message"></div>\n\n  <div class=\'actions ',actionWidthClass,'\' >\n\t<button id="buttonRelink" class=\'toolbar-button btn btn-sm btn-default relink-button\' href=\'#\' ><i class="fa fa-link" aria-hidden="true"></i> Relink</button>\n\t<button class=\'toolbar-button btn btn-sm btn-default preview-button\' href=\'#\' ><i class="fa fa-cloud-upload" aria-hidden="true"></i> Preview</button>\n    '),showPublishButton&&__p.push("\n      <button class='toolbar-button btn btn-sm btn-default publish-button ",published?"hidden":"","' href='#' ><i class=\"fa fa-star\" aria-hidden=\"true\"></i> Accept</button>\n      <button class='toolbar-button btn btn-sm btn-default unpublish-button ",published?"":"hidden",'\' href=\'#\' ><i class="fa fa-star-o" aria-hidden="true"></i> Return</button>\n    '),__p.push("\n\n    "),showReturnButton&&__p.push("\n      <button class='toolbar-button btn btn-sm btn-default return-button ",submitted?"":"hidden",'\' href=\'#\' ><i class="fa fa-send-o" aria-hidden="true"></i> Return to Sender</button>\n    '),__p.push("\n\n    "),showActionMenu&&(__p.push('\n      <div class="dropdown">\n        <button id="action-dropdown" class="btn btn-sm btn-default dropdown-toggle" type="button" data-toggle="dropdown">\n          <i class="fa fa-bars" aria-hidden="true"></i>\n        </button>\n        <ul class="dropdown-menu">\n          '),showSubmitButton&&__p.push("\n            <li><a class='submit-button ",submitted?"hidden":"",'\' href="#"><i class="fa fa-send" aria-hidden="true"></i> Submit</a></li>\n          '),__p.push("\n          <li><a class='share-button ",shared?"hidden":"",'\' href="#"><i class="fa fa-share-square" aria-hidden="true"></i> Share</a></li>\n          <li><a class=\'stop-sharing-button ',shared?"":"hidden",'\' href="#"><i class="fa fa-share-square-o" aria-hidden="true"></i> Stop Sharing</a></li>\n          <li><a class=\'rename-button\' href="#"><i class="fa fa-pencil-square" aria-hidden="true"></i> Rename</a></li>\n          <li><a class=\'delete-button\' href="#"><i class="fa fa-trash" aria-hidden="true"></i> Delete</a></li>\n        </ul>\n      </div>\n    ')),__p.push("\n\n  </div>\n\n</div>\n\n<div id='editor-viewport'>\n  <textarea id='codemirror'></textarea>\n</div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["textlab/templates/zone-popover"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push(""),"xml"==editMode?(__p.push('\n\t<button class="popover-button btn btn-sm btn-default" data-tag-id="add" href="#">add</button>\n\t<button class="popover-button btn btn-sm btn-default" data-tag-id="del" href="#">del</button>\n\t<button class="popover-button btn btn-sm btn-default" data-tag-id="restore" href="#">restore</button>\n\t<button class="popover-button btn btn-sm btn-default" data-tag-id="metamark" href="#">metamark</button>\n\t<button class="popover-button btn btn-sm btn-default" data-tag-id="subst" href="#">subst</button>\n\t'),secondaryEnabled&&__p.push(' \n\t\t<button class="popover-button btn btn-sm btn-default" data-tag-id="new-sequence" href="#">New Sequence</button>\n\t'),__p.push("\n")):__p.push('\n\t<button class="popover-button btn btn-sm btn-default" data-tag-id="add-step" href="#">Add Step</button>\n'),__p.push("\n");return __p.join("")}}.call(this),TextLab.AttributeModalDialog=Backbone.View.extend({template:JST["textlab/templates/attribute-modal-dialog"],attributeTemplate:_.template('<%= key %>="<%= value %>" '),fieldIDTemplate:_.template("<%= index %>-att-<%= key %>"),id:"attribute-modal-container",partials:{stringInput:JST["textlab/templates/common/string-input"],dropdownInput:JST["textlab/templates/common/dropdown-input"],numberInput:JST["textlab/templates/common/number-input"]},events:{"click .create-button":"onCreate","click .cancel-button":"onCancel"},initialize:function(t){this.tag=t.tag,this.currentZone=t.zone,this.callback=t.callback,this.config=t.config,_.bindAll(this,"renderAttributeField")},parseElementFields:function(t,e){var i=[];_.each(t.attributes,_.bind(function(t,n){var r=this.fieldIDTemplate({index:e,key:n}),o=$("#"+r).val();if(t.appendTo){var s=_.find(i,function(e){return e.key==t.appendTo});s.value=s.value+" "+o}else{var a={key:n,value:o,attr:t};i.push(a)}},this));var n=" ",r=null;return _.each(i,_.bind(function(t){var e=this.attributeTemplate(t);if("zone"==t.attr.fieldType&&null!=t.value){var i=/="/.exec(e);r=i.index+n.length+2}n+=e},this)),{tag:t,attrString:n,zoneOffset:r}},onCreate:function(){var t=0,e=this.parseElementFields(this.tag,t),i=_.map(this.tag.elements,function(e){return t+=1,this.parseElementFields(this.config.tags[e],t)},this);this.close(_.bind(function(){this.callback(e,i)},this))},onCancel:function(){this.close()},close:function(t){var e=$("#attributes-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},renderAttributeField:function(t,e,i,n){if("zone"==e.fieldType){var r=this.model.getZoneLabelPrefix(),o=this.currentZone?r+this.currentZone.get("zone_label"):"";return this.partials.dropdownInput({field_name:this.fieldIDTemplate({index:t,key:i}),field_title:e.displayName,field_value:o,field_instructions:e.instructions,no_blank:!0,options:n,error:!1})}return this.partials[e.fieldType+"Input"]({field_name:this.fieldIDTemplate({index:t,key:i}),field_title:e.displayName,field_value:e.defaultValue?e.defaultValue:"",field_instructions:e.instructions,options:"string"==typeof e.vocab?this.config.vocabs[e.vocab]:e.vocab,error:!1})},render:function(){var t=this.model.getZoneLabelPrefix(),e=_.map(this.model.zones.models,function(e){return{value:t+e.get("zone_label"),text:e.get("zone_label")}}),i=_.sortBy(e,function(t){return t.text},this);this.$el.html(this.template({tag:this.tag,zones:i,config:this.config,partials:this.partials,renderAttributeField:this.renderAttributeField})),$("#modal-container").html(this.$el);var n=$("#attributes-modal");n.on("shown.bs.modal",function(){n.draggable({handle:".modal-header"})}),n.modal({backdrop:!1})}}),TextLab.DocumentExplorer=Backbone.View.extend({template:JST["textlab/templates/document-explorer"],thumbnailURLTemplate:_.template("<%= src %>/full/<%= width %>,/0/default.jpg"),thumbWidth:100,id:"document-explorer",events:{"click .document-node":"onClickNode","click #edit-info-button":"onEditInfo","click .breadcrumb":"onClickBreadcrumb"},initialize:function(t){this.currentSection=null,this.mainViewport=t.mainViewport,this.documentTree=t.documentTree},selectSection:function(t){this.currentSection=t,this.render()},selectNodeByID:function(t){var e=_.find(this.model.documentNodes.models,function(e){return e.id==t});if(e.isLeaf()){var i=e.getLeaf();this.mainViewport.selectLeaf(i)}else this.selectSection(e);this.documentTree.highlightNode(e)},onClickNode:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-id"));this.selectNodeByID(i)},onClickBreadcrumb:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-id"));return this.selectNodeByID(i),!1},onEditInfo:function(){var t=_.bind(function(t){t.save(null,{success:_.bind(function(){this.render(),this.documentTree.render()},this),error:TextLab.Routes.routes.onError})},this),e=_.bind(function(t){this.documentTree.deleteSectionNode(t),t.destroy({success:_.bind(function(){this.mainViewport.selectSection(null)},this),error:TextLab.Routes.onError})},this),i=this.currentSection.getSection();return new TextLab.SectionDialog({model:i,callback:t,deleteCallback:e,mode:"edit"}).render(),!1},render:function(){var t=[],e=[],i="";if(this.currentSection){var n=_.sortBy(this.currentSection.getChildren(),function(t){return t.get("position")});t=_.map(n,function(t){if(t.isLeaf()){var e=t.getLeaf();if(e.get("tile_source")){var i=this.thumbnailURLTemplate({src:e.get("tile_source"),width:this.thumbWidth});return{nodeType:"thumb",name:e.get("name"),imgSrc:i,id:t.id}}return{nodeType:"blank-thumb",name:e.get("name"),id:t.id}}if(t.isSection()){return{nodeType:"section",name:t.getSection().get("name"),id:t.id}}},this),e=_.map(this.currentSection.getAncestors(),function(t){return{name:t.getSection().get("name"),id:t.id}}),i=this.currentSection.getSection().get("name")}this.$el.html(this.template({name:i,ancestors:e,items:t,canEditSection:this.model.get("owner")}))}}),TextLab.DocumentListView=Backbone.View.extend({template:JST["textlab/templates/document-list-view"],id:"document-list-view",events:{"click .new-document-button":"onNewDocument","click .yes-button":"onAcceptInvite","click .no-button":"onDeclineInvite","click .delete-document-button":"onDeleteDocument"},initialize:function(){},onNewDocument:function(){var t=_.bind(function(t){this.collection.add(t),t.save(null,{success:_.bind(function(){this.render()},this)})},this),e=new TextLab.Document;e.getProjectConfigs(_.bind(function(i){new TextLab.NewDocumentDialog({model:e,projectConfigs:i,callback:t}).render()},this))},onAcceptInvite:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-doc-id")),n=this.collection.findWhere({id:i}),r=n.get("membership_id");new TextLab.Membership({id:r,accepted:!0}).save(null,{success:_.bind(function(){n.set("accepted",!0),this.render()},this),error:TextLab.Routes.routes.onError})},onDeclineInvite:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-doc-id")),n=this.collection.findWhere({id:i}),r=n.get("membership_id");new TextLab.Membership({id:r}).destroy({success:_.bind(function(){this.collection.remove(n),this.render()},this),error:TextLab.Routes.routes.onError})},onDeleteDocument:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-doc-id")),n=this.collection.get(i);e.confirmation("show"),this.$el.on("confirmed.bs.confirmation",_.bind(function(){n.destroy({success:_.bind(function(){this.render()},this)})},this))},render:function(){this.$el.html(this.template({documents:this.collection.toJSON()}))}}),TextLab.DocumentTreeView=Backbone.View.extend({template:JST["textlab/templates/document-tree-view"],id:"document-tree-view",glyphConfig:{map:{expanderClosed:"fa fa-plus-square",expanderOpen:"fa fa-plus",loading:"glyphicon glyphicon-refresh",dragHelper:"glyphicon glyphicon-play",dropMarker:"glyphicon glyphicon-arrow-right"}},events:{"click .add-leaf-button":"onAddLeaf","click .add-section-button":"onAddSection","click .edit-settings-button":"onEditProjectSettings"},initialize:function(t){this.mainViewport=t.mainViewport,this.readOnly=t.readOnly,_.bindAll(this,"onNodeSelected","onDragEnter","onDragDrop")},insertAt:function(){var t=this.getSelectedNode();if(t.isSection()){return{parent:t,position:t.getChildren().length}}return{parent:t.getParent(),position:t.get("position")}},addDocumentNode:function(t){var e=t.get("position"),i=this.model.documentNodes.findWhere({id:t.get("document_node_id")}),n=_.sortBy(i.getChildren(),function(t){return t.get("position")}),r=e+1,o=null!=t.get("leaf_manifest");_.each(n,function(t){t.get("position")>=e&&(t.set("position",r),r+=1)});var s=_.bind(function(){o?location.reload():(this.render(),this.mainViewport.onDocumentTreeChanged()),console.log("update tree success")},this);this.model.documentNodes.add(t),t.save(null,{success:s,error:TextLab.Routes.routes.onError})},deleteLeafNode:function(t){var e=this.model.documentNodes,i=e.findWhere({leaf_id:t.id});e.remove(i),this.render(),this.mainViewport.onDocumentTreeChanged()},deleteSectionNode:function(t){var e=this.model.documentNodes,i=e.findWhere({document_section_id:t.id});e.remove(i),this.render()},onAddLeaf:function(){var t=_.bind(function(t){this.model.addLeaf(t),t.save(null,{success:_.bind(function(t){var e=this.insertAt(),i=new TextLab.DocumentNode({document_node_id:e.parent.id,position:e.position,leaf_id:t.id,document_id:this.model.id});this.addDocumentNode(i)},this),error:TextLab.Routes.routes.onError})},this),e=new TextLab.Leaf;new TextLab.LeafDialog({model:e,callback:t}).render()},onAddSection:function(){var t=_.bind(function(t){var e=t.get("leaf_manifest");t.unset("leaf_manifest"),this.model.addSection(t),t.save(null,{success:_.bind(function(t){var i=this.insertAt(),n=new TextLab.DocumentNode({document_node_id:i.parent.id,position:i.position,document_section_id:t.id,document_id:this.model.id,leaf_manifest:e});this.addDocumentNode(n)},this),error:TextLab.Routes.routes.onError})},this),e=new TextLab.DocumentSection;new TextLab.SectionDialog({model:e,callback:t}).render()},onEditProjectSettings:function(){var t=_.bind(function(t,e){t.save(null,{success:_.bind(function(){var i=t.get("name"),n=t.getRootNode(),r=n.getSection();r.get("name")!=i&&(r.set("name",i),r.save(null,{success:_.bind(function(){this.render()},this),error:TextLab.Routes.routes.onError})),e&&this.mainViewport.onConfigChanged(this.model.config)},this),error:TextLab.Routes.routes.onError})},this);return this.model.getProjectConfigs(_.bind(function(e){new TextLab.EditSettingsDialog({model:this.model,projectConfigs:e,callback:t}).render()},this)),!1},onNodeSelected:function(t,e){var i=e.node.data.docNode;if(i.isLeaf()){var n=i.getLeaf();this.mainViewport.selectLeaf(n)}else this.mainViewport.selectSection(i)},highlightNode:function(t){this.fancyTree.getNodeByKey(t.id.toString()).setActive(!0)},onDragEnter:function(t){console.log("Drag enter");var e=t.data.docNode;return e.isRoot()||this.readOnly?[]:e.isSection()?["before","after","over"]:["before","after"]},onDragDrop:function(t,e){var i=function(t){var e=t.children,i=t.data.docNode.id,n=0;return _.map(e,function(t){var e=t.data.docNode;return e.set("position",n++),e.set("document_node_id",i),e.toJSON()})},n=e.otherNode,r=n.parent;n.moveTo(t,e.hitMode);var o=n.parent,s=_.union(i(r),i(o));$.ajax({method:"PUT",url:"/document_nodes/update_set",data:{nodes:JSON.stringify(s)},success:this.mainViewport.onDocumentTreeChanged,error:TextLab.Routes.onError})},canDrag:function(){return this.dndEnabled},getSelectedNode:function(){var t=this.fancyTree.getActiveNode();return t?t.data.docNode:this.model.getRootNode()},generateTreeNode:function(t){var e;return t.isRoot()?(e=_.map(t.getChildren(),function(t){return this.generateTreeNode(t)},this),this.generateRootNode(t,e)):t.isSection()?(e=_.map(t.getChildren(),function(t){return this.generateTreeNode(t)},this),this.generateSectionNode(t,e)):this.generateLeafNode(t)},generateLeafNode:function(t){var e=t.getLeaf();return{key:t.id,title:e.get("name"),docNode:t,children:[],icon:"fa fa-file-o fa-lg"}},generateSectionNode:function(t,e){var i=t.getSection(),n=_.sortBy(e,function(t){return t.docNode.get("position")});return{key:t.id,title:i.get("name"),docNode:t,expanded:!1,children:n,icon:"fa fa-lg fa-folder"}},generateRootNode:function(t,e){var i=this.generateSectionNode(t,e);return i.key="root",i.expanded=!0,i.icon="fa fa-lg fa-book",[i]},generateTreeModel:function(){var t=this.model.getRootNode();return this.generateTreeNode(t)},render:function(){var t=this.generateTreeModel();if(this.fancyTree)this.fancyTree.reload(t);else{this.$el.html(this.template({owner:this.model.get("owner")}));var e=this.$("#document-tree");e.fancytree({source:t,click:this.onNodeSelected,selectMode:2,aria:!0,extensions:["dnd","glyph","clones"],glyph:this.glyphConfig,dnd:{focusOnClick:!0,dragStart:this.canDrag,dragEnter:this.onDragEnter,dragDrop:this.onDragDrop}}),this.fancyTree=e.fancytree("getTree")}}}),TextLab.EditSettingsDialog=Backbone.View.extend({template:JST["textlab/templates/edit-settings-dialog"],publishURLTemplate:_.template("<%= loc.protocol %>//<%= loc.hostname %><%= (loc.port==null||loc.port==80) ? '' : ':'+loc.port %>/document_sections/<%= id %>.html"),fieldTitleTemplate:_.template("Publish project to: <a target='_blank' href='<%= publishURL %>'><%= publishURL %></a>."),id:"settings-dialog-container",partials:{stringInput:JST["textlab/templates/common/string-input"],checkMark:JST["textlab/templates/common/check-mark"],dropdownInput:JST["textlab/templates/common/dropdown-input"]},events:{"click .update-button":"onUpdate","click .cancel-button":"onCancel"},initialize:function(t){this.callback=t.callback,this.projectConfigs=t.projectConfigs},onUpdate:function(){this.close(_.bind(function(){var t=this.$("#projectConfig").val(),e=t!=this.model.get("project_config_id");this.model.set({name:this.$("#name").val(),description:this.$("#description").val(),published:this.$("#published").is(":checked"),project_config_id:t}),e?this.model.updateProjectConfig(t,_.bind(function(){this.callback(this.model,!0)},this)):this.callback(this.model,!1)},this))},
onCancel:function(){this.close()},close:function(t){var e=$("#edit-settings-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){var t=this.model.getRootNode(),e=t.getSection(),i=this.publishURLTemplate({loc:window.location,id:e.id}),n=this.fieldTitleTemplate({publishURL:i}),r=_.map(this.projectConfigs.models,function(t){return{value:t.id,text:t.get("name")}});this.$el.html(this.template({document:this.model.toJSON(),partials:this.partials,projectConfigs:r,publishFieldTitle:n})),this.membersPanel=new TextLab.MembersPanel({collection:this.model.members}),this.membersPanel.render(),this.$("#"+this.membersPanel.id).replaceWith(this.membersPanel.$el),$("#modal-container").html(this.$el);var o=$("#edit-settings-modal");o.on("shown.bs.modal",function(){o.draggable({handle:".modal-header"})}),o.modal({backdrop:!1})}}),TextLab.LeafDialog=Backbone.View.extend({template:JST["textlab/templates/leaf-dialog"],id:"leaf-dialog-container",partials:{stringInput:JST["textlab/templates/common/string-input"]},events:{"click .ok-button":"onOK","click .cancel-button":"onCancel","click .delete-button":"onDelete"},initialize:function(t){this.callback=t.callback,this.deleteCallback=t.deleteCallback,this.mode=t.mode},onOK:function(){this.close(_.bind(function(){this.model.set({name:this.$("#name").val(),xml_id:this.$("#xml_id").val(),tile_source:this.$("#tile_source").val()}),this.callback(this.model)},this))},onCancel:function(){this.close()},onDelete:function(){this.close(_.bind(function(){this.deleteCallback(this.model)},this))},close:function(t){var e=$("#leaf-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){this.$el.html(this.template({leaf:this.model,partials:this.partials,mode:this.mode})),$("#modal-container").html(this.$el);var t=$("#leaf-modal");t.on("shown.bs.modal",function(){t.draggable({handle:".modal-header"})}),t.modal({backdrop:!1})}}),TextLab.LeafManifestPanel=Backbone.View.extend({template:JST["textlab/templates/leaf-manifest-panel"],id:"leaf-manifest-panel",importMessageTemplate:_.template("Found <%= count %> leaves to import."),dropZoneMessageTemplate:_.template('+ <%= count %> <i class="fa fa-file-o fa-lg"></i> Leaves'),importErrorMessage:"<span class='error'>Unable to parse selected file.</span>",mimeTypeErrorMessage:"<span class='error'>Manifest file must be in CSV Format.</span>",dropZoneInstructions:"Drop Leaf Manifest Here",events:{"drop #drop-zone":"handleFileSelect","dragover #drop-zone":"handleDragOver"},initialize:function(){},parseIIIFManifest:function(t){var e=JSON.parse(t);if(null==e)return[];var i=[];return sequence=_.first(e.sequences),null!=sequence&&null!=sequence.canvases&&(i=_.map(sequence.canvases,function(t){var e=_.first(t.images);if(null!=e&&null!=e.resource&&null!=e.resource.service)return{name:t.label,xml_id:e.resource.service["@id"],tile_source:e.resource.service["@id"]}})),i},parseLeafManifest:function(t){var e=t.split("\n"),i=[];return _.each(e,function(t){var e=t.split(",");if(3!=e.length)return null;for(var n={},r=0;r<e.length;r++){var o=e[r];0==r?n.name=o:1==r?n.xml_id=o:2==r&&(n.tile_source=o)}i.push(n)}),i},handleFileSelect:function(t){var e=t.originalEvent;e.stopPropagation(),e.preventDefault();var i=e.dataTransfer.files,n=new FileReader,r=_.bind(function(t){$(".import-message").html(this.importMessageTemplate({count:t.length})),this.$(".drop-zone-message").html(this.dropZoneMessageTemplate({count:t.length})),this.model.set("leaf_manifest",JSON.stringify(t))},this),o=_.bind(function(){$(".import-message").html(this.importErrorMessage),this.$(".drop-zone-message").html(this.dropZoneInstructions),this.model.set("leaf_manifest",null)},this);n.onload=_.bind(function(){var t=this.parseLeafManifest(n.result);t.length>0?r(t):(t=this.parseIIIFManifest(n.result),t.length>0?r(t):o())},this);var s=_.first(i);n.readAsText(s)},handleDragOver:function(t){var e=t.originalEvent;e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},render:function(){this.$el.html(this.template({dropZoneInstructions:this.dropZoneInstructions}))}}),TextLab.MembersPanel=Backbone.View.extend({template:JST["textlab/templates/members-panel"],id:"members-panel",events:{"click .invite-user-button":"onInviteUser","click .remove-member-button":"onRemoveMember","click .cancel-invite-button":"onRemoveMember"},initialize:function(){this.validationMessage=""},onInviteUser:function(){var t=this.$("#invite-username").val();new TextLab.Membership({username:t,document_id:this.collection.document.id,primary_editor:!0,secondary_editor:!1}).save(null,{success:_.bind(function(t){t.get("validation_message")?this.validationMessage=t.get("validation_message"):(this.collection.add(t),this.validationMessage=""),this.render()},this),error:TextLab.Routes.routes.onError})},onRemoveMember:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-member-id")),n=this.collection.findWhere({id:i});n.destroy({success:_.bind(function(){this.collection.remove(n),this.render()},this),error:TextLab.Routes.routes.onError})},render:function(){this.$el.html(this.template({members:this.collection.toJSON(),validationMessage:this.validationMessage}))}}),TextLab.NarrativeStepDialog=Backbone.View.extend({template:JST["textlab/templates/narrative-step-dialog"],id:"narrative-step-dialog-container",partials:{dropdownInput:JST["textlab/templates/common/dropdown-input"],numberInput:JST["textlab/templates/common/number-input"]},events:{"click .ok-button":"onOK","click .cancel-button":"onCancel"},initialize:function(t){this.callback=t.callback,this.mode=t.mode,this.zones=t.zones},onOK:function(){this.close(_.bind(function(){var t=this.$("#narrative").summernote("code"),e=this.$("#step").summernote("code");this.model.set({zone_id:this.$("#zone_id").val(),step:e,narrative:t}),this.callback(this.model)},this))},onCancel:function(){this.close()},close:function(t){var e=$("#step-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){this.$el.html(this.template({zones:this.zones,model:this.model.toJSON(),partials:this.partials,mode:this.mode})),$("#modal-container").html(this.$el);var t=$("#step-modal");t.on("shown.bs.modal",function(){t.draggable({handle:".modal-header"})}),t.modal({backdrop:!1});var e=[["style",["bold","italic","underline","strikethrough","clear"]]];$("#step").summernote({toolbar:e}),$("#narrative").summernote({toolbar:e})}}),TextLab.NewDocumentDialog=Backbone.View.extend({template:JST["textlab/templates/new-document-dialog"],id:"document-dialog-container",partials:{stringInput:JST["textlab/templates/common/string-input"],dropdownInput:JST["textlab/templates/common/dropdown-input"]},events:{"click .create-button":"onCreate","click .cancel-button":"onCancel"},initialize:function(t){this.callback=t.callback,this.projectConfigs=t.projectConfigs},onCreate:function(){this.close(_.bind(function(){this.model.set({name:this.$("#name").val(),description:this.$("#description").val(),project_config_id:this.$("#projectConfig").val()}),this.callback(this.model)},this))},onCancel:function(){this.close()},close:function(t){var e=$("#new-document-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){var t=_.map(this.projectConfigs.models,function(t){return{value:t.id,text:t.get("name")}});this.$el.html(this.template({document:this.model,projectConfigs:t,partials:this.partials})),this.$("#leaf-manifest-panel");var e=this.$("#leaf-manifest-panel");this.leafManifestPanel=new TextLab.LeafManifestPanel({el:e,model:this.model}),this.leafManifestPanel.render(),$("#modal-container").html(this.$el),$("#new-document-modal").modal("show")}}),TextLab.OpenTabDialog=Backbone.View.extend({template:JST["textlab/templates/open-tab-dialog"],listEntryTemplate:_.template("<%= name %> (transcription)"),id:"open-tab-dialog-container",partials:{dropdownInput:JST["textlab/templates/common/dropdown-input"]},events:{"click .ok-button":"onOK","click .cancel-button":"onCancel"},initialize:function(t){this.callback=t.callback,this.transcriptions=t.transcriptions,this.sequences=t.sequences},onOK:function(){var t=$("#tab").val(),e="s"==t[0]?"sequence":"transcription",i=t.substr(1);this.close(_.bind(function(){if("transcription"==e){var t=_.find(this.transcriptions,function(t){return t.id==i});this.callback(t,e)}else{var n=_.find(this.sequences,function(t){return t.id==i});this.callback(n,e)}},this))},onCancel:function(){this.close()},close:function(t){var e=$("#open-tab-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){var t=_.map(this.transcriptions,function(t){return{value:"t"+t.id,text:t.get("name")+" (transcription)"}},this),e=_.map(this.sequences,function(t){return{value:"s"+t.id,text:t.get("name")+" (sequence)"}},this);dropDownList=_.sortBy(_.union(t,e),function(t){return t.text}),this.$el.html(this.template({tabs:dropDownList,partials:this.partials})),$("#modal-container").html(this.$el),$("#open-tab-modal").modal("show")}}),TextLab.PrimaryEditingView=Backbone.View.extend({template:JST["textlab/templates/primary-editing-view"],id:"primary-editing-view",initialize:function(){_.bindAll(this,"onWindowResize","onSplitPaneResize","supressBackspaceNav")},onWindowResize:function(){var t=$(window),e=t.height(),i=t.width(),n=this.$el.offset().top,r=this.$el.offset().left,o=e-n,s=i-r;this.$el.height(o),this.$el.width(s),this.onSplitPaneResize()},onSplitPaneResize:function(){var t=this.$("#surface-view-panel"),e=this.$("#openseadragon");e.height(t.height()),e.width(t.width());var i=this.$("#document-tree-panel"),n=this.$("#document-tree"),r=this.$("#document-toolbar");n.height(i.height()-r.height()-25),n.width(i.width());var o=this.$("#explorer-view"),s=this.$("#document-explorer");if(s.height(o.height()),s.width(o.width()),this.tabbedEditor.resizeActivePanel(),this.surfaceView.viewReady){var a=this.surfaceView.overlay;a.resize(),a.resizecanvas()}},onDocumentTreeChanged:function(){this.documentExplorer.render()},onConfigChanged:function(t){this.tabbedEditor&&this.tabbedEditor.onConfigChanged(t)},supressBackspaceNav:function(t){if(8==t.keyCode){var e=$(document.activeElement),i=e.hasClass("form-control"),n=e.hasClass("note-editable");i||n||t.preventDefault()}},selectSection:function(t){var e=null==t?this.model.getRootNode():t;this.$(".editor-view").hide(),this.documentExplorer.selectSection(e),this.$(".explorer-view").show()},selectLeaf:function(t){this.$(".explorer-view").hide(),this.$(".editor-view").show(),this.selectedLeaf=t,this.tabbedEditor.selectLeaf(t),this.surfaceView.selectLeaf(t)},render:function(){this.selectedLeaf||(this.selectedLeaf=_.first(this.model.leafs.models)),this.$el.html(this.template()),this.$("div.split-pane").splitPane(),this.documentTreeView=new TextLab.DocumentTreeView({model:this.model,mainViewport:this,readOnly:!this.model.get("owner")}),this.documentTreeView.render(),this.$("#"+this.documentTreeView.id).replaceWith(this.documentTreeView.$el);var t=this.$("#xml-editor-panel");this.tabbedEditor=new TextLab.TabbedEditor({model:this.selectedLeaf,config:this.model.config,parentPanel:t,projectOwner:this.model.get("owner")}),this.tabbedEditor.render(),this.$("#"+this.tabbedEditor.id).replaceWith(this.tabbedEditor.$el),this.surfaceView=new TextLab.SurfaceView({model:this.selectedLeaf,owner:this.model.get("owner"),tabbedEditor:this.tabbedEditor,documentTree:this.documentTreeView,mainViewport:this}),this.surfaceView.render(),this.$("#"+this.surfaceView.id).replaceWith(this.surfaceView.$el),this.documentExplorer=new TextLab.DocumentExplorer({model:this.model,mainViewport:this,documentTree:this.documentTreeView}),this.documentExplorer.render(),this.$("#"+this.documentExplorer.id).replaceWith(this.documentExplorer.$el)},postRender:function(){this.surfaceView.initViewer(),this.tabbedEditor.postRender(this.surfaceView),$(window).resize(this.onWindowResize),$("div.split-pane").on("dividerdragend",this.onSplitPaneResize),$(window).on("keydown",this.supressBackspaceNav)}}),TextLab.SectionDialog=Backbone.View.extend({template:JST["textlab/templates/section-dialog"],id:"section-dialog-container",partials:{stringInput:JST["textlab/templates/common/string-input"]},events:{"click .ok-button":"onOK","click .cancel-button":"onCancel","click .delete-button":"onDelete"},initialize:function(t){this.callback=t.callback,this.deleteCallback=t.deleteCallback,this.mode=t.mode},onOK:function(){this.close(_.bind(function(){this.model.set({name:this.$("#name").val()}),this.callback(this.model)},this))},onCancel:function(){this.close()},onDelete:function(){this.$(".delete-button").confirmation("show"),this.$el.on("confirmed.bs.confirmation",_.bind(function(){this.close(_.bind(function(){this.deleteCallback(this.model)},this))},this))},close:function(t){var e=$("#section-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){this.$el.html(this.template({section:this.model,partials:this.partials,mode:this.mode})),"edit"!=this.mode&&(this.leafManifestPanel=new TextLab.LeafManifestPanel({model:this.model}),this.leafManifestPanel.render(),this.$("#"+this.leafManifestPanel.id).replaceWith(this.leafManifestPanel.$el)),$("#modal-container").html(this.$el);var t=$("#section-modal");t.on("shown.bs.modal",function(){t.draggable({handle:".modal-header"})}),t.modal({backdrop:!1})}}),TextLab.SequenceEditor=Backbone.View.extend({template:JST["textlab/templates/sequence-editor"],gridTemplate:JST["textlab/templates/sequence-grid"],id:"sequence-editor",events:{"click .add-step-button":"onClickAddStep","click .edit-step-button":"onClickEditStep","click .delete-step-button":"onClickDeleteStep","click .zone-link":"onClickZoneLink","click .publish-button":"onClickPublish","click .unpublish-button":"onClickUnPublish","click .share-button":"onClickShare","click .stop-sharing-button":"onClickStopSharing","click .submit-button":"onClickSubmit","click .return-button":"onClickReturn","click .rename-button":"onClickRename","click .delete-button":"onClickDelete","click .up-step-button":"onClickStepUp","click .down-step-button":"onClickStepDown"},initialize:function(t){this.leaf=t.leaf,this.tabbedEditor=t.tabbedEditor,this.surfaceView=t.surfaceView},onClickPublish:function(){this.tabbedEditor.starTab("sequence",this.model.id)},onClickUnPublish:function(){this.tabbedEditor.unStarTab("sequence",this.model.id)},onClickShare:function(){return this.updateSharing(!0),!1},onClickStopSharing:function(){return this.updateSharing(!1),!1},updateSharing:function(t){this.$("#action-dropdown").dropdown("toggle"),this.model.set("shared",t),this.model.save(null,{success:_.bind(function(){var e=this.$(".share-button"),i=this.$(".stop-sharing-button");t?(e.addClass("hidden"),i.removeClass("hidden")):(i.addClass("hidden"),e.removeClass("hidden"))},this)})},onClickSubmit:function(){return this.$("#action-dropdown").dropdown("toggle"),confirm("Do you wish to submit this sequence for publication?")&&this.tabbedEditor.submitTab("sequence",this.model),!1},onClickReturn:function(){return this.$("#action-dropdown").dropdown("toggle"),confirm("Do you wish to return this sequence to its owner?")&&this.tabbedEditor.returnTab("sequence",this.model),!1},onClickRename:function(){var t=_.bind(function(t){t.save(null,{success:_.bind(function(){this.tabbedEditor.renameTab("sequence",this.model.id,this.model.get("name"))},this)})},this);return new TextLab.TabDialog({model:this.model,callback:t,mode:"edit"}).render(),!1},onClickDelete:function(){return this.$("#action-dropdown").dropdown("toggle"),confirm("Do you wish to delete the transcription titled '"+this.model.get("name")+"'? ")&&this.tabbedEditor.deleteTab("sequence",this.model),!1},moveStep:function(t,e){this.$(".arrow-button").addClass("disabled");var i=this.model.narrativeSteps,n=i.findWhere({id:t}),r=n.get("step_number"),o=r+e,s=i.findWhere({step_number:o});n.set("new_step_number",o),n.save(null,{success:_.bind(function(){s.set("step_number",r),i.sort(),this.renderGrid()},this)})},onClickStepUp:function(t){var e=this.$(t.currentTarget),i=parseInt(e.attr("data-step-id"));return this.moveStep(i,-1),!1},onClickStepDown:function(t){var e=this.$(t.currentTarget),i=parseInt(e.attr("data-step-id"));return this.moveStep(i,1),!1},onClickAddStep:function(){this.activateNarrativeStepDialog(null,null)},activateNarrativeStepDialog:function(t,e){var i=_.bind(function(t){this.model.narrativeSteps.add(t),t.save(null,{success:_.bind(function(){this.renderGrid()},this)})},this),n=this.generateZoneList(),r=this.model.narrativeSteps.models.length;if(null==t)if(r>0){var o=this.model.narrativeSteps.findWhere({step_number:r-1});t=o.get("step")}else t="";var s=new TextLab.NarrativeStep({step_number:r,step:t,zone_id:e,sequence_id:this.model.id});new TextLab.NarrativeStepDialog({zones:n,model:s,callback:i}).render()},onClickEditStep:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-step-id")),n=this.model.narrativeSteps.get(i),r=_.bind(function(t){t.save(null,{success:_.bind(function(){this.renderGrid()},this)})},this),o=this.generateZoneList();return new TextLab.NarrativeStepDialog({zones:o,model:n,callback:r,mode:"edit"}).render(),!1},onClickZoneLink:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-zone-id")),n=this.leaf.zones.get(i);return this.surfaceView.selectZone(n),!1},generateZoneList:function(){var t=_.map(this.leaf.zones.models,function(t){return{value:t.id,text:t.get("zone_label")}});return _.sortBy(t,function(t){return t.text},this)},onClickDeleteStep:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-step-id")),n=this.model.narrativeSteps.get(i);return e.confirmation("show"),e.on("confirmed.bs.confirmation",_.bind(function(){n.destroy({success:_.bind(function(){this.model.renumberSteps(),this.renderGrid()},this)})},this)),!1},togglePublishButton:function(t){t?(this.$(".unpublish-button").addClass("hidden"),this.$(".publish-button").removeClass("hidden")):(this.$(".publish-button").addClass("hidden"),this.$(".unpublish-button").removeClass("hidden"))},renderGrid:function(){var t=this.model.narrativeSteps.toJSON(),e=_.map(t,function(t){var e=parseInt(t.zone_id),i=this.leaf.zones.get(e);return i&&(t.zoneLabel=i.get("zone_label")),t},this);this.$("#sequence-grid").html(this.gridTemplate({readOnly:this.model.isReadOnly(this.tabbedEditor.projectOwner),narrativeSteps:e}))},save:function(t){var e=function(){$(".error-message").html("ERROR: Unable to save changes."),TextLab.Routes.routes.onError()},i=function(){$(".error-message").html(""),t&&t()};this.model.save(null,{success:i,error:e})},render:function(){var t=this.tabbedEditor.projectOwner,e=this.model.isReadOnly(this.tabbedEditor.projectOwner),i=!this.tabbedEditor.projectOwner,n=this.tabbedEditor.projectOwner&&this.model.get("submitted"),r=this.model.get("owner")&&!this.model.get("submitted"),o=!e,s="";this.model.get("submitted")?s=this.tabbedEditor.projectOwner?"Sequence submitted by: "+this.model.get("owner_name"):"Sequence submitted for publication.":this.model.get("shared")&&e&&(s="Sequence shared by: "+this.model.get("owner_name"));var a="";r&&(a=t?"room-for-action-and-publish":"room-for-action-menu"),n&&(a="room-for-return-button"),this.$el.html(this.template({showAddStep:o,showPublishButton:t,showSubmitButton:i,showReturnButton:n,showActionMenu:r,published:this.model.get("published"),submitted:this.model.get("submitted"),shared:this.model.get("shared"),statusMessage:s,actionWidthClass:a})),this.renderGrid()}}),TextLab.SiteDialog=Backbone.View.extend({template:JST["textlab/templates/site-dialog"],id:"site-dialog-container",partials:{stringInput:JST["textlab/templates/common/string-input"]},events:{"click .ok-button":"onOK","click .cancel-button":"onCancel","click .delete-button":"onDelete"},initialize:function(t){this.callback=t.callback,this.deleteCallback=t.deleteCallback,this.mode=t.mode},onOK:function(){this.close(_.bind(function(){this.model.set({name:this.$("#name").val()}),this.callback(this.model)},this))},onCancel:function(){this.close()},onDelete:function(){this.$(".delete-button").confirmation("show"),this.$el.on("confirmed.bs.confirmation",_.bind(function(){this.close(_.bind(function(){this.deleteCallback(this.model)},this))},this))},close:function(t){var e=$("#site-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){this.$el.html(this.template({site:this.model,partials:this.partials,mode:this.mode})),$("#modal-container").html(this.$el);var t=$("#site-modal");t.on("shown.bs.modal",function(){t.draggable({handle:".modal-header"})}),t.modal({backdrop:!1})}}),TextLab.SiteListView=Backbone.View.extend({template:JST["textlab/templates/site-list-view"],id:"site-list-view",events:{"click .edit-site-button":"onEditSite","click .new-site-button":"onNewSite"},initialize:function(){},onNewSite:function(){var t=_.bind(function(t){t.save(null,{success:_.bind(function(t){this.collection.add(t),this.render()},this),error:TextLab.Routes.routes.onError})},this),e=new TextLab.Site;new TextLab.SiteDialog({model:e,callback:t}).render()},onEditSite:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-id")),n=_.bind(function(t){t.save(null,{success:_.bind(function(){this.render()},this),error:TextLab.Routes.routes.onError})},this),r=_.bind(function(t){t.destroy({success:_.bind(function(){this.render()},this),error:TextLab.Routes.onError})},this),o=this.collection.get(i);return new TextLab.SiteDialog({model:o,callback:n,deleteCallback:r,mode:"edit"}).render(),!1},render:function(){this.$el.html(this.template({sites:this.collection.toJSON()}))}}),TextLab.SurfaceView=Backbone.View.extend({template:JST["textlab/templates/surface-view"],zonePopoverTemplate:JST["textlab/templates/zone-popover"],id:"surface-view",events:{"click #add-mode-button":"addMode","click #nav-mode-button":"navMode","click #toggle-zones-button":"toggleZones","click #edit-info-button":"onEditInfo"},dashPattern:[50,10],unSelectedOpacity:.25,initialize:function(t){_.bindAll(this,"onDrag","onDragEnd","onDragStart","renderZone","zoneSaved","leafSaved","onPopoverButton"),this.mainViewport=t.mainViewport,this.tabbedEditor=t.tabbedEditor,this.documentTree=t.documentTree,this.owner=t.owner,this.dragStart=null,$(window).on("resize",_.bind(this.onWindowResize,this))},addMode:function(){return this.mode="add",this.viewer.setMouseNavEnabled(!1),this.selectedZoneGroup&&this.toggleHighlight(this.selectedZoneGroup,!0),$("#add-mode-button").addClass("active"),$("#nav-mode-button").removeClass("active"),!1},navMode:function(){return this.mode="nav",this.viewer.setMouseNavEnabled(!0),this.selectedZoneGroup&&this.toggleHighlight(this.selectedZoneGroup,!1),$("#nav-mode-button").addClass("active"),$("#add-mode-button").removeClass("active"),!1},toggleZones:function(){var t=this.$("#viz-icon"),e=!t.hasClass("glyphicon-eye-open");e?(t.addClass("glyphicon-eye-open"),t.removeClass("glyphicon-eye-close")):(t.addClass("glyphicon-eye-close"),t.removeClass("glyphicon-eye-open"));var i=paper.project.getItems({zoneGroup:!0});return _.each(i,function(t){t.visible=e},this),paper.view.draw(),!1},onEditInfo:function(){var t=_.bind(function(){this.documentTree.render(),this.model.save(null,{success:this.leafSaved,error:TextLab.Routes.routes.onError})},this),e=_.bind(function(t){this.documentTree.deleteLeafNode(t),t.destroy({success:_.bind(function(){this.mainViewport.selectSection(null)},this),error:TextLab.Routes.onError})},this);return new TextLab.LeafDialog({model:this.model,callback:t,deleteCallback:e,mode:"edit"}).render(),!1},onPopoverButton:function(t){var e=$(t.currentTarget),i=e.attr("data-tag-id"),n=this.selectedZoneGroup.data.zone;this.hidePopOverMenu();var r=null,o=null;if(this.tabbedEditor.activeTab&&(r=this.tabbedEditor.activeTab.xmlEditor,o=this.tabbedEditor.activeTab.sequenceEditor),"new-sequence"==i){var s="";return r&&(s=r.getSelection()),this.tabbedEditor.quickSequence(s,n.id),!1}return"add-step"==i?(o.activateNarrativeStepDialog(null,n.id),!1):(r&&r.activateTagDialog(i,n),!1)},onWindowResize:function(){this.hidePopOverMenu()},toggleHighlight:function(t,e){var i=t.children;return!t.visible&&e&&(t.visible=!0),i.zoneRect.opacity=e?1:this.unSelectedOpacity,i.backdrop.opacity=e?1:this.unSelectedOpacity,"add"==this.mode?(i.resizeHandles.visible=e,i.deleteButton.visible=e):(i.resizeHandles.visible=!1,i.deleteButton.visible=e),!1},selectZone:function(t){if(t){var e=_.find(paper.project.activeLayer.children,function(e){return e.data.zone&&e.data.zone.id==t.id});this.selectedZoneGroup&&this.toggleHighlight(this.selectedZoneGroup,!1),this.selectedZoneGroup=e,this.toggleHighlight(e,!0),paper.view.draw()}},onDragStart:function(t){this.resetDrag();var e=paper.view.viewToProject(new paper.Point(t.position.x,t.position.y)),i=paper.project.hitTest(e);if(!i&&this.selectedZoneGroup&&(this.toggleHighlight(this.selectedZoneGroup,!1),this.selectedZoneGroup=null,this.hidePopOverMenu(),paper.view.draw()),i){var n=i.item,r=this.whichZone(n);if(r)if(r!=this.selectedZoneGroup)this.selectedZoneGroup&&this.toggleHighlight(this.selectedZoneGroup,!1),this.toggleHighlight(r,!0),this.selectedZoneGroup=r,this.hidePopOverMenu(),paper.view.draw();else{if(n.data.deleteButton)return void this.deleteZone(r);if(n.data.handle)return this.dragMode="resize-zone",this.dragStart=e,this.viewer.setMouseNavEnabled(!1),void(this.activeDragHandle=n.data.handle);this.showPopOverMenu(r,t)}}else"add"==this.mode&&(this.dragMode="new-zone",this.viewer.setMouseNavEnabled(!1),this.dragStart=e)},hidePopOverMenu:function(){this.popOver&&(this.popOver.popover("destroy"),this.popOver=null,this.viewer.setMouseNavEnabled(!0))},showPopOverMenu:function(t,e){var i=this.tabbedEditor.getEditMode(),n=this.model.get("secondary_enabled"),r=this.zonePopoverTemplate({editMode:i,secondaryEnabled:n});this.popOver=$(".popover-anchor");var o={left:-window.innerWidth/2,top:0};this.popOver.offset({left:o.left+e.originalEvent.clientX,top:o.top+e.originalEvent.clientY});var s=t.data.zone;this.popOver.popover({title:"Zone "+s.get("zone_label"),placement:"bottom",html:!0,content:r}),this.viewer.setMouseNavEnabled(!1),this.popOver.popover("show"),$(".popover-button").click(this.onPopoverButton)},whichZone:function(t){return t?t.data.zone?t:this.whichZone(t.parent):null},onDrag:function(t){if("add"==this.mode&&this.dragMode&&this.dragStart){var e=paper.view.viewToProject(new paper.Point(t.position.x,t.position.y));"new-zone"==this.dragMode?this.dragNewZone(e):"resize-zone"==this.dragMode&&this.dragResize(e),paper.view.draw()}},deleteZone:function(t){var e=this.selectedZoneGroup.data.zone,i=e.get("zone_label");e.destroy({success:_.bind(function(){t.remove(),paper.view.draw(),this.tabbedEditor.activeTab&&this.tabbedEditor.activeTab.xmlEditor.removeZoneLink(i)},this),error:TextLab.Routes.onError})},dragNewZone:function(t){var e,i={ulx:this.dragStart.x,uly:this.dragStart.y,lrx:t.x,lry:t.y};this.selectedZoneGroup?(e=this.selectedZoneGroup.data.zone,e.set(i),this.selectedZoneGroup.remove()):(e=new TextLab.Zone(i),this.model.addZone(e)),this.selectedZoneGroup=this.renderZone(e),this.toggleHighlight(this.selectedZoneGroup,!0)},dragResize:function(t){var e=this.selectedZoneGroup.data.zone,i=this.selectedZoneGroup.children.zoneRect.bounds;"top"==this.activeDragHandle&&i.bottom>t.y?e.set({uly:t.y}):"left"==this.activeDragHandle&&i.right>t.x?e.set({ulx:t.x}):"bottom"==this.activeDragHandle&&i.top<t.y?e.set({lry:t.y}):"right"==this.activeDragHandle&&i.left<t.x&&e.set({lrx:t.x}),this.selectedZoneGroup.remove(),this.selectedZoneGroup=this.renderZone(e),this.toggleHighlight(this.selectedZoneGroup,!0)},resetDrag:function(){this.dragStart=null,this.dragMode=null,this.activeDragHandle=null},onDragEnd:function(){if("add"!=this.mode||!this.dragMode||!this.dragStart)return void this.resetDrag();if("add"==this.mode){this.selectedZoneGroup.children.resizeHandles.visible=!0;this.selectedZoneGroup.data.zone.save(null,{success:this.zoneSaved,error:TextLab.Routes.onError})}this.resetDrag()},zoneSaved:function(t){console.log("zone "+t.get("zone_label")+" is saved."),this.model.save({next_zone_label:this.model.get("next_zone_label")},{patch:!0,success:this.leafSaved,error:TextLab.Routes.onError})},leafSaved:function(){console.log("leaf has been updated.")},render:function(){this.$el.html(this.template({canEditLeafInfo:this.owner}))},toggleZoneLink:function(t,e){var i=_.find(paper.project.activeLayer.children,function(e){return e.data.zone&&e.data.zone.get("zone_label")==t});if(i){i.children.zoneRect.dashArray=e?"":this.dashPattern,paper.view.draw()}},renderZone:function(t){var e=new paper.Point(t.get("ulx"),t.get("uly")),i=new paper.Point(t.get("lrx"),t.get("lry")),n=new paper.Path.Rectangle(e,i),r=n.bounds;zoneLinks=[],n.strokeColor="blue",n.strokeWidth=12,0==zoneLinks.length&&(n.dashArray=this.dashPattern),n.opacity=this.unSelectedOpacity,n.name="zoneRect";var o=new paper.Point(r.right-120,r.bottom-25),s=new paper.PointText(o);s.fontSize=48,s.fillColor="white";var a=t.get("zone_label");s.content=a||"",s.name="zoneID";var l=new paper.Path.Rectangle(s.bounds);l.fillColor="blue",l.opacity=this.unSelectedOpacity,l.name="backdrop";var h=new paper.Path.Circle(r.topCenter,30);h.fillColor="blue",h.data.handle="top";var c=new paper.Path.Circle(r.leftCenter,30);c.fillColor="blue",c.data.handle="left";var u=new paper.Path.Circle(r.rightCenter,30);u.fillColor="blue",u.data.handle="right";var d=new paper.Path.Circle(r.bottomCenter,30);d.fillColor="blue",d.data.handle="bottom";var f=new paper.Group([h,c,u,d]);f.name="resizeHandles",f.visible=!1;var p=new paper.Path.Circle(r.topRight,30);p.fillColor="red",p.name="deleteButton",p.visible=!1,p.data.deleteButton=!0;var g=new paper.Group([n,f,p,l,s]);return g.zoneGroup=!0,g.data.zone=t,g},selectLeaf:function(t){this.model=t,this.viewer&&(this.viewer.destroy(),this.viewReady=!1),this.viewer=null,this.initViewer()},initViewer:function(){if(this.model){this.viewer=OpenSeadragon({id:"openseadragon",showFullPageControl:!1,zoomInButton:"zoom-in-button",zoomOutButton:"zoom-out-button",showHomeControl:!1,gestureSettingsMouse:{clickToZoom:!1,dblClickToZoom:!1,flickEnabled:!1}}),new OpenSeadragon.MouseTracker({element:this.viewer.canvas,pressHandler:this.onDragStart,dragHandler:this.onDrag,dragEndHandler:this.onDragEnd}).setTracking(!0),this.overlay=this.viewer.paperjsOverlay();var t=_.bind(function(){_.each(this.model.zones.models,this.renderZone,this),this.overlay.resize(),this.overlay.resizecanvas(),this.viewReady=!0},this);this.model.getTileSource(_.bind(function(e){e&&this.viewer.addTiledImage({tileSource:e,success:t})},this)),this.navMode()}}}),TextLab.TabDialog=Backbone.View.extend({template:JST["textlab/templates/tab-dialog"],id:"tab-dialog-container",partials:{stringInput:JST["textlab/templates/common/string-input"],dropdownInput:JST["textlab/templates/common/dropdown-input"]},events:{"click .ok-button":"onOK","click .cancel-button":"onCancel"},initialize:function(t){this.callback=t.callback,this.leaf=t.leaf,this.mode=t.mode},onOK:function(){this.close(_.bind(function(){var t=this.$("#editorType").val();"edit"!=this.mode&&(this.model="transcription"==t?TextLab.Transcription.newTranscription(this.leaf):TextLab.Sequence.newSequence(this.leaf)),this.model.set({name:this.$("#name").val()}),this.callback(this.model,t)},this))},onCancel:function(){this.close()},close:function(t){var e=$("#tab-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){var t=[{value:"transcription",text:"Transcription"}];!this.model&&this.leaf.get("secondary_enabled")&&t.push({value:"sequence",text:"Sequence"}),this.$el.html(this.template({name:this.model?this.model.get("name"):"",editorTypes:t,partials:this.partials,mode:this.mode})),$("#modal-container").html(this.$el),$("#tab-modal").modal("show")}}),TextLab.TabbedEditor=Backbone.View.extend({template:JST["textlab/templates/tabbed-editor"],id:"tabbed-editor",maxStartingTabs:5,partials:{tab:JST["textlab/templates/common/tab"],tabPane:JST["textlab/templates/common/tab-pane"]},events:{"click .doc-tab":"onSelectTab","click .close-x":"onClose","click .new-tab-button":"onNew","click .open-tab-button":"onOpen"},initialize:function(t){this.parentPanel=t.parentPanel,this.projectOwner=t.projectOwner,this.config=t.config,_.bindAll(this,"initTranscriptions"),loadingModal_stop()},initTranscriptions:function(t){this.model&&this.model.getTranscriptions(_.bind(function(e){if(this.transcriptions=e,
this.transcriptions.models=_.sortBy(this.transcriptions.models,function(t){t.get("name")}),0==this.transcriptions.models.length){var i=TextLab.Transcription.newTranscription(this.model);this.transcriptions.add(i),i.save(null,{success:t,error:TextLab.Routes.routes.onError})}else t()},this))},initSequences:function(t){this.model&&this.model.getSequences(_.bind(function(e){this.sequences=e,this.sequences.models=_.sortBy(this.sequences.models,function(t){t.get("name")}),t()},this))},selectLeaf:function(t){this.model=t,this.render()},onSelectTab:function(t){var e=t.currentTarget.id,i=_.find(this.tabs,function(t){return t.id==e});this.selectTab(i)},onConfigChanged:function(t){this.config=t,_.each(this.tabs,function(e){e.xmlEditor.onConfigChanged(t)},this),this.render()},onClose:function(t){var e=$(t.currentTarget).attr("data-tab-id"),i=_.find(this.tabs,function(t){return t.id==e});return this.closeTab(i),!1},deleteTab:function(t,e){var i=this.getTab(t,e.id);e.destroy({success:_.bind(function(){this.closeTab(i,!0)},this)})},submitTab:function(t,e){var i=this.getTab(t,e.id);e.set("submitted",!0),this.closeTab(i)},returnTab:function(t,e){var i=this.getTab(t,e.id);e.set("submitted",!1),e.set("published",!1),this.closeTab(i)},onNew:function(){var t=_.bind(function(t,e){"transcription"==e?(this.transcriptions.add(t),t.save(null,{success:_.bind(function(){var e=this.openXMLEditorTab(t);this.selectTab(e)},this)})):(this.sequences.add(t),t.save(null,{success:_.bind(function(){var e=this.openSequenceEditorTab(t);this.selectTab(e)},this)}))},this);new TextLab.TabDialog({leaf:this.model,callback:t}).render()},quickSequence:function(t,e){var i=TextLab.Sequence.newSequence(this.model);this.sequences.add(i),i.save(null,{success:_.bind(function(){var n=this.openSequenceEditorTab(i);this.selectTab(n),n.sequenceEditor.activateNarrativeStepDialog(t,e)},this)})},onOpen:function(){var t=_.bind(function(t,e){var i="transcription"==e?this.openXMLEditorTab(t):this.openSequenceEditorTab(t);this.selectTab(i)},this),e=_.bind(function(){var e=_.map(this.transcriptions.models,function(t){return _.find(this.tabs,function(e){return e.transcription&&e.transcription.id==t.id})?null:t},this);e=_.compact(e);var i;this.model.get("secondary_enabled")?(i=_.map(this.sequences.models,function(t){return _.find(this.tabs,function(e){return e.sequence&&e.sequence.id==t.id})?null:t},this),i=_.compact(i)):i=[],new TextLab.OpenTabDialog({transcriptions:e,sequences:i,callback:t}).render()},this);this.initTranscriptions(_.bind(this.initSequences,this,e))},resizeActivePanel:function(){if(this.activeTab&&this.parentPanel)if(this.activeTab.xmlEditor){var t=this.$(".xml-editor-toolbar");this.activeTab.xmlEditor.editor.setSize(this.parentPanel.width(),this.parentPanel.height()-t.height()-100),this.activeTab.xmlEditor.editor.refresh()}else{var e=this.activeTab.sequenceEditor.$(".sequence-editor-toolbar"),i=this.activeTab.sequenceEditor.$("#sequence-grid");i.width(this.parentPanel.width()-10),i.height(this.parentPanel.height()-e.height()-100)}},selectTab:function(t){if(this.activeTab){var e=this.$("#"+this.activeTab.id),i=this.$("#"+this.activeTab.id+"-pane");e.removeClass("active"),i.hide()}var n=this.$("#"+t.id),r=this.$("#"+t.id+"-pane");n.addClass("active"),r.show(),this.activeTab=t,this.resizeActivePanel()},starTab:function(t,e){if("transcription"==t)_.each(this.tabs,function(t){if(t.transcription){var i=t.transcription.id==e;t.transcription.set("published",i),t.xmlEditor.save(_.bind(function(){this.updateTabStar(t,i)},this))}},this),this.model.set("secondary_enabled",!0);else{var i=this.getTab(t,e);i.sequence.set("published",!0),i.sequenceEditor.save(_.bind(function(){this.updateTabStar(i,!0)},this))}},unStarTab:function(t,e){if("transcription"==t){var i=_.find(this.tabs,function(t){return t.transcription.id==e});i.transcription&&(i.transcription.set("published",!1),i.xmlEditor.save(_.bind(function(){this.updateTabStar(i,!1)},this))),this.model.set("secondary_enabled",!1)}else{var i=this.getTab(t,e);i.sequence.set("published",!1),i.sequenceEditor.save(_.bind(function(){this.updateTabStar(i,!1)},this))}},renameTab:function(t,e,i){var n=this.getTab(t,e);this.$("#"+n.id+" .name").html(i)},updateTabStar:function(t,e){var i=this.$("#"+t.id+" .accept-star"),n=t.xmlEditor?t.xmlEditor:t.sequenceEditor;e?(i.addClass("fa fa-star"),n.togglePublishButton(!1)):(i.removeClass("fa fa-star"),n.togglePublishButton(!0))},closeTab:function(t,e){var i=_.bind(function(){this.tabs=_.without(this.tabs,t),this.activeTab==t&&(this.tabs.length>0?this.selectTab(_.first(this.tabs)):this.activeTab=null),this.$("#"+t.id).detach(),this.$("#"+t.id+"-pane").detach()},this);e?i():t.xmlEditor?t.xmlEditor.save(i):t.sequenceEditor.save(i)},getEditMode:function(){return this.activeTab&&this.activeTab.sequenceEditor?"sequence":"xml"},getTab:function(t,e){var i=t+"-tab-"+e;return _.find(this.tabs,function(t){return t.id==i})},openXMLEditorTab:function(t){var e=new TextLab.XMLEditor({model:t,leaf:this.model,config:this.config,tabbedEditor:this});e.render();var i={id:"transcription-tab-"+t.id,name:t.get("name"),star:t.get("published"),xmlEditor:e,transcription:t,icon:"fa fa-file-text-o"},n=i.id+"-pane";this.$(".tabs").append(this.partials.tab(i)),this.$(".tab-panes").append(this.partials.tabPane({id:n}));var r=this.$("#"+n);return r.append(e.$el),i.xmlEditor.initEditor(),i.xmlEditor.setSurfaceView(this.surfaceView),r.hide(),this.tabs.push(i),i},openSequenceEditorTab:function(t){var e=new TextLab.SequenceEditor({model:t,leaf:this.model,tabbedEditor:this,surfaceView:this.surfaceView});e.render();var i={id:"sequence-tab-"+t.id,name:t.get("name"),star:t.get("published"),sequenceEditor:e,sequence:t,icon:"fa fa-list-ol"},n=i.id+"-pane";this.$(".tabs").append(this.partials.tab(i)),this.$(".tab-panes").append(this.partials.tabPane({id:n}));var r=this.$("#"+n);return r.append(e.$el),r.hide(),this.tabs.push(i),i},render:function(){this.tabs=[],this.$el.html(this.template());var t=_.bind(function(){_.each(_.first(this.transcriptions.models,this.maxStartingTabs),function(t){this.openXMLEditorTab(t)},this),this.tabs.length>0&&this.selectTab(_.first(this.tabs))},this);this.initTranscriptions(_.bind(this.initSequences,this,t))},postRender:function(t){this.surfaceView=t}}),TextLab.UserDialog=Backbone.View.extend({template:JST["textlab/templates/user-dialog"],id:"user-dialog-container",userTypes:[{value:"user",text:"User"},{value:"site_admin",text:"Site Admin"},{value:"admin",text:"TextLab Admin"}],accountStatusTypes:[{pending:"Pending"},{active:"Active"},{archived:"Archived"}],partials:{stringInput:JST["textlab/templates/common/string-input"],dropdownInput:JST["textlab/templates/common/dropdown-input"]},events:{"click .archive-user-button":"onArchive","click .ok-button":"onOK","click .cancel-button":"onCancel"},initialize:function(t){this.callback=t.callback,this.sites=t.sites,this.mode=t.mode,this.isAdmin=t.isAdmin},onOK:function(){this.close(_.bind(function(){this.model.set({username:this.$("#username").val(),first_name:this.$("#first_name").val(),last_name:this.$("#last_name").val(),email:this.$("#email").val(),site_id:this.$("#site").val(),user_type:this.$("#user_type").val()}),this.callback(this.model)},this))},onArchive:function(){this.close(_.bind(function(){this.model.set("requested_status","archived"),this.callback(this.model)},this))},onCancel:function(){this.close()},close:function(t){var e=$("#user-modal");e.on("hidden.bs.modal",_.bind(function(){this.$el.detach(),t&&t()},this)),e.modal("hide")},render:function(){var t=_.map(this.sites.models,function(t){return{value:t.id,text:t.get("name")}});this.$el.html(this.template({user:this.model,sites:t,userTypes:this.userTypes,partials:this.partials,isAdmin:this.isAdmin})),$("#modal-container").html(this.$el);var e=$("#user-modal");e.on("shown.bs.modal",function(){e.draggable({handle:".modal-header"})}),e.modal({backdrop:!1})}}),TextLab.UserListView=Backbone.View.extend({template:JST["textlab/templates/user-list-view"],id:"user-list-view",events:{"click .activate-user-button":"onActivateUser","click .edit-user-button":"onEditUser","change #statusFilter":"onFilterSelect"},accountFilterTypes:[{value:"all",text:"No Filter"},{value:"pending",text:"Pending Status"},{value:"active",text:"Active Status"},{value:"archived",text:"Archived Status"}],partials:{dropdownInput:JST["textlab/templates/common/dropdown-input"]},initialize:function(){this.isAdmin="admin"==TextLabSettings.user_type,this.siteName=TextLabSettings.site_name,this.statusFilter="active"},onEditUser:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-id")),n=_.bind(function(t){t.save(null,{success:_.bind(function(){this.render()},this),error:TextLab.Routes.routes.onError})},this),r=this.collection.get(i);return this.collection.getSites(_.bind(function(t){new TextLab.UserDialog({model:r,callback:n,sites:t,isAdmin:this.isAdmin}).render()},this)),!1},onActivateUser:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-id")),n=this.collection.get(i);return n.set("requested_status","active"),n.save(null,{success:_.bind(function(t){this.render(),"active"!=t.get("account_status")&&alert("Unable to activate user, insufficient accounts available.")},this),error:TextLab.Routes.routes.onError}),!1},onFilterSelect:function(){this.statusFilter=this.$("#statusFilter").val(),this.render()},render:function(){var t;t="all"==this.statusFilter?this.collection.toJSON():_.filter(this.collection.toJSON(),function(t){return t.account_status==this.statusFilter},this),this.$el.html(this.template({users:t,isAdmin:this.isAdmin,siteName:this.siteName,partials:this.partials,accountFilterTypes:this.accountFilterTypes,statusFilter:this.statusFilter}))}}),TextLab.XMLEditor=Backbone.View.extend({template:JST["textlab/templates/xml-editor"],facsTemplate:_.template("<span class='facs-ref' id='<%= id %>'><%= name %></span>"),openTagTemplate:_.template("<<%= tag %><%= attributes %>>"),closeTagTemplate:_.template("</<%= tag %>>"),emptyTagTemplate:_.template("<<%= tag %><%= attributes %>/>"),pbTagAttrTemplate:_.template(" facs='#<%= xml_id %>'"),id:"xml-editor",events:{"click .lb-mode-button":"onClicklbMode","click .pb-button":"onClickpbMode","click .tag-menu-item":"onClickTagMenuItem","click .zone-link":"onClickZoneLink","click .preview-button":"onClickPreview","click .relink-button":"onClickRelink","click .publish-button":"onClickPublish","click .unpublish-button":"onClickUnPublish","click .share-button":"onClickShare","click .stop-sharing-button":"onClickStopSharing","click .submit-button":"onClickSubmit","click .return-button":"onClickReturn","click .rename-button":"onClickRename","click .delete-button":"onClickDelete"},autoSaveDelay:1e3,initialize:function(t){_.bindAll(this,"onEnter","requestAutosave","save","onDrop"),this.lbEnabled=!1,this.leaf=t.leaf,this.config=t.config,this.lbTag=this.config.tags.lb,this.pbTag=this.config.tags.pb,this.tabbedEditor=t.tabbedEditor,this.zoneLinkMarkers=[]},onDrop:function(t,e){if(this.model.isReadOnly(this.tabbedEditor.projectOwner))return!1;if(e.dataTransfer.files){var i=e.dataTransfer.files[0].name,n=i.split(".");if(n.length>1){var r=_.first(n,n.length-1);i=r.join(".")}this.model.set("name",i),this.save(_.bind(function(){this.tabbedEditor.renameTab("transcription",this.model.id,i)},this))}},activateTagDialog:function(t,e){var i=this.config.tags[t];if(i.attributes){var n=_.bind(function(t,e){this.generateTag(i,t,e)},this);new TextLab.AttributeModalDialog({model:this.leaf,config:this.config,zone:e,tag:i,callback:n}).render()}else this.generateTag(i)},onClickTagMenuItem:function(t){var e=$(t.currentTarget),i=e.attr("data-tag-id");return e.hasClass("toolbar-button")||this.$("#xml-tag-dropdown").dropdown("toggle"),this.activateTagDialog(i),!1},onClicklbMode:function(){var t=this.$(".lb-mode-button");return this.lbEnabled?(t.removeClass("active"),this.lbEnabled=!1):(t.addClass("active"),this.lbEnabled=!0),this.editor.focus(),!1},onClickpbMode:function(){if(this.pbTag){var t=this.pbTagAttrTemplate({xml_id:this.leaf.get("xml_id")}),e={attrString:t};return this.generateTag(this.pbTag,e),!1}},onClickRelink:function(){this.relinkZones(),document.activeElement.blur()},relinkZones:function(){contents=this.editor.getValue();const t=/facs=["|'](#.+?_\d*-?\d*["|'])/g;var e=[],i=this.leaf.attributes.xml_id;for(var n in this.leaf.zones._byId){var r=this.leaf.zones._byId[n].attributes.zone_label,o=i+"-"+r;e.push(o)}for(var s=[];null!=(match=t.exec(contents));){var a=this.leaf.getZoneLabelPrefix();if(match[0].split(a).length>1){var l="broken-zone-link",h=match[1].split("#")[1].slice(0,-1);e.indexOf(h)>-1&&(s.push(h.split("-")[1]),l="zone-link");var c=match.index+6,u=match.index+match[0].length-1,d=this.editor.getDoc(),f=d.posFromIndex(c),p=d.posFromIndex(u);d.markText(f,p,{className:l,atomic:!0})}}_.each(paper.project.activeLayer.children,function(t){if(t.data.zone){var e=t.children.zoneRect,i=[50,10],n=e.parent.data.zone.attributes.zone_label;e.dashArray=s.indexOf(n)>-1?"":i}},this),paper.view.draw()},onClickPreview:function(){this.model.id?window.open("/transcriptions/"+this.model.id,"_blank"):alert("This transcription is blank or could not be saved, unable to preview.")},onClickPublish:function(){this.tabbedEditor.starTab("transcription",this.model.id)},onClickUnPublish:function(){this.tabbedEditor.unStarTab("transcription",this.model.id)},onClickShare:function(){return this.updateSharing(!0),!1},onClickStopSharing:function(){return this.updateSharing(!1),!1},onConfigChanged:function(t){this.config=t},updateSharing:function(t){this.$("#action-dropdown").dropdown("toggle"),this.model.set("shared",t),this.save(_.bind(function(){var e=this.$(".share-button"),i=this.$(".stop-sharing-button");t?(e.addClass("hidden"),i.removeClass("hidden")):(i.addClass("hidden"),e.removeClass("hidden"))},this))},onClickSubmit:function(){return this.$("#action-dropdown").dropdown("toggle"),confirm("Do you wish to submit this transcription for publication?")&&this.tabbedEditor.submitTab("transcription",this.model),!1},onClickReturn:function(){return this.$("#action-dropdown").dropdown("toggle"),confirm("Do you wish to return this transcription to its owner?")&&this.tabbedEditor.returnTab("transcription",this.model),!1},onClickRename:function(){var t=_.bind(function(){this.save(_.bind(function(){this.tabbedEditor.renameTab("transcription",this.model.id,this.model.get("name"))},this))},this);return new TextLab.TabDialog({model:this.model,callback:t,mode:"edit"}).render(),!1},onClickDelete:function(){return this.$("#action-dropdown").dropdown("toggle"),confirm("Do you wish to delete the transcription titled '"+this.model.get("name")+"'? ")&&this.tabbedEditor.deleteTab("transcription",this.model),!1},togglePublishButton:function(t){t?(this.$(".unpublish-button").addClass("hidden"),this.$(".publish-button").removeClass("hidden")):(this.$(".publish-button").addClass("hidden"),this.$(".unpublish-button").removeClass("hidden"))},onEnter:function(){this.lbEnabled&&this.lbTag&&this.generateTag(this.lbTag)},save:function(t){var e=function(){$(".error-message").html("ERROR: Unable to save changes."),TextLab.Routes.routes.onError()},i=function(){$(".error-message").html(""),t&&t()},n=this.editor.getDoc();this.model.set("content",n.getValue()),this.model.save(null,{success:i,error:e})},startAutosaveTimer:function(){this.autoSaveTimerID=window.setTimeout(this.save,this.autoSaveDelay)},requestAutosave:function(){this.stopAutosaveTimer(),this.startAutosaveTimer()},stopAutosaveTimer:function(){window.clearTimeout(this.autoSaveTimerID)},getSelection:function(){return this.editor.getDoc().getSelection()},generateTag:function(t,e,i){var n=this.editor.getDoc(),r=n.getCursor("from"),o=n.somethingSelected()?n.getCursor("to"):null;if(i&&i.length>0){var s=r,a=o;_.each(i,function(t){var e=this.generateSingleTag(t.tag,t,s,a);s=e,a=null},this),o=s}this.generateSingleTag(t,e,r,o),this.editor.focus()},generateSingleTag:function(t,e,i,n){var r,o=this.editor.getDoc(),s=e?e.attrString:"";if(t.empty)r=this.emptyTagTemplate({tag:t.tag,attributes:s});else{var a=this.openTagTemplate({tag:t.tag,attributes:s}),l="";if(n){l=o.getRange(i,n);var h=o.findMarks(i,n);_.map(h,function(t){var e=t.find();return o.indexFromPos(e.from)+a.length},this)}var c=this.closeTagTemplate(t);r=a+l+c}o.replaceRange(r,i,n),this.relinkZones();var u=o.indexFromPos(i)+r.length;return o.posFromIndex(u)},removeZoneLink:function(){this.relinkZones()},setSurfaceView:function(t){this.relinkZones(),this.surfaceView=t},onClickZoneLink:function(t){var e=$(t.currentTarget).html(),i=this.leaf.removeZoneLabelPrefix(e),n=this.leaf.zones.getZoneByLabel(i);return this.surfaceView.selectZone(n),!1},initZoneLinks:function(){this.relinkZones()},render:function(){var t=this.tabbedEditor.projectOwner,e=!this.tabbedEditor.projectOwner,i=this.tabbedEditor.projectOwner&&this.model.get("submitted"),n=this.model.get("owner")&&!this.model.get("submitted"),r=!this.model.isReadOnly(this.tabbedEditor.projectOwner),o="";this.model.get("submitted")?o=this.tabbedEditor.projectOwner?"Transcription submitted by: "+this.model.get("owner_name"):"Transcription submitted for publication.":this.model.get("shared")&&this.model.isReadOnly()&&(o="Transcription shared by: "+this.model.get("owner_name"));var s="";n&&(s=t?"room-for-action-and-publish":"room-for-action-menu"),i&&(s="room-for-return-button");var a=[];_.each(this.config.tags,function(t,e){1!=t.omitFromMenu&&a.push(e)}),this.$el.html(this.template({tags:a,showPublishButton:t,showSubmitButton:e,showReturnButton:i,showActionMenu:n,published:this.model.get("published"),submitted:this.model.get("submitted"),shared:this.model.get("shared"),showTags:r,statusMessage:o,actionWidthClass:s}))},initEditor:function(){var t=this.model.isReadOnly(this.tabbedEditor.projectOwner),e=this.$("#codemirror").get(0);this.editor=CodeMirror.fromTextArea(e,{mode:"xml",lineNumbers:!0,lineWrapping:!0,readOnly:t}),t&&(this.$(".CodeMirror").addClass("read-only"),this.$(".CodeMirror-gutters").addClass("read-only"));var i=this.editor.getDoc();this.model&&this.model.get("content")&&i.setValue(this.model.get("content")),this.model&&this.initZoneLinks(),i.clearHistory(),this.$el.keydown(_.bind(function(t){13==t.keyCode&&this.onEnter()},this)),this.editor.on("drop",this.onDrop),this.editor.on("change",this.requestAutosave),this.editor.on("change",_.bind(function(t,e){"paste"==e.origin&&this.relinkZones()},this))}});