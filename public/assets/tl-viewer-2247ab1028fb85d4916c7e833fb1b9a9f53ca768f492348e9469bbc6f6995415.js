function OpenSeadragon(t){return new OpenSeadragon.Viewer(t)}!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e=!!t&&"length"in t&&t.length,i=ot.type(t);return"function"!==i&&!ot.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function n(t,e,i){if(ot.isFunction(e))return ot.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return ot.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(gt.test(e))return ot.filter(e,t,i);e=ot.filter(e,t)}return ot.grep(t,function(t){return Q.call(e,t)>-1!==i})}function r(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function o(t){var e={};return ot.each(t.match(_t)||[],function(t,i){e[i]=!0}),e}function s(){X.removeEventListener("DOMContentLoaded",s),t.removeEventListener("load",s),ot.ready()}function a(){this.expando=ot.expando+a.uid++}function l(t,e,i){var n;if(i===undefined&&1===t.nodeType)if(n="data-"+e.replace(Et,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:Pt.test(i)?ot.parseJSON(i):i)}catch(t){}Ct.set(t,e,i)}else i=undefined;return i}function h(t,e,i,n){var r,o=1,s=20,a=n?function(){return n.cur()}:function(){return ot.css(t,e,"")},l=a(),h=i&&i[3]||(ot.cssNumber[e]?"":"px"),u=(ot.cssNumber[e]||"px"!==h&&+l)&&Ot.exec(ot.css(t,e));if(u&&u[3]!==h){h=h||u[3],i=i||[],u=+l||1;do{o=o||".5",u/=o,ot.style(t,e,u+h)}while(o!==(o=a()/l)&&1!==o&&--s)}return i&&(u=+u||+l||0,r=i[1]?u+(i[1]+1)*i[2]:+i[2],n&&(n.unit=h,n.start=u,n.end=r)),r}function u(t,e){var i="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):[];return e===undefined||e&&ot.nodeName(t,e)?ot.merge([t],i):i}function c(t,e){for(var i=0,n=t.length;i<n;i++)Tt.set(t[i],"globalEval",!e||Tt.get(e[i],"globalEval"))}function d(t,e,i,n,r){for(var o,s,a,l,h,d,f=e.createDocumentFragment(),p=[],g=0,m=t.length;g<m;g++)if((o=t[g])||0===o)if("object"===ot.type(o))ot.merge(p,o.nodeType?[o]:o);else if(Dt.test(o)){for(s=s||f.appendChild(e.createElement("div")),a=(Lt.exec(o)||["",""])[1].toLowerCase(),l=At[a]||At._default,s.innerHTML=l[1]+ot.htmlPrefilter(o)+l[2],d=l[0];d--;)s=s.lastChild;ot.merge(p,s.childNodes),s=f.firstChild,s.textContent=""}else p.push(e.createTextNode(o));for(f.textContent="",g=0;o=p[g++];)if(n&&ot.inArray(o,n)>-1)r&&r.push(o);else if(h=ot.contains(o.ownerDocument,o),s=u(f.appendChild(o),"script"),h&&c(s),i)for(d=0;o=s[d++];)Nt.test(o.type||"")&&i.push(o);return f}function f(){return!0}function p(){return!1}function g(){try{return X.activeElement}catch(t){}}function m(t,e,i,n,r,o){var s,a;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=undefined);for(a in e)m(t,a,i,n,e[a],o);return t}if(null==n&&null==r?(r=i,n=i=undefined):null==r&&("string"==typeof i?(r=n,n=undefined):(r=n,n=i,i=undefined)),!1===r)r=p;else if(!r)return t;return 1===o&&(s=r,r=function(t){return ot().off(t),s.apply(this,arguments)},r.guid=s.guid||(s.guid=ot.guid++)),t.each(function(){ot.event.add(this,e,r,n,i)})}function v(t,e){return ot.nodeName(t,"table")&&ot.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function y(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function w(t){var e=Wt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function _(t,e){var i,n,r,o,s,a,l,h;if(1===e.nodeType){if(Tt.hasData(t)&&(o=Tt.access(t),s=Tt.set(e,o),h=o.events)){delete s.handle,s.events={};for(r in h)for(i=0,n=h[r].length;i<n;i++)ot.event.add(e,r,h[r][i])}Ct.hasData(t)&&(a=Ct.access(t),l=ot.extend({},a),Ct.set(e,l))}}function x(t,e){var i=e.nodeName.toLowerCase();"input"===i&&It.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function b(t,e,i,n){e=K.apply([],e);var r,o,s,a,l,h,c=0,f=t.length,p=f-1,g=e[0],m=ot.isFunction(g);if(m||f>1&&"string"==typeof g&&!nt.checkClone&&jt.test(g))return t.each(function(r){var o=t.eq(r);m&&(e[0]=g.call(this,r,o.html())),b(o,e,i,n)});if(f&&(r=d(e,t[0].ownerDocument,!1,t,n),o=r.firstChild,1===r.childNodes.length&&(r=o),o||n)){for(s=ot.map(u(r,"script"),y),a=s.length;c<f;c++)l=r,c!==p&&(l=ot.clone(l,!0,!0),a&&ot.merge(s,u(l,"script"))),i.call(t[c],l,c);if(a)for(h=s[s.length-1].ownerDocument,ot.map(s,w),c=0;c<a;c++)l=s[c],Nt.test(l.type||"")&&!Tt.access(l,"globalEval")&&ot.contains(h,l)&&(l.src?ot._evalUrl&&ot._evalUrl(l.src):ot.globalEval(l.textContent.replace(qt,"")))}return t}function S(t,e,i){for(var n,r=e?ot.filter(e,t):t,o=0;null!=(n=r[o]);o++)i||1!==n.nodeType||ot.cleanData(u(n)),n.parentNode&&(i&&ot.contains(n.ownerDocument,n)&&c(u(n,"script")),n.parentNode.removeChild(n));return t}function T(t,e){var i=ot(e.createElement(t)).appendTo(e.body),n=ot.css(i[0],"display");return i.detach(),n}function C(t){var e=X,i=Ut[t];return i||(i=T(t,e),"none"!==i&&i||(Vt=(Vt||ot("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=Vt[0].contentDocument,e.write(),e.close(),i=T(t,e),Vt.detach()),Ut[t]=i),i}function P(t,e,i){var n,r,o,s,a=t.style;return i=i||Xt(t),s=i?i.getPropertyValue(e)||i[e]:undefined,""!==s&&s!==undefined||ot.contains(t.ownerDocument,t)||(s=ot.style(t,e)),i&&!nt.pixelMarginRight()&&Zt.test(s)&&Gt.test(e)&&(n=a.width,r=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=n,a.minWidth=r,a.maxWidth=o),s!==undefined?s+"":s}function E(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function k(t){if(t in ie)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=ee.length;i--;)if((t=ee[i]+e)in ie)return t}function O(t,e,i){var n=Ot.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function M(t,e,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===e?1:0,s=0;o<4;o+=2)"margin"===i&&(s+=ot.css(t,i+Mt[o],!0,r)),n?("content"===i&&(s-=ot.css(t,"padding"+Mt[o],!0,r)),"margin"!==i&&(s-=ot.css(t,"border"+Mt[o]+"Width",!0,r))):(s+=ot.css(t,"padding"+Mt[o],!0,r),"padding"!==i&&(s+=ot.css(t,"border"+Mt[o]+"Width",!0,r)));return s}function R(t,e,i){var n=!0,r="width"===e?t.offsetWidth:t.offsetHeight,o=Xt(t),s="border-box"===ot.css(t,"boxSizing",!1,o);if(r<=0||null==r){if(r=P(t,e,o),(r<0||null==r)&&(r=t.style[e]),Zt.test(r))return r;n=s&&(nt.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+M(t,e,i||(s?"border":"content"),n,o)+"px"}function I(t,e){for(var i,n,r,o=[],s=0,a=t.length;s<a;s++)n=t[s],n.style&&(o[s]=Tt.get(n,"olddisplay"),i=n.style.display,e?(o[s]||"none"!==i||(n.style.display=""),""===n.style.display&&Rt(n)&&(o[s]=Tt.access(n,"olddisplay",C(n.nodeName)))):(r=Rt(n),"none"===i&&r||Tt.set(n,"olddisplay",r?i:ot.css(n,"display"))));for(s=0;s<a;s++)n=t[s],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?o[s]||"":"none"));return t}function L(t,e,i,n,r){return new L.prototype.init(t,e,i,n,r)}function N(){return t.setTimeout(function(){ne=undefined}),ne=ot.now()}function A(t,e){var i,n=0,r={height:t};for(e=e?1:0;n<4;n+=2-e)i=Mt[n],r["margin"+i]=r["padding"+i]=t;return e&&(r.opacity=r.width=t),r}function D(t,e,i){for(var n,r=(B.tweeners[e]||[]).concat(B.tweeners["*"]),o=0,s=r.length;o<s;o++)if(n=r[o].call(i,e,t))return n}function z(t,e,i){var n,r,o,s,a,l,h,u=this,c={},d=t.style,f=t.nodeType&&Rt(t),p=Tt.get(t,"fxshow");i.queue||(a=ot._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,u.always(function(){u.always(function(){a.unqueued--,ot.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],h=ot.css(t,"display"),"inline"===("none"===h?Tt.get(t,"olddisplay")||C(t.nodeName):h)&&"none"===ot.css(t,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",u.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(n in e)if(r=e[n],oe.exec(r)){if(delete e[n],o=o||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!p||p[n]===undefined)continue;f=!0}c[n]=p&&p[n]||ot.style(t,n)}else h=undefined;if(ot.isEmptyObject(c))"inline"===("none"===h?C(t.nodeName):h)&&(d.display=h);else{p?"hidden"in p&&(f=p.hidden):p=Tt.access(t,"fxshow",{}),o&&(p.hidden=!f),f?ot(t).show():u.done(function(){ot(t).hide()}),u.done(function(){var e;Tt.remove(t,"fxshow");for(e in c)ot.style(t,e,c[e])});for(n in c)s=D(f?p[n]:0,n,u),n in p||(p[n]=s.start,f&&(s.end=s.start,s.start="width"===n||"height"===n?1:0))}}function H(t,e){var i,n,r,o,s;for(i in t)if(n=ot.camelCase(i),r=e[n],o=t[i],ot.isArray(o)&&(r=o[1],o=t[i]=o[0]),i!==n&&(t[n]=o,delete t[i]),(s=ot.cssHooks[n])&&"expand"in s){o=s.expand(o),delete t[n];for(i in o)i in t||(t[i]=o[i],e[i]=r)}else e[n]=r}function B(t,e,i){var n,r,o=0,s=B.prefilters.length,a=ot.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var e=ne||N(),i=Math.max(0,h.startTime+h.duration-e),n=i/h.duration||0,o=1-n,s=0,l=h.tweens.length;s<l;s++)h.tweens[s].run(o);return a.notifyWith(t,[h,o,i]),o<1&&l?i:(a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:ot.extend({},e),opts:ot.extend(!0,{specialEasing:{},easing:ot.easing._default},i),originalProperties:e,originalOptions:i,startTime:ne||N(),duration:i.duration,tweens:[],createTween:function(e,i){var n=ot.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(n),n},stop:function(e){var i=0,n=e?h.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)h.tweens[i].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),u=h.props;for(H(u,h.opts.specialEasing);o<s;o++)if(n=B.prefilters[o].call(h,t,u,h.opts))return ot.isFunction(n.stop)&&(ot._queueHooks(h.elem,h.opts.queue).stop=ot.proxy(n.stop,n)),n;return ot.map(u,D,h),ot.isFunction(h.opts.start)&&h.opts.start.call(t,h),ot.fx.timer(ot.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function F(t){return t.getAttribute&&t.getAttribute("class")||""}function $(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,o=e.toLowerCase().match(_t)||[];if(ot.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function j(t,e,i,n){function r(a){var l;return o[a]=!0,ot.each(t[a]||[],function(t,a){var h=a(e,i,n);return"string"!=typeof h||s||o[h]?s?!(l=h):void 0:(e.dataTypes.unshift(h),r(h),!1)}),l}var o={},s=t===Ce;return r(e.dataTypes[0])||!o["*"]&&r("*")}function W(t,e){var i,n,r=ot.ajaxSettings.flatOptions||{};for(i in e)e[i]!==undefined&&((r[i]?t:n||(n={}))[i]=e[i]);return n&&ot.extend(!0,t,n),t}function q(t,e,i){for(var n,r,o,s,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),n===undefined&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(r in a)if(a[r]&&a[r].test(n)){l.unshift(r);break}if(l[0]in i)o=l[0];else{for(r in i){if(!l[0]||t.converters[r+" "+l[0]]){o=r;break}s||(s=r)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}function V(t,e,i,n){var r,o,s,a,l,h={},u=t.dataTypes.slice();if(u[1])for(s in t.converters)h[s.toLowerCase()]=t.converters[s];for(o=u.shift();o;)if(t.responseFields[o]&&(i[t.responseFields[o]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=o,o=u.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(s=h[l+" "+o]||h["* "+o]))for(r in h)if(a=r.split(" "),a[1]===o&&(s=h[l+" "+a[0]]||h["* "+a[0]])){!0===s?s=h[r]:!0!==h[r]&&(o=a[0],u.unshift(a[1]));break}if(!0!==s)if(s&&t["throws"])e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+l+" to "+o}}}return{state:"success",data:e}}function U(t,e,i,n){var r;if(ot.isArray(e))ot.each(e,function(e,r){i||Oe.test(t)?n(t,r):U(t+"["+("object"==typeof r&&null!=r?e:"")+"]",r,i,n)});else if(i||"object"!==ot.type(e))n(t,e);else for(r in e)U(t+"["+r+"]",e[r],i,n)}function G(t){return ot.isWindow(t)?t:9===t.nodeType&&t.defaultView}var Z=[],X=t.document,Y=Z.slice,K=Z.concat,J=Z.push,Q=Z.indexOf,tt={},et=tt.toString,it=tt.hasOwnProperty,nt={},rt="2.2.4",ot=function(t,e){return new ot.fn.init(t,e)},st=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,at=/^-ms-/,lt=/-([\da-z])/gi,ht=function(t,e){return e.toUpperCase()};ot.fn=ot.prototype={jquery:rt,constructor:ot,selector:"",length:0,toArray:function(){return Y.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:Y.call(this)},pushStack:function(t){var e=ot.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return ot.each(this,t)},map:function(t){return this.pushStack(ot.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(Y.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:J,sort:Z.sort,splice:Z.splice},ot.extend=ot.fn.extend=function(){var t,e,i,n,r,o,s=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[a]||{},a++),"object"==typeof s||ot.isFunction(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)i=s[e],n=t[e],s!==n&&(h&&n&&(ot.isPlainObject(n)||(r=ot.isArray(n)))?(r?(r=!1,o=i&&ot.isArray(i)?i:[]):o=i&&ot.isPlainObject(i)?i:{},s[e]=ot.extend(h,o,n)):n!==undefined&&(s[e]=n));return s},ot.extend({expando:"jQuery"+(rt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===ot.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=t&&t.toString();return!ot.isArray(t)&&e-parseFloat(e)+1>=0},isPlainObject:function(t){var e;if("object"!==ot.type(t)||t.nodeType||ot.isWindow(t))return!1;if(t.constructor&&!it.call(t,"constructor")&&!it.call(t.constructor.prototype||{},"isPrototypeOf"))return!1;for(e in t);return e===undefined||it.call(t,e)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?tt[et.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;(t=ot.trim(t))&&(1===t.indexOf("use strict")?(e=X.createElement("script"),e.text=t,X.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(at,"ms-").replace(lt,ht)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var n,r=0;if(i(t))for(n=t.length;r<n&&!1!==e.call(t[r],r,t[r]);r++);else for(r in t)if(!1===e.call(t[r],r,t[r]))break;return t},trim:function(t){return null==t?"":(t+"").replace(st,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?ot.merge(n,"string"==typeof t?[t]:t):J.call(n,t)),n},inArray:function(t,e,i){return null==e?-1:Q.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;n<i;n++)t[r++]=e[n];return t.length=r,t},grep:function(t,e,i){for(var n=[],r=0,o=t.length,s=!i;r<o;r++)!e(t[r],r)!==s&&n.push(t[r]);return n},map:function(t,e,n){var r,o,s=0,a=[];if(i(t))for(r=t.length;s<r;s++)null!=(o=e(t[s],s,n))&&a.push(o);else for(s in t)null!=(o=e(t[s],s,n))&&a.push(o);return K.apply([],a)},guid:1,proxy:function(t,e){var i,n,r;return"string"==typeof e&&(i=t[e],e=t,t=i),ot.isFunction(t)?(n=Y.call(arguments,2),r=function(){return t.apply(e||this,n.concat(Y.call(arguments)))},r.guid=t.guid=t.guid||ot.guid++,r):undefined},now:Date.now,support:nt}),"function"==typeof Symbol&&(ot.fn[Symbol.iterator]=Z[Symbol.iterator]),ot.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){tt["[object "+e+"]"]=e.toLowerCase()});var ut=function(t){function e(t,e,i,n){var r,o,s,a,l,h,c,f,p=e&&e.ownerDocument,g=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==g&&9!==g&&11!==g)return i;if(!n&&((e?e.ownerDocument||e:F)!==I&&R(e),e=e||I,N)){if(11!==g&&(h=vt.exec(t)))if(r=h[1]){if(9===g){if(!(s=e.getElementById(r)))return i;if(s.id===r)return i.push(s),i}else if(p&&(s=p.getElementById(r))&&H(e,s)&&s.id===r)return i.push(s),i}else{if(h[2])return J.apply(i,e.getElementsByTagName(t)),i;if((r=h[3])&&x.getElementsByClassName&&e.getElementsByClassName)return J.apply(i,e.getElementsByClassName(r)),i}if(x.qsa&&!V[t+" "]&&(!A||!A.test(t))){if(1!==g)p=e,f=t;else if("object"!==e.nodeName.toLowerCase()){for((a=e.getAttribute("id"))?a=a.replace(wt,"\\$&"):e.setAttribute("id",a=B),c=C(t),o=c.length,l=dt.test(a)?"#"+a:"[id='"+a+"']";o--;)c[o]=l+" "+d(c[o]);f=c.join(","),p=yt.test(t)&&u(e.parentNode)||e}if(f)try{return J.apply(i,p.querySelectorAll(f)),i}catch(t){}finally{a===B&&e.removeAttribute("id")}}}return E(t.replace(at,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>b.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[B]=!0,t}function r(t){var e=I.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function o(t,e){for(var i=t.split("|"),n=i.length;n--;)b.attrHandle[i[n]]=e}function s(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||G)-(~t.sourceIndex||G);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function h(t){return n(function(e){return e=+e,n(function(i,n){for(var r,o=t([],i.length,e),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function u(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function c(){}function d(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function f(t,e,i){var n=e.dir,r=i&&"parentNode"===n,o=j++;return e.first?function(e,i,o){for(;e=e[n];)if(1===e.nodeType||r)return t(e,i,o)}:function(e,i,s){var a,l,h,u=[$,o];if(s){for(;e=e[n];)if((1===e.nodeType||r)&&t(e,i,s))return!0}else for(;e=e[n];)if(1===e.nodeType||r){if(h=e[B]||(e[B]={}),l=h[e.uniqueID]||(h[e.uniqueID]={}),(a=l[n])&&a[0]===$&&a[1]===o)return u[2]=a[2];if(l[n]=u,u[2]=t(e,i,s))return!0}}}function p(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function g(t,i,n){for(var r=0,o=i.length;r<o;r++)e(t,i[r],n);return n}function m(t,e,i,n,r){for(var o,s=[],a=0,l=t.length,h=null!=e;a<l;a++)(o=t[a])&&(i&&!i(o,n,r)||(s.push(o),h&&e.push(a)));return s}function v(t,e,i,r,o,s){return r&&!r[B]&&(r=v(r)),o&&!o[B]&&(o=v(o,s)),n(function(n,s,a,l){var h,u,c,d=[],f=[],p=s.length,v=n||g(e||"*",a.nodeType?[a]:a,[]),y=!t||!n&&e?v:m(v,d,t,a,l),w=i?o||(n?t:p||r)?[]:s:y;if(i&&i(y,w,a,l),r)for(h=m(w,f),r(h,[],a,l),u=h.length;u--;)(c=h[u])&&(w[f[u]]=!(y[f[u]]=c));if(n){if(o||t){if(o){for(h=[],u=w.length;u--;)(c=w[u])&&h.push(y[u]=c);o(null,w=[],h,l)}for(u=w.length;u--;)(c=w[u])&&(h=o?tt(n,c):d[u])>-1&&(n[h]=!(s[h]=c))}}else w=m(w===s?w.splice(p,w.length):w),o?o(null,s,w,l):J.apply(s,w)})}function y(t){for(var e,i,n,r=t.length,o=b.relative[t[0].type],s=o||b.relative[" "],a=o?1:0,l=f(function(t){return t===e},s,!0),h=f(function(t){return tt(e,t)>-1},s,!0),u=[function(t,i,n){var r=!o&&(n||i!==k)||((e=i).nodeType?l(t,i,n):h(t,i,n));return e=null,r}];a<r;a++)if(i=b.relative[t[a].type])u=[f(p(u),i)];else{if(i=b.filter[t[a].type].apply(null,t[a].matches),i[B]){for(n=++a;n<r&&!b.relative[t[n].type];n++);return v(a>1&&p(u),a>1&&d(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(at,"$1"),i,a<n&&y(t.slice(a,n)),n<r&&y(t=t.slice(n)),n<r&&d(t))}u.push(i)}return p(u)}function w(t,i){var r=i.length>0,o=t.length>0,s=function(n,s,a,l,h){var u,c,d,f=0,p="0",g=n&&[],v=[],y=k,w=n||o&&b.find.TAG("*",h),_=$+=null==y?1:Math.random()||.1,x=w.length;for(h&&(k=s===I||s||h);p!==x&&null!=(u=w[p]);p++){if(o&&u){for(c=0,s||u.ownerDocument===I||(R(u),a=!N);d=t[c++];)if(d(u,s||I,a)){l.push(u);break}h&&($=_)}r&&((u=!d&&u)&&f--,n&&g.push(u))}if(f+=p,r&&p!==f){for(c=0;d=i[c++];)d(g,v,s,a);if(n){if(f>0)for(;p--;)g[p]||v[p]||(v[p]=Y.call(l));v=m(v)}J.apply(l,v),h&&!n&&v.length>0&&f+i.length>1&&e.uniqueSort(l)}return h&&($=_,k=y),g};return r?n(s):s}var _,x,b,S,T,C,P,E,k,O,M,R,I,L,N,A,D,z,H,B="sizzle"+1*new Date,F=t.document,$=0,j=0,W=i(),q=i(),V=i(),U=function(t,e){return t===e&&(M=!0),0},G=1<<31,Z={}.hasOwnProperty,X=[],Y=X.pop,K=X.push,J=X.push,Q=X.slice,tt=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",rt="\\["+it+"*("+nt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+nt+"))|)"+it+"*\\]",ot=":("+nt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+rt+")*)|.*)\\)|)",st=new RegExp(it+"+","g"),at=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),lt=new RegExp("^"+it+"*,"+it+"*"),ht=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ut=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),ct=new RegExp(ot),dt=new RegExp("^"+nt+"$"),ft={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt+"|[*])"),ATTR:new RegExp("^"+rt),PSEUDO:new RegExp("^"+ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},pt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,mt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,wt=/'|\\/g,_t=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),xt=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},bt=function(){R()};try{J.apply(X=Q.call(F.childNodes),F.childNodes),X[F.childNodes.length].nodeType}catch(t){J={apply:X.length?function(t,e){K.apply(t,Q.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}x=e.support={},T=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},R=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:F;return n!==I&&9===n.nodeType&&n.documentElement?(I=n,L=I.documentElement,N=!T(I),(i=I.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",bt,!1):i.attachEvent&&i.attachEvent("onunload",bt)),x.attributes=r(function(t){return t.className="i",!t.getAttribute("className")}),x.getElementsByTagName=r(function(t){return t.appendChild(I.createComment("")),!t.getElementsByTagName("*").length}),x.getElementsByClassName=mt.test(I.getElementsByClassName),x.getById=r(function(t){return L.appendChild(t).id=B,!I.getElementsByName||!I.getElementsByName(B).length}),x.getById?(b.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&N){var i=e.getElementById(t);return i?[i]:[]}},b.filter.ID=function(t){var e=t.replace(_t,xt);return function(t){return t.getAttribute("id")===e}}):(delete b.find.ID,b.filter.ID=function(t){var e=t.replace(_t,xt);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),b.find.TAG=x.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):x.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,o=e.getElementsByTagName(t);if("*"===t){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},b.find.CLASS=x.getElementsByClassName&&function(t,e){if("undefined"!=typeof e.getElementsByClassName&&N)return e.getElementsByClassName(t)},D=[],A=[],(x.qsa=mt.test(I.querySelectorAll))&&(r(function(t){L.appendChild(t).innerHTML="<a id='"+B+"'></a><select id='"+B+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&A.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||A.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+B+"-]").length||A.push("~="),t.querySelectorAll(":checked").length||A.push(":checked"),t.querySelectorAll("a#"+B+"+*").length||A.push(".#.+[+~]")}),r(function(t){var e=I.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&A.push("name"+it+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||A.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),A.push(",.*:")})),(x.matchesSelector=mt.test(z=L.matches||L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&r(function(t){x.disconnectedMatch=z.call(t,"div"),z.call(t,"[s!='']:x"),D.push("!=",ot)}),A=A.length&&new RegExp(A.join("|")),D=D.length&&new RegExp(D.join("|")),e=mt.test(L.compareDocumentPosition),H=e||mt.test(L.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},U=e?function(t,e){if(t===e)return M=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!x.sortDetached&&e.compareDocumentPosition(t)===i?t===I||t.ownerDocument===F&&H(F,t)?-1:e===I||e.ownerDocument===F&&H(F,e)?1:O?tt(O,t)-tt(O,e):0:4&i?-1:1)}:function(t,e){if(t===e)return M=!0,0;var i,n=0,r=t.parentNode,o=e.parentNode,a=[t],l=[e];if(!r||!o)return t===I?-1:e===I?1:r?-1:o?1:O?tt(O,t)-tt(O,e):0;if(r===o)return s(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;a[n]===l[n];)n++;return n?s(a[n],l[n]):a[n]===F?-1:l[n]===F?1:0},I):I},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==I&&R(t),i=i.replace(ut,"='$1']"),x.matchesSelector&&N&&!V[i+" "]&&(!D||!D.test(i))&&(!A||!A.test(i)))try{var n=z.call(t,i);if(n||x.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return e(i,I,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==I&&R(t),H(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==I&&R(t);var i=b.attrHandle[e.toLowerCase()],n=i&&Z.call(b.attrHandle,e.toLowerCase())?i(t,e,!N):undefined;return n!==undefined?n:x.attributes||!N?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,r=0;if(M=!x.detectDuplicates,O=!x.sortStable&&t.slice(0),t.sort(U),M){for(;e=t[r++];)e===t[r]&&(n=i.push(r));for(;n--;)t.splice(i[n],1)}return O=null,t},S=e.getText=function(t){var e,i="",n=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=S(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[n++];)i+=S(e);return i},b=e.selectors={cacheLength:50,createPseudo:n,match:ft,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(_t,xt),t[3]=(t[3]||t[4]||t[5]||"").replace(_t,xt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return ft.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&ct.test(i)&&(e=C(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(_t,xt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=W[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&W(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(r){var o=e.attr(r,t);return null==o?"!="===i:!i||(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o.replace(st," ")+" ").indexOf(n)>-1:"|="===i&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,i,n,r){var o="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,l){var h,u,c,d,f,p,g=o!==s?"nextSibling":"previousSibling",m=e.parentNode,v=a&&e.nodeName.toLowerCase(),y=!l&&!a,w=!1;if(m){if(o){for(;g;){for(d=e;d=d[g];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;p=g="only"===t&&!p&&"nextSibling"}return!0}if(p=[s?m.firstChild:m.lastChild],s&&y){for(d=m,c=d[B]||(d[B]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),h=u[t]||[],f=h[0]===$&&h[1],w=f&&h[2],d=f&&m.childNodes[f];d=++f&&d&&d[g]||(w=f=0)||p.pop();)if(1===d.nodeType&&++w&&d===e){u[t]=[$,f,w];break}}else if(y&&(d=e,c=d[B]||(d[B]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),h=u[t]||[],f=h[0]===$&&h[1],w=f),!1===w)for(;(d=++f&&d&&d[g]||(w=f=0)||p.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++w||(y&&(c=d[B]||(d[B]={}),u=c[d.uniqueID]||(c[d.uniqueID]={}),u[t]=[$,w]),d!==e)););return(w-=r)===n||w%n==0&&w/n>=0}}},PSEUDO:function(t,i){var r,o=b.pseudos[t]||b.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return o[B]?o(i):o.length>1?(r=[t,t,"",i],b.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,r=o(t,i),s=r.length;s--;)n=tt(t,r[s]),t[n]=!(e[n]=r[s])}):function(t){return o(t,0,r)}):o}},pseudos:{not:n(function(t){var e=[],i=[],r=P(t.replace(at,"$1"));return r[B]?n(function(t,e,i,n){for(var o,s=r(t,null,n,[]),a=t.length;a--;)(o=s[a])&&(t[a]=!(e[a]=o))}):function(t,n,o){return e[0]=t,r(e,null,o,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return t=t.replace(_t,xt),function(e){return(e.textContent||e.innerText||S(e)).indexOf(t)>-1}}),lang:n(function(t){return dt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(_t,xt).toLowerCase(),function(e){var i;do{if(i=N?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===L},focus:function(t){return t===I.activeElement&&(!I.hasFocus||I.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!b.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return pt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:h(function(){return[0]}),last:h(function(t,e){return[e-1]}),eq:h(function(t,e,i){return[i<0?i+e:i]}),even:h(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:h(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:h(function(t,e,i){for(var n=i<0?i+e:i;--n>=0;)t.push(n);return t}),gt:h(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}},b.pseudos.nth=b.pseudos.eq;for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[_]=a(_);for(_ in{submit:!0,reset:!0})b.pseudos[_]=l(_);return c.prototype=b.filters=b.pseudos,b.setFilters=new c,C=e.tokenize=function(t,i){var n,r,o,s,a,l,h,u=q[t+" "];if(u)return i?0:u.slice(0);for(a=t,l=[],h=b.preFilter;a;){n&&!(r=lt.exec(a))||(r&&(a=a.slice(r[0].length)||a),l.push(o=[])),n=!1,(r=ht.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(at," ")}),a=a.slice(n.length))
;for(s in b.filter)!(r=ft[s].exec(a))||h[s]&&!(r=h[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return i?a.length:a?e.error(t):q(t,l).slice(0)},P=e.compile=function(t,e){var i,n=[],r=[],o=V[t+" "];if(!o){for(e||(e=C(t)),i=e.length;i--;)o=y(e[i]),o[B]?n.push(o):r.push(o);o=V(t,w(r,n)),o.selector=t}return o},E=e.select=function(t,e,i,n){var r,o,s,a,l,h="function"==typeof t&&t,c=!n&&C(t=h.selector||t);if(i=i||[],1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&x.getById&&9===e.nodeType&&N&&b.relative[o[1].type]){if(!(e=(b.find.ID(s.matches[0].replace(_t,xt),e)||[])[0]))return i;h&&(e=e.parentNode),t=t.slice(o.shift().value.length)}for(r=ft.needsContext.test(t)?0:o.length;r--&&(s=o[r],!b.relative[a=s.type]);)if((l=b.find[a])&&(n=l(s.matches[0].replace(_t,xt),yt.test(o[0].type)&&u(e.parentNode)||e))){if(o.splice(r,1),!(t=n.length&&d(o)))return J.apply(i,n),i;break}}return(h||P(t,c))(n,e,!N,i,!e||yt.test(t)&&u(e.parentNode)||e),i},x.sortStable=B.split("").sort(U).join("")===B,x.detectDuplicates=!!M,R(),x.sortDetached=r(function(t){return 1&t.compareDocumentPosition(I.createElement("div"))}),r(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||o("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),x.attributes&&r(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||o("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),r(function(t){return null==t.getAttribute("disabled")})||o(et,function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);ot.find=ut,ot.expr=ut.selectors,ot.expr[":"]=ot.expr.pseudos,ot.uniqueSort=ot.unique=ut.uniqueSort,ot.text=ut.getText,ot.isXMLDoc=ut.isXML,ot.contains=ut.contains;var ct=function(t,e,i){for(var n=[],r=i!==undefined;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&ot(t).is(i))break;n.push(t)}return n},dt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},ft=ot.expr.match.needsContext,pt=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,gt=/^.[^:#\[\.,]*$/;ot.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?ot.find.matchesSelector(n,t)?[n]:[]:ot.find.matches(t,ot.grep(e,function(t){return 1===t.nodeType}))},ot.fn.extend({find:function(t){var e,i=this.length,n=[],r=this;if("string"!=typeof t)return this.pushStack(ot(t).filter(function(){for(e=0;e<i;e++)if(ot.contains(r[e],this))return!0}));for(e=0;e<i;e++)ot.find(t,r[e],n);return n=this.pushStack(i>1?ot.unique(n):n),n.selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(n(this,t||[],!1))},not:function(t){return this.pushStack(n(this,t||[],!0))},is:function(t){return!!n(this,"string"==typeof t&&ft.test(t)?ot(t):t||[],!1).length}});var mt,vt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(ot.fn.init=function(t,e,i){var n,r;if(!t)return this;if(i=i||mt,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:vt.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof ot?e[0]:e,ot.merge(this,ot.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:X,!0)),pt.test(n[1])&&ot.isPlainObject(e))for(n in e)ot.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return r=X.getElementById(n[2]),r&&r.parentNode&&(this.length=1,this[0]=r),this.context=X,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):ot.isFunction(t)?i.ready!==undefined?i.ready(t):t(ot):(t.selector!==undefined&&(this.selector=t.selector,this.context=t.context),ot.makeArray(t,this))}).prototype=ot.fn,mt=ot(X);var yt=/^(?:parents|prev(?:Until|All))/,wt={children:!0,contents:!0,next:!0,prev:!0};ot.fn.extend({has:function(t){var e=ot(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(ot.contains(this,e[t]))return!0})},closest:function(t,e){for(var i,n=0,r=this.length,o=[],s=ft.test(t)||"string"!=typeof t?ot(t,e||this.context):0;n<r;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&ot.find.matchesSelector(i,t))){o.push(i);break}return this.pushStack(o.length>1?ot.uniqueSort(o):o)},index:function(t){return t?"string"==typeof t?Q.call(ot(t),this[0]):Q.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(ot.uniqueSort(ot.merge(this.get(),ot(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),ot.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return ct(t,"parentNode")},parentsUntil:function(t,e,i){return ct(t,"parentNode",i)},next:function(t){return r(t,"nextSibling")},prev:function(t){return r(t,"previousSibling")},nextAll:function(t){return ct(t,"nextSibling")},prevAll:function(t){return ct(t,"previousSibling")},nextUntil:function(t,e,i){return ct(t,"nextSibling",i)},prevUntil:function(t,e,i){return ct(t,"previousSibling",i)},siblings:function(t){return dt((t.parentNode||{}).firstChild,t)},children:function(t){return dt(t.firstChild)},contents:function(t){return t.contentDocument||ot.merge([],t.childNodes)}},function(t,e){ot.fn[t]=function(i,n){var r=ot.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=ot.filter(n,r)),this.length>1&&(wt[t]||ot.uniqueSort(r),yt.test(t)&&r.reverse()),this.pushStack(r)}});var _t=/\S+/g;ot.Callbacks=function(t){t="string"==typeof t?o(t):ot.extend({},t);var e,i,n,r,s=[],a=[],l=-1,h=function(){for(r=t.once,n=e=!0;a.length;l=-1)for(i=a.shift();++l<s.length;)!1===s[l].apply(i[0],i[1])&&t.stopOnFalse&&(l=s.length,i=!1);t.memory||(i=!1),e=!1,r&&(s=i?[]:"")},u={add:function(){return s&&(i&&!e&&(l=s.length-1,a.push(i)),function e(i){ot.each(i,function(i,n){ot.isFunction(n)?t.unique&&u.has(n)||s.push(n):n&&n.length&&"string"!==ot.type(n)&&e(n)})}(arguments),i&&!e&&h()),this},remove:function(){return ot.each(arguments,function(t,e){for(var i;(i=ot.inArray(e,s,i))>-1;)s.splice(i,1),i<=l&&l--}),this},has:function(t){return t?ot.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=a=[],s=i="",this},disabled:function(){return!s},lock:function(){return r=a=[],i||(s=i=""),this},locked:function(){return!!r},fireWith:function(t,i){return r||(i=i||[],i=[t,i.slice?i.slice():i],a.push(i),e||h()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},ot.extend({Deferred:function(t){var e=[["resolve","done",ot.Callbacks("once memory"),"resolved"],["reject","fail",ot.Callbacks("once memory"),"rejected"],["notify","progress",ot.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return ot.Deferred(function(i){ot.each(e,function(e,o){var s=ot.isFunction(t[e])&&t[e];r[o[1]](function(){var t=s&&s.apply(this,arguments);t&&ot.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[o[0]+"With"](this===n?i.promise():this,s?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?ot.extend(t,n):n}},r={};return n.pipe=n.then,ot.each(e,function(t,o){var s=o[2],a=o[3];n[o[1]]=s.add,a&&s.add(function(){i=a},e[1^t][2].disable,e[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=s.fireWith}),n.promise(r),t&&t.call(r,r),r},when:function(t){var e,i,n,r=0,o=Y.call(arguments),s=o.length,a=1!==s||t&&ot.isFunction(t.promise)?s:0,l=1===a?t:ot.Deferred(),h=function(t,i,n){return function(r){i[t]=this,n[t]=arguments.length>1?Y.call(arguments):r,n===e?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(s>1)for(e=new Array(s),i=new Array(s),n=new Array(s);r<s;r++)o[r]&&ot.isFunction(o[r].promise)?o[r].promise().progress(h(r,i,e)).done(h(r,n,o)).fail(l.reject):--a;return a||l.resolveWith(n,o),l.promise()}});var xt;ot.fn.ready=function(t){return ot.ready.promise().done(t),this},ot.extend({isReady:!1,readyWait:1,holdReady:function(t){t?ot.readyWait++:ot.ready(!0)},ready:function(t){(!0===t?--ot.readyWait:ot.isReady)||(ot.isReady=!0,!0!==t&&--ot.readyWait>0||(xt.resolveWith(X,[ot]),ot.fn.triggerHandler&&(ot(X).triggerHandler("ready"),ot(X).off("ready"))))}}),ot.ready.promise=function(e){return xt||(xt=ot.Deferred(),"complete"===X.readyState||"loading"!==X.readyState&&!X.documentElement.doScroll?t.setTimeout(ot.ready):(X.addEventListener("DOMContentLoaded",s),t.addEventListener("load",s))),xt.promise(e)},ot.ready.promise();var bt=function(t,e,i,n,r,o,s){var a=0,l=t.length,h=null==i;if("object"===ot.type(i)){r=!0;for(a in i)bt(t,e,a,i[a],!0,o,s)}else if(n!==undefined&&(r=!0,ot.isFunction(n)||(s=!0),h&&(s?(e.call(t,n),e=null):(h=e,e=function(t,e,i){return h.call(ot(t),i)})),e))for(;a<l;a++)e(t[a],i,s?n:n.call(t[a],a,e(t[a],i)));return r?t:h?e.call(t):l?e(t[0],i):o},St=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};a.uid=1,a.prototype={register:function(t,e){var i=e||{};return t.nodeType?t[this.expando]=i:Object.defineProperty(t,this.expando,{value:i,writable:!0,configurable:!0}),t[this.expando]},cache:function(t){if(!St(t))return{};var e=t[this.expando];return e||(e={},St(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,r=this.cache(t);if("string"==typeof e)r[e]=i;else for(n in e)r[n]=e[n];return r},get:function(t,e){return e===undefined?this.cache(t):t[this.expando]&&t[this.expando][e]},access:function(t,e,i){var n;return e===undefined||e&&"string"==typeof e&&i===undefined?(n=this.get(t,e),n!==undefined?n:this.get(t,ot.camelCase(e))):(this.set(t,e,i),i!==undefined?i:e)},remove:function(t,e){var i,n,r,o=t[this.expando];if(o!==undefined){if(e===undefined)this.register(t);else{ot.isArray(e)?n=e.concat(e.map(ot.camelCase)):(r=ot.camelCase(e),e in o?n=[e,r]:(n=r,n=n in o?[n]:n.match(_t)||[])),i=n.length;for(;i--;)delete o[n[i]]}(e===undefined||ot.isEmptyObject(o))&&(t.nodeType?t[this.expando]=undefined:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return e!==undefined&&!ot.isEmptyObject(e)}};var Tt=new a,Ct=new a,Pt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Et=/[A-Z]/g;ot.extend({hasData:function(t){return Ct.hasData(t)||Tt.hasData(t)},data:function(t,e,i){return Ct.access(t,e,i)},removeData:function(t,e){Ct.remove(t,e)},_data:function(t,e,i){return Tt.access(t,e,i)},_removeData:function(t,e){Tt.remove(t,e)}}),ot.fn.extend({data:function(t,e){var i,n,r,o=this[0],s=o&&o.attributes;if(t===undefined){if(this.length&&(r=Ct.get(o),1===o.nodeType&&!Tt.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(n=s[i].name,0===n.indexOf("data-")&&(n=ot.camelCase(n.slice(5)),l(o,n,r[n])));Tt.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each(function(){Ct.set(this,t)}):bt(this,function(e){var i,n;if(o&&e===undefined){if((i=Ct.get(o,t)||Ct.get(o,t.replace(Et,"-$&").toLowerCase()))!==undefined)return i;if(n=ot.camelCase(t),(i=Ct.get(o,n))!==undefined)return i;if((i=l(o,n,undefined))!==undefined)return i}else n=ot.camelCase(t),this.each(function(){var i=Ct.get(this,n);Ct.set(this,n,e),t.indexOf("-")>-1&&i!==undefined&&Ct.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Ct.remove(this,t)})}}),ot.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=Tt.get(t,e),i&&(!n||ot.isArray(i)?n=Tt.access(t,e,ot.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=ot.queue(t,e),n=i.length,r=i.shift(),o=ot._queueHooks(t,e),s=function(){ot.dequeue(t,e)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete o.stop,r.call(t,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Tt.get(t,i)||Tt.access(t,i,{empty:ot.Callbacks("once memory").add(function(){Tt.remove(t,[e+"queue",i])})})}}),ot.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?ot.queue(this[0],t):e===undefined?this:this.each(function(){var i=ot.queue(this,t,e);ot._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&ot.dequeue(this,t)})},dequeue:function(t){return this.each(function(){ot.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=ot.Deferred(),o=this,s=this.length,a=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=undefined),t=t||"fx";s--;)(i=Tt.get(o[s],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(e)}});var kt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ot=new RegExp("^(?:([+-])=|)("+kt+")([a-z%]*)$","i"),Mt=["Top","Right","Bottom","Left"],Rt=function(t,e){return t=e||t,"none"===ot.css(t,"display")||!ot.contains(t.ownerDocument,t)},It=/^(?:checkbox|radio)$/i,Lt=/<([\w:-]+)/,Nt=/^$|\/(?:java|ecma)script/i,At={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td;var Dt=/<|&#?\w+;/;!function(){var t=X.createDocumentFragment(),e=t.appendChild(X.createElement("div")),i=X.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),nt.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",nt.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var zt=/^key/,Ht=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Bt=/^([^.]*)(?:\.(.+)|)/;ot.event={global:{},add:function(t,e,i,n,r){var o,s,a,l,h,u,c,d,f,p,g,m=Tt.get(t);if(m)for(i.handler&&(o=i,i=o.handler,r=o.selector),i.guid||(i.guid=ot.guid++),(l=m.events)||(l=m.events={}),(s=m.handle)||(s=m.handle=function(e){return void 0!==ot&&ot.event.triggered!==e.type?ot.event.dispatch.apply(t,arguments):undefined}),e=(e||"").match(_t)||[""],h=e.length;h--;)a=Bt.exec(e[h])||[],f=g=a[1],p=(a[2]||"").split(".").sort(),f&&(c=ot.event.special[f]||{},f=(r?c.delegateType:c.bindType)||f,c=ot.event.special[f]||{},u=ot.extend({type:f,origType:g,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&ot.expr.match.needsContext.test(r),namespace:p.join(".")},o),(d=l[f])||(d=l[f]=[],d.delegateCount=0,c.setup&&!1!==c.setup.call(t,n,p,s)||t.addEventListener&&t.addEventListener(f,s)),c.add&&(c.add.call(t,u),u.handler.guid||(u.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,u):d.push(u),ot.event.global[f]=!0)},remove:function(t,e,i,n,r){var o,s,a,l,h,u,c,d,f,p,g,m=Tt.hasData(t)&&Tt.get(t);if(m&&(l=m.events)){for(e=(e||"").match(_t)||[""],h=e.length;h--;)if(a=Bt.exec(e[h])||[],f=g=a[1],p=(a[2]||"").split(".").sort(),f){for(c=ot.event.special[f]||{},f=(n?c.delegateType:c.bindType)||f,d=l[f]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=d.length;o--;)u=d[o],!r&&g!==u.origType||i&&i.guid!==u.guid||a&&!a.test(u.namespace)||n&&n!==u.selector&&("**"!==n||!u.selector)||(d.splice(o,1),u.selector&&d.delegateCount--,c.remove&&c.remove.call(t,u));s&&!d.length&&(c.teardown&&!1!==c.teardown.call(t,p,m.handle)||ot.removeEvent(t,f,m.handle),delete l[f])}else for(f in l)ot.event.remove(t,f+e[h],i,n,!0);ot.isEmptyObject(l)&&Tt.remove(t,"handle events")}},dispatch:function(t){t=ot.event.fix(t);var e,i,n,r,o,s=[],a=Y.call(arguments),l=(Tt.get(this,"events")||{})[t.type]||[],h=ot.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,t)){for(s=ot.event.handlers.call(this,t,l),e=0;(r=s[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,i=0;(o=r.handlers[i++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(o.namespace)||(t.handleObj=o,t.data=o.data,(n=((ot.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,a))!==undefined&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,r,o,s=[],a=e.delegateCount,l=t.target;if(a&&l.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(!0!==l.disabled||"click"!==t.type)){for(n=[],i=0;i<a;i++)o=e[i],r=o.selector+" ",n[r]===undefined&&(n[r]=o.needsContext?ot(r,this).index(l)>-1:ot.find(r,this,null,[l]).length),n[r]&&n.push(o);n.length&&s.push({elem:l,handlers:n})}return a<e.length&&s.push({elem:this,handlers:e.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,r,o=e.button;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||X,n=i.documentElement,r=i.body,t.pageX=e.clientX+(n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0),t.pageY=e.clientY+(n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0)),t.which||o===undefined||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[ot.expando])return t;var e,i,n,r=t.type,o=t,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Ht.test(r)?this.mouseHooks:zt.test(r)?this.keyHooks:{}),n=s.props?this.props.concat(s.props):this.props,t=new ot.Event(o),e=n.length;e--;)i=n[e],t[i]=o[i];return t.target||(t.target=X),3===t.target.nodeType&&(t.target=t.target.parentNode),s.filter?s.filter(t,o):t},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==g()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===g()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&ot.nodeName(this,"input"))return this.click(),!1},_default:function(t){return ot.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){t.result!==undefined&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},ot.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},ot.Event=function(t,e){if(!(this instanceof ot.Event))return new ot.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.defaultPrevented===undefined&&!1===t.returnValue?f:p):this.type=t,e&&ot.extend(this,e),this.timeStamp=t&&t.timeStamp||ot.now(),this[ot.expando]=!0},ot.Event.prototype={constructor:ot.Event,isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=f,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=f,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=f,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},ot.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){ot.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,r=t.relatedTarget,o=t.handleObj;return r&&(r===n||ot.contains(n,r))||(t.type=o.origType,i=o.handler.apply(this,arguments),t.type=e),i}}}),ot.fn.extend({on:function(t,e,i,n){return m(this,t,e,i,n)},one:function(t,e,i,n){return m(this,t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,ot(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=undefined),!1===i&&(i=p),this.each(function(){ot.event.remove(this,t,i,e)})}});var Ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,$t=/<script|<style|<link/i,jt=/checked\s*(?:[^=]|=\s*.checked.)/i,Wt=/^true\/(.*)/,qt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;ot.extend({htmlPrefilter:function(t){return t.replace(Ft,"<$1></$2>")},clone:function(t,e,i){var n,r,o,s,a=t.cloneNode(!0),l=ot.contains(t.ownerDocument,t);if(!(nt.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||ot.isXMLDoc(t)))for(s=u(a),o=u(t),n=0,r=o.length;n<r;n++)x(o[n],s[n]);if(e)if(i)for(o=o||u(t),s=s||u(a),n=0,r=o.length;n<r;n++)_(o[n],s[n]);else _(t,a);return s=u(a,"script"),s.length>0&&c(s,!l&&u(t,"script")),a},cleanData:function(t){for(var e,i,n,r=ot.event.special,o=0;(i=t[o])!==undefined;o++)if(St(i)){if(e=i[Tt.expando]){if(e.events)for(n in e.events)r[n]?ot.event.remove(i,n):ot.removeEvent(i,n,e.handle);i[Tt.expando]=undefined}i[Ct.expando]&&(i[Ct.expando]=undefined)}}}),ot.fn.extend({domManip:b,detach:function(t){return S(this,t,!0)},remove:function(t){return S(this,t)},text:function(t){return bt(this,function(t){return t===undefined?ot.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return b(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){v(this,t).appendChild(t)}})},prepend:function(){return b(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return b(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return b(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(ot.cleanData(u(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return ot.clone(this,t,e)})},html:function(t){return bt(this,function(t){var e=this[0]||{},i=0,n=this.length;if(t===undefined&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!$t.test(t)&&!At[(Lt.exec(t)||["",""])[1].toLowerCase()]){t=ot.htmlPrefilter(t);try{for(;i<n;i++)e=this[i]||{},1===e.nodeType&&(ot.cleanData(u(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return b(this,arguments,function(e){var i=this.parentNode;ot.inArray(this,t)<0&&(ot.cleanData(u(this)),i&&i.replaceChild(e,this))},t)}}),ot.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){ot.fn[t]=function(t){for(var i,n=[],r=ot(t),o=r.length-1,s=0;s<=o;s++)i=s===o?this:this.clone(!0),ot(r[s])[e](i),J.apply(n,i.get());return this.pushStack(n)}});var Vt,Ut={HTML:"block",BODY:"block"},Gt=/^margin/,Zt=new RegExp("^("+kt+")(?!px)[a-z%]+$","i"),Xt=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Yt=function(t,e,i,n){var r,o,s={};for(o in e)s[o]=t.style[o],t.style[o]=e[o];r=i.apply(t,n||[]);for(o in e)t.style[o]=s[o];return r},Kt=X.documentElement;!function(){function e(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Kt.appendChild(s);var e=t.getComputedStyle(a);i="1%"!==e.top,o="2px"===e.marginLeft,n="4px"===e.width,a.style.marginRight="50%",r="4px"===e.marginRight,Kt.removeChild(s)}var i,n,r,o,s=X.createElement("div"),a=X.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",nt.clearCloneStyle="content-box"===a.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(a),ot.extend(nt,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return null==n&&e(),n},pixelMarginRight:function(){return null==n&&e(),r},reliableMarginLeft:function(){return null==n&&e(),o},reliableMarginRight:function(){var e,i=a.appendChild(X.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",Kt.appendChild(s),e=!parseFloat(t.getComputedStyle(i).marginRight),Kt.removeChild(s),a.removeChild(i),e}}))}();var Jt=/^(none|table(?!-c[ea]).+)/,Qt={position:"absolute",visibility:"hidden",display:"block"},te={letterSpacing:"0",fontWeight:"400"},ee=["Webkit","O","Moz","ms"],ie=X.createElement("div").style;ot.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=P(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,o,s,a=ot.camelCase(e),l=t.style;if(e=ot.cssProps[a]||(ot.cssProps[a]=k(a)||a),s=ot.cssHooks[e]||ot.cssHooks[a],i===undefined)return s&&"get"in s&&(r=s.get(t,!1,n))!==undefined?r:l[e];o=typeof i,"string"===o&&(r=Ot.exec(i))&&r[1]&&(i=h(t,e,r),o="number"),null!=i&&i===i&&("number"===o&&(i+=r&&r[3]||(ot.cssNumber[a]?"":"px")),nt.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),s&&"set"in s&&(i=s.set(t,i,n))===undefined||(l[e]=i))}},css:function(t,e,i,n){var r,o,s,a=ot.camelCase(e);return e=ot.cssProps[a]||(ot.cssProps[a]=k(a)||a),s=ot.cssHooks[e]||ot.cssHooks[a],s&&"get"in s&&(r=s.get(t,!0,i)),r===undefined&&(r=P(t,e,n)),"normal"===r&&e in te&&(r=te[e]),""===i||i?(o=parseFloat(r),!0===i||isFinite(o)?o||0:r):r}}),ot.each(["height","width"],function(t,e){ot.cssHooks[e]={get:function(t,i,n){if(i)return Jt.test(ot.css(t,"display"))&&0===t.offsetWidth?Yt(t,Qt,function(){return R(t,e,n)}):R(t,e,n)},set:function(t,i,n){var r,o=n&&Xt(t),s=n&&M(t,e,n,"border-box"===ot.css(t,"boxSizing",!1,o),o);return s&&(r=Ot.exec(i))&&"px"!==(r[3]||"px")&&(t.style[e]=i,i=ot.css(t,e)),O(t,i,s)}}}),ot.cssHooks.marginLeft=E(nt.reliableMarginLeft,function(t,e){if(e)return(parseFloat(P(t,"marginLeft"))||t.getBoundingClientRect().left-Yt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),ot.cssHooks.marginRight=E(nt.reliableMarginRight,function(t,e){if(e)return Yt(t,{display:"inline-block"},P,[t,"marginRight"])}),ot.each({margin:"",padding:"",border:"Width"},function(t,e){ot.cssHooks[t+e]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];n<4;n++)r[t+Mt[n]+e]=o[n]||o[n-2]||o[0];return r}},Gt.test(t)||(ot.cssHooks[t+e].set=O)}),ot.fn.extend({css:function(t,e){return bt(this,function(t,e,i){var n,r,o={},s=0;if(ot.isArray(e)){for(n=Xt(t),r=e.length;s<r;s++)o[e[s]]=ot.css(t,e[s],!1,n);return o}return i!==undefined?ot.style(t,e,i):ot.css(t,e)},t,e,arguments.length>1)},show:function(){return I(this,!0)},hide:function(){return I(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Rt(this)?ot(this).show():ot(this).hide()})}}),ot.Tween=L,L.prototype={constructor:L,init:function(t,e,i,n,r,o){this.elem=t,this.prop=i,this.easing=r||ot.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=o||(ot.cssNumber[i]?"":"px")},cur:function(){var t=L.propHooks[this.prop];return t&&t.get?t.get(this):L.propHooks._default.get(this)},run:function(t){var e,i=L.propHooks[this.prop];return this.options.duration?this.pos=e=ot.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):L.propHooks._default.set(this),this}},L.prototype.init.prototype=L.prototype,L.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=ot.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){ot.fx.step[t.prop]?ot.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[ot.cssProps[t.prop]]&&!ot.cssHooks[t.prop]?t.elem[t.prop]=t.now:ot.style(t.elem,t.prop,t.now+t.unit)}}},L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},ot.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},ot.fx=L.prototype.init,ot.fx.step={};var ne,re,oe=/^(?:toggle|show|hide)$/,se=/queueHooks$/;ot.Animation=ot.extend(B,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return h(i.elem,t,Ot.exec(e),i),i}]},tweener:function(t,e){ot.isFunction(t)?(e=t,t=["*"]):t=t.match(_t);for(var i,n=0,r=t.length;n<r;n++)i=t[n],B.tweeners[i]=B.tweeners[i]||[],B.tweeners[i].unshift(e)},prefilters:[z],prefilter:function(t,e){e?B.prefilters.unshift(t):B.prefilters.push(t)}}),ot.speed=function(t,e,i){var n=t&&"object"==typeof t?ot.extend({},t):{complete:i||!i&&e||ot.isFunction(t)&&t,duration:t,easing:i&&e||e&&!ot.isFunction(e)&&e};return n.duration=ot.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in ot.fx.speeds?ot.fx.speeds[n.duration]:ot.fx.speeds._default,null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){ot.isFunction(n.old)&&n.old.call(this),n.queue&&ot.dequeue(this,n.queue)},n},ot.fn.extend({fadeTo:function(t,e,i,n){return this.filter(Rt).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=ot.isEmptyObject(t),o=ot.speed(e,i,n),s=function(){var e=B(this,ot.extend({},t),o);(r||Tt.get(this,"finish"))&&e.stop(!0)};return s.finish=s,r||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=undefined),e&&!1!==t&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",o=ot.timers,s=Tt.get(this);if(r)s[r]&&s[r].stop&&n(s[r]);else for(r in s)s[r]&&s[r].stop&&se.test(r)&&n(s[r]);for(r=o.length;r--;)o[r].elem!==this||null!=t&&o[r].queue!==t||(o[r].anim.stop(i),e=!1,o.splice(r,1));!e&&i||ot.dequeue(this,t)})},finish:function(t){return!1!==t&&(t=t||"fx"),this.each(function(){var e,i=Tt.get(this),n=i[t+"queue"],r=i[t+"queueHooks"],o=ot.timers,s=n?n.length:0;for(i.finish=!0,ot.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;e<s;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),ot.each(["toggle","show","hide"],function(t,e){var i=ot.fn[e];ot.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(A(e,!0),t,n,r)}}),ot.each({slideDown:A("show"),slideUp:A("hide"),slideToggle:A("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){ot.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),ot.timers=[],ot.fx.tick=function(){var t,e=0,i=ot.timers;for(ne=ot.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||ot.fx.stop(),ne=undefined},ot.fx.timer=function(t){ot.timers.push(t),t()?ot.fx.start():ot.timers.pop()},ot.fx.interval=13,ot.fx.start=function(){re||(re=t.setInterval(ot.fx.tick,ot.fx.interval))},ot.fx.stop=function(){t.clearInterval(re),re=null},ot.fx.speeds={slow:600,fast:200,_default:400},ot.fn.delay=function(e,i){return e=ot.fx?ot.fx.speeds[e]||e:e,i=i||"fx",this.queue(i,function(i,n){var r=t.setTimeout(i,e);n.stop=function(){t.clearTimeout(r)}})},function(){var t=X.createElement("input"),e=X.createElement("select"),i=e.appendChild(X.createElement("option"));t.type="checkbox",nt.checkOn=""!==t.value,nt.optSelected=i.selected,e.disabled=!0,nt.optDisabled=!i.disabled,t=X.createElement("input"),t.value="t",t.type="radio",nt.radioValue="t"===t.value}();var ae,le=ot.expr.attrHandle;ot.fn.extend({attr:function(t,e){return bt(this,ot.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){ot.removeAttr(this,t)})}}),ot.extend({attr:function(t,e,i){var n,r,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof t.getAttribute?ot.prop(t,e,i):(1===o&&ot.isXMLDoc(t)||(e=e.toLowerCase(),r=ot.attrHooks[e]||(ot.expr.match.bool.test(e)?ae:undefined)),i!==undefined?null===i?void ot.removeAttr(t,e):r&&"set"in r&&(n=r.set(t,i,e))!==undefined?n:(t.setAttribute(e,i+""),
i):r&&"get"in r&&null!==(n=r.get(t,e))?n:(n=ot.find.attr(t,e),null==n?undefined:n))},attrHooks:{type:{set:function(t,e){if(!nt.radioValue&&"radio"===e&&ot.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n,r=0,o=e&&e.match(_t);if(o&&1===t.nodeType)for(;i=o[r++];)n=ot.propFix[i]||i,ot.expr.match.bool.test(i)&&(t[n]=!1),t.removeAttribute(i)}}),ae={set:function(t,e,i){return!1===e?ot.removeAttr(t,i):t.setAttribute(i,i),i}},ot.each(ot.expr.match.bool.source.match(/\w+/g),function(t,e){var i=le[e]||ot.find.attr;le[e]=function(t,e,n){var r,o;return n||(o=le[e],le[e]=r,r=null!=i(t,e,n)?e.toLowerCase():null,le[e]=o),r}});var he=/^(?:input|select|textarea|button)$/i,ue=/^(?:a|area)$/i;ot.fn.extend({prop:function(t,e){return bt(this,ot.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[ot.propFix[t]||t]})}}),ot.extend({prop:function(t,e,i){var n,r,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ot.isXMLDoc(t)||(e=ot.propFix[e]||e,r=ot.propHooks[e]),i!==undefined?r&&"set"in r&&(n=r.set(t,i,e))!==undefined?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=ot.find.attr(t,"tabindex");return e?parseInt(e,10):he.test(t.nodeName)||ue.test(t.nodeName)&&t.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),nt.optSelected||(ot.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),ot.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ot.propFix[this.toLowerCase()]=this});var ce=/[\t\r\n\f]/g;ot.fn.extend({addClass:function(t){var e,i,n,r,o,s,a,l=0;if(ot.isFunction(t))return this.each(function(e){ot(this).addClass(t.call(this,e,F(this)))});if("string"==typeof t&&t)for(e=t.match(_t)||[];i=this[l++];)if(r=F(i),n=1===i.nodeType&&(" "+r+" ").replace(ce," ")){for(s=0;o=e[s++];)n.indexOf(" "+o+" ")<0&&(n+=o+" ");a=ot.trim(n),r!==a&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,n,r,o,s,a,l=0;if(ot.isFunction(t))return this.each(function(e){ot(this).removeClass(t.call(this,e,F(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(_t)||[];i=this[l++];)if(r=F(i),n=1===i.nodeType&&(" "+r+" ").replace(ce," ")){for(s=0;o=e[s++];)for(;n.indexOf(" "+o+" ")>-1;)n=n.replace(" "+o+" "," ");a=ot.trim(n),r!==a&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):ot.isFunction(t)?this.each(function(i){ot(this).toggleClass(t.call(this,i,F(this),e),e)}):this.each(function(){var e,n,r,o;if("string"===i)for(n=0,r=ot(this),o=t.match(_t)||[];e=o[n++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else t!==undefined&&"boolean"!==i||(e=F(this),e&&Tt.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":Tt.get(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+F(i)+" ").replace(ce," ").indexOf(e)>-1)return!0;return!1}});var de=/\r/g,fe=/[\x20\t\r\n\f]+/g;ot.fn.extend({val:function(t){var e,i,n,r=this[0];{if(arguments.length)return n=ot.isFunction(t),this.each(function(i){var r;1===this.nodeType&&(r=n?t.call(this,i,ot(this).val()):t,null==r?r="":"number"==typeof r?r+="":ot.isArray(r)&&(r=ot.map(r,function(t){return null==t?"":t+""})),(e=ot.valHooks[this.type]||ot.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&e.set(this,r,"value")!==undefined||(this.value=r))});if(r)return(e=ot.valHooks[r.type]||ot.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&(i=e.get(r,"value"))!==undefined?i:(i=r.value,"string"==typeof i?i.replace(de,""):null==i?"":i)}}}),ot.extend({valHooks:{option:{get:function(t){var e=ot.find.attr(t,"value");return null!=e?e:ot.trim(ot.text(t)).replace(fe," ")}},select:{get:function(t){for(var e,i,n=t.options,r=t.selectedIndex,o="select-one"===t.type||r<0,s=o?null:[],a=o?r+1:n.length,l=r<0?a:o?r:0;l<a;l++)if(i=n[l],(i.selected||l===r)&&(nt.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!ot.nodeName(i.parentNode,"optgroup"))){if(e=ot(i).val(),o)return e;s.push(e)}return s},set:function(t,e){for(var i,n,r=t.options,o=ot.makeArray(e),s=r.length;s--;)n=r[s],(n.selected=ot.inArray(ot.valHooks.option.get(n),o)>-1)&&(i=!0);return i||(t.selectedIndex=-1),o}}}}),ot.each(["radio","checkbox"],function(){ot.valHooks[this]={set:function(t,e){if(ot.isArray(e))return t.checked=ot.inArray(ot(t).val(),e)>-1}},nt.checkOn||(ot.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var pe=/^(?:focusinfocus|focusoutblur)$/;ot.extend(ot.event,{trigger:function(e,i,n,r){var o,s,a,l,h,u,c,d=[n||X],f=it.call(e,"type")?e.type:e,p=it.call(e,"namespace")?e.namespace.split("."):[];if(s=a=n=n||X,3!==n.nodeType&&8!==n.nodeType&&!pe.test(f+ot.event.triggered)&&(f.indexOf(".")>-1&&(p=f.split("."),f=p.shift(),p.sort()),h=f.indexOf(":")<0&&"on"+f,e=e[ot.expando]?e:new ot.Event(f,"object"==typeof e&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),i=null==i?[e]:ot.makeArray(i,[e]),c=ot.event.special[f]||{},r||!c.trigger||!1!==c.trigger.apply(n,i))){if(!r&&!c.noBubble&&!ot.isWindow(n)){for(l=c.delegateType||f,pe.test(l+f)||(s=s.parentNode);s;s=s.parentNode)d.push(s),a=s;a===(n.ownerDocument||X)&&d.push(a.defaultView||a.parentWindow||t)}for(o=0;(s=d[o++])&&!e.isPropagationStopped();)e.type=o>1?l:c.bindType||f,u=(Tt.get(s,"events")||{})[e.type]&&Tt.get(s,"handle"),u&&u.apply(s,i),(u=h&&s[h])&&u.apply&&St(s)&&(e.result=u.apply(s,i),!1===e.result&&e.preventDefault());return e.type=f,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(d.pop(),i)||!St(n)||h&&ot.isFunction(n[f])&&!ot.isWindow(n)&&(a=n[h],a&&(n[h]=null),ot.event.triggered=f,n[f](),ot.event.triggered=undefined,a&&(n[h]=a)),e.result}},simulate:function(t,e,i){var n=ot.extend(new ot.Event,i,{type:t,isSimulated:!0});ot.event.trigger(n,null,e)}}),ot.fn.extend({trigger:function(t,e){return this.each(function(){ot.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return ot.event.trigger(t,e,i,!0)}}),ot.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){ot.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),ot.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),nt.focusin="onfocusin"in t,nt.focusin||ot.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){ot.event.simulate(e,t.target,ot.event.fix(t))};ot.event.special[e]={setup:function(){var n=this.ownerDocument||this,r=Tt.access(n,e);r||n.addEventListener(t,i,!0),Tt.access(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=Tt.access(n,e)-1;r?Tt.access(n,e,r):(n.removeEventListener(t,i,!0),Tt.remove(n,e))}}});var ge=t.location,me=ot.now(),ve=/\?/;ot.parseJSON=function(t){return JSON.parse(t+"")},ot.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=undefined}return i&&!i.getElementsByTagName("parsererror").length||ot.error("Invalid XML: "+e),i};var ye=/#.*$/,we=/([?&])_=[^&]*/,_e=/^(.*?):[ \t]*([^\r\n]*)$/gm,xe=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,be=/^(?:GET|HEAD)$/,Se=/^\/\//,Te={},Ce={},Pe="*/".concat("*"),Ee=X.createElement("a");Ee.href=ge.href,ot.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ge.href,type:"GET",isLocal:xe.test(ge.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Pe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ot.parseJSON,"text xml":ot.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?W(W(t,ot.ajaxSettings),e):W(ot.ajaxSettings,t)},ajaxPrefilter:$(Te),ajaxTransport:$(Ce),ajax:function(e,i){function n(e,i,n,a){var h,c,y,w,x,S=i;2!==_&&(_=2,l&&t.clearTimeout(l),r=undefined,s=a||"",b.readyState=e>0?4:0,h=e>=200&&e<300||304===e,n&&(w=q(d,b,n)),w=V(d,w,b,h),h?(d.ifModified&&(x=b.getResponseHeader("Last-Modified"),x&&(ot.lastModified[o]=x),(x=b.getResponseHeader("etag"))&&(ot.etag[o]=x)),204===e||"HEAD"===d.type?S="nocontent":304===e?S="notmodified":(S=w.state,c=w.data,y=w.error,h=!y)):(y=S,!e&&S||(S="error",e<0&&(e=0))),b.status=e,b.statusText=(i||S)+"",h?g.resolveWith(f,[c,S,b]):g.rejectWith(f,[b,S,y]),b.statusCode(v),v=undefined,u&&p.trigger(h?"ajaxSuccess":"ajaxError",[b,d,h?c:y]),m.fireWith(f,[b,S]),u&&(p.trigger("ajaxComplete",[b,d]),--ot.active||ot.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=undefined),i=i||{};var r,o,s,a,l,h,u,c,d=ot.ajaxSetup({},i),f=d.context||d,p=d.context&&(f.nodeType||f.jquery)?ot(f):ot.event,g=ot.Deferred(),m=ot.Callbacks("once memory"),v=d.statusCode||{},y={},w={},_=0,x="canceled",b={readyState:0,getResponseHeader:function(t){var e;if(2===_){if(!a)for(a={};e=_e.exec(s);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===_?s:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return _||(t=w[i]=w[i]||t,y[t]=e),this},overrideMimeType:function(t){return _||(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(_<2)for(e in t)v[e]=[v[e],t[e]];else b.always(t[b.status]);return this},abort:function(t){var e=t||x;return r&&r.abort(e),n(0,e),this}};if(g.promise(b).complete=m.add,b.success=b.done,b.error=b.fail,d.url=((e||d.url||ge.href)+"").replace(ye,"").replace(Se,ge.protocol+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=ot.trim(d.dataType||"*").toLowerCase().match(_t)||[""],null==d.crossDomain){h=X.createElement("a");try{h.href=d.url,h.href=h.href,d.crossDomain=Ee.protocol+"//"+Ee.host!=h.protocol+"//"+h.host}catch(t){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=ot.param(d.data,d.traditional)),j(Te,d,i,b),2===_)return b;u=ot.event&&d.global,u&&0==ot.active++&&ot.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!be.test(d.type),o=d.url,d.hasContent||(d.data&&(o=d.url+=(ve.test(o)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=we.test(o)?o.replace(we,"$1_="+me++):o+(ve.test(o)?"&":"?")+"_="+me++)),d.ifModified&&(ot.lastModified[o]&&b.setRequestHeader("If-Modified-Since",ot.lastModified[o]),ot.etag[o]&&b.setRequestHeader("If-None-Match",ot.etag[o])),(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&b.setRequestHeader("Content-Type",d.contentType),b.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Pe+"; q=0.01":""):d.accepts["*"]);for(c in d.headers)b.setRequestHeader(c,d.headers[c]);if(d.beforeSend&&(!1===d.beforeSend.call(f,b,d)||2===_))return b.abort();x="abort";for(c in{success:1,error:1,complete:1})b[c](d[c]);if(r=j(Ce,d,i,b)){if(b.readyState=1,u&&p.trigger("ajaxSend",[b,d]),2===_)return b;d.async&&d.timeout>0&&(l=t.setTimeout(function(){b.abort("timeout")},d.timeout));try{_=1,r.send(y,n)}catch(t){if(!(_<2))throw t;n(-1,t)}}else n(-1,"No Transport");return b},getJSON:function(t,e,i){return ot.get(t,e,i,"json")},getScript:function(t,e){return ot.get(t,undefined,e,"script")}}),ot.each(["get","post"],function(t,e){ot[e]=function(t,i,n,r){return ot.isFunction(i)&&(r=r||n,n=i,i=undefined),ot.ajax(ot.extend({url:t,type:e,dataType:r,data:i,success:n},ot.isPlainObject(t)&&t))}}),ot._evalUrl=function(t){return ot.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},ot.fn.extend({wrapAll:function(t){var e;return ot.isFunction(t)?this.each(function(e){ot(this).wrapAll(t.call(this,e))}):(this[0]&&(e=ot(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return ot.isFunction(t)?this.each(function(e){ot(this).wrapInner(t.call(this,e))}):this.each(function(){var e=ot(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=ot.isFunction(t);return this.each(function(i){ot(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){ot.nodeName(this,"body")||ot(this).replaceWith(this.childNodes)}).end()}}),ot.expr.filters.hidden=function(t){return!ot.expr.filters.visible(t)},ot.expr.filters.visible=function(t){return t.offsetWidth>0||t.offsetHeight>0||t.getClientRects().length>0};var ke=/%20/g,Oe=/\[\]$/,Me=/\r?\n/g,Re=/^(?:submit|button|image|reset|file)$/i,Ie=/^(?:input|select|textarea|keygen)/i;ot.param=function(t,e){var i,n=[],r=function(t,e){e=ot.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(e===undefined&&(e=ot.ajaxSettings&&ot.ajaxSettings.traditional),ot.isArray(t)||t.jquery&&!ot.isPlainObject(t))ot.each(t,function(){r(this.name,this.value)});else for(i in t)U(i,t[i],e,r);return n.join("&").replace(ke,"+")},ot.fn.extend({serialize:function(){return ot.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=ot.prop(this,"elements");return t?ot.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!ot(this).is(":disabled")&&Ie.test(this.nodeName)&&!Re.test(t)&&(this.checked||!It.test(t))}).map(function(t,e){var i=ot(this).val();return null==i?null:ot.isArray(i)?ot.map(i,function(t){return{name:e.name,value:t.replace(Me,"\r\n")}}):{name:e.name,value:i.replace(Me,"\r\n")}}).get()}}),ot.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var Le={0:200,1223:204},Ne=ot.ajaxSettings.xhr();nt.cors=!!Ne&&"withCredentials"in Ne,nt.ajax=Ne=!!Ne,ot.ajaxTransport(function(e){var i,n;if(nt.cors||Ne&&!e.crossDomain)return{send:function(r,o){var s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(s in e.xhrFields)a[s]=e.xhrFields[s];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");for(s in r)a.setRequestHeader(s,r[s]);i=function(t){return function(){i&&(i=n=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(Le[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),n=a.onerror=i("error"),a.onabort!==undefined?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout(function(){i&&n()})},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}}),ot.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return ot.globalEval(t),t}}}),ot.ajaxPrefilter("script",function(t){t.cache===undefined&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),ot.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(n,r){e=ot("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&r("error"===t.type?404:200,t.type)}),X.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Ae=[],De=/(=)\?(?=&|$)|\?\?/;ot.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ae.pop()||ot.expando+"_"+me++;return this[t]=!0,t}}),ot.ajaxPrefilter("json jsonp",function(e,i,n){var r,o,s,a=!1!==e.jsonp&&(De.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&De.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=ot.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(De,"$1"+r):!1!==e.jsonp&&(e.url+=(ve.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||ot.error(r+" was not called"),s[0]},e.dataTypes[0]="json",o=t[r],t[r]=function(){s=arguments},n.always(function(){o===undefined?ot(t).removeProp(r):t[r]=o,e[r]&&(e.jsonpCallback=i.jsonpCallback,Ae.push(r)),s&&ot.isFunction(o)&&o(s[0]),s=o=undefined}),"script"}),ot.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||X;var n=pt.exec(t),r=!i&&[];return n?[e.createElement(n[1])]:(n=d([t],e,r),r&&r.length&&ot(r).remove(),ot.merge([],n.childNodes))};var ze=ot.fn.load;ot.fn.load=function(t,e,i){if("string"!=typeof t&&ze)return ze.apply(this,arguments);var n,r,o,s=this,a=t.indexOf(" ");return a>-1&&(n=ot.trim(t.slice(a)),t=t.slice(0,a)),ot.isFunction(e)?(i=e,e=undefined):e&&"object"==typeof e&&(r="POST"),s.length>0&&ot.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done(function(t){o=arguments,s.html(n?ot("<div>").append(ot.parseHTML(t)).find(n):t)}).always(i&&function(t,e){s.each(function(){i.apply(this,o||[t.responseText,e,t])})}),this},ot.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){ot.fn[e]=function(t){return this.on(e,t)}}),ot.expr.filters.animated=function(t){return ot.grep(ot.timers,function(e){return t===e.elem}).length},ot.offset={setOffset:function(t,e,i){var n,r,o,s,a,l,h,u=ot.css(t,"position"),c=ot(t),d={};"static"===u&&(t.style.position="relative"),a=c.offset(),o=ot.css(t,"top"),l=ot.css(t,"left"),h=("absolute"===u||"fixed"===u)&&(o+l).indexOf("auto")>-1,h?(n=c.position(),s=n.top,r=n.left):(s=parseFloat(o)||0,r=parseFloat(l)||0),ot.isFunction(e)&&(e=e.call(t,i,ot.extend({},a))),null!=e.top&&(d.top=e.top-a.top+s),null!=e.left&&(d.left=e.left-a.left+r),"using"in e?e.using.call(t,d):c.css(d)}},ot.fn.extend({offset:function(t){if(arguments.length)return t===undefined?this:this.each(function(e){ot.offset.setOffset(this,t,e)});var e,i,n=this[0],r={top:0,left:0},o=n&&n.ownerDocument;if(o)return e=o.documentElement,ot.contains(e,n)?(r=n.getBoundingClientRect(),i=G(o),{top:r.top+i.pageYOffset-e.clientTop,left:r.left+i.pageXOffset-e.clientLeft}):r},position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===ot.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),ot.nodeName(t[0],"html")||(n=t.offset()),n.top+=ot.css(t[0],"borderTopWidth",!0),n.left+=ot.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-ot.css(i,"marginTop",!0),left:e.left-n.left-ot.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===ot.css(t,"position");)t=t.offsetParent;return t||Kt})}}),ot.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;ot.fn[t]=function(n){return bt(this,function(t,n,r){var o=G(t);if(r===undefined)return o?o[e]:t[n];o?o.scrollTo(i?o.pageXOffset:r,i?r:o.pageYOffset):t[n]=r},t,n,arguments.length)}}),ot.each(["top","left"],function(t,e){ot.cssHooks[e]=E(nt.pixelPosition,function(t,i){if(i)return i=P(t,e),Zt.test(i)?ot(t).position()[e]+"px":i})}),ot.each({Height:"height",Width:"width"},function(t,e){ot.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){ot.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),s=i||(!0===n||!0===r?"margin":"border");return bt(this,function(e,i,n){var r;return ot.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):n===undefined?ot.css(e,i,s):ot.style(e,i,n,s)},e,o?n:undefined,o,null)}})}),ot.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},size:function(){return this.length}}),ot.fn.andSelf=ot.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ot});var He=t.jQuery,Be=t.$;return ot.noConflict=function(e){return t.$===ot&&(t.$=Be),e&&t.jQuery===ot&&(t.jQuery=He),ot},e||(t.jQuery=t.$=ot),ot}),function(t,e){"use strict";t.rails!==e&&t.error("jquery-ujs has already been loaded!");var i,n=t(document);t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not([form]):not(form button), button[data-confirm]:not([form]):not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]), textarea[name][required]:not([disabled])",fileInputSelector:"input[name][type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return t("meta[name=csrf-token]").attr("content")},csrfParam:function(){return t("meta[name=csrf-param]").attr("content")},CSRFProtection:function(t){var e=i.csrfToken();e&&t.setRequestHeader("X-CSRF-Token",e)},refreshCSRFTokens:function(){t('form input[name="'+i.csrfParam()+'"]').val(i.csrfToken())},fire:function(e,i,n){var r=t.Event(i);return e.trigger(r,n),!1!==r.result},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t[0].href},isRemote:function(t){return t.data("remote")!==e&&!1!==t.data("remote")},handleRemote:function(n){var r,o,s,a,l,h;if(i.fire(n,"ajax:before")){if(a=n.data("with-credentials")||null,l=n.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,n.is("form")){r=n.data("ujs:submit-button-formmethod")||n.attr("method"),o=n.data("ujs:submit-button-formaction")||n.attr("action"),s=t(n[0]).serializeArray();var u=n.data("ujs:submit-button");u&&(s.push(u),n.data("ujs:submit-button",null)),n.data("ujs:submit-button-formmethod",null),n.data("ujs:submit-button-formaction",null)}else n.is(i.inputChangeSelector)?(r=n.data("method"),o=n.data("url"),s=n.serialize(),n.data("params")&&(s=s+"&"+n.data("params"))):n.is(i.buttonClickSelector)?(r=n.data("method")||"get",o=n.data("url"),s=n.serialize(),n.data("params")&&(s=s+"&"+n.data("params"))):(r=n.data("method"),o=i.href(n),s=n.data("params")||null);return h={type:r||"GET",data:s,dataType:l,beforeSend:function(t,r){if(r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),!i.fire(n,"ajax:beforeSend",[t,r]))return!1;n.trigger("ajax:send",t)},success:function(t,e,i){n.trigger("ajax:success",[t,e,i])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,i){n.trigger("ajax:error",[t,e,i])},crossDomain:i.isCrossDomain(o)},a&&(h.xhrFields={withCredentials:a}),o&&(h.url=o),i.ajax(h)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var i=document.createElement("a");try{return i.href=t,i.href=i.href,!((!i.protocol||":"===i.protocol)&&!i.host||e.protocol+"//"+e.host==i.protocol+"//"+i.host)}catch(t){return!0}},handleMethod:function(n){var r=i.href(n),o=n.data("method"),s=n.attr("target"),a=i.csrfToken(),l=i.csrfParam(),h=t('<form method="post" action="'+r+'"></form>'),u='<input name="_method" value="'+o+'" type="hidden" />';l===e||a===e||i.isCrossDomain(r)||(u+='<input name="'+l+'" value="'+a+'" type="hidden" />'),s&&h.attr("target",s),h.hide().append(u).appendTo("body"),h.submit()},formElements:function(e,i){return e.is("form")?t(e[0].elements).filter(i):e.find(i)},disableFormElements:function(e){i.formElements(e,i.disableSelector).each(function(){i.disableFormElement(t(this))})},disableFormElement:function(t){var i,n;i=t.is("button")?"html":"val",n=t.data("disable-with"),n!==e&&(t.data("ujs:enable-with",t[i]()),t[i](n)),t.prop("disabled",!0),t.data("ujs:disabled",!0)},enableFormElements:function(e){i.formElements(e,i.enableSelector).each(function(){i.enableFormElement(t(this))})},enableFormElement:function(t){var i=t.is("button")?"html":"val";t.data("ujs:enable-with")!==e&&(t[i](t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.prop("disabled",!1),t.removeData("ujs:disabled")},allowAction:function(t){var e,n=t.data("confirm"),r=!1;if(!n)return!0;if(i.fire(t,"confirm")){try{r=i.confirm(n)}catch(t){(console.error||console.log).call(console,t.stack||t)}e=i.fire(t,"confirm:complete",[r])}return r&&e},blankInputs:function(e,i,n){var r,o,s,a,l=t(),h=i||"input,textarea",u=e.find(h),c={};return u.each(function(){r=t(this),r.is("input[type=radio]")?(a=r.attr("name"),c[a]||(0===e.find('input[type=radio]:checked[name="'+a+'"]').length&&(s=e.find('input[type=radio][name="'+a+'"]'),l=l.add(s)),c[a]=a)):(o=r.is("input[type=checkbox],input[type=radio]")?r.is(":checked"):!!r.val())===n&&(l=l.add(r))}),!!l.length&&l},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var n=t.data("disable-with");n!==e&&(t.data("ujs:enable-with",t.html()),t.html(n)),t.bind("click.railsDisable",function(t){return i.stopEverything(t)}),t.data("ujs:disabled",!0)},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable"),t.removeData("ujs:disabled")}},i.fire(n,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,n){t.crossDomain||i.CSRFProtection(n)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:disabled")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:disabled")&&t.rails.enableElement(e)})}),n.on("ajax:complete",i.linkDisableSelector,function(){i.enableElement(t(this))}),n.on("ajax:complete",i.buttonDisableSelector,function(){i.enableFormElement(t(this))}),n.on("click.rails",i.linkClickSelector,function(e){var n=t(this),r=n.data("method"),o=n.data("params"),s=e.metaKey||e.ctrlKey;if(!i.allowAction(n))return i.stopEverything(e);if(!s&&n.is(i.linkDisableSelector)&&i.disableElement(n),i.isRemote(n)){if(s&&(!r||"GET"===r)&&!o)return!0;var a=i.handleRemote(n);return!1===a?i.enableElement(n):a.fail(function(){i.enableElement(n)}),!1}return r?(i.handleMethod(n),!1):void 0}),n.on("click.rails",i.buttonClickSelector,function(e){var n=t(this);if(!i.allowAction(n)||!i.isRemote(n))return i.stopEverything(e);n.is(i.buttonDisableSelector)&&i.disableFormElement(n);var r=i.handleRemote(n);return!1===r?i.enableFormElement(n):r.fail(function(){i.enableFormElement(n)}),!1}),n.on("change.rails",i.inputChangeSelector,function(e){var n=t(this);return i.allowAction(n)&&i.isRemote(n)?(i.handleRemote(n),!1):i.stopEverything(e)}),n.on("submit.rails",i.formSubmitSelector,function(n){var r,o,s=t(this),a=i.isRemote(s);if(!i.allowAction(s))return i.stopEverything(n);if(s.attr("novalidate")===e)if(s.data("ujs:formnovalidate-button")===e){if((r=i.blankInputs(s,i.requiredInputSelector,!1))&&i.fire(s,"ajax:aborted:required",[r]))return i.stopEverything(n)}else s.data("ujs:formnovalidate-button",e);if(a){if(o=i.nonBlankInputs(s,i.fileInputSelector)){setTimeout(function(){i.disableFormElements(s)},13);var l=i.fire(s,"ajax:aborted:file",[o]);return l||setTimeout(function(){i.enableFormElements(s)},13),l}return i.handleRemote(s),!1}setTimeout(function(){i.disableFormElements(s)},13)}),n.on("click.rails",i.formInputClickSelector,function(e){var n=t(this);if(!i.allowAction(n))return i.stopEverything(e);var r=n.attr("name"),o=r?{name:r,value:n.val()}:null,s=n.closest("form");0===s.length&&(s=t("#"+n.attr("form"))),s.data("ujs:submit-button",o),s.data("ujs:formnovalidate-button",n.attr("formnovalidate")),s.data("ujs:submit-button-formaction",n.attr("formaction")),s.data("ujs:submit-button-formmethod",n.attr("formmethod"))}),n.on("ajax:send.rails",i.formSubmitSelector,function(e){this===e.target&&i.disableFormElements(t(this))}),n.on("ajax:complete.rails",i.formSubmitSelector,function(e){this===e.target&&i.enableFormElements(t(this))}),t(function(){i.refreshCSRFTokens()}))}(jQuery),function(){function t(t){function e(e,i,n,r,o,s){for(;o>=0&&o<s;o+=t){var a=r?r[o]:o;n=i(n,e[a],a,e)}return n}return function(i,n,r,o){n=w(n,o,4);var s=!P(i)&&y.keys(i),a=(s||i).length,l=t>0?0:a-1;return arguments.length<3&&(r=i[s?s[l]:l],l+=t),e(i,n,r,s,l,a)}}function e(t){return function(e,i,n){i=_(i,n);for(var r=C(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(i(e[o],o,e))return o;return-1}}function i(t,e,i){return function(n,r,o){var s=0,a=C(n);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(i&&o&&a)return o=i(n,r),n[o]===r?o:-1;if(r!==r)return o=e(u.call(n,s,a),y.isNaN),o>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(n[o]===r)return o;return-1}}function n(t,e){var i=R.length,n=t.constructor,r=y.isFunction(n)&&n.prototype||a,o="constructor";for(y.has(t,o)&&!y.contains(e,o)&&e.push(o);i--;)(o=R[i])in t&&t[o]!==r[o]&&!y.contains(e,o)&&e.push(o)}var r=this,o=r._,s=Array.prototype,a=Object.prototype,l=Function.prototype,h=s.push,u=s.slice,c=a.toString,d=a.hasOwnProperty,f=Array.isArray,p=Object.keys,g=l.bind,m=Object.create,v=function(){},y=function(t){return t instanceof y?t:this instanceof y?void(this._wrapped=t):new y(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):r._=y,y.VERSION="1.8.3";var w=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,o){return t.call(e,i,n,r,o)}}return function(){return t.apply(e,arguments)}},_=function(t,e,i){return null==t?y.identity:y.isFunction(t)?w(t,e,i):y.isObject(t)?y.matcher(t):y.property(t)};y.iteratee=function(t,e){return _(t,e,Infinity)};var x=function(t,e){return function(i){var n=arguments.length;if(n<2||null==i)return i;for(var r=1;r<n;r++)for(var o=arguments[r],s=t(o),a=s.length,l=0;l<a;l++){var h=s[l];e&&void 0!==i[h]||(i[h]=o[h])}return i}},b=function(t){if(!y.isObject(t))return{};if(m)return m(t);v.prototype=t;var e=new v;return v.prototype=null,e},S=function(t){return function(e){return null==e?void 0:e[t]}},T=Math.pow(2,53)-1,C=S("length"),P=function(t){var e=C(t);return"number"==typeof e&&e>=0&&e<=T};y.each=y.forEach=function(t,e,i){e=w(e,i);var n,r;if(P(t))for(n=0,r=t.length;n<r;n++)e(t[n],n,t);else{var o=y.keys(t);for(n=0,r=o.length;n<r;n++)e(t[o[n]],o[n],t)}return t},y.map=y.collect=function(t,e,i){e=_(e,i);for(var n=!P(t)&&y.keys(t),r=(n||t).length,o=Array(r),s=0;s<r;s++){var a=n?n[s]:s;o[s]=e(t[a],a,t)}return o},y.reduce=y.foldl=y.inject=t(1),y.reduceRight=y.foldr=t(-1),y.find=y.detect=function(t,e,i){var n;if(void 0!==(n=P(t)?y.findIndex(t,e,i):y.findKey(t,e,i))&&-1!==n)return t[n]},y.filter=y.select=function(t,e,i){var n=[];return e=_(e,i),y.each(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n},y.reject=function(t,e,i){return y.filter(t,y.negate(_(e)),i)},y.every=y.all=function(t,e,i){e=_(e,i);for(var n=!P(t)&&y.keys(t),r=(n||t).length,o=0;o<r;o++){var s=n?n[o]:o;if(!e(t[s],s,t))return!1}return!0},y.some=y.any=function(t,e,i){e=_(e,i);for(var n=!P(t)&&y.keys(t),r=(n||t).length,o=0;o<r;o++){var s=n?n[o]:o;if(e(t[s],s,t))return!0}return!1},y.contains=y.includes=y.include=function(t,e,i,n){return P(t)||(t=y.values(t)),
("number"!=typeof i||n)&&(i=0),y.indexOf(t,e,i)>=0},y.invoke=function(t,e){var i=u.call(arguments,2),n=y.isFunction(e);return y.map(t,function(t){var r=n?e:t[e];return null==r?r:r.apply(t,i)})},y.pluck=function(t,e){return y.map(t,y.property(e))},y.where=function(t,e){return y.filter(t,y.matcher(e))},y.findWhere=function(t,e){return y.find(t,y.matcher(e))},y.max=function(t,e,i){var n,r,o=-Infinity,s=-Infinity;if(null==e&&null!=t){t=P(t)?t:y.values(t);for(var a=0,l=t.length;a<l;a++)(n=t[a])>o&&(o=n)}else e=_(e,i),y.each(t,function(t,i,n){((r=e(t,i,n))>s||r===-Infinity&&o===-Infinity)&&(o=t,s=r)});return o},y.min=function(t,e,i){var n,r,o=Infinity,s=Infinity;if(null==e&&null!=t){t=P(t)?t:y.values(t);for(var a=0,l=t.length;a<l;a++)(n=t[a])<o&&(o=n)}else e=_(e,i),y.each(t,function(t,i,n){((r=e(t,i,n))<s||r===Infinity&&o===Infinity)&&(o=t,s=r)});return o},y.shuffle=function(t){for(var e,i=P(t)?t:y.values(t),n=i.length,r=Array(n),o=0;o<n;o++)e=y.random(0,o),e!==o&&(r[o]=r[e]),r[e]=i[o];return r},y.sample=function(t,e,i){return null==e||i?(P(t)||(t=y.values(t)),t[y.random(t.length-1)]):y.shuffle(t).slice(0,Math.max(0,e))},y.sortBy=function(t,e,i){return e=_(e,i),y.pluck(y.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var E=function(t){return function(e,i,n){var r={};return i=_(i,n),y.each(e,function(n,o){var s=i(n,o,e);t(r,n,s)}),r}};y.groupBy=E(function(t,e,i){y.has(t,i)?t[i].push(e):t[i]=[e]}),y.indexBy=E(function(t,e,i){t[i]=e}),y.countBy=E(function(t,e,i){y.has(t,i)?t[i]++:t[i]=1}),y.toArray=function(t){return t?y.isArray(t)?u.call(t):P(t)?y.map(t,y.identity):y.values(t):[]},y.size=function(t){return null==t?0:P(t)?t.length:y.keys(t).length},y.partition=function(t,e,i){e=_(e,i);var n=[],r=[];return y.each(t,function(t,i,o){(e(t,i,o)?n:r).push(t)}),[n,r]},y.first=y.head=y.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:y.initial(t,t.length-e)},y.initial=function(t,e,i){return u.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},y.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:y.rest(t,Math.max(0,t.length-e))},y.rest=y.tail=y.drop=function(t,e,i){return u.call(t,null==e||i?1:e)},y.compact=function(t){return y.filter(t,y.identity)};var k=function(t,e,i,n){for(var r=[],o=0,s=n||0,a=C(t);s<a;s++){var l=t[s];if(P(l)&&(y.isArray(l)||y.isArguments(l))){e||(l=k(l,e,i));var h=0,u=l.length;for(r.length+=u;h<u;)r[o++]=l[h++]}else i||(r[o++]=l)}return r};y.flatten=function(t,e){return k(t,e,!1)},y.without=function(t){return y.difference(t,u.call(arguments,1))},y.uniq=y.unique=function(t,e,i,n){y.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=_(i,n));for(var r=[],o=[],s=0,a=C(t);s<a;s++){var l=t[s],h=i?i(l,s,t):l;e?(s&&o===h||r.push(l),o=h):i?y.contains(o,h)||(o.push(h),r.push(l)):y.contains(r,l)||r.push(l)}return r},y.union=function(){return y.uniq(k(arguments,!0,!0))},y.intersection=function(t){for(var e=[],i=arguments.length,n=0,r=C(t);n<r;n++){var o=t[n];if(!y.contains(e,o)){for(var s=1;s<i&&y.contains(arguments[s],o);s++);s===i&&e.push(o)}}return e},y.difference=function(t){var e=k(arguments,!0,!0,1);return y.filter(t,function(t){return!y.contains(e,t)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(t){for(var e=t&&y.max(t,C).length||0,i=Array(e),n=0;n<e;n++)i[n]=y.pluck(t,n);return i},y.object=function(t,e){for(var i={},n=0,r=C(t);n<r;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},y.findIndex=e(1),y.findLastIndex=e(-1),y.sortedIndex=function(t,e,i,n){i=_(i,n,1);for(var r=i(e),o=0,s=C(t);o<s;){var a=Math.floor((o+s)/2);i(t[a])<r?o=a+1:s=a}return o},y.indexOf=i(1,y.findIndex,y.sortedIndex),y.lastIndexOf=i(-1,y.findLastIndex),y.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),o=0;o<n;o++,t+=i)r[o]=t;return r};var O=function(t,e,i,n,r){if(!(n instanceof e))return t.apply(i,r);var o=b(t.prototype),s=t.apply(o,r);return y.isObject(s)?s:o};y.bind=function(t,e){if(g&&t.bind===g)return g.apply(t,u.call(arguments,1));if(!y.isFunction(t))throw new TypeError("Bind must be called on a function");var i=u.call(arguments,2),n=function(){return O(t,n,e,this,i.concat(u.call(arguments)))};return n},y.partial=function(t){var e=u.call(arguments,1),i=function(){for(var n=0,r=e.length,o=Array(r),s=0;s<r;s++)o[s]=e[s]===y?arguments[n++]:e[s];for(;n<arguments.length;)o.push(arguments[n++]);return O(t,i,this,this,o)};return i},y.bindAll=function(t){var e,i,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(e=1;e<n;e++)i=arguments[e],t[i]=y.bind(t[i],t);return t},y.memoize=function(t,e){var i=function(n){var r=i.cache,o=""+(e?e.apply(this,arguments):n);return y.has(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return i.cache={},i},y.delay=function(t,e){var i=u.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},y.defer=y.partial(y.delay,y,1),y.throttle=function(t,e,i){var n,r,o,s=null,a=0;i||(i={});var l=function(){a=!1===i.leading?0:y.now(),s=null,o=t.apply(n,r),s||(n=r=null)};return function(){var h=y.now();a||!1!==i.leading||(a=h);var u=e-(h-a);return n=this,r=arguments,u<=0||u>e?(s&&(clearTimeout(s),s=null),a=h,o=t.apply(n,r),s||(n=r=null)):s||!1===i.trailing||(s=setTimeout(l,u)),o}},y.debounce=function(t,e,i){var n,r,o,s,a,l=function(){var h=y.now()-s;h<e&&h>=0?n=setTimeout(l,e-h):(n=null,i||(a=t.apply(o,r),n||(o=r=null)))};return function(){o=this,r=arguments,s=y.now();var h=i&&!n;return n||(n=setTimeout(l,e)),h&&(a=t.apply(o,r),o=r=null),a}},y.wrap=function(t,e){return y.partial(e,t)},y.negate=function(t){return function(){return!t.apply(this,arguments)}},y.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},y.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},y.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},y.once=y.partial(y.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),R=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(t){if(!y.isObject(t))return[];if(p)return p(t);var e=[];for(var i in t)y.has(t,i)&&e.push(i);return M&&n(t,e),e},y.allKeys=function(t){if(!y.isObject(t))return[];var e=[];for(var i in t)e.push(i);return M&&n(t,e),e},y.values=function(t){for(var e=y.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n},y.mapObject=function(t,e,i){e=_(e,i);for(var n,r=y.keys(t),o=r.length,s={},a=0;a<o;a++)n=r[a],s[n]=e(t[n],n,t);return s},y.pairs=function(t){for(var e=y.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=[e[r],t[e[r]]];return n},y.invert=function(t){for(var e={},i=y.keys(t),n=0,r=i.length;n<r;n++)e[t[i[n]]]=i[n];return e},y.functions=y.methods=function(t){var e=[];for(var i in t)y.isFunction(t[i])&&e.push(i);return e.sort()},y.extend=x(y.allKeys),y.extendOwn=y.assign=x(y.keys),y.findKey=function(t,e,i){e=_(e,i);for(var n,r=y.keys(t),o=0,s=r.length;o<s;o++)if(n=r[o],e(t[n],n,t))return n},y.pick=function(t,e,i){var n,r,o={},s=t;if(null==s)return o;y.isFunction(e)?(r=y.allKeys(s),n=w(e,i)):(r=k(arguments,!1,!1,1),n=function(t,e,i){return e in i},s=Object(s));for(var a=0,l=r.length;a<l;a++){var h=r[a],u=s[h];n(u,h,s)&&(o[h]=u)}return o},y.omit=function(t,e,i){if(y.isFunction(e))e=y.negate(e);else{var n=y.map(k(arguments,!1,!1,1),String);e=function(t,e){return!y.contains(n,e)}}return y.pick(t,e,i)},y.defaults=x(y.allKeys,!0),y.create=function(t,e){var i=b(t);return e&&y.extendOwn(i,e),i},y.clone=function(t){return y.isObject(t)?y.isArray(t)?t.slice():y.extend({},t):t},y.tap=function(t,e){return e(t),t},y.isMatch=function(t,e){var i=y.keys(e),n=i.length;if(null==t)return!n;for(var r=Object(t),o=0;o<n;o++){var s=i[o];if(e[s]!==r[s]||!(s in r))return!1}return!0};var I=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof y&&(t=t._wrapped),e instanceof y&&(e=e._wrapped);var r=c.call(t);if(r!==c.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var o="[object Array]"===r;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(y.isFunction(s)&&s instanceof s&&y.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===t)return n[l]===e;if(i.push(t),n.push(e),o){if((l=t.length)!==e.length)return!1;for(;l--;)if(!I(t[l],e[l],i,n))return!1}else{var h,u=y.keys(t);if(l=u.length,y.keys(e).length!==l)return!1;for(;l--;)if(h=u[l],!y.has(e,h)||!I(t[h],e[h],i,n))return!1}return i.pop(),n.pop(),!0};y.isEqual=function(t,e){return I(t,e)},y.isEmpty=function(t){return null==t||(P(t)&&(y.isArray(t)||y.isString(t)||y.isArguments(t))?0===t.length:0===y.keys(t).length)},y.isElement=function(t){return!(!t||1!==t.nodeType)},y.isArray=f||function(t){return"[object Array]"===c.call(t)},y.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){y["is"+t]=function(e){return c.call(e)==="[object "+t+"]"}}),y.isArguments(arguments)||(y.isArguments=function(t){return y.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(y.isFunction=function(t){return"function"==typeof t||!1}),y.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},y.isNaN=function(t){return y.isNumber(t)&&t!==+t},y.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===c.call(t)},y.isNull=function(t){return null===t},y.isUndefined=function(t){return void 0===t},y.has=function(t,e){return null!=t&&d.call(t,e)},y.noConflict=function(){return r._=o,this},y.identity=function(t){return t},y.constant=function(t){return function(){return t}},y.noop=function(){},y.property=S,y.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},y.matcher=y.matches=function(t){return t=y.extendOwn({},t),function(e){return y.isMatch(e,t)}},y.times=function(t,e,i){var n=Array(Math.max(0,t));e=w(e,i,1);for(var r=0;r<t;r++)n[r]=e(r);return n},y.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},y.now=Date.now||function(){return(new Date).getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=y.invert(L),A=function(t){var e=function(e){return t[e]},i="(?:"+y.keys(t).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,e):t}};y.escape=A(L),y.unescape=A(N),y.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),y.isFunction(n)?n.call(t):n};var D=0;y.uniqueId=function(t){var e=++D+"";return t?t+e:e},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,F=function(t){return"\\"+H[t]};y.template=function(t,e,i){!e&&i&&(e=i),e=y.defaults({},e,y.templateSettings);var n=RegExp([(e.escape||z).source,(e.interpolate||z).source,(e.evaluate||z).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(n,function(e,i,n,s,a){return o+=t.slice(r,a).replace(B,F),r=a+e.length,i?o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}var a=function(t){return s.call(this,t,y)},l=e.variable||"obj";return a.source="function("+l+"){\n"+o+"}",a},y.chain=function(t){var e=y(t);return e._chain=!0,e};var $=function(t,e){return t._chain?y(e).chain():e};y.mixin=function(t){y.each(y.functions(t),function(e){var i=y[e]=t[e];y.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),$(this,i.apply(y,t))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];y.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],$(this,i)}}),y.each(["concat","join","slice"],function(t){var e=s[t];y.prototype[t]=function(){return $(this,e.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return y})}.call(this),function(t){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,n,r){e.Backbone=t(e,r,i,n)});else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(t){}t(e,exports,n,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(t,e,i,n){var r=t.Backbone,o=[],s=o.slice;e.VERSION="1.2.0",e.$=n,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={},l=/\s+/,h=function(t,e,n,r,o){var s,a=0;if(n&&"object"==typeof n)for(s=i.keys(n);a<s.length;a++)e=t(e,s[a],n[s[a]],o);else if(n&&l.test(n))for(s=n.split(l);a<s.length;a++)e=t(e,s[a],r,o);else e=t(e,n,r,o);return e};a.on=function(t,e,i){return u(this,t,e,i)};var u=function(t,e,i,n,r){if(t._events=h(c,t._events||{},e,i,{context:n,ctx:t,listening:r}),r){(t._listeners||(t._listeners={}))[r.id]=r}return t};a.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=i.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),s=o[r];if(!s){var a=this._listenId||(this._listenId=i.uniqueId("l"));s=o[r]={obj:t,objId:r,id:a,listeningTo:o,count:0}}return u(t,e,n,this,s),this};var c=function(t,e,i,n){if(i){var r=t[e]||(t[e]=[]),o=n.context,s=n.ctx,a=n.listening;a&&a.count++,r.push({callback:i,context:o,ctx:o||s,listening:a})}return t};a.off=function(t,e,i){return this._events?(this._events=h(d,this._events,t,e,{context:i,listeners:this._listeners}),this):this},a.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var o=t?[t._listenId]:i.keys(r),s=0;s<o.length;s++){var a=r[o[s]];if(!a)break;a.obj.off(e,n,this)}return i.isEmpty(r)&&(this._listeningTo=void 0),this};var d=function(t,e,n,r){if(t){var o,s=0,a=r.context,l=r.listeners;if(e||n||a){for(var h=e?[e]:i.keys(t);s<h.length;s++){e=h[s];var u=t[e];if(!u)break;for(var c=[],d=0;d<u.length;d++){var f=u[d];n&&n!==f.callback&&n!==f.callback._callback||a&&a!==f.context?c.push(f):(o=f.listening)&&0==--o.count&&(delete l[o.id],delete o.listeningTo[o.objId])}c.length?t[e]=c:delete t[e]}return i.size(t)?t:void 0}for(var p=i.keys(l);s<p.length;s++)o=l[p[s]],delete l[o.id],delete o.listeningTo[o.objId]}};a.once=function(t,e,n){var r=h(f,{},t,e,i.bind(this.off,this));return this.on(r,void 0,n)},a.listenToOnce=function(t,e,n){var r=h(f,{},e,n,i.bind(this.stopListening,this,t));return this.listenTo(t,r)};var f=function(t,e,n,r){if(n){var o=t[e]=i.once(function(){r(e,o),n.apply(this,arguments)});o._callback=n}return t};a.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return h(p,this._events,t,void 0,i),this};var p=function(t,e,i,n){if(t){var r=t[e],o=t.all;r&&o&&(o=o.slice()),r&&g(r,n),o&&g(o,[e].concat(n))}return t},g=function(t,e){var i,n=-1,r=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}},m=function(t,e,n){switch(t){case 1:return function(){return i[e](this[n])};case 2:return function(t){return i[e](this[n],t)};case 3:return function(t,r){return i[e](this[n],t,r)};case 4:return function(t,r,o){return i[e](this[n],t,r,o)};default:return function(){var t=s.call(arguments);return t.unshift(this[n]),i[e].apply(i,t)}}},v=function(t,e,n){i.each(e,function(e,r){i[r]&&(t.prototype[r]=m(e,r,n))})};a.bind=a.on,a.unbind=a.off,i.extend(e,a);var y=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(y.prototype,a,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,n){var r,o,s,a,l,h,u,c;if(null==t)return this;if("object"==typeof t?(o=t,n=e):(o={})[t]=e,n||(n={}),!this._validate(o,n))return!1;s=n.unset,l=n.silent,a=[],h=this._changing,this._changing=!0,h||(this._previousAttributes=i.clone(this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(r in o)e=o[r],i.isEqual(c[r],e)||a.push(r),i.isEqual(u[r],e)?delete this.changed[r]:this.changed[r]=e,s?delete c[r]:c[r]=e;if(!l){a.length&&(this._pending=n);for(var d=0;d<a.length;d++)this.trigger("change:"+a[d],this,c[a[d]],n)}if(h)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var o in t)i.isEqual(r[o],e=t[o])||((n||(n={}))[o]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){if(!e.set(e.parse(i,t),t))return!1;n&&n.call(t.context,e,i,t),e.trigger("sync",e,i,t)},H(this,t),this.sync("read",this,t)},save:function(t,e,n){var r,o,s,a,l=this.attributes;if(null==t||"object"==typeof t?(r=t,n=e):(r={})[t]=e,n=i.extend({validate:!0},n),a=n.wait,r&&!a){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&a&&(this.attributes=i.extend({},l,r)),void 0===n.parse&&(n.parse=!0);var h=this,u=n.success;return n.success=function(t){h.attributes=l;var e=n.parse?h.parse(t,n):t;if(a&&(e=i.extend(r||{},e)),i.isObject(e)&&!h.set(e,n))return!1;u&&u.call(n.context,h,t,n),h.trigger("sync",h,t,n)},H(this,n),o=this.isNew()?"create":n.patch?"patch":"update","patch"!==o||n.attrs||(n.attrs=r),s=this.sync(o,this,n),r&&a&&(this.attributes=l),s},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,r=t.wait,o=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){r&&o(),n&&n.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var s=!1;return this.isNew()?i.defer(t.success):(H(this,t),s=this.sync("delete",this,t)),r||o(),s},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||z();if(this.isNew())return t;var e=this.id||this.attributes[this.idAttribute];return t.replace(/([^\/])$/,"$1/")+encodeURIComponent(e)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1)}}),v(y,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var w=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},_={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1};i.extend(w.prototype,a,{model:y,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,x))},remove:function(t,e){var n,r=!i.isArray(t);return t=r?[t]:i.clone(t),e||(e={}),n=this._removeModels(t,e),!e.silent&&n&&this.trigger("update",this,e),r?t[0]:t},set:function(t,e){e=i.defaults({},e,_),e.parse&&(t=this.parse(t,e));var n=!i.isArray(t);t=n?t?[t]:[]:t.slice();var r,o,s,a,l,h=e.at;null!=h&&(h=+h),h<0&&(h+=this.length+1);for(var u=this.comparator&&null==h&&!1!==e.sort,c=i.isString(this.comparator)?this.comparator:null,d=[],f=[],p={},g=e.add,m=e.merge,v=e.remove,y=!(u||!g||!v)&&[],w=!1,x=0;x<t.length;x++){if(s=t[x],a=this.get(s))v&&(p[a.cid]=!0),m&&s!==a&&(s=this._isModel(s)?s.attributes:s,e.parse&&(s=a.parse(s,e)),a.set(s,e),u&&!l&&a.hasChanged(c)&&(l=!0)),t[x]=a;else if(g){if(!(o=t[x]=this._prepareModel(s,e)))continue;d.push(o),this._addReference(o,e)}o=a||o,o&&(r=this.modelId(o.attributes),!y||!o.isNew()&&p[r]||(y.push(o),w=w||!this.models[x]||o.cid!==this.models[x].cid),p[r]=!0)}if(v){for(var x=0;x<this.length;x++)p[(o=this.models[x]).cid]||f.push(o);f.length&&this._removeModels(f,e)}if(d.length||w)if(u&&(l=!0),this.length+=d.length,null!=h)for(var x=0;x<d.length;x++)this.models.splice(h+x,0,d[x]);else{y&&(this.models.length=0);for(var b=y||d,x=0;x<b.length;x++)this.models.push(b[x])}if(l&&this.sort({silent:!0}),!e.silent){for(var S=null!=h?i.clone(e):e,x=0;x<d.length;x++)null!=h&&(S.index=h+x),(o=d[x]).trigger("add",o,this,S);(l||w)&&this.trigger("sort",this,e),(d.length||f.length)&&this.trigger("update",this,e)}return n?t[0]:t},reset:function(t,e){e=e?i.clone(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(null!=t){var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.cid]}},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){var n=i.matches(t);return this[e?"find":"filter"](function(t){return n(t.attributes)})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=t?i.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e.call(t.context,n,i,t),n.trigger("sync",n,i,t)},H(this,t),this.sync("read",this,t)},create:function(t,e){e=e?i.clone(e):{};var n=e.wait;if(!(t=this._prepareModel(t,e)))return!1;n||this.add(t,e);var r=this,o=e.success;return e.success=function(t,e,i){n&&r.add(t,i),o&&o.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var i,n,r,o=!1,i=0,s=0;i<t.length;i++){var r=t[i]=this.get(t[i]);if(r){var a=this.modelId(r.attributes);null!=a&&delete this._byId[a],delete this._byId[r.cid];var n=this.indexOf(r);this.models.splice(n,1),this.length--,e.silent||(e.index=n,r.trigger("remove",r,this,e)),t[s++]=r,this._removeReference(r,e),o=!0}}return t.length!==s&&(t=t.slice(0,s)),o},_isModel:function(t){return t instanceof y},_addReference:function(t){this._byId[t.cid]=t;var e=this.modelId(t.attributes);null!=e&&(this._byId[e]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if("add"!==t&&"remove"!==t||i===this){if("destroy"===t&&this.remove(e,n),"change"===t){var r=this.modelId(e.previousAttributes()),o=this.modelId(e.attributes);r!==o&&(null!=r&&delete this._byId[r],null!=o&&(this._byId[o]=e))}this.trigger.apply(this,arguments)}}}),v(w,{forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:2,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3},"models");var b=["groupBy","countBy","sortBy","indexBy"];i.each(b,function(t){i[t]&&(w.prototype[t]=function(e,n){var r=i.isFunction(e)?e:function(t){return t.get(e)};return i[t](this.models,r,n)})});var S=e.View=function(t){this.cid=i.uniqueId("view"),t||(t={}),i.extend(this,i.pick(t,C)),this._ensureElement(),this.initialize.apply(this,arguments)},T=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];i.extend(S.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(!t&&!(t=i.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[t[e]]),n){var r=e.match(T);this.delegate(r[1],r[2],i.bind(n,this))}}return this},delegate:function(t,e,i){this.$el.on(t+".delegateEvents"+this.cid,e,i)},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){this.$el.off(t+".delegateEvents"+this.cid,e,i)},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t["class"]=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,n,r){var o=P[t];i.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||z()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",o),a)return a.apply(this,arguments)}}"GET"===s.type||r.emulateJSON||(s.processData=!1);var l=r.error;r.error=function(t,e,i){r.textStatus=e,r.errorThrown=i,l&&l.call(r.context,t,e,i)};var h=r.xhr=e.ajax(i.extend(s,r));return n.trigger("request",n,h,r),h};var P={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var E=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,O=/(\(\?)?:\w+/g,M=/\*\w+/g,R=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(E.prototype,a,{initialize:function(){},route:function(t,n,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return e.history.route(t,function(i){var s=o._extractParameters(t,i);!1!==o.execute(r,s,n)&&(o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),e.history.trigger("route",o,n,s))}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(R,"\\$&").replace(k,"(?:$1)?").replace(O,function(t,e){return e?t:"([^/?]+)"}).replace(M,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var I=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,N=/^\/+|\/+$/g,A=/#.*$/;I.started=!1,i.extend(I.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(L,"")},start:function(t){if(I.started)throw new Error("Backbone.history has already been started");if(I.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window,this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(N,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){var n=document.createElement("iframe");n.src="javascript:0",n.style.display="none",n.tabIndex=-1;var r=document.body;this.iframe=r.insertBefore(n,r.firstChild).contentWindow,this.iframe.document.open().close(),this.iframe.location.hash="#"+this.fragment}var o=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){
var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe.frameElement),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),I.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!I.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;if(t=this.decodeFragment(t.replace(A,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe)&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new I;var D=function(t,e){var n,r=this;n=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,e);var o=function(){this.constructor=n};return o.prototype=r.prototype,n.prototype=new o,t&&i.extend(n.prototype,t),n.__super__=r.prototype,n};y.extend=w.extend=E.extend=S.extend=I.extend=D;var z=function(){throw new Error('A "url" property or function must be specified')},H=function(t,e){var i=e.error;e.error=function(n){i&&i.call(e.context,t,n,e),t.trigger("error",t,n,e)}};return e}),function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(t.style[i]!==undefined)return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("bsTransitionEnd",function(){i=!0});var r=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var i=t(this),r=i.data("bs.alert");r||i.data("bs.alert",r=new n(this)),"string"==typeof e&&r[e].call(i)})}var i='[data-dismiss="alert"]',n=function(e){t(e).on("click",i,this.close)};n.VERSION="3.3.7",n.TRANSITION_DURATION=150,n.prototype.close=function(e){function i(){s.detach().trigger("closed.bs.alert").remove()}var r=t(this),o=r.attr("data-target");o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,""));var s=t("#"===o?[]:o);e&&e.preventDefault(),s.length||(s=r.closest(".alert")),s.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i())};var r=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=r,this},t(document).on("click.bs.alert.data-api",i,n.prototype.close)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.button"),o="object"==typeof e&&e;r||n.data("bs.button",r=new i(this,o)),"toggle"==e?r.toggle():e&&r.setState(e)})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.isLoading=!1};i.VERSION="3.3.7",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",n=this.$element,r=n.is("input")?"val":"html",o=n.data();e+="Text",null==o.resetText&&n.data("resetText",n[r]()),setTimeout(t.proxy(function(){n[r](null==o[e]?this.options[e]:o[e]),"loadingText"==e?(this.isLoading=!0,n.addClass(i).attr(i,i).prop(i,!0)):this.isLoading&&(this.isLoading=!1,n.removeClass(i).removeAttr(i).prop(i,!1))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var n=t(i.target).closest(".btn");e.call(n,"toggle"),t(i.target).is('input[type="radio"], input[type="checkbox"]')||(i.preventDefault(),n.is("input,button")?n.trigger("focus"):n.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.carousel"),o=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e),s="string"==typeof e?e:o.slide;r||n.data("bs.carousel",r=new i(this,o)),"number"==typeof e?r.to(e):s?r[s]():o.interval&&r.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e);if(("prev"==t&&0===i||"next"==t&&i==this.$items.length-1)&&!this.options.wrap)return e;var n="prev"==t?-1:1,r=(i+n)%this.$items.length;return this.$items.eq(r)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){if(!this.sliding)return this.slide("next")},i.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},i.prototype.slide=function(e,n){var r=this.$element.find(".item.active"),o=n||this.getItemForDirection(e,r),s=this.interval,a="next"==e?"left":"right",l=this;if(o.hasClass("active"))return this.sliding=!1;var h=o[0],u=t.Event("slide.bs.carousel",{relatedTarget:h,direction:a});if(this.$element.trigger(u),!u.isDefaultPrevented()){if(this.sliding=!0,s&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var c=t(this.$indicators.children()[this.getItemIndex(o)]);c&&c.addClass("active")}var d=t.Event("slid.bs.carousel",{relatedTarget:h,direction:a});return t.support.transition&&this.$element.hasClass("slide")?(o.addClass(e),o[0].offsetWidth,r.addClass(a),o.addClass(a),r.one("bsTransitionEnd",function(){o.removeClass([e,a].join(" ")).addClass("active"),r.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(d)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(r.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger(d)),s&&this.cycle(),this}};var n=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this};var r=function(i){var n,r=t(this),o=t(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""));if(o.hasClass("carousel")){var s=t.extend({},o.data(),r.data()),a=r.attr("data-slide-to");a&&(s.interval=!1),e.call(o,s),a&&o.data("bs.carousel").to(a),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",r).on("click.bs.carousel.data-api","[data-slide-to]",r),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),function(t){"use strict";function e(e){var i,n=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(n)}function i(e){return this.each(function(){var i=t(this),r=i.data("bs.collapse"),o=t.extend({},n.DEFAULTS,i.data(),"object"==typeof e&&e);!r&&o.toggle&&/show|hide/.test(e)&&(o.toggle=!1),r||i.data("bs.collapse",r=new n(this,o)),"string"==typeof e&&r[e]()})}var n=function(e,i){this.$element=t(e),this.options=t.extend({},n.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};n.VERSION="3.3.7",n.TRANSITION_DURATION=350,n.DEFAULTS={toggle:!0},n.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},n.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,r=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(r&&r.length&&(e=r.data("bs.collapse"))&&e.transitioning)){var o=t.Event("show.bs.collapse");if(this.$element.trigger(o),!o.isDefaultPrevented()){r&&r.length&&(i.call(r,"hide"),e||r.data("bs.collapse",null));var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var l=t.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",t.proxy(a,this)).emulateTransitionEnd(n.TRANSITION_DURATION)[s](this.$element[0][l])}}}},n.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!t.support.transition)return r.call(this);this.$element[i](0).one("bsTransitionEnd",t.proxy(r,this)).emulateTransitionEnd(n.TRANSITION_DURATION)}}},n.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},n.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,n){var r=t(n);this.addAriaAndCollapsedClass(e(r),r)},this)).end()},n.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var r=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=n,t.fn.collapse.noConflict=function(){return t.fn.collapse=r,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(n){var r=t(this);r.attr("data-target")||n.preventDefault();var o=e(r),s=o.data("bs.collapse"),a=s?"toggle":r.data();i.call(o,a)})}(jQuery),function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}function i(i){i&&3===i.which||(t(r).remove(),t(o).each(function(){var n=t(this),r=e(n),o={relatedTarget:this};r.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(r[0],i.target)||(r.trigger(i=t.Event("hide.bs.dropdown",o)),i.isDefaultPrevented()||(n.attr("aria-expanded","false"),r.removeClass("open").trigger(t.Event("hidden.bs.dropdown",o)))))}))}function n(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new s(this)),"string"==typeof e&&n[e].call(i)})}var r=".dropdown-backdrop",o='[data-toggle="dropdown"]',s=function(e){t(e).on("click.bs.dropdown",this.toggle)};s.VERSION="3.3.7",s.prototype.toggle=function(n){var r=t(this);if(!r.is(".disabled, :disabled")){var o=e(r),s=o.hasClass("open");if(i(),!s){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var a={relatedTarget:this};if(o.trigger(n=t.Event("show.bs.dropdown",a)),n.isDefaultPrevented())return;r.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger(t.Event("shown.bs.dropdown",a))}return!1}},s.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var r=e(n),s=r.hasClass("open");if(!s&&27!=i.which||s&&27==i.which)return 27==i.which&&r.find(o).trigger("focus"),n.trigger("click");var a=" li:not(.disabled):visible a",l=r.find(".dropdown-menu"+a);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=n,t.fn.dropdown.Constructor=s,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",o,s.prototype.toggle).on("keydown.bs.dropdown.data-api",o,s.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",s.prototype.keydown)}(jQuery),function(t){"use strict";function e(e,n){return this.each(function(){var r=t(this),o=r.data("bs.modal"),s=t.extend({},i.DEFAULTS,r.data(),"object"==typeof e&&e);o||r.data("bs.modal",o=new i(this,s)),"string"==typeof e?o[e](n):s.show&&o.show(n)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var n=this,r=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var r=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),r&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var o=t.Event("shown.bs.modal",{relatedTarget:e});r?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(o)}).emulateTransitionEnd(i.TRANSITION_DURATION):n.$element.trigger("focus").trigger(o)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=t.support.transition&&r;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+r).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){if(this.ignoreBackdropClick)return void(this.ignoreBackdropClick=!1);t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;o?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){n.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var n=t(this),r=n.attr("href"),o=t(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=o.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(r)&&r},o.data(),n.data());n.is("a")&&i.preventDefault(),o.one("show.bs.modal",function(t){t.isDefaultPrevented()||o.one("hidden.bs.modal",function(){n.is(":visible")&&n.trigger("focus")})}),e.call(o,s,this)})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tab");r||n.data("bs.tab",r=new i(this)),"string"==typeof e&&r[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var r=i.find(".active:last a"),o=t.Event("hide.bs.tab",{relatedTarget:e[0]}),s=t.Event("show.bs.tab",{relatedTarget:r[0]});if(r.trigger(o),e.trigger(s),!s.isDefaultPrevented()&&!o.isDefaultPrevented()){var a=t(n);this.activate(e.closest("li"),i),this.activate(a,a.parent(),function(){r.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:r[0]})})}}},i.prototype.activate=function(e,n,r){function o(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),r&&r()}var s=n.find("> .active"),a=r&&t.support.transition&&(s.length&&s.hasClass("fade")||!!n.find("> .fade").length);s.length&&a?s.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),s.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var r=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',r).on("click.bs.tab.data-api",'[data-toggle="pill"]',r)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.affix"),o="object"==typeof e&&e;r||n.data("bs.affix",r=new i(this,o)),"string"==typeof e&&r[e]()})}var i=function(e,n){this.options=t.extend({},i.DEFAULTS,n),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.7",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,n){var r=this.$target.scrollTop(),o=this.$element.offset(),s=this.$target.height();if(null!=i&&"top"==this.affixed)return r<i&&"top";if("bottom"==this.affixed)return null!=i?!(r+this.unpin<=o.top)&&"bottom":!(r+s<=t-n)&&"bottom";var a=null==this.affixed,l=a?r:o.top,h=a?s:e;return null!=i&&r<=i?"top":null!=n&&l+h>=t-n&&"bottom"},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),n=this.options.offset,r=n.top,o=n.bottom,s=Math.max(t(document).height(),t(document.body).height());"object"!=typeof n&&(o=r=n),"function"==typeof r&&(r=n.top(this.$element)),"function"==typeof o&&(o=n.bottom(this.$element));var a=this.getState(s,e,r,o);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var l="affix"+(a?"-"+a:""),h=t.Event(l+".bs.affix");if(this.$element.trigger(h),h.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:s-e-o})}};var n=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),n=i.data();n.offset=n.offset||{},null!=n.offsetBottom&&(n.offset.bottom=n.offsetBottom),null!=n.offsetTop&&(n.offset.top=n.offsetTop),e.call(i,n)})})}(jQuery),function(t){"use strict";function e(i,n){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var n=t(this),r=n.data("bs.scrollspy"),o="object"==typeof i&&i;r||n.data("bs.scrollspy",r=new e(this,o)),"string"==typeof i&&r[i]()})}e.VERSION="3.3.7",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),r=e.data("target")||e.attr("href"),o=/^#./.test(r)&&t(r);return o&&o.length&&o.is(":visible")&&[[o[i]().top+n,r]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),n=this.options.offset+i-this.$scrollElement.height(),r=this.offsets,o=this.targets,s=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=n)return s!=(t=o[o.length-1])&&this.activate(t);if(s&&e<r[0])return this.activeTarget=null,this.clear();for(t=r.length;t--;)s!=o[t]&&e>=r[t]&&(r[t+1]===undefined||e<r[t+1])&&this.activate(o[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var n=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.tooltip"),o="object"==typeof e&&e;!r&&/destroy|hide/.test(e)||(r||n.data("bs.tooltip",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,n){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var r=this.options.trigger.split(" "),o=r.length;o--;){var s=r[o];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,n){i[t]!=n&&(e[t]=n)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue()){if(clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)}},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var n=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!n)return;var r=this,o=this.tip(),s=this.getUID(this.type);this.setContent(),o.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(a);h&&(a=a.replace(l,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var u=this.getPosition(),c=o[0].offsetWidth,d=o[0].offsetHeight;if(h){var f=a,p=this.getPosition(this.$viewport);a="bottom"==a&&u.bottom+d>p.bottom?"top":"top"==a&&u.top-d<p.top?"bottom":"right"==a&&u.right+c>p.width?"left":"left"==a&&u.left-c<p.left?"right":a,o.removeClass(f).addClass(a)}var g=this.getCalculatedOffset(a,u,c,d);this.applyPlacement(g,a);var m=function(){var t=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==t&&r.leave(r)}
;t.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",m).emulateTransitionEnd(i.TRANSITION_DURATION):m()}},i.prototype.applyPlacement=function(e,i){var n=this.tip(),r=n[0].offsetWidth,o=n[0].offsetHeight,s=parseInt(n.css("margin-top"),10),a=parseInt(n.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top+=s,e.left+=a,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),n.addClass("in");var l=n[0].offsetWidth,h=n[0].offsetHeight;"top"==i&&h!=o&&(e.top=e.top+o-h);var u=this.getViewportAdjustedDelta(i,e,l,h);u.left?e.left+=u.left:e.top+=u.top;var c=/top|bottom/.test(i),d=c?2*u.left-r+l:2*u.top-o+h,f=c?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(d,n[0][f],c)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function n(){"in"!=r.hoverState&&o.detach(),r.$element&&r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),e&&e()}var r=this,o=t(this.$tip),s=t.Event("hide.bs."+this.type);if(this.$element.trigger(s),!s.isDefaultPrevented())return o.removeClass("in"),t.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(i.TRANSITION_DURATION):n(),this.hoverState=null,this},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],n="BODY"==i.tagName,r=i.getBoundingClientRect();null==r.width&&(r=t.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var o=window.SVGElement&&i instanceof window.SVGElement,s=n?{top:0,left:0}:o?null:e.offset(),a={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=n?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},r,a,l,s)},i.prototype.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,n){var r={top:0,left:0};if(!this.$viewport)return r;var o=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-o-s.scroll,l=e.top+o-s.scroll+n;a<s.top?r.top=s.top-a:l>s.top+s.height&&(r.top=s.top+s.height-l)}else{var h=e.left-o,u=e.left+o+i;h<s.left?r.left=s.left-h:u>s.right&&(r.left=s.left+s.width-u)}return r},i.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},i.prototype.getUID=function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&((i=t(e.currentTarget).data("bs."+this.type))||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})};var n=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.popover"),o="object"==typeof e&&e;!r&&/destroy|hide/.test(e)||(r||n.data("bs.popover",r=new i(this,o)),"string"==typeof e&&r[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.7",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var n=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(jQuery),function(t){t.version={versionStr:"2.3.0",major:parseInt("2",10),minor:parseInt("3",10),revision:parseInt("0",10)};var e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;t.isFunction=function(e){return"function"===t.type(e)},t.isArray=Array.isArray||function(e){return"array"===t.type(e)},t.isWindow=function(t){return t&&"object"==typeof t&&"setInterval"in t},t.type=function(t){return null===t||t===undefined?String(t):e[i.call(t)]||"object"},t.isPlainObject=function(e){if(!e||"object"!==OpenSeadragon.type(e)||e.nodeType||t.isWindow(e))return!1;if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1;var i;for(var r in e)i=r;return i===undefined||n.call(e,i)},t.isEmptyObject=function(t){for(var e in t)return!1;return!0},t.freezeObject=function(e){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(t){return t},t.freezeObject(e)},t.supportsCanvas=function(){var e=document.createElement("canvas");return!(!t.isFunction(e.getContext)||!e.getContext("2d"))}(),t.isCanvasTainted=function(t){var e=!1;try{t.getContext("2d").getImageData(0,0,1,1)}catch(t){e=!0}return e},t.pixelDensityRatio=function(){if(t.supportsCanvas){var e=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(i,1)/n}return 1}()}(OpenSeadragon),function($){function getOffsetParent(t,e){return e&&t!=document.body?document.body:t.offsetParent}$.extend=function(){var t,e,i,n,r,o,s=arguments[0]||{},a=arguments.length,l=!1,h=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},h=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===h&&(s=this,--h);h<a;h++)if(null!==(t=arguments[h])||t!==undefined)for(e in t)i=s[e],n=t[e],s!==n&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(r=OpenSeadragon.isArray(n)))?(r?(r=!1,o=i&&OpenSeadragon.isArray(i)?i:[]):o=i&&OpenSeadragon.isPlainObject(i)?i:{},s[e]=OpenSeadragon.extend(l,o,n)):n!==undefined&&(s[e]=n));return s};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var t=navigator.userAgent;return"string"==typeof t&&(-1!==t.indexOf("iPhone")||-1!==t.indexOf("iPad")||-1!==t.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,degrees:0,opacity:1,preload:!1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(t,e){return function(){var i=arguments;return i===undefined&&(i=[]),e.apply(t,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(t){return"string"==typeof t&&(t=document.getElementById(t)),t},getElementPosition:function(t){var e,i,n=new $.Point;for(t=$.getElement(t),e="fixed"==$.getElementStyle(t).position,i=getOffsetParent(t,e);i;)n.x+=t.offsetLeft,n.y+=t.offsetTop,e&&(n=n.plus($.getPageScroll())),t=i,e="fixed"==$.getElementStyle(t).position,i=getOffsetParent(t,e);return n},getElementOffset:function(t){t=$.getElement(t);var e,i,n=t&&t.ownerDocument,r={top:0,left:0};return n?(e=n.documentElement,typeof t.getBoundingClientRect!=typeof undefined&&(r=t.getBoundingClientRect()),i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(r.left+(i.pageXOffset||e.scrollLeft)-(e.clientLeft||0),r.top+(i.pageYOffset||e.scrollTop)-(e.clientTop||0))):new $.Point},getElementSize:function(t){return t=$.getElement(t),new $.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=$.getElement(t),t.currentStyle}:function(t){return t=$.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var e={};return $.getCssPropertyWithVendorPrefix=function(t){if(e[t]!==undefined)return e[t];var i=document.createElement("div").style,n=null;if(i[t]!==undefined)n=t;else for(var r=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=$.capitalizeFirstLetter(t),s=0;s<r.length;s++){var a=r[s]+o;if(i[a]!==undefined){n=a;break}}return e[t]=n,n},$.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},positiveModulo:function(t,e){var i=t%e;return i<0&&(i+=e),i},pointInElement:function(t,e){t=$.getElement(t);var i=$.getElementOffset(t),n=$.getElementSize(t);return e.x>=i.x&&e.x<i.x+n.x&&e.y<i.y+n.y&&e.y>=i.y},getEvent:function(t){return $.getEvent=t?function(t){return t}:function(){return window.event},$.getEvent(t)},getMousePosition:function(t){if("number"==typeof t.pageX)$.getMousePosition=function(t){var e=new $.Point;return t=$.getEvent(t),e.x=t.pageX,e.y=t.pageY,e};else{if("number"!=typeof t.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(t){var e=new $.Point;return t=$.getEvent(t),e.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,e}}return $.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},e=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(e.scrollLeft||e.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!t.scrollLeft&&!t.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(t){if("undefined"!=typeof window.scrollTo)$.setPageScroll=function(t){window.scrollTo(t.x,t.y)};else{var e=$.getPageScroll();if(e.x===t.x&&e.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var i=$.getPageScroll();if(i.x!==e.x&&i.y!==e.y)return void($.setPageScroll=function(t){document.body.scrollLeft=t.x,document.body.scrollTop=t.y});if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,i=$.getPageScroll(),i.x!==e.x&&i.y!==e.y)return void($.setPageScroll=function(t){document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y});$.setPageScroll=function(){}}return $.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},e=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!e.clientWidth&&!e.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(t){t=$.getElement(t);var e=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(e[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(e[1].style,{display:"table-row"}),$.extend(e[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),e[0].appendChild(e[1]),e[1].appendChild(e[2]),e[2].appendChild(t),e[0]},makeNeutralElement:function(t){var e=document.createElement(t),i=e.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",e},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(t){return $.makeTransparentImage=function(t){var e=$.makeNeutralElement("img");return e.src=t,e},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(t){var e=$.makeNeutralElement("img"),i=null;return i=$.makeNeutralElement("span"),i.style.display="inline-block",e.onload=function(){i.style.width=i.style.width||e.width+"px",i.style.height=i.style.height||e.height+"px",e.onload=null,e=null},e.src=t,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",i}),$.makeTransparentImage(t)},setElementOpacity:function(t,e,i){var n,r;t=$.getElement(t),i&&!$.Browser.alpha&&(e=Math.round(e)),$.Browser.opacity?t.style.opacity=e<1?e:"":e<1?(n=Math.round(100*e),r="alpha(opacity="+n+")",t.style.filter=r):t.style.filter=""},setElementTouchActionNone:function(t){t=$.getElement(t),"undefined"!=typeof t.style.touchAction?t.style.touchAction="none":"undefined"!=typeof t.style.msTouchAction&&(t.style.msTouchAction="none")},addClass:function(t,e){t=$.getElement(t),t.className?-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=" "+e):t.className=e},indexOf:function(t,e,i){return Array.prototype.indexOf?this.indexOf=function(t,e,i){return t.indexOf(e,i)}:this.indexOf=function(t,e,i){var n,r,o=i||0;if(!t)throw new TypeError;if(0===(r=t.length)||o>=r)return-1;for(o<0&&(o=r-Math.abs(o)),n=o;n<r;n++)if(t[n]===e)return n;return-1},this.indexOf(t,e,i)},removeClass:function(t,e){var i,n,r=[];for(t=$.getElement(t),i=t.className.split(/\s+/),n=0;n<i.length;n++)i[n]&&i[n]!==e&&r.push(i[n]);t.className=r.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,e,i,n){t=$.getElement(t),t.addEventListener(e,i,n)};if(window.attachEvent)return function(t,e,i){t=$.getElement(t),t.attachEvent("on"+e,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,e,i,n){t=$.getElement(t),t.removeEventListener(e,i,n)};if(window.detachEvent)return function(t,e,i){t=$.getElement(t),t.detachEvent("on"+e,i)};throw new Error("No known event model.")}(),cancelEvent:function(t){t=$.getEvent(t),t.preventDefault?$.cancelEvent=function(t){t.preventDefault()}:$.cancelEvent=function(t){t=$.getEvent(t),t.cancel=!0,t.returnValue=!1},$.cancelEvent(t)},stopEvent:function(t){t=$.getEvent(t),t.stopPropagation?$.stopEvent=function(t){t.stopPropagation()}:$.stopEvent=function(t){t=$.getEvent(t),t.cancelBubble=!0},$.stopEvent(t)},createCallback:function(t,e){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,r=n.concat([]);for(i=0;i<arguments.length;i++)r.push(arguments[i]);return e.apply(t,r)}},getUrlParameter:function(t){var e=URLPARAMS[t];return e||null},getUrlProtocol:function(t){var e=t.match(/^([a-z]+:)\/\//i);return null===e?window.location.protocol:e[1].toLowerCase()},createAjaxRequest:function(t){var e;try{e=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}if(e)window.XMLHttpRequest?$.createAjaxRequest=function(t){return t?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(t)},makeAjaxRequest:function(t,e,i){var n,r,o;$.isPlainObject(t)&&(e=t.success,i=t.error,n=t.withCredentials,r=t.headers,o=t.responseType||null,t=t.url);var s=$.getUrlProtocol(t),a=$.createAjaxRequest("file:"===s);if(!$.isFunction(e))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},a.status>=200&&a.status<300||0===a.status&&"http:"!==s&&"https:"!==s?e(a):($.console.log("AJAX request returned %d: %s",a.status,t),$.isFunction(i)&&i(a)))};try{if(a.open("GET",t,!0),o&&(a.responseType=o),r)for(var l in r)r.hasOwnProperty(l)&&r[l]&&a.setRequestHeader(l,r[l]);n&&(a.withCredentials=!0),a.send(null)}catch(n){var h=n.message,u=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(u&&"undefined"!=typeof n.number&&-2147024891==n.number&&(h+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",n.name,h),a.onreadystatechange=function(){},window.XDomainRequest){var c=new XDomainRequest;if(c){c.onload=function(){$.isFunction(e)&&e({responseText:c.responseText,status:200,statusText:"OK"})},c.onerror=function(){$.isFunction(i)&&i({responseText:c.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{c.open("GET",t),c.send()}catch(t){$.isFunction(i)&&i(a,n)}}}else $.isFunction(i)&&i(a,n)}return a},jsonp:function(t){var e,i=t.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=t.callbackName||"openseadragon"+$.now(),o=window[r],s="$1"+r+"$2",a=t.param||"callback",l=t.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,s),i+=(/\?/.test(i)?"&":"?")+a+"="+r,window[r]=function(t){if(o)window[r]=o;else try{delete window[r]}catch(t){}l&&$.isFunction(l)&&l(t)},e=document.createElement("script"),undefined===t.async&&!1===t.async||(e.async="async"),t.scriptCharset&&(e.charset=t.scriptCharset),e.src=i,e.onload=e.onreadystatechange=function(t,i){(i||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,n&&e.parentNode&&n.removeChild(e),e=undefined)},n.insertBefore(e,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)$.parseXml=function(t){var e;return e=new DOMParser,e.parseFromString(t,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(t){var e=null;return e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(t),e}}return $.parseXml(t)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(t){return t=t||"",!!FILEFORMATS[t.toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var t,e=navigator.appVersion,i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(i.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):i.indexOf("Safari")>=0?($.Browser.vendor=i.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))):(t=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==t.exec(i)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var n,r,o,s=window.location.search.substring(1),a=s.split("&");for(o=0;o<a.length;o++)n=a[o],(r=n.indexOf("="))>0&&(URLPARAMS[n.substring(0,r)]=decodeURIComponent(n.substring(r+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(t){var e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,i=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(e&&i)$.requestAnimationFrame=function(){return e.apply(t,arguments)},$.cancelAnimationFrame=function(){return i.apply(t,arguments)};else{var n,r=[],o=[],s=0;$.requestAnimationFrame=function(t){return r.push([++s,t]),n||(n=setInterval(function(){if(r.length){var t=$.now(),e=o;for(o=r,r=e;o.length;)o.shift()[1](t)}else clearInterval(n),n=undefined},20)),s},$.cancelAnimationFrame=function(t){var e,i;for(e=0,i=r.length;e<i;e+=1)if(r[e][0]===t)return void r.splice(e,1);for(e=0,i=o.length;e<i;e+=1)if(o[e][0]===t)return void o.splice(e,1)}}}(window)}(OpenSeadragon),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.OpenSeadragon=e()}(this,function(){return OpenSeadragon}),function(t){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.fullscreenElement},e.requestFullScreen=function(t){return t.requestFullscreen()},e.exitFullScreen=function(){document.exitFullscreen()},e.fullScreenEventName="fullscreenchange",e.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.msFullscreenElement},e.requestFullScreen=function(t){return t.msRequestFullscreen()},e.exitFullScreen=function(){document.msExitFullscreen()},e.fullScreenEventName="MSFullscreenChange",e.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitFullscreenElement},e.requestFullScreen=function(t){return t.webkitRequestFullscreen()},e.exitFullScreen=function(){document.webkitExitFullscreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},e.requestFullScreen=function(t){return t.webkitRequestFullScreen()},e.exitFullScreen=function(){document.webkitCancelFullScreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.mozFullScreenElement},e.requestFullScreen=function(t){return t.mozRequestFullScreen()},e.exitFullScreen=function(){document.mozCancelFullScreen()},e.fullScreenEventName="mozfullscreenchange",e.fullScreenErrorEventName="mozfullscreenerror"),e.isFullScreen=function(){return null!==e.getFullScreenElement()},e.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),e.exitFullScreen()},t.extend(t,e)}(OpenSeadragon),function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(t,e,i,n){var r=this;n=n||1;var o=0,s=function(i){o++,o===n&&r.removeHandler(t,s),e(i)};this.addHandler(t,s,i)},addHandler:function(e,i,n){var r=this.events[e];r||(this.events[e]=r=[]),i&&t.isFunction(i)&&(r[r.length]={handler:i,userData:n||null})},removeHandler:function(e,i){var n,r=this.events[e],o=[];if(r&&t.isArray(r)){for(n=0;n<r.length;n++)r[n].handler!==i&&o.push(r[n]);this.events[e]=o}},removeAllHandlers:function(t){if(t)this.events[t]=[];else for(var e in this.events)this.events[e]=[]},getHandler:function(t){var e=this.events[t];return e&&e.length?(e=1===e.length?[e[0]]:Array.apply(null,e),function(t,i){var n,r=e.length;for(n=0;n<r;n++)e[n]&&(i.eventSource=t,i.userData=e[n].userData,e[n].handler(i))}):null},raiseEvent:function(t,e){var i=this.getHandler(t);i&&(e||(e={}),i(this,e))}}}(OpenSeadragon),function(t){function e(e){var i,n=gt[e.hash],r=n.activePointersLists.length;for(i=0;i<r;i++)n.activePointersLists[i].captureCount>0&&(t.removeEvent(t.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[i].captureCount=0);for(i=0;i<r;i++)n.activePointersLists.pop()}function i(i){var n,r,o=gt[i.hash];if(!o.tracking){for(r=0;r<t.MouseTracker.subscribeEvents.length;r++)n=t.MouseTracker.subscribeEvents[r],t.addEvent(i.element,n,o[n],!1);e(i),o.tracking=!0}}function n(i){var n,r,o=gt[i.hash];if(o.tracking){for(r=0;r<t.MouseTracker.subscribeEvents.length;r++)n=t.MouseTracker.subscribeEvents[r],t.removeEvent(i.element,n,o[n],!1);e(i),o.tracking=!1}}function r(e,i){var n=gt[e.hash];if("pointerevent"===i)return{upName:t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:n.pointerupcaptured,moveName:t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:n.pointermovecaptured};if("mouse"===i)return{upName:"mouseup",upHandler:n.mouseupcaptured,moveName:"mousemove",moveHandler:n.mousemovecaptured};if("touch"===i)return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function o(e,i,n){var o,s=e.getActivePointersListByType(i);s.captureCount+=n||1,1===s.captureCount&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?e.element.setCapture(!0):(o=r(e,t.MouseTracker.havePointerEvents?"pointerevent":i),mt&&ft(window.top)&&t.addEvent(window.top,o.upName,o.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,o.upName,o.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,o.moveName,o.moveHandler,!0)))}function s(e,i,n){var o,s=e.getActivePointersListByType(i);s.captureCount-=n||1,0===s.captureCount&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?e.element.releaseCapture():(o=r(e,t.MouseTracker.havePointerEvents?"pointerevent":i),mt&&ft(window.top)&&t.removeEvent(window.top,o.upName,o.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,o.moveName,o.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,o.upName,o.upHandler,!0)))}function a(e){var i;if(t.MouseTracker.unprefixedPointerEvents)i=e.pointerType;else switch(e.pointerType){case 2:i="touch";break;case 3:i="pen";break;case 4:i="mouse";break;default:i=""}return i}function l(e){return t.getMousePosition(e)}function h(t,e){return u(l(t),e)}function u(e,i){var n=t.getElementOffset(i);return e.minus(n)}function c(e,i){return new t.Point((e.x+i.x)/2,(e.y+i.y)/2)}function d(e,i){e.clickHandler&&t.cancelEvent(i)}function f(e,i){e.dblClickHandler&&t.cancelEvent(i)}function p(e,i){e.keyDownHandler&&(i=t.getEvent(i),e.keyDownHandler({eventSource:e,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})||t.cancelEvent(i))}function g(e,i){e.keyUpHandler&&(i=t.getEvent(i),e.keyUpHandler({eventSource:e,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})||t.cancelEvent(i))}function m(e,i){e.keyHandler&&(i=t.getEvent(i),
e.keyHandler({eventSource:e,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})||t.cancelEvent(i))}function v(e,i){e.focusHandler&&(i=t.getEvent(i),!1===e.focusHandler({eventSource:e,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i))}function y(e,i){e.blurHandler&&(i=t.getEvent(i),!1===e.blurHandler({eventSource:e,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i))}function w(t,e){x(t,e,e)}function _(e,i){i=t.getEvent(i);var n={target:i.target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==t.MouseTracker.wheelEventName?n.deltaY=-i.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:n.deltaY=i.detail,x(e,n,i)}function x(e,i,n){var r=0;r=i.deltaY<0?1:-1,e.scrollHandler&&!1===e.scrollHandler({eventSource:e,pointerType:"mouse",position:h(i,e.element),scroll:r,shift:i.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(n)}function b(t,e){if(t===e)return!1;for(;e&&e!==t;)e=e.parentNode;return e===t}function S(e,i){i=t.getEvent(i),C(e,i)}function T(e,i){i=t.getEvent(i),i.currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||C(e,i)}function C(e,i){st(e,i,[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()}])}function P(e,i){i=t.getEvent(i),k(e,i)}function E(e,i){i=t.getEvent(i),i.currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||k(e,i)}function k(e,i){at(e,i,[{id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()}])}function O(e){return t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?1===e?0:2===e?2:4===e?1:-1:e}function M(e,i){var n;i=t.getEvent(i),n={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()},lt(e,i,[n],O(i.button))&&(t.stopEvent(i),o(e,"mouse")),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler)&&t.cancelEvent(i)}function R(t,e){L(t,e)}function I(e,i){L(e,i),t.stopEvent(i)}function L(e,i){var n;i=t.getEvent(i),n={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()},ht(e,i,[n],O(i.button))&&s(e,"mouse")}function N(t,e){D(t,e)}function A(e,i){D(e,i),t.stopEvent(i)}function D(e,i){var n;i=t.getEvent(i),n={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:t.now()},ut(e,i,[n])}function z(t,e,i){var n,r=i.getLength(),o=[];if("touch"===i.type||i.contacts>0){for(n=0;n<r;n++)o.push(i.getByIndex(n));o.length>0&&(ht(t,e,o,0),i.captureCount=1,s(t,i.type),at(t,e,o))}}function H(e,i){var n,r,s,a,h=i.changedTouches.length,u=[],c=e.getActivePointersListByType("touch");for(n=t.now(),c.getLength()>i.touches.length-h&&(t.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),z(e,i,c)),r=0;r<h;r++)u.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:l(i.changedTouches[r]),currentTime:n});for(st(e,i,u),r=0;r<pt.length;r++)if(pt[r]!==e&&pt[r].isTracking()&&b(pt[r].element,e.element)){for(a=[],s=0;s<h;s++)a.push({id:i.changedTouches[s].identifier,type:"touch",currentPos:l(i.changedTouches[s]),currentTime:n});st(pt[r],i,a)}lt(e,i,u,0)&&(t.stopEvent(i),o(e,"touch",h)),t.cancelEvent(i)}function B(t,e){$(t,e)}function F(e,i){$(e,i),t.stopEvent(i)}function $(e,i){var n,r,o,a,h=i.changedTouches.length,u=[];for(n=t.now(),r=0;r<h;r++)u.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:l(i.changedTouches[r]),currentTime:n});for(ht(e,i,u,0)&&s(e,"touch",h),at(e,i,u),r=0;r<pt.length;r++)if(pt[r]!==e&&pt[r].isTracking()&&b(pt[r].element,e.element)){for(a=[],o=0;o<h;o++)a.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:l(i.changedTouches[o]),currentTime:n});at(pt[r],i,a)}t.cancelEvent(i)}function j(t,e){q(t,e)}function W(e,i){q(e,i),t.stopEvent(i)}function q(e,i){var n,r=i.changedTouches.length,o=[];for(n=0;n<r;n++)o.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:l(i.changedTouches[n]),currentTime:t.now()});ut(e,i,o),t.cancelEvent(i)}function V(t,e){z(t,e,t.getActivePointersListByType("touch"))}function U(t,e){return e.stopPropagation(),e.preventDefault(),!1}function G(t,e){return e.stopPropagation(),e.preventDefault(),!1}function Z(e,i){var n;i.currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},st(e,i,[n]))}function X(e,i){var n;i.currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},at(e,i,[n]))}function Y(e,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},lt(e,i,[n],i.button)&&(t.stopEvent(i),o(e,n.type)),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler||e.pinchHandler)&&t.cancelEvent(i)}function K(t,e){Q(t,e)}function J(e,i){e.getActivePointersListByType(a(i)).getById(i.pointerId)&&Q(e,i),t.stopEvent(i)}function Q(e,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},ht(e,i,[n],i.button)&&s(e,n.type)}function tt(t,e){it(t,e)}function et(e,i){e.getActivePointersListByType(a(i)).getById(i.pointerId)&&it(e,i),t.stopEvent(i)}function it(e,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:t.now()},ut(e,i,[n])}function nt(t,e){var i;i={id:e.pointerId,type:a(e)},ct(t,e,[i])}function rt(t,e){return e.hasOwnProperty("isPrimary")||(0===t.getLength()?e.isPrimary=!0:e.isPrimary=!1),e.speed=0,e.direction=0,e.contactPos=e.currentPos,e.contactTime=e.currentTime,e.lastPos=e.currentPos,e.lastTime=e.currentTime,t.add(e)}function ot(t,e){var i,n;return t.getById(e.id)?(i=t.removeById(e.id),e.hasOwnProperty("isPrimary")||(n=t.getPrimary())||(n=t.getByIndex(0))&&(n.isPrimary=!0)):i=t.getLength(),i}function st(e,i,n){var r,o,s,a=e.getActivePointersListByType(n[0].type),l=n.length;for(r=0;r<l;r++)o=n[r],s=a.getById(o.id),s?(s.insideElement=!0,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime,o=s):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,rt(a,o)),e.enterHandler&&!1===e.enterHandler({eventSource:e,pointerType:o.type,position:u(o.currentPos,e.element),buttons:a.buttons,pointers:e.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)}function at(e,i,n){var r,o,s,a=e.getActivePointersListByType(n[0].type),l=n.length;for(r=0;r<l;r++)o=n[r],s=a.getById(o.id),s&&(s.captured?(s.insideElement=!1,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):ot(a,s),o=s),e.exitHandler&&!1===e.exitHandler({eventSource:e,pointerType:o.type,position:u(o.currentPos,e.element),buttons:a.buttons,pointers:e.getActivePointerCount(),insideElementPressed:!!s&&s.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)}function lt(e,i,n,r){var o,s,a,l=gt[e.hash],h=e.getActivePointersListByType(n[0].type),d=n.length;"undefined"!=typeof i.buttons?h.buttons=i.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?0===r?h.buttons+=1:1===r?h.buttons+=4:2===r?h.buttons+=2:3===r?h.buttons+=8:4===r?h.buttons+=16:5===r&&(h.buttons+=32):0===r?h.buttons|=1:1===r?h.buttons|=4:2===r?h.buttons|=2:3===r?h.buttons|=8:4===r?h.buttons|=16:5===r&&(h.buttons|=32);var f=e.getActivePointersListsExceptType(n[0].type);for(o=0;o<f.length;o++)z(e,i,f[o]);if(0!==r)return e.nonPrimaryPressHandler&&!1===e.nonPrimaryPressHandler({eventSource:e,pointerType:n[0].type,position:u(n[0].currentPos,e.element),button:r,buttons:h.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),!1;for(o=0;o<d;o++)s=n[o],a=h.getById(s.id),a?(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,a.contactPos=s.currentPos,a.contactTime=s.currentTime,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=s.currentPos,a.currentTime=s.currentTime,s=a):(s.captured=!0,s.insideElementPressed=!0,s.insideElement=!0,rt(h,s)),h.addContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(e,s),1===h.contacts?e.pressHandler&&!1===e.pressHandler({eventSource:e,pointerType:s.type,position:u(s.contactPos,e.element),buttons:h.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i):2===h.contacts&&e.pinchHandler&&"touch"===s.type&&(l.pinchGPoints=h.asArray(),l.lastPinchDist=l.currentPinchDist=l.pinchGPoints[0].currentPos.distanceTo(l.pinchGPoints[1].currentPos),l.lastPinchCenter=l.currentPinchCenter=c(l.pinchGPoints[0].currentPos,l.pinchGPoints[1].currentPos));return!0}function ht(e,i,n,r){var o,s,a,l,h,d,f=gt[e.hash],p=e.getActivePointersListByType(n[0].type),g=n.length,m=!1,v=!1;if("undefined"!=typeof i.buttons?p.buttons=i.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?0===r?p.buttons-=1:1===r?p.buttons-=4:2===r?p.buttons-=2:3===r?p.buttons-=8:4===r?p.buttons-=16:5===r&&(p.buttons-=32):0===r?p.buttons^=-2:1===r?p.buttons^=-5:2===r?p.buttons^=-3:3===r?p.buttons^=-9:4===r?p.buttons^=-17:5===r&&(p.buttons^=-33),0!==r){e.nonPrimaryReleaseHandler&&!1===e.nonPrimaryReleaseHandler({eventSource:e,pointerType:n[0].type,position:u(n[0].currentPos,e.element),button:r,buttons:p.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i);return z(e,i,e.getActivePointersListByType("mouse")),!1}for(a=0;a<g;a++)l=n[a],(h=p.getById(l.id))&&(h.captured&&(h.captured=!1,m=!0,v=!0),h.lastPos=h.currentPos,h.lastTime=h.currentTime,h.currentPos=l.currentPos,h.currentTime=l.currentTime,h.insideElement||ot(p,h),o=h.currentPos,s=h.currentTime,v?(p.removeContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(e,h),0===p.contacts?(e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:h.type,position:u(o,e.element),buttons:p.buttons,insideElementPressed:h.insideElementPressed,insideElementReleased:h.insideElement,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),e.dragEndHandler&&!h.currentPos.equals(h.contactPos)&&!1===e.dragEndHandler({eventSource:e,pointerType:h.type,position:u(h.currentPos,e.element),speed:h.speed,direction:h.direction,shift:i.shiftKey,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),(e.clickHandler||e.dblClickHandler)&&h.insideElement&&(d=s-h.contactTime<=e.clickTimeThreshold&&h.contactPos.distanceTo(o)<=e.clickDistThreshold,e.clickHandler&&!1===e.clickHandler({eventSource:e,pointerType:h.type,position:u(h.currentPos,e.element),quick:d,shift:i.shiftKey,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),e.dblClickHandler&&d&&(p.clicks++,1===p.clicks?(f.lastClickPos=o,f.dblClickTimeOut=setTimeout(function(){p.clicks=0},e.dblClickTimeThreshold)):2===p.clicks&&(clearTimeout(f.dblClickTimeOut),p.clicks=0,f.lastClickPos.distanceTo(o)<=e.dblClickDistThreshold&&!1===e.dblClickHandler({eventSource:e,pointerType:h.type,position:u(h.currentPos,e.element),shift:i.shiftKey,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i),f.lastClickPos=null)))):2===p.contacts&&e.pinchHandler&&"touch"===h.type&&(f.pinchGPoints=p.asArray(),f.lastPinchDist=f.currentPinchDist=f.pinchGPoints[0].currentPos.distanceTo(f.pinchGPoints[1].currentPos),f.lastPinchCenter=f.currentPinchCenter=c(f.pinchGPoints[0].currentPos,f.pinchGPoints[1].currentPos))):e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:h.type,position:u(o,e.element),buttons:p.buttons,insideElementPressed:h.insideElementPressed,insideElementReleased:h.insideElement,isTouchEvent:"touch"===h.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i));return m}function ut(e,i,n){var r,o,s,a,l,h=gt[e.hash],d=e.getActivePointersListByType(n[0].type),f=n.length;for("undefined"!=typeof i.buttons&&(d.buttons=i.buttons),r=0;r<f;r++)o=n[r],s=d.getById(o.id),s?(o.hasOwnProperty("isPrimary")&&(s.isPrimary=o.isPrimary),s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,rt(d,o));e.stopHandler&&"mouse"===n[0].type&&(clearTimeout(e.stopTimeOut),e.stopTimeOut=setTimeout(function(){dt(e,i,n[0].type)},e.stopDelay)),0===d.contacts?e.moveHandler&&!1===e.moveHandler({eventSource:e,pointerType:n[0].type,position:u(n[0].currentPos,e.element),buttons:d.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i):1===d.contacts?(e.moveHandler&&(s=d.asArray()[0],!1===e.moveHandler({eventSource:e,pointerType:s.type,position:u(s.currentPos,e.element),buttons:d.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)),e.dragHandler&&(s=d.asArray()[0],l=s.currentPos.minus(s.lastPos),!1===e.dragHandler({eventSource:e,pointerType:s.type,position:u(s.currentPos,e.element),buttons:d.buttons,delta:l,speed:s.speed,direction:s.direction,shift:i.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i))):2===d.contacts&&(e.moveHandler&&(a=d.asArray(),!1===e.moveHandler({eventSource:e,pointerType:a[0].type,position:u(c(a[0].currentPos,a[1].currentPos),e.element),buttons:d.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)),e.pinchHandler&&"touch"===n[0].type&&(l=h.pinchGPoints[0].currentPos.distanceTo(h.pinchGPoints[1].currentPos))!=h.currentPinchDist&&(h.lastPinchDist=h.currentPinchDist,h.currentPinchDist=l,h.lastPinchCenter=h.currentPinchCenter,h.currentPinchCenter=c(h.pinchGPoints[0].currentPos,h.pinchGPoints[1].currentPos),!1===e.pinchHandler({eventSource:e,pointerType:"touch",gesturePoints:h.pinchGPoints,lastCenter:u(h.lastPinchCenter,e.element),center:u(h.currentPinchCenter,e.element),lastDistance:h.lastPinchDist,distance:h.currentPinchDist,shift:i.shiftKey,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&t.cancelEvent(i)))}function ct(t,e,i){ht(t,e,i,0),at(t,e,i)}function dt(t,e,i){t.stopHandler&&t.stopHandler({eventSource:t,pointerType:i,position:h(e,t.element),buttons:t.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:e,preventDefaultAction:!1,userData:t.userData})}function ft(t){try{return t.addEventListener&&t.removeEventListener}catch(t){return!1}}var pt=[],gt={};t.MouseTracker=function(e){pt.push(this);var i=arguments;t.isPlainObject(e)||(e={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=t.getElement(e.element),this.clickTimeThreshold=e.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=e.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=e.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=e.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=e.userData||null,this.stopDelay=e.stopDelay||50,this.enterHandler=e.enterHandler||null,this.exitHandler=e.exitHandler||null,this.pressHandler=e.pressHandler||null,this.nonPrimaryPressHandler=e.nonPrimaryPressHandler||null,this.releaseHandler=e.releaseHandler||null,this.nonPrimaryReleaseHandler=e.nonPrimaryReleaseHandler||null,this.moveHandler=e.moveHandler||null,this.scrollHandler=e.scrollHandler||null,this.clickHandler=e.clickHandler||null,this.dblClickHandler=e.dblClickHandler||null,this.dragHandler=e.dragHandler||null,this.dragEndHandler=e.dragEndHandler||null,this.pinchHandler=e.pinchHandler||null,this.stopHandler=e.stopHandler||null,this.keyDownHandler=e.keyDownHandler||null,this.keyUpHandler=e.keyUpHandler||null,this.keyHandler=e.keyHandler||null,this.focusHandler=e.focusHandler||null,this.blurHandler=e.blurHandler||null;var n=this;gt[this.hash]={click:function(t){d(n,t)},dblclick:function(t){f(n,t)},keydown:function(t){p(n,t)},keyup:function(t){g(n,t)},keypress:function(t){m(n,t)},focus:function(t){v(n,t)},blur:function(t){y(n,t)},wheel:function(t){w(n,t)},mousewheel:function(t){_(n,t)},DOMMouseScroll:function(t){_(n,t)},MozMousePixelScroll:function(t){_(n,t)},mouseenter:function(t){S(n,t)},mouseleave:function(t){P(n,t)},mouseover:function(t){T(n,t)},mouseout:function(t){E(n,t)},mousedown:function(t){M(n,t)},mouseup:function(t){R(n,t)},mouseupcaptured:function(t){I(n,t)},mousemove:function(t){N(n,t)},mousemovecaptured:function(t){A(n,t)},touchstart:function(t){H(n,t)},touchend:function(t){B(n,t)},touchendcaptured:function(t){F(n,t)},touchmove:function(t){j(n,t)},touchmovecaptured:function(t){W(n,t)},touchcancel:function(t){V(n,t)},gesturestart:function(t){U(n,t)},gesturechange:function(t){G(n,t)},pointerover:function(t){Z(n,t)},MSPointerOver:function(t){Z(n,t)},pointerout:function(t){X(n,t)},MSPointerOut:function(t){X(n,t)},pointerdown:function(t){Y(n,t)},MSPointerDown:function(t){Y(n,t)},pointerup:function(t){K(n,t)},MSPointerUp:function(t){K(n,t)},pointermove:function(t){tt(n,t)},MSPointerMove:function(t){tt(n,t)},pointercancel:function(t){nt(n,t)},MSPointerCancel:function(t){nt(n,t)},pointerupcaptured:function(t){J(n,t)},pointermovecaptured:function(t){et(n,t)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},e.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){var t;for(n(this),this.element=null,t=0;t<pt.length;t++)if(pt[t]===this){pt.splice(t,1);break}gt[this.hash]=null,delete gt[this.hash]},isTracking:function(){return gt[this.hash].tracking},setTracking:function(t){return t?i(this):n(this),this},getActivePointersListsExceptType:function(t){for(var e=gt[this.hash],i=[],n=0;n<e.activePointersLists.length;++n)e.activePointersLists[n].type!==t&&i.push(e.activePointersLists[n]);return i},getActivePointersListByType:function(e){var i,n,r=gt[this.hash],o=r.activePointersLists.length;for(i=0;i<o;i++)if(r.activePointersLists[i].type===e)return r.activePointersLists[i];return n=new t.MouseTracker.GesturePointList(e),r.activePointersLists.push(n),n},getActivePointerCount:function(){var t,e=gt[this.hash],i=e.activePointersLists.length,n=0;for(t=0;t<i;t++)n+=e.activePointersLists[t].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},t.MouseTracker.resetAllMouseTrackers=function(){for(var t=0;t<pt.length;t++)pt[t].isTracking()&&(pt[t].setTracking(!1),pt[t].setTracking(!0))},t.MouseTracker.gesturePointVelocityTracker=function(){var e=[],i=0,n=0,r=function(t,e){return t.hash.toString()+e.type+e.id.toString()},o=function(){var i,r,o,s,a,l,h=e.length,u=t.now();for(s=u-n,n=u,i=0;i<h;i++)r=e[i],o=r.gPoint,o.direction=Math.atan2(o.currentPos.y-r.lastPos.y,o.currentPos.x-r.lastPos.x),a=r.lastPos.distanceTo(o.currentPos),r.lastPos=o.currentPos,l=1e3*a/(s+1),o.speed=.75*l+.25*o.speed};return{addPoint:function(s,a){var l=r(s,a);e.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===e.length&&(n=t.now(),i=window.setInterval(o,50))},removePoint:function(t,n){var o,s=r(t,n),a=e.length;for(o=0;o<a;o++)if(e[o].guid===s){e.splice(o,1),0===--a&&window.clearInterval(i);break}}}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor==t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll",t.MouseTracker.supportsMouseCapture=function(){var e=document.createElement("div");return t.isFunction(e.setCapture)&&t.isFunction(e.releaseCapture)}(),t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",t.MouseTracker.wheelEventName],"DOMMouseScroll"==t.MouseTracker.wheelEventName&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||t.Browser.vendor!==t.BROWSERS.IE)?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),t.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):(t.MouseTracker.havePointerEvents=!1,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?(t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),t.MouseTracker.haveMouseEnter=!0):(t.MouseTracker.subscribeEvents.push("mouseover","mouseout"),t.MouseTracker.haveMouseEnter=!1),t.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.maxTouchPoints=10),t.MouseTracker.GesturePointList=function(t){this._gPoints=[],this.type=t,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(t){return this._gPoints.push(t)},removeById:function(t){var e,i=this._gPoints.length;for(e=0;e<i;e++)if(this._gPoints[e].id===t){this._gPoints.splice(e,1);break}return this._gPoints.length},getByIndex:function(t){return t<this._gPoints.length?this._gPoints[t]:null},getById:function(t){var e,i=this._gPoints.length;for(e=0;e<i;e++)if(this._gPoints[e].id===t)return this._gPoints[e];return null},getPrimary:function(){var t,e=this._gPoints.length;for(t=0;t<e;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts<0&&(this.contacts=0)}};var mt=function(){try{return window.self!==window.top}catch(t){return!0}}()}(OpenSeadragon),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(e,i,n){var r=e.parentNode;"number"==typeof i&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer="undefined"==typeof i.attachToViewer||i.attachToViewer,this.autoFade="undefined"==typeof i.autoFade||i.autoFade,this.element=e,this.anchor=i.anchor,this.container=n,this.anchor==t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==t.ControlAnchor.TOP_RIGHT||this.anchor==t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):r.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor==t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[t.SIGNAL]&&t.Browser.vendor==t.BROWSERS.IE?t.setElementOpacity(this.element,e,!0):t.setElementOpacity(this.wrapper,e,!0)}}}(OpenSeadragon),function(t){function e(t,e){var i,n=t.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==e)return i;return-1}t.ControlDock=function(e){var i,n,r=["topleft","topright","bottomright","bottomleft"];for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(1e6*Math.random()),container:t.makeNeutralElement("div"),controls:[]},e),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<r.length;n++)i=r[n],this.controls[i]=t.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(i,n){i=t.getElement(i);var r=null;if(!(e(this,i)>=0)){switch(n.anchor){case t.ControlAnchor.TOP_RIGHT:r=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:r=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:r=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:r=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:r=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case t.ControlAnchor.NONE:r=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new t.Control(i,n,r)),i.style.display="inline-block"}},removeControl:function(i){i=t.getElement(i);var n=e(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var t;for(t=this.controls.length-1;t>=0;t--)if(this.controls[t].isVisible())return!0;return!1},setControlsEnabled:function(t){var e;for(e=this.controls.length-1;e>=0;e--)this.controls[e].setVisible(t);return this}}}(OpenSeadragon),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(t){function e(e){return e=t.getElement(e),new t.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function i(e,i,n,r,o){function s(t,e){t.ready?r(t):(t.addHandler("ready",function(){r(t)}),t.addHandler("open-failed",function(t){o({message:t.message,source:e})}))}var a=e;if("string"==t.type(i))if(i.match(/^\s*<.*>\s*$/))i=t.parseXml(i);else if(i.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var l=t.parseJSON(i);i=l}catch(t){}setTimeout(function(){if("string"==t.type(i))i=new t.TileSource({url:i,crossOriginPolicy:n.crossOriginPolicy!==undefined?n.crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,ajaxHeaders:e.ajaxHeaders,useCanvas:e.useCanvas,success:function(t){r(t.tileSource)}}),i.addHandler("open-failed",function(t){o(t)});else if(t.isPlainObject(i)||i.nodeType)if(i.crossOriginPolicy!==undefined||n.crossOriginPolicy===undefined&&e.crossOriginPolicy===undefined||(i.crossOriginPolicy=n.crossOriginPolicy!==undefined?n.crossOriginPolicy:e.crossOriginPolicy),i.ajaxWithCredentials===undefined&&(i.ajaxWithCredentials=e.ajaxWithCredentials),i.useCanvas===undefined&&(i.useCanvas=e.useCanvas),t.isFunction(i.getTileUrl)){var l=new t.TileSource(i);l.getTileUrl=i.getTileUrl,r(l)}else{var h=t.TileSource.determineType(a,i);if(!h)return void o({message:"Unable to load TileSource",source:i});var u=h.prototype.configure.apply(a,[i]);s(new h(u),i)}else s(i,i)})}function n(e,i){if(i instanceof t.Overlay)return i;var n=null;if(i.element)n=t.getElement(i.element);else{var r=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());n=t.getElement(i.id),n||(n=document.createElement("a"),n.href="#/overlay/"+r),n.id=r,t.addClass(n,i.className?i.className:"openseadragon-overlay")}var o=i.location,s=i.width,a=i.height;if(!o){var l=i.x,h=i.y;if(i.px!==undefined){var u=e.viewport.imageToViewportRectangle(new t.Rect(i.px,i.py,s||0,a||0));l=u.x,h=u.y,s=s!==undefined?u.width:undefined,a=a!==undefined?u.height:undefined}o=new t.Point(l,h)}var c=i.placement;return c&&"string"===t.type(c)&&(c=t.Placement[i.placement.toUpperCase()]),new t.Overlay({element:n,location:o,placement:c,onDraw:i.onDraw,checkResize:i.checkResize,width:s,height:a,rotationMode:i.rotationMode})}function r(t,e){var i;for(i=t.length-1;i>=0;i--)if(t[i].element===e)return i;return-1}function o(e,i){return t.requestAnimationFrame(function(){i(e)})}function s(e){t.requestAnimationFrame(function(){l(e)})}function a(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=t.now()+e.controlsFadeDelay,window.setTimeout(function(){s(e)},e.controlsFadeDelay))}function l(e){var i,n,r,o;if(e.controlsShouldFade){for(i=t.now(),n=i-e.controlsFadeBeginTime,r=1-n/e.controlsFadeLength,r=Math.min(1,r),r=Math.max(0,r),o=e.controls.length-1;o>=0;o--)e.controls[o].autoFade&&e.controls[o].setOpacity(r);r>0&&s(e)}}function h(t){var e;for(t.controlsShouldFade=!1,e=t.controls.length-1;e>=0;e--)t.controls[e].setOpacity(1)}function u(){h(this)}function c(){a(this)}function d(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),
this.viewport.applyConstraints(),!1;case 40:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints(),!1;case 37:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints(),!1;case 39:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function f(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints(),!1;case 115:case 83:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints(),!1;case 97:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints(),!1;case 100:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function p(t){var e;document.activeElement==this.canvas||this.canvas.focus();var i={tracker:t.eventSource,position:t.position,quick:t.quick,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&t.quick&&(e=this.gestureSettingsByDeviceType(t.pointerType),e.clickToZoom&&(this.viewport.zoomBy(t.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(t.position,!0)),this.viewport.applyConstraints()))}function g(t){var e;!t.preventDefaultAction&&this.viewport&&(e=this.gestureSettingsByDeviceType(t.pointerType),e.dblClickToZoom&&(this.viewport.zoomBy(t.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(t.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-double-click",{tracker:t.eventSource,position:t.position,shift:t.shift,originalEvent:t.originalEvent})}function m(t){var e,i={tracker:t.eventSource,position:t.position,delta:t.delta,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction};if(this.raiseEvent("canvas-drag",i),!t.preventDefaultAction&&this.viewport){if(e=this.gestureSettingsByDeviceType(t.pointerType),this.panHorizontal||(t.delta.x=0),this.panVertical||(t.delta.y=0),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(t.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var r=this.viewport.getBounds(),o=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,r.x!=o.x&&(t.delta.x=0),r.y!=o.y&&(t.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(t.delta.negate()),e.flickEnabled&&!this.constrainDuringPan)}}function v(e){if(!e.preventDefaultAction&&this.viewport){var i=this.gestureSettingsByDeviceType(e.pointerType);if(i.flickEnabled&&e.speed>=i.flickMinSpeed){var n=0;this.panHorizontal&&(n=i.flickMomentum*e.speed*Math.cos(e.direction));var r=0;this.panVertical&&(r=i.flickMomentum*e.speed*Math.sin(e.direction));var o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),s=this.viewport.pointFromPixel(new t.Point(o.x-n,o.y-r));this.viewport.panTo(s,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:e.eventSource,position:e.position,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent})}function y(t){this.raiseEvent("canvas-enter",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function w(e){window.location!=window.parent.location&&t.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function _(t){this.raiseEvent("canvas-press",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,insideElementPressed:t.insideElementPressed,insideElementReleased:t.insideElementReleased,originalEvent:t.originalEvent})}function x(t){this.raiseEvent("canvas-release",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,insideElementPressed:t.insideElementPressed,insideElementReleased:t.insideElementReleased,originalEvent:t.originalEvent})}function b(t){this.raiseEvent("canvas-nonprimary-press",{tracker:t.eventSource,position:t.position,pointerType:t.pointerType,button:t.button,buttons:t.buttons,originalEvent:t.originalEvent})}function S(t){this.raiseEvent("canvas-nonprimary-release",{tracker:t.eventSource,position:t.position,pointerType:t.pointerType,button:t.button,buttons:t.buttons,originalEvent:t.originalEvent})}function T(t){var e,i,n,r;if(!t.preventDefaultAction&&this.viewport&&(e=this.gestureSettingsByDeviceType(t.pointerType),e.pinchToZoom&&(i=this.viewport.pointFromPixel(t.center,!0),n=this.viewport.pointFromPixel(t.lastCenter,!0),r=n.minus(i),this.panHorizontal||(r.x=0),this.panVertical||(r.y=0),this.viewport.zoomBy(t.distance/t.lastDistance,i,!0),this.viewport.panBy(r,!0),this.viewport.applyConstraints()),e.pinchRotate)){var o=Math.atan2(t.gesturePoints[0].currentPos.y-t.gesturePoints[1].currentPos.y,t.gesturePoints[0].currentPos.x-t.gesturePoints[1].currentPos.x),s=Math.atan2(t.gesturePoints[0].lastPos.y-t.gesturePoints[1].lastPos.y,t.gesturePoints[0].lastPos.x-t.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(o-s)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:t.eventSource,gesturePoints:t.gesturePoints,lastCenter:t.lastCenter,center:t.center,lastDistance:t.lastDistance,distance:t.distance,shift:t.shift,originalEvent:t.originalEvent}),!1}function C(e){var i,n,r;if(r=t.now(),r-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=r,!e.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(e.pointerType),i.scrollToZoom&&(n=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(n,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),i&&i.scrollToZoom)return!1}else if((i=this.gestureSettingsByDeviceType(e.pointerType))&&i.scrollToZoom)return!1}function P(t){U[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:t.eventSource,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function E(t){t.pointers<1&&(U[this.hash].mouseInside=!1,U[this.hash].animating||a(this)),this.raiseEvent("container-exit",{tracker:t.eventSource,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function k(t){O(t),t.isOpen()?t._updateRequestId=o(t,k):t._updateRequestId=!1}function O(t){if(!t._opening){if(t.autoResize){var i=e(t.container),n=U[t.hash].prevContainerSize;if(!i.equals(n)){var r=t.viewport;if(t.preserveImageSizeOnResize){var o=n.x/i.x,s=r.getZoom()*o,l=r.getCenter();r.resize(i,!1),r.zoomTo(s,null,!0),r.panTo(l,!0)}else{var u=r.getBounds();r.resize(i,!0),r.fitBoundsWithConstraints(u,!0)}U[t.hash].prevContainerSize=i,U[t.hash].forceRedraw=!0}}var c=t.viewport.update(),d=t.world.update()||c;c&&t.raiseEvent("viewport-change"),t.referenceStrip&&(d=t.referenceStrip.update(t.viewport)||d),!U[t.hash].animating&&d&&(t.raiseEvent("animation-start"),h(t)),(d||U[t.hash].forceRedraw||t.world.needsDraw())&&(M(t),t._drawOverlays(),t.navigator&&t.navigator.update(t.viewport),U[t.hash].forceRedraw=!1,d&&t.raiseEvent("animation")),U[t.hash].animating&&!d&&(t.raiseEvent("animation-finish"),U[t.hash].mouseInside||a(t)),U[t.hash].animating=d}}function M(t){t.imageLoader.clear(),t.drawer.clear(),t.world.draw(),t.raiseEvent("update-viewport",{})}function R(t,e){return t?t+e:e}function I(){U[this.hash].lastZoomTime=t.now(),U[this.hash].zoomFactor=this.zoomPerSecond,U[this.hash].zooming=!0,A(this)}function L(){U[this.hash].lastZoomTime=t.now(),U[this.hash].zoomFactor=1/this.zoomPerSecond,U[this.hash].zooming=!0,A(this)}function N(){U[this.hash].zooming=!1}function A(e){t.requestAnimationFrame(t.delegate(e,D))}function D(){var e,i,n;U[this.hash].zooming&&this.viewport&&(e=t.now(),i=e-U[this.hash].lastZoomTime,n=Math.pow(U[this.hash].zoomFactor,i/1e3),this.viewport.zoomBy(n),this.viewport.applyConstraints(),U[this.hash].lastZoomTime=e,A(this))}function z(){this.viewport&&(U[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function H(){this.viewport&&(U[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function B(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function F(){this.viewport&&this.viewport.goHome()}function $(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function j(){if(this.viewport){var t=this.viewport.getRotation();0===t?t=270:t-=90,this.viewport.setRotation(t)}}function W(){if(this.viewport){var t=this.viewport.getRotation();270===t?t=0:t+=90,this.viewport.setRotation(t)}}function q(){var t=this._sequenceIndex-1;this.navPrevNextWrap&&t<0&&(t+=this.tileSources.length),this.goToPage(t)}function V(){var t=this._sequenceIndex+1;this.navPrevNextWrap&&t>=this.tileSources.length&&(t=0),this.goToPage(t)}var U={},G=1;t.Viewer=function(i){var n,r=arguments,s=this;if(t.isPlainObject(i)||(i={id:r[0],xmlPath:r.length>1?r[1]:undefined,prefixUrl:r.length>2?r[2]:undefined,controls:r.length>3?r[3]:undefined,overlays:r.length>4?r[4]:undefined}),i.config&&(t.extend(!0,i,i.config),delete i.config),t.extend(!0,this,{id:i.id,hash:i.hash||G++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},t.DEFAULT_SETTINGS,i),"undefined"==typeof this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for("undefined"!=typeof U[this.hash]&&t.console.warn("Hash "+this.hash+" has already been used."),U[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(e){var i=t.getString("Errors.OpenFailed",e.eventSource,e.message);s._showMessage(i)}),t.ControlDock.call(this,i),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(t){t.width="100%",t.height="100%",t.overflow="hidden",t.position="absolute",t.top="0px",t.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),""!==i.tabIndex&&(this.canvas.tabIndex=i.tabIndex===undefined?0:i.tabIndex),this.container.className="openseadragon-container",function(t){t.width="100%",t.height="100%",t.position="relative",t.overflow="hidden",t.left="0px",t.top="0px",t.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:t.delegate(this,d),keyHandler:t.delegate(this,f),clickHandler:t.delegate(this,p),dblClickHandler:t.delegate(this,g),dragHandler:t.delegate(this,m),dragEndHandler:t.delegate(this,v),enterHandler:t.delegate(this,y),exitHandler:t.delegate(this,w),pressHandler:t.delegate(this,_),releaseHandler:t.delegate(this,x),nonPrimaryPressHandler:t.delegate(this,b),nonPrimaryReleaseHandler:t.delegate(this,S),scrollHandler:t.delegate(this,C),pinchHandler:t.delegate(this,T)}),this.outerTracker=new t.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,P),exitHandler:t.delegate(this,E)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),U[this.hash].prevContainerSize=e(this.container),this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(){s.source=s.world.getItemAt(0).source,U[s.hash].forceRedraw=!0,s._updateRequestId||(s._updateRequestId=o(s,k))}),this.world.addHandler("remove-item",function(){s.world.getItemCount()?s.source=s.world.getItemAt(0).source:s.source=null,U[s.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(){s.viewport&&s.viewport._setContentBounds(s.world.getHomeBounds(),s.world.getContentFactor())}),this.world.addHandler("item-index-change",function(){s.source=s.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:U[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:i.timeout}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(n=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(n,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(n=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(n,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new t.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),n=0;n<this.customControls.length;n++)this.addControl(this.customControls[n].id,{anchor:this.customControls[n].anchor});t.requestAnimationFrame(function(){a(s)})},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(e){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(e)},openTileSource:function(e){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(e)},open:function(e,i){var r=this;if(this.close(),e){if(this.sequenceMode&&t.isArray(e))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===i||isNaN(i)||(this.initialPage=i),this.tileSources=e,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(t.isArray(e)||(e=[e]),e.length){this._opening=!0;for(var o,s=e.length,a=0,l=0,h=function(){if(a+l===s)if(a){!r._firstOpen&&r.preserveViewport||(r.viewport.goHome(!0),r.viewport.update()),r._firstOpen=!1;var t=e[0];if(t.tileSource&&(t=t.tileSource),r.overlays&&!r.preserveOverlays)for(var i=0;i<r.overlays.length;i++)r.currentOverlays[i]=n(r,r.overlays[i]);r._drawOverlays(),r._opening=!1,r.raiseEvent("open",{source:t})}else r._opening=!1,r.raiseEvent("open-failed",o)},u=function(e){t.isPlainObject(e)&&e.tileSource||(e={tileSource:e}),e.index!==undefined&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete e.index),e.collectionImmediately===undefined&&(e.collectionImmediately=!0);var i=e.success;e.success=function(t){if(a++,e.tileSource.overlays)for(var n=0;n<e.tileSource.overlays.length;n++)r.addOverlay(e.tileSource.overlays[n]);i&&i(t),h()};var n=e.error;e.error=function(t){l++,o||(o=t),n&&n(t),h()},r.addTiledImage(e)},c=0;c<e.length;c++)u(e[c]);return this}}},close:function(){return U[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),U[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(U[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),U[this.hash]=null,delete U[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(t){return this.innerTracker.setTracking(t),this.outerTracker.setTracking(t),this.raiseEvent("mouse-enabled",{enabled:t}),this},areControlsEnabled:function(){var t,e=this.controls.length;for(t=0;t<this.controls.length;t++)e=e&&this.controls[t].isVisibile();return e},setControlsEnabled:function(t){return t?h(this):a(this),this.raiseEvent("controls-enabled",{enabled:t}),this},setDebugMode:function(t){for(var e=0;e<this.world.getItemCount();e++)this.world.getItemAt(e).debugMode=t;this.debugMode=t,this.forceRedraw()},isFullPage:function(){return U[this.hash].fullPage},setFullPage:function(e){var i,n,r=document.body,o=r.style,s=document.documentElement.style,a=this;if(e==this.isFullPage())return this;var l={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",l),l.preventDefaultAction)return this;if(e){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=s.margin,o.margin="0",s.margin="0",this.bodyPadding=o.padding,this.docPadding=s.padding,o.padding="0",s.padding="0",this.bodyWidth=o.width,this.docWidth=s.width,o.width="100%",s.width="100%",this.bodyHeight=o.height,this.docHeight=s.height,o.height="100%",s.height="100%",this.previousBody=[],U[this.hash].prevElementParent=this.element.parentNode,U[this.hash].prevNextSibling=this.element.nextSibling,U[this.hash].prevElementWidth=this.element.style.width,U[this.hash].prevElementHeight=this.element.style.height,i=r.childNodes.length,n=0;n<i;n++)this.previousBody.push(r.childNodes[0]),r.removeChild(r.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,r.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),r.appendChild(this.element),this.element.style.height=t.getWindowSize().y+"px",this.element.style.width=t.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),U[this.hash].fullPage=!0,t.delegate(this,P)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,s.margin=this.docMargin,o.padding=this.bodyPadding,s.padding=this.docPadding,o.width=this.bodyWidth,s.width=this.docWidth,o.height=this.bodyHeight,s.height=this.docHeight,r.removeChild(this.element),i=this.previousBody.length,n=0;n<i;n++)r.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),U[this.hash].prevElementParent.insertBefore(this.element,U[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(r.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=U[this.hash].prevElementWidth,this.element.style.height=U[this.hash].prevElementHeight;var h=0,u=function(){t.setPageScroll(a.pageScroll);var e=t.getPageScroll();++h<10&&(e.x!==a.pageScroll.x||e.y!==a.pageScroll.y)&&t.requestAnimationFrame(u)};t.requestAnimationFrame(u),U[this.hash].fullPage=!1,t.delegate(this,E)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e}),this},setFullScreen:function(e){var i=this;if(!t.supportsFullScreen)return this.setFullPage(e);if(t.isFullScreen()===e)return this;var n={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var r=function(){var e=t.isFullScreen();e||(t.removeEvent(document,t.fullScreenEventName,r),t.removeEvent(document,t.fullScreenErrorEventName,r),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&i.navigator.update(i.viewport),i.raiseEvent("full-screen",{fullScreen:e})};t.addEvent(document,t.fullScreenEventName,r),t.addEvent(document,t.fullScreenErrorEventName,r),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(t){return this.container.style.visibility=t?"":"hidden",this.raiseEvent("visible",{visible:t}),this},addTiledImage:function(e){function n(t){for(var i=0;i<s._loadQueue.length;i++)if(s._loadQueue[i]===a){s._loadQueue.splice(i,1);break}0===s._loadQueue.length&&r(a),s.raiseEvent("add-item-failed",t),e.error&&e.error(t)}function r(t){s.collectionMode&&(s.world.arrange({immediately:t.options.collectionImmediately,rows:s.collectionRows,columns:s.collectionColumns,layout:s.collectionLayout,tileSize:s.collectionTileSize,tileMargin:s.collectionTileMargin}),s.world.setAutoRefigureSizes(!0))}function o(){for(var e,i,n;s._loadQueue.length&&(e=s._loadQueue[0],e.tileSource);){if(s._loadQueue.splice(0,1),e.options.replace){var o=s.world.getIndexOfItem(e.options.replaceItem);-1!=o&&(e.options.index=o),s.world.removeItem(e.options.replaceItem)}i=new t.TiledImage({viewer:s,source:e.tileSource,viewport:s.viewport,drawer:s.drawer,tileCache:s.tileCache,imageLoader:s.imageLoader,x:e.options.x,y:e.options.y,width:e.options.width,height:e.options.height,fitBounds:e.options.fitBounds,fitBoundsPlacement:e.options.fitBoundsPlacement,clip:e.options.clip,placeholderFillStyle:e.options.placeholderFillStyle,opacity:e.options.opacity,preload:e.options.preload,degrees:e.options.degrees,compositeOperation:e.options.compositeOperation,springStiffness:s.springStiffness,animationTime:s.animationTime,minZoomImageRatio:s.minZoomImageRatio,wrapHorizontal:s.wrapHorizontal,wrapVertical:s.wrapVertical,immediateRender:s.immediateRender,blendTime:s.blendTime,alwaysBlend:s.alwaysBlend,minPixelRatio:s.minPixelRatio,smoothTileEdgesMinZoom:s.smoothTileEdgesMinZoom,iOSDevice:s.iOSDevice,crossOriginPolicy:e.options.crossOriginPolicy,ajaxWithCredentials:e.options.ajaxWithCredentials,loadTilesWithAjax:e.options.loadTilesWithAjax,ajaxHeaders:e.options.ajaxHeaders,debugMode:s.debugMode}),s.collectionMode&&s.world.setAutoRefigureSizes(!1),s.world.addItem(i,{index:e.options.index}),0===s._loadQueue.length&&r(e),1!==s.world.getItemCount()||s.preserveViewport||s.viewport.goHome(!0),s.navigator&&(n=t.extend({},e.options,{replace:!1,originalTiledImage:i,tileSource:e.tileSource}),s.navigator.addTiledImage(n)),e.options.success&&e.options.success({item:i})}}t.console.assert(e,"[Viewer.addTiledImage] options is required"),t.console.assert(e.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!e.replace||e.index>-1&&e.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var s=this;e.replace&&(e.replaceItem=s.world.getItemAt(e.index)),this._hideMessage(),e.placeholderFillStyle===undefined&&(e.placeholderFillStyle=this.placeholderFillStyle),e.opacity===undefined&&(e.opacity=this.opacity),e.preload===undefined&&(e.preload=this.preload),e.compositeOperation===undefined&&(e.compositeOperation=this.compositeOperation),e.crossOriginPolicy===undefined&&(e.crossOriginPolicy=e.tileSource.crossOriginPolicy!==undefined?e.tileSource.crossOriginPolicy:this.crossOriginPolicy),e.ajaxWithCredentials===undefined&&(e.ajaxWithCredentials=this.ajaxWithCredentials),e.loadTilesWithAjax===undefined&&(e.loadTilesWithAjax=this.loadTilesWithAjax),e.ajaxHeaders===undefined||null===e.ajaxHeaders?e.ajaxHeaders=this.ajaxHeaders:t.isPlainObject(e.ajaxHeaders)&&t.isPlainObject(this.ajaxHeaders)&&(e.ajaxHeaders=t.extend({},this.ajaxHeaders,e.ajaxHeaders));var a={options:e};if(t.isArray(e.tileSource))return void setTimeout(function(){n({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:e.tileSource,options:e})});this._loadQueue.push(a),i(this,e.tileSource,e,function(t){a.tileSource=t,o()},function(t){t.options=e,n(t),o()})},addSimpleImage:function(e){t.console.assert(e,"[Viewer.addSimpleImage] options is required"),t.console.assert(e.url,"[Viewer.addSimpleImage] options.url is required");var i=t.extend({},e,{tileSource:{type:"image",url:e.url}});delete i.url,this.addTiledImage(i)},addLayer:function(e){var i=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var n=t.extend({},e,{success:function(t){i.raiseEvent("add-layer",{options:e,drawer:t.item})},error:function(t){i.raiseEvent("add-layer-failed",t)}});return this.addTiledImage(n),this},getLayerAtLevel:function(e){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(e)},getLevelOfLayer:function(e){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(e)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(e,i){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(e,i)},removeLayer:function(e){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(e)},forceRedraw:function(){return U[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var e=t.delegate(this,u),i=t.delegate(this,c),n=t.delegate(this,V),r=t.delegate(this,q),o=this.navImages,s=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(s=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:R(this.prefixUrl,o.previous.REST),srcGroup:R(this.prefixUrl,o.previous.GROUP),srcHover:R(this.prefixUrl,o.previous.HOVER),srcDown:R(this.prefixUrl,o.previous.DOWN),onRelease:r,onFocus:e,onBlur:i}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:R(this.prefixUrl,o.next.REST),srcGroup:R(this.prefixUrl,o.next.GROUP),srcHover:R(this.prefixUrl,o.next.HOVER),srcDown:R(this.prefixUrl,o.next.DOWN),onRelease:n,onFocus:e,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),s&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=t.delegate(this,I),i=t.delegate(this,N),n=t.delegate(this,z),r=t.delegate(this,L),o=t.delegate(this,H),s=t.delegate(this,F),a=t.delegate(this,$),l=t.delegate(this,j),h=t.delegate(this,W),d=t.delegate(this,u),f=t.delegate(this,c),p=this.navImages,g=[],m=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(m=!1),this.showZoomControl&&(g.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:R(this.prefixUrl,p.zoomIn.REST),srcGroup:R(this.prefixUrl,p.zoomIn.GROUP),srcHover:R(this.prefixUrl,p.zoomIn.HOVER),srcDown:R(this.prefixUrl,p.zoomIn.DOWN),onPress:e,onRelease:i,onClick:n,onEnter:e,onExit:i,onFocus:d,onBlur:f})),g.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:R(this.prefixUrl,p.zoomOut.REST),srcGroup:R(this.prefixUrl,p.zoomOut.GROUP),srcHover:R(this.prefixUrl,p.zoomOut.HOVER),srcDown:R(this.prefixUrl,p.zoomOut.DOWN),onPress:r,onRelease:i,onClick:o,onEnter:r,onExit:i,onFocus:d,onBlur:f}))),this.showHomeControl&&g.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:R(this.prefixUrl,p.home.REST),srcGroup:R(this.prefixUrl,p.home.GROUP),srcHover:R(this.prefixUrl,p.home.HOVER),
srcDown:R(this.prefixUrl,p.home.DOWN),onRelease:s,onFocus:d,onBlur:f})),this.showFullPageControl&&g.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:R(this.prefixUrl,p.fullpage.REST),srcGroup:R(this.prefixUrl,p.fullpage.GROUP),srcHover:R(this.prefixUrl,p.fullpage.HOVER),srcDown:R(this.prefixUrl,p.fullpage.DOWN),onRelease:a,onFocus:d,onBlur:f})),this.showRotationControl&&(g.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:R(this.prefixUrl,p.rotateleft.REST),srcGroup:R(this.prefixUrl,p.rotateleft.GROUP),srcHover:R(this.prefixUrl,p.rotateleft.HOVER),srcDown:R(this.prefixUrl,p.rotateleft.DOWN),onRelease:l,onFocus:d,onBlur:f})),g.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:R(this.prefixUrl,p.rotateright.REST),srcGroup:R(this.prefixUrl,p.rotateright.GROUP),srcHover:R(this.prefixUrl,p.rotateright.HOVER),srcDown:R(this.prefixUrl,p.rotateright.DOWN),onRelease:h,onFocus:d,onBlur:f}))),m&&(this.buttons=new t.ButtonGroup({buttons:g,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",t.delegate(this,B)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(t){return this.tileSources&&t>=0&&t<this.tileSources.length&&(this.raiseEvent("page",{page:t}),this._sequenceIndex=t,this._updateSequenceButtons(t),this.open(this.tileSources[t]),this.referenceStrip&&this.referenceStrip.setFocus(t)),this},addOverlay:function(e,i,o,s){var a;if(a=t.isPlainObject(e)?e:{element:e,location:i,placement:o,onDraw:s},e=t.getElement(a.element),r(this.currentOverlays,e)>=0)return this;var l=n(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:e,location:a.location,placement:a.placement}),this},updateOverlay:function(e,i,n){var o;return e=t.getElement(e),o=r(this.currentOverlays,e),o>=0&&(this.currentOverlays[o].update(i,n),U[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:i,placement:n})),this},removeOverlay:function(e){var i;return e=t.getElement(e),i=r(this.currentOverlays,e),i>=0&&(this.currentOverlays[i].destroy(),this.currentOverlays.splice(i,1),U[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return U[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(e){var i;return e=t.getElement(e),i=r(this.currentOverlays,e),i>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(t){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==t?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(t>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var i=t.makeNeutralElement("div");i.appendChild(document.createTextNode(e)),this.messageDiv=t.makeCenteredNode(i),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var t=this.messageDiv;t&&(t.parentNode.removeChild(t),delete this.messageDiv)},gestureSettingsByDeviceType:function(t){switch(t){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var t,e=this.currentOverlays.length;for(t=0;t<e;t++)this.currentOverlays[t].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(t){function e(t){t.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(t.position)),this.viewer.viewport.applyConstraints())}function i(t){this.viewer.viewport&&(this.panHorizontal||(t.delta.x=0),this.panVertical||(t.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(t.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(t){t.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function r(t){return this.viewer.raiseEvent("navigator-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),!1}function o(t,e){t.style.webkitTransform="rotate("+e+"deg)",t.style.mozTransform="rotate("+e+"deg)",t.style.msTransform="rotate("+e+"deg)",t.style.oTransform="rotate("+e+"deg)",t.style.transform="rotate("+e+"deg)"}t.Navigator=function(s){function a(t){o(c.displayRegionContainer,t),o(c.displayRegion,-t),c.viewport.setRotation(t)}var l,h,u=s.viewer,c=this;if(s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),s.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:s.autoFade},s.position&&("BOTTOM_RIGHT"==s.position?s.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==s.position?s.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==s.position?s.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==s.position?s.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:"ABSOLUTE"==s.position&&(s.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",s=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize,minZoomImageRatio:1}),s.minPixelRatio=this.minPixelRatio=u.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),s.controlOptions.anchor!=t.ControlAnchor.NONE&&function(t,e){t.margin="0px",t.border=e+"px solid #555",t.padding="0px",t.background="#000",t.opacity=.8,t.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(t,e){t.position="relative",t.top="0px",t.left="0px",t.fontSize="0px",t.overflow="hidden",t.border=e+"px solid #900",t.margin="0px",t.padding="0px",t.background="transparent",t["float"]="left",t.cssFloat="left",t.styleFloat="left",t.zIndex=999999999,t.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",u.addControl(this.element,s.controlOptions),this._resizeWithViewer=s.controlOptions.anchor!=t.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!=t.ControlAnchor.NONE,this._resizeWithViewer&&(s.width&&s.height?(this.element.style.height="number"==typeof s.height?s.height+"px":s.height,this.element.style.width="number"==typeof s.width?s.width+"px":s.width):(l=t.getElementSize(u.element),this.element.style.height=Math.round(l.y*s.sizeRatio)+"px",this.element.style.width=Math.round(l.x*s.sizeRatio)+"px",this.oldViewerSize=l),h=t.getElementSize(this.element),this.elementArea=h.x*h.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),s.navigatorRotate){a(s.viewer.viewport?s.viewer.viewport.getRotation():s.viewer.degrees||0),s.viewer.addHandler("rotate",function(t){a(t.degrees)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,i),clickHandler:t.delegate(this,e),releaseHandler:t.delegate(this,n),scrollHandler:t.delegate(this,r)}),this.addHandler("reset-size",function(){c.viewport&&c.viewport.goHome(!0)}),u.world.addHandler("item-index-change",function(t){window.setTimeout(function(){var e=c.world.getItemAt(t.previousIndex);c.world.setItemIndex(e,t.newIndex)},1)}),u.world.addHandler("remove-item",function(t){var e=t.item,i=c._getMatchingItem(e);i&&c.world.removeItem(i)}),this.update(u.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var e=new t.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);e.equals(this.oldContainerSize)||(this.viewport.resize(e,!0),this.viewport.goHome(!0),this.oldContainerSize=e,this.drawer.clear(),this.world.draw())}},update:function(e){var i,n,r,o,s,a;if(i=t.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(n=i.x*this.sizeRatio,r=i.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(i.x/i.y)),r=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(r)+"px",this.elementArea||(this.elementArea=n*r),this.updateSize()),e&&this.viewport){o=e.getBoundsNoRotate(!0),s=this.viewport.pixelFromPointNoRotate(o.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(o.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(s.y)+"px",l.left=Math.round(s.x)+"px";var h=Math.abs(s.x-a.x),u=Math.abs(s.y-a.y);l.width=Math.round(Math.max(h,0))+"px",l.height=Math.round(Math.max(u,0))+"px"}},addTiledImage:function(e){var i=this,n=e.originalTiledImage;delete e.original;var r=t.extend({},e,{success:function(t){function e(){i._matchBounds(s,n)}function r(){i._matchOpacity(s,n)}function o(){i._matchCompositeOperation(s,n)}var s=t.item;s._originalForNavigator=n,i._matchBounds(s,n,!0),n.addHandler("bounds-change",e),n.addHandler("clip-change",e),n.addHandler("opacity-change",r),n.addHandler("composite-operation-change",o)}});return t.Viewer.prototype.addTiledImage.apply(this,[r])},_getMatchingItem:function(t){for(var e,i=this.world.getItemCount(),n=0;n<i;n++)if(e=this.world.getItemAt(n),e._originalForNavigator===t)return e;return null},_matchBounds:function(t,e,i){var n=e.getBoundsNoRotate();t.setPosition(n.getTopLeft(),i),t.setWidth(n.width,i),t.setRotation(e.getRotation(),i),t.setClip(e.getClip())},_matchOpacity:function(t,e){t.setOpacity(e.opacity)},_matchCompositeOperation:function(t,e){t.setCompositeOperation(e.compositeOperation)}})}(OpenSeadragon),function(t){var e={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};t.extend(t,{getString:function(i){var n,r=i.split("."),o=null,s=arguments,a=e;for(n=0;n<r.length-1;n++)a=a[r[n]]||{};return o=a[r[n]],"string"!=typeof o&&(t.console.log("Untranslated source string:",i),o=""),o.replace(/\{\d+\}/g,function(t){var e=parseInt(t.match(/\d+/),10)+1;return e<s.length?s[e]:""})},setString:function(t,i){var n,r=t.split("."),o=e;for(n=0;n<r.length-1;n++)o[r[n]]||(o[r[n]]={}),o=o[r[n]];o[r[n]]=i}})}(OpenSeadragon),function(t){t.Point=function(t,e){this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(e){return new t.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new t.Point(this.x-e.x,this.y-e.y)},times:function(e){return new t.Point(this.x*e,this.y*e)},divide:function(e){return new t.Point(this.x/e,this.y/e)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},squaredDistanceTo:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},apply:function(e){return new t.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof t.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,i){i=i||new t.Point(0,0);var n,r;if(e%90==0){switch(t.positiveModulo(e,360)){case 0:n=1,r=0;break;case 90:n=0,r=1;break;case 180:n=-1,r=0;break;case 270:n=0,r=-1}}else{var o=e*Math.PI/180;n=Math.cos(o),r=Math.sin(o)}var s=n*(this.x-i.x)-r*(this.y-i.y)+i.x,a=r*(this.x-i.x)+n*(this.y-i.y)+i.y;return new t.Point(s,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(t){function e(e){var i,n,r=e.responseText,o=e.status;if(!e)throw new Error(t.getString("Errors.Security"));if(200!==e.status&&0!==e.status)throw o=e.status,i=404==o?"Not Found":e.statusText,new Error(t.getString("Errors.Status",o,i));if(r.match(/\s*<.*/))try{n=e.responseXML&&e.responseXML.documentElement?e.responseXML:t.parseXml(r)}catch(t){n=e.responseText}else if(r.match(/\s*[\{\[].*/))try{n=t.parseJSON(r)}catch(t){n=r}else n=r;return n}t.TileSource=function(e){var i,n,r=this,o=arguments;if(i=t.isPlainObject(e)?e:{width:o[0],height:o[1],tileSize:o[2],tileOverlap:o[3],minLevel:o[4],maxLevel:o[5]},t.EventSource.call(this),t.extend(!0,this,i),!this.success)for(n=0;n<arguments.length;n++)if(t.isFunction(arguments[n])){this.success=arguments[n];break}this.success&&this.addHandler("ready",function(t){r.success(t)}),"string"==t.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=i.width&&i.height?i.width/i.height:1,this.dimensions=new t.Point(i.width,i.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=i.tileOverlap?i.tileOverlap:0,this.minLevel=i.minLevel?i.minLevel:0,this.maxLevel=undefined!==i.maxLevel&&null!==i.maxLevel?i.maxLevel:i.width&&i.height?Math.ceil(Math.log(Math.max(i.width,i.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(){return t.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(t){return this._tileWidth?this._tileWidth:this.getTileSize(t)},getTileHeight:function(t){return this._tileHeight?this._tileHeight:this.getTileSize(t)},getLevelScale:function(t){var e,i={};for(e=0;e<=this.maxLevel;e++)i[e]=1/Math.pow(2,this.maxLevel-e);return this.getLevelScale=function(t){return i[t]},this.getLevelScale(t)},getNumTiles:function(e){var i=this.getLevelScale(e),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(e)),r=Math.ceil(i*this.dimensions.y/this.getTileHeight(e));return new t.Point(n,r)},getPixelRatio:function(e){var i=this.dimensions.times(this.getLevelScale(e)),n=1/i.x,r=1/i.y;return new t.Point(n,r)},getClosestLevel:function(){var t,e;for(t=this.minLevel+1;t<=this.maxLevel&&(e=this.getNumTiles(t),!(e.x>1||e.y>1));t++);return t-1},getTileAtPoint:function(e,i){var n=i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1/this.aspectRatio;t.console.assert(n,"[TileSource.getTileAtPoint] must be called with a valid point.");var r=this.dimensions.x*this.getLevelScale(e),o=i.x*r,s=i.y*r,a=Math.floor(o/this.getTileWidth(e)),l=Math.floor(s/this.getTileHeight(e));return i.x>=1&&(a=this.getNumTiles(e).x-1),i.y>=1/this.aspectRatio&&(l=this.getNumTiles(e).y-1),new t.Point(a,l)},getTileBounds:function(e,i,n){var r=this.dimensions.times(this.getLevelScale(e)),o=this.getTileWidth(e),s=this.getTileHeight(e),a=0===i?0:o*i-this.tileOverlap,l=0===n?0:s*n-this.tileOverlap,h=o+(0===i?1:2)*this.tileOverlap,u=s+(0===n?1:2)*this.tileOverlap,c=1/r.x;return h=Math.min(h,r.x-a),u=Math.min(u,r.y-l),new t.Rect(a*c,l*c,h*c,u*c)},getImageInfo:function(i){var n,r,o,s,a,l,h,u=this;i&&(a=i.split("/"),l=a[a.length-1],(h=l.lastIndexOf("."))>-1&&(a[a.length-1]=l.slice(0,h))),r=function(e){"string"==typeof e&&(e=t.parseXml(e));var n=t.TileSource.determineType(u,e,i);if(!n)return void u.raiseEvent("open-failed",{message:"Unable to load TileSource",source:i});s=n.prototype.configure.apply(u,[e,i]),s.ajaxWithCredentials===undefined&&(s.ajaxWithCredentials=u.ajaxWithCredentials),o=new n(s),u.ready=!0,u.raiseEvent("ready",{tileSource:o})},i.match(/\.js$/)?(n=i.split("/").pop().replace(".js",""),t.jsonp({url:i,async:!1,callbackName:n,callback:r})):t.makeAjaxRequest({url:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var i=e(t);r(i)},error:function(t,e){var n;try{n="HTTP "+t.status+" attempting to load TileSource"}catch(t){var r;r=void 0!==e&&e.toString?e.toString():"Unknown error",n=r+" attempting to load TileSource"}u.raiseEvent("open-failed",{message:n,source:i})}})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(){return{}},tileExists:function(t,e,i){var n=this.getNumTiles(t);return t>=this.minLevel&&t<=this.maxLevel&&e>=0&&i>=0&&e<n.x&&i<n.y}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype),t.TileSource.determineType=function(e,i,n){var r;for(r in OpenSeadragon)if(r.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[r])&&t.isFunction(OpenSeadragon[r].prototype.supports)&&OpenSeadragon[r].prototype.supports.call(e,i,n))return OpenSeadragon[r];t.console.error("No TileSource was able to open %s %s",n,i)}}(OpenSeadragon),function(t){function e(e,n){if(!n||!n.documentElement)throw new Error(t.getString("Errors.Xml"));var r,o,s,a,l,h=n.documentElement,u=h.localName||h.tagName,c=n.documentElement.namespaceURI,d=null,f=[];if("Image"==u)try{if(a=h.getElementsByTagName("Size")[0],a===undefined&&(a=h.getElementsByTagNameNS(c,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!t.imageFormatSupported(d.Image.Format))throw new Error(t.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(r=h.getElementsByTagName("DisplayRect"),r===undefined&&(r=h.getElementsByTagNameNS(c,"DisplayRect")[0]),l=0;l<r.length;l++)o=r[l],s=o.getElementsByTagName("Rect")[0],s===undefined&&(s=o.getElementsByTagNameNS(c,"Rect")[0]),f.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(o.getAttribute("MinLevel"),10),MaxLevel:parseInt(o.getAttribute("MaxLevel"),10)}});return f.length&&(d.Image.DisplayRect=f),i(e,d)}catch(e){throw e instanceof Error?e:new Error(t.getString("Errors.Dzi"))}else{if("Collection"==u)throw new Error(t.getString("Errors.Dzc"));if("Error"==u){var p=h.getElementsByTagName("Message")[0],g=p.firstChild.nodeValue;throw new Error(g)}}throw new Error(t.getString("Errors.Dzi"))}function i(e,i){var n,r,o=i.Image,s=o.Url,a=o.Format,l=o.Size,h=o.DisplayRect||[],u=parseInt(l.Width,10),c=parseInt(l.Height,10),d=parseInt(o.TileSize,10),f=parseInt(o.Overlap,10),p=[];for(r=0;r<h.length;r++)n=h[r].Rect,p.push(new t.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return t.extend(!0,{width:u,height:c,tileSize:d,tileOverlap:f,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:a,displayRects:p},i)}t.DziTileSource=function(e){var i,n,r,o;if(o=t.isPlainObject(e)?e:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=o.tilesUrl,this.fileFormat=o.fileFormat,this.displayRects=o.displayRects,this.displayRects)for(i=this.displayRects.length-1;i>=0;i--)for(n=this.displayRects[i],r=n.minLevel;r<=n.maxLevel;r++)this._levelRects[r]||(this._levelRects[r]=[]),this._levelRects[r].push(n);t.TileSource.apply(this,[o])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(t){var e;return t.Image?e=t.Image.xmlns:t.documentElement&&("Image"!=t.documentElement.localName&&"Image"!=t.documentElement.tagName||(e=t.documentElement.namespaceURI)),e=(e||"").toLowerCase(),-1!==e.indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==e.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(n,r){var o;return o=t.isPlainObject(n)?i(this,n):e(this,n),r&&!o.tilesUrl&&(o.tilesUrl=r.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=r.search(/\.(dzi|xml|js)\?/)?o.queryParams=r.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(t,e,i){return[this.tilesUrl,t,"/",e,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(t,e,i){var n,r,o,s,a,l,h,u=this._levelRects[t];if(!u||!u.length)return!0;for(h=u.length-1;h>=0;h--)if(n=u[h],!(t<n.minLevel||t>n.maxLevel)&&(r=this.getLevelScale(t),o=n.x*r,s=n.y*r,a=o+n.width*r,l=s+n.height*r,o=Math.floor(o/this._tileWidth),s=Math.floor(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),o<=e&&e<a&&s<=i&&i<l))return!0;return!1}})}(OpenSeadragon),function(t){function e(t){return!(-1!=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(t[0]))||-1!=t.indexOf("sizeByW")}function i(t){for(var e=[],i=0;i<t.sizes.length;i++)e.push({url:t["@id"]+"/full/"+t.sizes[i].width+",/0/default.jpg",width:t.sizes[i].width,height:t.sizes[i].height});return e.sort(function(t,e){return t.width-e.width})}function n(e){if(!e||!e.documentElement)throw new Error(t.getString("Errors.Xml"));var i=e.documentElement,n=i.tagName,o=null;if("info"==n)try{return o={},r(i,o),o}catch(e){throw e instanceof Error?e:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function r(e,i,n){var o,s;if(3==e.nodeType&&n)s=e.nodeValue.trim(),s.match(/^\d*$/)&&(s=Number(s)),i[n]?(t.isArray(i[n])||(i[n]=[i[n]]),i[n].push(s)):i[n]=s;else if(1==e.nodeType)for(o=0;o<e.childNodes.length;o++)r(e.childNodes[o],i,e.nodeName)}t.IIIFTileSource=function(n){if(t.extend(!0,this,n),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(n.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var r=0;r<this.tiles.length;r++)for(var o=0;o<this.tiles[r].scaleFactors.length;o++){var s=this.tiles[r].scaleFactors[o];this.scale_factors.push(s),n.tileSizePerScaleFactor[s]={width:this.tiles[r].width,height:this.tiles[r].height||this.tiles[r].width}}}else if(e(n.profile)){for(var a=Math.min(this.height,this.width),l=[256,512,1024],h=[],u=0;u<l.length;u++)l[u]<=a&&h.push(l[u]);h.length>0?n.tileSize=Math.max.apply(null,h):n.tileSize=a}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,n.levels=i(this),t.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):t.console.error("Nothing in the info.json to construct image pyramids from");n.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?n.maxLevel=Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),.5)):n.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),t.TileSource.apply(this,[n])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(t){return!(!t.protocol||"http://iiif.io/api/image"!=t.protocol)||(!(!t["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=t["@context"]&&"http://iiif.io/api/image/1/context.json"!=t["@context"])||(!(!t.profile||0!==t.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(t.identifier&&t.width&&t.height)||!(!t.documentElement||"info"!=t.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=t.documentElement.namespaceURI))))},configure:function(e,i){if(t.isPlainObject(e))return e["@context"]?e:(e["@context"]="http://iiif.io/api/image/1.0/context.json",e["@id"]=i.replace("/info.json",""),e);var r=n(e);return r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=i.replace("/info.xml",""),r},getTileWidth:function(e){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,e);var i=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(e){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,e);var i=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(e){if(this.emulateLegacyImagePyramid){var i=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].width/this.levels[this.maxLevel].width),i}return t.TileSource.prototype.getLevelScale.call(this,e)},getNumTiles:function(e){if(this.emulateLegacyImagePyramid){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)}return t.TileSource.prototype.getNumTiles.call(this,e)},getTileAtPoint:function(e,i){return this.emulateLegacyImagePyramid?new t.Point(0,0):t.TileSource.prototype.getTileAtPoint.call(this,e,i)},getTileUrl:function(t,e,i){if(this.emulateLegacyImagePyramid){var n=null;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(n=this.levels[t].url),n}var r,o,s,a,l,h,u,c,d,f,p,g="0",m=Math.pow(.5,this.maxLevel-t),v=Math.ceil(this.width*m),y=Math.ceil(this.height*m);return r=this.getTileWidth(t),o=this.getTileHeight(t),s=Math.ceil(r/m),a=Math.ceil(o/m),p=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1?"native.jpg":"default.jpg",v<r&&y<o?(f=v+",",l="full"):(h=e*s,u=i*a,c=Math.min(s,this.width-h),d=Math.min(a,this.height-u),f=Math.ceil(c*m)+",",l=[h,u,c,d].join(",")),[this["@id"],l,f,g,p].join("/")}})}(OpenSeadragon),function(t){t.OsmTileSource=function(e){var i;i=t.isPlainObject(e)?e:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},i.width&&i.height||(i.width=65572864,i.height=65572864),i.tileSize||(i.tileSize=256,i.tileOverlap=0),i.tilesUrl||(i.tilesUrl="http://tile.openstreetmap.org/"),i.minLevel=8,t.TileSource.apply(this,[i])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"openstreetmaps"==t.type},configure:function(t){return t},getTileUrl:function(t,e,i){return this.tilesUrl+(t-8)+"/"+e+"/"+i+".png"}})}(OpenSeadragon),function(t){t.TmsTileSource=function(e){var i;i=t.isPlainObject(e)?e:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var n,r=256*Math.ceil(i.width/256),o=256*Math.ceil(i.height/256);n=r>o?r/256:o/256,i.maxLevel=Math.ceil(Math.log(n)/Math.log(2))-1,i.tileSize=256,i.width=r,i.height=o,t.TileSource.apply(this,[i])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"tiledmapservice"==t.type},configure:function(t){return t},getTileUrl:function(t,e,i){var n=this.getNumTiles(t).y-1;return this.tilesUrl+t+"/"+e+"/"+(n-i)+".png"}})}(OpenSeadragon),function(t){t.ZoomifyTileSource=function(t){t.tileSize=256;var e={x:t.width,y:t.height};for(t.imageSizes=[{x:t.width,y:t.height}],t.gridSize=[this._getGridSize(t.width,t.height,t.tileSize)];parseInt(e.x,10)>t.tileSize||parseInt(e.y,10)>t.tileSize;)e.x=Math.floor(e.x/2),e.y=Math.floor(e.y/2),t.imageSizes.push({x:e.x,y:e.y}),t.gridSize.push(this._getGridSize(e.x,e.y,t.tileSize));t.imageSizes.reverse(),t.gridSize.reverse(),t.minLevel=0,t.maxLevel=t.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[t])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(t,e,i){return{x:Math.ceil(t/i),y:Math.ceil(e/i)}},_calculateAbsoluteTileNumber:function(t,e,i){for(var n=0,r={},o=0;o<t;o++)r=this.gridSize[o],n+=r.x*r.y;return r=this.gridSize[t],n+=r.x*i+e},supports:function(t){return t.type&&"zoomifytileservice"==t.type},configure:function(t){return t},getTileUrl:function(t,e,i){var n=0,r=this._calculateAbsoluteTileNumber(t,e,i);return n=Math.floor(r/256),this.tilesUrl+"TileGroup"+n+"/"+t+"-"+e+"-"+i+".jpg"}})}(OpenSeadragon),function(t){function e(e){var i,n,r=[];for(n=0;n<e.length;n++)i=e[n],i.height&&i.width&&i.url?r.push({url:i.url,width:Number(i.width),height:Number(i.height)}):t.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return r.sort(function(t,e){return t.height-e.height})}function i(e,i){if(!i||!i.documentElement)throw new Error(t.getString("Errors.Xml"));var r,o,s=i.documentElement,a=s.tagName,l=null,h=[];if("image"==a)try{for(l={type:s.getAttribute("type"),levels:[]},h=s.getElementsByTagName("level"),o=0;o<h.length;o++)r=h[o],l.levels.push({url:r.getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return n(e,l)}catch(t){throw t instanceof Error?t:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+i)}throw new Error("Unknown element "+a)}function n(t,e){return e.levels}t.LegacyTileSource=function(i){var n,r,o;t.isArray(i)&&(n={type:"legacy-image-pyramid",levels:i}),n.levels=e(n.levels),n.levels.length>0?(r=n.levels[n.levels.length-1].width,o=n.levels[n.levels.length-1].height):(r=0,o=0,
t.console.error("No supported image formats found")),t.extend(!0,n,{width:r,height:o,tileSize:Math.max(o,r),tileOverlap:0,minLevel:0,maxLevel:n.levels.length>0?n.levels.length-1:0}),t.TileSource.apply(this,[n]),this.levels=n.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"legacy-image-pyramid"==t.type||t.documentElement&&"legacy-image-pyramid"==t.documentElement.getAttribute("type")},configure:function(e){return t.isPlainObject(e)?n(this,e):i(this,e)},getLevelScale:function(t){var e=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].width/this.levels[this.maxLevel].width),e},getNumTiles:function(e){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(t){var e=null;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].url),e}})}(OpenSeadragon),function(t){t.ImageTileSource=function(e){e=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),t.TileSource.apply(this,[e])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(t){return t.type&&"image"===t.type},configure:function(t){return t},getImageInfo:function(e){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),t.addEvent(i,"load",function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),t.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),i.src=e},getLevelScale:function(t){var e=NaN;return t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].width/this.levels[this.maxLevel].width),e},getNumTiles:function(e){return this.getLevelScale(e)?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(t){var e=null;return t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].url),e},getContext2D:function(t){var e=null;return t>=this.minLevel&&t<=this.maxLevel&&(e=this.levels[t].context2D),e},_buildLevels:function(){var e=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,e;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,r=document.createElement("canvas"),o=r.getContext("2d");if(r.width=i,r.height=n,o.drawImage(this._image,0,0,i,n),e[0].context2D=o,delete this._image,t.isCanvasTainted(r))return e;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var s=document.createElement("canvas"),a=s.getContext("2d");s.width=i,s.height=n,a.drawImage(r,0,0,i,n),e.splice(0,0,{context2D:a,width:i,height:n}),r=s,o=a}return e}})}(OpenSeadragon),function(t){t.TileSourceCollection=function(){t.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(t){function e(e){t.requestAnimationFrame(function(){i(e)})}function i(i){var n,r,o;i.shouldFade&&(n=t.now(),r=n-i.fadeBeginTime,o=1-r/i.fadeLength,o=Math.min(1,o),o=Math.max(0,o),i.imgGroup&&t.setElementOpacity(i.imgGroup,o,!0),o>0&&e(i))}function n(i){i.shouldFade=!0,i.fadeBeginTime=t.now()+i.fadeDelay,window.setTimeout(function(){e(i)},i.fadeDelay)}function r(e){e.shouldFade=!1,e.imgGroup&&t.setElementOpacity(e.imgGroup,1,!0)}function o(e,i){e.element.disabled||(i>=t.ButtonState.GROUP&&e.currentState==t.ButtonState.REST&&(r(e),e.currentState=t.ButtonState.GROUP),i>=t.ButtonState.HOVER&&e.currentState==t.ButtonState.GROUP&&(e.imgHover&&(e.imgHover.style.visibility=""),e.currentState=t.ButtonState.HOVER),i>=t.ButtonState.DOWN&&e.currentState==t.ButtonState.HOVER&&(e.imgDown&&(e.imgDown.style.visibility=""),e.currentState=t.ButtonState.DOWN))}function s(e,i){e.element.disabled||(i<=t.ButtonState.HOVER&&e.currentState==t.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=t.ButtonState.HOVER),i<=t.ButtonState.GROUP&&e.currentState==t.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=t.ButtonState.GROUP),i<=t.ButtonState.REST&&e.currentState==t.ButtonState.GROUP&&(n(e),e.currentState=t.ButtonState.REST))}t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(e){var i=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},e),this.element=e.element||t.makeNeutralElement("div"),e.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor==t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){e.insideElementPressed?(o(i,t.ButtonState.DOWN),i.raiseEvent("enter",{originalEvent:e.originalEvent})):e.buttonDownAny||o(i,t.ButtonState.HOVER)},focusHandler:function(t){this.enterHandler(t),i.raiseEvent("focus",{originalEvent:t.originalEvent})},exitHandler:function(e){s(i,t.ButtonState.GROUP),e.insideElementPressed&&i.raiseEvent("exit",{originalEvent:e.originalEvent})},blurHandler:function(t){this.exitHandler(t),i.raiseEvent("blur",{originalEvent:t.originalEvent})},pressHandler:function(e){o(i,t.ButtonState.DOWN),i.raiseEvent("press",{originalEvent:e.originalEvent})},releaseHandler:function(e){e.insideElementPressed&&e.insideElementReleased?(s(i,t.ButtonState.HOVER),i.raiseEvent("release",{originalEvent:e.originalEvent})):e.insideElementPressed?s(i,t.ButtonState.GROUP):o(i,t.ButtonState.HOVER)},clickHandler:function(t){t.quick&&i.raiseEvent("click",{originalEvent:t.originalEvent})},keyHandler:function(t){return 13!==t.keyCode||(i.raiseEvent("click",{originalEvent:t.originalEvent}),i.raiseEvent("release",{originalEvent:t.originalEvent}),!1)}}),s(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){o(this,t.ButtonState.GROUP)},notifyGroupExit:function(){s(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(t){t.ButtonGroup=function(e){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var i,n=this.buttons.concat([]),r=this;if(this.element=e.element||t.makeNeutralElement("div"),!e.group)for(this.label=t.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),i=0;i<n.length;i++)this.element.appendChild(n[i].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var t;for(t=0;t<r.buttons.length;t++)r.buttons[t].notifyGroupEnter()},exitHandler:function(t){var e;if(!t.insideElementPressed)for(e=0;e<r.buttons.length;e++)r.buttons[e].notifyGroupExit()}})},t.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(t){t.Rect=function(e,i,n,r,o){this.x="number"==typeof e?e:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof r?r:0,this.degrees="number"==typeof o?o:0,this.degrees=t.positiveModulo(this.degrees,360);var s,a;this.degrees>=270?(s=this.getTopRight(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(s=this.getBottomRight(),this.x=s.x,this.y=s.y,this.degrees-=180):this.degrees>=90&&(s=this.getBottomLeft(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},t.Rect.fromSummits=function(e,i,n){var r=e.distanceTo(i),o=e.distanceTo(n),s=i.minus(e),a=Math.atan(s.y/s.x);return s.x<0?a+=Math.PI:s.y<0&&(a+=2*Math.PI),new t.Rect(e.x,e.y,r,o,a/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(e){return e instanceof t.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new t.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new t.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var i=this.getBoundingBox(),n=e.getBoundingBox(),r=Math.min(i.x,n.x),o=Math.min(i.y,n.y),s=Math.max(i.x+i.width,n.x+n.width),a=Math.max(i.y+i.height,n.y+n.height);return new t.Rect(r,o,s-r,a-o)},intersection:function(e){function i(e,i,r,o){var s=i.minus(e),a=o.minus(r),l=-a.x*s.y+s.x*a.y;if(0===l)return null;var h=(s.x*(e.y-r.y)-s.y*(e.x-r.x))/l,u=(a.x*(e.y-r.y)-a.y*(e.x-r.x))/l;return-n<=h&&h<=1-n&&-n<=u&&u<=1-n?new t.Point(e.x+u*s.x,e.y+u*s.y):null}var n=1e-10,r=[],o=this.getTopLeft();e.containsPoint(o,n)&&r.push(o);var s=this.getTopRight();e.containsPoint(s,n)&&r.push(s);var a=this.getBottomLeft();e.containsPoint(a,n)&&r.push(a);var l=this.getBottomRight();e.containsPoint(l,n)&&r.push(l);var h=e.getTopLeft();this.containsPoint(h,n)&&r.push(h);var u=e.getTopRight();this.containsPoint(u,n)&&r.push(u);var c=e.getBottomLeft();this.containsPoint(c,n)&&r.push(c);var d=e.getBottomRight();this.containsPoint(d,n)&&r.push(d);for(var f=this._getSegments(),p=e._getSegments(),g=0;g<f.length;g++)for(var m=f[g],v=0;v<p.length;v++){var y=p[v],w=i(m[0],m[1],y[0],y[1]);w&&r.push(w)}if(0===r.length)return null;for(var _=r[0].x,x=r[0].x,b=r[0].y,S=r[0].y,T=1;T<r.length;T++){var C=r[T];C.x<_&&(_=C.x),C.x>x&&(x=C.x),C.y<b&&(b=C.y),C.y>S&&(S=C.y)}return new t.Rect(_,b,x-_,S-b)},_getSegments:function(){var t=this.getTopLeft(),e=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[t,e],[e,n],[n,i],[i,t]]},rotate:function(e,i){if(0===(e=t.positiveModulo(e,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(e,i),r=this.getTopRight().rotate(e,i),o=r.minus(n);o=o.apply(function(t){return Math.abs(t)<1e-15?0:t});var s=Math.atan(o.y/o.x);return o.x<0?s+=Math.PI:o.y<0&&(s+=2*Math.PI),new t.Rect(n.x,n.y,this.width,this.height,s/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),r=this.getBottomRight(),o=Math.min(e.x,i.x,n.x,r.x),s=Math.max(e.x,i.x,n.x,r.x),a=Math.min(e.y,i.y,n.y,r.y),l=Math.max(e.y,i.y,n.y,r.y);return new t.Rect(o,a,s-o,l-a)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),i=Math.floor(e.x),n=Math.floor(e.y),r=Math.ceil(e.width+e.x-i),o=Math.ceil(e.height+e.y-n);return new t.Rect(i,n,r,o)},containsPoint:function(t,e){e=e||0;var i=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),o=n.minus(i),s=r.minus(i);return(t.x-i.x)*o.x+(t.y-i.y)*o.y>=-e&&(t.x-n.x)*o.x+(t.y-n.y)*o.y<=e&&(t.x-i.x)*s.x+(t.y-i.y)*s.y>=-e&&(t.x-r.x)*s.x+(t.y-r.y)*s.y<=e},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(t){function e(e){var i=Number(this.element.style.marginLeft.replace("px","")),r=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=t.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-e.delta.x>0?i>-(o-a.x)&&(this.element.style.marginLeft=i+2*e.delta.x+"px",n(this,a.x,i+2*e.delta.x)):-e.delta.x<0&&i<0&&(this.element.style.marginLeft=i+2*e.delta.x+"px",n(this,a.x,i+2*e.delta.x)):-e.delta.y>0?r>-(s-a.y)&&(this.element.style.marginTop=r+2*e.delta.y+"px",n(this,a.y,r+2*e.delta.y)):-e.delta.y<0&&r<0&&(this.element.style.marginTop=r+2*e.delta.y+"px",n(this,a.y,r+2*e.delta.y))),!1}function i(e){var i=Number(this.element.style.marginLeft.replace("px","")),r=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=t.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?e.scroll>0?i>-(o-a.x)&&(this.element.style.marginLeft=i-60*e.scroll+"px",n(this,a.x,i-60*e.scroll)):e.scroll<0&&i<0&&(this.element.style.marginLeft=i-60*e.scroll+"px",n(this,a.x,i-60*e.scroll)):e.scroll<0?r>a.y-s&&(this.element.style.marginTop=r+60*e.scroll+"px",n(this,a.y,r+60*e.scroll)):e.scroll>0&&r<0&&(this.element.style.marginTop=r+60*e.scroll+"px",n(this,a.y,r+60*e.scroll))),!1}function n(e,i,n){var r,o,s,a,l,h,u;for(r="horizontal"==e.scroll?e.panelWidth:e.panelHeight,o=Math.ceil(i/r)+5,s=Math.ceil((Math.abs(n)+i)/r)+1,o=s-o,o=o<0?0:o,h=o;h<s&&h<e.panels.length;h++)if(u=e.panels[h],!u.activePanel){var c,d=e.viewer.tileSources[h];c=d.referenceStripThumbnailUrl?{type:"image",url:d.referenceStripThumbnailUrl}:d,a=new t.Viewer({id:u.id,tileSources:[c],element:u,navigatorSizeRatio:e.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),a.displayRegion=t.makeNeutralElement("div"),a.displayRegion.id=u.id+"-displayregion",a.displayRegion.className="displayregion",l=a.displayRegion.style,l.position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l["float"]="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=e.panelWidth-4+"px",l.height=e.panelHeight-4+"px",a.displayRegion.innerTracker=new t.MouseTracker({element:a.displayRegion,startDisabled:!0}),u.getElementsByTagName("div")[0].appendChild(a.displayRegion),e.miniViewers[u.id]=a,u.activePanel=!0}}function r(t){var e=t.eventSource.element;return"horizontal"==this.scroll?e.style.marginBottom="0px":e.style.marginLeft="0px",!1}function o(e){var i=e.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+t.getElementSize(i).y/2+"px":i.style.marginLeft="-"+t.getElementSize(i).x/2+"px",!1}function s(t){if(t.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function a(t){if(t.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 61:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}var l={};t.ReferenceStrip=function(h){var u,c,d,f=this,p=h.viewer,g=t.getElementSize(p.element);for(h.id||(h.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=h.id,this.element.className="referencestrip"),h=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},h,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),t.extend(this,h),l[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,c=this.element.style,c.marginTop="0px",c.marginRight="0px",c.marginBottom="0px",c.marginLeft="0px",c.left="0px",c.bottom="0px",c.border="0px",c.background="#000",c.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,e),scrollHandler:t.delegate(this,i),enterHandler:t.delegate(this,r),exitHandler:t.delegate(this,o),keyDownHandler:t.delegate(this,s),keyHandler:t.delegate(this,a)}),h.width&&h.height?(this.element.style.width=h.width+"px",this.element.style.height=h.height+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):"horizontal"==h.scroll?(this.element.style.width=g.x*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=g.y*h.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=g.y*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=g.x*h.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=g.x*this.sizeRatio+8,this.panelHeight=g.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<p.tileSources.length;d++)u=t.makeNeutralElement("div"),u.id=this.element.id+"-"+d,u.style.width=f.panelWidth+"px",u.style.height=f.panelHeight+"px",u.style.display="inline",u.style["float"]="left",u.style.cssFloat="left",u.style.styleFloat="left",u.style.padding="2px",t.setElementTouchActionNone(u),u.innerTracker=new t.MouseTracker({element:u,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(e){e.eventSource.dragging=t.now()},releaseHandler:function(e){var i=e.eventSource,n=i.element.id,r=Number(n.split("-")[2]),o=t.now();e.insideElementPressed&&e.insideElementReleased&&i.dragging&&o-i.dragging<i.clickTimeThreshold&&(i.dragging=null,p.goToPage(r))}}),this.element.appendChild(u),u.activePanel=!1,this.panels.push(u);n(this,"vertical"==this.scroll?g.y:g.x,0),this.setFocus(0)},t.extend(t.ReferenceStrip.prototype,t.EventSource.prototype,t.Viewer.prototype,{setFocus:function(e){var i,o=t.getElement(this.element.id+"-"+e),s=t.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),u=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==o&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=o,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(e)*(this.panelWidth+3),i>h+s.x-this.panelWidth?(i=Math.min(i,a-s.x),this.element.style.marginLeft=-i+"px",n(this,s.x,-i)):i<h&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",n(this,s.x,-i))):(i=Number(e)*(this.panelHeight+3),i>u+s.y-this.panelHeight?(i=Math.min(i,l-s.y),this.element.style.marginTop=-i+"px",n(this,s.y,-i)):i<u&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",n(this,s.y,-i))),this.currentPage=e,r.call(this,{eventSource:this.innerTracker}))},update:function(){return!!l[this.id].animating&&(t.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var t in this.miniViewers)this.miniViewers[t].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(t){t.DisplayRect=function(e,i,n,r,o,s){t.Rect.apply(this,[e,i,n,r]),this.minLevel=o,this.maxLevel=s},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(OpenSeadragon),function(t){function e(t,e){return(1-Math.exp(t*-e))/(1-Math.exp(-t))}t.Spring=function(e){var i=arguments;"object"!=typeof e&&(e={initial:i.length&&"number"==typeof i[0]?i[0]:undefined,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),t.console.assert("number"==typeof e.springStiffness&&0!==e.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert("number"==typeof e.animationTime&&e.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),e.exponential&&(this._exponential=!0,delete e.exponential),t.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(e){t.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(e){t.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(e){this.start.value+=e,this.target.value+=e,this._exponential&&(t.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(e){this._exponential=e,this._exponential&&(t.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var i,n;this._exponential?(i=this.start._logValue,n=this.target._logValue):(i=this.start.value,n=this.target.value);var r=this.current.time>=this.target.time?n:i+(n-i)*e(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(r):this.current.value=r,o!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(t){function e(e){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},e),this.image=null}function i(t,e,i){var n;t.jobsInProgress--,(!t.jobLimit||t.jobsInProgress<t.jobLimit)&&t.jobQueue.length>0&&(n=t.jobQueue.shift(),n.start(),t.jobsInProgress++),i(e.image,e.errorMsg,e.request)}e.prototype={errorMsg:null,start:function(){var e=this,i=this.abort;this.image=new Image,this.image.onload=function(){e.finish(!0)},this.image.onabort=this.image.onerror=function(){e.errorMsg="Image load aborted",e.finish(!1)},this.jobId=window.setTimeout(function(){e.errorMsg="Image load exceeded timeout",e.finish(!1)},this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(t){var i;try{i=new window.Blob([t.response])}catch(e){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===e.name&&n){var r=new n;r.append(t.response),i=r.getBlob()}}0===i.size&&(e.errorMsg="Empty image response.",e.finish(!1));var o=(window.URL||window.webkitURL).createObjectURL(i);e.image.src=o},error:function(){e.errorMsg="Image load aborted - XHR error",e.finish(!1)}}),this.abort=function(){e.request.abort(),"function"==typeof i&&i()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(t){this.image.onload=this.image.onerror=this.image.onabort=null,t||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(e){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},e)},t.ImageLoader.prototype={addJob:function(t){var n=this,r=function(e){i(n,e,t.callback)},o={src:t.src,loadWithAjax:t.loadWithAjax,ajaxHeaders:t.loadWithAjax?t.ajaxHeaders:null,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:r,abort:t.abort,timeout:this.timeout},s=new e(o);!this.jobLimit||this.jobsInProgress<this.jobLimit?(s.start(),this.jobsInProgress++):this.jobQueue.push(s)},clear:function(){for(var t=0;t<this.jobQueue.length;t++){var e=this.jobQueue[t];"function"==typeof e.abort&&e.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(t){t.Tile=function(t,e,i,n,r,o,s,a,l){this.level=t,this.x=e,this.y=i,this.bounds=n,this.exists=r,this.url=o,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){return this.cacheImageRecord?this.loaded?(this.element||(this.element=t.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=e&&e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",void t.setElementOpacity(this.element,this.opacity)):void t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):void t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(e,i,n,r){var o,s=this.position.times(t.pixelDensityRatio),a=this.size.times(t.pixelDensityRatio);return this.context2D||this.cacheImageRecord?(o=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&o?(e.save(),e.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(s=s.times(n),a=a.times(n)),r instanceof t.Point&&(s=s.plus(r)),1===e.globalAlpha&&this._hasTransparencyChannel()&&e.clearRect(s.x+1,s.y+1,a.x-2,a.y-2),i({context:e,tile:this,rendered:o}),e.drawImage(o.canvas,0,0,o.canvas.width,o.canvas.height,s.x,s.y,a.x,a.y),void e.restore()):void t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):void t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,i,n){var r=Math.max(1,Math.ceil((n.x-i.x)/2)),o=Math.max(1,Math.ceil((n.y-i.y)/2));return new t.Point(r,o).minus(this.position.times(t.pixelDensityRatio).times(e||1).apply(function(t){return t%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(e,i,n){var r;r=t.isPlainObject(e)?e:{element:e,location:i,placement:n},this.element=r.element,this.style=r.element.style,this._init(r)},t.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=e.placement===undefined?t.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=e.checkResize===undefined||e.checkResize,this.width=e.width===undefined?null:e.width,this.height=e.height===undefined?null:e.height,this.rotationMode=e.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,i){var n=t.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?e.x-=i.x/2:n.isRight&&(e.x-=i.x),n.isVerticallyCentered?e.y-=i.y/2:n.isBottom&&(e.y-=i.y))},destroy:function(){var e=this.element,i=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(i.display="none",document.body.appendChild(e))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="")
;var n=t.getCssPropertyWithVendorPrefix("transformOrigin"),r=t.getCssPropertyWithVendorPrefix("transform");n&&r&&(i[n]="",i[r]="")},drawHTML:function(e,i){var n=this.element;n.parentNode!==e&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,e.appendChild(n),this.style.position="absolute",this.size=t.getElementSize(n));var r=this._getOverlayPositionAndSize(i),o=r.position,s=this.size=r.size,a=r.rotate;if(this.onDraw)this.onDraw(o,s,this.element);else{var l=this.style;l.left=o.x+"px",l.top=o.y+"px",null!==this.width&&(l.width=s.x+"px"),null!==this.height&&(l.height=s.y+"px");var h=t.getCssPropertyWithVendorPrefix("transformOrigin"),u=t.getCssPropertyWithVendorPrefix("transform");h&&u&&(a?(l[h]=this._getTransformOrigin(),l[u]="rotate("+a+"deg)"):(l[h]="",l[u]="")),"none"!==l.display&&(l.display="block")}},_getOverlayPositionAndSize:function(e){var i=e.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(e);this.adjust(i,n);var r=0;if(e.degrees&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var o=new t.Rect(i.x,i.y,n.x,n.y),s=this._getBoundingBox(o,e.degrees);i=s.getTopLeft(),n=s.getSize()}else r=e.degrees;return{position:i,size:n,rotate:r}},_getSizeInPixels:function(e){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var r=e.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=r.x),null!==this.height&&(n=r.y)}if(this.checkResize&&(null===this.width||null===this.height)){var o=this.size=t.getElementSize(this.element);null===this.width&&(i=o.x),null===this.height&&(n=o.y)}return new t.Point(i,n)},_getBoundingBox:function(t,e){var i=this._getPlacementPoint(t);return t.rotate(e,i).getBoundingBox()},_getPlacementPoint:function(e){var i=new t.Point(e.x,e.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=e.width/2:n.isRight&&(i.x+=e.width),n.isVerticallyCentered?i.y+=e.height/2:n.isBottom&&(i.y+=e.height)),i},_getTransformOrigin:function(){var e="",i=t.Placement.properties[this.placement];return i?(i.isLeft?e="left":i.isRight&&(e="right"),i.isTop?e+=" top":i.isBottom&&(e+=" bottom"),e):e},update:function(e,i){var n=t.isPlainObject(e)?e:{location:e,placement:i};this._init({location:n.location||this.location,placement:n.placement!==undefined?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:n.width!==undefined?n.width:this.width,height:n.height!==undefined?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(e){t.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var r=e.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=r.x),null===n&&(n=r.y)}var o=this.location.clone();return this.adjust(o,new t.Point(i,n)),this._adjustBoundsForRotation(e,new t.Rect(o.x,o.y,i,n))},_adjustBoundsForRotation:function(e,i){if(!e||0===e.degrees||this.rotationMode===t.OverlayRotationMode.EXACT)return i;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new t.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-e.degrees,this._getPlacementPoint(i))}}}(OpenSeadragon),function(t){t.Drawer=function(e){t.console.assert(e.viewer,"[Drawer] options.viewer is required");var i=arguments;if(t.isPlainObject(e)||(e={source:i[0],viewport:i[1],element:i[2]}),t.console.assert(e.viewport,"[Drawer] options.viewport is required"),t.console.assert(e.element,"[Drawer] options.element is required"),e.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor=e.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,e.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=t.getElement(e.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},t.Drawer.prototype={addOverlay:function(e,i,n,r){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,i,n,r),this},updateOverlay:function(e,i,n){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,i,n),this},removeOverlay:function(e){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(e){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(e);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,i=0,n=0;n<e.getItemCount();n++){var r=e.getItemAt(n).getOpacity();r>i&&(i=r)}return i},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var t=this._calculateCanvasSize();if((this.canvas.width!=t.x||this.canvas.height!=t.y)&&(this.canvas.width=t.x,this.canvas.height=t.y,null!==this.sketchCanvas)){var e=this._calculateSketchCanvasSize();this.sketchCanvas.width=e.x,this.sketchCanvas.height=e.y}this._clear()}},_clear:function(t,e){if(this.useCanvas){var i=this._getContext(t);if(e)i.clearRect(e.x,e.y,e.width,e.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(e){var i=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new t.Rect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio)},drawTile:function(e,i,n,r,o){if(t.console.assert(e,"[Drawer.drawTile] tile is required"),t.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var s=this._getContext(n);r=r||1,e.drawCanvas(s,i,r,o)}else e.drawHTML(this.canvas)},_getContext:function(t){var e=this.context;if(t){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",function t(){if(0!==n.viewport.getRotation()){n.viewer.removeHandler("rotate",t);var e=n._calculateSketchCanvasSize();n.sketchCanvas.width=e.x,n.sketchCanvas.height=e.y}})}}e=this.sketchContext}return e},saveContext:function(t){this.useCanvas&&this._getContext(t).save()},restoreContext:function(t){this.useCanvas&&this._getContext(t).restore()},setClip:function(t,e){if(this.useCanvas){var i=this._getContext(e);i.beginPath(),i.rect(t.x,t.y,t.width,t.height),i.clip()}},drawRectangle:function(t,e,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=e,n.fillRect(t.x,t.y,t.width,t.height),n.restore()}},blendSketch:function(e,i,n,r){var o=e;if(t.isPlainObject(o)||(o={opacity:e,scale:i,translate:n,compositeOperation:r}),this.useCanvas&&this.sketchCanvas){e=o.opacity,r=o.compositeOperation;var s=o.bounds;if(this.context.save(),this.context.globalAlpha=e,r&&(this.context.globalCompositeOperation=r),s)s.x<0&&(s.width+=s.x,s.x=0),s.x+s.width>this.canvas.width&&(s.width=this.canvas.width-s.x),s.y<0&&(s.height+=s.y,s.y=0),s.y+s.height>this.canvas.height&&(s.height=this.canvas.height-s.y),this.context.drawImage(this.sketchCanvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height);else{i=o.scale||1,n=o.translate;var a=n instanceof t.Point?n:new t.Point(0,0),l=0,h=0;if(n){var u=this.sketchCanvas.width-this.canvas.width,c=this.sketchCanvas.height-this.canvas.height;l=Math.round(u/2),h=Math.round(c/2)}this.context.drawImage(this.sketchCanvas,a.x-l*i,a.y-h*i,(this.canvas.width+2*l)*i,(this.canvas.height+2*h)*i,-l,-h,this.canvas.width+2*l,this.canvas.height+2*h)}this.context.restore()}},drawDebugInfo:function(e,i,n,r){if(this.useCanvas){var o=this.context;o.save(),o.lineWidth=2*t.pixelDensityRatio,o.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor,o.fillStyle=this.debugGridColor,0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),r.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:r.getRotation(!0),point:r.viewport.pixelFromPointNoRotate(r._getRotationPoint(!0),!0)}),o.strokeRect(e.position.x*t.pixelDensityRatio,e.position.y*t.pixelDensityRatio,e.size.x*t.pixelDensityRatio,e.size.y*t.pixelDensityRatio);var s=(e.position.x+e.size.x/2)*t.pixelDensityRatio,a=(e.position.y+e.size.y/2)*t.pixelDensityRatio;o.translate(s,a),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-s,-a),0===e.x&&0===e.y&&(o.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*t.pixelDensityRatio,(e.position.y-30)*t.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*t.pixelDensityRatio,(e.position.y-20)*t.pixelDensityRatio)),o.fillText("Level: "+e.level,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+20)*t.pixelDensityRatio),o.fillText("Column: "+e.x,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+30)*t.pixelDensityRatio),o.fillText("Row: "+e.y,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+40)*t.pixelDensityRatio),o.fillText("Order: "+n+" of "+i,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+50)*t.pixelDensityRatio),o.fillText("Size: "+e.size.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+60)*t.pixelDensityRatio),o.fillText("Position: "+e.position.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+70)*t.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),r.getRotation(!0)%360!=0&&this._restoreRotationChanges(),o.restore()}},debugRect:function(e){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*t.pixelDensityRatio,i.strokeStyle=this.debugGridColor,i.fillStyle=this.debugGridColor,i.strokeRect(e.x*t.pixelDensityRatio,e.y*t.pixelDensityRatio,e.width*t.pixelDensityRatio,e.height*t.pixelDensityRatio),i.restore()}},getCanvasSize:function(e){var i=this._getContext(e).canvas;return new t.Point(i.width,i.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var i=e.point?e.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(e.useSketch);n.save(),n.translate(i.x,i.y),n.rotate(Math.PI/180*e.degrees),n.translate(-i.x,-i.y)},_restoreRotationChanges:function(t){this._getContext(t).restore()},_calculateCanvasSize:function(){var e=t.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:i.x*e,y:i.y*e}},_calculateSketchCanvasSize:function(){var t=this._calculateCanvasSize();if(0===this.viewport.getRotation())return t;var e=Math.ceil(Math.sqrt(t.x*t.x+t.y*t.y));return{x:e,y:e}}}}(OpenSeadragon),function(t){t.Viewport=function(e){var i=arguments;i.length&&i[0]instanceof t.Point&&(e={containerSize:i[0],contentSize:i[1],config:i[2]}),e.config&&(t.extend(!0,e,e.config),delete e.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,degrees:t.DEFAULT_SETTINGS.degrees,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer},e),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={resetContentSize:function(e){return t.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(e instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(e.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(e.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,i){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,i)},_setContentBounds:function(e,i){t.console.assert(e,"[Viewport._setContentBounds] bounds is required"),t.console.assert(e instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(e.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(e.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?t>=1?t:1:t>=1?1:t)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new t.Rect(e.x-i/2,e.y-n/2,i,n)},goHome:function(t){return this.viewer&&this.viewer.raiseEvent("home",{immediately:t}),this.fitBounds(this.getHomeBounds(),t)},getMinZoom:function(){var t=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*t},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),Math.max(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(e){t.console.assert("object"===t.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var i=this.getCenter(e),n=1/this.getZoom(e),r=n/this.getAspectRatio();return new t.Rect(i.x-n/2,i.y-r/2,n,r)},getBoundsWithMargins:function(t){return this.getBoundsNoRotateWithMargins(t).rotate(-this.getRotation(),this.getCenter(t))},getBoundsNoRotateWithMargins:function(t){var e=this.getBoundsNoRotate(t),i=this._containerInnerSize.x*this.getZoom(t);return e.x-=this._margins.left/i,e.y-=this._margins.top/i,e.width+=(this._margins.left+this._margins.right)/i,e.height+=(this._margins.top+this._margins.bottom)/i,e},getCenter:function(e){var i,n,r,o,s,a,l,h,u=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),c=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return e?u:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),n=this.getZoom(),r=1/n,o=r/this.getAspectRatio(),s=new t.Rect(u.x-r/2,u.y-o/2,r,o),a=this._pixelFromPoint(this.zoomPoint,s),l=a.minus(i),h=l.divide(this._containerInnerSize.x*n),c.plus(h)):c},getZoom:function(t){return t?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(t){return Math.max(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var i=new t.Rect(e.x,e.y,e.width,e.height);if(this.wrapHorizontal);else{var n=this.visibilityRatio*i.width,r=i.x+i.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,s=this._contentBoundsNoRotate.x-r+n,a=o-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(s+a)/2:a<0?i.x+=a:s>0&&(i.x+=s)}if(this.wrapVertical);else{var l=this.visibilityRatio*i.height,h=i.y+i.height,u=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,c=this._contentBoundsNoRotate.y-h+l,d=u-i.y-l;l>this._contentBoundsNoRotate.height?i.y+=(c+d)/2:d<0?i.y+=d:c>0&&(i.y+=c)}return i},_raiseConstraintsEvent:function(t){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:t})},applyConstraints:function(t){var e=this.getZoom(),i=this._applyZoomConstraints(e);e!==i&&this.zoomTo(i,this.zoomPoint,t);var n=this.getBoundsNoRotate(),r=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(t),(n.x!==r.x||n.y!==r.y||t)&&this.fitBounds(r.rotate(-this.getRotation()),t),this},ensureVisible:function(t){return this.applyConstraints(t)},_fitBounds:function(e,i){i=i||{};var n=i.immediately||!1,r=i.constraints||!1,o=this.getAspectRatio(),s=e.getCenter(),a=new t.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=o?a.height=a.width/o:a.width=a.height*o,a.x=s.x-a.width/2,a.y=s.y-a.height/2;var l=1/a.width;if(r){var h=a.getAspectRatio(),u=this._applyZoomConstraints(l);l!==u&&(l=u,a.width=1/l,a.x=s.x-a.width/2,a.height=a.width/h,a.y=s.y-a.height/2),a=this._applyBoundaryConstraints(a),s=a.getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(s,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var c=this.getBounds(),d=this.getZoom();if(0===d||Math.abs(l/d-1)<1e-8)return this.zoomTo(l,!0),this.panTo(s,n);a=a.rotate(-this.getRotation());var f=a.getTopLeft().times(l).minus(c.getTopLeft().times(d)).divide(l-d);return this.zoomTo(l,f,n)},fitBounds:function(t,e){return this._fitBounds(t,{immediately:e,constraints:!1})},fitBoundsWithConstraints:function(t,e){return this._fitBounds(t,{immediately:e,constraints:!0})},fitVertically:function(e){var i=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,e)},fitHorizontally:function(e){var i=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,e)},getConstrainedBounds:function(t){var e;return e=this.getBounds(t),this._applyBoundaryConstraints(e)},panBy:function(e,i){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(e),i)},panTo:function(t,e){return e?(this.centerSpringX.resetTo(t.x),this.centerSpringY.resetTo(t.y)):(this.centerSpringX.springTo(t.x),this.centerSpringY.springTo(t.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:t,immediately:e}),this},zoomBy:function(t,e,i){return this.zoomTo(this.zoomSpring.target.value*t,e,i)},zoomTo:function(e,i,n){var r=this;return this.zoomPoint=i instanceof t.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){r.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:i,immediately:n}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=t.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e}),this):this},getRotation:function(){return this.degrees},resize:function(t,e){var i,n=this.getBoundsNoRotate(),r=n;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),e&&(i=t.x/this.containerSize.x,r.width=n.width*i,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:e}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var t=this;this._adjustCenterSpringsForZoomPoint(function(){t.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var e=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,e},_adjustCenterSpringsForZoomPoint:function(t){if(this.zoomPoint){var e=this.pixelFromPoint(this.zoomPoint,!0);t();var i=this.pixelFromPoint(this.zoomPoint,!0),n=i.minus(e),r=this.deltaPointsFromPixels(n,!0);this.centerSpringX.shiftBy(r.x),this.centerSpringY.shiftBy(r.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else t()},deltaPixelsFromPointsNoRotate:function(t,e){return t.times(this._containerInnerSize.x*this.getZoom(e))},deltaPixelsFromPoints:function(t,e){return this.deltaPixelsFromPointsNoRotate(t.rotate(this.getRotation()),e)},deltaPointsFromPixelsNoRotate:function(t,e){return t.divide(this._containerInnerSize.x*this.getZoom(e))},deltaPointsFromPixels:function(t,e){return this.deltaPointsFromPixelsNoRotate(t,e).rotate(-this.getRotation())},pixelFromPointNoRotate:function(t,e){return this._pixelFromPointNoRotate(t,this.getBoundsNoRotate(e))},pixelFromPoint:function(t,e){return this._pixelFromPoint(t,this.getBoundsNoRotate(e))},_pixelFromPointNoRotate:function(e,i){return e.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(t,e){return this._pixelFromPointNoRotate(t.rotate(this.getRotation(),this.getCenter(!0)),e)},pointFromPixelNoRotate:function(e,i){var n=this.getBoundsNoRotate(i);return e.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(t,e){return this.pointFromPixelNoRotate(t,e).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(e,i){if(e instanceof t.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n){var r=this.viewer.world.getItemAt(0);return r.viewportToImageCoordinates(e,i,!0)}}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(e,i){if(e instanceof t.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n){var r=this.viewer.world.getItemAt(0);return r.imageToViewportCoordinates(e,i,!0)}}var o=this._imageToViewportDelta(e,i);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(e,i,n,r){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===s){var a=this.viewer.world.getItemAt(0);return a.imageToViewportRectangle(e,i,n,r,!0)}}var l=this.imageToViewportCoordinates(o.x,o.y),h=this._imageToViewportDelta(o.width,o.height);return new t.Rect(l.x,l.y,h.x,h.y,o.degrees)},viewportToImageRectangle:function(e,i,n,r){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===s){var a=this.viewer.world.getItemAt(0);return a.viewportToImageRectangle(e,i,n,r,!0)}}var l=this.viewportToImageCoordinates(o.x,o.y),h=this._viewportToImageDelta(o.width,o.height);return new t.Rect(l.x,l.y,h.x,h.y,o.degrees)},viewerElementToImageCoordinates:function(t){var e=this.pointFromPixel(t,!0);return this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(t){var e=this.imageToViewportCoordinates(t);return this.pixelFromPoint(e,!0)},windowToImageCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(e).plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(t){return this.pointFromPixel(t,!0)},viewportToViewerElementCoordinates:function(t){return this.pixelFromPoint(t,!0)},viewerElementToViewportRectangle:function(e){return t.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return t.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(e){return t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(e).plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i){var n=this.viewer.world.getItemAt(0);return n.viewportToImageZoom(e)}}var r=this._contentSizeNoRotate.x;return e*(this._containerInnerSize.x/r*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i){var n=this.viewer.world.getItemAt(0);return n.imageToViewportZoom(e)}}return e*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)}}}(OpenSeadragon),function(t){function e(t,e,n,r,o,s,a,l,h){var u=a.getBoundingBox().getTopLeft(),c=a.getBoundingBox().getBottomRight();t.viewer&&t.viewer.raiseEvent("update-level",{tiledImage:t,havedrawn:e,level:r,opacity:o,visibility:s,drawArea:a,topleft:u,bottomright:c,currenttime:l,best:h}),d(t.coverage,r),d(t.loadingCoverage,r);for(var f=t._getCornerTiles(r,u,c),p=f.topLeft,g=f.bottomRight,m=t.source.getNumTiles(r),v=t.viewport.pixelFromPoint(t.viewport.getCenter()),y=p.x;y<=g.x;y++)for(var w=p.y;w<=g.y;w++){if(!t.wrapHorizontal&&!t.wrapVertical){var _=t.source.getTileBounds(r,y,w);if(null===a.intersection(_))continue}h=i(t,n,e,y,w,r,o,s,v,m,l,h)}return h}function i(t,e,i,r,o,h,d,p,g,m,v,y){var w=n(r,o,h,t,t.source,t.tilesMatrix,v,m,t._worldWidthCurrent,t._worldHeightCurrent),_=i;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:w}),c(t.coverage,h,r,o,!1);var x=w.loaded||w.loading||u(t.loadingCoverage,h,r,o);if(c(t.loadingCoverage,h,r,o,x),!w.exists)return y;if(e&&!_&&(u(t.coverage,h,r,o)?c(t.coverage,h,r,o,!0):_=!0),!_)return y;if(a(w,t.source.tileOverlap,t.viewport,g,p,t),!w.loaded)if(w.context2D)s(t,w);else{var b=t._tileCache.getImageRecord(w.cacheKey);if(b){var S=b.getImage();s(t,w,S)}}if(w.loaded){l(t,w,r,o,h,d,v)&&(t._needsDraw=!0)}else w.loading?t._tilesLoading++:x||(y=f(y,w));return y}function n(e,i,n,r,o,s,a,l,h,u){var c,d,f,p,g,m,v,y;return s[n]||(s[n]={}),s[n][e]||(s[n][e]={}),s[n][e][i]||(c=(l.x+e%l.x)%l.x,d=(l.y+i%l.y)%l.y,f=o.getTileBounds(n,c,d),p=o.tileExists(n,c,d),g=o.getTileUrl(n,c,d),r.loadTilesWithAjax?(m=o.getTileAjaxHeaders(n,c,d),t.isPlainObject(r.ajaxHeaders)&&(m=t.extend({},r.ajaxHeaders,m))):m=null,v=o.getContext2D?o.getContext2D(n,c,d):undefined,f.x+=(e-c)/l.x,f.y+=u/h*((i-d)/l.y),s[n][e][i]=new t.Tile(n,e,i,f,p,g,v,r.loadTilesWithAjax,m)),y=s[n][e][i],y.lastTouchTime=a,y}function r(t,e,i){e.loading=!0,t._imageLoader.addJob({src:e.url,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(n,r,s){o(t,e,i,n,r,s)},abort:function(){e.loading=!1}})}function o(e,i,n,r,o,a){if(!r)return t.console.log("Tile %s failed to load: %s - error: %s",i,i.url,o),e.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:e,time:n,message:o,tileRequest:a}),i.loading=!1,void(i.exists=!1);if(n<e.lastResetTime)return t.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var l=function(){var t=e.source.getClosestLevel();s(e,i,r,t,a)};e._midDraw?window.setTimeout(l,1):l()}function s(t,e,i,n,r){function o(){return a++,s}function s(){0===--a&&(e.loading=!1,e.loaded=!0,e.context2D||t._tileCache.cacheTile({image:i,tile:e,cutoff:n,tiledImage:t}),t._needsDraw=!0)}var a=0;t.viewer.raiseEvent("tile-loaded",{tile:e,tiledImage:t,tileRequest:r,image:i,getCompletionCallback:o}),o()()}function a(e,i,n,r,o,s){var a=e.bounds.getTopLeft();a.x*=s._scaleSpring.current.value,a.y*=s._scaleSpring.current.value,a.x+=s._xSpring.current.value,a.y+=s._ySpring.current.value;var l=e.bounds.getSize();l.x*=s._scaleSpring.current.value,l.y*=s._scaleSpring.current.value
;var h=n.pixelFromPointNoRotate(a,!0),u=n.pixelFromPointNoRotate(a,!1),c=n.deltaPixelsFromPointsNoRotate(l,!0),d=n.deltaPixelsFromPointsNoRotate(l,!1),f=u.plus(d.divide(2)),p=r.squaredDistanceTo(f);i||(c=c.plus(new t.Point(1,1))),e.position=h,e.size=c,e.squaredDistance=p,e.visibility=o}function l(t,e,i,n,r,o,s){var a,l,h=1e3*t.blendTime;if(e.blendStart||(e.blendStart=s),a=s-e.blendStart,l=h?Math.min(1,a/h):1,t.alwaysBlend&&(l*=o),e.opacity=l,t.lastDrawn.push(e),1==l)c(t.coverage,r,i,n,!0),t._hasOpaqueTile=!0;else if(a<h)return!0;return!1}function h(t,e,i,n){var r,o,s,a;if(!t[e])return!1;if(i===undefined||n===undefined){r=t[e];for(s in r)if(r.hasOwnProperty(s)){o=r[s];for(a in o)if(o.hasOwnProperty(a)&&!o[a])return!1}return!0}return t[e][i]===undefined||t[e][i][n]===undefined||!0===t[e][i][n]}function u(t,e,i,n){return i===undefined||n===undefined?h(t,e+1):h(t,e+1,2*i,2*n)&&h(t,e+1,2*i,2*n+1)&&h(t,e+1,2*i+1,2*n)&&h(t,e+1,2*i+1,2*n+1)}function c(e,i,n,r,o){if(!e[i])return void t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i);e[i][n]||(e[i][n]={}),e[i][n][r]=o}function d(t,e){t[e]={}}function f(t,e){return t?e.visibility>t.visibility?e:e.visibility==t.visibility&&e.squaredDistance<t.squaredDistance?e:t:e}function p(e,i){if(0!==e.opacity&&0!==i.length){var n,r,o=i[0],s=e.opacity<1||e.compositeOperation&&"source-over"!==e.compositeOperation||!e._isBottomItem()&&o._hasTransparencyChannel(),a=e.viewport.getZoom(!0),l=e.viewportToImageZoom(a);i.length>1&&l>e.smoothTileEdgesMinZoom&&!e.iOSDevice&&e.getRotation(!0)%360==0&&t.supportsCanvas&&(s=!0,n=o.getScaleForEdgeSmoothing(),r=o.getTranslationForEdgeSmoothing(n,e._drawer.getCanvasSize(!1),e._drawer.getCanvasSize(!0)));var h;s&&(n||(h=e.viewport.viewportToViewerElementRectangle(e.getClippedBounds(!0)).getIntegerBoundingBox().times(t.pixelDensityRatio)),e._drawer._clear(!0,h)),n||(0!==e.viewport.degrees&&e._drawer._offsetForRotation({degrees:e.viewport.degrees,useSketch:s}),e.getRotation(!0)%360!=0&&e._drawer._offsetForRotation({degrees:e.getRotation(!0),point:e.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:s}));var u=!1;if(e._clip){e._drawer.saveContext(s);var c=e.imageToViewportRectangle(e._clip,!0);c=c.rotate(-e.getRotation(!0),e._getRotationPoint(!0));var d=e._drawer.viewportToDrawerRectangle(c);n&&(d=d.times(n)),r&&(d=d.translate(r)),e._drawer.setClip(d,s),u=!0}if(e.placeholderFillStyle&&!1===e._hasOpaqueTile){var f=e._drawer.viewportToDrawerRectangle(e.getBounds(!0));n&&(f=f.times(n)),r&&(f=f.translate(r));var p=null;p="function"==typeof e.placeholderFillStyle?e.placeholderFillStyle(e,e._drawer.context):e.placeholderFillStyle,e._drawer.drawRectangle(f,p,s)}for(var m=i.length-1;m>=0;m--)o=i[m],e._drawer.drawTile(o,e._drawingHandler,s,n,r),o.beingDrawn=!0,e.viewer&&e.viewer.raiseEvent("tile-drawn",{tiledImage:e,tile:o});u&&e._drawer.restoreContext(s),n||(e.getRotation(!0)%360!=0&&e._drawer._restoreRotationChanges(s),0!==e.viewport.degrees&&e._drawer._restoreRotationChanges(s)),s&&(n&&(0!==e.viewport.degrees&&e._drawer._offsetForRotation({degrees:e.viewport.degrees,useSketch:!1}),e.getRotation(!0)%360!=0&&e._drawer._offsetForRotation({degrees:e.getRotation(!0),point:e.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:!1})),e._drawer.blendSketch({opacity:e.opacity,scale:n,translate:r,compositeOperation:e.compositeOperation,bounds:h}),n&&(e.getRotation(!0)%360!=0&&e._drawer._restoreRotationChanges(!1),0!==e.viewport.degrees&&e._drawer._restoreRotationChanges(!1))),g(e,i)}}function g(e,i){if(e.debugMode)for(var n=i.length-1;n>=0;n--){var r=i[n];try{e._drawer.drawDebugInfo(r,i.length,n,e)}catch(e){t.console.error(e)}}}t.TiledImage=function(e){var i=this;t.console.assert(e.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(e.drawer,"[TiledImage] options.drawer is required"),t.console.assert(e.viewer,"[TiledImage] options.viewer is required"),t.console.assert(e.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(e.source,"[TiledImage] options.source is required"),t.console.assert(!e.clip||e.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=e.tileCache,delete e.tileCache,this._drawer=e.drawer,delete e.drawer,this._imageLoader=e.imageLoader,delete e.imageLoader,e.clip instanceof t.Rect&&(this._clip=e.clip.clone()),delete e.clip;var n=e.x||0;delete e.x;var r=e.y||0;delete e.y,this.normHeight=e.source.dimensions.y/e.source.dimensions.x,this.contentAspectX=e.source.dimensions.x/e.source.dimensions.y;var o=1;e.width?(o=e.width,delete e.width,e.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete e.height)):e.height&&(o=e.height/this.normHeight,delete e.height);var s=e.fitBounds;delete e.fitBounds;var a=e.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete e.fitBoundsPlacement;var l=e.degrees||0;delete e.degrees,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation},e),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),s&&this.fitBounds(s,a,!0),this._drawingHandler=function(e){i.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:i},e))}},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(t){t!==this._fullyLoaded&&(this._fullyLoaded=t,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var t=this._xSpring.update(),e=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(t||e||i||n)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){(0!==this.opacity||this._preload)&&(this._midDraw=!0,this._updateViewport(),this._midDraw=!1)},destroy:function(){this.reset()},getBounds:function(t){return this.getBoundsNoRotate(t).rotate(this.getRotation(t),this._getRotationPoint(t))},getBoundsNoRotate:function(e){return e?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(e){var i=this.getBoundsNoRotate(e);if(this._clip){var n=e?this._worldWidthCurrent:this._worldWidthTarget,r=n/this.source.dimensions.x,o=this._clip.times(r);i=new t.Rect(i.x+o.x,i.y+o.y,o.width,o.height)}return i.rotate(this.getRotation(e),this._getRotationPoint(e))},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(e,i,n){var r=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(e*(this.source.dimensions.x/r),i*(this.source.dimensions.y*this.contentAspectX/r))},viewportToImageCoordinates:function(e,i,n){var r;return e instanceof t.Point?(n=i,r=e):r=new t.Point(e,i),r=r.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(r.x-this._xSpring.current.value,r.y-this._ySpring.current.value):this._viewportToImageDelta(r.x-this._xSpring.target.value,r.y-this._ySpring.target.value)},_imageToViewportDelta:function(e,i,n){var r=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(e/this.source.dimensions.x*r,i/this.source.dimensions.y/this.contentAspectX*r)},imageToViewportCoordinates:function(e,i,n){e instanceof t.Point&&(n=i,i=e.y,e=e.x);var r=this._imageToViewportDelta(e,i);return n?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(e,i,n,r,o){var s=e;s instanceof t.Rect?o=i:s=new t.Rect(e,i,n,r);var a=this.imageToViewportCoordinates(s.getTopLeft(),o),l=this._imageToViewportDelta(s.width,s.height,o);return new t.Rect(a.x,a.y,l.x,l.y,s.degrees+this.getRotation(o))},viewportToImageRectangle:function(e,i,n,r,o){var s=e;e instanceof t.Rect?o=i:s=new t.Rect(e,i,n,r);var a=this.viewportToImageCoordinates(s.getTopLeft(),o),l=this._viewportToImageDelta(s.width,s.height,o);return new t.Rect(a.x,a.y,l.x,l.y,s.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(t){var e=this.viewport.pointFromPixel(t,!0);return this.viewportToImageCoordinates(e)},imageToViewerElementCoordinates:function(t){var e=this.imageToViewportCoordinates(t);return this.viewport.pixelFromPoint(e,!0)},windowToImageCoordinates:function(t){var e=t.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(e)},imageToWindowCoordinates:function(t){return this.imageToViewerElementCoordinates(t).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(e){var i=this._scaleSpring.current.value;return e=e.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((e.x-this._xSpring.current.value)/i,(e.y-this._ySpring.current.value)/i,e.width/i,e.height/i,e.degrees)},viewportToImageZoom:function(t){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*t},imageToViewportZoom:function(t){return t/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(t,e){var i=this._xSpring.target.value===t.x&&this._ySpring.target.value===t.y;if(e){if(i&&this._xSpring.current.value===t.x&&this._ySpring.current.value===t.y)return;this._xSpring.resetTo(t.x),this._ySpring.resetTo(t.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(t.x),this._ySpring.springTo(t.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(t,e){this._setScale(t,e)},setHeight:function(t,e){this._setScale(t/this.normHeight,e)},fitBounds:function(e,i,n){i=i||t.Placement.CENTER;var r=t.Placement.properties[i],o=this.contentAspectX,s=0,a=0,l=1,h=1;if(this._clip&&(o=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,h=this._clip.height/this.source.dimensions.y,e.getAspectRatio()>o?(s=this._clip.x/this._clip.height*e.height,a=this._clip.y/this._clip.height*e.height):(s=this._clip.x/this._clip.width*e.width,a=this._clip.y/this._clip.width*e.width)),e.getAspectRatio()>o){var u=e.height/h,c=0;r.isHorizontallyCentered?c=(e.width-e.height*o)/2:r.isRight&&(c=e.width-e.height*o),this.setPosition(new t.Point(e.x-s+c,e.y-a),n),this.setHeight(u,n)}else{var d=e.width/l,f=0;r.isVerticallyCentered?f=(e.height-e.width/o)/2:r.isBottom&&(f=e.height-e.width/o),this.setPosition(new t.Point(e.x-s,e.y-a+f),n),this.setWidth(d,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){t.console.assert(!e||e instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),e instanceof t.Rect?this._clip=e.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(t){t!==this.opacity&&(this.opacity=t,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(t){this._preload=!!t,this._needsDraw=!0},getRotation:function(t){return t?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(t,e){this._degreesSpring.target.value===t&&this._degreesSpring.isAtTargetValue()||(e?this._degreesSpring.resetTo(t):this._degreesSpring.springTo(t),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(t){return this.getBoundsNoRotate(t).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(t){t!==this.compositeOperation&&(this.compositeOperation=t,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(t,e){var i=this._scaleSpring.target.value===t;if(e){if(i&&this._scaleSpring.current.value===t)return;this._scaleSpring.resetTo(t),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(t),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var t=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),e=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(e/this.minPixelRatio)/Math.log(2))));return t=Math.min(t,i),{lowestLevel:t,highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var i=this.viewport,n=this._viewportToTiledImageRectangle(i.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var o=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(n=n.intersection(o)))return}for(var s=this._getLevelsInterval(),a=s.lowestLevel,l=s.highestLevel,u=null,c=!1,d=t.now(),f=l;f>=a;f--){var g=!1,m=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(f),!0).x*this._scaleSpring.current.value;if(f===a||!c&&m>=this.minPixelRatio)g=!0,c=!0;else if(!c)continue;var v=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(f),!1).x*this._scaleSpring.current.value,y=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,w=this.immediateRender?1:y;if(u=e(this,c,g,f,Math.min(1,(m-.5)/.5),w/Math.abs(w-v),n,d,u),h(this.coverage,f))break}p(this,this.lastDrawn),u&&!u.context2D?(r(this,u,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(e,i,n){var r,o;this.wrapHorizontal?(r=t.positiveModulo(i.x,1),o=t.positiveModulo(n.x,1)):(r=Math.max(0,i.x),o=Math.min(1,n.x));var s,a,l=1/this.source.aspectRatio;this.wrapVertical?(s=t.positiveModulo(i.y,l),a=t.positiveModulo(n.y,l)):(s=Math.max(0,i.y),a=Math.min(l,n.y));var h=this.source.getTileAtPoint(e,new t.Point(r,s)),u=this.source.getTileAtPoint(e,new t.Point(o,a)),c=this.source.getNumTiles(e);return this.wrapHorizontal&&(h.x+=c.x*Math.floor(i.x),u.x+=c.x*Math.floor(n.x)),this.wrapVertical&&(h.y+=c.y*Math.floor(i.y/l),u.y+=c.y*Math.floor(n.y/l)),{topLeft:h,bottomRight:u}}})}(OpenSeadragon),function(t){var e=function(e){t.console.assert(e,"[TileCache.cacheTile] options is required"),t.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=e.tile,this.tiledImage=e.tiledImage},i=function(e){t.console.assert(e,"[ImageRecord] options is required"),t.console.assert(e.image,"[ImageRecord] options.image is required"),this._image=e.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var t=document.createElement("canvas");t.width=this._image.width,t.height=this._image.height,this._renderedContext=t.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(e){t.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=e},addTile:function(e){t.console.assert(e,"[ImageRecord.addTile] tile is required"),this._tiles.push(e)},removeTile:function(e){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===e)return void this._tiles.splice(i,1);t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(e){e=e||{},this._maxImageCacheCount=e.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var r=n.cutoff||0,o=this._tilesLoaded.length,s=this._imagesLoaded[n.tile.cacheKey];if(s||(t.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),s=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),s.addTile(n.tile),n.tile.cacheImageRecord=s,this._imagesLoadedCount>this._maxImageCacheCount){for(var a,l,h,u,c,d,f=null,p=-1,g=null,m=this._tilesLoaded.length-1;m>=0;m--)d=this._tilesLoaded[m],a=d.tile,a.level<=r||a.beingDrawn||(f?(u=a.lastTouchTime,l=f.lastTouchTime,c=a.level,h=f.level,(u<l||u==l&&c>h)&&(f=a,p=m,g=d)):(f=a,p=m,g=d));f&&p>=0&&(this._unloadTile(g),o=p)}this._tilesLoaded[o]=new e({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(e){t.console.assert(e,"[TileCache.clearTilesFor] tiledImage is required");for(var i,n=0;n<this._tilesLoaded.length;++n)i=this._tilesLoaded[n],i.tiledImage===e&&(this._unloadTile(i),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(e){return t.console.assert(e,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[e]},_unloadTile:function(e){t.console.assert(e,"[TileCache._unloadTile] tileRecord is required");var i=e.tile,n=e.tiledImage;i.unload(),i.cacheImageRecord=null;var r=this._imagesLoaded[i.cacheKey];r.removeTile(i),r.getTileCount()||(r.destroy(),delete this._imagesLoaded[i.cacheKey],this._imagesLoadedCount--),n.viewer.raiseEvent("tile-unloaded",{tile:i,tiledImage:n})}}}(OpenSeadragon),function(t){t.World=function(e){var i=this;t.console.assert(e.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(e,i){if(t.console.assert(e,"[World.addItem] item is required"),t.console.assert(e instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),i=i||{},i.index!==undefined){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,e)}else this._items.push(e);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return t.console.assert(e!==undefined,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return t.console.assert(e,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,i){t.console.assert(e,"[World.setItemIndex] item is required"),t.console.assert(i!==undefined,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(e);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:n,newIndex:i}))},removeItem:function(e){t.console.assert(e,"[World.removeItem] item is required");var i=t.indexOf(this._items,e);-1!==i&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){this.viewer._cancelPendingImages();var t,e;for(e=0;e<this._items.length;e++)t=this._items[e],t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,e=0;e<i.length;e++)t=i[e],this._raiseRemoveItem(t)},resetItems:function(){for(var t=0;t<this._items.length;t++)this._items[t].reset()},update:function(){for(var t=!1,e=0;e<this._items.length;e++)t=this._items[e].update()||t;return t},draw:function(){for(var t=0;t<this._items.length;t++)this._items[t].draw();this._needsDraw=!1},needsDraw:function(){for(var t=0;t<this._items.length;t++)if(this._items[t].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(t){this._autoRefigureSizes=t,t&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){e=e||{};var i,n=e.immediately||!1,r=e.layout||t.DEFAULT_SETTINGS.collectionLayout,o=e.rows||t.DEFAULT_SETTINGS.collectionRows,s=e.columns||t.DEFAULT_SETTINGS.collectionColumns,a=e.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,l=e.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,h=a+l;i=!e.rows&&s?s:Math.ceil(this._items.length/o);var u,c,d,f,p,g=0,m=0;this.setAutoRefigureSizes(!1);for(var v=0;v<this._items.length;v++)v&&v%i==0&&("horizontal"===r?(m+=h,g=0):(g+=h,m=0)),u=this._items[v],c=u.getBounds(),d=c.width>c.height?a:a*(c.width/c.height),f=d*(c.height/c.width),p=new t.Point(g+(a-d)/2,m+(a-f)/2),u.setPosition(p,n),u.setWidth(d,n),"horizontal"===r?g+=h:m+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var r=this._items[0],o=r.getBounds();this._contentFactor=r.getContentSize().x/o.width;for(var s=r.getClippedBounds().getBoundingBox(),a=s.x,l=s.y,h=s.x+s.width,u=s.y+s.height,c=1;c<this._items.length;c++)r=this._items[c],o=r.getBounds(),this._contentFactor=Math.max(this._contentFactor,r.getContentSize().x/o.width),s=r.getClippedBounds().getBoundingBox(),a=Math.min(a,s.x),l=Math.min(l,s.y),h=Math.max(h,s.x+s.width),u=Math.max(u,s.y+s.height);this._homeBounds=new t.Rect(a,l,h-a,u-l),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(e)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(t){this.raiseEvent("remove-item",{item:t})}})}(OpenSeadragon),function(t){"use strict";function e(t){for(var e=window,i=t.split("."),n=i.pop(),r=0,o=i.length;r<o;r++)e=e[i[r]];return function(){e[n].call(this)}}var i;if(!t.fn.popover)throw new Error("Confirmation requires popover.js");var n=function(t,e){e.trigger="click",this.init(t,e)};n.VERSION="2.4.0",n.KEYMAP={13:"Enter",27:"Escape",39:"ArrowRight",40:"ArrowDown"},n.DEFAULTS=t.extend({},t.fn.popover.Constructor.DEFAULTS,{placement:"top",title:"Are you sure?",popout:!1,singleton:!1,copyAttributes:"href target",buttons:null,onConfirm:t.noop,onCancel:t.noop,btnOkClass:"btn-xs btn-primary",btnOkIcon:"glyphicon glyphicon-ok",btnOkLabel:"Yes",btnCancelClass:"btn-xs btn-default",btnCancelIcon:"glyphicon glyphicon-remove",btnCancelLabel:"No",template:'<div class="popover confirmation"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"><p class="confirmation-content"></p><div class="confirmation-buttons text-center"><div class="btn-group"><a href="#" class="btn" data-apply="confirmation"></a><a href="#" class="btn" data-dismiss="confirmation"></a></div></div></div></div>'}),n.prototype=t.extend({},t.fn.popover.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.init=function(e,i){if(t.fn.popover.Constructor.prototype.init.call(this,"confirmation",e,i),(this.options.popout||this.options.singleton)&&!i.rootSelector)throw new Error("The rootSelector option is required to use popout and singleton features since jQuery 3.");this.options._isDelegate=!1,i.selector?this.options._selector=this._options._selector=i.rootSelector+" "+i.selector:i._selector?(this.options._selector=i._selector,this.options._isDelegate=!0):this.options._selector=i.rootSelector;var n=this;this.options.selector?this.$element.on(this.options.trigger,this.options.selector,function(t,e){e||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}):(this.options._attributes={},this.options.copyAttributes?"string"==typeof this.options.copyAttributes&&(this.options.copyAttributes=this.options.copyAttributes.split(" ")):this.options.copyAttributes=[],this.options.copyAttributes.forEach(function(t){this.options._attributes[t]=this.$element.attr(t)},this),this.$element.on(this.options.trigger,function(t,e){e||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}),this.$element.on("show.bs.confirmation",function(){n.options.singleton&&t(n.options._selector).not(t(this)).filter(function(){return void 0!==t(this).data("bs.confirmation")}).confirmation("hide")})),this.options._isDelegate||(this.eventBody=!1,this.uid=this.$element[0].id||this.getUID("group_"),this.$element.on("shown.bs.confirmation",function(){n.options.popout&&!n.eventBody&&(n.eventBody=t("body").on("click.bs.confirmation."+n.uid,function(e){t(n.options._selector).is(e.target)||(t(n.options._selector).filter(function(){return void 0!==t(this).data("bs.confirmation")}).confirmation("hide"),t("body").off("click.bs."+n.uid),n.eventBody=!1)}))}))},n.prototype.hasContent=function(){return!0},n.prototype.setContent=function(){var e=this,n=this.tip(),r=this.getTitle(),o=this.getContent();if(n.find(".popover-title")[this.options.html?"html":"text"](r),n.find(".confirmation-content").toggle(!!o).children().detach().end()[this.options.html?"string"==typeof o?"html":"append":"text"](o),n.on("click",function(t){t.stopPropagation()}),this.options.buttons){var s=n.find(".confirmation-buttons .btn-group").empty();this.options.buttons.forEach(function(i){s.append(t('<a href="#"></a>').addClass(i["class"]||"btn btn-xs btn-default").html(i.label||"").attr(i.attr||{}).prepend(t("<i></i>").addClass(i.icon)," ").one("click",function(n){"#"===t(this).attr("href")&&n.preventDefault(),i.onClick&&i.onClick.call(e.$element),i.cancel?(e.getOnCancel.call(e).call(e.$element),e.$element.trigger("canceled.bs.confirmation")):(e.getOnConfirm.call(e).call(e.$element),e.$element.trigger("confirmed.bs.confirmation")),e.inState&&(e.inState.click=!1),e.hide()}))},this)}else n.find('[data-apply="confirmation"]').addClass(this.options.btnOkClass).html(this.options.btnOkLabel).attr(this.options._attributes).prepend(t("<i></i>").addClass(this.options.btnOkIcon)," ").off("click").one("click",function(i){"#"===t(this).attr("href")&&i.preventDefault(),e.getOnConfirm.call(e).call(e.$element),e.$element.trigger("confirmed.bs.confirmation"),e.$element.trigger(e.options.trigger,[!0]),e.hide()}),n.find('[data-dismiss="confirmation"]').addClass(this.options.btnCancelClass).html(this.options.btnCancelLabel).prepend(t("<i></i>").addClass(this.options.btnCancelIcon)," ").off("click").one("click",function(t){t.preventDefault(),e.getOnCancel.call(e).call(e.$element),e.$element.trigger("canceled.bs.confirmation"),e.inState&&(e.inState.click=!1),e.hide()});n.removeClass("fade top bottom left right in"),n.find(".popover-title").html()||n.find(".popover-title").hide(),i=this,t(window).off("keyup.bs.confirmation").on("keyup.bs.confirmation",this._onKeyup.bind(this))},n.prototype.destroy=function(){i===this&&(i=void 0,t(window).off("keyup.bs.confirmation")),t.fn.popover.Constructor.prototype.destroy.call(this)},n.prototype.hide=function(){i===this&&(i=void 0,t(window).off("keyup.bs.confirmation")),t.fn.popover.Constructor.prototype.hide.call(this)},n.prototype._onKeyup=function(e){if(!this.$tip)return i=void 0,void t(window).off("keyup.bs.confirmation");var r,o=e.key||n.KEYMAP[e.keyCode||e.which],s=this.$tip.find(".confirmation-buttons .btn-group"),a=s.find(".active");switch(o){case"Escape":this.hide();break;case"ArrowRight":r=a.length&&a.next().length?a.next():s.children().first(),a.removeClass("active"),r.addClass("active").focus();break;case"ArrowLeft":r=a.length&&a.prev().length?a.prev():s.children().last(),a.removeClass("active"),r.addClass("active").focus()}},n.prototype.getOnConfirm=function(){return this.$element.attr("data-on-confirm")?e(this.$element.attr("data-on-confirm")):this.options.onConfirm},n.prototype.getOnCancel=function(){return this.$element.attr("data-on-cancel")?e(this.$element.attr("data-on-cancel")):this.options.onCancel};var r=t.fn.confirmation;t.fn.confirmation=function(e){var i="object"==typeof e&&e||{};return i.rootSelector=this.selector||i.rootSelector,this.each(function(){var r=t(this),o=r.data("bs.confirmation");(o||"destroy"!=e)&&(o||r.data("bs.confirmation",o=new n(this,i)),"string"==typeof e&&(o[e](),"hide"==e&&o.inState&&(o.inState.click=!1)))})},t.fn.confirmation.Constructor=n,t.fn.confirmation.noConflict=function(){return t.fn.confirmation=r,this}}(jQuery),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CodeMirror=e()}(this,function(){"use strict";function t(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}function e(t){for(var e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function i(t,i){return e(t).appendChild(i)}function n(t,e,i,n){var r=document.createElement(t);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof e)r.appendChild(document.createTextNode(e));else if(e)for(var o=0;o<e.length;++o)r.appendChild(e[o]);return r}function r(t,e,i,r){var o=n(t,e,i,r);return o.setAttribute("role","presentation"),o}function o(t,e){if(3==e.nodeType&&(e=e.parentNode),t.contains)return t.contains(e);do{if(11==e.nodeType&&(e=e.host),e==t)return!0}while(e=e.parentNode)}function s(){var t;try{t=document.activeElement}catch(e){t=document.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function a(e,i){var n=e.className;t(i).test(n)||(e.className+=(n?" ":"")+i)}function l(e,i){for(var n=e.split(" "),r=0;r<n.length;r++)n[r]&&!t(n[r]).test(i)&&(i+=" "+n[r]);return i}
function h(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function u(t,e,i){e||(e={});for(var n in t)!t.hasOwnProperty(n)||!1===i&&e.hasOwnProperty(n)||(e[n]=t[n]);return e}function c(t,e,i,n,r){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(var o=n||0,s=r||0;;){var a=t.indexOf("\t",o);if(a<0||a>=e)return s+(e-o);s+=a-o,s+=i-s%i,o=a+1}}function d(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1}function f(t,e,i){for(var n=0,r=0;;){var o=t.indexOf("\t",n);-1==o&&(o=t.length);var s=o-n;if(o==t.length||r+s>=e)return n+Math.min(s,e-r);if(r+=o-n,r+=i-r%i,n=o+1,r>=e)return n}}function p(t){for(;Ws.length<=t;)Ws.push(g(Ws)+" ");return Ws[t]}function g(t){return t[t.length-1]}function m(t,e){for(var i=[],n=0;n<t.length;n++)i[n]=e(t[n],n);return i}function v(t,e,i){for(var n=0,r=i(e);n<t.length&&i(t[n])<=r;)n++;t.splice(n,0,e)}function y(){}function w(t,e){var i;return Object.create?i=Object.create(t):(y.prototype=t,i=new y),e&&u(e,i),i}function _(t){return/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||qs.test(t))}function x(t,e){return e?!!(e.source.indexOf("\\w")>-1&&_(t))||e.test(t):_(t)}function b(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}function S(t){return t.charCodeAt(0)>=768&&Vs.test(t)}function T(t,e,i){for(;(i<0?e>0:e<t.length)&&S(t.charAt(e));)e+=i;return e}function C(t,e,i){for(;;){if(Math.abs(e-i)<=1)return t(e)?e:i;var n=Math.floor((e+i)/2);t(n)?i=n:e=n}}function P(t,e,i){var o=this;this.input=i,o.scrollbarFiller=n("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=n("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=r("div",null,"CodeMirror-code"),o.selectionDiv=n("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=n("div",null,"CodeMirror-cursors"),o.measure=n("div",null,"CodeMirror-measure"),o.lineMeasure=n("div",null,"CodeMirror-measure"),o.lineSpace=r("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var s=r("div",[o.lineSpace],"CodeMirror-lines");o.mover=n("div",[s],null,"position: relative"),o.sizer=n("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=n("div",null,null,"position: absolute; height: "+Hs+"px; width: 1px;"),o.gutters=n("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=n("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=n("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),ps&&gs<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),ms||us&&Cs||(o.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(o.wrapper):t(o.wrapper)),o.viewFrom=o.viewTo=e.first,o.reportedViewFrom=o.reportedViewTo=e.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,i.init(o)}function E(t,e){if((e-=t.first)<0||e>=t.size)throw new Error("There is no line "+(e+t.first)+" in the document.");for(var i=t;!i.lines;)for(var n=0;;++n){var r=i.children[n],o=r.chunkSize();if(e<o){i=r;break}e-=o}return i.lines[e]}function k(t,e,i){var n=[],r=e.line;return t.iter(e.line,i.line+1,function(t){var o=t.text;r==i.line&&(o=o.slice(0,i.ch)),r==e.line&&(o=o.slice(e.ch)),n.push(o),++r}),n}function O(t,e,i){var n=[];return t.iter(e,i,function(t){n.push(t.text)}),n}function M(t,e){var i=e-t.height;if(i)for(var n=t;n;n=n.parent)n.height+=i}function R(t){if(null==t.parent)return null;for(var e=t.parent,i=d(e.lines,t),n=e.parent;n;e=n,n=n.parent)for(var r=0;n.children[r]!=e;++r)i+=n.children[r].chunkSize();return i+e.first}function I(t,e){var i=t.first;t:do{for(var n=0;n<t.children.length;++n){var r=t.children[n],o=r.height;if(e<o){t=r;continue t}e-=o,i+=r.chunkSize()}return i}while(!t.lines);for(var s=0;s<t.lines.length;++s){var a=t.lines[s],l=a.height;if(e<l)break;e-=l}return i+s}function L(t,e){return e>=t.first&&e<t.first+t.size}function N(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function A(t,e,i){if(void 0===i&&(i=null),!(this instanceof A))return new A(t,e,i);this.line=t,this.ch=e,this.sticky=i}function D(t,e){return t.line-e.line||t.ch-e.ch}function z(t,e){return t.sticky==e.sticky&&0==D(t,e)}function H(t){return A(t.line,t.ch)}function B(t,e){return D(t,e)<0?e:t}function F(t,e){return D(t,e)<0?t:e}function $(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function j(t,e){if(e.line<t.first)return A(t.first,0);var i=t.first+t.size-1;return e.line>i?A(i,E(t,i).text.length):W(e,E(t,e.line).text.length)}function W(t,e){var i=t.ch;return null==i||i>e?A(t.line,e):i<0?A(t.line,0):t}function q(t,e){for(var i=[],n=0;n<e.length;n++)i[n]=j(t,e[n]);return i}function V(){Us=!0}function U(){Gs=!0}function G(t,e,i){this.marker=t,this.from=e,this.to=i}function Z(t,e){if(t)for(var i=0;i<t.length;++i){var n=t[i];if(n.marker==e)return n}}function X(t,e){for(var i,n=0;n<t.length;++n)t[n]!=e&&(i||(i=[])).push(t[n]);return i}function Y(t,e){t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],e.marker.attachLine(t)}function K(t,e,i){var n;if(t)for(var r=0;r<t.length;++r){var o=t[r],s=o.marker,a=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);if(a||o.from==e&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var l=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);(n||(n=[])).push(new G(s,o.from,l?null:o.to))}}return n}function J(t,e,i){var n;if(t)for(var r=0;r<t.length;++r){var o=t[r],s=o.marker,a=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);if(a||o.from==e&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var l=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);(n||(n=[])).push(new G(s,l?null:o.from-e,null==o.to?null:o.to-e))}}return n}function Q(t,e){if(e.full)return null;var i=L(t,e.from.line)&&E(t,e.from.line).markedSpans,n=L(t,e.to.line)&&E(t,e.to.line).markedSpans;if(!i&&!n)return null;var r=e.from.ch,o=e.to.ch,s=0==D(e.from,e.to),a=K(i,r,s),l=J(n,o,s),h=1==e.text.length,u=g(e.text).length+(h?r:0);if(a)for(var c=0;c<a.length;++c){var d=a[c];if(null==d.to){var f=Z(l,d.marker);f?h&&(d.to=null==f.to?null:f.to+u):d.to=r}}if(l)for(var p=0;p<l.length;++p){var m=l[p];if(null!=m.to&&(m.to+=u),null==m.from){var v=Z(a,m.marker);v||(m.from=u,h&&(a||(a=[])).push(m))}else m.from+=u,h&&(a||(a=[])).push(m)}a&&(a=tt(a)),l&&l!=a&&(l=tt(l));var y=[a];if(!h){var w,_=e.text.length-2;if(_>0&&a)for(var x=0;x<a.length;++x)null==a[x].to&&(w||(w=[])).push(new G(a[x].marker,null,null));for(var b=0;b<_;++b)y.push(w);y.push(l)}return y}function tt(t){for(var e=0;e<t.length;++e){var i=t[e];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&t.splice(e--,1)}return t.length?t:null}function et(t,e,i){var n=null;if(t.iter(e.line,i.line+1,function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var i=t.markedSpans[e].marker;!i.readOnly||n&&-1!=d(n,i)||(n||(n=[])).push(i)}}),!n)return null;for(var r=[{from:e,to:i}],o=0;o<n.length;++o)for(var s=n[o],a=s.find(0),l=0;l<r.length;++l){var h=r[l];if(!(D(h.to,a.from)<0||D(h.from,a.to)>0)){var u=[l,1],c=D(h.from,a.from),f=D(h.to,a.to);(c<0||!s.inclusiveLeft&&!c)&&u.push({from:h.from,to:a.from}),(f>0||!s.inclusiveRight&&!f)&&u.push({from:a.to,to:h.to}),r.splice.apply(r,u),l+=u.length-3}}return r}function it(t){var e=t.markedSpans;if(e){for(var i=0;i<e.length;++i)e[i].marker.detachLine(t);t.markedSpans=null}}function nt(t,e){if(e){for(var i=0;i<e.length;++i)e[i].marker.attachLine(t);t.markedSpans=e}}function rt(t){return t.inclusiveLeft?-1:0}function ot(t){return t.inclusiveRight?1:0}function st(t,e){var i=t.lines.length-e.lines.length;if(0!=i)return i;var n=t.find(),r=e.find(),o=D(n.from,r.from)||rt(t)-rt(e);if(o)return-o;var s=D(n.to,r.to)||ot(t)-ot(e);return s||e.id-t.id}function at(t,e){var i,n=Gs&&t.markedSpans;if(n)for(var r=void 0,o=0;o<n.length;++o)r=n[o],r.marker.collapsed&&null==(e?r.from:r.to)&&(!i||st(i,r.marker)<0)&&(i=r.marker);return i}function lt(t){return at(t,!0)}function ht(t){return at(t,!1)}function ut(t,e,i,n,r){var o=E(t,e),s=Gs&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var h=l.marker.find(0),u=D(h.from,i)||rt(l.marker)-rt(r),c=D(h.to,n)||ot(l.marker)-ot(r);if(!(u>=0&&c<=0||u<=0&&c>=0)&&(u<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?D(h.to,i)>=0:D(h.to,i)>0)||u>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?D(h.from,n)<=0:D(h.from,n)<0)))return!0}}}function ct(t){for(var e;e=lt(t);)t=e.find(-1,!0).line;return t}function dt(t){for(var e;e=ht(t);)t=e.find(1,!0).line;return t}function ft(t){for(var e,i;e=ht(t);)t=e.find(1,!0).line,(i||(i=[])).push(t);return i}function pt(t,e){var i=E(t,e),n=ct(i);return i==n?e:R(n)}function gt(t,e){if(e>t.lastLine())return e;var i,n=E(t,e);if(!mt(t,n))return e;for(;i=ht(n);)n=i.find(1,!0).line;return R(n)+1}function mt(t,e){var i=Gs&&e.markedSpans;if(i)for(var n=void 0,r=0;r<i.length;++r)if(n=i[r],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&vt(t,e,n))return!0}}function vt(t,e,i){if(null==i.to){var n=i.marker.find(1,!0);return vt(t,n.line,Z(n.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==e.text.length)return!0;for(var r=void 0,o=0;o<e.markedSpans.length;++o)if(r=e.markedSpans[o],r.marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(null==r.to||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&vt(t,e,r))return!0}function yt(t){t=ct(t);for(var e=0,i=t.parent,n=0;n<i.lines.length;++n){var r=i.lines[n];if(r==t)break;e+=r.height}for(var o=i.parent;o;i=o,o=i.parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==i)break;e+=a.height}return e}function wt(t){if(0==t.height)return 0;for(var e,i=t.text.length,n=t;e=lt(n);){var r=e.find(0,!0);n=r.from.line,i+=r.from.ch-r.to.ch}for(n=t;e=ht(n);){var o=e.find(0,!0);i-=n.text.length-o.from.ch,n=o.to.line,i+=n.text.length-o.to.ch}return i}function _t(t){var e=t.display,i=t.doc;e.maxLine=E(i,i.first),e.maxLineLength=wt(e.maxLine),e.maxLineChanged=!0,i.iter(function(t){var i=wt(t);i>e.maxLineLength&&(e.maxLineLength=i,e.maxLine=t)})}function xt(t,e,i,n){if(!t)return n(e,i,"ltr");for(var r=!1,o=0;o<t.length;++o){var s=t[o];(s.from<i&&s.to>e||e==i&&s.to==e)&&(n(Math.max(s.from,e),Math.min(s.to,i),1==s.level?"rtl":"ltr"),r=!0)}r||n(e,i,"ltr")}function bt(t,e,i){var n;Zs=null;for(var r=0;r<t.length;++r){var o=t[r];if(o.from<e&&o.to>e)return r;o.to==e&&(o.from!=o.to&&"before"==i?n=r:Zs=r),o.from==e&&(o.from!=o.to&&"before"!=i?n=r:Zs=r)}return null!=n?n:Zs}function St(t,e){var i=t.order;return null==i&&(i=t.order=Xs(t.text,e)),i}function Tt(t,e,i){var n=T(t.text,e+i,i);return n<0||n>t.text.length?null:n}function Ct(t,e,i){var n=Tt(t,e.ch,i);return null==n?null:new A(e.line,n,i<0?"after":"before")}function Pt(t,e,i,n,r){if(t){var o=St(i,e.doc.direction);if(o){var s,a=r<0?g(o):o[0],l=r<0==(1==a.level),h=l?"after":"before";if(a.level>0){var u=Ke(e,i);s=r<0?i.text.length-1:0;var c=Je(e,u,s).top;s=C(function(t){return Je(e,u,t).top==c},r<0==(1==a.level)?a.from:a.to-1,s),"before"==h&&(s=Tt(i,s,1))}else s=r<0?a.to:a.from;return new A(n,s,h)}}return new A(n,r<0?i.text.length:0,r<0?"before":"after")}function Et(t,e,i,n){var r=St(e,t.doc.direction);if(!r)return Ct(e,i,n);i.ch>=e.text.length?(i.ch=e.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");var o=bt(r,i.ch,i.sticky),s=r[o];if("ltr"==t.doc.direction&&s.level%2==0&&(n>0?s.to>i.ch:s.from<i.ch))return Ct(e,i,n);var a,l=function(t,i){return Tt(e,t instanceof A?t.ch:t,i)},h=function(i){return t.options.lineWrapping?(a=a||Ke(t,e),mi(t,e,a,i)):{begin:0,end:e.text.length}},u=h("before"==i.sticky?l(i,-1):i.ch);if("rtl"==t.doc.direction||1==s.level){var c=1==s.level==n<0,d=l(i,c?1:-1);if(null!=d&&(c?d<=s.to&&d<=u.end:d>=s.from&&d>=u.begin)){var f=c?"before":"after";return new A(i.line,d,f)}}var p=function(t,e,n){for(var o=function(t,e){return e?new A(i.line,l(t,1),"before"):new A(i.line,t,"after")};t>=0&&t<r.length;t+=e){var s=r[t],a=e>0==(1!=s.level),h=a?n.begin:l(n.end,-1);if(s.from<=h&&h<s.to)return o(h,a);if(h=a?s.from:l(s.to,-1),n.begin<=h&&h<n.end)return o(h,a)}},g=p(o+n,n,u);if(g)return g;var m=n>0?u.end:l(u.begin,-1);return null==m||n>0&&m==e.text.length||!(g=p(n>0?0:r.length-1,n,h(m)))?null:g}function kt(t,e){return t._handlers&&t._handlers[e]||Ys}function Ot(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i,!1);else if(t.detachEvent)t.detachEvent("on"+e,i);else{var n=t._handlers,r=n&&n[e];if(r){var o=d(r,i);o>-1&&(n[e]=r.slice(0,o).concat(r.slice(o+1)))}}}function Mt(t,e){var i=kt(t,e);if(i.length)for(var n=Array.prototype.slice.call(arguments,2),r=0;r<i.length;++r)i[r].apply(null,n)}function Rt(t,e,i){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),Mt(t,i||e.type,t,e),zt(e)||e.codemirrorIgnore}function It(t){var e=t._handlers&&t._handlers.cursorActivity;if(e)for(var i=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]),n=0;n<e.length;++n)-1==d(i,e[n])&&i.push(e[n])}function Lt(t,e){return kt(t,e).length>0}function Nt(t){t.prototype.on=function(t,e){Ks(this,t,e)},t.prototype.off=function(t,e){Ot(this,t,e)}}function At(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function Dt(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function zt(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function Ht(t){At(t),Dt(t)}function Bt(t){return t.target||t.srcElement}function Ft(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),Ps&&t.ctrlKey&&1==e&&(e=3),e}function $t(t){if(null==Ds){var e=n("span","\u200b");i(t,n("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Ds=e.offsetWidth<=1&&e.offsetHeight>2&&!(ps&&gs<8))}var r=Ds?n("span","\u200b"):n("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}function jt(t){if(null!=zs)return zs;var n=i(t,document.createTextNode("A\u062eA")),r=Ms(n,0,1).getBoundingClientRect(),o=Ms(n,1,2).getBoundingClientRect();return e(t),!(!r||r.left==r.right)&&(zs=o.right-r.right<3)}function Wt(t){if(null!=ia)return ia;var e=i(t,n("span","x")),r=e.getBoundingClientRect(),o=Ms(e,0,1).getBoundingClientRect();return ia=Math.abs(r.left-o.left)>1}function qt(t,e){arguments.length>2&&(e.dependencies=Array.prototype.slice.call(arguments,2)),na[t]=e}function Vt(t,e){ra[t]=e}function Ut(t){if("string"==typeof t&&ra.hasOwnProperty(t))t=ra[t];else if(t&&"string"==typeof t.name&&ra.hasOwnProperty(t.name)){var e=ra[t.name];"string"==typeof e&&(e={name:e}),t=w(e,t),t.name=e.name}else{if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return Ut("application/xml");if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return Ut("application/json")}return"string"==typeof t?{name:t}:t||{name:"null"}}function Gt(t,e){e=Ut(e);var i=na[e.name];if(!i)return Gt(t,"text/plain");var n=i(t,e);if(oa.hasOwnProperty(e.name)){var r=oa[e.name];for(var o in r)r.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=r[o])}if(n.name=e.name,e.helperType&&(n.helperType=e.helperType),e.modeProps)for(var s in e.modeProps)n[s]=e.modeProps[s];return n}function Zt(t,e){u(e,oa.hasOwnProperty(t)?oa[t]:oa[t]={})}function Xt(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);var i={};for(var n in e){var r=e[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i}function Yt(t,e){for(var i;t.innerMode&&(i=t.innerMode(e))&&i.mode!=t;)e=i.state,t=i.mode;return i||{mode:t,state:e}}function Kt(t,e,i){return!t.startState||t.startState(e,i)}function Jt(t,e,i,n){var r=[t.state.modeGen],o={};se(t,e.text,t.doc.mode,i,function(t,e){return r.push(t,e)},o,n);for(var s=i.state,a=function(n){var s=t.state.overlays[n],a=1,l=0;i.state=!0,se(t,e.text,s.mode,i,function(t,e){for(var i=a;l<t;){var n=r[a];n>t&&r.splice(a,1,t,r[a+1],n),a+=2,l=Math.min(t,n)}if(e)if(s.opaque)r.splice(i,a-i,t,"overlay "+e),a=i+2;else for(;i<a;i+=2){var o=r[i+1];r[i+1]=(o?o+" ":"")+"overlay "+e}},o)},l=0;l<t.state.overlays.length;++l)a(l);return i.state=s,{styles:r,classes:o.bgClass||o.textClass?o:null}}function Qt(t,e,i){if(!e.styles||e.styles[0]!=t.state.modeGen){var n=te(t,R(e)),r=e.text.length>t.options.maxHighlightLength&&Xt(t.doc.mode,n.state),o=Jt(t,e,n);r&&(n.state=r),e.stateAfter=n.save(!r),e.styles=o.styles,o.classes?e.styleClasses=o.classes:e.styleClasses&&(e.styleClasses=null),i===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return e.styles}function te(t,e,i){var n=t.doc,r=t.display;if(!n.mode.startState)return new la(n,!0,e);var o=ae(t,e,i),s=o>n.first&&E(n,o-1).stateAfter,a=s?la.fromSaved(n,s,o):new la(n,Kt(n.mode),o);return n.iter(o,e,function(i){ee(t,i.text,a);var n=a.line;i.stateAfter=n==e-1||n%5==0||n>=r.viewFrom&&n<r.viewTo?a.save():null,a.nextLine()}),i&&(n.modeFrontier=a.line),a}function ee(t,e,i,n){var r=t.doc.mode,o=new sa(e,t.options.tabSize,i);for(o.start=o.pos=n||0,""==e&&ie(r,i.state);!o.eol();)ne(r,o,i.state),o.start=o.pos}function ie(t,e){if(t.blankLine)return t.blankLine(e);if(t.innerMode){var i=Yt(t,e);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}}function ne(t,e,i,n){for(var r=0;r<10;r++){n&&(n[0]=Yt(t,i).mode);var o=t.token(e,i);if(e.pos>e.start)return o}throw new Error("Mode "+t.name+" failed to advance stream.")}function re(t,e,i,n){var r,o=t.doc,s=o.mode;e=j(o,e);var a,l=E(o,e.line),h=te(t,e.line,i),u=new sa(l.text,t.options.tabSize,h);for(n&&(a=[]);(n||u.pos<e.ch)&&!u.eol();)u.start=u.pos,r=ne(s,u,h.state),n&&a.push(new ha(u,r,Xt(o.mode,h.state)));return n?a:new ha(u,r,h.state)}function oe(t,e){if(t)for(;;){var i=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;t=t.slice(0,i.index)+t.slice(i.index+i[0].length);var n=i[1]?"bgClass":"textClass";null==e[n]?e[n]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(e[n])||(e[n]+=" "+i[2])}return t}function se(t,e,i,n,r,o,s){var a=i.flattenSpans;null==a&&(a=t.options.flattenSpans);var l,h=0,u=null,c=new sa(e,t.options.tabSize,n),d=t.options.addModeClass&&[null];for(""==e&&oe(ie(i,n.state),o);!c.eol();){if(c.pos>t.options.maxHighlightLength?(a=!1,s&&ee(t,e,n,c.pos),c.pos=e.length,l=null):l=oe(ne(i,c,n.state,d),o),d){var f=d[0].name;f&&(l="m-"+(l?f+" "+l:f))}if(!a||u!=l){for(;h<c.start;)h=Math.min(c.start,h+5e3),r(h,u);u=l}c.start=c.pos}for(;h<c.pos;){var p=Math.min(c.pos,h+5e3);r(p,u),h=p}}function ae(t,e,i){for(var n,r,o=t.doc,s=i?-1:e-(t.doc.mode.innerMode?1e3:100),a=e;a>s;--a){if(a<=o.first)return o.first;var l=E(o,a-1),h=l.stateAfter;if(h&&(!i||a+(h instanceof aa?h.lookAhead:0)<=o.modeFrontier))return a;var u=c(l.text,null,t.options.tabSize);(null==r||n>u)&&(r=a-1,n=u)}return r}function le(t,e){if(t.modeFrontier=Math.min(t.modeFrontier,e),!(t.highlightFrontier<e-10)){for(var i=t.first,n=e-1;n>i;n--){var r=E(t,n).stateAfter;if(r&&(!(r instanceof aa)||n+r.lookAhead<e)){i=n+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,i)}}function he(t,e,i,n){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),it(t),nt(t,i);var r=n?n(t):1;r!=t.height&&M(t,r)}function ue(t){t.parent=null,it(t)}function ce(t,e){if(!t||/^\s*$/.test(t))return null;var i=e.addModeClass?fa:da;return i[t]||(i[t]=t.replace(/\S+/g,"cm-$&"))}function de(t,e){var i=r("span",null,null,ms?"padding-right: .1px":null),n={pre:r("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:(ps||ms)&&t.getOption("lineWrapping")};e.measure={};for(var o=0;o<=(e.rest?e.rest.length:0);o++){var s=o?e.rest[o-1]:e.line,a=void 0;n.pos=0,n.addToken=pe,jt(t.display.measure)&&(a=St(s,t.doc.direction))&&(n.addToken=me(n.addToken,a)),n.map=[];ye(s,n,Qt(t,s,e!=t.display.externalMeasured&&R(s))),s.styleClasses&&(s.styleClasses.bgClass&&(n.bgClass=l(s.styleClasses.bgClass,n.bgClass||"")),s.styleClasses.textClass&&(n.textClass=l(s.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild($t(t.display.measure))),0==o?(e.measure.map=n.map,e.measure.cache={}):((e.measure.maps||(e.measure.maps=[])).push(n.map),(e.measure.caches||(e.measure.caches=[])).push({}))}if(ms){var h=n.content.lastChild;(/\bcm-tab\b/.test(h.className)||h.querySelector&&h.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Mt(t,"renderLine",t,e.line,n.pre),n.pre.className&&(n.textClass=l(n.pre.className,n.textClass||"")),n}function fe(t){var e=n("span","\u2022","cm-invalidchar");return e.title="\\u"+t.charCodeAt(0).toString(16),e.setAttribute("aria-label",e.title),e}function pe(t,e,i,r,o,s,a){if(e){var l,h=t.splitSpaces?ge(e,t.trailingSpace):e,u=t.cm.state.specialChars,c=!1;if(u.test(e)){l=document.createDocumentFragment();for(var d=0;;){u.lastIndex=d;var f=u.exec(e),g=f?f.index-d:e.length-d;if(g){var m=document.createTextNode(h.slice(d,d+g));ps&&gs<9?l.appendChild(n("span",[m])):l.appendChild(m),t.map.push(t.pos,t.pos+g,m),t.col+=g,t.pos+=g}if(!f)break;d+=g+1;var v=void 0;if("\t"==f[0]){var y=t.cm.options.tabSize,w=y-t.col%y;v=l.appendChild(n("span",p(w),"cm-tab")),v.setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),t.col+=w}else"\r"==f[0]||"\n"==f[0]?(v=l.appendChild(n("span","\r"==f[0]?"\u240d":"\u2424","cm-invalidchar")),v.setAttribute("cm-text",f[0]),t.col+=1):(v=t.cm.options.specialCharPlaceholder(f[0]),v.setAttribute("cm-text",f[0]),ps&&gs<9?l.appendChild(n("span",[v])):l.appendChild(v),t.col+=1);t.map.push(t.pos,t.pos+1,v),t.pos++}}else t.col+=e.length,l=document.createTextNode(h),t.map.push(t.pos,t.pos+e.length,l),ps&&gs<9&&(c=!0),t.pos+=e.length;if(t.trailingSpace=32==h.charCodeAt(e.length-1),i||r||o||c||a){var _=i||"";r&&(_+=r),o&&(_+=o);var x=n("span",[l],_,a);return s&&(x.title=s),t.content.appendChild(x)}t.content.appendChild(l)}}function ge(t,e){if(t.length>1&&!/  /.test(t))return t;for(var i=e,n="",r=0;r<t.length;r++){var o=t.charAt(r);" "!=o||!i||r!=t.length-1&&32!=t.charCodeAt(r+1)||(o="\xa0"),n+=o,i=" "==o}return n}function me(t,e){return function(i,n,r,o,s,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var h=i.pos,u=h+n.length;;){for(var c=void 0,d=0;d<e.length&&(c=e[d],!(c.to>h&&c.from<=h));d++);if(c.to>=u)return t(i,n,r,o,s,a,l);t(i,n.slice(0,c.to-h),r,o,null,a,l),o=null,n=n.slice(c.to-h),h=c.to}}}function ve(t,e,i,n){var r=!n&&i.widgetNode;r&&t.map.push(t.pos,t.pos+e,r),!n&&t.cm.display.input.needsContentAttribute&&(r||(r=t.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",i.id)),r&&(t.cm.display.input.setUneditable(r),t.content.appendChild(r)),t.pos+=e,t.trailingSpace=!1}function ye(t,e,i){var n=t.markedSpans,r=t.text,o=0;if(n)for(var s,a,l,h,u,c,d,f=r.length,p=0,g=1,m="",v=0;;){if(v==p){l=h=u=c=a="",d=null,v=Infinity;for(var y=[],w=void 0,_=0;_<n.length;++_){var x=n[_],b=x.marker;"bookmark"==b.type&&x.from==p&&b.widgetNode?y.push(b):x.from<=p&&(null==x.to||x.to>p||b.collapsed&&x.to==p&&x.from==p)?(null!=x.to&&x.to!=p&&v>x.to&&(v=x.to,h=""),b.className&&(l+=" "+b.className),b.css&&(a=(a?a+";":"")+b.css),b.startStyle&&x.from==p&&(u+=" "+b.startStyle),b.endStyle&&x.to==v&&(w||(w=[])).push(b.endStyle,x.to),b.title&&!c&&(c=b.title),b.collapsed&&(!d||st(d.marker,b)<0)&&(d=x)):x.from>p&&v>x.from&&(v=x.from)}if(w)for(var S=0;S<w.length;S+=2)w[S+1]==v&&(h+=" "+w[S]);if(!d||d.from==p)for(var T=0;T<y.length;++T)ve(e,0,y[T]);if(d&&(d.from||0)==p){if(ve(e,(null==d.to?f+1:d.to)-p,d.marker,null==d.from),null==d.to)return;d.to==p&&(d=!1)}}if(p>=f)break;for(var C=Math.min(f,v);;){if(m){var P=p+m.length;if(!d){var E=P>C?m.slice(0,C-p):m;e.addToken(e,E,s?s+l:l,u,p+E.length==v?h:"",c,a)}if(P>=C){m=m.slice(C-p),p=C;break}p=P,u=""}m=r.slice(o,o=i[g++]),s=ce(i[g++],e.cm.options)}}else for(var k=1;k<i.length;k+=2)e.addToken(e,r.slice(o,o=i[k]),ce(i[k+1],e.cm.options))}function we(t,e,i){this.line=e,this.rest=ft(e),this.size=this.rest?R(g(this.rest))-i+1:1,this.node=this.text=null,this.hidden=mt(t,e)}function _e(t,e,i){for(var n,r=[],o=e;o<i;o=n){var s=new we(t.doc,E(t.doc,o),o);n=o+s.size,r.push(s)}return r}function xe(t){pa?pa.ops.push(t):t.ownsGroup=pa={ops:[t],delayedCallbacks:[]}}function be(t){var e=t.delayedCallbacks,i=0;do{for(;i<e.length;i++)e[i].call(null);for(var n=0;n<t.ops.length;n++){var r=t.ops[n];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(i<e.length)}function Se(t,e){var i=t.ownsGroup;if(i)try{be(i)}finally{pa=null,e(i)}}function Te(t,e){var i=kt(t,e);if(i.length){var n,r=Array.prototype.slice.call(arguments,2);pa?n=pa.delayedCallbacks:ga?n=ga:(n=ga=[],setTimeout(Ce,0));for(var o=function(t){n.push(function(){return i[t].apply(null,r)})},s=0;s<i.length;++s)o(s)}}function Ce(){var t=ga;ga=null;for(var e=0;e<t.length;++e)t[e]()}function Pe(t,e,i,n){for(var r=0;r<e.changes.length;r++){var o=e.changes[r];"text"==o?Me(t,e):"gutter"==o?Ie(t,e,i,n):"class"==o?Re(t,e):"widget"==o&&Le(t,e,n)}e.changes=null}function Ee(t){return t.node==t.text&&(t.node=n("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),ps&&gs<8&&(t.node.style.zIndex=2)),t.node}function ke(t,e){var i=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),e.background)i?e.background.className=i:(e.background.parentNode.removeChild(e.background),e.background=null);else if(i){var r=Ee(e);e.background=r.insertBefore(n("div",null,i),r.firstChild),t.display.input.setUneditable(e.background)}}function Oe(t,e){var i=t.display.externalMeasured;return i&&i.line==e.line?(t.display.externalMeasured=null,e.measure=i.measure,i.built):de(t,e)}function Me(t,e){var i=e.text.className,n=Oe(t,e);e.text==e.node&&(e.node=n.pre),e.text.parentNode.replaceChild(n.pre,e.text),e.text=n.pre,n.bgClass!=e.bgClass||n.textClass!=e.textClass?(e.bgClass=n.bgClass,e.textClass=n.textClass,Re(t,e)):i&&(e.text.className=i)}function Re(t,e){ke(t,e),e.line.wrapClass?Ee(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var i=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=i||""}function Ie(t,e,i,r){if(e.gutter&&(e.node.removeChild(e.gutter),e.gutter=null),e.gutterBackground&&(e.node.removeChild(e.gutterBackground),e.gutterBackground=null),e.line.gutterClass){var o=Ee(e);e.gutterBackground=n("div",null,"CodeMirror-gutter-background "+e.line.gutterClass,"left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),t.display.input.setUneditable(e.gutterBackground),o.insertBefore(e.gutterBackground,e.text)}var s=e.line.gutterMarkers;if(t.options.lineNumbers||s){var a=Ee(e),l=e.gutter=n("div",null,"CodeMirror-gutter-wrapper","left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(t.display.input.setUneditable(l),a.insertBefore(l,e.text),e.line.gutterClass&&(l.className+=" "+e.line.gutterClass),!t.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(e.lineNumber=l.appendChild(n("div",N(t.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+t.display.lineNumInnerWidth+"px"))),s)for(var h=0;h<t.options.gutters.length;++h){var u=t.options.gutters[h],c=s.hasOwnProperty(u)&&s[u];c&&l.appendChild(n("div",[c],"CodeMirror-gutter-elt","left: "+r.gutterLeft[u]+"px; width: "+r.gutterWidth[u]+"px"))}}}function Le(t,e,i){e.alignable&&(e.alignable=null);for(var n=e.node.firstChild,r=void 0;n;n=r)r=n.nextSibling,"CodeMirror-linewidget"==n.className&&e.node.removeChild(n);Ae(t,e,i)}function Ne(t,e,i,n){var r=Oe(t,e);return e.text=e.node=r.pre,r.bgClass&&(e.bgClass=r.bgClass),r.textClass&&(e.textClass=r.textClass),Re(t,e),Ie(t,e,i,n),Ae(t,e,n),e.node}function Ae(t,e,i){if(De(t,e.line,e,i,!0),e.rest)for(var n=0;n<e.rest.length;n++)De(t,e.rest[n],e,i,!1)}function De(t,e,i,r,o){if(e.widgets)for(var s=Ee(i),a=0,l=e.widgets;a<l.length;++a){var h=l[a],u=n("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||u.setAttribute("cm-ignore-events","true"),ze(h,u,i,r),t.display.input.setUneditable(u),o&&h.above?s.insertBefore(u,i.gutter||i.text):s.appendChild(u),Te(h,"redraw")}}function ze(t,e,i,n){if(t.noHScroll){(i.alignable||(i.alignable=[])).push(e);var r=n.wrapperWidth;e.style.left=n.fixedPos+"px",t.coverGutter||(r-=n.gutterTotalWidth,e.style.paddingLeft=n.gutterTotalWidth+"px"),e.style.width=r+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-n.gutterTotalWidth+"px"))}function He(t){if(null!=t.height)return t.height;var e=t.doc.cm;if(!e)return 0;if(!o(document.body,t.node)){var r="position: relative;";t.coverGutter&&(r+="margin-left: -"+e.display.gutters.offsetWidth+"px;"),t.noHScroll&&(r+="width: "+e.display.wrapper.clientWidth+"px;"),i(e.display.measure,n("div",[t.node],null,r))}return t.height=t.node.parentNode.offsetHeight}function Be(t,e){for(var i=Bt(e);i!=t.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==t.sizer&&i!=t.mover)return!0}function Fe(t){return t.lineSpace.offsetTop}function $e(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function je(t){if(t.cachedPaddingH)return t.cachedPaddingH;var e=i(t.measure,n("pre","x")),r=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,o={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(t.cachedPaddingH=o),o}function We(t){return Hs-t.display.nativeBarWidth}function qe(t){return t.display.scroller.clientWidth-We(t)-t.display.barWidth}function Ve(t){return t.display.scroller.clientHeight-We(t)-t.display.barHeight}function Ue(t,e,i){var n=t.options.lineWrapping,r=n&&qe(t);if(!e.measure.heights||n&&e.measure.width!=r){var o=e.measure.heights=[];if(n){e.measure.width=r;for(var s=e.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],h=s[a+1];Math.abs(l.bottom-h.bottom)>2&&o.push((l.bottom+h.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Ge(t,e,i){if(t.line==e)return{map:t.measure.map,cache:t.measure.cache};for(var n=0;n<t.rest.length;n++)if(t.rest[n]==e)return{map:t.measure.maps[n],cache:t.measure.caches[n]};for(var r=0;r<t.rest.length;r++)if(R(t.rest[r])>i)return{map:t.measure.maps[r],cache:t.measure.caches[r],before:!0}}function Ze(t,e){e=ct(e);var n=R(e),r=t.display.externalMeasured=new we(t.doc,e,n);r.lineN=n;var o=r.built=de(t,r);return r.text=o.pre,i(t.display.lineMeasure,o.pre),r}function Xe(t,e,i,n){return Je(t,Ke(t,e),i,n)}function Ye(t,e){if(e>=t.display.viewFrom&&e<t.display.viewTo)return t.display.view[Ci(t,e)];var i=t.display.externalMeasured;return i&&e>=i.lineN&&e<i.lineN+i.size?i:void 0}function Ke(t,e){var i=R(e),n=Ye(t,i);n&&!n.text?n=null:n&&n.changes&&(Pe(t,n,i,_i(t)),t.curOp.forceUpdate=!0),n||(n=Ze(t,e));var r=Ge(n,e,i);return{line:e,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function Je(t,e,i,n,r){e.before&&(i=-1);var o,s=i+(n||"");return e.cache.hasOwnProperty(s)?o=e.cache[s]:(e.rect||(e.rect=e.view.text.getBoundingClientRect()),e.hasHeights||(Ue(t,e.view,e.rect),e.hasHeights=!0),o=ei(t,e,i,n),o.bogus||(e.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}function Qe(t,e,i){for(var n,r,o,s,a,l,h=0;h<t.length;h+=3)if(a=t[h],l=t[h+1],e<a?(r=0,o=1,s="left"):e<l?(r=e-a,o=r+1):(h==t.length-3||e==l&&t[h+3]>e)&&(o=l-a,r=o-1,e>=l&&(s="right")),null!=r){if(n=t[h+2],a==l&&i==(n.insertLeft?"left":"right")&&(s=i),"left"==i&&0==r)for(;h&&t[h-2]==t[h-3]&&t[h-1].insertLeft;)n=t[2+(h-=3)],s="left";if("right"==i&&r==l-a)for(;h<t.length-3&&t[h+3]==t[h+4]&&!t[h+5].insertLeft;)n=t[(h+=3)+2],s="right";break}return{node:n,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function ti(t,e){var i=ma;if("left"==e)for(var n=0;n<t.length&&(i=t[n]).left==i.right;n++);else for(var r=t.length-1;r>=0&&(i=t[r]).left==i.right;r--);return i}function ei(t,e,i,n){var r,o=Qe(e.map,i,n),s=o.node,a=o.start,l=o.end,h=o.collapse;if(3==s.nodeType){for(var u=0;u<4;u++){for(;a&&S(e.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&S(e.line.text.charAt(o.coverStart+l));)++l;if(r=ps&&gs<9&&0==a&&l==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():ti(Ms(s,a,l).getClientRects(),n),r.left||r.right||0==a)break;l=a,a-=1,h="right"}
ps&&gs<11&&(r=ii(t.display.measure,r))}else{a>0&&(h=n="right");var c;r=t.options.lineWrapping&&(c=s.getClientRects()).length>1?c["right"==n?c.length-1:0]:s.getBoundingClientRect()}if(ps&&gs<9&&!a&&(!r||!r.left&&!r.right)){var d=s.parentNode.getClientRects()[0];r=d?{left:d.left,right:d.left+wi(t.display),top:d.top,bottom:d.bottom}:ma}for(var f=r.top-e.rect.top,p=r.bottom-e.rect.top,g=(f+p)/2,m=e.view.measure.heights,v=0;v<m.length-1&&!(g<m[v]);v++);var y=v?m[v-1]:0,w=m[v],_={left:("right"==h?r.right:r.left)-e.rect.left,right:("left"==h?r.left:r.right)-e.rect.left,top:y,bottom:w};return r.left||r.right||(_.bogus=!0),t.options.singleCursorHeightPerLine||(_.rtop=f,_.rbottom=p),_}function ii(t,e){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Wt(t))return e;var i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:e.left*i,right:e.right*i,top:e.top*n,bottom:e.bottom*n}}function ni(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(var e=0;e<t.rest.length;e++)t.measure.caches[e]={}}function ri(t){t.display.externalMeasure=null,e(t.display.lineMeasure);for(var i=0;i<t.display.view.length;i++)ni(t.display.view[i])}function oi(t){ri(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function si(){return ys&&Ts?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function ai(){return ys&&Ts?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function li(t,e,i,n,r){if(!r&&e.widgets)for(var o=0;o<e.widgets.length;++o)if(e.widgets[o].above){var s=He(e.widgets[o]);i.top+=s,i.bottom+=s}if("line"==n)return i;n||(n="local");var a=yt(e);if("local"==n?a+=Fe(t.display):a-=t.display.viewOffset,"page"==n||"window"==n){var l=t.display.lineSpace.getBoundingClientRect();a+=l.top+("window"==n?0:ai());var h=l.left+("window"==n?0:si());i.left+=h,i.right+=h}return i.top+=a,i.bottom+=a,i}function hi(t,e,i){if("div"==i)return e;var n=e.left,r=e.top;if("page"==i)n-=si(),r-=ai();else if("local"==i||!i){var o=t.display.sizer.getBoundingClientRect();n+=o.left,r+=o.top}var s=t.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:r-s.top}}function ui(t,e,i,n,r){return n||(n=E(t.doc,e.line)),li(t,n,Xe(t,n,e.ch,r),i)}function ci(t,e,i,n,r,o){function s(e,s){var a=Je(t,r,e,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,li(t,n,a,i)}function a(t,e,i){var n=l[e],r=n.level%2!=0;return s(i?t-1:t,r!=i)}n=n||E(t.doc,e.line),r||(r=Ke(t,n));var l=St(n,t.doc.direction),h=e.ch,u=e.sticky;if(h>=n.text.length?(h=n.text.length,u="before"):h<=0&&(h=0,u="after"),!l)return s("before"==u?h-1:h,"before"==u);var c=bt(l,h,u),d=Zs,f=a(h,c,"before"==u);return null!=d&&(f.other=a(h,d,"before"!=u)),f}function di(t,e){var i=0;e=j(t.doc,e),t.options.lineWrapping||(i=wi(t.display)*e.ch);var n=E(t.doc,e.line),r=yt(n)+Fe(t.display);return{left:i,right:i,top:r,bottom:r+n.height}}function fi(t,e,i,n,r){var o=A(t,e,i);return o.xRel=r,n&&(o.outside=!0),o}function pi(t,e,i){var n=t.doc;if((i+=t.display.viewOffset)<0)return fi(n.first,0,null,!0,-1);var r=I(n,i),o=n.first+n.size-1;if(r>o)return fi(n.first+n.size-1,E(n,o).text.length,null,!0,1);e<0&&(e=0);for(var s=E(n,r);;){var a=vi(t,s,r,e,i),l=ht(s),h=l&&l.find(0,!0);if(!l||!(a.ch>h.from.ch||a.ch==h.from.ch&&a.xRel>0))return a;r=R(s=h.to.line)}}function gi(t,e,i,n){var r=function(n){return li(t,e,Je(t,i,n),"line")},o=e.text.length,s=C(function(t){return r(t-1).bottom<=n},o,0);return o=C(function(t){return r(t).top>n},s,o),{begin:s,end:o}}function mi(t,e,i,n){return gi(t,e,i,li(t,e,Je(t,i,n),"line").top)}function vi(t,e,i,n,r){r-=yt(e);var o,s=0,a=e.text.length,l=Ke(t,e);if(St(e,t.doc.direction)){if(t.options.lineWrapping){var h;h=gi(t,e,l,r),s=h.begin,a=h.end}o=new A(i,Math.floor(s+(a-s)/2));var u,c,d=ci(t,o,"line",e,l).left,f=d<n?1:-1,p=d-n,g=Math.ceil((a-s)/4);t:do{u=p,c=o;for(var m=0;m<g;++m){var v=o;if(null==(o=Et(t,e,o,f))||o.ch<s||a<=("before"==o.sticky?o.ch-1:o.ch)){o=v;break t}}if(p=ci(t,o,"line",e,l).left-n,g>1){var y=Math.abs(p-u)/g;g=Math.min(g,Math.ceil(Math.abs(p)/y)),f=p<0?1:-1}}while(0!=p&&(g>1||f<0!=p<0&&Math.abs(p)<=Math.abs(u)));if(Math.abs(p)>Math.abs(u)){if(p<0==u<0)throw new Error("Broke out of infinite loop in coordsCharInner");o=c}}else{var w=C(function(i){var o=li(t,e,Je(t,l,i),"line");return o.top>r?(a=Math.min(i,a),!0):!(o.bottom<=r)&&(o.left>n||!(o.right<n)&&n-o.left<o.right-n)},s,a);w=T(e.text,w,1),o=new A(i,w,w==a?"before":"after")}var _=ci(t,o,"line",e,l);return(r<_.top||_.bottom<r)&&(o.outside=!0),o.xRel=n<_.left?-1:n>_.right?1:0,o}function yi(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==ca){ca=n("pre");for(var r=0;r<49;++r)ca.appendChild(document.createTextNode("x")),ca.appendChild(n("br"));ca.appendChild(document.createTextNode("x"))}i(t.measure,ca);var o=ca.offsetHeight/50;return o>3&&(t.cachedTextHeight=o),e(t.measure),o||1}function wi(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var e=n("span","xxxxxxxxxx"),r=n("pre",[e]);i(t.measure,r);var o=e.getBoundingClientRect(),s=(o.right-o.left)/10;return s>2&&(t.cachedCharWidth=s),s||10}function _i(t){for(var e=t.display,i={},n={},r=e.gutters.clientLeft,o=e.gutters.firstChild,s=0;o;o=o.nextSibling,++s)i[t.options.gutters[s]]=o.offsetLeft+o.clientLeft+r,n[t.options.gutters[s]]=o.clientWidth;return{fixedPos:xi(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:e.wrapper.clientWidth}}function xi(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function bi(t){var e=yi(t.display),i=t.options.lineWrapping,n=i&&Math.max(5,t.display.scroller.clientWidth/wi(t.display)-3);return function(r){if(mt(t.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return i?o+(Math.ceil(r.text.length/n)||1)*e:o+e}}function Si(t){var e=t.doc,i=bi(t);e.iter(function(t){var e=i(t);e!=t.height&&M(t,e)})}function Ti(t,e,i,n){var r=t.display;if(!i&&"true"==Bt(e).getAttribute("cm-not-content"))return null;var o,s,a=r.lineSpace.getBoundingClientRect();try{o=e.clientX-a.left,s=e.clientY-a.top}catch(e){return null}var l,h=pi(t,o,s);if(n&&1==h.xRel&&(l=E(t.doc,h.line).text).length==h.ch){var u=c(l,l.length,t.options.tabSize)-l.length;h=A(h.line,Math.max(0,Math.round((o-je(t.display).left)/wi(t.display))-u))}return h}function Ci(t,e){if(e>=t.display.viewTo)return null;if((e-=t.display.viewFrom)<0)return null;for(var i=t.display.view,n=0;n<i.length;n++)if((e-=i[n].size)<0)return n}function Pi(t){t.display.input.showSelection(t.display.input.prepareSelection())}function Ei(t,e){for(var i=t.doc,n={},r=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=0;s<i.sel.ranges.length;s++)if(!1!==e||s!=i.sel.primIndex){var a=i.sel.ranges[s];if(!(a.from().line>=t.display.viewTo||a.to().line<t.display.viewFrom)){var l=a.empty();(l||t.options.showCursorWhenSelecting)&&ki(t,a.head,r),l||Oi(t,a,o)}}return n}function ki(t,e,i){var r=ci(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),o=i.appendChild(n("div","\xa0","CodeMirror-cursor"));if(o.style.left=r.left+"px",o.style.top=r.top+"px",o.style.height=Math.max(0,r.bottom-r.top)*t.options.cursorHeight+"px",r.other){var s=i.appendChild(n("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"));s.style.display="",s.style.left=r.other.left+"px",s.style.top=r.other.top+"px",s.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Oi(t,e,i){function r(t,e,i,r){e<0&&(e=0),e=Math.round(e),r=Math.round(r),l.appendChild(n("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px;\n                             top: "+e+"px; width: "+(null==i?c-t:i)+"px;\n                             height: "+(r-e)+"px"))}function o(e,i,n){function o(i,n){return ui(t,A(e,i),"div",h,n)}var s,l,h=E(a,e),d=h.text.length;return xt(St(h,a.direction),i||0,null==n?d:n,function(t,e,a){var h,f,p,g=o(t,"left");if(t==e)h=g,f=p=g.left;else{if(h=o(e-1,"right"),"rtl"==a){var m=g;g=h,h=m}f=g.left,p=h.right}null==i&&0==t&&(f=u),h.top-g.top>3&&(r(f,g.top,null,g.bottom),f=u,g.bottom<h.top&&r(f,g.bottom,null,h.top)),null==n&&e==d&&(p=c),(!s||g.top<s.top||g.top==s.top&&g.left<s.left)&&(s=g),(!l||h.bottom>l.bottom||h.bottom==l.bottom&&h.right>l.right)&&(l=h),f<u+1&&(f=u),r(f,h.top,p-f,h.bottom)}),{start:s,end:l}}var s=t.display,a=t.doc,l=document.createDocumentFragment(),h=je(t.display),u=h.left,c=Math.max(s.sizerWidth,qe(t)-s.sizer.offsetLeft)-h.right,d=e.from(),f=e.to();if(d.line==f.line)o(d.line,d.ch,f.ch);else{var p=E(a,d.line),g=E(a,f.line),m=ct(p)==ct(g),v=o(d.line,d.ch,m?p.text.length+1:null).end,y=o(f.line,m?0:null,f.ch).start;m&&(v.top<y.top-2?(r(v.right,v.top,null,v.bottom),r(u,y.top,y.left,y.bottom)):r(v.right,v.top,y.left-v.right,v.bottom)),v.bottom<y.top&&r(u,v.bottom,null,y.top)}i.appendChild(l)}function Mi(t){if(t.state.focused){var e=t.display;clearInterval(e.blinker);var i=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval(function(){return e.cursorDiv.style.visibility=(i=!i)?"":"hidden"},t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}}function Ri(t){t.state.focused||(t.display.input.focus(),Li(t))}function Ii(t){t.state.delayingBlurEvent=!0,setTimeout(function(){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,Ni(t))},100)}function Li(t,e){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(Mt(t,"focus",t,e),t.state.focused=!0,a(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),ms&&setTimeout(function(){return t.display.input.reset(!0)},20)),t.display.input.receivedFocus()),Mi(t))}function Ni(t,e){t.state.delayingBlurEvent||(t.state.focused&&(Mt(t,"blur",t,e),t.state.focused=!1,Ls(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout(function(){t.state.focused||(t.display.shift=!1)},150))}function Ai(t){for(var e=t.display,i=e.lineDiv.offsetTop,n=0;n<e.view.length;n++){var r=e.view[n],o=void 0;if(!r.hidden){if(ps&&gs<8){var s=r.node.offsetTop+r.node.offsetHeight;o=s-i,i=s}else{var a=r.node.getBoundingClientRect();o=a.bottom-a.top}var l=r.line.height-o;if(o<2&&(o=yi(e)),(l>.005||l<-.005)&&(M(r.line,o),Di(r.line),r.rest))for(var h=0;h<r.rest.length;h++)Di(r.rest[h])}}}function Di(t){if(t.widgets)for(var e=0;e<t.widgets.length;++e)t.widgets[e].height=t.widgets[e].node.parentNode.offsetHeight}function zi(t,e,i){var n=i&&null!=i.top?Math.max(0,i.top):t.scroller.scrollTop;n=Math.floor(n-Fe(t));var r=i&&null!=i.bottom?i.bottom:n+t.wrapper.clientHeight,o=I(e,n),s=I(e,r);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;a<o?(o=a,s=I(e,yt(E(e,a))+t.wrapper.clientHeight)):Math.min(l,e.lastLine())>=s&&(o=I(e,yt(E(e,l))-t.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function Hi(t){var e=t.display,i=e.view;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var n=xi(e)-e.scroller.scrollLeft+t.doc.scrollLeft,r=e.gutters.offsetWidth,o=n+"px",s=0;s<i.length;s++)if(!i[s].hidden){t.options.fixedGutter&&(i[s].gutter&&(i[s].gutter.style.left=o),i[s].gutterBackground&&(i[s].gutterBackground.style.left=o));var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}t.options.fixedGutter&&(e.gutters.style.left=n+r+"px")}}function Bi(t){if(!t.options.lineNumbers)return!1;var e=t.doc,i=N(t.options,e.first+e.size-1),r=t.display;if(i.length!=r.lineNumChars){var o=r.measure.appendChild(n("div",[n("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),s=o.firstChild.offsetWidth,a=o.offsetWidth-s;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(s,r.lineGutter.offsetWidth-a)+1,r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",Rn(t),!0}return!1}function Fi(t,e){if(!Rt(t,"scrollCursorIntoView")){var i=t.display,r=i.sizer.getBoundingClientRect(),o=null;if(e.top+r.top<0?o=!0:e.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!bs){var s=n("div","\u200b",null,"position: absolute;\n                         top: "+(e.top-i.viewOffset-Fe(t.display))+"px;\n                         height: "+(e.bottom-e.top+We(t)+i.barHeight)+"px;\n                         left: "+e.left+"px; width: "+Math.max(2,e.right-e.left)+"px;");t.display.lineSpace.appendChild(s),s.scrollIntoView(o),t.display.lineSpace.removeChild(s)}}}function $i(t,e,i,n){null==n&&(n=0);var r;t.options.lineWrapping||e!=i||(e=e.ch?A(e.line,"before"==e.sticky?e.ch-1:e.ch,"after"):e,i="before"==e.sticky?A(e.line,e.ch+1,"before"):e);for(var o=0;o<5;o++){var s=!1,a=ci(t,e),l=i&&i!=e?ci(t,i):a;r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-n,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+n};var h=Wi(t,r),u=t.doc.scrollTop,c=t.doc.scrollLeft;if(null!=h.scrollTop&&(Yi(t,h.scrollTop),Math.abs(t.doc.scrollTop-u)>1&&(s=!0)),null!=h.scrollLeft&&(Ji(t,h.scrollLeft),Math.abs(t.doc.scrollLeft-c)>1&&(s=!0)),!s)break}return r}function ji(t,e){var i=Wi(t,e);null!=i.scrollTop&&Yi(t,i.scrollTop),null!=i.scrollLeft&&Ji(t,i.scrollLeft)}function Wi(t,e){var i=t.display,n=yi(t.display);e.top<0&&(e.top=0);var r=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:i.scroller.scrollTop,o=Ve(t),s={};e.bottom-e.top>o&&(e.bottom=e.top+o);var a=t.doc.height+$e(i),l=e.top<n,h=e.bottom>a-n;if(e.top<r)s.scrollTop=l?0:e.top;else if(e.bottom>r+o){var u=Math.min(e.top,(h?a:e.bottom)-o);u!=r&&(s.scrollTop=u)}var c=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:i.scroller.scrollLeft,d=qe(t)-(t.options.fixedGutter?i.gutters.offsetWidth:0),f=e.right-e.left>d;return f&&(e.right=e.left+d),e.left<10?s.scrollLeft=0:e.left<c?s.scrollLeft=Math.max(0,e.left-(f?0:10)):e.right>d+c-3&&(s.scrollLeft=e.right+(f?0:10)-d),s}function qi(t,e){null!=e&&(Zi(t),t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+e)}function Vi(t){Zi(t);var e=t.getCursor();t.curOp.scrollToPos={from:e,to:e,margin:t.options.cursorScrollMargin}}function Ui(t,e,i){null==e&&null==i||Zi(t),null!=e&&(t.curOp.scrollLeft=e),null!=i&&(t.curOp.scrollTop=i)}function Gi(t,e){Zi(t),t.curOp.scrollToPos=e}function Zi(t){var e=t.curOp.scrollToPos;if(e){t.curOp.scrollToPos=null;Xi(t,di(t,e.from),di(t,e.to),e.margin)}}function Xi(t,e,i,n){var r=Wi(t,{left:Math.min(e.left,i.left),top:Math.min(e.top,i.top)-n,right:Math.max(e.right,i.right),bottom:Math.max(e.bottom,i.bottom)+n});Ui(t,r.scrollLeft,r.scrollTop)}function Yi(t,e){Math.abs(t.doc.scrollTop-e)<2||(us||On(t,{top:e}),Ki(t,e,!0),us&&On(t),bn(t,100))}function Ki(t,e,i){e=Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,e),(t.display.scroller.scrollTop!=e||i)&&(t.doc.scrollTop=e,t.display.scrollbars.setScrollTop(e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e))}function Ji(t,e,i,n){e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),(i?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)&&!n||(t.doc.scrollLeft=e,Hi(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbars.setScrollLeft(e))}function Qi(t){var e=t.display,i=e.gutters.offsetWidth,n=Math.round(t.doc.height+$e(t.display));return{clientHeight:e.scroller.clientHeight,viewHeight:e.wrapper.clientHeight,scrollWidth:e.scroller.scrollWidth,clientWidth:e.scroller.clientWidth,viewWidth:e.wrapper.clientWidth,barLeft:t.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+We(t)+e.barHeight,nativeBarWidth:e.nativeBarWidth,gutterWidth:i}}function tn(t,e){e||(e=Qi(t));var i=t.display.barWidth,n=t.display.barHeight;en(t,e);for(var r=0;r<4&&i!=t.display.barWidth||n!=t.display.barHeight;r++)i!=t.display.barWidth&&t.options.lineWrapping&&Ai(t),en(t,Qi(t)),i=t.display.barWidth,n=t.display.barHeight}function en(t,e){var i=t.display,n=i.scrollbars.update(e);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px",i.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=n.bottom+"px",i.scrollbarFiller.style.width=n.right+"px"):i.scrollbarFiller.style.display="",n.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=n.bottom+"px",i.gutterFiller.style.width=e.gutterWidth+"px"):i.gutterFiller.style.display=""}function nn(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&Ls(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new wa[t.options.scrollbarStyle](function(e){t.display.wrapper.insertBefore(e,t.display.scrollbarFiller),Ks(e,"mousedown",function(){t.state.focused&&setTimeout(function(){return t.display.input.focus()},0)}),e.setAttribute("cm-not-content","true")},function(e,i){"horizontal"==i?Ji(t,e):Yi(t,e)},t),t.display.scrollbars.addClass&&a(t.display.wrapper,t.display.scrollbars.addClass)}function rn(t){t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++_a},xe(t.curOp)}function on(t){Se(t.curOp,function(t){for(var e=0;e<t.ops.length;e++)t.ops[e].cm.curOp=null;sn(t)})}function sn(t){for(var e=t.ops,i=0;i<e.length;i++)an(e[i]);for(var n=0;n<e.length;n++)ln(e[n]);for(var r=0;r<e.length;r++)hn(e[r]);for(var o=0;o<e.length;o++)un(e[o]);for(var s=0;s<e.length;s++)cn(e[s])}function an(t){var e=t.cm,i=e.display;Tn(e),t.updateMaxLine&&_t(e),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<i.viewFrom||t.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&e.options.lineWrapping,t.update=t.mustUpdate&&new xa(e,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function ln(t){t.updatedDisplay=t.mustUpdate&&En(t.cm,t.update)}function hn(t){var e=t.cm,i=e.display;t.updatedDisplay&&Ai(e),t.barMeasure=Qi(e),i.maxLineChanged&&!e.options.lineWrapping&&(t.adjustWidthTo=Xe(e,i.maxLine,i.maxLine.text.length).left+3,e.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+t.adjustWidthTo+We(e)+e.display.barWidth),t.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+t.adjustWidthTo-qe(e))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=i.input.prepareSelection(t.focus))}function un(t){var e=t.cm;null!=t.adjustWidthTo&&(e.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<e.doc.scrollLeft&&Ji(e,Math.min(e.display.scroller.scrollLeft,t.maxScrollLeft),!0),e.display.maxLineChanged=!1);var i=t.focus&&t.focus==s()&&(!document.hasFocus||document.hasFocus());t.preparedSelection&&e.display.input.showSelection(t.preparedSelection,i),(t.updatedDisplay||t.startHeight!=e.doc.height)&&tn(e,t.barMeasure),t.updatedDisplay&&In(e,t.barMeasure),t.selectionChanged&&Mi(e),e.state.focused&&t.updateInput&&e.display.input.reset(t.typing),i&&Ri(t.cm)}function cn(t){var e=t.cm,i=e.display,n=e.doc;if(t.updatedDisplay&&kn(e,t.update),null==i.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=t.scrollTop&&Ki(e,t.scrollTop,t.forceScroll),null!=t.scrollLeft&&Ji(e,t.scrollLeft,!0,!0),t.scrollToPos){Fi(e,$i(e,j(n,t.scrollToPos.from),j(n,t.scrollToPos.to),t.scrollToPos.margin))}var r=t.maybeHiddenMarkers,o=t.maybeUnhiddenMarkers;if(r)for(var s=0;s<r.length;++s)r[s].lines.length||Mt(r[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&Mt(o[a],"unhide");i.wrapper.offsetHeight&&(n.scrollTop=e.display.scroller.scrollTop),t.changeObjs&&Mt(e,"changes",e,t.changeObjs),t.update&&t.update.finish()}function dn(t,e){if(t.curOp)return e();rn(t);try{return e()}finally{on(t)}}function fn(t,e){return function(){if(t.curOp)return e.apply(t,arguments);rn(t);try{return e.apply(t,arguments)}finally{on(t)}}}function pn(t){return function(){if(this.curOp)return t.apply(this,arguments);rn(this);try{return t.apply(this,arguments)}finally{on(this)}}}function gn(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);rn(e);try{return t.apply(this,arguments)}finally{on(e)}}}function mn(t,e,i,n){null==e&&(e=t.doc.first),null==i&&(i=t.doc.first+t.doc.size),n||(n=0);var r=t.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>e)&&(r.updateLineNumbers=e),t.curOp.viewChanged=!0,e>=r.viewTo)Gs&&pt(t.doc,e)<r.viewTo&&yn(t);else if(i<=r.viewFrom)Gs&&gt(t.doc,i+n)>r.viewFrom?yn(t):(r.viewFrom+=n,r.viewTo+=n);else if(e<=r.viewFrom&&i>=r.viewTo)yn(t);else if(e<=r.viewFrom){var o=wn(t,i,i+n,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=n):yn(t)}else if(i>=r.viewTo){var s=wn(t,e,e,-1);s?(r.view=r.view.slice(0,s.index),r.viewTo=s.lineN):yn(t)}else{var a=wn(t,e,e,-1),l=wn(t,i,i+n,1);a&&l?(r.view=r.view.slice(0,a.index).concat(_e(t,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=n):yn(t)}var h=r.externalMeasured;h&&(i<h.lineN?h.lineN+=n:e<h.lineN+h.size&&(r.externalMeasured=null))}function vn(t,e,i){t.curOp.viewChanged=!0;var n=t.display,r=t.display.externalMeasured;if(r&&e>=r.lineN&&e<r.lineN+r.size&&(n.externalMeasured=null),!(e<n.viewFrom||e>=n.viewTo)){var o=n.view[Ci(t,e)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==d(s,i)&&s.push(i)}}}function yn(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function wn(t,e,i,n){var r,o=Ci(t,e),s=t.display.view;if(!Gs||i==t.doc.first+t.doc.size)return{index:o,lineN:i};for(var a=t.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=e){if(n>0){if(o==s.length-1)return null;r=a+s[o].size-e,o++}else r=a-e;e+=r,i+=r}for(;pt(t.doc,i)!=i;){if(o==(n<0?0:s.length-1))return null;i+=n*s[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:i}}function _n(t,e,i){var n=t.display;0==n.view.length||e>=n.viewTo||i<=n.viewFrom?(n.view=_e(t,e,i),n.viewFrom=e):(n.viewFrom>e?n.view=_e(t,e,n.viewFrom).concat(n.view):n.viewFrom<e&&(n.view=n.view.slice(Ci(t,e))),n.viewFrom=e,n.viewTo<i?n.view=n.view.concat(_e(t,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,Ci(t,i)))),n.viewTo=i}function xn(t){for(var e=t.display.view,i=0,n=0;n<e.length;n++){var r=e[n];r.hidden||r.node&&!r.changes||++i}return i}function bn(t,e){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(e,h(Sn,t))}function Sn(t){var e=t.doc;if(!(e.highlightFrontier>=t.display.viewTo)){var i=+new Date+t.options.workTime,n=te(t,e.highlightFrontier),r=[];e.iter(n.line,Math.min(e.first+e.size,t.display.viewTo+500),function(o){if(n.line>=t.display.viewFrom){var s=o.styles,a=o.text.length>t.options.maxHighlightLength?Xt(e.mode,n.state):null,l=Jt(t,o,n,!0);a&&(n.state=a),o.styles=l.styles;var h=o.styleClasses,u=l.classes;u?o.styleClasses=u:h&&(o.styleClasses=null);for(var c=!s||s.length!=o.styles.length||h!=u&&(!h||!u||h.bgClass!=u.bgClass||h.textClass!=u.textClass),d=0;!c&&d<s.length;++d)c=s[d]!=o.styles[d];c&&r.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=t.options.maxHighlightLength&&ee(t,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>i)return bn(t,t.options.workDelay),!0}),e.highlightFrontier=n.line,e.modeFrontier=Math.max(e.modeFrontier,n.line),r.length&&dn(t,function(){for(var e=0;e<r.length;e++)vn(t,r[e],"text")})}}function Tn(t){var e=t.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=We(t)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=We(t)+"px",e.scrollbarsClipped=!0)}function Cn(t){if(t.hasFocus())return null;var e=s();if(!e||!o(t.display.lineDiv,e))return null;var i={activeElt:e};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&o(t.display.lineDiv,n.anchorNode)&&(i.anchorNode=n.anchorNode,i.anchorOffset=n.anchorOffset,i.focusNode=n.focusNode,i.focusOffset=n.focusOffset)}return i}function Pn(t){if(t&&t.activeElt&&t.activeElt!=s()&&(t.activeElt.focus(),t.anchorNode&&o(document.body,t.anchorNode)&&o(document.body,t.focusNode))){var e=window.getSelection(),i=document.createRange();i.setEnd(t.anchorNode,t.anchorOffset),i.collapse(!1),e.removeAllRanges(),e.addRange(i),e.extend(t.focusNode,t.focusOffset)}}function En(t,i){var n=t.display,r=t.doc;if(i.editorIsHidden)return yn(t),!1;if(!i.force&&i.visible.from>=n.viewFrom&&i.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==xn(t))return!1;Bi(t)&&(yn(t),i.dims=_i(t));var o=r.first+r.size,s=Math.max(i.visible.from-t.options.viewportMargin,r.first),a=Math.min(o,i.visible.to+t.options.viewportMargin);n.viewFrom<s&&s-n.viewFrom<20&&(s=Math.max(r.first,n.viewFrom)),n.viewTo>a&&n.viewTo-a<20&&(a=Math.min(o,n.viewTo)),Gs&&(s=pt(t.doc,s),a=gt(t.doc,a));var l=s!=n.viewFrom||a!=n.viewTo||n.lastWrapHeight!=i.wrapperHeight||n.lastWrapWidth!=i.wrapperWidth;_n(t,s,a),n.viewOffset=yt(E(t.doc,n.viewFrom)),t.display.mover.style.top=n.viewOffset+"px";var h=xn(t);if(!l&&0==h&&!i.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var u=Cn(t);return h>4&&(n.lineDiv.style.display="none"),Mn(t,n.updateLineNumbers,i.dims),h>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Pn(u),e(n.cursorDiv),e(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,l&&(n.lastWrapHeight=i.wrapperHeight,n.lastWrapWidth=i.wrapperWidth,bn(t,400)),n.updateLineNumbers=null,!0}function kn(t,e){for(var i=e.viewport,n=!0;(n&&t.options.lineWrapping&&e.oldDisplayWidth!=qe(t)||(i&&null!=i.top&&(i={top:Math.min(t.doc.height+$e(t.display)-Ve(t),i.top)}),e.visible=zi(t.display,t.doc,i),!(e.visible.from>=t.display.viewFrom&&e.visible.to<=t.display.viewTo)))&&En(t,e);n=!1){Ai(t);var r=Qi(t);Pi(t),tn(t,r),In(t,r),e.force=!1}e.signal(t,"update",t),t.display.viewFrom==t.display.reportedViewFrom&&t.display.viewTo==t.display.reportedViewTo||(e.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function On(t,e){var i=new xa(t,e);if(En(t,i)){Ai(t),kn(t,i);var n=Qi(t);Pi(t),tn(t,n),In(t,n),i.finish()}}function Mn(t,i,n){function r(e){var i=e.nextSibling;return ms&&Ps&&t.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),i}for(var o=t.display,s=t.options.lineNumbers,a=o.lineDiv,l=a.firstChild,h=o.view,u=o.viewFrom,c=0;c<h.length;c++){var f=h[c];if(f.hidden);else if(f.node&&f.node.parentNode==a){for(;l!=f.node;)l=r(l);var p=s&&null!=i&&i<=u&&f.lineNumber;f.changes&&(d(f.changes,"gutter")>-1&&(p=!1),Pe(t,f,u,n)),p&&(e(f.lineNumber),f.lineNumber.appendChild(document.createTextNode(N(t.options,u)))),l=f.node.nextSibling}else{var g=Ne(t,f,u,n);a.insertBefore(g,l)}u+=f.size}for(;l;)l=r(l)}function Rn(t){var e=t.display.gutters.offsetWidth;t.display.sizer.style.marginLeft=e+"px"}function In(t,e){t.display.sizer.style.minHeight=e.docHeight+"px",t.display.heightForcer.style.top=e.docHeight+"px",t.display.gutters.style.height=e.docHeight+t.display.barHeight+We(t)+"px"}function Ln(t){var i=t.display.gutters,r=t.options.gutters;e(i);for(var o=0;o<r.length;++o){var s=r[o],a=i.appendChild(n("div",null,"CodeMirror-gutter "+s));"CodeMirror-linenumbers"==s&&(t.display.lineGutter=a,a.style.width=(t.display.lineNumWidth||1)+"px")}i.style.display=o?"":"none",Rn(t)}function Nn(t){var e=d(t.gutters,"CodeMirror-linenumbers");-1==e&&t.lineNumbers?t.gutters=t.gutters.concat(["CodeMirror-linenumbers"]):e>-1&&!t.lineNumbers&&(t.gutters=t.gutters.slice(0),t.gutters.splice(e,1))}function An(t){var e=t.wheelDeltaX,i=t.wheelDeltaY;return null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(e=t.detail),null==i&&t.detail&&t.axis==t.VERTICAL_AXIS?i=t.detail:null==i&&(i=t.wheelDelta),{x:e,y:i}}function Dn(t){var e=An(t);return e.x*=Sa,e.y*=Sa,e}function zn(t,e){var i=An(e),n=i.x,r=i.y,o=t.display,s=o.scroller,a=s.scrollWidth>s.clientWidth,l=s.scrollHeight>s.clientHeight;if(n&&a||r&&l){if(r&&Ps&&ms)t:for(var h=e.target,u=o.view;h!=s;h=h.parentNode)for(var c=0;c<u.length;c++)if(u[c].node==h){t.display.currentWheelTarget=h;break t}if(n&&!us&&!ws&&null!=Sa)return r&&l&&Yi(t,Math.max(0,s.scrollTop+r*Sa)),Ji(t,Math.max(0,s.scrollLeft+n*Sa)),(!r||r&&l)&&At(e),void(o.wheelStartX=null);if(r&&null!=Sa){var d=r*Sa,f=t.doc.scrollTop,p=f+o.wrapper.clientHeight;d<0?f=Math.max(0,f+d-50):p=Math.min(t.doc.height,p+d+50),On(t,{top:f,bottom:p})}ba<20&&(null==o.wheelStartX?(o.wheelStartX=s.scrollLeft,o.wheelStartY=s.scrollTop,o.wheelDX=n,o.wheelDY=r,setTimeout(function(){if(null!=o.wheelStartX){var t=s.scrollLeft-o.wheelStartX,e=s.scrollTop-o.wheelStartY,i=e&&o.wheelDY&&e/o.wheelDY||t&&o.wheelDX&&t/o.wheelDX;o.wheelStartX=o.wheelStartY=null,i&&(Sa=(Sa*ba+i)/(ba+1),++ba)}},200)):(o.wheelDX+=n,o.wheelDY+=r))}}function Hn(t,e){var i=t[e];t.sort(function(t,e){return D(t.from(),e.from())}),e=d(t,i);for(var n=1;n<t.length;n++){var r=t[n],o=t[n-1];if(D(o.to(),r.from())>=0){var s=F(o.from(),r.from()),a=B(o.to(),r.to()),l=o.empty()?r.from()==r.head:o.from()==o.head;n<=e&&--e,t.splice(--n,2,new Ca(l?a:s,l?s:a))}}return new Ta(t,e)}function Bn(t,e){return new Ta([new Ca(t,e||t)],0)}function Fn(t){return t.text?A(t.from.line+t.text.length-1,g(t.text).length+(1==t.text.length?t.from.ch:0)):t.to}function $n(t,e){if(D(t,e.from)<0)return t;if(D(t,e.to)<=0)return Fn(e);var i=t.line+e.text.length-(e.to.line-e.from.line)-1,n=t.ch;return t.line==e.to.line&&(n+=Fn(e).ch-e.to.ch),A(i,n)}function jn(t,e){for(var i=[],n=0;n<t.sel.ranges.length;n++){var r=t.sel.ranges[n];i.push(new Ca($n(r.anchor,e),$n(r.head,e)))}return Hn(i,t.sel.primIndex)}function Wn(t,e,i){return t.line==e.line?A(i.line,t.ch-e.ch+i.ch):A(i.line+(t.line-e.line),t.ch)}function qn(t,e,i){for(var n=[],r=A(t.first,0),o=r,s=0;s<e.length;s++){var a=e[s],l=Wn(a.from,r,o),h=Wn(Fn(a),r,o);if(r=a.to,o=h,"around"==i){var u=t.sel.ranges[s],c=D(u.head,u.anchor)<0;n[s]=new Ca(c?h:l,c?l:h)}else n[s]=new Ca(l,l)}return new Ta(n,t.sel.primIndex)}function Vn(t){t.doc.mode=Gt(t.options,t.doc.modeOption),Un(t)}function Un(t){t.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,bn(t,100),t.state.modeGen++,t.curOp&&mn(t)}function Gn(t,e){return 0==e.from.ch&&0==e.to.ch&&""==g(e.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function Zn(t,e,i,n){function r(t){return i?i[t]:null}function o(t,i,r){he(t,i,r,n),Te(t,"change",t,e)}function s(t,e){for(var i=[],o=t;o<e;++o)i.push(new ua(h[o],r(o),n));return i}var a=e.from,l=e.to,h=e.text,u=E(t,a.line),c=E(t,l.line),d=g(h),f=r(h.length-1),p=l.line-a.line;if(e.full)t.insert(0,s(0,h.length)),t.remove(h.length,t.size-h.length);else if(Gn(t,e)){var m=s(0,h.length-1);o(c,c.text,f),p&&t.remove(a.line,p),m.length&&t.insert(a.line,m)}else if(u==c)if(1==h.length)o(u,u.text.slice(0,a.ch)+d+u.text.slice(l.ch),f);else{var v=s(1,h.length-1);v.push(new ua(d+u.text.slice(l.ch),f,n)),o(u,u.text.slice(0,a.ch)+h[0],r(0)),t.insert(a.line+1,v)}else if(1==h.length)o(u,u.text.slice(0,a.ch)+h[0]+c.text.slice(l.ch),r(0)),t.remove(a.line+1,p);else{o(u,u.text.slice(0,a.ch)+h[0],r(0)),o(c,d+c.text.slice(l.ch),f);var y=s(1,h.length-1);p>1&&t.remove(a.line+1,p-1),t.insert(a.line+1,y)}Te(t,"change",t,e)}function Xn(t,e,i){function n(t,r,o){if(t.linked)for(var s=0;s<t.linked.length;++s){var a=t.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;i&&!l||(e(a.doc,l),n(a.doc,t,l))}}}n(t,null,!0)}function Yn(t,e){if(e.cm)throw new Error("This document is already in use.");t.doc=e,e.cm=t,Si(t),Vn(t),Kn(t),t.options.lineWrapping||_t(t),t.options.mode=e.modeOption,mn(t)}function Kn(t){("rtl"==t.doc.direction?a:Ls)(t.display.lineDiv,"CodeMirror-rtl")}function Jn(t){dn(t,function(){Kn(t),mn(t)})}function Qn(t){this.done=[],this.undone=[],this.undoDepth=Infinity,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t||1}function tr(t,e){var i={from:H(e.from),to:Fn(e),text:k(t,e.from,e.to)};return ar(t,i,e.from.line,e.to.line+1),Xn(t,function(t){return ar(t,i,e.from.line,e.to.line+1)},!0),i}function er(t){for(;t.length;){
if(!g(t).ranges)break;t.pop()}}function ir(t,e){return e?(er(t.done),g(t.done)):t.done.length&&!g(t.done).ranges?g(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),g(t.done)):void 0}function nr(t,e,i,n){var r=t.history;r.undone.length=0;var o,s,a=+new Date;if((r.lastOp==n||r.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&t.cm&&r.lastModTime>a-t.cm.options.historyEventDelay||"*"==e.origin.charAt(0)))&&(o=ir(r,r.lastOp==n)))s=g(o.changes),0==D(e.from,e.to)&&0==D(e.from,s.to)?s.to=Fn(e):o.changes.push(tr(t,e));else{var l=g(r.done);for(l&&l.ranges||sr(t.sel,r.done),o={changes:[tr(t,e)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=n,r.lastOrigin=r.lastSelOrigin=e.origin,s||Mt(t,"historyAdded")}function rr(t,e,i,n){var r=e.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}function or(t,e,i,n){var r=t.history,o=n&&n.origin;i==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||rr(t,o,g(r.done),e))?r.done[r.done.length-1]=e:sr(e,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=i,n&&!1!==n.clearRedo&&er(r.undone)}function sr(t,e){var i=g(e);i&&i.ranges&&i.equals(t)||e.push(t)}function ar(t,e,i,n){var r=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,i),Math.min(t.first+t.size,n),function(i){i.markedSpans&&((r||(r=e["spans_"+t.id]={}))[o]=i.markedSpans),++o})}function lr(t){if(!t)return null;for(var e,i=0;i<t.length;++i)t[i].marker.explicitlyCleared?e||(e=t.slice(0,i)):e&&e.push(t[i]);return e?e.length?e:null:t}function hr(t,e){var i=e["spans_"+t.id];if(!i)return null;for(var n=[],r=0;r<e.text.length;++r)n.push(lr(i[r]));return n}function ur(t,e){var i=hr(t,e),n=Q(t,e);if(!i)return n;if(!n)return i;for(var r=0;r<i.length;++r){var o=i[r],s=n[r];if(o&&s)t:for(var a=0;a<s.length;++a){for(var l=s[a],h=0;h<o.length;++h)if(o[h].marker==l.marker)continue t;o.push(l)}else s&&(i[r]=s)}return i}function cr(t,e,i){for(var n=[],r=0;r<t.length;++r){var o=t[r];if(o.ranges)n.push(i?Ta.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];n.push({changes:a});for(var l=0;l<s.length;++l){var h=s[l],u=void 0;if(a.push({from:h.from,to:h.to,text:h.text}),e)for(var c in h)(u=c.match(/^spans_(\d+)$/))&&d(e,Number(u[1]))>-1&&(g(a)[c]=h[c],delete h[c])}}}return n}function dr(t,e,i,n){if(n){var r=t.anchor;if(i){var o=D(e,r)<0;o!=D(i,r)<0?(r=e,e=i):o!=D(e,i)<0&&(e=i)}return new Ca(r,e)}return new Ca(i||e,e)}function fr(t,e,i,n,r){null==r&&(r=t.cm&&(t.cm.display.shift||t.extend)),wr(t,new Ta([dr(t.sel.primary(),e,i,r)],0),n)}function pr(t,e,i){for(var n=[],r=t.cm&&(t.cm.display.shift||t.extend),o=0;o<t.sel.ranges.length;o++)n[o]=dr(t.sel.ranges[o],e[o],null,r);wr(t,Hn(n,t.sel.primIndex),i)}function gr(t,e,i,n){var r=t.sel.ranges.slice(0);r[e]=i,wr(t,Hn(r,t.sel.primIndex),n)}function mr(t,e,i,n){wr(t,Bn(e,i),n)}function vr(t,e,i){var n={ranges:e.ranges,update:function(e){var i=this;this.ranges=[];for(var n=0;n<e.length;n++)i.ranges[n]=new Ca(j(t,e[n].anchor),j(t,e[n].head))},origin:i&&i.origin};return Mt(t,"beforeSelectionChange",t,n),t.cm&&Mt(t.cm,"beforeSelectionChange",t.cm,n),n.ranges!=e.ranges?Hn(n.ranges,n.ranges.length-1):e}function yr(t,e,i){var n=t.history.done,r=g(n);r&&r.ranges?(n[n.length-1]=e,_r(t,e,i)):wr(t,e,i)}function wr(t,e,i){_r(t,e,i),or(t,t.sel,t.cm?t.cm.curOp.id:NaN,i)}function _r(t,e,i){(Lt(t,"beforeSelectionChange")||t.cm&&Lt(t.cm,"beforeSelectionChange"))&&(e=vr(t,e,i)),xr(t,Sr(t,e,i&&i.bias||(D(e.primary().head,t.sel.primary().head)<0?-1:1),!0)),i&&!1===i.scroll||!t.cm||Vi(t.cm)}function xr(t,e){e.equals(t.sel)||(t.sel=e,t.cm&&(t.cm.curOp.updateInput=t.cm.curOp.selectionChanged=!0,It(t.cm)),Te(t,"cursorActivity",t))}function br(t){xr(t,Sr(t,t.sel,null,!1))}function Sr(t,e,i,n){for(var r,o=0;o<e.ranges.length;o++){var s=e.ranges[o],a=e.ranges.length==t.sel.ranges.length&&t.sel.ranges[o],l=Cr(t,s.anchor,a&&a.anchor,i,n),h=Cr(t,s.head,a&&a.head,i,n);(r||l!=s.anchor||h!=s.head)&&(r||(r=e.ranges.slice(0,o)),r[o]=new Ca(l,h))}return r?Hn(r,e.primIndex):e}function Tr(t,e,i,n,r){var o=E(t,e.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker;if((null==a.from||(l.inclusiveLeft?a.from<=e.ch:a.from<e.ch))&&(null==a.to||(l.inclusiveRight?a.to>=e.ch:a.to>e.ch))){if(r&&(Mt(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){var h=l.find(n<0?1:-1),u=void 0;if((n<0?l.inclusiveRight:l.inclusiveLeft)&&(h=Pr(t,h,-n,h&&h.line==e.line?o:null)),h&&h.line==e.line&&(u=D(h,i))&&(n<0?u<0:u>0))return Tr(t,h,e,n,r)}var c=l.find(n<0?-1:1);return(n<0?l.inclusiveLeft:l.inclusiveRight)&&(c=Pr(t,c,n,c.line==e.line?o:null)),c?Tr(t,c,e,n,r):null}}return e}function Cr(t,e,i,n,r){var o=n||1,s=Tr(t,e,i,o,r)||!r&&Tr(t,e,i,o,!0)||Tr(t,e,i,-o,r)||!r&&Tr(t,e,i,-o,!0);return s||(t.cantEdit=!0,A(t.first,0))}function Pr(t,e,i,n){return i<0&&0==e.ch?e.line>t.first?j(t,A(e.line-1)):null:i>0&&e.ch==(n||E(t,e.line)).text.length?e.line<t.first+t.size-1?A(e.line+1,0):null:new A(e.line,e.ch+i)}function Er(t){t.setSelection(A(t.firstLine(),0),A(t.lastLine()),Fs)}function kr(t,e,i){var n={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return n.canceled=!0}};return i&&(n.update=function(e,i,r,o){e&&(n.from=j(t,e)),i&&(n.to=j(t,i)),r&&(n.text=r),o!==undefined&&(n.origin=o)}),Mt(t,"beforeChange",t,n),t.cm&&Mt(t.cm,"beforeChange",t.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Or(t,e,i){if(t.cm){if(!t.cm.curOp)return fn(t.cm,Or)(t,e,i);if(t.cm.state.suppressEdits)return}if(!(Lt(t,"beforeChange")||t.cm&&Lt(t.cm,"beforeChange"))||(e=kr(t,e,!0))){var n=Us&&!i&&et(t,e.from,e.to);if(n)for(var r=n.length-1;r>=0;--r)Mr(t,{from:n[r].from,to:n[r].to,text:r?[""]:e.text});else Mr(t,e)}}function Mr(t,e){if(1!=e.text.length||""!=e.text[0]||0!=D(e.from,e.to)){var i=jn(t,e);nr(t,e,i,t.cm?t.cm.curOp.id:NaN),Lr(t,e,i,Q(t,e));var n=[];Xn(t,function(t,i){i||-1!=d(n,t.history)||(Hr(t.history,e),n.push(t.history)),Lr(t,e,null,Q(t,e))})}}function Rr(t,e,i){if(!t.cm||!t.cm.state.suppressEdits||i){for(var n,r=t.history,o=t.sel,s="undo"==e?r.done:r.undone,a="undo"==e?r.undone:r.done,l=0;l<s.length&&(n=s[l],i?!n.ranges||n.equals(t.sel):n.ranges);l++);if(l!=s.length){for(r.lastOrigin=r.lastSelOrigin=null;n=s.pop(),n.ranges;){if(sr(n,a),i&&!n.equals(t.sel))return void wr(t,n,{clearRedo:!1});o=n}var h=[];sr(o,a),a.push({changes:h,generation:r.generation}),r.generation=n.generation||++r.maxGeneration;for(var u=Lt(t,"beforeChange")||t.cm&&Lt(t.cm,"beforeChange"),c=function(i){var r=n.changes[i];if(r.origin=e,u&&!kr(t,r,!1))return s.length=0,{};h.push(tr(t,r));var o=i?jn(t,r):g(s);Lr(t,r,o,ur(t,r)),!i&&t.cm&&t.cm.scrollIntoView({from:r.from,to:Fn(r)});var a=[];Xn(t,function(t,e){e||-1!=d(a,t.history)||(Hr(t.history,r),a.push(t.history)),Lr(t,r,null,ur(t,r))})},f=n.changes.length-1;f>=0;--f){var p=c(f);if(p)return p.v}}}}function Ir(t,e){if(0!=e&&(t.first+=e,t.sel=new Ta(m(t.sel.ranges,function(t){return new Ca(A(t.anchor.line+e,t.anchor.ch),A(t.head.line+e,t.head.ch))}),t.sel.primIndex),t.cm)){mn(t.cm,t.first,t.first-e,e);for(var i=t.cm.display,n=i.viewFrom;n<i.viewTo;n++)vn(t.cm,n,"gutter")}}function Lr(t,e,i,n){if(t.cm&&!t.cm.curOp)return fn(t.cm,Lr)(t,e,i,n);if(e.to.line<t.first)return void Ir(t,e.text.length-1-(e.to.line-e.from.line));if(!(e.from.line>t.lastLine())){if(e.from.line<t.first){var r=e.text.length-1-(t.first-e.from.line);Ir(t,r),e={from:A(t.first,0),to:A(e.to.line+r,e.to.ch),text:[g(e.text)],origin:e.origin}}var o=t.lastLine();e.to.line>o&&(e={from:e.from,to:A(o,E(t,o).text.length),text:[e.text[0]],origin:e.origin}),e.removed=k(t,e.from,e.to),i||(i=jn(t,e)),t.cm?Nr(t.cm,e,n):Zn(t,e,n),_r(t,i,Fs)}}function Nr(t,e,i){var n=t.doc,r=t.display,o=e.from,s=e.to,a=!1,l=o.line;t.options.lineWrapping||(l=R(ct(E(n,o.line))),n.iter(l,s.line+1,function(t){if(t==r.maxLine)return a=!0,!0})),n.sel.contains(e.from,e.to)>-1&&It(t),Zn(n,e,i,bi(t)),t.options.lineWrapping||(n.iter(l,o.line+e.text.length,function(t){var e=wt(t);e>r.maxLineLength&&(r.maxLine=t,r.maxLineLength=e,r.maxLineChanged=!0,a=!1)}),a&&(t.curOp.updateMaxLine=!0)),le(n,o.line),bn(t,400);var h=e.text.length-(s.line-o.line)-1;e.full?mn(t):o.line!=s.line||1!=e.text.length||Gn(t.doc,e)?mn(t,o.line,s.line+1,h):vn(t,o.line,"text");var u=Lt(t,"changes"),c=Lt(t,"change");if(c||u){var d={from:o,to:s,text:e.text,removed:e.removed,origin:e.origin};c&&Te(t,"change",t,d),u&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(d)}t.display.selForContextMenu=null}function Ar(t,e,i,n,r){if(n||(n=i),D(n,i)<0){var o=n;n=i,i=o}"string"==typeof e&&(e=t.splitLines(e)),Or(t,{from:i,to:n,text:e,origin:r})}function Dr(t,e,i,n){i<t.line?t.line+=n:e<t.line&&(t.line=e,t.ch=0)}function zr(t,e,i,n){for(var r=0;r<t.length;++r){var o=t[r],s=!0;if(o.ranges){o.copied||(o=t[r]=o.deepCopy(),o.copied=!0);for(var a=0;a<o.ranges.length;a++)Dr(o.ranges[a].anchor,e,i,n),Dr(o.ranges[a].head,e,i,n)}else{for(var l=0;l<o.changes.length;++l){var h=o.changes[l];if(i<h.from.line)h.from=A(h.from.line+n,h.from.ch),h.to=A(h.to.line+n,h.to.ch);else if(e<=h.to.line){s=!1;break}}s||(t.splice(0,r+1),r=0)}}}function Hr(t,e){var i=e.from.line,n=e.to.line,r=e.text.length-(n-i)-1;zr(t.done,i,n,r),zr(t.undone,i,n,r)}function Br(t,e,i,n){var r=e,o=e;return"number"==typeof e?o=E(t,$(t,e)):r=R(e),null==r?null:(n(o,r)&&t.cm&&vn(t.cm,r,i),o)}function Fr(t){var e=this;this.lines=t,this.parent=null;for(var i=0,n=0;n<t.length;++n)t[n].parent=e,i+=t[n].height;this.height=i}function $r(t){var e=this;this.children=t;for(var i=0,n=0,r=0;r<t.length;++r){var o=t[r];i+=o.chunkSize(),n+=o.height,o.parent=e}this.size=i,this.height=n,this.parent=null}function jr(t,e,i){yt(e)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&qi(t,i)}function Wr(t,e,i,n){var r=new Pa(t,i,n),o=t.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),Br(t,e,"widget",function(e){var i=e.widgets||(e.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length-1,Math.max(0,r.insertAt)),0,r),r.line=e,o&&!mt(t,e)){var n=yt(e)<t.scrollTop;M(e,e.height+He(r)),n&&qi(o,r.height),o.curOp.forceUpdate=!0}return!0}),Te(o,"lineWidgetAdded",o,r,"number"==typeof e?e:R(e)),r}function qr(t,e,i,n,o){if(n&&n.shared)return Vr(t,e,i,n,o);if(t.cm&&!t.cm.curOp)return fn(t.cm,qr)(t,e,i,n,o);var s=new ka(t,o),a=D(e,i);if(n&&u(n,s,!1),a>0||0==a&&!1!==s.clearWhenEmpty)return s;if(s.replacedWith&&(s.collapsed=!0,s.widgetNode=r("span",[s.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||s.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(s.widgetNode.insertLeft=!0)),s.collapsed){if(ut(t,e.line,e,i,s)||e.line!=i.line&&ut(t,i.line,e,i,s))throw new Error("Inserting collapsed marker partially overlapping an existing one");U()}s.addToHistory&&nr(t,{from:e,to:i,origin:"markText"},t.sel,NaN);var l,h=e.line,c=t.cm;if(t.iter(h,i.line+1,function(t){c&&s.collapsed&&!c.options.lineWrapping&&ct(t)==c.display.maxLine&&(l=!0),s.collapsed&&h!=e.line&&M(t,0),Y(t,new G(s,h==e.line?e.ch:null,h==i.line?i.ch:null)),++h}),s.collapsed&&t.iter(e.line,i.line+1,function(e){mt(t,e)&&M(e,0)}),s.clearOnEnter&&Ks(s,"beforeCursorEnter",function(){return s.clear()}),s.readOnly&&(V(),(t.history.done.length||t.history.undone.length)&&t.clearHistory()),s.collapsed&&(s.id=++Ea,s.atomic=!0),c){if(l&&(c.curOp.updateMaxLine=!0),s.collapsed)mn(c,e.line,i.line+1);else if(s.className||s.title||s.startStyle||s.endStyle||s.css)for(var d=e.line;d<=i.line;d++)vn(c,d,"text");s.atomic&&br(c.doc),Te(c,"markerAdded",c,s)}return s}function Vr(t,e,i,n,r){n=u(n),n.shared=!1;var o=[qr(t,e,i,n,r)],s=o[0],a=n.widgetNode;return Xn(t,function(t){a&&(n.widgetNode=a.cloneNode(!0)),o.push(qr(t,j(t,e),j(t,i),n,r));for(var l=0;l<t.linked.length;++l)if(t.linked[l].isParent)return;s=g(o)}),new Oa(o,s)}function Ur(t){return t.findMarks(A(t.first,0),t.clipPos(A(t.lastLine())),function(t){return t.parent})}function Gr(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=n.find(),o=t.clipPos(r.from),s=t.clipPos(r.to);if(D(o,s)){var a=qr(t,o,s,n.primary,n.primary.type);n.markers.push(a),a.parent=n}}}function Zr(t){for(var e=function(e){var i=t[e],n=[i.primary.doc];Xn(i.primary.doc,function(t){return n.push(t)});for(var r=0;r<i.markers.length;r++){var o=i.markers[r];-1==d(n,o.doc)&&(o.parent=null,i.markers.splice(r--,1))}},i=0;i<t.length;i++)e(i)}function Xr(t){var e=this;if(Jr(e),!Rt(e,t)&&!Be(e.display,t)){At(t),ps&&(Ia=+new Date);var i=Ti(e,t,!0),n=t.dataTransfer.files;if(i&&!e.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var r=n.length,o=Array(r),s=0,a=function(t,n){if(!e.options.allowDropFileTypes||-1!=d(e.options.allowDropFileTypes,t.type)){var a=new FileReader;a.onload=fn(e,function(){var t=a.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(t)&&(t=""),o[n]=t,++s==r){i=j(e.doc,i);var l={from:i,to:i,text:e.doc.splitLines(o.join(e.doc.lineSeparator())),origin:"paste"};Or(e.doc,l),yr(e.doc,Bn(i,Fn(l)))}}),a.readAsText(t)}},l=0;l<r;++l)a(n[l],l);else{if(e.state.draggingText&&e.doc.sel.contains(i)>-1)return e.state.draggingText(t),void setTimeout(function(){return e.display.input.focus()},20);try{var h=t.dataTransfer.getData("Text");if(h){var u;if(e.state.draggingText&&!e.state.draggingText.copy&&(u=e.listSelections()),_r(e.doc,Bn(i,i)),u)for(var c=0;c<u.length;++c)Ar(e.doc,"",u[c].anchor,u[c].head,"drag");e.replaceSelection(h,"around","paste"),e.display.input.focus()}}catch(t){}}}}function Yr(t,e){if(ps&&(!t.state.draggingText||+new Date-Ia<100))return void Ht(e);if(!Rt(t,e)&&!Be(t.display,e)&&(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!_s)){var i=n("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",ws&&(i.width=i.height=1,t.display.wrapper.appendChild(i),i._top=i.offsetTop),e.dataTransfer.setDragImage(i,0,0),ws&&i.parentNode.removeChild(i)}}function Kr(t,e){var r=Ti(t,e);if(r){var o=document.createDocumentFragment();ki(t,r,o),t.display.dragCursor||(t.display.dragCursor=n("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),i(t.display.dragCursor,o)}}function Jr(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function Qr(t){if(document.getElementsByClassName)for(var e=document.getElementsByClassName("CodeMirror"),i=0;i<e.length;i++){var n=e[i].CodeMirror;n&&t(n)}}function to(){La||(eo(),La=!0)}function eo(){var t;Ks(window,"resize",function(){null==t&&(t=setTimeout(function(){t=null,Qr(io)},100))}),Ks(window,"blur",function(){return Qr(Ni)})}function io(t){var e=t.display;e.lastWrapHeight==e.wrapper.clientHeight&&e.lastWrapWidth==e.wrapper.clientWidth||(e.cachedCharWidth=e.cachedTextHeight=e.cachedPaddingH=null,e.scrollbarsClipped=!1,t.setSize())}function no(t){var e=t.split(/-(?!$)/);t=e[e.length-1];for(var i,n,r,o,s=0;s<e.length-1;s++){var a=e[s];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))i=!0;else if(/^(c|ctrl|control)$/i.test(a))n=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);r=!0}}return i&&(t="Alt-"+t),n&&(t="Ctrl-"+t),o&&(t="Cmd-"+t),r&&(t="Shift-"+t),t}function ro(t){var e={};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==n){delete t[i];continue}for(var r=m(i.split(" "),no),o=0;o<r.length;o++){var s=void 0,a=void 0;o==r.length-1?(a=r.join(" "),s=n):(a=r.slice(0,o+1).join(" "),s="...");var l=e[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else e[a]=s}delete t[i]}for(var h in e)t[h]=e[h];return t}function oo(t,e,i,n){e=ho(e);var r=e.call?e.call(t,n):e[t];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&i(r))return"handled";if(e.fallthrough){if("[object Array]"!=Object.prototype.toString.call(e.fallthrough))return oo(t,e.fallthrough,i,n);for(var o=0;o<e.fallthrough.length;o++){var s=oo(t,e.fallthrough[o],i,n);if(s)return s}}}function so(t){var e="string"==typeof t?t:Na[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function ao(t,e,i){var n=t;return e.altKey&&"Alt"!=n&&(t="Alt-"+t),(Rs?e.metaKey:e.ctrlKey)&&"Ctrl"!=n&&(t="Ctrl-"+t),(Rs?e.ctrlKey:e.metaKey)&&"Cmd"!=n&&(t="Cmd-"+t),!i&&e.shiftKey&&"Shift"!=n&&(t="Shift-"+t),t}function lo(t,e){if(ws&&34==t.keyCode&&t["char"])return!1;var i=Na[t.keyCode];return null!=i&&!t.altGraphKey&&ao(i,t,e)}function ho(t){return"string"==typeof t?Ha[t]:t}function uo(t,e){for(var i=t.doc.sel.ranges,n=[],r=0;r<i.length;r++){for(var o=e(i[r]);n.length&&D(o.from,g(n).to)<=0;){var s=n.pop();if(D(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}dn(t,function(){for(var e=n.length-1;e>=0;e--)Ar(t.doc,"",n[e].from,n[e].to,"+delete");Vi(t)})}function co(t,e){var i=E(t.doc,e),n=ct(i);return n!=i&&(e=R(n)),Pt(!0,t,n,e,1)}function fo(t,e){var i=E(t.doc,e),n=dt(i);return n!=i&&(e=R(n)),Pt(!0,t,i,e,-1)}function po(t,e){var i=co(t,e.line),n=E(t.doc,i.line),r=St(n,t.doc.direction);if(!r||0==r[0].level){var o=Math.max(0,n.text.search(/\S/)),s=e.line==i.line&&e.ch<=o&&e.ch;return A(i.line,s?0:o,i.sticky)}return i}function go(t,e,i){if("string"==typeof e&&!(e=Ba[e]))return!1;t.display.input.ensurePolled();var n=t.display.shift,r=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),i&&(t.display.shift=!1),r=e(t)!=Bs}finally{t.display.shift=n,t.state.suppressEdits=!1}return r}function mo(t,e,i){for(var n=0;n<t.state.keyMaps.length;n++){var r=oo(e,t.state.keyMaps[n],i,t);if(r)return r}return t.options.extraKeys&&oo(e,t.options.extraKeys,i,t)||oo(e,t.options.keyMap,i,t)}function vo(t,e,i,n){var r=t.state.keySeq;if(r){if(so(e))return"handled";Fa.set(50,function(){t.state.keySeq==r&&(t.state.keySeq=null,t.display.input.reset())}),e=r+" "+e}var o=mo(t,e,n);return"multi"==o&&(t.state.keySeq=e),"handled"==o&&Te(t,"keyHandled",t,e,i),"handled"!=o&&"multi"!=o||(At(i),Mi(t)),r&&!o&&/\'$/.test(e)?(At(i),!0):!!o}function yo(t,e){var i=lo(e,!0);return!!i&&(e.shiftKey&&!t.state.keySeq?vo(t,"Shift-"+i,e,function(e){return go(t,e,!0)})||vo(t,i,e,function(e){if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return go(t,e)}):vo(t,i,e,function(e){return go(t,e)}))}function wo(t,e,i){return vo(t,"'"+i+"'",e,function(e){return go(t,e,!0)})}function _o(t){var e=this;if(e.curOp.focus=s(),!Rt(e,t)){ps&&gs<11&&27==t.keyCode&&(t.returnValue=!1);var i=t.keyCode;e.display.shift=16==i||t.shiftKey;var n=yo(e,t);ws&&($a=n?i:null,!n&&88==i&&!ea&&(Ps?t.metaKey:t.ctrlKey)&&e.replaceSelection("",null,"cut")),18!=i||/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)||xo(e)}}function xo(t){function e(t){18!=t.keyCode&&t.altKey||(Ls(i,"CodeMirror-crosshair"),Ot(document,"keyup",e),Ot(document,"mouseover",e))}var i=t.display.lineDiv;a(i,"CodeMirror-crosshair"),Ks(document,"keyup",e),Ks(document,"mouseover",e)}function bo(t){16==t.keyCode&&(this.doc.sel.shift=!1),Rt(this,t)}function So(t){var e=this;if(!(Be(e.display,t)||Rt(e,t)||t.ctrlKey&&!t.altKey||Ps&&t.metaKey)){var i=t.keyCode,n=t.charCode;if(ws&&i==$a)return $a=null,void At(t);if(!ws||t.which&&!(t.which<10)||!yo(e,t)){var r=String.fromCharCode(null==n?i:n);"\b"!=r&&(wo(e,t,r)||e.display.input.onKeyPress(t))}}}function To(t,e){var i=+new Date;return qa&&qa.compare(i,t,e)?(Wa=qa=null,"triple"):Wa&&Wa.compare(i,t,e)?(qa=new ja(i,t,e),Wa=null,"double"):(Wa=new ja(i,t,e),qa=null,"single")}function Co(t){var e=this,i=e.display;if(!(Rt(e,t)||i.activeTouch&&i.input.supportsTouch())){if(i.input.ensurePolled(),i.shift=t.shiftKey,Be(i,t))return void(ms||(i.scroller.draggable=!1,setTimeout(function(){return i.scroller.draggable=!0},100)));if(!Lo(e,t)){var n=Ti(e,t),r=Ft(t),o=n?To(n,r):"single";window.focus(),1==r&&e.state.selectingText&&e.state.selectingText(t),n&&Po(e,r,n,o,t)||(1==r?n?ko(e,n,o,t):Bt(t)==i.scroller&&At(t):2==r?(n&&fr(e.doc,n),setTimeout(function(){return i.input.focus()},20)):3==r&&(Is?No(e,t):Ii(e)))}}}function Po(t,e,i,n,r){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),o=(1==e?"Left":2==e?"Middle":"Right")+o,vo(t,ao(o,r),r,function(e){if("string"==typeof e&&(e=Ba[e]),!e)return!1;var n=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),n=e(t,i)!=Bs}finally{t.state.suppressEdits=!1}return n})}function Eo(t,e,i){var n=t.getOption("configureMouse"),r=n?n(t,e,i):{};if(null==r.unit){var o=Es?i.shiftKey&&i.metaKey:i.altKey;r.unit=o?"rectangle":"single"==e?"char":"double"==e?"word":"line"}return(null==r.extend||t.doc.extend)&&(r.extend=t.doc.extend||i.shiftKey),null==r.addNew&&(r.addNew=Ps?i.metaKey:i.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(Ps?i.altKey:i.ctrlKey)),r}function ko(t,e,i,n){ps?setTimeout(h(Ri,t),0):t.curOp.focus=s();var r,o=Eo(t,i,n),a=t.doc.sel;t.options.dragDrop&&Js&&!t.isReadOnly()&&"single"==i&&(r=a.contains(e))>-1&&(D((r=a.ranges[r]).from(),e)<0||e.xRel>0)&&(D(r.to(),e)>0||e.xRel<0)?Oo(t,n,e,o):Ro(t,n,e,o)}function Oo(t,e,i,n){var r=t.display,o=!1,s=fn(t,function(e){ms&&(r.scroller.draggable=!1),t.state.draggingText=!1,Ot(document,"mouseup",s),Ot(document,"mousemove",a),Ot(r.scroller,"dragstart",l),Ot(r.scroller,"drop",s),o||(At(e),n.addNew||fr(t.doc,i,null,null,n.extend),ms||ps&&9==gs?setTimeout(function(){document.body.focus(),r.input.focus()},20):r.input.focus())}),a=function(t){o=o||Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)>=10},l=function(){return o=!0};ms&&(r.scroller.draggable=!0),t.state.draggingText=s,s.copy=!n.moveOnDrag,r.scroller.dragDrop&&r.scroller.dragDrop(),Ks(document,"mouseup",s),Ks(document,"mousemove",a),Ks(r.scroller,"dragstart",l),Ks(r.scroller,"drop",s),Ii(t),setTimeout(function(){return r.input.focus()},20)}function Mo(t,e,i){if("char"==i)return new Ca(e,e);if("word"==i)return t.findWordAt(e);if("line"==i)return new Ca(A(e.line,0),j(t.doc,A(e.line+1,0)));var n=i(t,e);return new Ca(n.from,n.to)}function Ro(t,e,i,n){function r(e){if(0!=D(v,e))if(v=e,"rectangle"==n.unit){for(var r=[],o=t.options.tabSize,s=c(E(h,i.line).text,i.ch,o),a=c(E(h,e.line).text,e.ch,o),l=Math.min(s,a),g=Math.max(s,a),m=Math.min(i.line,e.line),y=Math.min(t.lastLine(),Math.max(i.line,e.line));m<=y;m++){var w=E(h,m).text,_=f(w,l,o);l==g?r.push(new Ca(A(m,_),A(m,_))):w.length>_&&r.push(new Ca(A(m,_),A(m,f(w,g,o))))}r.length||r.push(new Ca(i,i)),wr(h,Hn(p.ranges.slice(0,d).concat(r),d),{origin:"*mouse",scroll:!1}),t.scrollIntoView(e)}else{var x,b=u,S=Mo(t,e,n.unit),T=b.anchor;D(S.anchor,T)>0?(x=S.head,T=F(b.from(),S.anchor)):(x=S.anchor,T=B(b.to(),S.head));var C=p.ranges.slice(0);C[d]=new Ca(j(h,T),x),wr(h,Hn(C,d),$s)}}function o(e){var i=++w,a=Ti(t,e,!0,"rectangle"==n.unit);if(a)if(0!=D(a,v)){t.curOp.focus=s(),r(a);var u=zi(l,h);(a.line>=u.to||a.line<u.from)&&setTimeout(fn(t,function(){w==i&&o(e)}),150)}else{var c=e.clientY<y.top?-20:e.clientY>y.bottom?20:0;c&&setTimeout(fn(t,function(){w==i&&(l.scroller.scrollTop+=c,o(e))}),50)}}function a(e){t.state.selectingText=!1,w=Infinity,At(e),l.input.focus(),Ot(document,"mousemove",_),Ot(document,"mouseup",x),h.history.lastSelOrigin=null}var l=t.display,h=t.doc;At(e);var u,d,p=h.sel,g=p.ranges;if(n.addNew&&!n.extend?(d=h.sel.contains(i),u=d>-1?g[d]:new Ca(i,i)):(u=h.sel.primary(),d=h.sel.primIndex),"rectangle"==n.unit)n.addNew||(u=new Ca(i,i)),i=Ti(t,e,!0,!0),d=-1;else{var m=Mo(t,i,n.unit);u=n.extend?dr(u,m.anchor,m.head,n.extend):m}n.addNew?-1==d?(d=g.length,wr(h,Hn(g.concat([u]),d),{scroll:!1,origin:"*mouse"})):g.length>1&&g[d].empty()&&"char"==n.unit&&!n.extend?(wr(h,Hn(g.slice(0,d).concat(g.slice(d+1)),0),{scroll:!1,origin:"*mouse"}),p=h.sel):gr(h,d,u,$s):(d=0,wr(h,new Ta([u],0),$s),p=h.sel);var v=i,y=l.wrapper.getBoundingClientRect(),w=0,_=fn(t,function(t){Ft(t)?o(t):a(t)}),x=fn(t,a);t.state.selectingText=x,Ks(document,"mousemove",_),Ks(document,"mouseup",x)}function Io(t,e,i,n){var r,o;try{r=e.clientX,o=e.clientY}catch(e){return!1}if(r>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;n&&At(e);var s=t.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!Lt(t,i))return zt(e);o-=a.top-s.viewOffset;for(var l=0;l<t.options.gutters.length;++l){var h=s.gutters.childNodes[l];if(h&&h.getBoundingClientRect().right>=r){return Mt(t,i,t,I(t.doc,o),t.options.gutters[l],e),zt(e)}}}function Lo(t,e){return Io(t,e,"gutterClick",!0)}function No(t,e){Be(t.display,e)||Ao(t,e)||Rt(t,e,"contextmenu")||t.display.input.onContextMenu(e)}function Ao(t,e){return!!Lt(t,"gutterContextMenu")&&Io(t,e,"gutterContextMenu",!1)}function Do(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),oi(t)}function zo(t){function e(e,n,r,o){t.defaults[e]=n,r&&(i[e]=o?function(t,e,i){i!=Va&&r(t,e,i)}:r)}var i=t.optionHandlers;t.defineOption=e,t.Init=Va,e("value","",function(t,e){return t.setValue(e)},!0),e("mode",null,function(t,e){t.doc.modeOption=e,Vn(t)},!0),e("indentUnit",2,Vn,!0),e("indentWithTabs",!1),e("smartIndent",!0),e("tabSize",4,function(t){Un(t),oi(t),mn(t)},!0),e("lineSeparator",null,function(t,e){if(t.doc.lineSep=e,e){var i=[],n=t.doc.first;t.doc.iter(function(t){for(var r=0;;){var o=t.text.indexOf(e,r);if(-1==o)break;r=o+e.length,i.push(A(n,o))}n++});for(var r=i.length-1;r>=0;r--)Ar(t.doc,e,i[r],A(i[r].line,i[r].ch+e.length))}}),e("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(t,e,i){t.state.specialChars=new RegExp(e.source+(e.test("\t")?"":"|\t"),"g"),i!=Va&&t.refresh()}),e("specialCharPlaceholder",fe,function(t){return t.refresh()},!0),e("electricChars",!0),e("inputStyle",Cs?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),e("spellcheck",!1,function(t,e){return t.getInputField().spellcheck=e},!0),e("rtlMoveVisually",!ks),e("wholeLineUpdateBefore",!0),e("theme","default",function(t){Do(t),Ho(t)},!0),e("keyMap","default",function(t,e,i){var n=ho(e),r=i!=Va&&ho(i);r&&r.detach&&r.detach(t,n),n.attach&&n.attach(t,r||null)}),e("extraKeys",null),e("configureMouse",null),e("lineWrapping",!1,Fo,!0),e("gutters",[],function(t){Nn(t.options),Ho(t)},!0),e("fixedGutter",!0,function(t,e){t.display.gutters.style.left=e?xi(t.display)+"px":"0",t.refresh()},!0),e("coverGutterNextToScrollbar",!1,function(t){return tn(t)},!0),e("scrollbarStyle","native",function(t){nn(t),tn(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)},!0),e("lineNumbers",!1,function(t){Nn(t.options),Ho(t)},!0),e("firstLineNumber",1,Ho,!0),e("lineNumberFormatter",function(t){return t},Ho,!0),e("showCursorWhenSelecting",!1,Pi,!0),e("resetSelectionOnContextMenu",!0),e("lineWiseCopyCut",!0),e("pasteLinesPerSelection",!0),e("readOnly",!1,function(t,e){"nocursor"==e&&(Ni(t),t.display.input.blur()),t.display.input.readOnlyChanged(e)}),e("disableInput",!1,function(t,e){e||t.display.input.reset()},!0),e("dragDrop",!0,Bo),e("allowDropFileTypes",null),e("cursorBlinkRate",530),e("cursorScrollMargin",0),e("cursorHeight",1,Pi,!0),e("singleCursorHeightPerLine",!0,Pi,!0),e("workTime",100),e("workDelay",100),e("flattenSpans",!0,Un,!0),e("addModeClass",!1,Un,!0),e("pollInterval",100),e("undoDepth",200,function(t,e){return t.doc.history.undoDepth=e}),e("historyEventDelay",1250),e("viewportMargin",10,function(t){return t.refresh()},!0),e("maxHighlightLength",1e4,Un,!0),e("moveInputWithCursor",!0,function(t,e){e||t.display.input.resetPosition()}),e("tabindex",null,function(t,e){return t.display.input.getField().tabIndex=e||""}),e("autofocus",null),e("direction","ltr",function(t,e){return t.doc.setDirection(e)},!0)}function Ho(t){Ln(t),mn(t),Hi(t)}function Bo(t,e,i){if(!e!=!(i&&i!=Va)){var n=t.display.dragFunctions,r=e?Ks:Ot;r(t.display.scroller,"dragstart",n.start),r(t.display.scroller,"dragenter",n.enter),r(t.display.scroller,"dragover",n.over),r(t.display.scroller,"dragleave",n.leave),r(t.display.scroller,"drop",n.drop)}}function Fo(t){t.options.lineWrapping?(a(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(Ls(t.display.wrapper,"CodeMirror-wrap"),_t(t)),Si(t),mn(t),oi(t),setTimeout(function(){return tn(t)},100)}function $o(t,e){var i=this;if(!(this instanceof $o))return new $o(t,e);this.options=e=e?u(e):{},u(Ua,e,!1),Nn(e);var n=e.value;"string"==typeof n&&(n=new Ra(n,e.mode,null,e.lineSeparator,e.direction)),this.doc=n;var r=new $o.inputStyles[e.inputStyle](this),o=this.display=new P(t,n,r);o.wrapper.CodeMirror=this,Ln(this),Do(this),e.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),nn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new As,keySeq:null,specialChars:null},e.autofocus&&!Cs&&o.input.focus(),ps&&gs<11&&setTimeout(function(){return i.display.input.reset(!0)},20),jo(this),to(),rn(this),this.curOp.forceUpdate=!0,Yn(this,n),e.autofocus&&!Cs||this.hasFocus()?setTimeout(h(Li,this),20):Ni(this);for(var s in Ga)Ga.hasOwnProperty(s)&&Ga[s](i,e[s],Va);Bi(this),e.finishInit&&e.finishInit(this);for(var a=0;a<Za.length;++a)Za[a](i);on(this),ms&&e.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function jo(t){function e(){r.activeTouch&&(o=setTimeout(function(){return r.activeTouch=null},1e3),s=r.activeTouch,s.end=+new Date)}function i(t){if(1!=t.touches.length)return!1;var e=t.touches[0];return e.radiusX<=1&&e.radiusY<=1}function n(t,e){if(null==e.left)return!0;var i=e.left-t.left,n=e.top-t.top;return i*i+n*n>400}var r=t.display;Ks(r.scroller,"mousedown",fn(t,Co)),ps&&gs<11?Ks(r.scroller,"dblclick",fn(t,function(e){if(!Rt(t,e)){var i=Ti(t,e);if(i&&!Lo(t,e)&&!Be(t.display,e)){At(e);var n=t.findWordAt(i);fr(t.doc,n.anchor,n.head)}}})):Ks(r.scroller,"dblclick",function(e){return Rt(t,e)||At(e)}),Is||Ks(r.scroller,"contextmenu",function(e){return No(t,e)});var o,s={end:0};Ks(r.scroller,"touchstart",function(e){if(!Rt(t,e)&&!i(e)){r.input.ensurePolled(),clearTimeout(o);var n=+new Date;r.activeTouch={start:n,moved:!1,prev:n-s.end<=300?s:null},1==e.touches.length&&(r.activeTouch.left=e.touches[0].pageX,r.activeTouch.top=e.touches[0].pageY)}}),Ks(r.scroller,"touchmove",function(){r.activeTouch&&(r.activeTouch.moved=!0)}),Ks(r.scroller,"touchend",function(i){var o=r.activeTouch;if(o&&!Be(r,i)&&null!=o.left&&!o.moved&&new Date-o.start<300){var s,a=t.coordsChar(r.activeTouch,"page");s=!o.prev||n(o,o.prev)?new Ca(a,a):!o.prev.prev||n(o,o.prev.prev)?t.findWordAt(a):new Ca(A(a.line,0),j(t.doc,A(a.line+1,0))),t.setSelection(s.anchor,s.head),t.focus(),At(i)}e()}),Ks(r.scroller,"touchcancel",e),Ks(r.scroller,"scroll",function(){r.scroller.clientHeight&&(Yi(t,r.scroller.scrollTop),Ji(t,r.scroller.scrollLeft,!0),Mt(t,"scroll",t))}),Ks(r.scroller,"mousewheel",function(e){return zn(t,e)}),Ks(r.scroller,"DOMMouseScroll",function(e){return zn(t,e)}),Ks(r.wrapper,"scroll",function(){return r.wrapper.scrollTop=r.wrapper.scrollLeft=0}),r.dragFunctions={enter:function(e){Rt(t,e)||Ht(e)},over:function(e){Rt(t,e)||(Kr(t,e),Ht(e))},start:function(e){return Yr(t,e)},drop:fn(t,Xr),leave:function(e){Rt(t,e)||Jr(t)}};var a=r.input.getField();Ks(a,"keyup",function(e){return bo.call(t,e)}),Ks(a,"keydown",fn(t,_o)),Ks(a,"keypress",fn(t,So)),Ks(a,"focus",function(e){return Li(t,e)}),Ks(a,"blur",function(e){return Ni(t,e)})}function Wo(t,e,i,n){var r,o=t.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?r=te(t,e).state:i="prev");var s=t.options.tabSize,a=E(o,e),l=c(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var h,u=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&((h=o.mode.indent(r,a.text.slice(u.length),a.text))==Bs||h>150)){if(!n)return;i="prev"}}else h=0,i="not";"prev"==i?h=e>o.first?c(E(o,e-1).text,null,s):0:"add"==i?h=l+t.options.indentUnit:"subtract"==i?h=l-t.options.indentUnit:"number"==typeof i&&(h=l+i),h=Math.max(0,h);var d="",f=0;if(t.options.indentWithTabs)for(var g=Math.floor(h/s);g;--g)f+=s,d+="\t";if(f<h&&(d+=p(h-f)),d!=u)return Ar(o,d,A(e,0),A(e,u.length),"+input"),a.stateAfter=null,!0;for(var m=0;m<o.sel.ranges.length;m++){var v=o.sel.ranges[m];if(v.head.line==e&&v.head.ch<u.length){var y=A(e,u.length);gr(o,m,new Ca(y,y));break}}}function qo(t){Xa=t}function Vo(t,e,i,n,r){var o=t.doc;t.display.shift=!1,n||(n=o.sel);var s=t.state.pasteIncoming||"paste"==r,a=Qs(e),l=null;if(s&&n.ranges.length>1)if(Xa&&Xa.text.join("\n")==e){
if(n.ranges.length%Xa.text.length==0){l=[];for(var h=0;h<Xa.text.length;h++)l.push(o.splitLines(Xa.text[h]))}}else a.length==n.ranges.length&&t.options.pasteLinesPerSelection&&(l=m(a,function(t){return[t]}));for(var u,c=n.ranges.length-1;c>=0;c--){var d=n.ranges[c],f=d.from(),p=d.to();d.empty()&&(i&&i>0?f=A(f.line,f.ch-i):t.state.overwrite&&!s?p=A(p.line,Math.min(E(o,p.line).text.length,p.ch+g(a).length)):Xa&&Xa.lineWise&&Xa.text.join("\n")==e&&(f=p=A(f.line,0))),u=t.curOp.updateInput;var v={from:f,to:p,text:l?l[c%l.length]:a,origin:r||(s?"paste":t.state.cutIncoming?"cut":"+input")};Or(t.doc,v),Te(t,"inputRead",t,v)}e&&!s&&Go(t,e),Vi(t),t.curOp.updateInput=u,t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=!1}function Uo(t,e){var i=t.clipboardData&&t.clipboardData.getData("Text");if(i)return t.preventDefault(),e.isReadOnly()||e.options.disableInput||dn(e,function(){return Vo(e,i,0,null,"paste")}),!0}function Go(t,e){if(t.options.electricChars&&t.options.smartIndent)for(var i=t.doc.sel,n=i.ranges.length-1;n>=0;n--){var r=i.ranges[n];if(!(r.head.ch>100||n&&i.ranges[n-1].head.line==r.head.line)){var o=t.getModeAt(r.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(e.indexOf(o.electricChars.charAt(a))>-1){s=Wo(t,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(E(t.doc,r.head.line).text.slice(0,r.head.ch))&&(s=Wo(t,r.head.line,"smart"));s&&Te(t,"electricInput",t,r.head.line)}}}function Zo(t){for(var e=[],i=[],n=0;n<t.doc.sel.ranges.length;n++){var r=t.doc.sel.ranges[n].head.line,o={anchor:A(r,0),head:A(r+1,0)};i.push(o),e.push(t.getRange(o.anchor,o.head))}return{text:e,ranges:i}}function Xo(t,e){t.setAttribute("autocorrect","off"),t.setAttribute("autocapitalize","off"),t.setAttribute("spellcheck",!!e)}function Yo(){var t=n("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),e=n("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return ms?t.style.width="1000px":t.setAttribute("wrap","off"),Ss&&(t.style.border="1px solid black"),Xo(t),e}function Ko(t){var e=t.optionHandlers,i=t.helpers={};t.prototype={constructor:t,focus:function(){window.focus(),this.display.input.focus()},setOption:function(t,i){var n=this.options,r=n[t];n[t]==i&&"mode"!=t||(n[t]=i,e.hasOwnProperty(t)&&fn(this,e[t])(this,i,r),Mt(this,"optionChange",this,t))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](ho(t))},removeKeyMap:function(t){for(var e=this.state.keyMaps,i=0;i<e.length;++i)if(e[i]==t||e[i].name==t)return e.splice(i,1),!0},addOverlay:pn(function(e,i){var n=e.token?e:t.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");v(this.state.overlays,{mode:n,modeSpec:e,opaque:i&&i.opaque,priority:i&&i.priority||0},function(t){return t.priority}),this.state.modeGen++,mn(this)}),removeOverlay:pn(function(t){for(var e=this,i=this.state.overlays,n=0;n<i.length;++n){var r=i[n].modeSpec;if(r==t||"string"==typeof t&&r.name==t)return i.splice(n,1),e.state.modeGen++,void mn(e)}}),indentLine:pn(function(t,e,i){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),L(this.doc,t)&&Wo(this,t,e,i)}),indentSelection:pn(function(t){for(var e=this,i=this.doc.sel.ranges,n=-1,r=0;r<i.length;r++){var o=i[r];if(o.empty())o.head.line>n&&(Wo(e,o.head.line,t,!0),n=o.head.line,r==e.doc.sel.primIndex&&Vi(e));else{var s=o.from(),a=o.to(),l=Math.max(n,s.line);n=Math.min(e.lastLine(),a.line-(a.ch?0:1))+1;for(var h=l;h<n;++h)Wo(e,h,t);var u=e.doc.sel.ranges;0==s.ch&&i.length==u.length&&u[r].from().ch>0&&gr(e.doc,r,new Ca(s,u[r].to()),Fs)}}}),getTokenAt:function(t,e){return re(this,t,e)},getLineTokens:function(t,e){return re(this,A(t),e,!0)},getTokenTypeAt:function(t){t=j(this.doc,t);var e,i=Qt(this,E(this.doc,t.line)),n=0,r=(i.length-1)/2,o=t.ch;if(0==o)e=i[2];else for(;;){var s=n+r>>1;if((s?i[2*s-1]:0)>=o)r=s;else{if(!(i[2*s+1]<o)){e=i[2*s+2];break}n=s+1}}var a=e?e.indexOf("overlay "):-1;return a<0?e:0==a?null:e.slice(0,a-1)},getModeAt:function(e){var i=this.doc.mode;return i.innerMode?t.innerMode(i,this.getTokenAt(e).state).mode:i},getHelper:function(t,e){return this.getHelpers(t,e)[0]},getHelpers:function(t,e){var n=this,r=[];if(!i.hasOwnProperty(e))return r;var o=i[e],s=this.getModeAt(t);if("string"==typeof s[e])o[s[e]]&&r.push(o[s[e]]);else if(s[e])for(var a=0;a<s[e].length;a++){var l=o[s[e][a]];l&&r.push(l)}else s.helperType&&o[s.helperType]?r.push(o[s.helperType]):o[s.name]&&r.push(o[s.name]);for(var h=0;h<o._global.length;h++){var u=o._global[h];u.pred(s,n)&&-1==d(r,u.val)&&r.push(u.val)}return r},getStateAfter:function(t,e){var i=this.doc;return t=$(i,null==t?i.first+i.size-1:t),te(this,t+1,e).state},cursorCoords:function(t,e){var i,n=this.doc.sel.primary();return i=null==t?n.head:"object"==typeof t?j(this.doc,t):t?n.from():n.to(),ci(this,i,e||"page")},charCoords:function(t,e){return ui(this,j(this.doc,t),e||"page")},coordsChar:function(t,e){return t=hi(this,t,e||"page"),pi(this,t.left,t.top)},lineAtHeight:function(t,e){return t=hi(this,{top:t,left:0},e||"page").top,I(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e,i){var n,r=!1;if("number"==typeof t){var o=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>o&&(t=o,r=!0),n=E(this.doc,t)}else n=t;return li(this,n,{top:0,left:0},e||"page",i||r).top+(r?this.doc.height-yt(n):0)},defaultTextHeight:function(){return yi(this.display)},defaultCharWidth:function(){return wi(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,e,i,n,r){var o=this.display;t=ci(this,j(this.doc,t));var s=t.bottom,a=t.left;if(e.style.position="absolute",e.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(e),o.sizer.appendChild(e),"over"==n)s=t.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),h=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||t.bottom+e.offsetHeight>l)&&t.top>e.offsetHeight?s=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=l&&(s=t.bottom),a+e.offsetWidth>h&&(a=h-e.offsetWidth)}e.style.top=s+"px",e.style.left=e.style.right="","right"==r?(a=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=a+"px"),i&&ji(this,{left:a,top:s,right:a+e.offsetWidth,bottom:s+e.offsetHeight})},triggerOnKeyDown:pn(_o),triggerOnKeyPress:pn(So),triggerOnKeyUp:bo,triggerOnMouseDown:pn(Co),execCommand:function(t){if(Ba.hasOwnProperty(t))return Ba[t].call(null,this)},triggerElectric:pn(function(t){Go(this,t)}),findPosH:function(t,e,i,n){var r=this,o=1;e<0&&(o=-1,e=-e);for(var s=j(this.doc,t),a=0;a<e&&(s=Jo(r.doc,s,o,i,n),!s.hitSide);++a);return s},moveH:pn(function(t,e){var i=this;this.extendSelectionsBy(function(n){return i.display.shift||i.doc.extend||n.empty()?Jo(i.doc,n.head,t,e,i.options.rtlMoveVisually):t<0?n.from():n.to()},js)}),deleteH:pn(function(t,e){var i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):uo(this,function(i){var r=Jo(n,i.head,t,e,!1);return t<0?{from:r,to:i.head}:{from:i.head,to:r}})}),findPosV:function(t,e,i,n){var r=this,o=1,s=n;e<0&&(o=-1,e=-e);for(var a=j(this.doc,t),l=0;l<e;++l){var h=ci(r,a,"div");if(null==s?s=h.left:h.left=s,a=Qo(r,h,o,i),a.hitSide)break}return a},moveV:pn(function(t,e){var i=this,n=this.doc,r=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(s){if(o)return t<0?s.from():s.to();var a=ci(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=Qo(i,a,t,e);return"page"==e&&s==n.sel.primary()&&qi(i,ui(i,l,"div").top-a.top),l},js),r.length)for(var s=0;s<n.sel.ranges.length;s++)n.sel.ranges[s].goalColumn=r[s]}),findWordAt:function(t){var e=this.doc,i=E(e,t.line).text,n=t.ch,r=t.ch;if(i){var o=this.getHelper(t,"wordChars");"before"!=t.sticky&&r!=i.length||!n?++r:--n;for(var s=i.charAt(n),a=x(s,o)?function(t){return x(t,o)}:/\s/.test(s)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!x(t)};n>0&&a(i.charAt(n-1));)--n;for(;r<i.length&&a(i.charAt(r));)++r}return new Ca(A(t.line,n),A(t.line,r))},toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?a(this.display.cursorDiv,"CodeMirror-overwrite"):Ls(this.display.cursorDiv,"CodeMirror-overwrite"),Mt(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==s()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pn(function(t,e){Ui(this,t,e)}),getScrollInfo:function(){var t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-We(this)-this.display.barHeight,width:t.scrollWidth-We(this)-this.display.barWidth,clientHeight:Ve(this),clientWidth:qe(this)}},scrollIntoView:pn(function(t,e){null==t?(t={from:this.doc.sel.primary().head,to:null},null==e&&(e=this.options.cursorScrollMargin)):"number"==typeof t?t={from:A(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=e||0,null!=t.from.line?Gi(this,t):Xi(this,t.from,t.to,t.margin)}),setSize:pn(function(t,e){var i=this,n=function(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t};null!=t&&(this.display.wrapper.style.width=n(t)),null!=e&&(this.display.wrapper.style.height=n(e)),this.options.lineWrapping&&ri(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,function(t){if(t.widgets)for(var e=0;e<t.widgets.length;e++)if(t.widgets[e].noHScroll){vn(i,r,"widget");break}++r}),this.curOp.forceUpdate=!0,Mt(this,"refresh",this)}),operation:function(t){return dn(this,t)},startOperation:function(){return rn(this)},endOperation:function(){return on(this)},refresh:pn(function(){var t=this.display.cachedTextHeight;mn(this),this.curOp.forceUpdate=!0,oi(this),Ui(this,this.doc.scrollLeft,this.doc.scrollTop),Rn(this),(null==t||Math.abs(t-yi(this.display))>.5)&&Si(this),Mt(this,"refresh",this)}),swapDoc:pn(function(t){var e=this.doc;return e.cm=null,Yn(this,t),oi(this),this.display.input.reset(),Ui(this,t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,Te(this,"swapDoc",this,e),e}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Nt(t),t.registerHelper=function(e,n,r){i.hasOwnProperty(e)||(i[e]=t[e]={_global:[]}),i[e][n]=r},t.registerGlobalHelper=function(e,n,r,o){t.registerHelper(e,n,o),i[e]._global.push({pred:r,val:o})}}function Jo(t,e,i,n,r){function o(){var n=e.line+i;return!(n<t.first||n>=t.first+t.size)&&(e=new A(n,e.ch,e.sticky),h=E(t,n))}function s(n){var s;if(null==(s=r?Et(t.cm,h,e,i):Ct(h,e,i))){if(n||!o())return!1;e=Pt(r,t.cm,h,e.line,i)}else e=s;return!0}var a=e,l=i,h=E(t,e.line);if("char"==n)s();else if("column"==n)s(!0);else if("word"==n||"group"==n)for(var u=null,c="group"==n,d=t.cm&&t.cm.getHelper(e,"wordChars"),f=!0;!(i<0)||s(!f);f=!1){var p=h.text.charAt(e.ch)||"\n",g=x(p,d)?"w":c&&"\n"==p?"n":!c||/\s/.test(p)?null:"p";if(!c||f||g||(g="s"),u&&u!=g){i<0&&(i=1,s(),e.sticky="after");break}if(g&&(u=g),i>0&&!s(!f))break}var m=Cr(t,e,a,l,!0);return z(a,m)&&(m.hitSide=!0),m}function Qo(t,e,i,n){var r,o=t.doc,s=e.left;if("page"==n){var a=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),l=Math.max(a-.5*yi(t.display),3);r=(i>0?e.bottom:e.top)+i*l}else"line"==n&&(r=i>0?e.bottom+3:e.top-3);for(var h;h=pi(t,s,r),h.outside;){if(i<0?r<=0:r>=o.height){h.hitSide=!0;break}r+=5*i}return h}function ts(t,e){var i=Ye(t,e.line);if(!i||i.hidden)return null;var n=E(t.doc,e.line),r=Ge(i,n,e.line),o=St(n,t.doc.direction),s="left";if(o){s=bt(o,e.ch)%2?"right":"left"}var a=Qe(r.map,e.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function es(t){for(var e=t;e;e=e.parentNode)if(/CodeMirror-gutter-wrapper/.test(e.className))return!0;return!1}function is(t,e){return e&&(t.bad=!0),t}function ns(t,e,i,n,r){function o(t){return function(e){return e.id==t}}function s(){u&&(h+=c,u=!1)}function a(t){t&&(s(),h+=t)}function l(e){if(1==e.nodeType){var i=e.getAttribute("cm-text");if(null!=i)return void a(i||e.textContent.replace(/\u200b/g,""));var h,d=e.getAttribute("cm-marker");if(d){var f=t.findMarks(A(n,0),A(r+1,0),o(+d));return void(f.length&&(h=f[0].find())&&a(k(t.doc,h.from,h.to).join(c)))}if("false"==e.getAttribute("contenteditable"))return;var p=/^(pre|div|p)$/i.test(e.nodeName);p&&s();for(var g=0;g<e.childNodes.length;g++)l(e.childNodes[g]);p&&(u=!0)}else 3==e.nodeType&&a(e.nodeValue)}for(var h="",u=!1,c=t.doc.lineSeparator();l(e),e!=i;)e=e.nextSibling;return h}function rs(t,e,i){var n;if(e==t.display.lineDiv){if(!(n=t.display.lineDiv.childNodes[i]))return is(t.clipPos(A(t.display.viewTo-1)),!0);e=null,i=0}else for(n=e;;n=n.parentNode){if(!n||n==t.display.lineDiv)return null;if(n.parentNode&&n.parentNode==t.display.lineDiv)break}for(var r=0;r<t.display.view.length;r++){var o=t.display.view[r];if(o.node==n)return os(o,e,i)}}function os(t,e,i){function n(e,i,n){for(var r=-1;r<(c?c.length:0);r++)for(var o=r<0?u.map:c[r],s=0;s<o.length;s+=3){var a=o[s+2];if(a==e||a==i){var l=R(r<0?t.line:t.rest[r]),h=o[s]+n;return(n<0||a!=e)&&(h=o[s+(n?1:0)]),A(l,h)}}}var r=t.text.firstChild,s=!1;if(!e||!o(r,e))return is(A(R(t.line),0),!0);if(e==r&&(s=!0,e=r.childNodes[i],i=0,!e)){var a=t.rest?g(t.rest):t.line;return is(A(R(a),a.text.length),s)}var l=3==e.nodeType?e:null,h=e;for(l||1!=e.childNodes.length||3!=e.firstChild.nodeType||(l=e.firstChild,i&&(i=l.nodeValue.length));h.parentNode!=r;)h=h.parentNode;var u=t.measure,c=u.maps,d=n(l,h,i);if(d)return is(d,s);for(var f=h.nextSibling,p=l?l.nodeValue.length-i:0;f;f=f.nextSibling){if(d=n(f,f.firstChild,0))return is(A(d.line,d.ch-p),s);p+=f.textContent.length}for(var m=h.previousSibling,v=i;m;m=m.previousSibling){if(d=n(m,m.firstChild,-1))return is(A(d.line,d.ch+v),s);v+=m.textContent.length}}function ss(t,e){function i(){t.value=l.getValue()}if(e=e?u(e):{},e.value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus){var n=s();e.autofocus=n==t||null!=t.getAttribute("autofocus")&&n==document.body}var r;if(t.form&&(Ks(t.form,"submit",i),!e.leaveSubmitMethodAlone)){var o=t.form;r=o.submit;try{var a=o.submit=function(){i(),o.submit=r,o.submit(),o.submit=a}}catch(t){}}e.finishInit=function(e){e.save=i,e.getTextArea=function(){return t},e.toTextArea=function(){e.toTextArea=isNaN,i(),t.parentNode.removeChild(e.getWrapperElement()),t.style.display="",t.form&&(Ot(t.form,"submit",i),"function"==typeof t.form.submit&&(t.form.submit=r))}},t.style.display="none";var l=$o(function(e){return t.parentNode.insertBefore(e,t.nextSibling)},e);return l}function as(t){t.off=Ot,t.on=Ks,t.wheelEventPixels=Dn,t.Doc=Ra,t.splitLines=Qs,t.countColumn=c,t.findColumn=f,t.isWordChar=_,t.Pass=Bs,t.signal=Mt,t.Line=ua,t.changeEnd=Fn,t.scrollbarModel=wa,t.Pos=A,t.cmpPos=D,t.modes=na,t.mimeModes=ra,t.resolveMode=Ut,t.getMode=Gt,t.modeExtensions=oa,t.extendMode=Zt,t.copyState=Xt,t.startState=Kt,t.innerMode=Yt,t.commands=Ba,t.keyMap=Ha,t.keyName=lo,t.isModifierKey=so,t.lookupKey=oo,t.normalizeKeyMap=ro,t.StringStream=sa,t.SharedTextMarker=Oa,t.TextMarker=ka,t.LineWidget=Pa,t.e_preventDefault=At,t.e_stopPropagation=Dt,t.e_stop=Ht,t.addClass=a,t.contains=o,t.rmClass=Ls,t.keyNames=Na}var ls=navigator.userAgent,hs=navigator.platform,us=/gecko\/\d/i.test(ls),cs=/MSIE \d/.test(ls),ds=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ls),fs=/Edge\/(\d+)/.exec(ls),ps=cs||ds||fs,gs=ps&&(cs?document.documentMode||6:+(fs||ds)[1]),ms=!fs&&/WebKit\//.test(ls),vs=ms&&/Qt\/\d+\.\d+/.test(ls),ys=!fs&&/Chrome\//.test(ls),ws=/Opera\//.test(ls),_s=/Apple Computer/.test(navigator.vendor),xs=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ls),bs=/PhantomJS/.test(ls),Ss=!fs&&/AppleWebKit/.test(ls)&&/Mobile\/\w+/.test(ls),Ts=/Android/.test(ls),Cs=Ss||Ts||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ls),Ps=Ss||/Mac/.test(hs),Es=/\bCrOS\b/.test(ls),ks=/win/i.test(hs),Os=ws&&ls.match(/Version\/(\d*\.\d*)/);Os&&(Os=Number(Os[1])),Os&&Os>=15&&(ws=!1,ms=!0);var Ms,Rs=Ps&&(vs||ws&&(null==Os||Os<12.11)),Is=us||ps&&gs>=9,Ls=function(e,i){var n=e.className,r=t(i).exec(n);if(r){var o=n.slice(r.index+r[0].length);e.className=n.slice(0,r.index)+(o?r[1]+o:"")}};Ms=document.createRange?function(t,e,i,n){var r=document.createRange();return r.setEnd(n||t,i),r.setStart(t,e),r}:function(t,e,i){var n=document.body.createTextRange();try{n.moveToElementText(t.parentNode)}catch(t){return n}return n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",e),n};var Ns=function(t){t.select()};Ss?Ns=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:ps&&(Ns=function(t){try{t.select()}catch(t){}});var As=function(){this.id=null};As.prototype.set=function(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)};var Ds,zs,Hs=30,Bs={toString:function(){return"CodeMirror.Pass"}},Fs={scroll:!1},$s={origin:"*mouse"},js={origin:"+move"},Ws=[""],qs=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Vs=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Us=!1,Gs=!1,Zs=null,Xs=function(){function t(t){return t<=247?i.charAt(t):1424<=t&&t<=1524?"R":1536<=t&&t<=1785?n.charAt(t-1536):1774<=t&&t<=2220?"r":8192<=t&&t<=8203?"w":8204==t?"b":"L"}function e(t,e,i){this.level=t,this.from=e,this.to=i}var i="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,s=/[LRr]/,a=/[Lb1n]/,l=/[1n]/;return function(i,n){var h="ltr"==n?"L":"R";if(0==i.length||"ltr"==n&&!r.test(i))return!1;for(var u=i.length,c=[],d=0;d<u;++d)c.push(t(i.charCodeAt(d)));for(var f=0,p=h;f<u;++f){var m=c[f];"m"==m?c[f]=p:p=m}for(var v=0,y=h;v<u;++v){var w=c[v];"1"==w&&"r"==y?c[v]="n":s.test(w)&&(y=w,"r"==w&&(c[v]="R"))}for(var _=1,x=c[0];_<u-1;++_){var b=c[_];"+"==b&&"1"==x&&"1"==c[_+1]?c[_]="1":","!=b||x!=c[_+1]||"1"!=x&&"n"!=x||(c[_]=x),x=b}for(var S=0;S<u;++S){var T=c[S];if(","==T)c[S]="N";else if("%"==T){var C=void 0;for(C=S+1;C<u&&"%"==c[C];++C);for(var P=S&&"!"==c[S-1]||C<u&&"1"==c[C]?"1":"N",E=S;E<C;++E)c[E]=P;S=C-1}}for(var k=0,O=h;k<u;++k){var M=c[k];"L"==O&&"1"==M?c[k]="L":s.test(M)&&(O=M)}for(var R=0;R<u;++R)if(o.test(c[R])){var I=void 0;for(I=R+1;I<u&&o.test(c[I]);++I);for(var L="L"==(R?c[R-1]:h),N="L"==(I<u?c[I]:h),A=L==N?L?"L":"R":h,D=R;D<I;++D)c[D]=A;R=I-1}for(var z,H=[],B=0;B<u;)if(a.test(c[B])){var F=B;for(++B;B<u&&a.test(c[B]);++B);H.push(new e(0,F,B))}else{var $=B,j=H.length;for(++B;B<u&&"L"!=c[B];++B);for(var W=$;W<B;)if(l.test(c[W])){$<W&&H.splice(j,0,new e(1,$,W));var q=W;for(++W;W<B&&l.test(c[W]);++W);H.splice(j,0,new e(2,q,W)),$=W}else++W;$<B&&H.splice(j,0,new e(1,$,B))}return 1==H[0].level&&(z=i.match(/^\s+/))&&(H[0].from=z[0].length,H.unshift(new e(0,0,z[0].length))),1==g(H).level&&(z=i.match(/\s+$/))&&(g(H).to-=z[0].length,H.push(new e(0,u-z[0].length,u))),"rtl"==n?H.reverse():H}}(),Ys=[],Ks=function(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else if(t.attachEvent)t.attachEvent("on"+e,i);else{var n=t._handlers||(t._handlers={});n[e]=(n[e]||Ys).concat(i)}},Js=function(){if(ps&&gs<9)return!1;var t=n("div");return"draggable"in t||"dragDrop"in t}(),Qs=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,i=[],n=t.length;e<=n;){var r=t.indexOf("\n",e);-1==r&&(r=t.length);var o=t.slice(e,"\r"==t.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),e+=s+1):(i.push(o),e=r+1)}return i}:function(t){return t.split(/\r\n?|\n/)},ta=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){var e;try{e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},ea=function(){var t=n("div");return"oncopy"in t||(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)}(),ia=null,na={},ra={},oa={},sa=function(t,e,i){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i};sa.prototype.eol=function(){return this.pos>=this.string.length},sa.prototype.sol=function(){return this.pos==this.lineStart},sa.prototype.peek=function(){return this.string.charAt(this.pos)||undefined},sa.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},sa.prototype.eat=function(t){var e=this.string.charAt(this.pos);if("string"==typeof t?e==t:e&&(t.test?t.test(e):t(e)))return++this.pos,e},sa.prototype.eatWhile=function(t){for(var e=this.pos;this.eat(t););return this.pos>e},sa.prototype.eatSpace=function(){for(var t=this,e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++t.pos;return this.pos>e},sa.prototype.skipToEnd=function(){this.pos=this.string.length},sa.prototype.skipTo=function(t){var e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0},sa.prototype.backUp=function(t){this.pos-=t},sa.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=c(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?c(this.string,this.lineStart,this.tabSize):0)},sa.prototype.indentation=function(){return c(this.string,null,this.tabSize)-(this.lineStart?c(this.string,this.lineStart,this.tabSize):0)},sa.prototype.match=function(t,e,i){if("string"!=typeof t){var n=this.string.slice(this.pos).match(t);return n&&n.index>0?null:(n&&!1!==e&&(this.pos+=n[0].length),n)}var r=function(t){return i?t.toLowerCase():t};if(r(this.string.substr(this.pos,t.length))==r(t))return!1!==e&&(this.pos+=t.length),!0},sa.prototype.current=function(){return this.string.slice(this.start,this.pos)},sa.prototype.hideFirstChars=function(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}},sa.prototype.lookAhead=function(t){var e=this.lineOracle;return e&&e.lookAhead(t)};var aa=function(t,e){this.state=t,this.lookAhead=e},la=function(t,e,i,n){this.state=e,this.doc=t,this.line=i,this.maxLookAhead=n||0};la.prototype.lookAhead=function(t){var e=this.doc.getLine(this.line+t);return null!=e&&t>this.maxLookAhead&&(this.maxLookAhead=t),e},la.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},la.fromSaved=function(t,e,i){return e instanceof aa?new la(t,Xt(t.mode,e.state),i,e.lookAhead):new la(t,Xt(t.mode,e),i)},la.prototype.save=function(t){var e=!1!==t?Xt(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new aa(e,this.maxLookAhead):e};var ha=function(t,e,i){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=e||null,this.state=i},ua=function(t,e,i){this.text=t,nt(this,e),this.height=i?i(this):1};ua.prototype.lineNo=function(){return R(this)},Nt(ua);var ca,da={},fa={},pa=null,ga=null,ma={left:0,right:0,top:0,bottom:0},va=function(t,e,i){this.cm=i;var r=this.vert=n("div",[n("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=n("div",[n("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");t(r),t(o),Ks(r,"scroll",function(){r.clientHeight&&e(r.scrollTop,"vertical")}),Ks(o,"scroll",function(){o.clientWidth&&e(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,ps&&gs<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};va.prototype.update=function(t){var e=t.scrollWidth>t.clientWidth+1,i=t.scrollHeight>t.clientHeight+1,n=t.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=e?n+"px":"0";var r=t.viewHeight-(e?n:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+r)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(e){this.horiz.style.display="block",this.horiz.style.right=i?n+"px":"0",this.horiz.style.left=t.barLeft+"px";var o=t.viewWidth-t.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?n:0,bottom:e?n:0}},va.prototype.setScrollLeft=function(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},va.prototype.setScrollTop=function(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},va.prototype.zeroWidthHack=function(){var t=Ps&&!xs?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new As,this.disableVert=new As},va.prototype.enableZeroWidthBar=function(t,e,i){function n(){var r=t.getBoundingClientRect();("vert"==i?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=t?t.style.pointerEvents="none":e.set(1e3,n)}t.style.pointerEvents="auto",e.set(1e3,n)},va.prototype.clear=function(){var t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)};var ya=function(){};ya.prototype.update=function(){return{bottom:0,right:0}},ya.prototype.setScrollLeft=function(){},ya.prototype.setScrollTop=function(){},ya.prototype.clear=function(){};var wa={"native":va,"null":ya},_a=0,xa=function(t,e,i){var n=t.display;this.viewport=e,this.visible=zi(n,t.doc,e),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=qe(t),this.force=i,this.dims=_i(t),this.events=[]};xa.prototype.signal=function(t,e){Lt(t,e)&&this.events.push(arguments)},xa.prototype.finish=function(){for(var t=this,e=0;e<this.events.length;e++)Mt.apply(null,t.events[e])};var ba=0,Sa=null;ps?Sa=-.53:us?Sa=15:ys?Sa=-.7:_s&&(Sa=-1/3);var Ta=function(t,e){this.ranges=t,this.primIndex=e};Ta.prototype.primary=function(){return this.ranges[this.primIndex]},Ta.prototype.equals=function(t){var e=this;if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(var i=0;i<this.ranges.length;i++){var n=e.ranges[i],r=t.ranges[i];if(!z(n.anchor,r.anchor)||!z(n.head,r.head))return!1}return!0},Ta.prototype.deepCopy=function(){for(var t=this,e=[],i=0;i<this.ranges.length;i++)e[i]=new Ca(H(t.ranges[i].anchor),H(t.ranges[i].head));return new Ta(e,this.primIndex)},Ta.prototype.somethingSelected=function(){for(var t=this,e=0;e<this.ranges.length;e++)if(!t.ranges[e].empty())return!0;return!1},Ta.prototype.contains=function(t,e){var i=this;e||(e=t);for(var n=0;n<this.ranges.length;n++){var r=i.ranges[n];if(D(e,r.from())>=0&&D(t,r.to())<=0)return n}return-1};var Ca=function(t,e){this.anchor=t,this.head=e};Ca.prototype.from=function(){return F(this.anchor,this.head)},Ca.prototype.to=function(){return B(this.anchor,this.head)},Ca.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Fr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var i=this,n=t,r=t+e;n<r;++n){var o=i.lines[n];i.height-=o.height,ue(o),Te(o,"delete")}this.lines.splice(t,e)},collapse:function(t){t.push.apply(t,this.lines)},insertInner:function(t,e,i){var n=this;this.height+=i,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var r=0;r<e.length;++r)e[r].parent=n},iterN:function(t,e,i){for(var n=this,r=t+e;t<r;++t)if(i(n.lines[t]))return!0}},$r.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){var i=this;this.size-=e;for(var n=0;n<this.children.length;++n){var r=i.children[n],o=r.chunkSize();if(t<o){var s=Math.min(e,o-t),a=r.height;if(r.removeInner(t,s),i.height-=a-r.height,o==s&&(i.children.splice(n--,1),r.parent=null),0==(e-=s))break;t=0}else t-=o}if(this.size-e<25&&(this.children.length>1||!(this.children[0]instanceof Fr))){var l=[];this.collapse(l),this.children=[new Fr(l)],this.children[0].parent=this}},collapse:function(t){for(var e=this,i=0;i<this.children.length;++i)e.children[i].collapse(t)},insertInner:function(t,e,i){var n=this;this.size+=e.length,this.height+=i;for(var r=0;r<this.children.length;++r){var o=n.children[r],s=o.chunkSize();if(t<=s){if(o.insertInner(t,e,i),o.lines&&o.lines.length>50){for(var a=o.lines.length%25+25,l=a;l<o.lines.length;){var h=new Fr(o.lines.slice(l,l+=25));o.height-=h.height,n.children.splice(++r,0,h),h.parent=n}o.lines=o.lines.slice(0,a),n.maybeSpill()}break}t-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e=t.children.splice(t.children.length-5,5),i=new $r(e);if(t.parent){t.size-=i.size,t.height-=i.height;var n=d(t.parent.children,t);t.parent.children.splice(n+1,0,i)}else{var r=new $r(t.children);r.parent=t,t.children=[r,i],t=r}i.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,e,i){for(var n=this,r=0;r<this.children.length;++r){var o=n.children[r],s=o.chunkSize();if(t<s){var a=Math.min(e,s-t);if(o.iterN(t,a,i))return!0;if(0==(e-=a))break;t=0}else t-=s}}};var Pa=function(t,e,i){var n=this;if(i)for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);this.doc=t,this.node=e};Pa.prototype.clear=function(){var t=this,e=this.doc.cm,i=this.line.widgets,n=this.line,r=R(n);if(null!=r&&i){for(var o=0;o<i.length;++o)i[o]==t&&i.splice(o--,1);i.length||(n.widgets=null);var s=He(this);M(n,Math.max(0,n.height-s)),e&&(dn(e,function(){jr(e,n,-s),vn(e,r,"widget")}),Te(e,"lineWidgetCleared",e,this,r))}},Pa.prototype.changed=function(){var t=this,e=this.height,i=this.doc.cm,n=this.line;this.height=null;var r=He(this)-e;r&&(M(n,n.height+r),i&&dn(i,function(){i.curOp.forceUpdate=!0,jr(i,n,r),Te(i,"lineWidgetChanged",i,t,R(n))}))},Nt(Pa);var Ea=0,ka=function(t,e){this.lines=[],this.type=e,this.doc=t,this.id=++Ea};ka.prototype.clear=function(){var t=this;if(!this.explicitlyCleared){var e=this.doc.cm,i=e&&!e.curOp;if(i&&rn(e),Lt(this,"clear")){var n=this.find();n&&Te(this,"clear",n.from,n.to)}for(var r=null,o=null,s=0;s<this.lines.length;++s){var a=t.lines[s],l=Z(a.markedSpans,t);e&&!t.collapsed?vn(e,R(a),"text"):e&&(null!=l.to&&(o=R(a)),
null!=l.from&&(r=R(a))),a.markedSpans=X(a.markedSpans,l),null==l.from&&t.collapsed&&!mt(t.doc,a)&&e&&M(a,yi(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var h=0;h<this.lines.length;++h){var u=ct(t.lines[h]),c=wt(u);c>e.display.maxLineLength&&(e.display.maxLine=u,e.display.maxLineLength=c,e.display.maxLineChanged=!0)}null!=r&&e&&this.collapsed&&mn(e,r,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&br(e.doc)),e&&Te(e,"markerCleared",e,this,r,o),i&&on(e),this.parent&&this.parent.clear()}},ka.prototype.find=function(t,e){var i=this;null==t&&"bookmark"==this.type&&(t=1);for(var n,r,o=0;o<this.lines.length;++o){var s=i.lines[o],a=Z(s.markedSpans,i);if(null!=a.from&&(n=A(e?s:R(s),a.from),-1==t))return n;if(null!=a.to&&(r=A(e?s:R(s),a.to),1==t))return r}return n&&{from:n,to:r}},ka.prototype.changed=function(){var t=this,e=this.find(-1,!0),i=this,n=this.doc.cm;e&&n&&dn(n,function(){var r=e.line,o=R(e.line),s=Ye(n,o);if(s&&(ni(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!mt(i.doc,r)&&null!=i.height){var a=i.height;i.height=null;var l=He(i)-a;l&&M(r,r.height+l)}Te(n,"markerChanged",n,t)})},ka.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=d(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},ka.prototype.detachLine=function(t){if(this.lines.splice(d(this.lines,t),1),!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}},Nt(ka);var Oa=function(t,e){var i=this;this.markers=t,this.primary=e;for(var n=0;n<t.length;++n)t[n].parent=i};Oa.prototype.clear=function(){var t=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)t.markers[e].clear();Te(this,"clear")}},Oa.prototype.find=function(t,e){return this.primary.find(t,e)},Nt(Oa);var Ma=0,Ra=function(t,e,i,n,r){if(!(this instanceof Ra))return new Ra(t,e,i,n,r);null==i&&(i=0),$r.call(this,[new Fr([new ua("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;var o=A(i,0);this.sel=Bn(o),this.history=new Qn(null),this.id=++Ma,this.modeOption=e,this.lineSep=n,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof t&&(t=this.splitLines(t)),Zn(this,{from:o,to:o,text:t}),wr(this,Bn(o),Fs)};Ra.prototype=w($r.prototype,{constructor:Ra,iter:function(t,e,i){i?this.iterN(t-this.first,e-t,i):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var i=0,n=0;n<e.length;++n)i+=e[n].height;this.insertInner(t-this.first,e,i)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=O(this,this.first,this.first+this.size);return!1===t?e:e.join(t||this.lineSeparator())},setValue:gn(function(t){var e=A(this.first,0),i=this.first+this.size-1;Or(this,{from:e,to:A(i,E(this,i).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&Ui(this.cm,0,0),wr(this,Bn(e),Fs)}),replaceRange:function(t,e,i,n){e=j(this,e),i=i?j(this,i):e,Ar(this,t,e,i,n)},getRange:function(t,e,i){var n=k(this,j(this,t),j(this,e));return!1===i?n:n.join(i||this.lineSeparator())},getLine:function(t){var e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){if(L(this,t))return E(this,t)},getLineNumber:function(t){return R(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=E(this,t)),ct(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return j(this,t)},getCursor:function(t){var e=this.sel.primary();return null==t||"head"==t?e.head:"anchor"==t?e.anchor:"end"==t||"to"==t||!1===t?e.to():e.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:gn(function(t,e,i){mr(this,j(this,"number"==typeof t?A(t,e||0):t),null,i)}),setSelection:gn(function(t,e,i){mr(this,j(this,t),j(this,e||t),i)}),extendSelection:gn(function(t,e,i){fr(this,j(this,t),e&&j(this,e),i)}),extendSelections:gn(function(t,e){pr(this,q(this,t),e)}),extendSelectionsBy:gn(function(t,e){pr(this,q(this,m(this.sel.ranges,t)),e)}),setSelections:gn(function(t,e,i){var n=this;if(t.length){for(var r=[],o=0;o<t.length;o++)r[o]=new Ca(j(n,t[o].anchor),j(n,t[o].head));null==e&&(e=Math.min(t.length-1,this.sel.primIndex)),wr(this,Hn(r,e),i)}}),addSelection:gn(function(t,e,i){var n=this.sel.ranges.slice(0);n.push(new Ca(j(this,t),j(this,e||t))),wr(this,Hn(n,n.length-1),i)}),getSelection:function(t){for(var e,i=this,n=this.sel.ranges,r=0;r<n.length;r++){var o=k(i,n[r].from(),n[r].to());e=e?e.concat(o):o}return!1===t?e:e.join(t||this.lineSeparator())},getSelections:function(t){for(var e=this,i=[],n=this.sel.ranges,r=0;r<n.length;r++){var o=k(e,n[r].from(),n[r].to());!1!==t&&(o=o.join(t||e.lineSeparator())),i[r]=o}return i},replaceSelection:function(t,e,i){for(var n=[],r=0;r<this.sel.ranges.length;r++)n[r]=t;this.replaceSelections(n,e,i||"+input")},replaceSelections:gn(function(t,e,i){for(var n=this,r=[],o=this.sel,s=0;s<o.ranges.length;s++){var a=o.ranges[s];r[s]={from:a.from(),to:a.to(),text:n.splitLines(t[s]),origin:i}}for(var l=e&&"end"!=e&&qn(this,r,e),h=r.length-1;h>=0;h--)Or(n,r[h]);l?yr(this,l):this.cm&&Vi(this.cm)}),undo:gn(function(){Rr(this,"undo")}),redo:gn(function(){Rr(this,"redo")}),undoSelection:gn(function(){Rr(this,"undo",!0)}),redoSelection:gn(function(){Rr(this,"redo",!0)}),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){for(var t=this.history,e=0,i=0,n=0;n<t.done.length;n++)t.done[n].ranges||++e;for(var r=0;r<t.undone.length;r++)t.undone[r].ranges||++i;return{undo:e,redo:i}},clearHistory:function(){this.history=new Qn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:cr(this.history.done),undone:cr(this.history.undone)}},setHistory:function(t){var e=this.history=new Qn(this.history.maxGeneration);e.done=cr(t.done.slice(0),null,!0),e.undone=cr(t.undone.slice(0),null,!0)},setGutterMarker:gn(function(t,e,i){return Br(this,t,"gutter",function(t){var n=t.gutterMarkers||(t.gutterMarkers={});return n[e]=i,!i&&b(n)&&(t.gutterMarkers=null),!0})}),clearGutter:gn(function(t){var e=this;this.iter(function(i){i.gutterMarkers&&i.gutterMarkers[t]&&Br(e,i,"gutter",function(){return i.gutterMarkers[t]=null,b(i.gutterMarkers)&&(i.gutterMarkers=null),!0})})}),lineInfo:function(t){var e;if("number"==typeof t){if(!L(this,t))return null;if(e=t,!(t=E(this,t)))return null}else if(null==(e=R(t)))return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:gn(function(e,i,n){return Br(this,e,"gutter"==i?"gutter":"class",function(e){var r="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass";if(e[r]){if(t(n).test(e[r]))return!1;e[r]+=" "+n}else e[r]=n;return!0})}),removeLineClass:gn(function(e,i,n){return Br(this,e,"gutter"==i?"gutter":"class",function(e){var r="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass",o=e[r];if(!o)return!1;if(null==n)e[r]=null;else{var s=o.match(t(n));if(!s)return!1;var a=s.index+s[0].length;e[r]=o.slice(0,s.index)+(s.index&&a!=o.length?" ":"")+o.slice(a)||null}return!0})}),addLineWidget:gn(function(t,e,i){return Wr(this,t,e,i)}),removeLineWidget:function(t){t.clear()},markText:function(t,e,i){return qr(this,j(this,t),j(this,e),i,i&&i.type||"range")},setBookmark:function(t,e){var i={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft,clearWhenEmpty:!1,shared:e&&e.shared,handleMouseEvents:e&&e.handleMouseEvents};return t=j(this,t),qr(this,t,t,i,"bookmark")},findMarksAt:function(t){t=j(this,t);var e=[],i=E(this,t.line).markedSpans;if(i)for(var n=0;n<i.length;++n){var r=i[n];(null==r.from||r.from<=t.ch)&&(null==r.to||r.to>=t.ch)&&e.push(r.marker.parent||r.marker)}return e},findMarks:function(t,e,i){t=j(this,t),e=j(this,e);var n=[],r=t.line;return this.iter(t.line,e.line+1,function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&r==t.line&&t.ch>=l.to||null==l.from&&r!=t.line||null!=l.from&&r==e.line&&l.from>=e.ch||i&&!i(l.marker)||n.push(l.marker.parent||l.marker)}++r}),n},getAllMarks:function(){var t=[];return this.iter(function(e){var i=e.markedSpans;if(i)for(var n=0;n<i.length;++n)null!=i[n].from&&t.push(i[n].marker)}),t},posFromIndex:function(t){var e,i=this.first,n=this.lineSeparator().length;return this.iter(function(r){var o=r.text.length+n;if(o>t)return e=t,!0;t-=o,++i}),j(this,A(i,e))},indexFromPos:function(t){t=j(this,t);var e=t.ch;if(t.line<this.first||t.ch<0)return 0;var i=this.lineSeparator().length;return this.iter(this.first,t.line,function(t){e+=t.text.length+i}),e},copy:function(t){var e=new Ra(O(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel=this.sel,e.extend=!1,t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});var e=this.first,i=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<i&&(i=t.to);var n=new Ra(O(this,e,i),t.mode||this.modeOption,e,this.lineSep,this.direction);return t.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:t.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],Gr(n,Ur(this)),n},unlinkDoc:function(t){var e=this;if(t instanceof $o&&(t=t.doc),this.linked)for(var i=0;i<this.linked.length;++i){var n=e.linked[i];if(n.doc==t){e.linked.splice(i,1),t.unlinkDoc(e),Zr(Ur(e));break}}if(t.history==this.history){var r=[t.id];Xn(t,function(t){return r.push(t.id)},!0),t.history=new Qn(null),t.history.done=cr(this.history.done,r),t.history.undone=cr(this.history.undone,r)}},iterLinkedDocs:function(t){Xn(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):Qs(t)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:gn(function(t){"rtl"!=t&&(t="ltr"),t!=this.direction&&(this.direction=t,this.iter(function(t){return t.order=null}),this.cm&&Jn(this.cm))})}),Ra.prototype.eachLine=Ra.prototype.iter;for(var Ia=0,La=!1,Na={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Aa=0;Aa<10;Aa++)Na[Aa+48]=Na[Aa+96]=String(Aa);for(var Da=65;Da<=90;Da++)Na[Da]=String.fromCharCode(Da);for(var za=1;za<=12;za++)Na[za+111]=Na[za+63235]="F"+za;var Ha={};Ha.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Ha.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Ha.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Ha.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Ha["default"]=Ps?Ha.macDefault:Ha.pcDefault;var Ba={selectAll:Er,singleSelection:function(t){return t.setSelection(t.getCursor("anchor"),t.getCursor("head"),Fs)},killLine:function(t){return uo(t,function(e){if(e.empty()){var i=E(t.doc,e.head.line).text.length;return e.head.ch==i&&e.head.line<t.lastLine()?{from:e.head,to:A(e.head.line+1,0)}:{from:e.head,to:A(e.head.line,i)}}return{from:e.from(),to:e.to()}})},deleteLine:function(t){return uo(t,function(e){return{from:A(e.from().line,0),to:j(t.doc,A(e.to().line+1,0))}})},delLineLeft:function(t){return uo(t,function(t){return{from:A(t.from().line,0),to:t.from()}})},delWrappedLineLeft:function(t){return uo(t,function(e){var i=t.charCoords(e.head,"div").top+5;return{from:t.coordsChar({left:0,top:i},"div"),to:e.from()}})},delWrappedLineRight:function(t){return uo(t,function(e){var i=t.charCoords(e.head,"div").top+5,n=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div");return{from:e.from(),to:n}})},undo:function(t){return t.undo()},redo:function(t){return t.redo()},undoSelection:function(t){return t.undoSelection()},redoSelection:function(t){return t.redoSelection()},goDocStart:function(t){return t.extendSelection(A(t.firstLine(),0))},goDocEnd:function(t){return t.extendSelection(A(t.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy(function(e){return co(t,e.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy(function(e){return po(t,e.head)},{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy(function(e){return fo(t,e.head.line)},{origin:"+move",bias:-1})},goLineRight:function(t){return t.extendSelectionsBy(function(e){var i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div")},js)},goLineLeft:function(t){return t.extendSelectionsBy(function(e){var i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:i},"div")},js)},goLineLeftSmart:function(t){return t.extendSelectionsBy(function(e){var i=t.cursorCoords(e.head,"div").top+5,n=t.coordsChar({left:0,top:i},"div");return n.ch<t.getLine(n.line).search(/\S/)?po(t,e.head):n},js)},goLineUp:function(t){return t.moveV(-1,"line")},goLineDown:function(t){return t.moveV(1,"line")},goPageUp:function(t){return t.moveV(-1,"page")},goPageDown:function(t){return t.moveV(1,"page")},goCharLeft:function(t){return t.moveH(-1,"char")},goCharRight:function(t){return t.moveH(1,"char")},goColumnLeft:function(t){return t.moveH(-1,"column")},goColumnRight:function(t){return t.moveH(1,"column")},goWordLeft:function(t){return t.moveH(-1,"word")},goGroupRight:function(t){return t.moveH(1,"group")},goGroupLeft:function(t){return t.moveH(-1,"group")},goWordRight:function(t){return t.moveH(1,"word")},delCharBefore:function(t){return t.deleteH(-1,"char")},delCharAfter:function(t){return t.deleteH(1,"char")},delWordBefore:function(t){return t.deleteH(-1,"word")},delWordAfter:function(t){return t.deleteH(1,"word")},delGroupBefore:function(t){return t.deleteH(-1,"group")},delGroupAfter:function(t){return t.deleteH(1,"group")},indentAuto:function(t){return t.indentSelection("smart")},indentMore:function(t){return t.indentSelection("add")},indentLess:function(t){return t.indentSelection("subtract")},insertTab:function(t){return t.replaceSelection("\t")},insertSoftTab:function(t){for(var e=[],i=t.listSelections(),n=t.options.tabSize,r=0;r<i.length;r++){var o=i[r].from(),s=c(t.getLine(o.line),o.ch,n);e.push(p(n-s%n))}t.replaceSelections(e)},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:function(t){return dn(t,function(){for(var e=t.listSelections(),i=[],n=0;n<e.length;n++)if(e[n].empty()){var r=e[n].head,o=E(t.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new A(r.line,r.ch-1)),r.ch>0)r=new A(r.line,r.ch+1),t.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),A(r.line,r.ch-2),r,"+transpose");else if(r.line>t.doc.first){var s=E(t.doc,r.line-1).text;s&&(r=new A(r.line,1),t.replaceRange(o.charAt(0)+t.doc.lineSeparator()+s.charAt(s.length-1),A(r.line-1,s.length-1),r,"+transpose"))}i.push(new Ca(r,r))}t.setSelections(i)})},newlineAndIndent:function(t){return dn(t,function(){for(var e=t.listSelections(),i=e.length-1;i>=0;i--)t.replaceRange(t.doc.lineSeparator(),e[i].anchor,e[i].head,"+input");e=t.listSelections();for(var n=0;n<e.length;n++)t.indentLine(e[n].from().line,null,!0);Vi(t)})},openLine:function(t){return t.replaceSelection("\n","start")},toggleOverwrite:function(t){return t.toggleOverwrite()}},Fa=new As,$a=null,ja=function(t,e,i){this.time=t,this.pos=e,this.button=i};ja.prototype.compare=function(t,e,i){return this.time+400>t&&0==D(e,this.pos)&&i==this.button};var Wa,qa,Va={toString:function(){return"CodeMirror.Init"}},Ua={},Ga={};$o.defaults=Ua,$o.optionHandlers=Ga;var Za=[];$o.defineInitHook=function(t){return Za.push(t)};var Xa=null,Ya=function(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new As,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Ya.prototype.init=function(t){function e(t){if(!Rt(r,t)){if(r.somethingSelected())qo({lineWise:!1,text:r.getSelections()}),"cut"==t.type&&r.replaceSelection("",null,"cut");else{if(!r.options.lineWiseCopyCut)return;var e=Zo(r);qo({lineWise:!0,text:e.text}),"cut"==t.type&&r.operation(function(){r.setSelections(e.ranges,0,Fs),r.replaceSelection("",null,"cut")})}if(t.clipboardData){t.clipboardData.clearData();var i=Xa.text.join("\n");if(t.clipboardData.setData("Text",i),t.clipboardData.getData("Text")==i)return void t.preventDefault()}var s=Yo(),a=s.firstChild;r.display.lineSpace.insertBefore(s,r.display.lineSpace.firstChild),a.value=Xa.text.join("\n");var l=document.activeElement;Ns(a),setTimeout(function(){r.display.lineSpace.removeChild(s),l.focus(),l==o&&n.showPrimarySelection()},50)}}var i=this,n=this,r=n.cm,o=n.div=t.lineDiv;Xo(o,r.options.spellcheck),Ks(o,"paste",function(t){Rt(r,t)||Uo(t,r)||gs<=11&&setTimeout(fn(r,function(){return i.updateFromDOM()}),20)}),Ks(o,"compositionstart",function(t){i.composing={data:t.data,done:!1}}),Ks(o,"compositionupdate",function(t){i.composing||(i.composing={data:t.data,done:!1})}),Ks(o,"compositionend",function(t){i.composing&&(t.data!=i.composing.data&&i.readFromDOMSoon(),i.composing.done=!0)}),Ks(o,"touchstart",function(){return n.forceCompositionEnd()}),Ks(o,"input",function(){i.composing||i.readFromDOMSoon()}),Ks(o,"copy",e),Ks(o,"cut",e)},Ya.prototype.prepareSelection=function(){var t=Ei(this.cm,!1);return t.focus=this.cm.state.focused,t},Ya.prototype.showSelection=function(t,e){t&&this.cm.display.view.length&&((t.focus||e)&&this.showPrimarySelection(),this.showMultipleSelections(t))},Ya.prototype.showPrimarySelection=function(){var t=window.getSelection(),e=this.cm,i=e.doc.sel.primary(),n=i.from(),r=i.to();if(e.display.viewTo==e.display.viewFrom||n.line>=e.display.viewTo||r.line<e.display.viewFrom)return void t.removeAllRanges();var o=rs(e,t.anchorNode,t.anchorOffset),s=rs(e,t.focusNode,t.focusOffset);if(!o||o.bad||!s||s.bad||0!=D(F(o,s),n)||0!=D(B(o,s),r)){var a=e.display.view,l=n.line>=e.display.viewFrom&&ts(e,n)||{node:a[0].measure.map[2],offset:0},h=r.line<e.display.viewTo&&ts(e,r);if(!h){var u=a[a.length-1].measure,c=u.maps?u.maps[u.maps.length-1]:u.map;h={node:c[c.length-1],offset:c[c.length-2]-c[c.length-3]}}if(!l||!h)return void t.removeAllRanges();var d,f=t.rangeCount&&t.getRangeAt(0);try{d=Ms(l.node,l.offset,h.offset,h.node)}catch(t){}d&&(!us&&e.state.focused?(t.collapse(l.node,l.offset),d.collapsed||(t.removeAllRanges(),t.addRange(d))):(t.removeAllRanges(),t.addRange(d)),f&&null==t.anchorNode?t.addRange(f):us&&this.startGracePeriod()),this.rememberSelection()}},Ya.prototype.startGracePeriod=function(){var t=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){t.gracePeriod=!1,t.selectionChanged()&&t.cm.operation(function(){return t.cm.curOp.selectionChanged=!0})},20)},Ya.prototype.showMultipleSelections=function(t){i(this.cm.display.cursorDiv,t.cursors),i(this.cm.display.selectionDiv,t.selection)},Ya.prototype.rememberSelection=function(){var t=window.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset},Ya.prototype.selectionInEditor=function(){var t=window.getSelection();if(!t.rangeCount)return!1;var e=t.getRangeAt(0).commonAncestorContainer;return o(this.div,e)},Ya.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Ya.prototype.blur=function(){this.div.blur()},Ya.prototype.getField=function(){return this.div},Ya.prototype.supportsTouch=function(){return!0},Ya.prototype.receivedFocus=function(){function t(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,t))}var e=this;this.selectionInEditor()?this.pollSelection():dn(this.cm,function(){return e.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,t)},Ya.prototype.selectionChanged=function(){var t=window.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset},Ya.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var t=window.getSelection(),e=this.cm;if(Ts&&ys&&this.cm.options.gutters.length&&es(t.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var i=rs(e,t.anchorNode,t.anchorOffset),n=rs(e,t.focusNode,t.focusOffset);i&&n&&dn(e,function(){wr(e.doc,Bn(i,n),Fs),(i.bad||n.bad)&&(e.curOp.selectionChanged=!0)})}}},Ya.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var t=this.cm,e=t.display,i=t.doc.sel.primary(),n=i.from(),r=i.to();if(0==n.ch&&n.line>t.firstLine()&&(n=A(n.line-1,E(t.doc,n.line-1).length)),r.ch==E(t.doc,r.line).text.length&&r.line<t.lastLine()&&(r=A(r.line+1,0)),n.line<e.viewFrom||r.line>e.viewTo-1)return!1;var o,s,a;n.line==e.viewFrom||0==(o=Ci(t,n.line))?(s=R(e.view[0].line),a=e.view[0].node):(s=R(e.view[o].line),a=e.view[o-1].node.nextSibling);var l,h,u=Ci(t,r.line);if(u==e.view.length-1?(l=e.viewTo-1,h=e.lineDiv.lastChild):(l=R(e.view[u+1].line)-1,h=e.view[u+1].node.previousSibling),!a)return!1;for(var c=t.doc.splitLines(ns(t,a,h,s,l)),d=k(t.doc,A(s,0),A(l,E(t.doc,l).text.length));c.length>1&&d.length>1;)if(g(c)==g(d))c.pop(),d.pop(),l--;else{if(c[0]!=d[0])break;c.shift(),d.shift(),s++}for(var f=0,p=0,m=c[0],v=d[0],y=Math.min(m.length,v.length);f<y&&m.charCodeAt(f)==v.charCodeAt(f);)++f;for(var w=g(c),_=g(d),x=Math.min(w.length-(1==c.length?f:0),_.length-(1==d.length?f:0));p<x&&w.charCodeAt(w.length-p-1)==_.charCodeAt(_.length-p-1);)++p;if(1==c.length&&1==d.length&&s==n.line)for(;f&&f>n.ch&&w.charCodeAt(w.length-p-1)==_.charCodeAt(_.length-p-1);)f--,p++;c[c.length-1]=w.slice(0,w.length-p).replace(/^\u200b+/,""),c[0]=c[0].slice(f).replace(/\u200b+$/,"");var b=A(s,f),S=A(l,d.length?g(d).length-p:0);return c.length>1||c[0]||D(b,S)?(Ar(t.doc,c,b,S,"+input"),!0):void 0},Ya.prototype.ensurePolled=function(){this.forceCompositionEnd()},Ya.prototype.reset=function(){this.forceCompositionEnd()},Ya.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Ya.prototype.readFromDOMSoon=function(){var t=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(t.readDOMTimeout=null,t.composing){if(!t.composing.done)return;t.composing=null}t.updateFromDOM()},80))},Ya.prototype.updateFromDOM=function(){var t=this;!this.cm.isReadOnly()&&this.pollContent()||dn(this.cm,function(){return mn(t.cm)})},Ya.prototype.setUneditable=function(t){t.contentEditable="false"},Ya.prototype.onKeyPress=function(t){0!=t.charCode&&(t.preventDefault(),this.cm.isReadOnly()||fn(this.cm,Vo)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0))},Ya.prototype.readOnlyChanged=function(t){this.div.contentEditable=String("nocursor"!=t)},Ya.prototype.onContextMenu=function(){},Ya.prototype.resetPosition=function(){},Ya.prototype.needsContentAttribute=!0;var Ka=function(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new As,this.hasSelection=!1,this.composing=null};Ka.prototype.init=function(t){function e(t){if(!Rt(r,t)){if(r.somethingSelected())qo({lineWise:!1,text:r.getSelections()});else{if(!r.options.lineWiseCopyCut)return;var e=Zo(r);qo({lineWise:!0,text:e.text}),"cut"==t.type?r.setSelections(e.ranges,null,Fs):(n.prevInput="",s.value=e.text.join("\n"),Ns(s))}"cut"==t.type&&(r.state.cutIncoming=!0)}}var i=this,n=this,r=this.cm,o=this.wrapper=Yo(),s=this.textarea=o.firstChild;t.wrapper.insertBefore(o,t.wrapper.firstChild),Ss&&(s.style.width="0px"),Ks(s,"input",function(){ps&&gs>=9&&i.hasSelection&&(i.hasSelection=null),n.poll()}),Ks(s,"paste",function(t){Rt(r,t)||Uo(t,r)||(r.state.pasteIncoming=!0,n.fastPoll())}),Ks(s,"cut",e),Ks(s,"copy",e),Ks(t.scroller,"paste",function(e){Be(t,e)||Rt(r,e)||(r.state.pasteIncoming=!0,n.focus())}),Ks(t.lineSpace,"selectstart",function(e){Be(t,e)||At(e)}),Ks(s,"compositionstart",function(){var t=r.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:t,range:r.markText(t,r.getCursor("to"),{className:"CodeMirror-composing"})}}),Ks(s,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Ka.prototype.prepareSelection=function(){var t=this.cm,e=t.display,i=t.doc,n=Ei(t);if(t.options.moveInputWithCursor){var r=ci(t,i.sel.primary().head,"div"),o=e.wrapper.getBoundingClientRect(),s=e.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(e.wrapper.clientHeight-10,r.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(e.wrapper.clientWidth-10,r.left+s.left-o.left))}return n},Ka.prototype.showSelection=function(t){var e=this.cm,n=e.display;i(n.cursorDiv,t.cursors),i(n.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")},Ka.prototype.reset=function(t){if(!this.contextMenuPending&&!this.composing){var e=this.cm;if(e.somethingSelected()){this.prevInput="";var i=e.getSelection();this.textarea.value=i,e.state.focused&&Ns(this.textarea),ps&&gs>=9&&(this.hasSelection=i)}else t||(this.prevInput=this.textarea.value="",ps&&gs>=9&&(this.hasSelection=null))}},Ka.prototype.getField=function(){return this.textarea},Ka.prototype.supportsTouch=function(){return!1},Ka.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Cs||s()!=this.textarea))try{this.textarea.focus()}catch(t){}},Ka.prototype.blur=function(){this.textarea.blur()},Ka.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Ka.prototype.receivedFocus=function(){this.slowPoll()},Ka.prototype.slowPoll=function(){var t=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){t.poll(),t.cm.state.focused&&t.slowPoll()})},Ka.prototype.fastPoll=function(){function t(){i.poll()||e?(i.pollingFast=!1,i.slowPoll()):(e=!0,i.polling.set(60,t))}var e=!1,i=this;i.pollingFast=!0,i.polling.set(20,t)},Ka.prototype.poll=function(){var t=this,e=this.cm,i=this.textarea,n=this.prevInput;if(this.contextMenuPending||!e.state.focused||ta(i)&&!n&&!this.composing||e.isReadOnly()||e.options.disableInput||e.state.keySeq)return!1;var r=i.value;if(r==n&&!e.somethingSelected())return!1;if(ps&&gs>=9&&this.hasSelection===r||Ps&&/[\uf700-\uf7ff]/.test(r))return e.display.input.reset(),!1;if(e.doc.sel==e.display.selForContextMenu){var o=r.charCodeAt(0);if(8203!=o||n||(n="\u200b"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var s=0,a=Math.min(n.length,r.length);s<a&&n.charCodeAt(s)==r.charCodeAt(s);)++s;return dn(e,function(){Vo(e,r.slice(s),n.length-s,null,t.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?i.value=t.prevInput="":t.prevInput=r,t.composing&&(t.composing.range.clear(),t.composing.range=e.markText(t.composing.start,e.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Ka.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Ka.prototype.onKeyPress=function(){ps&&gs>=9&&(this.hasSelection=null),this.fastPoll()},Ka.prototype.onContextMenu=function(t){function e(){if(null!=s.selectionStart){var t=r.somethingSelected(),e="\u200b"+(t?s.value:"");s.value="\u21da",s.value=e,n.prevInput=t?"":"\u200b",s.selectionStart=1,s.selectionEnd=e.length,o.selForContextMenu=r.doc.sel}}function i(){if(n.contextMenuPending=!1,n.wrapper.style.cssText=u,s.style.cssText=h,ps&&gs<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=l),null!=s.selectionStart){(!ps||ps&&gs<9)&&e();var t=0,i=function(){o.selForContextMenu==r.doc.sel&&0==s.selectionStart&&s.selectionEnd>0&&"\u200b"==n.prevInput?fn(r,Er)(r):t++<10?o.detectingSelectAll=setTimeout(i,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(i,200)}}var n=this,r=n.cm,o=r.display,s=n.textarea,a=Ti(r,t),l=o.scroller.scrollTop;if(a&&!ws){r.options.resetSelectionOnContextMenu&&-1==r.doc.sel.contains(a)&&fn(r,wr)(r.doc,Bn(a),Fs);var h=s.style.cssText,u=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var c=n.wrapper.getBoundingClientRect();s.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(t.clientY-c.top-5)+"px; left: "+(t.clientX-c.left-5)+"px;\n      z-index: 1000; background: "+(ps?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var d;if(ms&&(d=window.scrollY),o.input.focus(),ms&&window.scrollTo(null,d),o.input.reset(),r.somethingSelected()||(s.value=n.prevInput=" "),n.contextMenuPending=!0,o.selForContextMenu=r.doc.sel,clearTimeout(o.detectingSelectAll),ps&&gs>=9&&e(),Is){Ht(t);var f=function(){Ot(window,"mouseup",f),setTimeout(i,20)};Ks(window,"mouseup",f)}else setTimeout(i,50)}},Ka.prototype.readOnlyChanged=function(t){t||this.reset(),this.textarea.disabled="nocursor"==t},Ka.prototype.setUneditable=function(){},Ka.prototype.needsContentAttribute=!1,zo($o),Ko($o);var Ja="iter insert remove copy getEditor constructor".split(" ");for(var Qa in Ra.prototype)Ra.prototype.hasOwnProperty(Qa)&&d(Ja,Qa)<0&&($o.prototype[Qa]=function(t){return function(){return t.apply(this.doc,arguments)}}(Ra.prototype[Qa]));return Nt(Ra),$o.inputStyles={textarea:Ka,contenteditable:Ya},$o.defineMode=function(t){$o.defaults.mode||"null"==t||($o.defaults.mode=t),qt.apply(this,arguments)},$o.defineMIME=Vt,$o.defineMode("null",function(){return{token:function(t){return t.skipToEnd()}}}),$o.defineMIME("text/plain","null"),$o.defineExtension=function(t,e){$o.prototype[t]=e},
$o.defineDocExtension=function(t,e){Ra.prototype[t]=e},$o.fromTextArea=ss,as($o),$o.version="5.28.0",$o}),function(){if(!window.OpenSeadragon)return void console.error("[openseadragon-canvas-overlay] requires OpenSeadragon");OpenSeadragon.Viewer.prototype.paperjsOverlay=function(){return this._paperjsOverlayInfo?this._paperjsOverlayInfo:(this._paperjsOverlayInfo=new t(this),this._paperjsOverlayInfo)};var t=function(t){var e=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._canvasdiv=document.createElement("div"),this._canvasdiv.style.position="absolute",this._canvasdiv.style.left=0,this._canvasdiv.style.top=0,this._canvasdiv.style.width="100%",this._canvasdiv.style.height="100%",this._viewer.canvas.appendChild(this._canvasdiv),this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","osd-overlaycanvas"),this._canvasdiv.appendChild(this._canvas),this.resize(),paper.setup(this._canvas),this._viewer.addHandler("update-viewport",function(){e.resize(),e.resizecanvas()}),this._viewer.addHandler("open",function(){e.resize(),e.resizecanvas()}),this.resize()};t.prototype={paperCanvas:function(){return this._canvas},clear:function(){},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._canvasdiv.setAttribute("width",this._containerWidth),this._canvas.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._canvasdiv.setAttribute("height",this._containerHeight),this._canvas.setAttribute("height",this._containerHeight))},resizecanvas:function(){this._canvasdiv.setAttribute("width",this._containerWidth),this._canvas.setAttribute("width",this._containerWidth),this._canvasdiv.setAttribute("height",this._containerHeight),this._canvas.setAttribute("height",this._containerHeight),paper.view.viewSize=new paper.Size(this._containerWidth,this._containerHeight);var t=this._viewer.viewport.getZoom(!0),e=this._viewer.world.getItemAt(0);paper.view.zoom=e.viewportToImageZoom(t);var i=this._viewer.viewport.viewportToImageCoordinates(this._viewer.viewport.getCenter(!0));paper.view.center=new paper.Point(i.x,i.y)}}}();var paper=new function(t){var e=new function(){function i(t,i,n,r,s){function a(o,a){"string"==typeof(a=a||(a=h(i,o))&&(a.get?a:a.value))&&"#"===a[0]&&(a=t[a.substring(1)]||a);var u,d="function"==typeof a,f=a,p=s||d&&!a.base?a&&a.get?o in t:t[o]:null;s&&p||(d&&p&&(a.base=p),d&&!1!==r&&(u=o.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[u[3].toLowerCase()+u[4]]=u[2]),f&&!d&&f.get&&"function"==typeof f.get&&e.isPlainObject(f)||(f={value:f,writable:!0}),(h(t,o)||{configurable:!0}).configurable&&(f.configurable=!0,f.enumerable=n),c(t,o,f))}var l={};if(i){for(var u in i)i.hasOwnProperty(u)&&!o.test(u)&&a(u);for(var u in l){var d=l[u],f=t["set"+d],p=t["get"+d]||f&&t["is"+d];!p||!0!==r&&0!==p.length||a(u,{get:p,set:f})}}return t}function n(t,e,i){return t&&("length"in t&&!t.getLength&&"number"==typeof t.length?s:a).call(t,e,i=i||t),i}function r(t,e,i){for(var n in e)!e.hasOwnProperty(n)||i&&i[n]||(t[n]=e[n]);return t}var o=/^(statics|enumerable|beans|preserve)$/,s=[].forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},a=function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)},l=Object.create||function(t){return{__proto__:t}},h=Object.getOwnPropertyDescriptor||function(t,e){var i=t.__lookupGetter__&&t.__lookupGetter__(e);return i?{get:i,set:t.__lookupSetter__(e),enumerable:!0,configurable:!0}:t.hasOwnProperty(e)?{value:t[e],enumerable:!0,configurable:!0,writable:!0}:null},u=Object.defineProperty||function(t,e,i){return(i.get||i.set)&&t.__defineGetter__?(i.get&&t.__defineGetter__(e,i.get),i.set&&t.__defineSetter__(e,i.set)):t[e]=i.value,t},c=function(t,e,i){return delete t[e],u(t,e,i)};return i(function(){for(var t=0,e=arguments.length;t<e;t++)r(this,arguments[t])},{inject:function(t){if(t){var e=!0===t.statics?t:t.statics,n=t.beans,r=t.preserve;e!==t&&i(this.prototype,t,t.enumerable,n,r),i(this,e,!0,n,r)}for(var o=1,s=arguments.length;o<s;o++)this.inject(arguments[o]);return this},extend:function(){for(var t,e,n=this,r=0,o=arguments.length;r<o&&!(t=arguments[r].initialize);r++);return t=t||function(){n.apply(this,arguments)},e=t.prototype=l(this.prototype),c(e,"constructor",{value:t,writable:!0,configurable:!0}),i(t,this,!0),arguments.length&&this.inject.apply(t,arguments),t.base=n,t}},!0).inject({inject:function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];n&&i(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=l(this);return t.inject.apply(t,arguments)},each:function(t,e){return n(this,t,e)},set:function(t){return r(this,t)},clone:function(){return new this.constructor(this)},statics:{each:n,create:l,define:c,describe:h,set:r,clone:function(t){return r(new t.constructor,t)},isPlainObject:function(t){var i=null!=t&&t.constructor;return i&&(i===Object||i===e||"Object"===i.name)},pick:function(e,i){return e!==t?e:i}}})};"undefined"!=typeof module&&(module.exports=e),e.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+e.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?o.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},exportJSON:function(t){return e.exportJSON(this,t)},toJSON:function(){return e.serialize(this)},_set:function(i,n,r){if(i&&(r||e.isPlainObject(i))){for(var o=Object.keys(i._filtering||i),s=0,a=o.length;s<a;s++){var l=o[s];if(!n||!n[l]){var h=i[l];h!==t&&(this[l]=h)}}return!0}},statics:{exports:{enumerable:!0},extend:function t(){var i=t.base.apply(this,arguments),n=i.prototype._class;return n&&!e.exports[n]&&(e.exports[n]=i),i},equals:function(t,i){if(t===i)return!0;if(t&&t.equals)return t.equals(i);if(i&&i.equals)return i.equals(t);if(t&&i&&"object"==typeof t&&"object"==typeof i){if(Array.isArray(t)&&Array.isArray(i)){var n=t.length;if(n!==i.length)return!1;for(;n--;)if(!e.equals(t[n],i[n]))return!1}else{var r=Object.keys(t),n=r.length;if(n!==Object.keys(i).length)return!1;for(;n--;){var o=r[n];if(!i.hasOwnProperty(o)||!e.equals(t[o],i[o]))return!1}}return!0}return!1},read:function(i,n,r,o){if(this===e){var s=this.peek(i,n);return i.__index++,s}var a=this.prototype,l=a._readIndex,h=n||l&&i.__index||0;o||(o=i.length-h);var u=i[h];return u instanceof this||r&&r.readNull&&null==u&&o<=1?(l&&(i.__index=h+1),u&&r&&r.clone?u.clone():u):(u=e.create(this.prototype),l&&(u.__read=!0),u=u.initialize.apply(u,h>0||o<i.length?Array.prototype.slice.call(i,h,h+o):i)||u,l&&(i.__index=h+u.__read,u.__read=t),u)},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readAll:function(t,e,i){for(var n,r=[],o=e||0,s=t.length;o<s;o++)r.push(Array.isArray(n=t[o])?this.read(n,0,i):this.read(t,o,i,1));return r},readNamed:function(i,n,r,o,s){var a=this.getNamed(i,n),l=a!==t;if(l){var h=i._filtered;h||(h=i._filtered=e.create(i[0]),h._filtering=i[0]),h[n]=t}return this.read(l?[a]:i,r,o,s)},getNamed:function(i,n){var r=i[0];if(i._hasObject===t&&(i._hasObject=1===i.length&&e.isPlainObject(r)),i._hasObject)return n?r[n]:i._filtered||r},hasNamed:function(t,e){return!!this.getNamed(t,e)},isPlainValue:function(t,e){return this.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,i,n,r){i=i||{};var s,a=!r;if(a&&(i.formatter=new o(i.precision),r={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),o=t._class;o&&r[0]!==o&&r.unshift(o),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){s=t._serialize(i,r);var l=t._class;!l||n||s._compact||s[0]===l||s.unshift(l)}else if(Array.isArray(t)){s=[];for(var h=0,u=t.length;h<u;h++)s[h]=e.serialize(t[h],i,n,r);n&&(s._compact=!0)}else if(e.isPlainObject(t)){s={};for(var c=Object.keys(t),h=0,u=c.length;h<u;h++){var d=c[h];s[d]=e.serialize(t[d],i,n,r)}}else s="number"==typeof t?i.formatter.number(t,i.precision):t;return a&&r.length>0?[["dictionary",r.definitions],s]:s},deserialize:function(t,i,n,r){var o=t,s=!n;if(n=n||{},Array.isArray(t)){var a=t[0],l="dictionary"===a;if(1==t.length&&/^#/.test(a))return n.dictionary[a];a=e.exports[a],o=[],r&&(n.dictionary=o);for(var h=a?1:0,u=t.length;h<u;h++)o.push(e.deserialize(t[h],i,n,l));if(a){var c=o;i?o=i(a,c):(o=e.create(a.prototype),a.apply(o,c))}}else if(e.isPlainObject(t)){o={},r&&(n.dictionary=o);for(var d in t)o[d]=e.deserialize(t[d],i,n)}return s&&t&&t.length&&"dictionary"===t[0][0]?o[1]:o},exportJSON:function(t,i){var n=e.serialize(t,i);return i&&!1===i.asString?n:JSON.stringify(n)},importJSON:function(t,i){return e.deserialize("string"==typeof t?JSON.parse(t):t,function(t,n){var r=i&&i.constructor===t?i:e.create(t.prototype),o=r===i;if(1===n.length&&r instanceof y&&(o||!(r instanceof _))){var s=n[0];e.isPlainObject(s)&&(s.insert=!1)}return t.apply(r,n),o&&(i=null),r})},splice:function(e,i,n,r){var o=i&&i.length,s=n===t;(n=s?e.length:n)>e.length&&(n=e.length);for(var a=0;a<o;a++)i[a]._index=n+a;if(s)return e.push.apply(e,i),[];var l=[n,r];i&&l.push.apply(l,i);for(var h=e.splice.apply(e,l),a=0,u=h.length;a<u;a++)h[a]._index=t;for(var a=n+o,u=e.length;a<u;a++)e[a]._index=a;return h},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var i={on:function(t,i){if("string"!=typeof t)e.each(t,function(t,e){this.on(e,t)},this);else{var n=this._eventTypes,r=n&&n[t],o=this._callbacks=this._callbacks||{};o=o[t]=o[t]||[],-1===o.indexOf(i)&&(o.push(i),r&&r.install&&1===o.length&&r.install.call(this,t))}return this},off:function(t,i){if("string"!=typeof t)return void e.each(t,function(t,e){this.off(e,t)},this);var n,r=this._eventTypes,o=r&&r[t],s=this._callbacks&&this._callbacks[t];return s&&(!i||-1!==(n=s.indexOf(i))&&1===s.length?(o&&o.uninstall&&o.uninstall.call(this,t),delete this._callbacks[t]):-1!==n&&s.splice(n,1)),this},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=[].slice.call(arguments,1);i=i.slice();for(var r=0,o=i.length;r<o;r++)if(!1===i[r].apply(this,n)){e&&e.stop&&e.stop();break}return!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._callbacks,i=t?"install":"uninstall";for(var n in e)if(e[n].length>0){var r=this._eventTypes,o=r&&r[n],s=o&&o[i];s&&s.call(this,n)}},statics:{inject:function t(i){var n=i._events;if(n){var r={};e.each(n,function(t,n){var o="string"==typeof t,s=o?t:n,a=e.capitalize(s),l=s.substring(2).toLowerCase();r[l]=o?{}:t,s="_"+s,i["get"+a]=function(){return this[s]},i["set"+a]=function(t){var e=this[s];e&&this.off(l,e),t&&this.on(l,t),this[s]=t}}),i._eventTypes=r}return t.base.apply(this,arguments)}}},n=e.extend({_class:"PaperScope",initialize:function t(){paper=this,this.settings=new e({applyMatrix:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=t._id++,t._scopes[this._id]=this;var i=t.prototype;if(!this.support){var n=Y.getContext(1,1);i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:K.nativeModes},Y.release(n)}if(!this.browser){var r=navigator.userAgent.toLowerCase(),o=(/(win)/.exec(r)||/(mac)/.exec(r)||/(linux)/.exec(r)||[])[0],s=i.browser={platform:o};o&&(s[o]=!0),r.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:([.\d]+))?/g,function(t,e,i,n,r){if(!s.chrome){var o="opera"===e?n:i;"trident"===e&&(o=r,e="msie"),s.version=o,s.versionNumber=parseFloat(o),s.name=e,s[e]=!0}}),s.chrome&&delete s.webkit,s.atom&&delete s.chrome}},version:"0.9.25",getView:function(){return this.project&&this.project.getView()},getPaper:function(){return this},execute:function(t,e,i){paper.PaperScript.execute(t,this,e,i),j.updateFocus()},install:function(t){var i=this;e.each(["project","view","tool"],function(n){e.define(t,n,{configurable:!0,get:function(){return i[n]}})});for(var n in this)!/^_/.test(n)&&this[n]&&(t[n]=this[n])},setup:function(t){return paper=this,this.project=new m(t),this},activate:function(){paper=this},clear:function(){for(var t=this.projects.length-1;t>=0;t--)this.projects[t].remove();for(var t=this.tools.length-1;t>=0;t--)this.tools[t].remove();for(var t=this.palettes.length-1;t>=0;t--)this.palettes[t].remove()},remove:function(){this.clear(),delete n._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),r=e.extend(i,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(e.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),o=e.extend({initialize:function(t){this.precision=t||5,this.multiplier=Math.pow(10,this.precision)},number:function(t){return Math.round(t*this.multiplier)/this.multiplier},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});o.instance=new o;var s=new function(){function t(t,e,i){return t<e?e:t>i?i:t}var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],i=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],n=Math.abs,r=Math.sqrt,o=Math.pow,a=1e-12,l=1.12e-16;return{TOLERANCE:1e-6,EPSILON:a,MACHINE_EPSILON:l,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:2e-7,WINDING_EPSILON:2e-7,TRIGONOMETRIC_EPSILON:1e-7,CLIPPING_EPSILON:1e-7,KAPPA:4*(r(2)-1)/3,isZero:function(t){return t>=-a&&t<=a},integrate:function(t,n,r,o){for(var s=e[o-2],a=i[o-2],l=.5*(r-n),h=l+n,u=0,c=o+1>>1,d=1&o?a[u++]*t(h):0;u<c;){var f=l*s[u];d+=a[u++]*(t(h+f)+t(h-f))}return l*d},findRoot:function(t,e,i,r,o,s,a){for(var l=0;l<s;l++){var h=t(i),u=h/e(i),c=i-u;if(n(u)<a)return c;h>0?(o=i,i=c<=r?.5*(r+o):c):(r=i,i=c>=o?.5*(r+o):c)}return i},solveQuadratic:function(e,i,s,h,u,c){var d,f,p=0,g=u-a,m=c+a,v=Infinity,y=i;if(i/=-2,0!==(f=i*i-e*s)&&n(f)<l){var w=o(n(e*i*s),1/3);if(w<1e-8){var _=o(10,n(Math.floor(Math.log(w)*Math.LOG10E)));isFinite(_)||(_=0),e*=_,i*=_,s*=_,f=i*i-e*s}}if(n(e)<a){if(n(y)<a)return n(s)<a?-1:0;d=-s/y}else if(f>=-l){var x=f<0?0:r(f),b=i+(i<0?-x:x);0===b?(d=s/e,v=-d):(d=b/e,v=s/b)}return isFinite(d)&&(null==u||d>g&&d<m)&&(h[p++]=null==u?d:t(d,u,c)),v!==d&&isFinite(v)&&(null==u||v>g&&v<m)&&(h[p++]=null==u?v:t(v,u,c)),p},solveCubic:function(e,i,h,u,c,d,f){var p,g,m,v=0;if(n(e)<a)e=i,g=h,m=u,p=Infinity;else if(n(u)<a)g=i,m=h,p=0;else{var y,w,_,x,b,S,T,C=1+l;if(p=-i/e/3,T=e*p,g=T+i,m=g*p+h,_=(T+g)*p+m,w=m*p+u,x=w/e,b=o(n(x),1/3),S=x<0?-1:1,x=-_/e,b=x>0?1.3247179572*Math.max(b,r(x)):b,(y=p-S*b)!==p){do{if(p=y,T=e*p,g=T+i,m=g*p+h,_=(T+g)*p+m,w=m*p+u,(y=0===_?p:p-w/_/C)===p){p=y;break}}while(S*y>S*p);n(e)*p*p>n(u/p)&&(m=-u/p,g=(m-h)/p)}}var v=s.solveQuadratic(e,g,m,c,d,f);return isFinite(p)&&(0===v||p!==c[v-1])&&(null==d||p>d-a&&p<f+a)&&(c[v++]=null==d?p:t(p,d,f)),v}}},a={_id:1,_pools:{},get:function(t){if(t){var e=t._class,i=this._pools[e];return i||(i=this._pools[e]={_id:1}),i._id++}return this._id++}},l=e.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;this.x=t,this.y=n?e:t,this.__read&&(this.__read=n?2:1)}else"undefined"===i||null===t?(this.x=this.y=0,this.__read&&(this.__read=null===t?1:0)):(Array.isArray(t)?(this.x=t[0],this.y=t.length>1?t[1]:t[0]):null!=t.x?(this.x=t.x,this.y=t.y):null!=t.width?(this.x=t.width,this.y=t.height):null!=t.angle?(this.x=t.length,this.y=0,this.setAngle(t.angle)):(this.x=this.y=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new l(this.x,this.y)},toString:function(){var t=o.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this.set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();s.isZero(i)&&this.getAngle(),this.set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=l.read(arguments),e=this.getLength()*t.getLength();if(s.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this.set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=l.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=l.read(arguments),i=t.x-this.x,n=t.y-this.y,r=i*i+n*n;return e.read(arguments)?r:Math.sqrt(r)},normalize:function(e){e===t&&(e=1);var i=this.getLength(),n=0!==i?e/i:0,r=new l(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new l(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=l.read(arguments);return new l(this.x+t.x,this.y+t.y)},subtract:function(){var t=l.read(arguments);return new l(this.x-t.x,this.y-t.y)},multiply:function(){var t=l.read(arguments);return new l(this.x*t.x,this.y*t.y)},divide:function(){var t=l.read(arguments);return new l(this.x/t.x,this.y/t.y)},modulo:function(){var t=l.read(arguments);return new l(this.x%t.x,this.y%t.y)},negate:function(){return new l(-this.x,-this.y)},isInside:function(){return d.read(arguments).contains(this)},isClose:function(){var t=l.read(arguments),i=e.read(arguments);return this.getDistance(t)<i},isCollinear:function(){var t=l.read(arguments);return l.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=l.read(arguments);return l.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){return s.isZero(this.x)&&s.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var t=l.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=l.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=l.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new l(t.x*e,t.y*e)},statics:{min:function(){var t=l.read(arguments),e=l.read(arguments);return new l(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=l.read(arguments),e=l.read(arguments);return new l(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new l(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},e.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new l(e(this.x),e(this.y))}},{})),h=l.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)}}),u=e.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;this.width=t,this.height=n?e:t,this.__read&&(this.__read=n?2:1)}else"undefined"===i||null===t?(this.width=this.height=0,this.__read&&(this.__read=null===t?1:0)):(Array.isArray(t)?(this.width=t[0],this.height=t.length>1?t[1]:t[0]):null!=t.width?(this.width=t.width,this.height=t.height):null!=t.x?(this.width=t.x,this.height=t.y):(this.width=this.height=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new u(this.width,this.height)},toString:function(){var t=o.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=u.read(arguments);return new u(this.width+t.width,this.height+t.height)},subtract:function(){var t=u.read(arguments);return new u(this.width-t.width,this.height-t.height)},multiply:function(){var t=u.read(arguments);return new u(this.width*t.width,this.height*t.height)},divide:function(){var t=u.read(arguments);return new u(this.width/t.width,this.height/t.height)},modulo:function(){var t=u.read(arguments);return new u(this.width%t.width,this.height%t.height)},negate:function(){return new u(-this.width,-this.height)},isZero:function(){return s.isZero(this.width)&&s.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new u(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new u(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new u(Math.random(),Math.random())}}},e.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new u(e(this.width),e(this.height))}},{})),c=u.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),d=e.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(i,n,r,o){var s=typeof i,a=0;if("number"===s?(this.x=i,this.y=n,this.width=r,this.height=o,a=4):"undefined"===s||null===i?(this.x=this.y=this.width=this.height=0,a=null===i?1:0):1===arguments.length&&(Array.isArray(i)?(this.x=i[0],this.y=i[1],this.width=i[2],this.height=i[3],a=1):i.x!==t||i.width!==t?(this.x=i.x||0,this.y=i.y||0,this.width=i.width||0,this.height=i.height||0,a=1):i.from===t&&i.to===t&&(this.x=this.y=this.width=this.height=0,this._set(i),a=1)),!a){var h=l.readNamed(arguments,"from"),c=e.peek(arguments);if(this.x=h.x,this.y=h.y,c&&c.x!==t||e.hasNamed(arguments,"to")){var d=l.readNamed(arguments,"to");this.width=d.x-h.x,this.height=d.y-h.y,this.width<0&&(this.x=d.x,this.width=-this.width),this.height<0&&(this.y=d.y,this.height=-this.height)}else{var f=u.read(arguments);this.width=f.width,this.height=f.height}a=arguments.__index}this.__read&&(this.__read=a)},set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new d(this.x,this.y,this.width,this.height)},equals:function(t){var i=e.isPlainValue(t)?d.read(arguments):t;return i===this||i&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height||!1},toString:function(){var t=o.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?l:h)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=l.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?u:c)(this.width,this.height,this,"setSize")},setSize:function(){var t=u.read(arguments);this._fixX&&(this.x+=(this.width-t.width)*this._fixX),this._fixY&&(this.y+=(this.height-t.height)*this._fixY),this.width=t.width,this.height=t.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(t){this._fixW||(this.width-=t-this.x),this.x=t,this._fixX=0},getTop:function(){return this.y},setTop:function(t){this._fixH||(this.height-=t-this.y),this.y=t,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(e){this._fixX!==t&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=e-this.width:this.width=e-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(e){this._fixY!==t&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=e-this.height:this.height=e-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(t){this.x=t-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(t){this.y=t-.5*this.height,this._fixY=.5},getCenter:function(t){return new(t?l:h)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=l.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(e){return e&&e.width!==t||4==(Array.isArray(e)?e:arguments).length?this._containsRectangle(d.read(arguments)):this._containsPoint(l.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=d.read(arguments);return t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height},touches:function(){var t=d.read(arguments);return t.x+t.width>=this.x&&t.y+t.height>=this.y&&t.x<=this.x+this.width&&t.y<=this.y+this.height},intersect:function(){var t=d.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new d(e,i,n-e,r-i)},unite:function(){var t=d.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new d(e,i,n-e,r-i)},include:function(){var t=l.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new d(e,i,n-e,r-i)},expand:function(){var t=u.read(arguments),e=t.width,i=t.height;return new d(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(e,i){return this.expand(this.width*e-this.width,this.height*(i===t?e:i)-this.height)}},e.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],o=t[n?1:0],s="get"+r,a="get"+o,u="set"+r,c="set"+o,d="get"+i,f="set"+i;this[d]=function(t){return new(t?l:h)(this[s](),this[a](),this,f)},this[f]=function(){var t=l.read(arguments);this[u](t.x),this[c](t.y)}},{beans:!0})),f=d.extend({initialize:function(t,e,i,n,r,o){this.set(t,e,i,n,!0),this._owner=r,this._setter=o},set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=d.prototype;return e.each(["x","y","width","height"],function(t){var i=e.capitalize(t),n="_"+t;this["get"+i]=function(){return this[n]},this["set"+i]=function(t){this[n]=t,this._dontNotify||this._owner[this._setter](this)}},e.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(t){var e=this._owner;e.setSelected&&(e._boundsSelected=t,e.setSelected(t||e._selectedSegmentState>0))}}))}),p=e.extend({_class:"Matrix",initialize:function t(e){var i=arguments.length,n=!0;if(6===i?this.set.apply(this,arguments):1===i?e instanceof t?this.set(e._a,e._c,e._b,e._d,e._tx,e._ty):Array.isArray(e)?this.set.apply(this,e):n=!1:0===i?this.reset():n=!1,!n)throw new Error("Unsupported matrix parameters")},set:function(t,e,i,n,r,o,s){return this._a=t,this._c=e,this._b=i,this._d=n,this._tx=r,this._ty=o,s||this._changed(),this},_serialize:function(t){return e.serialize(this.getValues(),t)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new p(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty||!1},toString:function(){var t=o.instance
;return"[["+[t.number(this._a),t.number(this._b),t.number(this._tx)].join(", ")+"], ["+[t.number(this._c),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,i){var n=this._owner;return!!n&&(n.transform(null,!0,e.pick(t,!0),i),this.isIdentity())},translate:function(){var t=l.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._b,this._ty+=e*this._c+i*this._d,this._changed(),this},scale:function(){var t=l.read(arguments),e=l.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._c*=t.x,this._b*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=l.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),o=Math.sin(t),s=i-i*r+n*o,a=n-i*o-n*r,h=this._a,u=this._b,c=this._c,d=this._d;return this._a=r*h+o*u,this._b=-o*h+r*u,this._c=r*c+o*d,this._d=-o*c+r*d,this._tx+=s*h+a*u,this._ty+=s*c+a*d,this._changed(),this},shear:function(){var t=l.read(arguments),e=l.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._c;return this._a+=t.y*this._b,this._c+=t.y*this._d,this._b+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=l.read(arguments),e=l.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new l(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},concatenate:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,o=t._a,s=t._b,a=t._c,l=t._d,h=t._tx,u=t._ty;return this._a=o*e+a*i,this._b=s*e+l*i,this._c=o*n+a*r,this._d=s*n+l*r,this._tx+=h*e+u*i,this._ty+=h*n+u*r,this._changed(),this},preConcatenate:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,o=this._tx,s=this._ty,a=t._a,l=t._b,h=t._c,u=t._d,c=t._tx,d=t._ty;return this._a=a*e+l*n,this._b=a*i+l*r,this._c=h*e+u*n,this._d=h*i+u*r,this._tx=a*o+l*s+c,this._ty=h*o+u*s+d,this._changed(),this},chain:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,o=this._tx,s=this._ty,a=t._a,l=t._b,h=t._c,u=t._d,c=t._tx,d=t._ty;return new p(a*e+h*i,a*n+h*r,l*e+u*i,l*n+u*r,o+c*e+d*i,s+c*n+d*r)},isIdentity:function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(l.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new l),e.set(n*this._a+r*this._b+this._tx,n*this._c+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=0,o=2*i;n<o;){var s=t[n++],a=t[n++];e[r++]=s*this._a+a*this._b+this._tx,e[r++]=s*this._c+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,o=[e,i,n,i,n,r,e,r];return this._transformCoordinates(o,o,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),o=r.slice(),s=2;s<8;s++){var a=n[s],l=1&s;a<r[l]?r[l]=a:a>o[l]&&(o[l]=a)}return e||(e=new d),e.set(r[0],r[1],o[0]-r[0],o[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(l.read(arguments))},_getDeterminant:function(){var t=this._a*this._d-this._b*this._c;return isFinite(t)&&!s.isZero(t)&&isFinite(this._tx)&&isFinite(this._ty)?t:null},_inverseTransform:function(t,e,i){var n=this._getDeterminant();if(!n)return null;var r=t.x-this._tx,o=t.y-this._ty;return e||(e=new l),e.set((r*this._d-o*this._b)/n,(o*this._a-r*this._c)/n,i)},decompose:function(){var t=this._a,e=this._b,i=this._c,n=this._d;if(s.isZero(t*n-e*i))return null;var r=Math.sqrt(t*t+e*e);t/=r,e/=r;var o=t*i+e*n;i-=t*o,n-=e*o;var a=Math.sqrt(i*i+n*n);return i/=a,n/=a,o/=a,t*n<e*i&&(t=-t,e=-e,o=-o,r=-r),{scaling:new l(r,a),rotation:180*-Math.atan2(e,t)/Math.PI,shearing:o}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new l(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var t=this._getDeterminant();return t&&new p(this._d/t,-this._c/t,-this._b/t,this._a/t,(this._b*this._ty-this._d*this._tx)/t,(this._c*this._tx-this._a*this._ty)/t)},shiftless:function(){return new p(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(t){t.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},e.each(["a","c","b","d","tx","ty"],function(t){var i=e.capitalize(t),n="_"+t;this["get"+i]=function(){return this[n]},this["set"+i]=function(t){this[n]=t,this._changed()}},{})),g=e.extend({_class:"Line",initialize:function(t,e,i,n,r){var o=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,o=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,o=i),o||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new l(this._px,this._py)},getVector:function(){return new l(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return g.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return g.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(g.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0))},isCollinear:function(t){return l.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return l.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,o,a,h,u,c){u||(i-=t,n-=e,a-=r,h-=o);var d=i*h-n*a;if(!s.isZero(d)){var f=t-r,p=e-o,g=(a*p-h*f)/d,m=(i*p-n*f)/d,v=1e-12,y=-v,w=1+v;if(c||y<g&&g<w&&y<m&&m<w)return c||(g=g<=0?0:g>=1?1:g),new l(t+g*i,e+g*n)}},getSide:function(t,e,i,n,r,o,s,a){s||(i-=t,n-=e);var l=r-t,h=o-e,u=l*n-h*i;return 0!==u||a||(u=(l*i+l*i)/(i*i+n*n))>=0&&u<=1&&(u=0),u<0?-1:u>0?1:0},getSignedDistance:function(t,e,i,n,r,o,s){return s||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?o-e:e-o:((r-t)*n-(o-e)*i)/Math.sqrt(i*i+n*n)}}}),m=r.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function(t){r.call(this,!0),this.layers=[],this._activeLayer=null,this.symbols=[],this._currentStyle=new B(null,null,this),this._view=j.create(this,t||Y.getCanvas(1,1)),this._selectedItems={},this._selectedItemCount=0,this._updateVersion=0},_serialize:function(t,i){return e.serialize(this.layers,t,!0,i)},clear:function(){for(var t=this.layers.length-1;t>=0;t--)this.layers[t].remove();this.symbols=[]},isEmpty:function(){return 0===this.layers.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.initialize(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getActiveLayer:function(){return this._activeLayer||new _({project:this})},getSelectedItems:function(){var t=[];for(var e in this._selectedItems){var i=this._selectedItems[e];i.isInserted()&&t.push(i)}return t},insertChild:function(t,i,n){return i instanceof _?(i._remove(!1,!0),e.splice(this.layers,[i],t,0),i._setProject(this,!0),this._changes&&i._changed(5),this._activeLayer||(this._activeLayer=i)):i instanceof y?(this._activeLayer||this.insertChild(t,new _(y.NO_INSERT))).insertChild(t,i,n):i=null,i},addChild:function(e,i){return this.insertChild(t,e,i)},_updateSelection:function(t){var e=t._id,i=this._selectedItems;t._selected?i[e]!==t&&(this._selectedItemCount++,i[e]=t):i[e]===t&&(this._selectedItemCount--,delete i[e])},selectAll:function(){for(var t=this.layers,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectedItems;for(var e in t)t[e].setFullySelected(!1)},hitTest:function(){for(var t=l.read(arguments),i=T.getOptions(e.read(arguments)),n=this.layers.length-1;n>=0;n--){var r=this.layers[n]._hitTest(t,i);if(r)return r}return null},getItems:function(t){return y._getItems(this.layers,t)},getItem:function(t){return y._getItems(this.layers,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var i=this._activeLayer;return e.importJSON(t,i&&i.isEmpty()&&i)},draw:function(t,i,n){this._updateVersion++,t.save(),i.applyToContext(t);for(var r=new e({offset:new l(0,0),pixelRatio:n,viewMatrix:i.isIdentity()?null:i,matrices:[new p],updateMatrix:!0}),o=0,s=this.layers,a=s.length;o<a;o++)s[o].draw(t,r);if(t.restore(),this._selectedItemCount>0){t.save(),t.strokeWidth=1;var h=this._selectedItems,u=this._scope.settings.handleSize,c=this._updateVersion;for(var d in h)h[d]._drawSelection(t,i,u,h,c);t.restore()}}}),v=e.extend({_class:"Symbol",initialize:function(t,e){this._id=a.get(),this.project=paper.project,this.project.symbols.push(this),t&&this.setDefinition(t,e)},_serialize:function(t,i){return i.add(this,function(){return e.serialize([this._class,this._definition],t,!1,i)})},_changed:function(t){8&t&&y._clearBoundsCache(this),1&t&&(this.project._needsUpdate=!0)},getDefinition:function(){return this._definition},setDefinition:function(t,e){t._parentSymbol&&(t=t.clone()),this._definition&&(this._definition._parentSymbol=null),this._definition=t,t.remove(),t.setSelected(!1),e||t.setPosition(new l),t._parentSymbol=this,this._changed(9)},place:function(t){return new S(this,t)},clone:function(){return new v(this._definition.clone(!1))},equals:function(t){return t===this||t&&this.definition.equals(t.definition)||!1}}),y=e.extend(i,{statics:{extend:function t(i){return i._serializeFields&&(i._serializeFields=new e(this.prototype._serializeFields,i._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_applyMatrix:!0,_canApplyMatrix:!0,_boundsSelected:!1,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new p,pivot:null,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,selected:!1,clipMask:!1,data:{}},initialize:function(){},_initialize:function(t,i){var n=t&&e.isPlainObject(t),r=n&&!0===t.internal,o=this._matrix=new p,s=n&&t.project||paper.project;return r||(this._id=a.get()),this._applyMatrix=this._canApplyMatrix&&paper.settings.applyMatrix,i&&o.translate(i),o._owner=this,this._style=new B(s._currentStyle,this,s),this._project||(r||n&&!1===t.insert?this._setProject(s):n&&t.parent?this.setParent(t.parent):(s._activeLayer||new _).addChild(this)),n&&t!==y.NO_INSERT&&this._set(t,{insert:!0,project:!0,parent:!0},!0),n},_events:e.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(t){this[t]={install:function(t){this.getView()._installEvent(t)},uninstall:function(t){this.getView()._uninstallEvent(t)}}},{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{}}),_serialize:function(t,i){function n(n){for(var s in n){var a=o[s];e.equals(a,"leading"===s?1.2*n.fontSize:n[s])||(r[s]=e.serialize(a,t,"data"!==s,i))}}var r={},o=this;return n(this._serializeFields),this instanceof w||n(this._style._defaults),[this._class,r]},_changed:function(e){var i=this._parentSymbol,n=this._parent||i,r=this._project;if(8&e&&(this._bounds=this._position=this._decomposed=this._globalMatrix=this._currentPath=t),n&&40&e&&y._clearBoundsCache(n),2&e&&y._clearBoundsCache(this),r&&(1&e&&(r._needsUpdate=!0),r._changes)){var o=r._changesById[this._id];o?o.flags|=e:(o={item:this,flags:e},r._changesById[this._id]=o,r._changes.push(o))}i&&i._changed(e)},set:function(t){return t&&this._set(t),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(e,i){if(this._name&&this._removeNamed(),e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var n=this._parent;if(e&&n){for(var r=n._children,o=n._namedChildren,s=e,a=1;i&&r[e];)e=s+" "+a++;(o[e]=o[e]||[]).push(this),r[e]=this}this._name=e||t,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},e.each(["locked","visible","blendMode","opacity","guide"],function(t){var i=e.capitalize(t),t="_"+t;this["get"+i]=function(){return this[t]},this["set"+i]=function(e){e!=this[t]&&(this[t]=e,this._changed("_locked"===t?128:129))}},{}),{beans:!0,_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return this._selected},setSelected:function(t,e){if(!e&&this._selectChildren)for(var i=this._children,n=0,r=i.length;n<r;n++)i[n].setSelected(t);(t=!!t)^this._selected&&(this._selected=t,this._project._updateSelection(this),this._changed(129))},_selected:!1,isFullySelected:function(){var t=this._children;if(t&&this._selected){for(var e=0,i=t.length;e<i;e++)if(!t[e].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this.setSelected(t,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},_clipMask:!1,getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?l:h;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(l.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(t){var e=this._pivot;if(e){e=new(t?l:h)(e.x,e.y,this,"setPivot")}return e},setPivot:function(){this._pivot=l.read(arguments,0,{clone:!0,readNull:!0}),this._position=t},_pivot:null},e.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],function(t){var i="get"+e.capitalize(t),n=t.match(/^internal(.*)$/),r=n?"get"+n[1]:null;this[i]=function(e){var n=this._boundsGetter,o=!r&&("string"==typeof n?n:n&&n[i])||i,s=this._getCachedBounds(o,e,this,r);return"bounds"===t?new f(s.x,s.y,s.width,s.height,this,"setBounds"):s}},{beans:!0,_getBounds:function(t,e,i){var n=this._children;if(!n||0==n.length)return new d;y._updateBoundsCache(this,i);for(var r=Infinity,o=-r,s=r,a=o,l=0,h=n.length;l<h;l++){var u=n[l];if(u._visible&&!u.isEmpty()){var c=u._getCachedBounds(t,e&&e.chain(u._matrix),i);r=Math.min(c.x,r),s=Math.min(c.y,s),o=Math.max(c.x+c.width,o),a=Math.max(c.y+c.height,a)}}return isFinite(r)?new d(r,s,o-r,a-s):new d},setBounds:function(){var t=d.read(arguments),e=this.getBounds(),i=new p,n=t.getCenter();i.translate(n),t.width==e.width&&t.height==e.height||i.scale(0!=e.width?t.width/e.width:1,0!=e.height?t.height/e.height:1),n=e.getCenter(),i.translate(-n.x,-n.y),this.transform(i)},_getCachedBounds:function(t,e,i,n){e=e&&e.orNullIfIdentity();var r=n?null:this._matrix.orNullIfIdentity(),o=(!e||e.equals(r))&&t;if(y._updateBoundsCache(this._parent||this._parentSymbol,i),o&&this._bounds&&this._bounds[o])return this._bounds[o].clone();var s=this._getBounds(n||t,e||r,i);if(o){this._bounds||(this._bounds={});(this._bounds[o]=s.clone())._internal=!!n}return s},statics:{_updateBoundsCache:function(t,e){if(t){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(e){var i=e._boundsCache;if(i){e._bounds=e._position=e._boundsCache=t;for(var n=0,r=i.list,o=r.length;n<o;n++){var s=r[n];s!==e&&(s._bounds=s._position=t,s._boundsCache&&y._clearBoundsCache(s))}}}}}),{beans:!0,_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var t=this._decomposed||this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i.rotation=t,this._decomposed=i}},getScaling:function(t){var e=this._decomposed||this._decompose(),i=e&&e.scaling,n=t?l:h;return i&&new n(i.x,i.y,this,"setScaling")},setScaling:function(){var t=this.getScaling();if(t){var e=l.read(arguments,0,{clone:!0}),i=this._decomposed;this.scale(e.x/t.x,e.y/t.y),i.scaling=e,this._decomposed=i}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments),this._applyMatrix?this.transform(null,!0):this._changed(9)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;n&&e.preConcatenate(n.getGlobalMatrix(!0)),e._updateVersion=i}return t?e:e.clone()},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project.getView()},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof _)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return e.equals(this._children,t._children)},clone:function(t){return this._clone(new this.constructor(y.NO_INSERT),t)},_clone:function(i,n,r){var o=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],s=this._children;i.setStyle(this._style);for(var a=0,l=s&&s.length;a<l;a++)i.addChild(s[a].clone(!1),!0);for(var a=0,l=o.length;a<l;a++){var h=o[a];this.hasOwnProperty(h)&&(i[h]=this[h])}return!1!==r&&i._matrix.initialize(this._matrix),i.setApplyMatrix(this._applyMatrix),i.setPivot(this._pivot),i.setSelected(this._selected),i._data=this._data?e.clone(this._data):null,(n||n===t)&&i.insertAbove(this),this._name&&i.setName(this._name,!0),i},copyTo:function(t){return t.addChild(this.clone(!1))},rasterize:function(t){var i=this.getStrokeBounds(),n=(t||this.getView().getResolution())/72,r=i.getTopLeft().floor(),o=i.getBottomRight().ceil(),s=new u(o.subtract(r)),a=Y.getCanvas(s.multiply(n)),l=a.getContext("2d"),h=(new p).scale(n).translate(r.negate());l.save(),h.applyToContext(l),this.draw(l,new e({matrices:[h]})),l.restore();var c=new b(y.NO_INSERT);return c.setCanvas(a),c.transform((new p).translate(r.add(s.divide(2))).scale(1/n)),c.insertAbove(this),c},contains:function(){return!!this._contains(this._matrix._inverseTransform(l.read(arguments)))},_contains:function(t){if(this._children){for(var e=this._children.length-1;e>=0;e--)if(this._children[e].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return d.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new M.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof y&&this._asPathItem().getIntersections(t._asPathItem(),null,e||t._matrix,!0).length>0},hitTest:function(){return this._hitTest(l.read(arguments),T.getOptions(e.read(arguments)))},_hitTest:function(t,i){function n(i,n){var r=f["get"+n]();if(t.subtract(r).divide(l).length<=1)return new T(i,d,{name:e.hyphenate(n),point:r})}if(this._locked||!this._visible||this._guide&&!i.guides||this.isEmpty())return null;var r=this._matrix,o=i._totalMatrix,s=this.getView(),a=i._totalMatrix=o?o.chain(r):this.getGlobalMatrix().preConcatenate(s._matrix),l=i._tolerancePadding=new u(M._getPenPadding(1,a.inverted())).multiply(Math.max(i.tolerance,1e-6));if(t=r._inverseTransform(t),!this._children&&!this.getInternalRoughBounds().expand(l.multiply(2))._containsPoint(t))return null;var h,c=!(i.guides&&!this._guide||i.selected&&!this._selected||i.type&&i.type!==e.hyphenate(this._class)||i["class"]&&!(this instanceof i["class"])),d=this;if(c&&(i.center||i.bounds)&&this._parent){var f=this.getInternalBounds();if(i.center&&(h=n("center","Center")),!h&&i.bounds)for(var p=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],g=0;g<8&&!h;g++)h=n("bounds",p[g])}var m=!h&&this._children;if(m)for(var v=this._getChildHitTestOptions(i),g=m.length-1;g>=0&&!h;g--)h=m[g]._hitTest(t,v);return!h&&c&&(h=this._hitTestSelf(t,i)),h&&h.point&&(h.point=r.transform(h.point)),i._totalMatrix=o,h},_getChildHitTestOptions:function(t){return t},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new T("fill",this)},matches:function(t,i){function n(t,i){for(var r in t)if(t.hasOwnProperty(r)){var o=t[r],s=i[r];if(e.isPlainObject(o)&&e.isPlainObject(s)){if(!n(o,s))return!1}else if(!e.equals(o,s))return!1}return!0}var r=typeof t;if("object"===r){for(var o in t)if(t.hasOwnProperty(o)&&!this.matches(o,t[o]))return!1}else{if("function"===r)return t(this);var s=/^(empty|editable)$/.test(t)?this["is"+e.capitalize(t)]():"type"===t?e.hyphenate(this._class):this[t];if(/^(constructor|class)$/.test(t)){if(!(this instanceof i))return!1}else if(i instanceof RegExp){if(!i.test(s))return!1}else if("function"==typeof i){if(!i(s))return!1}else if(e.isPlainObject(i)){if(!n(i,s))return!1}else if(!e.equals(s,i))return!1}return!0},getItems:function(t){return y._getItems(this._children,t,this._matrix)},getItem:function(t){return y._getItems(this._children,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(i,n,r,o,s){if(!o&&"object"==typeof n){var a=n.overlapping,l=n.inside,h=a||l,u=h&&d.read([h]);o={items:[],inside:!!l,overlapping:!!a,rect:u,path:a&&new M.Rectangle({rectangle:u,insert:!1})},h&&(n=e.set({},n,{inside:!0,overlapping:!0}))}var c=o&&o.items,u=o&&o.rect;r=u&&(r||new p);for(var f=0,g=i&&i.length;f<g;f++){var m=i[f],v=r&&r.chain(m._matrix),y=!0;if(u){var h=m.getBounds(v);if(!u.intersects(h))continue;o.inside&&u.contains(h)||o.overlapping&&(h.contains(u)||o.path.intersects(m,v))||(y=!1)}if(y&&m.matches(n)&&(c.push(m),s))break;if(t(m._children,n,v,o,s),s&&c.length>0)break}return c}}},{importJSON:function(t){var i=e.importJSON(t,this);return i!==this?this.addChild(i):i},addChild:function(e,i){return this.insertChild(t,e,i)},insertChild:function(t,e,i){var n=e?this.insertChildren(t,[e],i):null;return n&&n[0]},addChildren:function(t,e){return this.insertChildren(this._children.length,t,e)},insertChildren:function(t,i,n,r){var o=this._children;if(o&&i&&i.length>0){i=Array.prototype.slice.apply(i);for(var s=i.length-1;s>=0;s--){var a=i[s];if(!r||a instanceof r){var l=a._parent===this&&a._index<t;a._remove(!1,!0)&&l&&t--}else i.splice(s,1)}e.splice(o,i,t,0);for(var h=this._project,u=h&&h._changes,s=0,c=i.length;s<c;s++){var a=i[s];a._parent=this,a._setProject(this._project,!0),a._name&&a.setName(a._name),u&&this._changed(5)}this._changed(11)}else i=null;return i},_insertSibling:function(t,e,i){return this._parent?this._parent.insertChild(t,e,i):null},insertAbove:function(t,e){return t._insertSibling(t._index+1,this,e)},insertBelow:function(t,e){return t._insertSibling(t._index,this,e)},sendToBack:function(){return(this._parent||this instanceof _&&this._project).insertChild(0,this)},bringToFront:function(){return(this._parent||this instanceof _&&this._project).addChild(this)},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&1===this._children.length){var t=this._children[0].reduce();return t.insertAbove(this),t.setStyle(this._style),this.remove(),t}return this},_removeNamed:function(){var t=this._parent;if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],o=r?r.indexOf(this):-1;-1!==o&&(e[n]==this&&delete e[n],r.splice(o,1),r.length?e[n]=r[r.length-1]:delete i[n])}},_remove:function(t,i){var n=this._parent;if(n){if(this._name&&this._removeNamed(),null!=this._index&&e.splice(n._children,null,this._index,1),this._installEvents(!1),t){var r=this._project;r&&r._changes&&this._changed(5)}return i&&n._changed(11),this._parent=null,!0}return!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,i){if(!this._children)return null;t=t||0,i=e.pick(i,this._children.length);for(var n=e.splice(this._children,null,t,i-t),r=n.length-1;r>=0;r--)n[r]._remove(!0,!1);return n.length>0&&this._changed(11),n},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){return!this._children||0===this._children.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,o=Math.min(i.length,n.length);r<o;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e==t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1},translate:function(){var t=new p;return this.transform(t.translate.apply(t,arguments))},rotate:function(t){return this.transform((new p).rotate(t,l.read(arguments,1,{readNull:!0})||this.getPosition(!0)))}},e.each(["scale","shear","skew"],function(t){this[t]=function(){var e=l.read(arguments),i=l.read(arguments,0,{readNull:!0});return this.transform((new p)[t](e,i||this.getPosition(!0)))}},{}),{transform:function(t,e,i,n){t&&t.isIdentity()&&(t=null);var r=this._matrix,o=(e||this._applyMatrix)&&(!r.isIdentity()||t||e&&i&&this._children);if(!t&&!o)return this;if(t&&r.preConcatenate(t),o=o&&this._transformContent(r,i,n)){var s=this._pivot,a=this._style,l=a.getFillColor(!0),h=a.getStrokeColor(!0);s&&r._transformPoint(s,s,!0),l&&l.transform(r),h&&h.transform(r),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var u=this._bounds,c=this._position;this._changed(9);var d=u&&t&&t.decompose();if(d&&!d.shearing&&d.rotation%90==0){for(var f in u){var p=u[f];!o&&p._internal||t._transformBounds(p,p)}var g=this._boundsGetter,p=u[g&&g.getBounds||g||"getBounds"];p&&(this._position=p.getCenter(!0)),this._bounds=u}else t&&c&&(this._position=t._transformPoint(c,c));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,o=n.length;r<o;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(l.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(l.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(l.read(arguments))},localToParent:function(){return this._matrix._transformPoint(l.read(arguments))},fitBounds:function(t,e){t=d.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,o=(e?n>r:n<r)?t.width/i.width:t.height/i.height,s=new d(new l,new u(i.width*o,i.height*o));s.setCenter(t.getCenter()),this.setBounds(s)},_setStyles:function(t){var e=this._style,i=e.getFillColor(),n=e.getStrokeColor(),r=e.getShadowColor();if(i&&(t.fillStyle=i.toCanvasStyle(t)),n){var o=e.getStrokeWidth();if(o>0){t.strokeStyle=n.toCanvasStyle(t),t.lineWidth=o;var s=e.getStrokeJoin(),a=e.getStrokeCap(),l=e.getMiterLimit();if(s&&(t.lineJoin=s),a&&(t.lineCap=a),l&&(t.miterLimit=l),paper.support.nativeDash){var h=e.getDashArray(),u=e.getDashOffset();h&&h.length&&("setLineDash"in t?(t.setLineDash(h),t.lineDashOffset=u):(t.mozDash=h,t.mozDashOffset=u))}}}if(r){var c=e.getShadowBlur();if(c>0){t.shadowColor=r.toCanvasStyle(t),t.shadowBlur=c;var d=this.getShadowOffset();t.shadowOffsetX=d.x,t.shadowOffsetY=d.y}}},draw:function(t,e,i){function n(t){return s?s.chain(t):t}var r=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var o=e.matrices,s=e.viewMatrix,a=this._matrix,l=o[o.length-1].chain(a);if(l.isInvertible()){o.push(l),e.updateMatrix&&(l._updateVersion=r,this._globalMatrix=l);var h,u,c,d=this._blendMode,f=this._opacity,p="normal"===d,g=K.nativeModes[d],m=p&&1===f||e.dontStart||e.clip||(g||p&&f<1)&&this._canComposite(),v=e.pixelRatio||1;if(!m){var y=this.getStrokeBounds(n(l));if(!y.width||!y.height)return;c=e.offset,u=e.offset=y.getTopLeft().floor(),h=t,t=Y.getContext(y.getSize().ceil().add(1).multiply(v)),1!==v&&t.scale(v,v)}t.save();var w=i?i.chain(a):!this.getStrokeScaling(!0)&&n(l),_=!m&&e.clipItem,x=!w||_;if(m?(t.globalAlpha=f,g&&(t.globalCompositeOperation=d)):x&&t.translate(-u.x,-u.y),x&&(m?a:n(l)).applyToContext(t),_&&e.clipItem.draw(t,e.extend({clip:!0})),w){t.setTransform(v,0,0,v,0,0);var b=e.offset;b&&t.translate(-b.x,-b.y)}this._draw(t,e,w),t.restore(),o.pop(),e.clip&&!e.dontFinish&&t.clip(),m||(K.process(d,t,h,f,u.subtract(c).multiply(v)),Y.release(t),e.offset=c)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof R)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){if((this._drawSelected||this._boundsSelected)&&this._isUpdated(r)){var o=this.getSelectedColor(!0)||this.getLayer().getSelectedColor(!0),s=e.chain(this.getGlobalMatrix(!0));if(t.strokeStyle=t.fillStyle=o?o.toCanvasStyle(t):"#009dec",this._drawSelected&&this._drawSelected(t,s,n),this._boundsSelected){var a=i/2,l=s._transformCorners(this.getInternalBounds());t.beginPath();for(var h=0;h<8;h++)t[0===h?"moveTo":"lineTo"](l[h],l[++h]);t.closePath(),t.stroke();for(var h=0;h<8;h++)t.fillRect(l[h]-a,l[++h]-a,i,i)}}},_canComposite:function(){return!1}},e.each(["down","drag","up","move"],function(t){this["removeOn"+e.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),w=y.extend({_class:"Group",_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function e(i){e.base.call(this,i),1026&i&&(this._clipItem=t)},_getClipItem:function(){var e=this._clipItem;if(e===t){e=null;for(var i=0,n=this._children.length;i<n;i++){var r=this._children[i];if(r._clipMask){e=r;break}}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem(),r=!0;if(e=e.extend({clipItem:n,clip:!1}),i?this._currentPath?(t.currentPath=this._currentPath,r=!1):(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0})),r)for(var o=0,s=this._children.length;o<s;o++){var a=this._children[o];a!==n&&a.draw(t,e)}i&&(this._currentPath=t.currentPath)}
}),_=w.extend({_class:"Layer",initialize:function(i){var n=e.isPlainObject(i)?new e(i):{children:Array.isArray(i)?i:arguments},r=n.insert;n.insert=!1,w.call(this,n),(r||r===t)&&(this._project.addChild(this),this.activate())},_remove:function t(i,n){if(this._parent)return t.base.call(this,i,n);if(null!=this._index){var r=this._project;return r._activeLayer===this&&(r._activeLayer=this.getNextSibling()||this.getPreviousSibling()),e.splice(r.layers,null,this._index,1),this._installEvents(!1),i&&r._changes&&this._changed(5),n&&(r._needsUpdate=!0),!0}return!1},getNextSibling:function t(){return this._parent?t.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function t(){return this._parent?t.base.call(this):this._project.layers[this._index-1]||null},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_insertSibling:function t(e,i,n){return this._parent?t.base.call(this,e,i,n):this._project.insertChild(e,i,n)}}),x=y.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_boundsSelected:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t){this._initialize(t)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&e.equals(this._radius,t._radius)},clone:function(t){var e=new x(y.NO_INSERT);return e.setType(this._type),e.setSize(this._size),e.setRadius(this._radius),this._clone(e,t)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new c(t.width,t.height,this,"setSize")},setSize:function(){var t=u.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;if("rectangle"===e){var r=u.min(this._radius,t.divide(2));this._radius.set(r.width,r.height)}else"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius.set(i/2,n/2);this._size.set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new c(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size.set(i,i)}else if(t=u.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t.width,t.height),"rectangle"===e){var i=u.max(this._size,t.multiply(2));this._size.set(i.width,i.height)}else"ellipse"===e&&this._size.set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=this._clone(new(M[e.capitalize(this._type)])({center:new l,size:this._size,radius:this._radius,insert:!1}),t);return paper.settings.applyMatrix&&i.setApplyMatrix(!0),i},_draw:function(t,e,i){var n=this._style,r=n.hasFill(),o=n.hasStroke(),s=e.dontFinish||e.clip,a=!i;if(r||o||s){var l=this._type,h=this._radius,u="circle"===l;if(e.dontStart||t.beginPath(),a&&u)t.arc(0,0,h,0,2*Math.PI,!0);else{var c=u?h:h.width,d=u?h:h.height,f=this._size,p=f.width,g=f.height;if(a&&"rectangle"===l&&0===c&&0===d)t.rect(-p/2,-g/2,p,g);else{var m=p/2,v=g/2,y=.44771525016920644,w=c*y,_=d*y,x=[-m,-v+d,-m,-v+_,-m+w,-v,-m+c,-v,m-c,-v,m-w,-v,m,-v+_,m,-v+d,m,v-d,m,v-_,m-w,v,m-c,v,-m+c,v,-m+w,v,-m,v-_,-m,v-d];i&&i.transform(x,x,32),t.moveTo(x[0],x[1]),t.bezierCurveTo(x[2],x[3],x[4],x[5],x[6],x[7]),m!==c&&t.lineTo(x[8],x[9]),t.bezierCurveTo(x[10],x[11],x[12],x[13],x[14],x[15]),v!==d&&t.lineTo(x[16],x[17]),t.bezierCurveTo(x[18],x[19],x[20],x[21],x[22],x[23]),m!==c&&t.lineTo(x[24],x[25]),t.bezierCurveTo(x[26],x[27],x[28],x[29],x[30],x[31])}}t.closePath()}s||!r&&!o||(this._setStyles(t),r&&(t.fill(n.getWindingRule()),t.shadowColor="rgba(0,0,0,0)"),o&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new d(this._size).setCenter(0,0);return"getBounds"!==t&&this.hasStroke()&&(i=i.expand(this.getStrokeWidth())),e?e._transformBounds(i):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),o=0;o<4;o++){var s=new l(1&o?1:-1,o>1?1:-1),a=s.multiply(r),h=a.subtract(s.multiply(n)),u=new d(a,h);if((i?u.expand(i):u).contains(e))return h}}function e(t,e){var i=t.getAngleInRadians(),n=2*e.width,r=2*e.height,o=n*Math.sin(i),s=r*Math.cos(i);return n*r/(2*Math.sqrt(o*o+s*s))}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r){var o=!1;if(this.hasStroke()){var s=this._type,a=this._radius,l=this.getStrokeWidth()+2*r.tolerance;if("rectangle"===s){var h=t(this,n,l);if(h){var u=n.subtract(h);o=2*Math.abs(u.getLength()-e(u,a))<=l}else{var c=new d(this._size).setCenter(0,0),f=c.expand(l),p=c.expand(-l);o=f._containsPoint(n)&&!p._containsPoint(n)}}else"ellipse"===s&&(a=e(n,a)),o=2*Math.abs(n.getLength()-a)<=l}return o?new T("stroke",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,i,n,r,o){var s=new x(e.getNamed(o));return s._type=t,s._size=n,s._radius=r,s.translate(i)}return{Circle:function(){var i=l.readNamed(arguments,"center"),n=e.readNamed(arguments,"radius");return t("circle",i,new u(2*n),n,arguments)},Rectangle:function(){var e=d.readNamed(arguments,"rectangle"),i=u.min(u.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=x._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var i,n;if(e.hasNamed(t,"radius"))i=l.readNamed(t,"center"),n=u.readNamed(t,"radius");else{var r=d.readNamed(t,"rectangle");i=r.getCenter(!0),n=r.getSize(!0).divide(2)}return{center:i,radius:n}}}}}),b=y.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{crossOrigin:null,source:null},initialize:function(e,i){this._initialize(e,i!==t&&l.read(arguments,1))||("string"==typeof e?this.setSource(e):this.setImage(e)),this._size||(this._size=new u,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},clone:function(t){var e=new b(y.NO_INSERT),i=this._image,n=this._canvas;if(i)e.setImage(i);else if(n){var r=Y.getCanvas(this._size);r.getContext("2d").drawImage(n,0,0),e.setImage(r)}return e._crossOrigin=this._crossOrigin,this._clone(e,t)},getSize:function(){var t=this._size;return new c(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=u.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this.setImage(Y.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&Y.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new l(0,0).transform(t),i=new l(1,0).transform(t).subtract(e),n=new l(0,1).transform(t).subtract(e);return new u(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){this._canvas&&Y.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=t&&t.complete),this._size=new u(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=Y.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){Y.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(t){function e(){var t=n.getView();t&&(paper=t._scope,n.setImage(i),n.emit("load"),t.update())}var i,n=this,r=this._crossOrigin;i=document.getElementById(t)||new Image,r&&(i.crossOrigin=r),i.naturalWidth&&i.naturalHeight?setTimeout(e,0):($.add(i,{load:e}),i.src||(i.src=t)),this.setImage(i)},getCrossOrigin:function(){return this._image&&this._image.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t,this._image&&(this._image.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=d.read(arguments),e=Y.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=d.read(arguments),e=new b(y.NO_INSERT);return e.setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.preConcatenate(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image&&this._image.src;if(/^data:/.test(t))return t;var e=this.getCanvas();return e?e.toDataURL.apply(e,arguments):null},drawImage:function(t){var e=l.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var i,n;t?t instanceof O?(n=t,i=t.getBounds()):t.width?i=new d(t):t.x&&(i=new d(t.x-.5,t.y-.5,1,1)):i=this.getBounds();var r=32,o=Math.min(i.width,r),s=Math.min(i.height,r),a=b._sampleContext;a?a.clearRect(0,0,r+1,r+1):a=b._sampleContext=Y.getContext(new u(r)),a.save();var l=(new p).scale(o/i.width,s/i.height).translate(-i.x,-i.y);l.applyToContext(a),n&&n.draw(a,new e({clip:!0,matrices:[l]})),this._matrix.applyToContext(a);var h=this.getElement(),c=this._size;h&&a.drawImage(h,-c.width/2,-c.height/2),a.restore();for(var f=a.getImageData(.5,.5,Math.ceil(o),Math.ceil(s)).data,g=[0,0,0],m=0,v=0,y=f.length;v<y;v+=4){var w=f[v+3];m+=w,w/=255,g[0]+=f[v]*w,g[1]+=f[v+1]*w,g[2]+=f[v+2]*w}for(var v=0;v<3;v++)g[v]/=m;return m?D.read(g):null},getPixel:function(){var t=l.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new D("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=l.read(arguments),e=D.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),o=r.createImageData(1,1),s=o.data;s[0]=255*i[0],s[1]=255*i[1],s[2]=255*i[2],s[3]=null!=n?255*n:255,r.putImageData(o,t.x,t.y)},createImageData:function(){var t=u.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=d.read(arguments);return t.isEmpty()&&(t=new d(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=l.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new d(this._size).setCenter(0,0);return e?e._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new T("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),S=y.extend({_class:"PlacedSymbol",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function(e,i){this._initialize(e,i!==t&&l.read(arguments,1))||this.setSymbol(e instanceof v?e:new v(e))},_equals:function(t){return this._symbol===t._symbol},getSymbol:function(){return this._symbol},setSymbol:function(t){this._symbol=t,this._changed(9)},clone:function(t){var e=new S(y.NO_INSERT);return e.setSymbol(this._symbol),this._clone(e,t)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(t,e,i){var n=this.symbol._definition;return n._getCachedBounds(t,e&&e.chain(n._matrix),i)},_hitTestSelf:function(t,e){var i=this._symbol._definition._hitTest(t,e);return i&&(i.item=this),i},_draw:function(t,e){this.symbol._definition.draw(t,e)}}),T=e.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&(i.enumerable=!0,this.inject(i))},statics:{getOptions:function(t){return new e({type:null,tolerance:paper.settings.hitTolerance,fill:!t,stroke:!t,segments:!t,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},t)}}}),C=e.extend({_class:"Segment",beans:!0,initialize:function(e,i,n,r,o,s){var a,l,h,u=arguments.length;0===u||(1===u?"point"in e?(a=e.point,l=e.handleIn,h=e.handleOut):a=e:2===u&&"number"==typeof e?a=arguments:u<=3?(a=e,l=i,h=n):(a=e!==t?[e,i]:null,l=n!==t?[n,r]:null,h=o!==t?[o,s]:null)),new P(a,this,"_point"),new P(l,this,"_handleIn"),new P(h,this,"_handleOut")},_serialize:function(t){return e.serialize(this.hasHandles()?[this._point,this._handleIn,this._handleOut]:this._point,t,!0)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){var t=l.read(arguments);this._point.set(t.x,t.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var t=l.read(arguments);this._handleIn.set(t.x,t.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var t=l.read(arguments);this._handleOut.set(t.x,t.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},_selectionState:0,isSelected:function(t){var e=this._selectionState;return t?t===this._point?!!(4&e):t===this._handleIn?!!(1&e):t===this._handleOut&&!!(2&e):!!(7&e)},setSelected:function(t,e){var i=this._path,t=!!t,n=this._selectionState,r=n,o=e?e===this._point?4:e===this._handleIn?1:e===this._handleOut?2:0:7;t?n|=o:n&=~o,this._selectionState=n,i&&n!==r&&(i._updateSelection(this,r,n),i._changed(129))},getIndex:function(){return this._index!==t?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new k(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t._x,n=t._y;t.set(e._x,e._y),e.set(i,n)},reversed:function(){return new C(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new C(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,o=i&&this._handleOut.isZero()?null:this._handleOut,s=n._x,a=n._y,l=2;return e[0]=s,e[1]=a,r&&(e[l++]=r._x+s,e[l++]=r._y+a),o&&(e[l++]=o._x+s,e[l++]=o._y+a),t&&(t._transformCoordinates(e,e,l/2),s=e[0],a=e[1],i?(n._x=s,n._y=a,l=2,r&&(r._x=e[l++]-s,r._y=e[l++]-a),o&&(o._x=e[l++]-s,o._y=e[l++]-a)):(r||(e[l++]=s,e[l++]=a),o||(e[l++]=s,e[l++]=a))),e}}),P=l.extend({initialize:function(e,i,n){var r,o,s;if(e)if((r=e[0])!==t)o=e[1];else{var a=e;(r=a.x)===t&&(a=l.read(arguments),r=a.x),o=a.y,s=a.selected}else r=o=0;this._x=r,this._y=o,this._owner=i,i[n]=this,s&&this.setSelected(!0)},set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},_serialize:function(t){var e=t.formatter,i=e.number(this._x),n=e.number(this._y);return this.isSelected()?{x:i,y:n,selected:!0}:[i,n]},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){return s.isZero(this._x)&&s.isZero(this._y)},setSelected:function(t){this._owner.setSelected(t,this)},isSelected:function(){return this._owner.isSelected(this)}}),E=e.extend({_class:"Curve",initialize:function(t,e,i,n,r,o,s,a){var l,h,u,c,d,f,p=arguments.length;3===p?(this._path=t,l=e,h=i):0===p?(l=new C,h=new C):1===p?"segment1"in t?(l=new C(t.segment1),h=new C(t.segment2)):"point1"in t?(u=t.point1,d=t.handle1,f=t.handle2,c=t.point2):Array.isArray(t)&&(u=[t[0],t[1]],c=[t[6],t[7]],d=[t[2]-t[0],t[3]-t[1]],f=[t[4]-t[6],t[5]-t[7]]):2===p?(l=new C(t),h=new C(e)):4===p?(u=t,d=e,f=i,c=n):8===p&&(u=[t,e],c=[s,a],d=[i-t,n-e],f=[r-s,o-a]),this._segment1=l||new C(u,null,d),this._segment2=h||new C(c,f,null)},_serialize:function(t){return e.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0)},_changed:function(){this._length=this._bounds=t},clone:function(){return new E(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;t=e.remove(),t&&this._segment1._handleOut.set(i.x,i.y)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){var t=l.read(arguments);this._segment1._point.set(t.x,t.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var t=l.read(arguments);this._segment2._point.set(t.x,t.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var t=l.read(arguments);this._segment1._handleOut.set(t.x,t.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var t=l.read(arguments);this._segment2._handleIn.set(t.x,t.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return E.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new l(t[i],t[i+1]));return e},getLength:function(){return null==this._length&&(this._length=E.getLength(this.getValues(),0,1)),this._length},getArea:function(){return E.getArea(this.getValues())},getLine:function(){return new g(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new E(E.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return E.getLength(this.getValues(),t,e)},getIntersections:function(t){return E._getIntersections(this.getValues(),t&&t!==this?t.getValues():null,this,t,[],{})},_getParameter:function(e,i){return i?e:e&&e.curve===this?e.parameter:e===t&&i===t?.5:this.getParameterAt(e,0)},divide:function(t,e,i){var n=this._getParameter(t,e),r=4e-7,o=1-r,s=null;if(n>=r&&n<=o){var a=E.subdivide(this.getValues(),n),h=a[0],u=a[1],c=i||this.hasHandles(),d=this._segment1,f=this._segment2,p=this._path;c&&(d._handleOut.set(h[2]-h[0],h[3]-h[1]),f._handleIn.set(u[4]-u[6],u[5]-u[7]));var g=h[6],m=h[7],v=new C(new l(g,m),c&&new l(h[4]-g,h[5]-m),c&&new l(u[2]-g,u[3]-m));p?(p.insert(d._index+1,v),s=this.getNext()):(this._segment2=v,s=new E(v,f))}return s},split:function(t,e){return this._path?this._path.split(this._segment1._index,this._getParameter(t,e)):null},reversed:function(){return new E(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0),this._segment2._handleIn.set(0,0)},statics:{getValues:function(t,e,i){var n=t._point,r=t._handleOut,o=e._handleIn,s=e._point,a=[n._x,n._y,n._x+r._x,n._y+r._y,s._x+o._x,s._y+o._y,s._x,s._y];return i&&i._transformCoordinates(a,a,4),a},subdivide:function(e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],u=e[7];i===t&&(i=.5);var c=1-i,d=c*n+i*o,f=c*r+i*s,p=c*o+i*a,g=c*s+i*l,m=c*a+i*h,v=c*l+i*u,y=c*d+i*p,w=c*f+i*g,_=c*p+i*m,x=c*g+i*v,b=c*y+i*_,S=c*w+i*x;return[[n,r,d,f,y,w,b,S],[b,S,_,x,m,v,h,u]]},solveCubic:function(t,e,i,n,r,o){var a=t[e],l=t[e+2],h=t[e+4],u=t[e+6],c=3*(l-a),d=3*(h-l)-c,f=u-a-c-d;return s.solveCubic(f,d,c,a-i,n,r,o)},getParameterOf:function(t,e){var i=new l(t[0],t[1]),n=new l(t[6],t[7]),r=1e-12,o=e.isClose(i,r)?0:e.isClose(n,r)?1:null;if(null!==o)return o;for(var s=[e.x,e.y],a=[],h=2e-7,u=0;u<2;u++)for(var c=E.solveCubic(t,u,s[u],a,0,1),d=0;d<c;d++)if(o=a[d],e.isClose(E.getPoint(t,o),h))return o;return e.isClose(i,h)?0:e.isClose(n,h)?1:null},getNearestParameter:function(t,e){function i(i){if(i>=0&&i<=1){var n=e.getDistance(E.getPoint(t,i),!0);if(n<f)return f=n,p=i,!0}}if(E.isStraight(t)){var n=t[0],r=t[1],o=t[6],s=t[7],a=o-n,h=s-r,u=a*a+h*h;if(0===u)return 0;var c=((e.x-n)*a+(e.y-r)*h)/u;return c<1e-12?0:c>.999999999999?1:E.getParameterOf(t,new l(n+c*a,r+c*h))}for(var d=100,f=Infinity,p=0,g=0;g<=d;g++)i(g/d);for(var m=1/(2*d);m>4e-7;)i(p-m)||i(p+m)||(m/=2);return p},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=E.subdivide(t,e)[1]),i<1&&(t=E.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},hasHandles:function(t){var e=s.isZero;return!(e(t[0]-t[2])&&e(t[1]-t[3])&&e(t[4]-t[6])&&e(t[5]-t[7]))},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],h=t[7],u=3*r-2*i-l,c=3*o-2*n-h,d=3*s-2*l-i,f=3*a-2*h-n;return Math.max(u*u,d*d)+Math.max(c*c,f*f)<10*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[6],r=t[7],o=(t[2]+e)/2,s=(t[3]+i)/2,a=(t[4]+t[6])/2,l=(t[5]+t[7])/2;return 6*((e-o)*(s+i)+(o-a)*(l+s)+(a-n)*(r+l))/10},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)E._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new d(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,o,a,l,h){function u(t,e){var i=t-e,n=t+e;i<a[r]&&(a[r]=i),n>l[r]&&(l[r]=n)}var c=3*(e-i)-t+n,d=2*(t+i)-4*e,f=e-t,p=s.solveQuadratic(c,d,f,h),g=4e-7,m=1-g;u(n,0);for(var v=0;v<p;v++){var y=h[v],w=1-y;g<y&&y<m&&u(w*w*w*t+3*w*w*y*e+3*w*y*y*i+y*y*y*n,o)}}}},e.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];if(!e){var i=this._path;e=this._bounds[t]=M[t]([this._segment1,this._segment2],!1,i&&i.getStyle())}return e.clone()}},{}),e.each({isStraight:function(t,e,i){if(e.isZero()&&i.isZero())return!0;if(t.isZero())return!1;if(e.isCollinear(t)&&i.isCollinear(t)){var n=t.dot(t),r=t.dot(e)/n,o=t.dot(i)/n;return r>=0&&r<=1&&o<=0&&o>=-1}return!1},isLinear:function(t,e,i){var n=t.divide(3);return e.equals(n)&&i.negate().equals(n)}},function(t,e){this[e]=function(){var e=this._segment1,i=this._segment2;return t(i._point.subtract(e._point),e._handleOut,i._handleIn)},this.statics[e]=function(e){var i=e[0],n=e[1],r=e[6],o=e[7];return t(new l(r-i,o-n),new l(e[2]-i,e[3]-n),new l(e[4]-r,e[5]-o))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).y)<1e-7},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).x)<1e-7}}),{beans:!1,getParameterAt:function(t,e){return E.getParameterAt(this.getValues(),t,e)},getParameterOf:function(){return E.getParameterOf(this.getValues(),l.read(arguments))},getLocationAt:function(t,e){var i=e?t:this.getParameterAt(t);return null!=i&&i>=0&&i<=1?new k(this,i):null},getLocationOf:function(){return this.getLocationAt(this.getParameterOf(l.read(arguments)),!0)},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getNearestLocation:function(){var t=l.read(arguments),e=this.getValues(),i=E.getNearestParameter(e,t),n=E.getPoint(e,i);return new k(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return e.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return E[t](n,i?e:E.getParameterAt(n,e,0))}},{statics:{evaluateMethods:t}})},new function(){function e(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],h=9*(n-o)+3*(a-e),u=6*(e+o)-12*n,c=3*(n-e),d=9*(r-s)+3*(l-i),f=6*(i+s)-12*r,p=3*(r-i);return function(t){var e=(h*t+u)*t+c,i=(d*t+f)*t+p;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r,o,s=t[0],a=t[1],h=t[2],u=t[3],c=t[4],d=t[5],f=t[6],p=t[7],g=4e-7,m=1-g;if(0===i&&(e<g||e>m)){var v=e<g;r=v?s:f,o=v?a:p}else{var y=3*(h-s),w=3*(c-h)-y,_=f-s-y-w,x=3*(u-a),b=3*(d-u)-x,S=p-a-x-b;if(0===i)r=((_*e+w)*e+y)*e+s,o=((S*e+b)*e+x)*e+a;else{if(e<g?(r=y,o=x):e>m?(r=3*(f-c),o=3*(p-d)):(r=(3*_*e+2*w)*e+y,o=(3*S*e+2*b)*e+x),n){0===r&&0===o&&(e<g||e>m)&&(r=c-h,o=d-u);var T=Math.sqrt(r*r+o*o);T&&(r/=T,o/=T)}if(3===i){var C=6*_*e+2*w,P=6*S*e+2*b,E=Math.pow(r*r+o*o,1.5);r=0!==E?(r*P-o*C)/E:0,o=0}}}return 2===i?new l(o,-r):new l(r,o)}return{statics:{getLength:function(n,r,o){if(r===t&&(r=0),o===t&&(o=1),0===r&&1===o&&E.isStraight(n)){var a=n[6]-n[0],l=n[7]-n[1];return Math.sqrt(a*a+l*l)}var h=e(n);return s.integrate(h,r,o,i(r,o))},getParameterAt:function(n,r,o){function a(t){return g+=s.integrate(d,o,t,i(o,t)),o=t,g-r}if(o===t&&(o=r<0?1:0),0===r)return o;var l=Math.abs,h=r>0,u=h?o:0,c=h?1:o,d=e(n),f=s.integrate(d,u,c,i(u,c));if(l(r-f)<1e-12)return h?c:u;if(l(r)>f)return null;var p=r/f,g=0;return s.findRoot(a,d,o+p,u,c,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x}}}},new function(){function t(t,e,i,n,r,o,s,a,l,h,u){var c=e.startConnected,d=e.endConnected,f=4e-7,p=1-f;if(null==r&&(r=E.getParameterOf(i,o)),null!==r&&r>=(c?f:0)&&r<=(d?p:1)&&(null==l&&(l=E.getParameterOf(s,h)),null!==l&&l>=(d?f:0)&&l<=(c?p:1))){var g=e.renormalize;if(g){var m=g(r,l);r=m[0],l=m[1]}var v=new k(n,r,o||E.getPoint(i,r),u),y=new k(a,l,h||E.getPoint(s,l),u),w=v.getPath()===y.getPath()&&v.getIndex()>y.getIndex(),_=w?y:v,x=e.include;v._intersection=y,y._intersection=v,x&&!x(_)||k.insert(t,_,!0)}}function e(r,o,s,a,l,h,u,c,d,f,p,m,v){if(!(++v>=24)){var y,w,_=o[0],x=o[1],b=o[6],S=o[7],T=g.getSignedDistance,C=T(_,x,b,S,o[2],o[3]),P=T(_,x,b,S,o[4],o[5]),k=C*P>0?.75:4/9,O=k*Math.min(0,C,P),M=k*Math.max(0,C,P),R=T(_,x,b,S,r[0],r[1]),I=T(_,x,b,S,r[2],r[3]),L=T(_,x,b,S,r[4],r[5]),N=T(_,x,b,S,r[6],r[7]),A=i(R,I,L,N),D=A[0],z=A[1];if(null!=(y=n(D,z,O,M))&&null!=(w=n(D.reverse(),z.reverse(),O,M))){r=E.getPart(r,y,w);var H=w-y,B=u+(c-u)*y,F=u+(c-u)*w;if(p>.5&&H>.5)if(F-B>f-d){var $=E.subdivide(r,.5),j=B+(F-B)/2;e(o,$[0],a,s,l,h,d,f,B,j,H,!m,v),e(o,$[1],a,s,l,h,d,f,j,F,H,!m,v)}else{var $=E.subdivide(o,.5),j=d+(f-d)/2;e($[0],r,a,s,l,h,d,j,B,F,H,!m,v),e($[1],r,a,s,l,h,j,f,B,F,H,!m,v)}else if(Math.max(f-d,F-B)<1e-7){var W=B+(F-B)/2,q=d+(f-d)/2;r=s.getValues(),o=a.getValues(),t(l,h,m?o:r,m?a:s,m?q:W,null,m?r:o,m?s:a,m?W:q,null)}else H>1e-12&&e(o,r,a,s,l,h,d,f,B,F,H,!m,v)}}}function i(t,e,i,n){var r,o=[0,t],s=[1/3,e],a=[2/3,i],l=[1,n],h=e-(2*t+n)/3,u=i-(t+2*n)/3;if(h*u<0)r=[[o,s,l],[o,a,l]];else{var c=h/u;r=[c>=2?[o,s,l]:c<=.5?[o,a,l]:[o,s,a,l],[o,l]]}return(h||u)<0?r.reverse():r}function n(t,e,i,n){return t[0][1]<i?r(t,!0,i):e[0][1]>n?r(e,!1,n):t[0][0]}function r(t,e,i){for(var n=t[0][0],r=t[0][1],o=1,s=t.length;o<s;o++){var a=t[o][0],l=t[o][1];if(e?l>=i:l<=i)return l===i?a:n+(i-r)*(a-n)/(l-r);n=a,r=l}return null}function o(e,i,n,r,o,a){for(var l=E.isStraight(e),h=l?i:e,u=l?e:i,c=u[0],d=u[1],f=u[6],p=u[7],g=f-c,m=p-d,v=Math.atan2(-m,g),y=Math.sin(v),w=Math.cos(v),_=[],x=0;x<8;x+=2){var b=h[x]-c,S=h[x+1]-d;_.push(b*w-S*y,b*y+S*w)}for(var T=[],C=E.solveCubic(_,1,0,T,0,1),x=0;x<C;x++){var P=T[x],k=E.getPoint(h,P),O=E.getParameterOf(u,k);if(null!==O){var M=E.getPoint(u,O),R=l?O:P,I=l?P:O;(!a.endConnected||I>s.CURVETIME_EPSILON)&&t(o,a,e,n,R,l?M:k,i,r,I,l?k:M)}}}function a(e,i,n,r,o,s){var a=g.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);a&&t(o,s,e,n,null,a,i,r,null,a)}return{statics:{_getIntersections:function(i,n,r,s,h,u){if(!n)return E._getSelfIntersection(i,r,h,u);var c=i[0],d=i[1],f=i[6],p=i[7],g=n[0],m=n[1],v=n[6],y=n[7],w=(3*i[2]+c)/4,_=(3*i[3]+d)/4,x=(3*i[4]+f)/4,b=(3*i[5]+p)/4,S=(3*n[2]+g)/4,T=(3*n[3]+m)/4,C=(3*n[4]+v)/4,P=(3*n[5]+y)/4,k=Math.min,O=Math.max;if(!(O(c,w,x,f)>=k(g,S,C,v)&&k(c,w,x,f)<=O(g,S,C,v)&&O(d,_,b,p)>=k(m,T,P,y)&&k(d,_,b,p)<=O(m,T,P,y)))return h;if(!u.startConnected&&!u.endConnected){var M=E.getOverlaps(i,n);if(M){for(var R=0;R<2;R++){var I=M[R];t(h,u,i,r,I[0],null,n,s,I[1],null,!0)}return h}}var L=E.isStraight(i),N=E.isStraight(n),A=L&&N,D=1e-12,z=h.length;if((A?a:L||N?o:e)(i,n,r,s,h,u,0,1,0,1,0,!1,0),A&&h.length>z)return h;var H=new l(c,d),B=new l(f,p),F=new l(g,m),$=new l(v,y);return H.isClose(F,D)&&t(h,u,i,r,0,H,n,s,0,F),!u.startConnected&&H.isClose($,D)&&t(h,u,i,r,0,H,n,s,1,$),!u.endConnected&&B.isClose(F,D)&&t(h,u,i,r,1,B,n,s,0,F),B.isClose($,D)&&t(h,u,i,r,1,B,n,s,1,$),h},_getSelfIntersection:function(t,e,i,n){var r=t[0],o=t[1],a=t[2],h=t[3],u=t[4],c=t[5],d=t[6],f=t[7],p=new g(r,o,d,f,!1),m=p.getSide(new l(a,h),!0);if(m===p.getSide(new l(u,c),!0)&&((r-u)*(h-f)+(a-d)*(c-o))*m>0)return i;var v=d-3*u+3*a-r,y=u-2*a+r,w=a-r,_=f-3*c+3*h-o,x=c-2*h+o,b=h-o,S=_*w-v*b;if(S*S-4*(_*y-v*x)*(x*w-y*b)<0){var T,C=[],P=s.solveCubic(v*v+_*_,3*(v*y+_*x),2*(y*y+x*x)+v*w+_*b,y*w+x*b,C,0,1);if(P>0){for(var k=0,O=0;k<P;k++){var M=Math.abs(e.getCurvatureAt(C[k],!0));M>O&&(O=M,T=C[k])}var R=E.subdivide(t,T);n.endConnected=!0,n.renormalize=function(t,e){return[t*T,e*(1-T)+T]},E._getIntersections(R[0],R[1],e,e,i,n)}}return i},getOverlaps:function(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=4e-7,o=2e-7,s=E.isStraight(t),a=E.isStraight(e),h=s&&a;if(h){var u=i(t)<i(e),c=u?e:t,d=u?t:e,f=new g(c[0],c[1],c[6],c[7]);if(f.getDistance(new l(d[0],d[1]))>o||f.getDistance(new l(d[6],d[7]))>o)return null}else if(s^a)return null;for(var p=[t,e],m=[],v=0,y=0;v<2&&m.length<2;v+=0===y?0:1,y^=1){var w=E.getParameterOf(p[1^v],new l(p[v][0===y?0:6],p[v][0===y?1:7]));if(null!=w){var _=0===v?[y,w]:[w,y];(0===m.length||n(_[0]-m[0][0])>r&&n(_[1]-m[0][1])>r)&&m.push(_)}if(1===v&&0===m.length)break}if(2!==m.length)m=null;else if(!h){var x=E.getPart(t,m[0][0],m[1][0]),b=E.getPart(e,m[0][1],m[1][1]);(n(b[2]-x[2])>o||n(b[3]-x[3])>o||n(b[4]-x[4])>o||n(b[5]-x[5])>o)&&(m=null)}return m}}}}),k=e.extend({_class:"CurveLocation",beans:!0,initialize:function t(e,i,n,r,o){if(i>.9999996){var s=e.getNext();s&&(i=0,e=s)}this._id=a.get(t),this._setCurve(e),this._parameter=i,this._point=n||e.getPointAt(i,!0),this._overlap=r,this._distance=o,this._intersection=this._next=this._prev=null},_setCurve:function(t){var e=t._path
;this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._parameter=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this.getCurve(),e=this._segment;if(!e){var i=this.getParameter();0===i?e=t._segment1:1===i?e=t._segment2:null!=i&&(e=t.getPartLength(0,i)<t.getPartLength(i,1)?t._segment1:t._segment2),this._segment=e}return e},getCurve:function(){function t(t){var e=t&&t.getCurve();if(e&&null!=(n._parameter=e.getParameterOf(n._point)))return n._setCurve(e),n._segment=t,e}var e=this._curve,i=e&&e._path,n=this;return i&&i._version!==this._version&&(e=this._parameter=this._curve=this._offset=null),e||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getParameter:function(){var t=this.getCurve(),e=this._parameter;return t&&null==e?this._parameter=t.getParameterOf(this._point):e},getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this.getCurve(),e=this.getParameter();return null!=e&&t&&t.getPartLength(0,e)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=null;return t&&(e=t.divide(this.getParameter(),!0))&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve();return t?t.split(this.getParameter(),!0):null},equals:function(t,e){var i=this===t,n=2e-7;if(!i&&t instanceof k&&this.getPath()===t.getPath()&&this.getPoint().isClose(t.getPoint(),n)){var r=this.getCurve(),o=t.getCurve(),s=Math.abs,a=s((r.isLast()&&o.isFirst()?-1:r.getIndex())+this.getParameter()-((o.isLast()&&r.isFirst()?-1:o.getIndex())+t.getParameter()));i=(a<4e-7||(a=s(this.getOffset()-t.getOffset()))<n||s(this.getPath().getLength()-a)<n)&&(e||!this._intersection&&!t._intersection||this._intersection&&this._intersection.equals(t._intersection,!0))}return i},toString:function(){var t=[],e=this.getPoint(),i=o.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getParameter();return null!=r&&t.push("parameter: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){function t(t,e,i){return e<i?t>e&&t<i:t>e&&t<=u||t>=-u&&t<i}var e=this._intersection;if(!e)return!1;var i=this.getParameter(),n=e.getParameter(),r=4e-7,o=1-r;if(i>=r&&i<=o||n>=r&&n<=o)return!this.isTouching();var s=this.getCurve(),a=s.getPrevious(),l=e.getCurve(),h=l.getPrevious(),u=Math.PI;if(!a||!h)return!1;var c=a.getTangentAt(o,!0).negate().getAngleInRadians(),d=s.getTangentAt(r,!0).getAngleInRadians(),f=h.getTangentAt(o,!0).negate().getAngleInRadians(),p=l.getTangentAt(r,!0).getAngleInRadians();return t(f,c,d)^t(p,c,d)&&t(f,d,c)^t(p,d,c)},isOverlap:function(){return!!this._overlap}},e.each(E.evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getParameter(),i=this.getCurve();return null!=t&&i&&i[e](t,!0)}},{preserve:!0}),new function(){function t(t,e,i){function n(i,n){for(var o=i+n;o>=-1&&o<=r;o+=n){var s=t[(o%r+r)%r];if(!e.getPoint().isClose(s.getPoint(),2e-7))break;if(e.equals(s))return s}return null}for(var r=t.length,o=0,s=r-1;o<=s;){var a,l=o+s>>>1,h=t[l];if(i&&(a=e.equals(h)?h:n(l,-1)||n(l,1)))return e._overlap&&(a._overlap=a._intersection._overlap=!0),a;var u=e.getPath(),c=h.getPath();(u===c?e.getIndex()+e.getParameter()-(h.getIndex()+h.getParameter()):u._id-c._id)<0?s=l-1:o=l+1}return t.splice(o,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=0,r=e.length;n<r;n++)t(i,e[n]._intersection,!1);return i}}}}),O=y.extend({_class:"PathItem",initialize:function(){},getIntersections:function(t,e,i,n){var r=this===t||!t,o=this._matrix.orNullIfIdentity(),s=r?o:(i||t._matrix).orNullIfIdentity();if(!r&&!this.getBounds(o).touches(t.getBounds(s)))return[];for(var a,t,l=this.getCurves(),h=r?l:t.getCurves(),u=l.length,c=r?u:h.length,d=[],f=[],p=0;p<c;p++)d[p]=h[p].getValues(s);for(var p=0;p<u;p++){var g=l[p],m=r?d[p]:g.getValues(o),v=g.getPath();v!==t&&(t=v,a=[],f.push(a)),r&&E._getSelfIntersection(m,g,a,{include:e,startConnected:1===u&&g.getPoint1().equals(g.getPoint2())});for(var y=r?p+1:0;y<c;y++){if(n&&a.length)return a;var w=h[y];E._getIntersections(m,d[y],g,w,a,{include:e,startConnected:r&&g.getPrevious()===w,endConnected:r&&g.getNext()===w})}}a=[];for(var p=0,_=f.length;p<_;p++)a.push.apply(a,f[p]);return a},getCrossings:function(t){return this.getIntersections(t,function(t){return t.isCrossing()})},_asPathItem:function(){return this},setPathData:function(t){function e(t,e){var i=+n[t];return a&&(i+=h[e]),i}function i(t){return new l(e(t,"x"),e(t+1,"y"))}var n,r,o,s=t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),a=!1,h=new l,c=new l;this.clear();for(var d=0,f=s&&s.length;d<f;d++){var p=s[d],g=p[0],m=g.toLowerCase();n=p.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var v=n&&n.length;switch(a=g===m,"z"!==r||/[mz]/.test(m)||this.moveTo(h=c),m){case"m":case"l":for(var y="m"===m,w=0;w<v;w+=2)this[0===w&&y?"moveTo":"lineTo"](h=i(w));o=h,y&&(c=h);break;case"h":case"v":for(var _="h"===m?"x":"y",w=0;w<v;w++)h[_]=e(w,_),this.lineTo(h);o=h;break;case"c":for(var w=0;w<v;w+=6)this.cubicCurveTo(i(w),o=i(w+2),h=i(w+4));break;case"s":for(var w=0;w<v;w+=4)this.cubicCurveTo(/[cs]/.test(r)?h.multiply(2).subtract(o):h,o=i(w),h=i(w+2)),r=m;break;case"q":for(var w=0;w<v;w+=4)this.quadraticCurveTo(o=i(w),h=i(w+2));break;case"t":for(var w=0;w<v;w+=2)this.quadraticCurveTo(o=/[qt]/.test(r)?h.multiply(2).subtract(o):h,h=i(w)),r=m;break;case"a":for(var w=0;w<v;w+=7)this.arcTo(h=i(w+5),new u(+n[w],+n[w+1]),+n[w+2],+n[w+4],+n[w+3]);break;case"z":this.closePath(!0)}r=m}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=this._getWinding(t,!1,!0);return!!("evenodd"===this.getWindingRule()?1&e:e)}}),M=O.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(e){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(e)?"object"==typeof e[0]?e:arguments:!e||e.size!==t||e.x===t&&e.point===t?null:arguments;i&&i.length>0?this.setSegments(i):(this._curves=t,this._selectedSegmentState=0,i||"string"!=typeof e||(this.setPathData(e),e=null)),this._initialize(!i&&e)},_equals:function(t){return this._closed===t._closed&&e.equals(this._segments,t._segments)},clone:function(e){var i=new M(y.NO_INSERT);return i.setSegments(this._segments),i._closed=this._closed,this._clockwise!==t&&(i._clockwise=this._clockwise),this._clone(i,e)},_changed:function e(i){if(e.base.call(this,i),8&i){var n=this._parent;if(n&&(n._currentPath=t),this._length=this._area=this._clockwise=this._monoCurves=t,16&i)this._version++;else if(this._curves)for(var r=0,o=this._curves.length;r<o;r++)this._curves[r]._changed()}else 32&i&&(this._bounds=t)},getStyle:function(){var t=this._parent;return(t instanceof R?t:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var i=this.isFullySelected();this._segments.length=0,this._selectedSegmentState=0,this._curves=t,e&&e.length>0&&this._add(C.readAll(e)),i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new E(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new E(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){function i(e,i){e._transformCoordinates(t,g,!1),n=g[0],r=g[1],m?(v.push("M"+p.pair(n,r)),m=!1):(l=g[2],h=g[3],l===n&&h===r&&u===s&&c===a?i||v.push("l"+p.pair(n-s,r-a)):v.push("c"+p.pair(u-s,c-a)+" "+p.pair(l-s,h-a)+" "+p.pair(n-s,r-a))),s=n,a=r,u=g[4],c=g[5]}var n,r,s,a,l,h,u,c,d=this._segments,f=d.length,p=new o(e),g=new Array(6),m=!0,v=[];if(0===f)return"";for(var y=0;y<f;y++)i(d[y]);return this._closed&&f>0&&(i(d[0],!0),v.push("z")),v.join("")}},{isEmpty:function(){return 0===this._segments.length},_transformContent:function(t){for(var e=new Array(6),i=0,n=this._segments.length;i<n;i++)this._segments[i]._transformCoordinates(t,e,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,o=null==e,e=o?i.length:e,s=0;s<r;s++){var a=t[s];a._path&&(a=t[s]=a.clone()),a._path=this,a._index=e+s,a._selectionState&&this._updateSelection(a,0,a._selectionState)}if(o)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));for(var s=e+r,l=i.length;s<l;s++)i[s]._index=s}if(n){var h=this._countCurves(),u=e+r-1===h?e-1:e,c=u,d=Math.min(u+r,h);t._curves&&(n.splice.apply(n,[u,0].concat(t._curves)),c+=t._curves.length);for(var s=c;s<d;s++)n.splice(s,0,new E(this,null,null));this._adjustCurves(u,d)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,o=t;o<e;o++)i=r[o],i._path=this,i._segment1=n[o],i._segment2=n[o+1]||n[0],i._changed();(i=r[this._closed&&0===t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(C.readAll(arguments)):this._add([C.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(C.readAll(arguments,1),t):this._add([C.read(arguments,1)],t)[0]},addSegment:function(){return this._add([C.read(arguments)])[0]},insertSegment:function(t){return this._add([C.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(C.readAll(t))},insertSegments:function(t,e){return this._add(C.readAll(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,i,n){t=t||0,i=e.pick(i,this._segments.length);var r=this._segments,o=this._curves,s=r.length,a=r.splice(t,i-t),l=a.length;if(!l)return a;for(var h=0;h<l;h++){var u=a[h];u._selectionState&&this._updateSelection(u,u._selectionState,0),u._index=u._path=null}for(var h=t,c=r.length;h<c;h++)r[h]._index=h;if(o){var d=t>0&&i===s+(this._closed?1:0)?t-1:t,o=o.splice(d,l);n&&(a._curves=o.slice(1)),this._adjustCurves(d,d)}return this._changed(25),a},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){if(null==this._area){for(var t=this._segments,e=t.length,i=e-1,n=0,r=0,o=this._closed?e:i;r<o;r++)n+=E.getArea(E.getValues(t[r],t[r<i?r+1:0]));this._area=n}return this._area},isClockwise:function(){return this._clockwise!==t?this._clockwise:this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse(),this._clockwise=t},isFullySelected:function(){var t=this._segments.length;return this._selected&&t>0&&this._selectedSegmentState===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelected:function t(e){e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments.length;this._selectedSegmentState=t?7*e:0;for(var i=0;i<e;i++)this._segments[i]._selectionState=t?7:0},_updateSelection:function(t,e,i){t._selectionState=i,(this._selectedSegmentState+=i-e)>0&&this.setSelected(!0)},flatten:function(t){for(var e=new I(this,64,.1),i=0,n=e.length/Math.ceil(e.length/t),r=e.length+(this._closed?-n:n)/2,o=[];i<=r;)o.push(new C(e.getPointAt(i))),i+=n;this.setSegments(o)},reduce:function(){for(var t=this.getCurves(),e=t.length-1;e>=0;e--){var i=t[e];i.hasHandles()||0!==i.getLength()&&!i.isCollinear(i.getNext())||i.remove()}return this},simplify:function(t){if(this._segments.length>2){var e=new L(this,t||2.5);this.setSegments(e.fit())}},split:function(t,e){if(null===e)return null;if(1===arguments.length){var i=t;if("number"==typeof i&&(i=this.getLocationAt(i)),!i)return null;t=i.index,e=i.parameter}var n=4e-7;e>=1-n&&(t++,e--);var r=this.getCurves();if(t>=0&&t<r.length){e>=n&&r[t++].divide(e,!0);var o,s=this.removeSegments(t,this._segments.length,!0);return this._closed?(this.setClosed(!1),o=this):(o=new M(y.NO_INSERT),o.insertAbove(this,!0),this._clone(o)),o._add(s,0),this.addSegment(s[0]),o}return null},reverse:function(){this._segments.reverse();for(var e=0,i=this._segments.length;e<i;e++){var n=this._segments[e],r=n._handleIn;n._handleIn=n._handleOut,n._handleOut=r,n._index=e}this._curves=null,this._clockwise!==t&&(this._clockwise=!this._clockwise),this._changed(9)},join:function(t){if(t){var e=t._segments,i=this.getLastSegment(),n=t.getLastSegment();if(!n)return this;i&&i._point.equals(n._point)&&t.reverse();var r=t.getFirstSegment();if(i&&i._point.equals(r._point))i.setHandleOut(r._handleOut),this._add(e.slice(1));else{var o=this.getFirstSegment();o&&o._point.equals(r._point)&&t.reverse(),n=t.getLastSegment(),o&&o._point.equals(n._point)?(o.setHandleIn(n._handleIn),this._add(e.slice(0,e.length-1),0)):this._add(e.slice())}t._closed&&this._add([e[0]]),t.remove()}var s=this.getFirstSegment(),a=this.getLastSegment();return s!==a&&s._point.equals(a._point)&&(s.setHandleIn(a._handleIn),a.remove(),this.setClosed(!0)),this},toShape:function(t){function e(t,e){var i=c[t],n=i.getNext(),r=c[e],o=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&o._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(o._point.subtract(r._point))}function i(t){var e=c[t],i=e.getPrevious(),n=e.getNext();return i._handleOut.isZero()&&e._handleIn.isZero()&&e._handleOut.isZero()&&n._handleIn.isZero()&&e._point.subtract(i._point).isOrthogonal(n._point.subtract(e._point))}function n(t){var e=c[t],i=e.getNext(),n=e._handleOut,r=i._handleIn,o=.5522847498307936;if(n.isOrthogonal(r)){var a=e._point,l=i._point,h=new g(a,n,!0).intersect(new g(l,r,!0),!0);return h&&s.isZero(n.getLength()/h.subtract(a).getLength()-o)&&s.isZero(r.getLength()/h.subtract(l).getLength()-o)}return!1}function r(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this._closed)return null;var o,a,l,h,c=this._segments;if(!this.hasHandles()&&4===c.length&&e(0,2)&&e(1,3)&&i(1)?(o=x.Rectangle,a=new u(r(0,3),r(0,1)),h=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&n(0)&&n(2)&&n(4)&&n(6)&&e(1,5)&&e(3,7)?(o=x.Rectangle,a=new u(r(1,6),r(0,3)),l=a.subtract(new u(r(0,7),r(1,2))).divide(2),h=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&n(0)&&n(1)&&n(2)&&n(3)&&(s.isZero(r(0,2)-r(1,3))?(o=x.Circle,l=r(0,2)/2):(o=x.Ellipse,l=new u(r(2,0)/2,r(3,1)/2)),h=c[1]._point),o){var d=this.getPosition(!0),f=this._clone(new o({center:d,size:a,radius:l,insert:!1}),t,!1);return f.rotate(h.subtract(d).getAngle()+90),f}return null},_hitTestSelf:function(t,e){function i(e,i){return t.subtract(e).divide(i).length<=1}function n(t,n,r){if(!e.selected||n.isSelected()){var o=t._point;if(n!==o&&(n=n.add(o)),i(n,_))return new T(r,p,{segment:t,point:n})}}function r(t,i){return(i||e.segments)&&n(t,t._point,"segment")||!i&&e.handles&&(n(t,t._handleIn,"handle-in")||n(t,t._handleOut,"handle-out"))}function o(t){c.add(t)}function s(e){if(("round"!==a||"round"!==h)&&(c=new M({internal:!0,closed:!0}),y||e._index>0&&e._index<v-1?"round"!==a&&(e._handleIn.isZero()||e._handleOut.isZero())&&M._addBevelJoin(e,a,C,u,o,!0):"round"!==h&&M._addSquareCap(e,h,C,o,!0),!c.isEmpty())){var n;return c.contains(t)||(n=c.getNearestLocation(t))&&i(n.getPoint(),w)}return i(e._point,_)}var a,h,u,c,d,f,p=this,g=this.getStyle(),m=this._segments,v=m.length,y=this._closed,w=e._tolerancePadding,_=w,x=e.stroke&&g.hasStroke(),b=e.fill&&g.hasFill(),S=e.curves,C=x?g.getStrokeWidth()/2:b&&e.tolerance>0||S?0:null;if(null!==C&&(C>0?(a=g.getStrokeJoin(),h=g.getStrokeCap(),u=C*g.getMiterLimit(),_=w.add(new l(C,C))):a=h="round"),!e.ends||e.segments||y){if(e.segments||e.handles)for(var P=0;P<v;P++)if(f=r(m[P]))return f}else if(f=r(m[0],!0)||r(m[v-1],!0))return f;if(null!==C){if(d=this.getNearestLocation(t)){var E=d.getParameter();0===E||1===E&&v>1?s(d.getSegment())||(d=null):i(d.getPoint(),_)||(d=null)}if(!d&&"miter"===a&&v>1)for(var P=0;P<v;P++){var k=m[P];if(t.getDistance(k._point)<=u&&s(k)){d=k.getLocation();break}}}return!d&&b&&this._contains(t)||d&&!x&&!S?new T("fill",this):d?new T(x?"stroke":"curve",this,{location:d,point:d.getPoint()}):null}},e.each(E.evaluateMethods,function(t){this[t+"At"]=function(e,i){var n=this.getLocationAt(e,i);return n&&n[t]()}},{beans:!1,getLocationOf:function(){for(var t=l.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t,e){var i=this.getCurves(),n=0;if(e){var r=~~t,o=i[r];return o?o.getLocationAt(t-r,!0):null}for(var s=0,a=i.length;s<a;s++){var l=n,o=i[s];if((n+=o.getLength())>t)return o.getLocationAt(t-l)}return i.length>0&&t<=this.getLength()?new k(i[i.length-1],1):null},getNearestLocation:function(){for(var t=l.read(arguments),e=this.getCurves(),i=Infinity,n=null,r=0,o=e.length;r<o;r++){var s=e[r].getNearestLocation(t);s._distance<i&&(i=s._distance,n=s)}return n},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function t(t,e,i,n){function r(e){var i=s[e],n=s[e+1];c==i&&d==n||(t.beginPath(),t.moveTo(c,d),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,o,0,2*Math.PI,!0),t.fill())}for(var o=n/2,s=new Array(6),a=0,l=e.length;a<l;a++){var h=e[a];h._transformCoordinates(i,s,!1);var u=h._selectionState,c=s[0],d=s[1];if(1&u&&r(2),2&u&&r(4),t.fillRect(c-o,d-o,n,n),!(4&u)){var f=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(c-o+1,d-o+1,n-2,n-2),t.fillStyle=f}}}function e(t,e,i){function n(e){if(i)e._transformCoordinates(i,p,!1),r=p[0],o=p[1];else{var n=e._point;r=n._x,o=n._y}if(g)t.moveTo(r,o),g=!1;else{if(i)l=p[2],h=p[3];else{var d=e._handleIn;l=r+d._x,h=o+d._y}l===r&&h===o&&u===s&&c===a?t.lineTo(r,o):t.bezierCurveTo(u,c,l,h,r,o)}if(s=r,a=o,i)u=p[4],c=p[5];else{var d=e._handleOut;u=s+d._x,c=a+d._y}}for(var r,o,s,a,l,h,u,c,d=e._segments,f=d.length,p=new Array(6),g=!0,m=0;m<f;m++)n(d[m]);e._closed&&f>0&&n(d[0])}return{_draw:function(t,i,n){function r(t){return u[(t%c+c)%c]}var o=i.dontStart,s=i.dontFinish||i.clip,a=this.getStyle(),l=a.hasFill(),h=a.hasStroke(),u=a.getDashArray(),c=!paper.support.nativeDash&&h&&u&&u.length;if(o||t.beginPath(),!o&&this._currentPath?t.currentPath=this._currentPath:(l||h&&!c||s)&&(e(t,this,n),this._closed&&t.closePath(),o||(this._currentPath=t.currentPath)),!s&&(l||h)&&(this._setStyles(t),l&&(t.fill(a.getWindingRule()),t.shadowColor="rgba(0,0,0,0)"),h)){if(c){o||t.beginPath();var d,f=new I(this,32,.25,n),p=f.length,g=-a.getDashOffset(),m=0;for(g%=p;g>0;)g-=r(m--)+r(m--);for(;g<p;)d=g+r(m++),(g>0||d>0)&&f.drawPart(t,Math.max(g,0),Math.max(d,0)),g=d+r(m++)}t.stroke()}},_drawSelected:function(i,n){i.beginPath(),e(i,this,n),i.stroke(),t(i,this._segments,n,paper.settings.handleSize)}}},new function(){function t(t){var e=t.length,i=[],n=[],r=2;i[0]=t[0]/r;for(var o=1;o<e;o++)n[o]=1/r,r=(o<e-1?4:2)-n[o],i[o]=(t[o]-i[o-1])/r;for(var o=1;o<e;o++)i[e-o-1]-=n[e-o]*i[e-o];return i}return{smooth:function(){var e=this._segments,i=e.length,n=this._closed,r=i,o=0;if(!(i<=2)){n&&(o=Math.min(i,4),r+=2*Math.min(i,o));for(var s=[],a=0;a<i;a++)s[a+o]=e[a]._point;if(n)for(var a=0;a<o;a++)s[a]=e[a+i-o]._point,s[a+i+o]=e[a]._point;else r--;for(var h=[],a=1;a<r-1;a++)h[a]=4*s[a]._x+2*s[a+1]._x;h[0]=s[0]._x+2*s[1]._x,h[r-1]=3*s[r-1]._x;for(var u=t(h),a=1;a<r-1;a++)h[a]=4*s[a]._y+2*s[a+1]._y;h[0]=s[0]._y+2*s[1]._y,h[r-1]=3*s[r-1]._y;var c=t(h);if(n){for(var a=0,d=i;a<o;a++,d++){var f=a/o,p=1-f,g=a+o,m=d+o;u[d]=u[a]*f+u[d]*p,c[d]=c[a]*f+c[d]*p,u[m]=u[g]*p+u[m]*f,c[m]=c[g]*p+c[m]*f}r--}for(var v=null,a=o;a<=r-o;a++){var y=e[a-o];v&&y.setHandleIn(v.subtract(y._point)),a<r&&(y.setHandleOut(new l(u[a],c[a]).subtract(y._point)),v=a<r-1?new l(2*s[a+1]._x-u[a+1],2*s[a+1]._y-c[a+1]):new l((s[r]._x+u[r-1])/2,(s[r]._y+c[r-1])/2))}if(n&&v){var y=this._segments[0];y.setHandleIn(v.subtract(y._point))}}}}},new function(){function t(t){var e=t._segments;if(0===e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new C(l.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new C(l.read(arguments))])},cubicCurveTo:function(){var e=l.read(arguments),i=l.read(arguments),n=l.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new C(n,i.subtract(n))])},quadraticCurveTo:function(){var e=l.read(arguments),i=l.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var i=l.read(arguments),n=l.read(arguments),r=e.pick(e.read(arguments),.5),o=1-r,s=t(this)._point,a=i.subtract(s.multiply(o*o)).subtract(n.multiply(r*r)).divide(2*r*o);if(a.isNaN())throw new Error("Cannot put a curve through points with parameter = "+r);this.quadraticCurveTo(a,n)},arcTo:function(){var i,n,r,o,s,a=t(this),h=a._point,c=l.read(arguments),d=e.peek(arguments),f=e.pick(d,!0);if("boolean"==typeof f)var m=h.add(c).divide(2),i=m.add(m.subtract(h).rotate(f?-90:90));else if(e.remain(arguments)<=2)i=c,c=l.read(arguments);else{var v=u.read(arguments);if(v.isZero())return this.lineTo(c);var y=e.read(arguments),f=!!e.read(arguments),w=!!e.read(arguments),m=h.add(c).divide(2),_=h.subtract(m).rotate(-y),x=_.x,b=_.y,S=Math.abs,T=S(v.width),P=S(v.height),E=T*T,k=P*P,O=x*x,M=b*b,R=Math.sqrt(O/E+M/k);if(R>1&&(T*=R,P*=R,E=T*T,k=P*P),R=(E*k-E*M-k*O)/(E*M+k*O),S(R)<1e-12&&(R=0),R<0)throw new Error("Cannot create an arc with the given arguments");n=new l(T*b/P,-P*x/T).multiply((w===f?-1:1)*Math.sqrt(R)).rotate(y).add(m),s=(new p).translate(n).rotate(y).scale(T,P),o=s._inverseTransform(h),r=o.getDirectedAngle(s._inverseTransform(c)),!f&&r>0?r-=360:f&&r<0&&(r+=360)}if(i){var I=new g(h.add(i).divide(2),i.subtract(h).rotate(90),!0),L=new g(i.add(c).divide(2),c.subtract(i).rotate(90),!0),N=new g(h,c),A=N.getSide(i);if(!(n=I.intersect(L,!0))){if(!A)return this.lineTo(c);throw new Error("Cannot create an arc with the given arguments")}o=h.subtract(n),r=o.getDirectedAngle(c.subtract(n));var D=N.getSide(n);0===D?r=A*Math.abs(r):A===D&&(r+=r<0?360:-360)}for(var z=Math.abs(r),H=z>=360?4:Math.ceil(z/90),B=r/H,F=B*Math.PI/360,$=4/3*Math.sin(F)/(1+Math.cos(F)),j=[],W=0;W<=H;W++){var _=c,q=null;if(W<H&&(q=o.rotate(90).multiply($),s?(_=s._transformPoint(o),q=s._transformPoint(o.add(q)).subtract(_)):_=n.add(o)),0===W)a.setHandleOut(q);else{var V=o.rotate(-90).multiply($);s&&(V=s._transformPoint(o.add(V)).subtract(_)),j.push(new C(_,V,q))}o=o.rotate(B)}this._add(j)},lineBy:function(){var e=l.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var i=l.read(arguments),n=l.read(arguments),r=e.read(arguments),o=t(this)._point;this.curveTo(o.add(i),o.add(n),r)},cubicCurveBy:function(){var e=l.read(arguments),i=l.read(arguments),n=l.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=l.read(arguments),i=l.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var i=t(this)._point,n=i.add(l.read(arguments)),r=e.pick(e.peek(arguments),!0);"boolean"==typeof r?this.arcTo(n,r):this.arcTo(n,i.add(l.read(arguments)))},closePath:function(t){this.setClosed(!0),t&&this.join()}}},{_getBounds:function(t,e){return M[t](this._segments,this._closed,this.getStyle(),e)},statics:{getBounds:function(t,e,i,n,r){function o(t){t._transformCoordinates(n,a,!1);for(var e=0;e<2;e++)E._addBounds(l[e],l[e+4],a[e+2],a[e],e,r?r[e]:0,h,u,c);var i=l;l=a,a=i}var s=t[0];if(!s)return new d;for(var a=new Array(6),l=s._transformCoordinates(n,new Array(6),!1),h=l.slice(0,2),u=h.slice(),c=new Array(2),f=1,p=t.length;f<p;f++)o(t[f]);return e&&o(s),new d(h[0],h[1],u[0]-h[0],u[1]-h[1])},getStrokeBounds:function(t,e,i,n){function r(t){f=f.include(n?n._transformPoint(t,t):t)}function o(t){f=f.unite(v.setCenter(n?n._transformPoint(t._point):t._point))}function s(t,e){var i=t._handleIn,n=t._handleOut;"round"===e||!i.isZero()&&!n.isZero()&&i.isCollinear(n)?o(t):M._addBevelJoin(t,e,h,m,r)}function a(t,e){"round"===e?o(t):M._addSquareCap(t,e,h,r)}if(!i.hasStroke())return M.getBounds(t,e,i,n);for(var l=t.length-(e?0:1),h=i.getStrokeWidth()/2,c=M._getPenPadding(h,n),f=M.getBounds(t,e,i,n,c),p=i.getStrokeJoin(),g=i.getStrokeCap(),m=h*i.getMiterLimit(),v=new d(new u(c).multiply(2)),y=1;y<l;y++)s(t[y],p);return e?s(t[0],p):l>0&&(a(t[0],g),a(t[t.length-1],g)),f},_getPenPadding:function(t,e){if(!e)return[t,t];var i=e.shiftless(),n=i.transform(new l(t,0)),r=i.transform(new l(0,t)),o=n.getAngleInRadians(),s=n.getLength(),a=r.getLength(),h=Math.sin(o),u=Math.cos(o),c=Math.tan(o),d=-Math.atan(a*c/s),f=Math.atan(a/(c*s));return[Math.abs(s*Math.cos(d)*u-a*Math.sin(d)*h),Math.abs(a*Math.sin(f)*u+s*Math.cos(f)*h)]},_addBevelJoin:function(t,e,i,n,r,o){var s=t.getCurve(),a=s.getPrevious(),h=s.getPointAt(0,!0),u=a.getNormalAt(1,!0),c=s.getNormalAt(0,!0),d=u.getDirectedAngle(c)<0?-i:i;if(u.setLength(d),c.setLength(d),o&&(r(h),r(h.add(u))),"miter"===e){var f=new g(h.add(u),new l(-u.y,u.x),!0).intersect(new g(h.add(c),new l(-c.y,c.x),!0),!0);if(f&&h.getDistance(f)<=n&&(r(f),!o))return}o||r(h.add(u)),r(h.add(c))},_addSquareCap:function(t,e,i,n,r){var o=t._point,s=t.getLocation(),a=s.getNormal().multiply(i);r&&(n(o.subtract(a)),n(o.add(a))),"square"===e&&(o=o.add(a.rotate(0===s.getParameter()?-90:90))),n(o.add(a)),n(o.subtract(a))},getHandleBounds:function(t,e,i,n,r,o){for(var s=new Array(6),a=Infinity,l=-a,h=a,u=l,c=0,f=t.length;c<f;c++){t[c]._transformCoordinates(n,s,!1);for(var p=0;p<6;p+=2){var g=0===p?o:r,m=g?g[0]:0,v=g?g[1]:0,y=s[p],w=s[p+1],_=y-m,x=y+m,b=w-v,S=w+v;_<a&&(a=_),x>l&&(l=x),b<h&&(h=b),S>u&&(u=S)}}return new d(a,h,l-a,u-h)},getRoughBounds:function(t,e,i,n){var r=i.hasStroke()?i.getStrokeWidth()/2:0,o=r;return r>0&&("miter"===i.getStrokeJoin()&&(o=r*i.getMiterLimit()),"square"===i.getStrokeCap()&&(o=Math.max(o,r*Math.sqrt(2)))),M.getHandleBounds(t,e,i,n,M._getPenPadding(r,n),M._getPenPadding(o,n))}}});M.inject({statics:new function(){function t(t,i,n){var r=e.getNamed(n),o=new M(r&&!1===r.insert&&y.NO_INSERT);return o._add(t),o._closed=i,o.set(r)}function i(e,i,n){for(var o=new Array(4),s=0;s<4;s++){var a=r[s];o[s]=new C(a._point.multiply(i).add(e),a._handleIn.multiply(i),a._handleOut.multiply(i))}return t(o,!0,n)}var n=.5522847498307936,r=[new C([-1,0],[0,n],[0,-n]),new C([0,-1],[-n,0],[n,0]),new C([1,0],[0,-n],[0,n]),new C([0,1],[n,0],[-n,0])];return{Line:function(){return t([new C(l.readNamed(arguments,"from")),new C(l.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=l.readNamed(arguments,"center"),n=e.readNamed(arguments,"radius");return i(t,new u(n),arguments)},Rectangle:function(){var e,i=d.readNamed(arguments,"rectangle"),r=u.readNamed(arguments,"radius",0,{readNull:!0}),o=i.getBottomLeft(!0),s=i.getTopLeft(!0),a=i.getTopRight(!0),l=i.getBottomRight(!0);if(!r||r.isZero())e=[new C(o),new C(s),new C(a),new C(l)];else{r=u.min(r,i.getSize(!0).divide(2));var h=r.width,c=r.height,f=h*n,p=c*n;e=[new C(o.add(h,0),null,[-f,0]),new C(o.subtract(0,c),[0,p]),new C(s.add(0,c),null,[0,-p]),new C(s.add(h,0),[-f,0],null),new C(a.subtract(h,0),null,[f,0]),new C(a.add(0,c),[0,-p],null),new C(l.subtract(0,c),null,[0,p]),new C(l.subtract(h,0),[f,0])]}return t(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=x._readEllipse(arguments);return i(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=l.readNamed(arguments,"from"),i=l.readNamed(arguments,"through"),n=l.readNamed(arguments,"to"),r=e.getNamed(arguments),o=new M(r&&!1===r.insert&&y.NO_INSERT);return o.moveTo(t),o.arcTo(i,n),o.set(r)},RegularPolygon:function(){for(var i=l.readNamed(arguments,"center"),n=e.readNamed(arguments,"sides"),r=e.readNamed(arguments,"radius"),o=360/n,s=!(n%3),a=new l(0,s?-r:r),h=s?-1:.5,u=new Array(n),c=0;c<n;c++)u[c]=new C(i.add(a.rotate((c+h)*o)));return t(u,!0,arguments)},Star:function(){for(var i=l.readNamed(arguments,"center"),n=2*e.readNamed(arguments,"points"),r=e.readNamed(arguments,"radius1"),o=e.readNamed(arguments,"radius2"),s=360/n,a=new l(0,-1),h=new Array(n),u=0;u<n;u++)h[u]=new C(i.add(a.rotate(s*u).multiply(u%2?o:r)));return t(h,!0,arguments)}}}});var R=O.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function e(i,n,r){for(var o=n.length-1;o>=0;o--){var s=n[o];s instanceof R&&(n.splice.apply(n,[o,1].concat(s.removeChildren())),s.remove())}n=e.base.call(this,i,n,r,M);for(var o=0,a=!r&&n&&n.length;o<a;o++){var s=n[o];s._clockwise===t&&s.setClockwise(0===s._index)}return n},reverse:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].reverse()},smooth:function(){for(var t=0,e=this._children.length;t<e;t++)this._children[t].smooth()},reduce:function t(){for(var e=this._children,i=e.length-1;i>=0;i--){var n=e[i].reduce();n.isEmpty()&&e.splice(i,1)}if(0===e.length){var n=new M(y.NO_INSERT);return n.insertAbove(this),n.setStyle(this._style),this.remove(),n}return t.base.call(this)},isClockwise:function(){var t=this.getFirstChild();return t&&t.isClockwise()},setClockwise:function(t){this.isClockwise()!==!!t&&this.reverse()},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getFirstCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e}},{beans:!0,getPathData:function(t,e){for(var i=this._children,n=[],r=0,o=i.length;r<o;r++){var s=i[r],a=s._matrix;n.push(s.getPathData(t&&!a.isIdentity()?t.chain(a):t,e))}return n.join(" ")}},{_getChildHitTestOptions:function(t){return t["class"]===M||"path"===t.type?t:new e(t,{fill:!1})},_draw:function(t,e,i){var n=this._children;if(0!==n.length){if(this._currentPath)t.currentPath=this._currentPath;else{e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var r=0,o=n.length;r<o;r++)n[r].draw(t,e,i);this._currentPath=t.currentPath}if(!e.clip){this._setStyles(t);var s=this._style;s.hasFill()&&(t.fill(s.getWindingRule()),t.shadowColor="rgba(0,0,0,0)"),s.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,o=n.length;r<o;r++){var s=n[r],a=s._matrix;i[s._id]||s._drawSelected(t,a.isIdentity()?e:e.chain(a))}}},new function(){function t(t,e){var i=t._children;if(e&&0===i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}var i={moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new M(y.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=l.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}};return e.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){i[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}
}),i});O.inject(new function(){function t(t,e){var i=t.clone(!1).reduce().transform(null,!0,!0);return e?i.resolveCrossings().reorient():i}function e(t,e,i,n,r){var o=new t(y.NO_INSERT);return o.addChildren(e,!0),r&&(o=o.reduce()),o.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),o.setStyle(i._style),o}function i(i,r,s){function a(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];f.push.apply(f,n._segments),p.push.apply(p,n._getMonoCurves())}}if(!i._children&&!i._closed)return n(i,r,s);var l=t(i,!0),c=r&&i!==r&&t(r,!0);c&&/^(subtract|exclude)$/.test(s)^c.isClockwise()!==l.isClockwise()&&c.reverse();var d=k.expand(l.getIntersections(c,function(t){return c&&t.isOverlap()||t.isCrossing()}));o(d);var f=[],p=[];a(l._children||[l]),c&&a(c._children||[c]);for(var g=0,m=d.length;g<m;g++)h(d[g]._segment,l,c,p,s);for(var g=0,m=f.length;g<m;g++){var v=f[g];null==v._winding&&h(v,l,c,p,s)}return e(R,u(f,s),i,r,!0)}function n(i,n,r){function o(t){if(a.contains(t.getPointAt(t.getLength()/2))^h)return u.unshift(t),!0}if(!n||!n._children&&!n._closed||!/^(subtract|intersect)$/.test(r))return null;for(var s=t(i,!1),a=t(n,!1),l=s.getIntersections(a,function(t){return t.isOverlap()||t.isCrossing()}),h="subtract"===r,u=[],c=l.length-1;c>=0;c--){var d=l[c].split();d&&(o(d)&&d.getFirstSegment().setHandleIn(0,0),s.getLastSegment().setHandleOut(0,0))}return o(s),e(w,u,i,n)}function r(t,e){for(var i=t;i;){if(i===e)return;i=i._prev}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._prev;)e=e._prev;t._next=e,e._prev=t}}function o(t){for(var e,i,n=4e-7,o=1-n,s=!1,a=[],l=t.length-1;l>=0;l--){var h=t[l],u=h._curve,c=h._parameter,d=c;u!==e?s=!u.hasHandles():i>0&&(c/=i);var f;c<n?f=u._segment1:c>o?f=u._segment2:(f=u.divide(c,!0,!0)._segment1,s&&a.push(f)),h._setSegment(f);var p=f._intersection,g=h._intersection;if(p){r(p,g);for(var m=p;m;)r(m._intersection,p),m=m._next}else f._intersection=g;e=u,i=d}for(var l=0,v=a.length;l<v;l++)a[l].clearHandles()}function a(t,e,i,n){var r=2e-7,o=4e-7,h=1-o,u=t.x,c=t.y,d=0,f=0,p=[],g=Math.abs;if(i){for(var m=-Infinity,v=Infinity,y=c-r,w=c+r,_=0,x=e.length;_<x;_++){var b=e[_].values;if(E.solveCubic(b,0,u,p,0,1)>0)for(var S=p.length-1;S>=0;S--){var T=E.getPoint(b,p[S]).y;T<y&&T>m?m=T:T>w&&T<v&&(v=T)}}m=(m+c)/2,v=(v+c)/2,m>-Infinity&&(d=a(new l(u,m),e,!1,n)),v<Infinity&&(f=a(new l(u,v),e,!1,n))}else for(var C,P,k=u-r,O=u+r,M=!1,_=0,x=e.length;_<x;_++){var R=e[_],b=R.values,I=R.winding;if(I&&(1===I&&c>=b[1]&&c<=b[7]||c>=b[7]&&c<=b[1])&&1===E.solveCubic(b,1,c,p,0,1)){var L=p[0];if(!(L>h&&M&&R.next!==e[_+1]||L<o&&P>h&&R.previous===C)){var N=E.getPoint(b,L).x,A=E.getTangent(b,L).y,D=!1;s.isZero(A)&&!E.isStraight(b)||L<o&&A*E.getTangent(R.previous.values,1).y<0||L>h&&A*E.getTangent(R.next.values,0).y<0?n&&N>=k&&N<=O&&(++d,++f,D=!0):N<=k?(d+=I,D=!0):N>=O&&(f+=I,D=!0),R.previous!==e[_-1]&&(M=L<o&&D)}C=R,P=L}}return Math.max(g(d),g(f))}function h(t,e,i,n,r){var o=2e-7,s=[],l=t,h=0,u=0;do{var c=t.getCurve(),d=c.getLength();s.push({segment:t,curve:c,length:d}),h+=d,t=t.getNext()}while(t&&!t._intersection&&t!==l);for(var f=0;f<3;f++)for(var d=h*(f+1)/4,p=0,g=s.length;p<g;p++){var m=s[p],v=m.length;if(d<=v){(d<o||v-d<o)&&(d=v/2);var c=m.curve,y=c._path,w=y._parent,_=c.getPointAt(d),x=c.isHorizontal();w instanceof R&&(y=w),u+="subtract"===r&&i&&(y===e&&i._getWinding(_,x)||y===i&&!e._getWinding(_,x))?0:a(_,n,x);break}d-=v}for(var b=Math.round(u/3),S=s.length-1;S>=0;S--)s[S].segment._winding=b}function u(t,e){function i(t,e){if(t._visited)return!1;if(!u)return!0;var i=t._winding,n=t._intersection;return n&&e&&d&&n.isOverlap()&&(i=d[i]||i),u(i)}function n(t){return t===a||t===l}function r(t,e){if(!t._next)return t;for(;t;){var r=t._segment,o=r.getNext(),s=o._intersection;if(n(o)||!r._visited&&!o._visited&&(!u||(!e||i(r))&&(!(e&&s&&s.isOverlap())&&i(o)||!e&&s&&i(s._segment))))return t;t=t._next}return null}function o(t,e){for(;t;){var i=t._segment;if(n(i))return i;t=t[e?"_next":"_prev"]}}for(var a,l,h=[],u=c[e],d={unite:{1:2},intersect:{2:1}}[e],f=0,p=t.length;f<p;f++){var g=t[f],m=null,v=!1;if(i(g,!0)){for(a=l=null;!v;){var w=g._intersection,_=m&&g._handleIn;w=w&&(r(w,!0)||r(w,!1))||w;var x=w&&w._segment;if(x&&i(x)&&(g=x),g._visited){if(!(v=n(g))&&w){var b=o(w,!0)||o(w,!1);b&&(g=b,v=!0)}break}m||(m=new M(y.NO_INSERT),a=g,l=x),m.add(new C(g._point,_,g._handleOut)),g._visited=!0,g=g.getNext(),v=n(g)}v?(m.firstSegment.setHandleIn(g._handleIn),m.setClosed(!0)):m&&(console.error("Boolean operation resulted in open path","segments =",m._segments.length,"length =",m.getLength()),m=null),m&&(m._segments.length>8||!s.isZero(m.getArea()))&&(h.push(m),m=null)}}return h}var c={unite:function(t){return 1===t||0===t},intersect:function(t){return 2===t},subtract:function(t){return 1===t},exclude:function(t){return 1===t}};return{_getWinding:function(t,e,i){return a(t,this._getMonoCurves(),e,i)},unite:function(t){return i(this,t,"unite")},intersect:function(t){return i(this,t,"intersect")},subtract:function(t){return i(this,t,"subtract")},exclude:function(t){return i(this,t,"exclude")},divide:function(t){return e(w,[this.subtract(t),this.intersect(t)],this,t,!0)},resolveCrossings:function(){var t=this.getCrossings();if(!t.length)return this;o(k.expand(t));for(var i=this._children||[this],n=[],r=0,s=i.length;r<s;r++)n.push.apply(n,i[r]._segments);return e(R,u(n),this,null,!1)}}}),M.inject({_getMonoCurves:function(){function t(t){var e=t[1],r=t[7],o={values:t,winding:e===r?0:e>r?-1:1,previous:i,next:null};i&&(i.next=o),n.push(o),i=o}function e(e){if(0!==E.getLength(e)){var i=e[1],n=e[3],r=e[5],o=e[7];if(E.isStraight(e))t(e);else{var a=3*(n-r)-i+o,l=2*(i+r)-4*n,h=n-i,u=4e-7,c=1-u,d=[],f=s.solveQuadratic(a,l,h,d,u,c);if(0===f)t(e);else{d.sort();var p=d[0],g=E.subdivide(e,p);t(g[0]),f>1&&(p=(d[1]-p)/(1-p),g=E.subdivide(g[1],p),t(g[0])),t(g[1])}}}}var i,n=this._monoCurves;if(!n){n=this._monoCurves=[];for(var r=this.getCurves(),o=this._segments,a=0,l=r.length;a<l;a++)e(r[a].getValues());if(!this._closed&&o.length>1){var h=o[o.length-1]._point,u=o[0]._point,c=h._x,d=h._y,f=u._x,p=u._y;e([c,d,c,d,f,p,f,p])}if(n.length>0){var g=n[0],m=n[n.length-1];g.previous=m,m.next=g}}return n},getInteriorPoint:function(){var t=this.getBounds(),e=t.getCenter(!0);if(!this.contains(e)){for(var i=this._getMonoCurves(),n=[],r=e.y,o=[],s=0,a=i.length;s<a;s++){var l=i[s].values;if((1===i[s].winding&&r>=l[1]&&r<=l[7]||r>=l[7]&&r<=l[1])&&E.solveCubic(l,1,r,n,0,1)>0)for(var h=n.length-1;h>=0;h--)o.push(E.getPoint(l,n[h]).x);if(o.length>1)break}e.x=(o[0]+o[1])/2}return e},reorient:function(){return this.setClockwise(!0),this}}),R.inject({_getMonoCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i]._getMonoCurves());return e},reorient:function(){var t=this.removeChildren().sort(function(t,e){return e.getBounds().getArea()-t.getBounds().getArea()});if(t.length>0){this.addChildren(t);for(var e=t[0].isClockwise(),i=1,n=t.length;i<n;i++){for(var r=t[i].getInteriorPoint(),o=0,s=i-1;s>=0;s--)t[s].contains(r)&&o++;t[i].setClockwise(o%2==0&&e)}}return this}});var I=e.extend({_class:"PathIterator",initialize:function(t,e,i,n){function r(t,e){var i=E.getValues(t,e,n);a.push(i),o(i,t._index,0,1)}function o(t,e,n,r){if(r-n>u&&!E.isFlatEnough(t,i||.25)){var s=E.subdivide(t,.5),a=(n+r)/2;o(s[0],e,n,a),o(s[1],e,a,r)}else{var c=t[6]-t[0],d=t[7]-t[1],f=Math.sqrt(c*c+d*d);f>1e-6&&(h+=f,l.push({offset:h,value:r,index:e}))}}for(var s,a=[],l=[],h=0,u=1/(e||32),c=t._segments,d=c[0],f=1,p=c.length;f<p;f++)s=c[f],r(d,s),d=s;t._closed&&r(s,c[0]),this.curves=a,this.parts=l,this.length=h,this.index=0},getParameterAt:function(t){for(var e,i=this.index;e=i,!(0==i||this.parts[--i].offset<t););for(var n=this.parts.length;e<n;e++){var r=this.parts[e];if(r.offset>=t){this.index=e;var o=this.parts[e-1],s=o&&o.index==r.index?o.value:0,a=o?o.offset:0;return{value:s+(r.value-s)*(t-a)/(r.offset-a),index:r.index}}}var r=this.parts[this.parts.length-1];return{value:1,index:r.index}},drawPart:function(t,e,i){e=this.getParameterAt(e),i=this.getParameterAt(i);for(var n=e.index;n<=i.index;n++){var r=E.getPart(this.curves[n],n==e.index?e.value:0,n==i.index?i.value:1);n==e.index&&t.moveTo(r[0],r[1]),t.bezierCurveTo.apply(t,r.slice(2))}}},e.each(E.evaluateMethods,function(t){this[t+"At"]=function(e,i){var n=this.getParameterAt(e);return E[t](this.curves[n.index],n.value,i)}},{})),L=e.extend({initialize:function(t,e){for(var i,n=this.points=[],r=t._segments,o=0,s=r.length;o<s;o++){var a=r[o].point.clone();i&&i.equals(a)||(n.push(a),i=a)}t._closed&&(this.closed=!0,n.unshift(n[n.length-1]),n.push(n[1])),this.error=e},fit:function(){var t=this.points,e=t.length,i=this.segments=e>0?[new C(t[0])]:[];return e>1&&this.fitCubic(0,e-1,t[1].subtract(t[0]).normalize(),t[e-2].subtract(t[e-1]).normalize()),this.closed&&(i.shift(),i.pop()),i},fitCubic:function(t,e,i,n){if(e-t==1){var r=this.points[t],o=this.points[e],s=r.getDistance(o)/3;return void this.addCurve([r,r.add(i.normalize(s)),o.add(n.normalize(s)),o])}for(var a,l=this.chordLengthParameterize(t,e),h=Math.max(this.error,this.error*this.error),u=!0,c=0;c<=4;c++){var d=this.generateBezier(t,e,l,i,n),f=this.findMaxError(t,e,d,l);if(f.error<this.error&&u)return void this.addCurve(d);if(a=f.index,f.error>=h)break;u=this.reparameterize(t,e,l,d),h=f.error}var p=this.points[a-1].subtract(this.points[a]),g=this.points[a].subtract(this.points[a+1]),m=p.add(g).divide(2).normalize();this.fitCubic(t,a,i,m),this.fitCubic(a,e,m.negate(),n)},addCurve:function(t){this.segments[this.segments.length-1].setHandleOut(t[1].subtract(t[0])),this.segments.push(new C(t[3],t[2].subtract(t[3])))},generateBezier:function(t,e,i,n,r){for(var o=1e-12,s=this.points[t],a=this.points[e],l=[[0,0],[0,0]],h=[0,0],u=0,c=e-t+1;u<c;u++){var d=i[u],f=1-d,p=3*d*f,g=f*f*f,m=p*f,v=p*d,y=d*d*d,w=n.normalize(m),_=r.normalize(v),x=this.points[t+u].subtract(s.multiply(g+m)).subtract(a.multiply(v+y));l[0][0]+=w.dot(w),l[0][1]+=w.dot(_),l[1][0]=l[0][1],l[1][1]+=_.dot(_),h[0]+=w.dot(x),h[1]+=_.dot(x)}var b,S,T=l[0][0]*l[1][1]-l[1][0]*l[0][1];if(Math.abs(T)>o){var C=l[0][0]*h[1]-l[1][0]*h[0];b=(h[0]*l[1][1]-h[1]*l[0][1])/T,S=C/T}else{var P=l[0][0]+l[0][1],E=l[1][0]+l[1][1];b=S=Math.abs(P)>o?h[0]/P:Math.abs(E)>o?h[1]/E:0}var k,O,M=a.getDistance(s),R=o*M;if(b<R||S<R)b=S=M/3;else{var I=a.subtract(s);k=n.normalize(b),O=r.normalize(S),k.dot(I)-O.dot(I)>M*M&&(b=S=M/3,k=O=null)}return[s,s.add(k||n.normalize(b)),a.add(O||r.normalize(S)),a]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);for(var r=1,o=i.length;r<o;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],o=0;o<=2;o++)n[o]=t[o+1].subtract(t[o]).multiply(3);for(var o=0;o<=1;o++)r[o]=n[o+1].subtract(n[o]).multiply(2);var s=this.evaluate(3,t,i),a=this.evaluate(2,n,i),l=this.evaluate(1,r,i),h=s.subtract(e),u=a.dot(a)+h.dot(l);return Math.abs(u)<1e-6?i:i-h.dot(a)/u},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var o=0;o<=t-r;o++)n[o]=n[o].multiply(1-i).add(n[o+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);for(var n=1,r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),o=0,s=t+1;s<e;s++){var a=this.evaluate(3,i,n[s-t]),l=a.subtract(this.points[s]),h=l.x*l.x+l.y*l.y;h>=o&&(o=h,r=s)}return{error:o,index:r}}}),N=y.extend({_class:"TextItem",_boundsSelected:!0,_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function(i){this._content="",this._lines=[];var n=i&&e.isPlainObject(i)&&i.x===t&&i.y===t;this._initialize(n&&i,!n&&l.read(arguments))},_equals:function(t){return this._content===t._content},_clone:function t(e,i,n){return e.setContent(this._content),t.base.call(this,e,i,n)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),A=N.extend({_class:"PointText",initialize:function(){N.apply(this,arguments)},clone:function(t){return this._clone(new A(y.NO_INSERT),t)},getPoint:function(){var t=this._matrix.getTranslation();return new h(t.x,t.y,this,"setPoint")},setPoint:function(){var t=l.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t){if(this._content){this._setStyles(t);var e=this._style,i=this._lines,n=e.getLeading(),r=t.shadowColor;t.font=e.getFontStyle(),t.textAlign=e.getJustification();for(var o=0,s=i.length;o<s;o++){t.shadowColor=r;var a=i[o];e.hasFill()&&(t.fillText(a,0,0),t.shadowColor="rgba(0,0,0,0)"),e.hasStroke()&&t.strokeText(a,0,0),t.translate(0,n)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,o=i.getJustification(),s=i.getLeading(),a=this.getView().getTextWidth(i.getFontStyle(),n),l=0;"left"!==o&&(l-=a/("center"===o?2:1));var h=new d(l,r?-.75*s:0,a,r*s);return e?e._transformBounds(h,h):h}}),D=e.extend(new function(){function t(t){var e,n=t.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(n){e=[0,0,0];for(var r=0;r<3;r++){var o=n[r+1];e[r]=parseInt(1==o.length?o+o:o,16)/255}}else if(n=t.match(/^rgba?\((.*)\)$/)){e=n[1].split(",");for(var r=0,a=e.length;r<a;r++){var o=+e[r];e[r]=r<3?o/255:o}}else{var l=s[t];if(!l){i||(i=Y.getContext(1,1),i.globalCompositeOperation="copy"),i.fillStyle="rgba(0,0,0,0)",i.fillStyle=t,i.fillRect(0,0,1,1);var h=i.getImageData(0,0,1,1).data;l=s[t]=[h[0]/255,h[1]/255,h[2]/255]}e=l.slice()}return e}var i,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},r={},s={},h=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],u={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),o=n-r;return[0===o?0:60*(n==t?(e-i)/o+(e<i?6:0):n==e?(i-t)/o+2:(t-e)/o+4),0===n?0:o/n,n]},"hsb-rgb":function(t,e,i){t=(t/60%6+6)%6;var n=Math.floor(t),r=t-n,n=h[n],o=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[o[n[0]],o[n[1]],o[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),o=n-r,s=0===o,a=s?0:60*(n==t?(e-i)/o+(e<i?6:0):n==e?(i-t)/o+2:(t-e)/o+4),l=(n+r)/2;return[a,s?0:l<.5?o/(n+r):o/(2-n-r),l]},"hsl-rgb":function(t,e,i){if(t=(t/360%1+1)%1,0===e)return[i,i,i];for(var n=[t+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,o=2*i-r,s=[],a=0;a<3;a++){var l=n[a];l<0&&(l+=1),l>1&&(l-=1),s[a]=6*l<1?o+6*(r-o)*l:2*l<1?r:3*l<2?o+(r-o)*(2/3-l)*6:o}return s},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return e.each(n,function(t,i){r[i]=[],e.each(t,function(t,o){var s=e.capitalize(t),a=/^(hue|saturation)$/.test(t),h=r[i][o]="gradient"===t?function(t){var e=this._components[0];return t=z.read(Array.isArray(t)?t:arguments,0,{readNull:!0}),e!==t&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===i?function(){return l.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+s]=function(){return this._type===i||a&&/^hs[bl]$/.test(this._type)?this._components[o]:this._convert(i)[o]},this["set"+s]=function(t){this._type===i||a&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(i),this._properties=n[i],this._type=i),this._components[o]=h.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function e(i){var o,s,l,h,u=Array.prototype.slice,c=arguments,d=0;Array.isArray(i)&&(c=i,i=c[0]);var f=null!=i&&typeof i;if("string"===f&&i in n&&(o=i,i=c[1],Array.isArray(i)?(s=i,l=c[2]):(this.__read&&(d=1),c=u.call(c,1),f=typeof i)),!s){if(h="number"===f?c:"object"===f&&null!=i.length?i:null){o||(o=h.length>=3?"rgb":"gray");var p=n[o].length;l=h[p],this.__read&&(d+=h===arguments?p+(null!=l?1:0):1),h.length>p&&(h=u.call(h,0,p))}else if("string"===f)o="rgb",s=t(i),4===s.length&&(l=s[3],s.length--);else if("object"===f)if(i.constructor===e){if(o=i._type,s=i._components.slice(),l=i._alpha,"gradient"===o)for(var g=1,m=s.length;g<m;g++){var v=s[g];v&&(s[g]=v.clone())}}else if(i.constructor===z)o="gradient",h=c;else{o="hue"in i?"lightness"in i?"hsl":"hsb":"gradient"in i||"stops"in i||"radial"in i?"gradient":"gray"in i?"gray":"rgb";var y=n[o],w=r[o];this._components=s=[];for(var g=0,m=y.length;g<m;g++){var _=i[y[g]];null==_&&0===g&&"gradient"===o&&"stops"in i&&(_={stops:i.stops,radial:i.radial}),_=w[g].call(this,_),null!=_&&(s[g]=_)}l=i.alpha}this.__read&&o&&(d=1)}if(this._type=o||"rgb",this._id=a.get(e),!s){this._components=s=[];for(var w=r[this._type],g=0,m=w.length;g<m;g++){var _=w[g].call(this,h&&h[g]);null!=_&&(s[g]=_)}}this._components=s,this._properties=n[this._type],this._alpha=l,this.__read&&(this.__read=d)},_serialize:function(t,i){var n=this.getComponents();return e.serialize(/^(gray|rgb)$/.test(this._type)?n:[this._type].concat(n),t,!0,i)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=u[this._type+"-"+t])?e.apply(this,this._components):u["rgb-"+t].apply(this,u[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new D(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var i=e.isPlainValue(t,!0)?D.read(arguments):t;return i===this||i&&this._class===i._class&&this._type===i._type&&this._alpha===i._alpha&&e.equals(this._components,i._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=o.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(i?a:n.number(a)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){function e(t){return Math.round(255*(t<0?0:t>1?1:t))}var i=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;return i=[e(i[0]),e(i[1]),e(i[2])],n<1&&i.push(n<0?0:n),t?"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).slice(1):(4==i.length?"rgba(":"rgb(")+i.join(",")+")"},toCanvasStyle:function(t){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var e,i=this._components,n=i[0],r=n._stops,o=i[1],s=i[2];if(n._radial){var a=s.getDistance(o),l=i[3];if(l){var h=l.subtract(o);h.getLength()>a&&(l=o.add(h.normalize(a-.1)))}var u=l||o;e=t.createRadialGradient(u.x,u.y,0,o.x,o.y,a)}else e=t.createLinearGradient(o.x,o.y,s.x,s.y);for(var c=0,d=r.length;c<d;c++){var f=r[c];e.addColorStop(f._rampPoint,f._color.toCanvasStyle())}return this._canvasStyle=e},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new D(t(),t(),t())}}})},new function(){var t={add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}};return e.each(t,function(t,e){this[e]=function(e){e=D.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),o=0,s=n.length;o<s;o++)r[o]=t(n[o],r[o]);return new D(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),z=e.extend({_class:"Gradient",initialize:function(t,e){this._id=a.get(),t&&this._set(t)&&(t=e=null),this._stops||this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,i){return i.add(this,function(){return e.serialize([this._stops,this._radial],t,!0,i)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(e){var i=this._owners?this._owners.indexOf(e):-1;-1!=i&&(this._owners.splice(i,1),0===this._owners.length&&(this._owners=t))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new z(t,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(this.stops)for(var i=0,n=this._stops.length;i<n;i++)this._stops[i]._owner=t;if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=H.readAll(e,0,{clone:!0});for(var i=0,n=this._stops.length;i<n;i++){var r=this._stops[i];r._owner=this,r._defaultRamp&&r.setRampPoint(i/(n-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class&&this._stops.length===t._stops.length){for(var e=0,i=this._stops.length;e<i;e++)if(!this._stops[e].equals(t._stops[e]))return!1;return!0}return!1}}),H=e.extend({_class:"GradientStop",initialize:function(e,i){if(e){var n,r;i===t&&Array.isArray(e)?(n=e[0],r=e[1]):e.color?(n=e.color,r=e.rampPoint):(n=e,r=i),this.setColor(n),this.setRampPoint(r)}},clone:function(){return new H(this._color.clone(),this._rampPoint)},_serialize:function(t,i){return e.serialize([this._color,this._rampPoint],t,!0,i)},_changed:function(){this._owner&&this._owner._changed(65)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(t){this._defaultRamp=null==t,this._rampPoint=t||0,this._changed()},getColor:function(){return this._color},setColor:function(t){this._color=D.read(arguments),this._color===t&&(this._color=t.clone()),this._color._owner=this,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._rampPoint==t._rampPoint||!1}}),B=e.extend(new function(){var i={fillColor:t,strokeColor:t,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:t,shadowBlur:0,shadowOffset:new l,selectedColor:t,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"},n={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},r={beans:!0},o={_defaults:i,_textDefaults:new e(i,{fillColor:new D}),beans:!0};return e.each(i,function(i,s){var a=/Color$/.test(s),h="shadowOffset"===s,u=e.capitalize(s),c=n[s],d="set"+u,f="get"+u;o[d]=function(e){var i=this._owner,n=i&&i._children;if(n&&n.length>0&&!(i instanceof R))for(var r=0,o=n.length;r<o;r++)n[r]._style[d](e);else{var l=this._values[s];l!==e&&(a&&(l&&(l._owner=t),e&&e.constructor===D&&(e._owner&&(e=e.clone()),e._owner=i)),this._values[s]=e,i&&i._changed(c||65))}},o[f]=function(i){var n,r=this._owner,o=r&&r._children;if(!o||0===o.length||i||r instanceof R){var n=this._values[s];if(n===t)(n=this._defaults[s])&&n.clone&&(n=n.clone());else{var u=a?D:h?l:null;!u||n&&n.constructor===u||(this._values[s]=n=u.read([n],0,{readNull:!0,clone:!0}),n&&a&&(n._owner=r))}return n}for(var c=0,d=o.length;c<d;c++){var p=o[c]._style[f]();if(0===c)n=p;else if(!e.equals(n,p))return t}return n},r[f]=function(t){return this._style[f](t)},r[d]=function(t){this._style[d](t)}}),y.inject(r),o},{_class:"Style",initialize:function(t,e,i){this._values={},this._owner=e,this._project=e&&e._project||i||paper.project,e instanceof N&&(this._defaults=this._textDefaults),t&&this.set(t)},set:function(t){var e=t instanceof B,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){return t===this||t&&this._class===t._class&&e.equals(this._values,t._values)||!1},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getView:function(){return this._project.getView()},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),F=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],o=e[0].toUpperCase()+e.substring(1),s=0;s<6;s++){var a=r[s],l=a?a+o:e;if(l in t){if(!i)return t[l];t[l]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,o=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var s=i.left-(o.clientLeft||r.clientLeft||0),a=i.top-(o.clientTop||r.clientTop||0);if(!e){var l=n.defaultView;s+=l.pageXOffset||o.scrollLeft||r.scrollLeft,a+=l.pageYOffset||o.scrollTop||r.scrollTop}return new d(s,a,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new d(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return F.getBounds(t,e).getPoint()},getSize:function(t){return F.getBounds(t,!0).getSize()},isInvisible:function(t){return F.getSize(t).equals(new u(0,0))},isInView:function(t){return!F.isInvisible(t)&&F.getViewportBounds(t).intersects(F.getBounds(t,!0))},getPrefixed:function(e,i){return t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},$={add:function(t,e){for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),o=0,s=r.length;o<s;o++)t.addEventListener(r[o],n,!1)},remove:function(t,e){for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),o=0,s=r.length;o<s;o++)t.removeEventListener(r[o],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new l(e.pageX||e.clientX+document.documentElement.scrollLeft,e.pageY||e.clientY+document.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return $.getPoint(t).subtract(F.getOffset(e||$.getTarget(t)))},stop:function(t){t.stopPropagation(),t.preventDefault()}};$.requestAnimationFrame=new function(){function t(){for(var e=o.length-1;e>=0;e--){var a=o[e],l=a[0],h=a[1];(!h||("true"==n.getAttribute(h,"keepalive")||s)&&F.isInView(h))&&(o.splice(e,1),l())}i&&(o.length?i(t):r=!1)}var e,i=F.getPrefixed(window,"requestAnimationFrame"),r=!1,o=[],s=!0;return $.add(window,{focus:function(){s=!0},blur:function(){s=!1}}),function(n,s){o.push([n,s]),i?r||(i(t),r=!0):e||(e=setInterval(t,1e3/60))}};var j=e.extend(i,{_class:"View",initialize:function t(e,i){function r(t){return i[t]||parseInt(i.getAttribute(t),10)}function o(){var t=F.getSize(i);return t.isNaN()||t.isZero()?new u(r("width"),r("height")):t}this._project=e,this._scope=e._scope,this._element=i;var s;this._pixelRatio||(this._pixelRatio=window.devicePixelRatio||1),this._id=i.getAttribute("id"),null==this._id&&i.setAttribute("id",this._id="view-"+t._id++),$.add(i,this._viewEvents);var a="none";if(F.setPrefixed(i.style,{userSelect:a,touchAction:a,touchCallout:a,contentZooming:a,userDrag:a,tapHighlightColor:"rgba(0,0,0,0)"}),n.hasAttribute(i,"resize")){var l=this;$.add(window,this._windowEvents={resize:function(){l.setViewSize(o())}})}if(this._setViewSize(s=o()),n.hasAttribute(i,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var h=this._stats.domElement,c=h.style,d=F.getOffset(i);c.position="absolute",c.left=d.x+"px",c.top=d.y+"px",document.body.appendChild(h)}t._views.push(this),t._viewsById[this._id]=this,this._viewSize=s,(this._matrix=new p)._owner=this,this._zoom=1,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0},remove:function(){return!!this._project&&(j._focused===this&&(j._focused=null),j._views.splice(j._views.indexOf(this),1),delete j._viewsById[this._id],this._project._view===this&&(this._project._view=null),$.remove(this._element,this._viewEvents),$.remove(window,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0)},_events:e.each(["onResize","onMouseDown","onMouseUp","onMouseMove"],function(t){this[t]={install:function(t){this._installEvent(t)},uninstall:function(t){this._uninstallEvent(t)}}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,_requestFrame:function(){var t=this;$.requestAnimationFrame(function(){t._requested=!1,t._animate&&(t._requestFrame(),t._handleFrame())},this._element),this._requested=!0},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,i=this._before?t-this._before:0;this._before=t,this._handlingFrame=!0,this.emit("frame",new e({delta:i,time:this._time+=i,count:this._count++})),this._stats&&this._stats.update(),this._handlingFrame=!1,this.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var i in this._frameItems){var n=this._frameItems[i];n.item.emit("frame",new e(t,{time:n.time+=t.delta,count:n.count++}))}},_update:function(){this._project._needsUpdate=!0,this._handlingFrame||(this._animate?this._handleFrame():this.update())},_changed:function(t){1&t&&(this._project._needsUpdate=!0)},_transform:function(t){this._matrix.concatenate(t),this._bounds=null,this._update()},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new c(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=u.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._viewSize.set(t.width,t.height),this._setViewSize(t),this._bounds=null,this.emit("resize",{size:t,delta:e}),this._update())},_setViewSize:function(t){var e=this._element;e.width=t.width,e.height=t.height},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new d(new l,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=l.read(arguments);this.scrollBy(t.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(t){this._transform((new p).scale(t/this._zoom,this.getCenter())),this._zoom=t},isVisible:function(){return F.isInView(this._element)},scrollBy:function(){this._transform((new p).translate(l.read(arguments).negate()))},play:function(){this._animate=!0,this._requested||this._requestFrame()},pause:function(){this._animate=!1},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(l.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(l.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return"string"==typeof e&&(e=document.getElementById(e)),new W(t,e)}}},new function(){function t(t){var e=$.getTarget(t);return e.getAttribute&&j._viewsById[e.getAttribute("id")]}function e(t,e){return t.viewToProject($.getOffset(e,t._element))}function i(){if(!j._focused||!j._focused.isVisible())for(var t=0,e=j._views.length;t<e;t++){var i=j._views[t];if(i&&i.isVisible()){j._focused=s=i;break}}}function n(t,e,i){t._handleEvent("mousemove",e,i);var n=t._scope.tool;return n&&n._handleEvent(u&&n.responds("mousedrag")?"mousedrag":"mousemove",e,i),t.update(),n}var r,o,s,a,l,h,u=!1,c=window.navigator;c.pointerEnabled||c.msPointerEnabled?(a="pointerdown MSPointerDown",l="pointermove MSPointerMove",h="pointerup pointercancel MSPointerUp MSPointerCancel"):(a="touchstart",l="touchmove",h="touchend touchcancel","ontouchstart"in window&&c.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(a+=" mousedown",l+=" mousemove",h+=" mouseup"));var d={"selectstart dragstart":function(t){u&&t.preventDefault()}},f={mouseout:function(t){
var i=j._focused,r=$.getRelatedTarget(t);!i||r&&"HTML"!==r.nodeName||n(i,e(i,t),t)},scroll:i};d[a]=function(i){var n=j._focused=t(i),o=e(n,i);u=!0,n._handleEvent("mousedown",o,i),(r=n._scope.tool)&&r._handleEvent("mousedown",o,i),n.update()},f[l]=function(a){var l=j._focused;if(!u){var h=t(a);h?(l!==h&&n(l,e(l,a),a),o=l,l=j._focused=s=h):s&&s===l&&(l=j._focused=o,i())}if(l){var c=e(l,a);(u||l.getBounds().contains(c))&&(r=n(l,c,a))}},f[h]=function(t){var i=j._focused;if(i&&u){var n=e(i,t);u=!1,i._handleEvent("mouseup",n,t),r&&r._handleEvent("mouseup",n,t),i.update()}},$.add(document,f),$.add(window,{load:i});var p={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:d,_handleEvent:function(){},_installEvent:function(t){var e=this._eventCounters;if(e)for(var i in p)e[i]=(e[i]||0)+(p[i][t]||0)},_uninstallEvent:function(t){var e=this._eventCounters;if(e)for(var i in p)e[i]-=p[i][t]||0},statics:{updateFocus:i}}}),W=j.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof HTMLCanvasElement)){var i=u.read(arguments,1);if(i.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));e=Y.getCanvas(i)}if(this._context=e.getContext("2d"),this._eventCounters={},this._pixelRatio=1,!/^off|false$/.test(n.getAttribute(e,"hidpi"))){var r=window.devicePixelRatio||1,o=F.getPrefixed(this._context,"backingStorePixelRatio")||1;this._pixelRatio=r/o}j.call(this,t,e)},_setViewSize:function(t){var e=this._element,i=this._pixelRatio,r=t.width,o=t.height;if(e.width=r*i,e.height=o*i,1!==i){if(!n.hasAttribute(e,"resize")){var s=e.style;s.width=r+"px",s.height=o+"px"}this._context.scale(i,i)}},getPixelSize:function(t){var e,i=paper.browser;if(i&&i.firefox){var n=this._element.parentNode,r=document.createElement("div");r.style.fontSize=t,n.appendChild(r),e=parseFloat(F.getStyles(r).fontSize),n.removeChild(r)}else{var o=this._context,s=o.font;o.font=t+" serif",e=parseFloat(o.font),o.font=s}return e},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var o=0,s=e.length;o<s;o++)r=Math.max(r,i.measureText(e[o]).width);return i.font=n,r},update:function(t){var e=this._project;if(!e||!t&&!e._needsUpdate)return!1;var i=this._context,n=this._viewSize;return i.clearRect(0,0,n.width+1,n.height+1),e.draw(i,this._matrix,this._pixelRatio),e._needsUpdate=!1,!0}},new function(){function t(t,e,i,n,r,o){function s(t){if(t.responds(e)&&(a||(a=new G(e,i,n,r,o?n.subtract(o):null)),t.emit(e,a)&&a.isStopped))return i.preventDefault(),!0}for(var a,l=r;l;){if(s(l))return!0;l=l.getParent()}return!!s(t)}var e,i,n,r,o,s,a,l,h;return{_handleEvent:function(u,c,d){if(this._eventCounters[u]){var f=this._project,p=f.hitTest(c,{tolerance:0,fill:!0,stroke:!0}),g=p&&p.item,m=!1;switch(u){case"mousedown":for(m=t(this,u,d,c,g),l=o==g&&Date.now()-h<300,r=o=g,e=i=n=c,a=!m&&g;a&&!a.responds("mousedrag");)a=a._parent;break;case"mouseup":m=t(this,u,d,c,g,e),a&&(i&&!i.equals(c)&&t(this,"mousedrag",d,c,a,i),g!==a&&(n=c,t(this,"mousemove",d,c,g,n))),!m&&g&&g===r&&(h=Date.now(),t(this,l&&r.responds("doubleclick")?"doubleclick":"click",d,e,g),l=!1),r=a=null;break;case"mousemove":a&&(m=t(this,"mousedrag",d,c,a,i)),m||(g!==s&&(n=c),m=t(this,u,d,c,g,n)),i=n=c,g!==s&&(t(this,"mouseleave",d,c,s),s=g,t(this,"mouseenter",d,c,g))}return m}}}}),q=e.extend({_class:"Event",initialize:function(t){this.event=t},isPrevented:!1,isStopped:!1,preventDefault:function(){this.isPrevented=!0,this.event.preventDefault()},stopPropagation:function(){this.isStopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return U.modifiers}}),V=q.extend({_class:"KeyEvent",initialize:function(t,e,i,n){q.call(this,n),this.type=t?"keydown":"keyup",this.key=e,this.character=i},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),U=new function(){function t(n,o,h,u){var c,d=h?String.fromCharCode(h):"",f=r[o],p=f||d.toLowerCase(),g=n?"keydown":"keyup",m=j._focused,v=m&&m.isVisible()&&m._scope,y=v&&v.tool;if(l[p]=n,n?a[o]=h:delete a[o],f&&(c=e.camelize(f))in s){s[c]=n;var w=paper.browser;if("command"===c&&w&&w.mac)if(n)i={};else{for(var _ in i)_ in a&&t(!1,_,i[_],u);i=null}}else n&&i&&(i[o]=h);y&&y.responds(g)&&(paper=v,y.emit(g,new V(n,p,d,u)),m&&m.update())}var i,n,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},o={9:!0,13:!0,32:!0},s=new e({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),a={},l={};return $.add(document,{keydown:function(e){var i=e.which||e.keyCode;i in r||s.command?t(!0,i,i in o||s.command?i:0,e):n=i},keypress:function(e){null!=n&&(t(!0,n,e.which||e.keyCode,e),n=null)},keyup:function(e){var i=e.which||e.keyCode;i in a&&t(!1,i,a[i],e)}}),$.add(window,{blur:function(e){for(var i in a)t(!1,i,a[i],e)}}),{modifiers:s,isDown:function(t){return!!l[t]}}},G=q.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){q.call(this,e),this.type=t,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Z=q.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),X=(r.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function(t){r.call(this),this._firstMove=!0,this._count=0,this._downCount=0,this._set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_updateEvent:function(t,e,i,n,r,o,s){if(!r){if(null!=i||null!=n){var a=null!=i?i:0,l=e.subtract(this._point),h=l.getLength();if(h<a)return!1;if(null!=n&&0!=n)if(h>n)e=this._point.add(l.normalize(n));else if(s)return!1}if(o&&e.equals(this._point))return!1}switch(this._lastPoint=r&&"mousemove"==t?e:this._point,this._point=e,t){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=r?0:this._count+1,!0},_fireEvent:function(t,e){var i=paper.project._removeSets;if(i){"mouseup"===t&&(i.mousedrag=null);var n=i[t];if(n){for(var r in n){var o=n[r];for(var s in i){var a=i[s];a&&a!=n&&delete a[o._id]}o.remove()}i[t]=null}}return this.responds(t)&&this.emit(t,new Z(this,t,e))},_handleEvent:function(t,e,i){paper=this._scope;var n=!1;switch(t){case"mousedown":this._updateEvent(t,e,null,null,!0,!1,!1),n=this._fireEvent(t,i);break;case"mousedrag":for(var r=!1,o=!1;this._updateEvent(t,e,this.minDistance,this.maxDistance,!1,r,o);)n=this._fireEvent(t,i)||n,r=!0,o=!0;break;case"mouseup":!e.equals(this._point)&&this._updateEvent("mousedrag",e,this.minDistance,this.maxDistance,!1,!1,!1)&&(n=this._fireEvent("mousedrag",i)),this._updateEvent(t,e,null,this.maxDistance,!1,!1,!1),n=this._fireEvent(t,i)||n,this._updateEvent(t,e,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(t,e,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)n=this._fireEvent(t,i)||n,this._firstMove=!1}return n&&i.preventDefault(),n}}),{request:function(e,i,n,r){r=r===t||r;var o=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return o.open(e.toUpperCase(),i,r),"overrideMimeType"in o&&o.overrideMimeType("text/plain"),o.onreadystatechange=function(){if(4===o.readyState){var t=o.status;if(0!==t&&200!==t)throw new Error("Could not load "+i+" (Error "+t+")");n.call(o,o.responseText)}},o.send(null)}}),Y={canvases:[],getCanvas:function(t,e){var i,n=!0;"object"==typeof t&&(e=t.height,t=t.width),i=this.canvases.length?this.canvases.pop():document.createElement("canvas");var r=i.getContext("2d");return i.width===t&&i.height===e?n&&r.clearRect(0,0,t+1,e+1):(i.width=t,i.height=e),r.save(),i},getContext:function(t,e){return this.getCanvas(t,e).getContext("2d")},release:function(t){var e=t.canvas?t.canvas:t;e.getContext("2d").restore(),this.canvases.push(e)}},K=new function(){function t(t,e,i){return.2989*t+.587*e+.114*i}function i(e,i,n,r){var o=r-t(e,i,n);f=e+o,p=i+o,g=n+o;var r=t(f,p,g),s=m(f,p,g),a=v(f,p,g);if(s<0){var l=r-s;f=r+(f-r)*r/l,p=r+(p-r)*r/l,g=r+(g-r)*r/l}if(a>255){var h=255-r,u=a-r;f=r+(f-r)*h/u,p=r+(p-r)*h/u,g=r+(g-r)*h/u}}function n(t,e,i){return v(t,e,i)-m(t,e,i)}function r(t,e,i,n){var r,o=[t,e,i],s=v(t,e,i),a=m(t,e,i);a=a===t?0:a===e?1:2,s=s===t?0:s===e?1:2,r=0===m(a,s)?1===v(a,s)?2:1:0,o[s]>o[a]?(o[r]=(o[r]-o[a])*n/(o[s]-o[a]),o[s]=n):o[r]=o[s]=0,o[a]=0,f=o[0],p=o[1],g=o[2]}var o,s,a,l,h,u,c,d,f,p,g,m=Math.min,v=Math.max,y=Math.abs,w={multiply:function(){f=h*o/255,p=u*s/255,g=c*a/255},screen:function(){f=h+o-h*o/255,p=u+s-u*s/255,g=c+a-c*a/255},overlay:function(){f=h<128?2*h*o/255:255-2*(255-h)*(255-o)/255,p=u<128?2*u*s/255:255-2*(255-u)*(255-s)/255,g=c<128?2*c*a/255:255-2*(255-c)*(255-a)/255},"soft-light":function(){var t=o*h/255;f=t+h*(255-(255-h)*(255-o)/255-t)/255,t=s*u/255,p=t+u*(255-(255-u)*(255-s)/255-t)/255,t=a*c/255,g=t+c*(255-(255-c)*(255-a)/255-t)/255},"hard-light":function(){f=o<128?2*o*h/255:255-2*(255-o)*(255-h)/255,p=s<128?2*s*u/255:255-2*(255-s)*(255-u)/255,g=a<128?2*a*c/255:255-2*(255-a)*(255-c)/255},"color-dodge":function(){f=0===h?0:255===o?255:m(255,255*h/(255-o)),p=0===u?0:255===s?255:m(255,255*u/(255-s)),g=0===c?0:255===a?255:m(255,255*c/(255-a))},"color-burn":function(){f=255===h?255:0===o?0:v(0,255-255*(255-h)/o),p=255===u?255:0===s?0:v(0,255-255*(255-u)/s),g=255===c?255:0===a?0:v(0,255-255*(255-c)/a)},darken:function(){f=h<o?h:o,p=u<s?u:s,g=c<a?c:a},lighten:function(){f=h>o?h:o,p=u>s?u:s,g=c>a?c:a},difference:function(){f=h-o,f<0&&(f=-f),p=u-s,p<0&&(p=-p),(g=c-a)<0&&(g=-g)},exclusion:function(){f=h+o*(255-h-h)/255,p=u+s*(255-u-u)/255,g=c+a*(255-c-c)/255},hue:function(){r(o,s,a,n(h,u,c)),i(f,p,g,t(h,u,c))},saturation:function(){r(h,u,c,n(o,s,a)),i(f,p,g,t(h,u,c))},luminosity:function(){i(h,u,c,t(o,s,a))},color:function(){i(o,s,a,t(h,u,c))},add:function(){f=m(h+o,255),p=m(u+s,255),g=m(c+a,255)},subtract:function(){f=v(h-o,0),p=v(u-s,0),g=v(c-a,0)},average:function(){f=(h+o)/2,p=(u+s)/2,g=(c+a)/2},negation:function(){f=255-y(255-o-h),p=255-y(255-s-u),g=255-y(255-a-c)}},_=this.nativeModes=e.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),x=Y.getContext(1,1);e.each(w,function(t,e){var i="darken"===e,n=!1;x.save();try{x.fillStyle=i?"#300":"#a00",x.fillRect(0,0,1,1),x.globalCompositeOperation=e,x.globalCompositeOperation===e&&(x.fillStyle=i?"#a00":"#300",x.fillRect(0,0,1,1),n=x.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}x.restore(),_[e]=n}),Y.release(x),this.process=function(t,e,i,n,r){var m=e.canvas,v="normal"===t;if(v||_[t])i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=n,v||(i.globalCompositeOperation=t),i.drawImage(m,r.x,r.y),i.restore();else{var y=w[t];if(!y)return;for(var x=i.getImageData(r.x,r.y,m.width,m.height),b=x.data,S=e.getImageData(0,0,m.width,m.height).data,T=0,C=b.length;T<C;T+=4){o=S[T],h=b[T],s=S[T+1],u=b[T+1],a=S[T+2],c=b[T+2],l=S[T+3],d=b[T+3],y();var P=l*n/255,E=1-P;b[T]=P*f+E*h,b[T+1]=P*p+E*u,b[T+2]=P*g+E*c,b[T+3]=l*n+E*d}i.putImageData(x,r.x,r.y)}}},J=e.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{"true":"none","false":"non-scaling-stroke"},function(t,e){return!e&&(t instanceof O||t instanceof x||t instanceof N)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(t,i){var n=e.capitalize(i),r=t[2];this[i]={type:t[1],property:i,attribute:t[0],toSVG:r,fromSVG:r&&e.each(r,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+n,set:"set"+n}},{}),Q={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};return new function(){function t(t,e){for(var i in e){var n=e[i],r=Q[i];"number"==typeof n&&(n=b.number(n)),r?t.setAttributeNS(r,i,n):t.setAttribute(i,n)}return t}function i(e,i){return t(document.createElementNS("http://www.w3.org/2000/svg",e),i)}function n(t,i,n){var r=new e,o=t.getTranslation();if(i){t=t.shiftless();var a=t._inverseTransform(o);r[n?"cx":"x"]=a.x,r[n?"cy":"y"]=a.y,o=null}if(!t.isIdentity()){var l=t.decompose();if(l&&!l.shearing){var h=[],u=l.rotation,c=l.scaling;o&&!o.isZero()&&h.push("translate("+b.point(o)+")"),s.isZero(c.x-1)&&s.isZero(c.y-1)||h.push("scale("+b.point(c)+")"),u&&h.push("rotate("+b.number(u)+")"),r.transform=h.join(" ")}else r.transform="matrix("+t.getValues().join(",")+")"}return r}function r(e,r){for(var o=n(e._matrix),s=e._children,a=i("g",o),l=0,h=s.length;l<h;l++){var u=s[l],c=_(u,r);if(c)if(u.isClipMask()){var d=i("clipPath");d.appendChild(c),v(u,d,"clip"),t(a,{"clip-path":"url(#"+d.id+")"})}else a.appendChild(c)}return a}function a(t,e){var r=n(t._matrix,!0),o=t.getSize(),s=t.getImage();return r.x-=o.width/2,r.y-=o.height/2,r.width=o.width,r.height=o.height,r.href=!1===e.embedImages&&s&&s.src||t.toDataURL(),i("image",r)}function l(t,e){var r=e.matchShapes;if(r){var o=t.toShape(!1);if(o)return h(o,e)}var s,a=t._segments,l=n(t._matrix);if(0===a.length)return null;if(r&&!t.hasHandles())if(a.length>=3){s=t._closed?"polygon":"polyline";for(var u=[],c=0,d=a.length;c<d;c++)u.push(b.point(a[c]._point));l.points=u.join(" ")}else{s="line";var f=a[0]._point,p=a[a.length-1]._point;l.set({x1:f.x,y1:f.y,x2:p.x,y2:p.y})}else s="path",l.d=t.getPathData(null,e.precision);return i(s,l)}function h(t){var e=t._type,r=t._radius,o=n(t._matrix,!0,"rectangle"!==e);if("rectangle"===e){e="rect";var s=t._size,a=s.width,l=s.height;o.x-=a/2,o.y-=l/2,o.width=a,o.height=l,r.isZero()&&(r=null)}return r&&("circle"===e?o.r=r:(o.rx=r.width,o.ry=r.height)),i(e,o)}function u(t,e){var r=n(t._matrix),o=t.getPathData(null,e.precision);return o&&(r.d=o),i("path",r)}function c(t,e){var r=n(t._matrix,!0),o=t.getSymbol(),s=g(o,"symbol"),a=o.getDefinition(),l=a.getBounds();return s||(s=i("symbol",{viewBox:b.rectangle(l)}),s.appendChild(_(a,e)),v(o,s,"symbol")),r.href="#"+s.id,r.x+=l.x,r.y+=l.y,r.width=b.number(l.width),r.height=b.number(l.height),r.overflow="visible",i("use",r)}function d(t){var e=g(t,"color");if(!e){var n,r=t.getGradient(),o=r._radial,s=t.getOrigin().transform(),a=t.getDestination().transform();if(o){n={cx:s.x,cy:s.y,r:s.getDistance(a)};var l=t.getHighlight();l&&(l=l.transform(),n.fx=l.x,n.fy=l.y)}else n={x1:s.x,y1:s.y,x2:a.x,y2:a.y};n.gradientUnits="userSpaceOnUse",e=i((o?"radial":"linear")+"Gradient",n);for(var h=r._stops,u=0,c=h.length;u<c;u++){var d=h[u],f=d._color,p=f.getAlpha();n={offset:d._rampPoint,"stop-color":f.toCSS(!0)},p<1&&(n["stop-opacity"]=p),e.appendChild(i("stop",n))}v(t,e,"color")}return"url(#"+e.id+")"}function f(t){var e=i("text",n(t._matrix,!0));return e.textContent=t._content,e}function p(i,n,r){var o={},s=!r&&i.getParent();return null!=i._name&&(o.id=i._name),e.each(J,function(t){var n=t.get,r=t.type,a=i[n]();if(t.exportFilter?t.exportFilter(i,a):!s||!e.equals(s[n](),a)){if("color"===r&&null!=a){var l=a.getAlpha();l<1&&(o[t.attribute+"-opacity"]=l)}o[t.attribute]=null==a?"none":"number"===r?b.number(a):"color"===r?a.gradient?d(a,i):a.toCSS(!0):"array"===r?a.join(","):"lookup"===r?t.toSVG[a]:a}}),1===o.opacity&&delete o.opacity,i._visible||(o.visibility="hidden"),t(n,o)}function g(t,e){return S||(S={ids:{},svgs:{}}),t&&S.svgs[e+"-"+t._id]}function v(t,e,i){S||g();var n=S.ids[i]=(S.ids[i]||0)+1;e.id=i+"-"+n,S.svgs[i+"-"+t._id]=e}function w(t,e){var n=t,r=null;if(S){n="svg"===t.nodeName.toLowerCase()&&t;for(var o in S.svgs)r||(n||(n=i("svg"),n.appendChild(t)),r=n.insertBefore(i("defs"),n.firstChild)),r.appendChild(S.svgs[o]);S=null}return e.asString?(new XMLSerializer).serializeToString(n):n}function _(t,e,i){var n=T[t._class],r=n&&n(t,e);if(r){var o=e.onExport;o&&(r=o(t,r,e)||r);var s=JSON.stringify(t._data);s&&"{}"!==s&&"null"!==s&&r.setAttribute("data-paper-data",s)}return r&&p(t,r,i)}function x(t){return t||(t={}),b=new o(t.precision),t}var b,S,T={Group:r,Layer:r,Raster:a,Path:l,Shape:h,CompoundPath:u,PlacedSymbol:c,PointText:f};y.inject({exportSVG:function(t){return t=x(t),w(_(this,t,!0),t)}}),m.inject({exportSVG:function(t){t=x(t);var e=this.layers,r=this.getView(),o=r.getViewSize(),s=i("svg",{x:0,y:0,width:o.width,height:o.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),a=s,l=r._matrix;l.isIdentity()||(a=s.appendChild(i("g",n(l))));for(var h=0,u=e.length;h<u;h++)a.appendChild(_(e[h],t,!0));return w(s,t)}})},new function(){function i(t,e,i,n){var r=Q[e],o=r?t.getAttributeNS(r,e):t.getAttribute(e);return"null"===o&&(o=null),null==o?n?null:i?"":0:i?o:parseFloat(o)}function n(t,e,n,r){return e=i(t,e,!1,r),n=i(t,n,!1,r),!r||null!=e&&null!=n?new l(e,n):null}function r(t,e,n,r){return e=i(t,e,!1,r),n=i(t,n,!1,r),!r||null!=e&&null!=n?new u(e,n):null}function o(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?T(t)||t:"lookup"===e?i[t]:t}function s(t,e,i,n){var r=t.childNodes,o="clippath"===e,s=new w,a=s._project,l=a._currentStyle,h=[];if(o||(s=S(s,t,n),a._currentStyle=s._style.clone()),n)for(var u=t.querySelectorAll("defs"),c=0,d=u.length;c<d;c++)C(u[c],i,!1);for(var c=0,d=r.length;c<d;c++){var f,p=r[c];1!==p.nodeType||"defs"===p.nodeName.toLowerCase()||!(f=C(p,i,!1))||f instanceof v||h.push(f)}return s.addChildren(h),o&&(s=S(s.reduce(),t,n)),a._currentStyle=l,(o||"defs"===e)&&(s.remove(),s=null),s}function a(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,o=i.length;r<o;r+=2)n.push(new l(parseFloat(i[r]),parseFloat(i[r+1])));var s=new M(n);return"polygon"===e&&s.closePath(),s}function h(t){var e=t.getAttribute("d"),i={pathData:e};return(e.match(/m/gi)||[]).length>1||/z\S+/i.test(e)?new R(i):new M(i)}function c(t,e){var r,o=(i(t,"href",!0)||"").substring(1),s="radialgradient"===e;if(o)r=k[o].getGradient();else{for(var a=t.childNodes,l=[],h=0,u=a.length;h<u;h++){var c=a[h];1===c.nodeType&&l.push(S(new H,c))}r=new z(l,s)}var d,f,p;return s?(d=n(t,"cx","cy"),f=d.add(i(t,"r"),0),p=n(t,"fx","fy",!0)):(d=n(t,"x1","y1"),f=n(t,"x2","y2")),S(new D(r,d,f,p),t),null}function f(t,e,i,n){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),o=new p,s=0,a=r.length;s<a;s++){var l=r[s];if(!l)break;for(var h=l.split(/\(\s*/),u=h[0],c=h[1].split(/[\s,]+/g),d=0,f=c.length;d<f;d++)c[d]=parseFloat(c[d]);switch(u){case"matrix":o.concatenate(new p(c[0],c[1],c[2],c[3],c[4],c[5]));break;case"rotate":o.rotate(c[0],c[1],c[2]);break;case"translate":o.translate(c[0],c[1]);break;case"scale":o.scale(c);break;case"skewX":o.skew(c[0],0);break;case"skewY":o.skew(0,c[0])}}t.transform(o)}function g(t,e,i){var n=t["fill-opacity"===i?"getFillColor":"getStrokeColor"]();n&&n.setAlpha(parseFloat(e))}function _(i,n,r){var o=i.attributes[n],s=o&&o.value;if(!s){var a=e.camelize(n);s=i.style[a],s||r.node[a]===r.parent[a]||(s=r.node[a])}return s?"none"===s?null:s:t}function S(i,n,r){var o={node:F.getStyles(n)||{},parent:!r&&F.getStyles(n.parentNode)||{}};return e.each(E,function(r,s){var a=_(n,s,o);a!==t&&(i=e.pick(r(i,a,s,n,o),i))}),i}function T(t){var e=t&&t.match(/\((?:#|)([^)']+)/);return e&&k[e[1]]}function C(t,i,n){function r(t){paper=s;var e=C(t,i,n),r=i.onLoad,o=s.project&&s.getView();r&&r.call(this,e),o.update()}if(!t)return null;i?"function"==typeof i&&(i={onLoad:i}):i={};var o=t,s=paper;if(n)if("string"!=typeof t||/^.*</.test(t)){if("undefined"!=typeof File&&t instanceof File){var a=new FileReader;return a.onload=function(){r(a.result)},a.readAsText(t)}}else{if(!(o=document.getElementById(t)))return X.request("get",t,r);t=null}if("string"==typeof t&&(o=(new DOMParser).parseFromString(t,"image/svg+xml")),!o.nodeName)throw new Error("Unsupported SVG source: "+t);var l,h=o.nodeName.toLowerCase(),u=P[h],c=o.getAttribute&&o.getAttribute("data-paper-data"),d=s.settings,f=d.applyMatrix;if(d.applyMatrix=!1,l=u&&u(o,h,i,n)||null,d.applyMatrix=f,l){"#document"===h||l instanceof w||(l=S(l,o,n));var p=i.onImport;p&&(l=p(o,l,i)||l),i.expandShapes&&l instanceof x&&(l.remove(),l=l.toPath()),c&&(l._data=JSON.parse(c))}return n&&(k={},l&&e.pick(i.applyMatrix,f)&&l.matrix.apply(!0,!0)),l}var P={"#document":function(t,e,i,n){for(var r=t.childNodes,o=0,s=r.length;o<s;o++){var a=r[o];if(1===a.nodeType){var l=a.nextSibling;document.body.appendChild(a);var h=C(a,i,n);return l?t.insertBefore(a,l):t.appendChild(a),h}}},g:s,svg:s,clippath:s,polygon:a,polyline:a,path:h,lineargradient:c,radialgradient:c,image:function(t){var e=new b(i(t,"href",!0));return e.on("load",function(){var e=r(t,"width","height");this.setSize(e);var i=this._matrix._transformPoint(n(t,"x","y").add(e.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new v(s(t,e,i,n),!0)},defs:s,use:function(t){var e=(i(t,"href",!0)||"").substring(1),r=k[e],o=n(t,"x","y");return r?r instanceof v?r.place(o):r.clone().translate(o):null},circle:function(t){return new x.Circle(n(t,"cx","cy"),i(t,"r"))},ellipse:function(t){return new x.Ellipse({center:n(t,"cx","cy"),radius:r(t,"rx","ry")})},rect:function(t){var e=n(t,"x","y"),i=r(t,"width","height"),o=r(t,"rx","ry");return new x.Rectangle(new d(e,i),o)},line:function(t){return new M.Line(n(t,"x1","y1"),n(t,"x2","y2"))},text:function(t){var e=new A(n(t,"x","y").add(n(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}},E=e.set(e.each(J,function(t){this[t.attribute]=function(e,i){if(e[t.set](o(i,t.type,t.fromSVG)),"color"===t.type&&e instanceof x){var n=e[t.get]();n&&n.transform((new p).translate(e.getPosition(!0).negate()))}}},{}),{id:function(t,e){k[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=T(e);if(i){if(i=i.clone(),i.setClipMask(!0),!(t instanceof w))return new w(i,t);t.insertChild(0,i)}},gradientTransform:f,transform:f,"fill-opacity":g,"stroke-opacity":g,visibility:function(t,e){t.setVisible("visible"===e)},display:function(t,e){t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){var i=e.match(/(.*)%$/);t.setRampPoint(i?i[1]/100:parseFloat(e))},viewBox:function(t,e,i,n,s){var a=new d(o(e,"array")),l=r(n,"width","height",!0);if(t instanceof w){var h=l?a.getSize().divide(l):1,u=(new p).translate(a.getPoint()).scale(h);t.transform(u.inverted())}else if(t instanceof v){l&&a.setSize(l);var c="visible"!=_(n,"overflow",s),f=t._definition;c&&!a.contains(f.getBounds())&&(c=new x.Rectangle(a).transform(f._matrix),c.setClipMask(!0),f.addChild(c))}}}),k={};y.inject({importSVG:function(t,e){return this.addChild(C(t,e,!0))}}),m.inject({importSVG:function(t,e){return this.activate(),C(t,e,!0)}})},paper=new(n.inject(e.exports,{enumerable:!0,Base:e,Numerical:s,Key:U})),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper};!function(t){"use strict";function e(){var e=t(this),i=f(e);e.is(".fixed-top, .fixed-bottom, .horizontal-percent")?e.css("min-height",m(i.first)+m(i.last)+t(i.divider).height()+"px"):e.css("min-width",v(i.first)+v(i.last)+t(i.divider).width()+"px")}function i(e){e.preventDefault();var i=t(this),r=i.parent(),o=i.siblings(".split-pane-resize-shim");o.show(),i.addClass("dragged"),e.type.match(/^touch/)&&i.addClass("touch");var a=s(r,p(e),g(e));t(document).on("touchmove mousemove",a),t(document).one("touchend mouseup",function(){t(document).off("touchmove mousemove",a),i.removeClass("dragged touch"),o.hide(),r.trigger("dividerdragend",[n(r)])}),r.trigger("dividerdragstart",[n(r)]),window.dispatchEvent(new Event("resize"))}function n(t){var e=t.is(".fixed-top, .fixed-bottom, .horizontal-percent")?"height":"width";return{firstComponentSize:t.find(".split-pane-component:first")[e](),lastComponentSize:t.find(".split-pane-component:last")[e]()}}function r(){var e=t(this),i=o(e),n=e.parent().closest(".split-pane")[0]||window;t(n).on(n===window?"resize":"splitpaneresize",function(t){(t.target===document?window:t.target)===n&&i(t)})}function o(t){var e=f(t);return t.is(".fixed-top")?function(){var i=m(e.last),n=e.splitPane.offsetHeight-i-e.divider.offsetHeight;e.first.offsetHeight>n&&_(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".fixed-bottom")?function(){var i=m(e.first),n=e.splitPane.offsetHeight-i-e.divider.offsetHeight;e.last.offsetHeight>n&&x(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".horizontal-percent")?function(){var i=m(e.last),n=m(e.first),r=e.splitPane.offsetHeight-n-e.divider.offsetHeight;e.last.offsetHeight>r?x(e,r/e.splitPane.offsetHeight*100+"%"):e.splitPane.offsetHeight-e.first.offsetHeight-e.divider.offsetHeight<i&&x(e,i/e.splitPane.offsetHeight*100+"%"),t.trigger("splitpaneresize")}:t.is(".fixed-left")?function(){var i=v(e.last),n=e.splitPane.offsetWidth-i-e.divider.offsetWidth;e.first.offsetWidth>n&&b(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".fixed-right")?function(){var i=v(e.first),n=e.splitPane.offsetWidth-i-e.divider.offsetWidth;e.last.offsetWidth>n&&S(e,n+"px"),t.trigger("splitpaneresize")}:t.is(".vertical-percent")?function(){var i=v(e.last),n=v(e.first),r=e.splitPane.offsetWidth-n-e.divider.offsetWidth;e.last.offsetWidth>r?S(e,r/e.splitPane.offsetWidth*100+"%"):e.splitPane.offsetWidth-e.first.offsetWidth-e.divider.offsetWidth<i&&S(e,i/e.splitPane.offsetWidth*100+"%"),t.trigger("splitpaneresize")}:void 0}function s(t,e,i){var n=f(t);return t.is(".fixed-top")?a(n,i):t.is(".fixed-bottom")?l(n,i):t.is(".horizontal-percent")?h(n,i):t.is(".fixed-left")?u(n,e):t.is(".fixed-right")?c(n,e):t.is(".vertical-percent")?d(n,e):void 0}function a(e,i){var n=m(e.first),r=e.splitPane.offsetHeight-m(e.last)-e.divider.offsetHeight,o=e.divider.offsetTop-i;return function(i){i.preventDefault&&i.preventDefault();var s=y(n,r,o+g(i));_(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function l(e,i){var n=m(e.last),r=e.splitPane.offsetHeight-m(e.first)-e.divider.offsetHeight,o=e.last.offsetHeight+i;return function(i){i.preventDefault&&i.preventDefault();var s=Math.min(Math.max(n,o-g(i)),r);x(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function h(e,i){var n=e.splitPane.offsetHeight,r=m(e.last),o=n-m(e.first)-e.divider.offsetHeight,s=e.last.offsetHeight+i;return function(i){i.preventDefault&&i.preventDefault();var a=Math.min(Math.max(r,s-g(i)),o);x(e,a/n*100+"%"),t(e.splitPane).trigger("splitpaneresize")}}function u(e,i){var n=v(e.first),r=e.splitPane.offsetWidth-v(e.last)-e.divider.offsetWidth,o=e.divider.offsetLeft-i;return function(i){i.preventDefault&&i.preventDefault();var s=w(n,r,o+p(i));b(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function c(e,i){var n=v(e.last),r=e.splitPane.offsetWidth-v(e.first)-e.divider.offsetWidth,o=e.last.offsetWidth+i;return function(i){i.preventDefault&&i.preventDefault();var s=Math.min(Math.max(n,o-p(i)),r);S(e,s+"px"),t(e.splitPane).trigger("splitpaneresize")}}function d(e,i){var n=e.splitPane.offsetWidth,r=v(e.last),o=n-v(e.first)-e.divider.offsetWidth,s=e.last.offsetWidth+i;return function(i){i.preventDefault&&i.preventDefault();var a=Math.min(Math.max(r,s-p(i)),o);S(e,a/n*100+"%"),t(e.splitPane).trigger("splitpaneresize")}}function f(t){return{splitPane:t[0],first:t.children(".split-pane-component:first")[0],divider:t.children(".split-pane-divider")[0],last:t.children(".split-pane-component:last")[0]}}function p(t){return t.pageX!==undefined?t.pageX:t.originalEvent.pageX!==undefined?t.originalEvent.pageX:t.originalEvent.touches?t.originalEvent.touches[0].pageX:void 0}function g(t){return t.pageY!==undefined?t.pageY:t.originalEvent.pageY!==undefined?t.originalEvent.pageY:t.originalEvent.touches?t.originalEvent.touches[0].pageY:void 0}function m(e){return parseInt(t(e).css("min-height"),10)||0}function v(e){return parseInt(t(e).css("min-width"),10)||0}function y(t,e,i){return Math.min(Math.max(t,i),e)}function w(t,e,i){return Math.min(Math.max(t,i),e)}function _(t,e){t.first.style.height=e,t.divider.style.top=e,t.last.style.top=e}function x(t,e){t.first.style.bottom=e,t.divider.style.bottom=e,t.last.style.height=e}function b(t,e){t.first.style.width=e,t.divider.style.left=e,t.last.style.left=e}function S(t,e){t.first.style.right=e,t.divider.style.right=e,t.last.style.width=e}var T={};T.init=function(){var n=this;n.each(e),n.append('<div class="split-pane-resize-shim">'),n.children(".split-pane-divider").html('<div class="split-pane-divider-inner"></div>'),n.children(".split-pane-divider").on("touchstart mousedown",i),setTimeout(function(){n.each(r),t(window).trigger("resize")},100)},T.firstComponentSize=function(e){this.each(function(){var i=t(this),n=f(i);i.is(".fixed-top")?a(n,n.divider.offsetTop)({pageY:e}):i.is(".fixed-bottom")?(e=n.splitPane.offsetHeight-n.divider.offsetHeight-e,l(n,-n.last.offsetHeight)({pageY:-e})):i.is(".horizontal-percent")?(e=n.splitPane.offsetHeight-n.divider.offsetHeight-e,h(n,-n.last.offsetHeight)({pageY:-e})):i.is(".fixed-left")?u(n,n.divider.offsetLeft)({pageX:e}):i.is(".fixed-right")?(e=n.splitPane.offsetWidth-n.divider.offsetWidth-e,c(n,-n.last.offsetWidth)({pageX:-e})):i.is(".vertical-percent")&&(e=n.splitPane.offsetWidth-n.divider.offsetWidth-e,d(n,-n.last.offsetWidth)({pageX:-e}))})},T.lastComponentSize=function(e){this.each(function(){var i=t(this),n=f(i);i.is(".fixed-top")?(e=n.splitPane.offsetHeight-n.divider.offsetHeight-e,a(n,n.divider.offsetTop)({pageY:e})):i.is(".fixed-bottom")?l(n,-n.last.offsetHeight)({pageY:-e}):i.is(".horizontal-percent")?h(n,-n.last.offsetHeight)({pageY:-e}):i.is(".fixed-left")?(e=n.splitPane.offsetWidth-n.divider.offsetWidth-e,u(n,n.divider.offsetLeft)({pageX:e})):i.is(".fixed-right")?c(n,-n.last.offsetWidth)({pageX:-e}):i.is(".vertical-percent")&&d(n,-n.last.offsetWidth)({pageX:-e})})},t.fn.splitPane=function(e){T[e||"init"].apply(this,t.grep(arguments,function(t,e){return e>0}))}}(jQuery),function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";var e={autoSelfClosers:{
area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},i={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1};t.defineMode("xml",function(n,r){function o(t,e){function i(i){return e.tokenize=i,i(t,e)}var n=t.next();if("<"==n)return t.eat("!")?t.eat("[")?t.match("CDATA[")?i(l("atom","]]>")):null:t.match("--")?i(l("comment","-->")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),i(h(1))):null:t.eat("?")?(t.eatWhile(/[\w\._\-]/),e.tokenize=l("meta","?>"),"meta"):(P=t.eat("/")?"closeTag":"openTag",e.tokenize=s,"tag bracket");if("&"==n){var r;return r=t.eat("#")?t.eat("x")?t.eatWhile(/[a-fA-F\d]/)&&t.eat(";"):t.eatWhile(/[\d]/)&&t.eat(";"):t.eatWhile(/[\w\.\-:]/)&&t.eat(";"),r?"atom":"error"}return t.eatWhile(/[^&<]/),null}function s(t,e){var i=t.next();if(">"==i||"/"==i&&t.eat(">"))return e.tokenize=o,P=">"==i?"endTag":"selfcloseTag","tag bracket";if("="==i)return P="equals",null;if("<"==i){e.tokenize=o,e.state=f,e.tagName=e.tagStart=null;var n=e.tokenize(t,e);return n?n+" tag error":"tag error"}return/[\'\"]/.test(i)?(e.tokenize=a(i),e.stringStartCol=t.column(),e.tokenize(t,e)):(t.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function a(t){var e=function(e,i){for(;!e.eol();)if(e.next()==t){i.tokenize=s;break}return"string"};return e.isInAttribute=!0,e}function l(t,e){return function(i,n){for(;!i.eol();){if(i.match(e)){n.tokenize=o;break}i.next()}return t}}function h(t){return function(e,i){for(var n;null!=(n=e.next());){if("<"==n)return i.tokenize=h(t+1),i.tokenize(e,i);if(">"==n){if(1==t){i.tokenize=o;break}return i.tokenize=h(t-1),i.tokenize(e,i)}}return"meta"}}function u(t,e,i){this.prev=t.context,this.tagName=e,this.indent=t.indented,this.startOfLine=i,(S.doNotIndent.hasOwnProperty(e)||t.context&&t.context.noIndent)&&(this.noIndent=!0)}function c(t){t.context&&(t.context=t.context.prev)}function d(t,e){for(var i;;){if(!t.context)return;if(i=t.context.tagName,!S.contextGrabbers.hasOwnProperty(i)||!S.contextGrabbers[i].hasOwnProperty(e))return;c(t)}}function f(t,e,i){return"openTag"==t?(i.tagStart=e.column(),p):"closeTag"==t?g:f}function p(t,e,i){return"word"==t?(i.tagName=e.current(),E="tag",y):(E="error",p)}function g(t,e,i){if("word"==t){var n=e.current();return i.context&&i.context.tagName!=n&&S.implicitlyClosed.hasOwnProperty(i.context.tagName)&&c(i),i.context&&i.context.tagName==n||!1===S.matchClosing?(E="tag",m):(E="tag error",v)}return E="error",v}function m(t,e,i){return"endTag"!=t?(E="error",m):(c(i),f)}function v(t,e,i){return E="error",m(t,e,i)}function y(t,e,i){if("word"==t)return E="attribute",w;if("endTag"==t||"selfcloseTag"==t){var n=i.tagName,r=i.tagStart;return i.tagName=i.tagStart=null,"selfcloseTag"==t||S.autoSelfClosers.hasOwnProperty(n)?d(i,n):(d(i,n),i.context=new u(i,n,r==i.indented)),f}return E="error",y}function w(t,e,i){return"equals"==t?_:(S.allowMissing||(E="error"),y(t,e,i))}function _(t,e,i){return"string"==t?x:"word"==t&&S.allowUnquoted?(E="string",y):(E="error",y(t,e,i))}function x(t,e,i){return"string"==t?x:y(t,e,i)}var b=n.indentUnit,S={},T=r.htmlMode?e:i;for(var C in T)S[C]=T[C];for(var C in r)S[C]=r[C];var P,E;return o.isInText=!0,{startState:function(t){var e={tokenize:o,state:f,indented:t||0,tagName:null,tagStart:null,context:null};return null!=t&&(e.baseIndent=t),e},token:function(t,e){if(!e.tagName&&t.sol()&&(e.indented=t.indentation()),t.eatSpace())return null;P=null;var i=e.tokenize(t,e);return(i||P)&&"comment"!=i&&(E=null,e.state=e.state(P||i,t,e),E&&(i="error"==E?i+" error":E)),i},indent:function(e,i,n){var r=e.context;if(e.tokenize.isInAttribute)return e.tagStart==e.indented?e.stringStartCol+1:e.indented+b;if(r&&r.noIndent)return t.Pass;if(e.tokenize!=s&&e.tokenize!=o)return n?n.match(/^(\s*)/)[0].length:0;if(e.tagName)return!1!==S.multilineTagIndentPastTag?e.tagStart+e.tagName.length+2:e.tagStart+b*(S.multilineTagIndentFactor||1);if(S.alignCDATA&&/<!\[CDATA\[/.test(i))return 0;var a=i&&/^<(\/)?([\w_:\.-]*)/.exec(i);if(a&&a[1])for(;r;){if(r.tagName==a[2]){r=r.prev;break}if(!S.implicitlyClosed.hasOwnProperty(r.tagName))break;r=r.prev}else if(a)for(;r;){var l=S.contextGrabbers[r.tagName];if(!l||!l.hasOwnProperty(a[2]))break;r=r.prev}for(;r&&r.prev&&!r.startOfLine;)r=r.prev;return r?r.indent+b:e.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:S.htmlMode?"html":"xml",helperType:S.htmlMode?"html":"xml",skipAttribute:function(t){t.state==_&&(t.state=y)}}}),t.defineMIME("text/xml","xml"),t.defineMIME("application/xml","xml"),t.mimeModes.hasOwnProperty("text/html")||t.defineMIME("text/html",{name:"xml",htmlMode:!0})});var TextLab={};TextLab.NarrativeStep=Backbone.Model.extend({urlRoot:"narrative_steps"}),TextLab.NarrativeStepCollection=Backbone.Collection.extend({model:TextLab.NarrativeStep,url:"narrative_steps"}),TextLab.Sequence=Backbone.Model.extend({initialize:function(t){this.afterLoad(t)},url:function(){return"/sequences/"+this.id+".json?p=true"},afterLoad:function(t){t&&t.narrative_steps?this.narrativeSteps=new TextLab.NarrativeStepCollection(t.narrative_steps):this.narrativeSteps=new TextLab.NarrativeStepCollection},sync:function(t,e,i){if(this.afterLoad&&("read"==t||"create"==t))if(i.success){var n=i.success;i.success=_.bind(function(t){this.afterLoad(t),n(t)},this)}else i.success=_.bind(this.afterLoad,this);this.beforeSave&&"update"==t&&this.beforeSave(),Backbone.sync(t,e,i)}}),TextLab.SequenceCollection=Backbone.Collection.extend({model:TextLab.Sequence,url:"/sequences"}),function(){this.JST||(this.JST={}),this.JST["tl-viewer/templates/empty-sequence-panel"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<h4><a href=\"#\" class='back-to-list-link'>Sequences for Leaf</a> / ",name," by username</h4>\n\n<p>There are no steps for this sequence. Click <a href=\"#\" class='back-to-list-link'>here</a> to return to the sequence list.</p> \n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["tl-viewer/templates/sequence-grid-panel"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<h4><a href=\"#\" class='back-to-list-link'>Sequences for Leaf</a> / ",name," by ",owner,'</h4>\n\n<table id="sequence-grid" class="table">\n  <tr>\n    <th>Step #</th>\n    <th>Step</th>\n    <th>Narrative</th>\n  </tr>\n  '),_.each(steps,function(t){__p.push("\n    <tr>\n      <td class='step-number'>\n        <button\n          data-step-number='",t.step_number,"'\n          class='btn btn-default goto-step-button ",t.step_number==currentStep?"active":"","'\n          href='#' >\n            ",t.step_number+1,"\n        </button>\n      </td>\n      <td class='step-column'>",t.step,"</td>\n      <td class='narrative-column'>",t.narrative,"</td>\n    </tr>\n  ")}),__p.push("\n</table>\n<div class='actions'>\n    <button class='btn btn-default toggle-grid-button' href='#' >Show First Step</button>\n</div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["tl-viewer/templates/sequence-list-panel"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div id='sequence-list'>\n\t<h4>Sequences for Leaf</h4>\n\t<ul>\n\t\t"),_.each(sequences,function(t){__p.push("\n\t\t\t<li><a href='#' class='sequence-link' data-sequence-id='",t.id,"'>",t.name,"</a> by ",t.owner_name,".</li>\n\t\t")}),__p.push("\n\t</ul>\n</div>\n<div id='sequence-panel'></div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["tl-viewer/templates/step-sequence-panel"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("<h4><a href=\"#\" class='back-to-list-link'>Sequences for Leaf</a> / ",name," by ",owner," (Step ",stepNumber+1," of ",maxSteps,') </h4>\n\n<table id="sequence-grid" class="table">\n  <tr>\n    <th>Step #</th>\n    <th>Step</th>\n    <th>Narrative</th>\n  </tr>\n  <tr>\n    <td class=\'step-number\'>',step.step_number+1,"</td>\n    <td class='step-column'>",step.step,"</td>\n    <td class='narrative-column'>",step.narrative,"</td>\n  </tr>\n</table>\n<div class='actions'>\n    <button class='btn btn-default toggle-grid-button' href='#' >Show All Steps</button>\n    <button class='btn btn-default prev-step-button' href='#' ><i class=\"fa fa-caret-left\" aria-hidden=\"true\"></i>  Previous Step</button>\n    ");for(var i=0;i<maxSteps;i++)__p.push("\n      <button data-step-number='",i,"' class='btn btn-default goto-step-button ",i==stepNumber?"active":"","' href='#' >",i+1,"</button>\n    ");__p.push("\n    <button class='btn btn-primary next-step-button' href='#' >Next Step <i class=\"fa fa-caret-right\" aria-hidden=\"true\"></i></button>\n</div>\n")}return __p.join("")}}.call(this),TextLab.BasePanel=Backbone.View.extend({id:"base-panel",render:function(){this.deleteDels(),this.fixCarets()},fixCarets:function(){var t=this.$("span");_.each(t,function(t){$(t).removeClass("caret")})},deleteDels:function(){var t=this.$(".metamark");_.each(t,function(t){$(t).detach()});var e=this.$(".del"),i=this.$(".restore > .del");_.each(e,function(t){_.contains(i,t)||$(t).detach()})}}),TextLab.DiplomaticPanel=Backbone.View.extend({id:"diplomatic-panel",syncScroll:!0,lastScrollPosition:0,maxScrollPosition:0,imagePanel:null,marginBuffer:2,popoverAttachmentPoint:"#leaf-viewer",render:function(){this.fixCarets(),this.fixMetamark(),this.fixSuper(),this.fixSublinear(),this.fixAddInMargin(),this.addAppTips(),this.addSubstTips(),this.fixAdds(),this.fixErasures(),this.fixStrikethroughs()},fixCarets:function(){var t=this.$("span");_.each(t,function(t){$(t).removeClass("caret")})},fixMetamark:function(){function t(t){var e=t.find("#v-margin-bottom>.left-margin"),i=t.find("#v-margin-bottom>.center-margin"),n=t.find("#v-margin-bottom>.right-margin"),r=t.find("#v-margin-top>.left-margin"),o=t.find("#v-margin-top>.center-margin"),s=t.find("#v-margin-top>.right-margin"),a=t.find("#h-margin-left"),l=t.find("#h-margin-right");t.find('.metamark[place~="margin(top)"][place~="margin(left)"]').appendTo(r),t.find('.metamark[place~="margin(top)"][place~="margin(right)"]').appendTo(s),t.find('.metamark[place="margin(top)"]').appendTo(o),t.find('.metamark[place~="margin(bottom)"][place~="margin(left)"]').appendTo(e),t.find('.metamark[place~="margin(bottom)"][place~="margin(right)"]').appendTo(n),t.find('.metamark[place="margin(bottom)"]').appendTo(i),t.find('.metamark[place="margin(left)"]').appendTo(a),t.find('.metamark[place="margin(right)"]').appendTo(l)}t(this.$el),this.fixMarginHeight()},addAppTips:function(){var t=this.$el;this.$(".app").each(function(e){t.append('<div class="apparatustip" id="apparatustip'+e+'"><div class="tipheader">Other Readings</div></div>');var i=$("#apparatustip"+e);$(this).find(".alternate").each(function(){i.append($(this).clone()),$(this).next().length&&i.append($("<br>"))}),$(i).mouseenter(function(){i.fadeTimeout&&clearTimeout(i.fadeTimeout)}).mouseleave(function(){i.fadeTimeout=setTimeout(function(){i.fadeOut()},400)}),$(this).removeAttr("title").mouseenter(function(){i.fadeTimeout&&clearTimeout(i.fadeTimeout),i.css({opacity:1}).fadeIn()}).mousemove(function(t){i.css({left:t.pageX,top:t.pageY-i.height()-15})}).mouseleave(function(){i.fadeTimeout=setTimeout(function(){i.fadeOut()},1e3)})})},addSubstTips:function(){var t=this.$el;this.$(".del").parents(".subst").find(".add").each(function(e){t.append('<div class="substtip diplomaticstyle" id="substtip'+e+'"><div class="tipheader">Altered Text</div></div>');var i=$("#substtip"+e);$(this).addClass("highlight-subst"),$(this).parents(".subst").find(".del").each(function(){i.append($(this).clone()),$(this).next().length&&i.append($("<br>"))}),$(i).mouseenter(function(){i.fadeTimeout&&clearTimeout(i.fadeTimeout)}).mouseleave(function(){i.fadeTimeout=setTimeout(function(){i.fadeOut()},400)});var n=$(this).offset();$(this).removeAttr("title").mouseenter(function(){i.fadeTimeout&&clearTimeout(i.fadeTimeout),i.css({opacity:1}).fadeIn()}).mousemove(function(){$(i).offset({top:n.top+15,left:n.left+15})}).mouseleave(function(){i.fadeTimeout=setTimeout(function(){i.fadeOut()},1e3)})})},fixAdds:function(){var t,e,i;i=_.bind(function(t,e){var i=$(t).html(),n=i.indexOf('<span class="rollover bubble">');if(n>-1){var r=i.indexOf('<span style="display:none">',n+1);i=i.substring(0,n)+i.substring(r+'<span style="display:none">'.length)}var o=$('<div class="add-rollover"></div>').html(i);$(this.popoverAttachmentPoint).append(o),$(o).mouseenter(function(){o.fadeTimeout&&clearTimeout(o.fadeTimeout)}).mouseleave(function(){o.fadeTimeout=setTimeout(function(){o.fadeOut()},400)});var s=$('<span class="rollover">...<span style="display:none">'+i+"</span></span>");($(t).find(".bubble")||$(t).hasClass("bubble"))&&s.addClass("bubble");var a=o.height()+15,l=$(o).find(".above"),h=$(o).find(".below");l.length>0&&($(o).css({"padding-top":20*l.length+"px"}),a+=20*l.length),h.length>0&&($(o).css({"padding-bottom":20*h.length+"px"}),a+=20*h.length),e&&(a=-o.height(),l.length>0&&($(o).css({"padding-top":20*l.length+"px"}),a-=20*l.length),h.length>0&&($(o).css({"padding-bottom":20*h.length+"px"}),a-=20*h.length)),$(t).html("").append(s).css({left:"-10px","margin-right":"-15px"}).removeAttr("title").mouseenter(function(){o.fadeTimeout&&clearTimeout(o.fadeTimeout),o.css({opacity:1}).fadeIn()}).mousemove(function(t){o.css({left:t.pageX-o.width()/2,top:t.pageY-a})}).mouseleave(function(){o.fadeTimeout=setTimeout(function(){o.fadeOut()},1e3)})},this),e=this.$el.offset().left+this.$el.width();var n=$("<span>^MQ</span>");this.$el.append(n),t=n.height()+n.height()/3,n.remove(),this.$(".above").each(function(){$(this).height()>t?i($(this)):$(this).offset().left+$(this).width()>e?i($(this)):$(this).parents(".above,.below").length>0&&i($(this))}),this.$(".below").each(function(){$(this).height()>t?i($(this),!0):$(this).offset().left+$(this).width()>e?i($(this),!0):$(this).parents(".above,.below").length>0&&i($(this),!0)}),this.$(".above").each(function(){$(this).height()>t?i($(this)):$(this).offset().left+$(this).width()>e?i($(this)):$(this).parents(".above,.below").length>0&&i($(this))});var r=this.$el;convertToRolloverMargin=_.bind(function(t){var e=$(t).html(),i=$('<div class="add-rollover"></div>').html(e);$(this.popoverAttachmentPoint).append(i),$(i).mouseenter(function(){i.fadeTimeout&&clearTimeout(i.fadeTimeout)}).mouseleave(function(){i.fadeTimeout=setTimeout(function(){i.fadeOut()},400)});var n=$('<span class="rollover">...<span style="display:none">'+e+"</span></span>");($(t).find(".bubble")||$(t).hasClass("bubble"))&&n.addClass("bubble");var o=i.height(),s=$(i).find(".above"),a=$(i).find(".below");s.length>0&&($(i).css({"padding-top":20*s.length+"px"}),o+=20*s.length),a.length>0&&($(i).css({"padding-bottom":20*a.length+"px"}),o+=20*a.length);var l,h,u=r;$(t).hasClass("add-margin-bottom")?(l=u.offset().left+u.width()/2,h=u.offset().top+u.height()):$(t).hasClass("add-margin-left")?(l=u.offset().left,h=u.offset().top+u.height()/2):$(t).hasClass("add-margin-right")?(l=u.offset().left+u.width(),h=u.offset().top+u.height()/2):(l=u.offset().left+u.width()/2,h=u.offset().top);var c="-10px";$(t).css("left").match(/\d+\.*\d*/)&&$(t).css("left").replace(/px/,"")[0]>0&&(c=$(t).css("left")),$(t).html("").append(n).css({left:c,"margin-right":"-15px"}).removeAttr("title").mouseenter(function(){i.fadeTimeout&&clearTimeout(i.fadeTimeout),i.css({opacity:1}).slideDown()}).mousemove(function(){i.css({left:l-i.width()/2,top:h})}).mouseleave(function(){i.fadeTimeout=setTimeout(function(){i.fadeOut()},1e3)})},this),this.$('.add[class*="add-margin"]').each(function(){convertToRolloverMargin($(this))})},getSpanDimensions:function(t){var e=document.createElement("span");e.style.display="inline-block",e.style.cssText="line-height:1em;",e.innerHTML=t.innerHTML;var i=this.el;e=i.appendChild(e),e.hidden=!0,e.hidden=!1;var n={x:e.offsetWidth,y:e.offsetHeight};return i.removeChild(e),n},fixAddInMargin:function(){this.$('.add[class~="margin(top)"]').addClass("add-margin-top"),this.$('.add[class~="margin(bottom)"]').addClass("add-margin-bottom"),this.$('.add[class~="margin(left)"]').addClass("add-margin-left"),this.$('.add[class~="margin(right)"]').addClass("add-margin-right");for(var t=this.$el,e=$('#diplomatictext .add[class~="add-margin-top"], #diplomatictext .add[class~="add-margin-left"], #diplomatictext .add[class~="add-margin-right"]'),i=0;i<e.length;i++){var n=e[i],r=this.getSpanDimensions(n),o="left:-"+(r.x/2+5)+"px;top:-17px;margin-right:"+-1*(r.x-this.marginBuffer)+"px;";if(n.style.cssText=o,$(n).offset().left<$(t).offset().left){var s=$(t).offset().left-$(n).offset().left;n.style.cssText=e[i].style.cssText.replace(/left:\s*.*?px;/i,"left:"+-1*(r.x/2-s)+"px;")}$(n).addClass("moved")}e=this.$('.add[class~="add-margin-bottom"]');for(var i=0;i<e.length;i++){var n=e[i],r=this.getSpanDimensions(e[i]);e[i].innerHTML.search("\u2014")>-1&&(r.x=r.x-17);var o="left:-"+r.x/2+"px;top:17px;margin-right:"+-1*(r.x-this.marginBuffer)+"px;";if(e[i].style.cssText=o,$(n).offset().left<$(t).offset().left){var s=$(t).offset().left-$(n).offset().left;e[i].style.cssText=e[i].style.cssText.replace(/left:\s*.*?px;/i,"left:"+-1*(r.x/2-s)+"px;")}$(n).addClass("moved")}},fixSuper:function(){for(var t=this.$el,e=this.$(".above"),i=0;i<e.length;i++){var n=e[i],r=this.getSpanDimensions(n),o="left:-"+(r.x/2+5)+"px;top:-17px;margin-right:"+-1*(r.x-this.marginBuffer)+"px;";if(n.style.cssText=o,$(n).offset().left<$(t).offset().left){var s=$(t).offset().left-$(n).offset().left;n.style.cssText=e[i].style.cssText.replace(/left:\s*.*?px;/i,"left:"+-1*(r.x/2-s)+"px;")}n.className+=" moved",this.checkOverlap(n)}e=this.$('.metamark[place="above"]');for(var i=0;i<e.length;i++){var n=e[i],r=this.getSpanDimensions(n),o="left:-"+r.x/2+"px;top:-17px;margin-right:"+-1*(r.x-this.marginBuffer)+"px;";if(n.style.cssText=o,$(n).offset().left<$(t).offset().left){var s=$(t).offset().left-$(n).offset().left;n.style.cssText=e[i].style.cssText.replace(/left:\s*.*?px;/i,"left:"+-1*(r.x/2-s)+"px;")}n.className+=" moved",this.checkOverlap(n)}},fixSublinear:function(){for(var t=this.$el,e=this.$(".below"),i=0;i<e.length;i++){var n=e[i],r=this.getSpanDimensions(e[i]);e[i].innerHTML.search("\u2014")>-1&&(r.x=r.x-17);var o="left:-"+r.x/2+"px;top:17px;margin-right:"+-1*(r.x-this.marginBuffer)+"px;";if(e[i].style.cssText=o,$(n).offset().left<$(t).offset().left){var s=$(t).offset().left-$(n).offset().left;e[i].style.cssText=e[i].style.cssText.replace(/left:\s*.*?px;/i,"left:"+-1*(r.x/2-s)+"px;")}e[i].className+=" moved",this.checkOverlap(e[i])}e=this.$('.metamark[place="below"]');for(var i=0;i<e.length;i++){var n=e[i],r=this.getSpanDimensions(e[i]);e[i].innerHTML.search("\u2014")>-1&&(r.x=r.x-17);var o="left:-"+r.x/2+"px;top:17px;margin-right:"+-1*(r.x-this.marginBuffer)+"px;";if(e[i].style.cssText=o,$(n).offset().left<$(t).offset().left){var s=$(t).offset().left-$(n).offset().left;e[i].style.cssText=e[i].style.cssText.replace(/left:\s*.*?px;/i,"left:"+-1*(r.x/2-s)+"px;")}e[i].className+=" moved",this.checkOverlap(e[i])}},checkOverlap:function(t){for(var e=this.$(".moved"),i=0;i<e.length;i++){var n=$(t),r=$(e[i]);if(t!=e[i]&&Math.abs(n.offset().top-r.offset().top)<n.height()-3&&(n.offset().left>=r.offset().left&&n.offset().left<=r.offset().left+r.width()||r.offset().left>=n.offset().left&&r.offset().left<=n.offset().left+n.width())){var o=r.offset().left+r.width()-n.offset().left+5,s=t.style.cssText.match(/left:[^;]+/gi)[0];s=parseFloat(s.substr(5,s.indexOf("px")-5))+o,t.style.cssText=t.style.cssText.replace(/left:\s*.*?px;/gi,"left:"+s+"px;"),t.hidden=!0,t.hidden=!1}}},fixErasures:function(){this.$(".erasure").each(function(){$(this).find(":last-child").length>0?$(this).find(":last-child").each(function(){$(this).children().length<1&&$(this).addClass("erasure-child")}):$(this).addClass("erasure-child")}),this.$(".substtip .erasure").each(function(){$(this).addClass("erasure-child")})},fixLinebreaks:function(){this.$(".lb").next("br").hide()},fixStrikethroughs:function(){this.$(".strikethrough").each(function(){$(this).find("span").length>0&&$(this).find("span").each(function(){$(this).children().length<1&&$(this).addClass("strikethrough")})}),this.$(".single-stroke").each(function(){if($(this).find("span").length>0){var t=!1;$(this).find("span").each(function(){$(this).hasClass("subst")?t=!0:$(this).children().length<1&&$(this).addClass("single-stroke")})}}),this.$(".multi-stroke").each(function(){$(this).find("span").length>0&&$(this).find("span").each(function(){$(this).children().length<1&&$(this).addClass("multi-stroke")})})},fixMarginHeight:function(){var t=this.$el.height();this.$("#h-margin-left").height(t-170),this.$("#h-margin-right").height(t-170)}}),TextLab.LeafViewer=Backbone.View.extend({id:"leaf-viewer",events:{"click .tab-button":"onSelectTab"},initialize:function(){this.mouseOverEnabled=!0,_.bindAll(this,"onMouseOverRevision","onMouseOutRevision")},render:function(){var t=new TextLab.DiplomaticPanel({el:this.$("#diplomatic-panel")});(t.render(),new TextLab.BasePanel({el:this.$("#base-panel")}).render(),this.model.sequences&&this.model.sequences.length>0)&&new TextLab.SequenceListPanel({el:this.$("#sequence-list-panel"),sequences:this.model.sequences,leafViewer:this}).render();this.initViewer();var e=t.$("span");_.each(e,function(t){var e=$(t),i=e.attr("facs");if(i){var n=i.slice(i.length-4);e.mouseenter(_.partial(this.onMouseOverRevision,n)),e.mouseleave(_.partial(this.onMouseOutRevision,n))}},this),this.displayTabPane("diplo-pane")},onSelectTab:function(t){var e=$(t.currentTarget),i=e.attr("data-tab");e.tab("show"),this.displayTabPane(i)},displayTabPane:function(t){this.$(".tab-pane").hide(),this.$("#"+t).show()},highlightZone:function(t,e){_.find(paper.project.activeLayer.children,function(e){return e.data.zone&&e.data.zone.zone_label==t}).visible=e,paper.view.draw()},onMouseOverRevision:function(t){this.mouseOverEnabled&&this.highlightZone(t,!0)},onMouseOutRevision:function(t){this.mouseOverEnabled&&this.highlightZone(t,!1)},getTileSource:function(t){if(!this.model.tile_source)return void t(null);var e=_.template("<%= tileSource %>/info.json");$.ajax({url:e({tileSource:this.model.tile_source}),dataType:"json",success:function(e){t(new OpenSeadragon.IIIFTileSource(e))}})},renderZone:function(t){var e=new paper.Point(t.ulx,t.uly),i=new paper.Point(t.lrx,t.lry),n=new paper.Path.Rectangle(e,i),r=n.bounds;n.strokeColor="blue",n.strokeWidth=12,n.name="zoneRect";var o=new paper.Path.Circle(r.topCenter,30);o.fillColor="blue",o.data.handle="top";var s=new paper.Path.Circle(r.leftCenter,30);s.fillColor="blue",s.data.handle="left";var a=new paper.Path.Circle(r.rightCenter,30);a.fillColor="blue",a.data.handle="right";var l=new paper.Path.Circle(r.bottomCenter,30);l.fillColor="blue",l.data.handle="bottom";var h=new paper.Group([o,s,a,l]);h.name="resizeHandles",h.visible=!1;var u=new paper.Path.Circle(r.topRight,30);u.fillColor="red",u.name="deleteButton",u.visible=!1,u.data.deleteButton=!0;var c=new paper.Group([n,h,u]);return c.zoneGroup=!0,c.data.zone=t,c.visible=!1,c},initViewer:function(){this.viewer=OpenSeadragon({id:"openseadragon",showFullPageControl:!1,showHomeControl:!1,showZoomControl:!1}),this.overlay=this.viewer.paperjsOverlay();var t=_.bind(function(){_.each(this.model.zones,this.renderZone,this),this.overlay.resize(),this.overlay.resizecanvas(),this.viewReady=!0},this);this.getTileSource(_.bind(function(e){e&&this.viewer.addTiledImage({tileSource:e,success:t})},this))}}),TextLab.SectionViewer=Backbone.View.extend({id:"section-viewer",render:function(){this.deleteDels(),this.fixCarets()},fixCarets:function(){var t=this.$("span");_.each(t,function(t){$(t).removeClass("caret")})},deleteDels:function(){var t=this.$(".del, .metamark");_.each(t,function(t){$(t).detach()})}}),TextLab.SequenceListPanel=Backbone.View.extend({template:JST["tl-viewer/templates/sequence-list-panel"],id:"sequence-list-panel",events:{"click .sequence-link":"onViewSequence"},initialize:function(t){this.sequences=t.sequences,this.leafViewer=t.leafViewer},onViewSequence:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-sequence-id")),n=_.bind(function(t){var e=new TextLab.SequencePanel({sequenceListPanel:this,leafViewer:this.leafViewer,model:t});this.$("#sequence-list").hide(),e.render(),this.leafViewer.mouseOverEnabled=!1,this.$el.append(e.$el)},this);return new TextLab.Sequence({id:i}).fetch({success:n}),!1},render:function(){this.$el.html(this.template({sequences:this.sequences}))}}),TextLab.SequencePanel=Backbone.View.extend({stepSequencePanelTemplate:JST["tl-viewer/templates/step-sequence-panel"],sequenceGridPanelTemplate:JST["tl-viewer/templates/sequence-grid-panel"],emptySequencePanelTemplate:JST["tl-viewer/templates/empty-sequence-panel"],facsSelectorTemplate:_.template("span[facs='#<%= leafID %>-<%= zoneLabel %>']"),id:"sequence-panel",events:{"click .toggle-grid-button":"onToggleGrid","click .next-step-button":"onNextStep","click .goto-step-button":"onGotoStep","click .prev-step-button":"onPrevStep","click .back-to-list-link":"onBackToList"},initialize:function(t){this.sequenceListPanel=t.sequenceListPanel,this.leafViewer=t.leafViewer,this.showGrid=!1,this.gotoFirstStep()},onToggleGrid:function(){return this.showGrid=!this.showGrid,this.showGrid?(this.leafViewer.mouseOverEnabled=!0,this.setCurrentStep(null)):(this.leafViewer.mouseOverEnabled=!1,this.gotoFirstStep()),this.render(),!1},onNextStep:function(){var t=this.model.narrativeSteps.models.length;if(this.stepNumber<t-1){var e=this.stepNumber+1;this.setCurrentStep(e),this.render()}return!1},onGotoStep:function(t){var e=$(t.currentTarget),i=parseInt(e.attr("data-step-number"));return this.setCurrentStep(i),this.render(),!1},onPrevStep:function(){if(this.stepNumber>0){var t=this.stepNumber-1;this.setCurrentStep(t),this.render()}return!1},onBackToList:function(){this.setCurrentStep(null),this.$el.detach(),this.sequenceListPanel.$("#sequence-list").show(),this.leafViewer.mouseOverEnabled=!0},gotoFirstStep:function(){this.setCurrentStep(0)},setCurrentStep:function(t){if(this.currentStep){var e=this.currentStep.get("zone_label");e&&""!=e&&(this.leafViewer.highlightZone(e,!1),this.hightlightSpan(e,!1))}if(null!=t&&this.model.narrativeSteps&&this.model.narrativeSteps.models.length>0){var i=this.model.narrativeSteps.models[t],n=i.get("zone_label");n&&""!=n&&(this.leafViewer.highlightZone(n,!0),this.hightlightSpan(n,!0))}else i=null;this.currentStep=i,this.stepNumber=t},hightlightSpan:function(t,e){var i=this.leafViewer.model.xml_id,n=this.facsSelectorTemplate({leafID:i,zoneLabel:t}),r=this.leafViewer.$(n);e?r.addClass("seq-highlight"):r.removeClass("seq-highlight")},render:function(){if(this.showGrid){var t=null!=this.currentStep?this.currentStep.get("step_number"):-1;this.$el.html(this.sequenceGridPanelTemplate({name:this.model.get("name"),owner:this.model.get("owner_name"),currentStep:t,steps:this.model.narrativeSteps.toJSON()}))}else null!=this.currentStep?this.$el.html(this.stepSequencePanelTemplate({name:this.model.get("name"),owner:this.model.get("owner_name"),stepNumber:this.stepNumber,maxSteps:this.model.narrativeSteps.models.length,step:this.currentStep.toJSON()})):this.$el.html(this.emptySequencePanelTemplate({name:this.model.get("name")}))}});